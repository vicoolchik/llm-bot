question_id,title,body,creation_date,link,asked_by,tags
65697972,Create graph from recursive JSON data using apoc.load.json and use UNWIND and FOREACH for setting property,"I want to create a graph from my recursive JSON file. My JSON data is given below.

```{
  &quot;ChildNodes&quot;:[
    {
      &quot;ChildNodes&quot;:[
        {
          &quot;ChildNodes&quot;:[
            {
              &quot;ChildNodes&quot;:[
                {
                  &quot;ChildNodes&quot;:[
                    {
                      &quot;FSId&quot;:1,
                      &quot;FileDetailId&quot;:1862,
                      &quot;FileId&quot;:1225,
                      &quot;FileName&quot;:&quot;tables&quot;,
                      &quot;Type&quot;:[
                        &quot;DI&quot;
                      ],
                      &quot;collapsed&quot;:1
                    }
                  ],
                  &quot;FSId&quot;:1,
                  &quot;FileDetailId&quot;:1861,
                  &quot;FileId&quot;:1224,
                  &quot;FileName&quot;:&quot;Components&quot;,
                  &quot;Type&quot;:[
                    &quot;DI&quot;
                  ],
                  &quot;collapsed&quot;:1
                },
                {
                  &quot;FSId&quot;:1,
                  &quot;FileDetailId&quot;:1885,
                  &quot;FileId&quot;:1247,
                  &quot;FileName&quot;:&quot;Filters&quot;,
                  &quot;Type&quot;:[
                    &quot;DI&quot;
                  ],
                  &quot;collapsed&quot;:1
                },
                {
                  &quot;FSId&quot;:1,
                  &quot;FileDetailId&quot;:1894,
                  &quot;FileId&quot;:1253,
                  &quot;FileName&quot;:&quot;SFXPlugins&quot;,
                  &quot;Type&quot;:[
                    &quot;DI&quot;
                  ],
                  &quot;collapsed&quot;:1
                },
                {
                  &quot;FSId&quot;:1,
                  &quot;FileDetailId&quot;:1899,
                  &quot;FileId&quot;:1255,
                  &quot;FileName&quot;:&quot;SonicResources&quot;,
                  &quot;Type&quot;:[
                    &quot;DI&quot;
                  ],
                  &quot;collapsed&quot;:1
                },
                {
                  &quot;FSId&quot;:1,
                  &quot;FileDetailId&quot;:1901,
                  &quot;FileId&quot;:1257,
                  &quot;FileName&quot;:&quot;style&quot;,
                  &quot;Type&quot;:[
                    &quot;DI&quot;
                  ],
                  &quot;collapsed&quot;:1
                },
                {
                  &quot;ChildNodes&quot;:[
                    {
                      &quot;ChildNodes&quot;:[
                        {
                          &quot;ChildNodes&quot;:[
                            {
                              &quot;FSId&quot;:1,
                              &quot;FileDetailId&quot;:1905,
                              &quot;FileId&quot;:1262,
                              &quot;FileName&quot;:&quot;Symphony&quot;,
                              &quot;Type&quot;:[
                                &quot;DI&quot;
                              ],
                              &quot;collapsed&quot;:1
                            }
                          ],
                          &quot;FSId&quot;:1,
                          &quot;FileDetailId&quot;:1904,
                          &quot;FileId&quot;:1260,
                          &quot;FileName&quot;:&quot;Symphony&quot;,
                          &quot;Type&quot;:[
                            &quot;DI&quot;
                          ],
                          &quot;collapsed&quot;:1
                        }
                      ],
                      &quot;FSId&quot;:1,
                      &quot;FileDetailId&quot;:1903,
                      &quot;FileId&quot;:1259,
                      &quot;FileName&quot;:&quot;NTSC&quot;,
                      &quot;Type&quot;:[
                        &quot;DI&quot;
                      ],
                      &quot;collapsed&quot;:1
                    },
                    {
                      &quot;ChildNodes&quot;:[
                        {
                          &quot;ChildNodes&quot;:[
                            {
                              &quot;FSId&quot;:1,
                              &quot;FileDetailId&quot;:1910,
                              &quot;FileId&quot;:1267,
                              &quot;FileName&quot;:&quot;Symphony&quot;,
                              &quot;Type&quot;:[
                                &quot;DI&quot;
                              ],
                              &quot;collapsed&quot;:1
                            }
                          ],
                          &quot;FSId&quot;:1,
                          &quot;FileDetailId&quot;:1909,
                          &quot;FileId&quot;:1265,
                          &quot;FileName&quot;:&quot;Symphony&quot;,
                          &quot;Type&quot;:[
                            &quot;DI&quot;
                          ],
                          &quot;collapsed&quot;:1
                        }
                      ],
                      &quot;FSId&quot;:1,
                      &quot;FileDetailId&quot;:1908,
                      &quot;FileId&quot;:1264,
                      &quot;FileName&quot;:&quot;PAL&quot;,
                      &quot;Type&quot;:[
                        &quot;DI&quot;
                      ],
                      &quot;collapsed&quot;:1
                    }
                  ],
                  &quot;FSId&quot;:1,
                  &quot;FileDetailId&quot;:1902,
                  &quot;FileId&quot;:1258,
                  &quot;FileName&quot;:&quot;Styles&quot;,
                  &quot;Type&quot;:[
                    &quot;DI&quot;
                  ],
                  &quot;collapsed&quot;:1
                }
              ],
              &quot;FSId&quot;:1,
              &quot;FileDetailId&quot;:1860,
              &quot;FileId&quot;:1216,
              &quot;FileName&quot;:&quot;CreateDisc&quot;,
              &quot;Type&quot;:[
                &quot;DI&quot;
              ],
              &quot;collapsed&quot;:1
            },
            {
              &quot;FSId&quot;:1,
              &quot;FileDetailId&quot;:1913,
              &quot;FileId&quot;:1269,
              &quot;FileName&quot;:&quot;de-DE&quot;,
              &quot;Type&quot;:[
                &quot;DI&quot;
              ],
              &quot;collapsed&quot;:1
            },
            {
              &quot;FSId&quot;:1,
              &quot;FileDetailId&quot;:1994,
              &quot;FileId&quot;:1298,
              &quot;FileName&quot;:&quot;en-US&quot;,
              &quot;Type&quot;:[
                &quot;DI&quot;
              ],
              &quot;collapsed&quot;:1
            },
            {
              &quot;ChildNodes&quot;:[
                {
                  &quot;FSId&quot;:1,
                  &quot;FileDetailId&quot;:2050,
                  &quot;FileId&quot;:1328,
                  &quot;FileName&quot;:&quot;X02&quot;,
                  &quot;Type&quot;:[
                    &quot;DI&quot;
                  ],
                  &quot;collapsed&quot;:1
                }
              ],
              &quot;FSId&quot;:1,
              &quot;FileDetailId&quot;:2049,
              &quot;FileId&quot;:1327,
              &quot;FileName&quot;:&quot;MCX&quot;,
              &quot;Type&quot;:[
                &quot;DI&quot;
              ],
              &quot;collapsed&quot;:1
            },
            {
              &quot;FSId&quot;:1,
              &quot;FileDetailId&quot;:2066,
              &quot;FileId&quot;:1330,
              &quot;FileName&quot;:&quot;MediaRenderer&quot;,
              &quot;Type&quot;:[
                &quot;DI&quot;
              ],
              &quot;collapsed&quot;:1
            },
            {
              &quot;FSId&quot;:1,
              &quot;FileDetailId&quot;:2091,
              &quot;FileId&quot;:1335,
              &quot;FileName&quot;:&quot;sk-SK&quot;,
              &quot;Type&quot;:[
                &quot;DI&quot;
              ],
              &quot;collapsed&quot;:1
            },
            {
              &quot;ChildNodes&quot;:[
                {
                  &quot;FSId&quot;:1,
                  &quot;FileDetailId&quot;:2108,
                  &quot;FileId&quot;:1359,
                  &quot;FileName&quot;:&quot;de-DE&quot;,
                  &quot;Type&quot;:[
                    &quot;DI&quot;
                  ],
                  &quot;collapsed&quot;:1
                },
                {
                  &quot;FSId&quot;:1,
                  &quot;FileDetailId&quot;:2116,
                  &quot;FileId&quot;:1361,
                  &quot;FileName&quot;:&quot;en-US&quot;,
                  &quot;Type&quot;:[
                    &quot;DI&quot;
                  ],
                  &quot;collapsed&quot;:1
                }
              ],
              &quot;FSId&quot;:1,
              &quot;FileDetailId&quot;:2106,
              &quot;FileId&quot;:1350,
              &quot;FileName&quot;:&quot;wow&quot;,
              &quot;Type&quot;:[
                &quot;DI&quot;
              ],
              &quot;collapsed&quot;:1
            }
          ],
          &quot;FSId&quot;:1,
          &quot;FileDetailId&quot;:1856,
          &quot;FileId&quot;:1103,
          &quot;FileName&quot;:&quot;ehome&quot;,
          &quot;Type&quot;:[
            &quot;DI&quot;
          ],
          &quot;collapsed&quot;:1
        },
        {
          &quot;FSId&quot;:1,
          &quot;FileDetailId&quot;:2120,
          &quot;FileId&quot;:1363,
          &quot;FileName&quot;:&quot;en&quot;,
          &quot;Type&quot;:[
            &quot;DI&quot;
          ],
          &quot;collapsed&quot;:1
        },
        {
          &quot;FSId&quot;:1,
          &quot;FileDetailId&quot;:2122,
          &quot;FileId&quot;:1365,
          &quot;FileName&quot;:&quot;en-US&quot;,
          &quot;Type&quot;:[
            &quot;DI&quot;
          ],
          &quot;collapsed&quot;:1
        },
        {
          &quot;FSId&quot;:1,
          &quot;FileDetailId&quot;:2135,
          &quot;FileId&quot;:1376,
          &quot;FileName&quot;:&quot;Fonts&quot;,
          &quot;Type&quot;:[
            &quot;DI&quot;
          ],
          &quot;collapsed&quot;:1
        },
        {
          &quot;ChildNodes&quot;:[
            {
              &quot;FSId&quot;:1,
              &quot;FileDetailId&quot;:3117,
              &quot;FileId&quot;:2927,
              &quot;FileName&quot;:&quot;config&quot;,
              &quot;Type&quot;:[
                &quot;DI&quot;
              ],
              &quot;collapsed&quot;:1
            }
          ],
          &quot;FSId&quot;:1,
          &quot;FileDetailId&quot;:2956,
          &quot;FileId&quot;:2118,
          &quot;FileName&quot;:&quot;System32&quot;,
          &quot;Type&quot;:[
            &quot;DI&quot;
          ],
          &quot;collapsed&quot;:1
        }
      ],
      &quot;FSId&quot;:1,
      &quot;FileDetailId&quot;:1844,
      &quot;FileId&quot;:1051,
      &quot;FileName&quot;:&quot;Windows&quot;,
      &quot;Type&quot;:[
        &quot;DI&quot;
      ],
      &quot;collapsed&quot;:1
    },
    {
      &quot;FSId&quot;:1,
      &quot;FileDetailId&quot;:3813,
      &quot;FileId&quot;:3072,
      &quot;FileName&quot;:&quot;$OrphanFiles&quot;,
      &quot;Type&quot;:[
        &quot;DI&quot;,
        &quot;IN&quot;
      ],
      &quot;collapsed&quot;:1
    }
  ],
  &quot;FSId&quot;:1,
  &quot;FileDetailId&quot;:0,
  &quot;FileId&quot;:5,
  &quot;FileName&quot;:&quot;C:&quot;,
  &quot;Type&quot;:[
    &quot;DI&quot;
  ],
  &quot;collapsed&quot;:1
}

```

I found solution in this link useful to me for building my graph - https://community.neo4j.com/t/import-nodes-from-recursively-structured-json/11704
I was able to build the graph with the help of above mentioned link. I used the query given below.

```
WITH &#39;file:///part-of-VTree.json&#39; AS json_file
CALL apoc.load.json(json_file,&quot;..FileId&quot;) YIELD value AS result 
WITH json_file, result.result AS keys 
UNWIND range(0,size(keys)-1) AS i 
CALL apoc.load.json(json_file,&quot;..[?(@.FileId == &#39;&quot; + toString(keys[i]) + &quot;&#39;)].ChildNodes[*].FileId&quot;) YIELD value AS children
WITH keys[i] AS parent_key, children.result AS children
MERGE (parent:GroupNode {name: parent_key})
WITH parent, children
UNWIND children as child_key
MERGE (child:GroupNode {name: child_key})
MERGE (child)-[:CHILD_OF]-&gt;(parent)
RETURN *
```

This created a graph with nodes having &quot;FileId&quot; mentioned on it , as I was giving &quot;FileId&quot; as &quot;name&quot; property. When I change my query as below

```
WITH &#39;file:///part-of-VTree.json&#39; AS json_file
CALL apoc.load.json(json_file,&quot;..FileId&quot;) YIELD value AS result 
WITH json_file, result.result AS keys 
UNWIND range(0,size(keys)-1) AS i 
CALL apoc.load.json(json_file,&quot;..[?(@.FileId == &#39;&quot; + toString(keys[i]) + &quot;&#39;)].ChildNodes[*].FileId&quot;) YIELD value AS children
WITH keys[i] AS parent_key, children.result AS children
MERGE (parent:GroupNode {Fid: parent_key})
WITH parent, children
UNWIND children as child_key
MERGE (child:GroupNode {Fid: child_key})
MERGE (child)-[:CHILD_OF]-&gt;(parent)
RETURN *
```

It gives me a graph with nodes which has nothing mentioned on it. Earlier I was getting nodes with &quot;FileId&quot; mentioned on it.
what I want is nodes with &quot;FileName&quot; mentioned on it and &quot;FileId&quot; as its property.

With my current query I am not able to set properties for my node. Is there any way to set properties for my node and display &quot;FileName&quot; on nodes. &quot;FileName&quot; is not always unique so I can&#39;t create graph by extracting all &quot;FileName&quot; instead of &quot;FileId&quot;.
&quot;FileId&quot; is always unique in my case.

Can anyone help me in some way to get my desired result. I need some help.
Thanks in advance!",1610525782,https://stackoverflow.com/q/65697972,Anu,"['cypher', 'neo4j', 'json', 'neo4j-apoc']"
65697147,Specify a certain column as id values in Neo4j Spark connector,"I have a dataset in java which contains an &quot;Id&quot; column that provides a unique Id for each row. I want to write the contents of this dataset as Nodes with a certain label to Neo4j using Neo4j spark connector library(v.4.0.0). According to the [documentation][1], I have a write method as below:
```
        dataset.write().format(&quot;org.neo4j.spark.DataSource&quot;)
                .mode(SaveMode.ErrorIfExists)
                .option(&quot;labels&quot;, nodeLabel)
                .option(&quot;node.keys&quot;, String.join(&quot;,&quot;, listOfNodeProperties))
                .option(&quot;url&quot;,&quot;bolt://localhost:7687&quot;)
                .option(&quot;database&quot;, resultDbName)
                .save();
```
Is there any way to specify the Id column values as Neo4j Id for each node?


  [1]: https://neo4j.com/developer/spark/writing/",1610521682,https://stackoverflow.com/q/65697147,Nora Na,"['neo4j', 'java', 'apache-spark']"
65694121,Why are non-unique indexes dropped and created when restarting the server?,"Given the schema

```graphql
type User {
  id: ID! @id
  name: String! @unique
  lastName: String @index
}
```

When restarting my apollo server, I always see non-unique indexes being dropped and created (indexes for the directive `@index`).

```
┌─────────┬─────────────┬────────────┬────────────────┬────────┬───────────┐
│ (index) │    label    │    key     │      keys      │ unique │  action   │
├─────────┼─────────────┼────────────┼────────────────┼────────┼───────────┤
│    0    │   &#39;User&#39;    │ &#39;lastName&#39; │ [ &#39;lastName&#39; ] │ false  │ &#39;DROPPED&#39; │
│    1    │   &#39;User&#39;    │ &#39;lastName&#39; │ [ &#39;lastName&#39; ] │ false  │ &#39;CREATED&#39; │
│   20    │   &#39;User&#39;    │   &#39;name&#39;   │   [ &#39;name&#39; ]   │  true  │  &#39;KEPT&#39;   │
│   23    │   &#39;User&#39;    │    &#39;id&#39;    │    [ &#39;id&#39; ]    │  true  │  &#39;KEPT&#39;   │
│   23    │   &#39;User&#39;    │    &#39;id&#39;    │    [ &#39;id&#39; ]    │  true  │  &#39;KEPT&#39;   │
└─────────┴─────────────┴────────────┴────────────────┴────────┴───────────┘
```

I&#39;m not sure if that&#39;s a bug or by design. In the latter, can someone explain this behavior ?

[duplicate github issue](https://github.com/neo4j-graphql/neo4j-graphql-js/issues/569)",1610498486,https://stackoverflow.com/q/65694121,Adrien Lemaire,"['graphql', 'apollo-server', 'neo4j', 'neo4j-graphql-js']"
65691774,py2neo doesn&#39;t update database nodes,"I am having trouble updating nodes in a neo4j-database via py2neo. I am trying to extract a network graph from several text files. My script extracts the necessary information and creates the nodes and relationships and then writes them to the database. While this works fine for some nodes, I have repeatedly run into nodes in the database that don&#39;t have all properties that should be there. 

When I run the script line by line for such a node, the information is extracted fine and the objects created in python, but the information is lost at some point during the transfer to neo4j. I execute .push() or tx.commit() which runs without error, but when I query the node in neo4j explorer, the information isn&#39;t there. The example below is for a node, but the same applies to relationships and their properties. 

I am using
 - Windows 10
 - Anaconda, version 1.10
 - Python, version 3.7.9
 - Neo4j-Desktop, version: 1.3.11
 - Neo4j-Database, version: 3.5.25
 - py2neo, version (log: 4.2.0 | pip: 2020.1.1) 


```from py2neo import Graph, Schema, Node, Relationship, walk
from py2neo.matching import *

graphdb=Graph(user=&quot;user&quot;,password=&quot;password&quot;)

def g_commit(*nds):
    graphdb=Graph(user=&quot;neo4j&quot;,password=&quot;aqnetwork2021&quot;)
    tx=graphdb.begin()
    c=0
    for n in nds:
        if &quot;py2neo.data.&quot; in str(type(n)):
            tx.create(n)
            c=c+1
    if c&gt;0:
        try:
            fdb=tx.commit()
        except Exception as e:
            if hasattr(e, &#39;message&#39;):
                fdb=e.message
            else:
                fdb=e
    else:
        fdb=&quot;No Node or Relationship Objects found&quot;
    return fdb

def checkNode(label, ident):
    check=graphdb.nodes.match(label, id=ident).first()
    if check == None:
        chckNode=Node(label,id=ident)
        chckNode.__primarylabel__=label
        chckNode.__primarykey__=&quot;id&quot;
        g_commit(chckNode)
    else:
        chckNode=check
        chckNode.__primarylabel__=label
        chckNode.__primarykey__=&quot;id&quot;
    return chckNode


pr_node=checkNode(&quot;pressrelease&quot;,id)
pr_node[&quot;date&quot;]= date #string
pr_node[&quot;heading&quot;]=heading #string
pr_node[&quot;acion&quot;]=action #string
g_commit(pr_node)
```
If I check the object in Python I get
```
dict(pr_node)
 
{&#39;id&#39;: &#39;AB/12345&#39;,
 &#39;date&#39;: &#39;02.10.2015&#39;,
 &#39;heading&#39;: &#39;Something important&#39;,
 &#39;acion&#39;: &#39;adds&#39;}
```
The log created via the logging module shows the following which I interpret as successfull
```
2021-01-12 21:10:02,474 - Adding connection pool for profile ConnectionProfile(&#39;bolt://neo4j@localhost:7687&#39;)
2021-01-12 21:10:02,474 - Trying to acquiring connection from pool &lt;ConnectionPool profile=ConnectionProfile(&#39;bolt://neo4j@localhost:7687&#39;) in_use=0 free=0 spare=100&gt;
2021-01-12 21:10:02,474 - [#0000] C: (Dialing &lt;localhost:7687&gt;)
2021-01-12 21:10:02,476 - [#F234] S: (Accepted)
2021-01-12 21:10:02,476 - [#F234] C: &lt;BOLT&gt;
2021-01-12 21:10:02,476 - [#F234] C: &lt;PROTOCOL&gt; 4.1 | 4.0 | 3.0 | 2.0
2021-01-12 21:10:02,476 - [#F234] S: &lt;PROTOCOL&gt; 3.0
2021-01-12 21:10:02,476 - [#F234] C: HELLO {&#39;user_agent&#39;: &#39;py2neo/4.2.0 Python/3.7.9-final-0 (win32)&#39;, &#39;scheme&#39;: &#39;basic&#39;, &#39;principal&#39;: &#39;neo4j&#39;, &#39;credentials&#39;: &#39;*******&#39;}
2021-01-12 21:10:02,476 - [#F234] C: (Sent 116 bytes)
2021-01-12 21:10:02,477 - [#F234] S: SUCCESS {&#39;server&#39;: &#39;Neo4j/3.5.25&#39;, &#39;connection_id&#39;: &#39;bolt-83&#39;}
2021-01-12 21:10:02,477 - Acquired connection &lt;py2neo.client.bolt.Bolt3 object at 0x0000017DBFC93D88&gt;
2021-01-12 21:10:02,477 - Releasing connection &lt;py2neo.client.bolt.Bolt3 object at 0x0000017DBFC93D88&gt;
2021-01-12 21:10:02,477 - Attempting to acquire connection to default database
2021-01-12 21:10:02,477 - Using connection pool &lt;ConnectionPool profile=ConnectionProfile(&#39;bolt://neo4j@localhost:7687&#39;) in_use=0 free=1 spare=99&gt;
2021-01-12 21:10:02,477 - Trying to acquiring connection from pool &lt;ConnectionPool profile=ConnectionProfile(&#39;bolt://neo4j@localhost:7687&#39;) in_use=0 free=1 spare=99&gt;
2021-01-12 21:10:02,477 - Acquired connection &lt;py2neo.client.bolt.Bolt3 object at 0x0000017DBFC93D88&gt;
2021-01-12 21:10:02,477 - [#F234] C: BEGIN {}
2021-01-12 21:10:02,478 - [#F234] C: (Sent 7 bytes)
2021-01-12 21:10:02,478 - [#F234] S: SUCCESS {}
2021-01-12 21:10:02,478 - [#F234] C: COMMIT
2021-01-12 21:10:02,478 - [#F234] C: (Sent 6 bytes)
2021-01-12 21:10:02,479 - [#F234] S: SUCCESS {&#39;bookmark&#39;: &#39;neo4j:bookmark:v1:tx49427&#39;}
2021-01-12 21:10:02,479 - Releasing connection &lt;py2neo.client.bolt.Bolt3 object at 0x0000017DBFC93D88&gt;
```
I check the object in neo4j however I get
```
MATCH(n:pressrelease) WHERE (n.id=&quot;AB/12345&quot;) RETURN n

{
  &quot;identity&quot;: 9770,
  &quot;labels&quot;: [
    &quot;pressrelease&quot;
  ],
  &quot;properties&quot;: {
&quot;id&quot;: &quot;SC/12067&quot;
  }
}
```
Sometimes, when I use graphdb.push() instead this works, but not reliably.

Am I missing something in my code? I am somewhat lost as to where to look for the error.",1610484214,https://stackoverflow.com/q/65691774,EliasAtBerlin,"['neo4j', 'python', 'py2neo']"
65690692,Unwind with Multiple OPTIONAL MATCH returns duplicates,"My graph has the following entities:

- Post
- User

And has the following relationship examples

- User-[:POSTED]-&gt;Post
- User-[:LIKE|:DISLIKE]-&gt;Post
- User-[:POSTED]-&gt;Post-[:REPOST_OF]-&gt;Post
- User-[:POSTED]-&gt;Post[:REPLY_TO]-&gt;Post
- User-[:FRIEND_OF]-User

**OBJECTIVE**

- Get a Post by their ID property
- Get the counts of LIKE, DISLIKE, REPOSTS, and REPLIES to this Post
- Get my reaction to this post, [Dislike | Like]
- Find which of my friends LIKE or DISLIKE this Post
- Find whatever replies, or reposts by Friends have made to this post
- **Get the counts of LIKE, DISLIKE, REPOSTS, and REPLIES to each reply by my friend to this post**
- **Get my reaction to the each of my friend&#39;s reposts and replies**

I&#39;ve been able to do all of this except the last two objectives.

Excluding the last two, This is what I did.

      MATCH (me: User {id: &quot;17450808-0f08-771c-b1cb-9e2480869625&quot;})
      
      MATCH (post: Post {id: &quot;17452c1e-37c2-21a0-df56-69be1b63418a&quot;})
      
      MATCH (post)&lt;-[postData:POSTED]-(poster: User)
      
      OPTIONAL MATCH (me)-[myReaction:UPVOTE|:DOWNVOTE]-&gt;(post)

      OPTIONAL MATCH (:User)-[upvote:UPVOTE]-&gt;(post)
      WITH DISTINCT post, postData, poster, myReaction, count(upvote) AS upvotes
      
      OPTIONAL MATCH (:User)-[downvote:DOWNVOTE]-&gt;(post)
      WITH DISTINCT post, postData, poster, myReaction, upvotes, count(downvote) AS downvotes
      
      OPTIONAL MATCH (:Post)-[repost:REPOST_OF]-&gt;(post)
      WITH DISTINCT post, postData, poster, myReaction, upvotes, downvotes, count(repost) AS reposts
      
      OPTIONAL MATCH (:Post)-[reply: REPLY_TO]-&gt;(post)
      WITH DISTINCT post, postData, poster, myReaction, upvotes, downvotes, reposts, count(reply) AS replies
      
      OPTIONAL MATCH (me)-[:COLLEAGUE_OF]-(colleague: User)
      WITH DISTINCT COLLECT(colleague) AS colleagues, post, poster, postData, upvotes, downvotes, myReaction, reposts, replies
     
      UNWIND colleagues AS colleague
     
      OPTIONAL MATCH (colleague)-[:POSTED]-&gt;(colleagueInteraction:Post)-
      [colleagueInteractionRelation:REPLY_TO|:REPOST_OF]-&gt;(post)
     
      OPTIONAL MATCH (colleague)-[colleagueReaction:UPVOTE|:DOWNVOTE]-&gt;(post)
      WITH  COLLECT(DISTINCT colleagueInteraction) AS cInteractions, COLLECT(DISTINCT colleagueReaction) AS cReactions,
     post, postData, upvotes, downvotes, replies, reposts, myReaction, poster
     
      RETURN DISTINCT post, myReaction, poster, postData, upvotes, downvotes, replies, reposts, cInteractions, cReactions


This works perfectly fine.

I attempted the latter objectives, by unwinding the cInteractions and doing OPTIONAL MATCHes for the values and it keeps duplicating the result.",1610479404,https://stackoverflow.com/q/65690692,Emmanuel Sunday,"['graphenedb', 'neo4j', 'cypher']"
65690563,Neo.ClientError.Statement.ExternalResourceFailed error on loading CSV file from local,"Well first thing this is my code

    LOAD CSV WITH HEADERS FROM &#39;file:///Abia.csv&#39; As line CREATE(abia: Abia{office: line.OFFICE}) SET abia.reports_to = line.REPORTS_TO

the csv file is placed inside the import folder just like it is said so in the official documentation, well it gave me this error
Couldn&#39;t load the external resource at: file:/Abia.csv

I literally have tried every possible solution i could find i tried configuring the neo4j.conf file, it was said to comment out this line

    dbms.directories.import=import
i did and after this it was said to allow the external files although my files were not external they were already in remote anyways i did by this

    dbms.security.allow_csv_import_from_file_urls=true
I did that too, nothing seems to work please let me know if something works out 

",1610478972,https://stackoverflow.com/q/65690563,Cinya,"['cypher', 'python', 'neo4j', 'py2neo']"
65687157,LIMIT not working inside apoc procedure apoc.cypher.run,"I am trying to run following Neo4j cypher Query:

    MATCH (m:Person { id: &#39;$id&#39;})-[:FOLLOWS]-&gt;(f:Person) 
    CALL apoc.cypher.run(&#39;WITH {f} as f 
    MATCH (f)-[:HAS_ACTIVITY]-&gt;(la:Activity)-[:NEXT*0..]-&gt;(act:Activity)
    RETURN act LIMIT 10&#39;, {f:f}) YIELD value
    WITH value.act as act, f 
    MATCH (act:Activity)-[:HAS_OBJECT]-&gt;(obj:MediaItem) WHERE NOT(obj.readPermission=&#39;PUBLIC&#39;)
    OPTIONAL MATCH (act)-[:HAS_TARGET]-&gt;(t:Person) with act,f,obj,t 
    WHERE t is null or not labels(t) in [&#39;Group&#39;] with act.aggregationId as agg, 
    act.aggregationType as aggType,collect({ activity : act, object : obj, target : t}) as
    aggregationActivity,collect(act) as aggregationActivity1,collect(distinct f) as friendlist 
    WITH agg,aggType,aggregationActivity,friendlist,head(aggregationActivity1) as 
    a1 OPTIONAL MATCH (ow:Person {id:a1.ownerId}) 
    RETURN agg,ow,friendlist, a1.published as x, aggregationActivity

In the above query, I am trying to filter out first 10 activities inside APOC procedure(ref: https://neo4j.com/developer/kb/limiting-match-results-per-row/) so that the remaining execution happens on the relevant results. But the **value** yielded from APOC procedure is having more than 10 results. How can I get LIMIT working inside my APOC procedure.
Neo4j Version: 3.0.6
APOC Procedure version: 3.0.8.6

Please find attached PROFILE and EXPLAIN screenshot:
[PROFILE][1] [EXPLAIN][2]


  [1]: https://i.stack.imgur.com/mzy4n.png
  [2]: https://i.stack.imgur.com/GOZ8D.png",1610466045,https://stackoverflow.com/q/65687157,Gautam kapoor,"['cypher', 'neo4j', 'neo4j-apoc']"
65686699,Neomodel: specify neo4j database name in connection string,"In the neomodel documentation it&#39;s possible to specify the neo4j connection string using the following statement:

```python
from neomodel import config
config.DATABASE_URL = &#39;bolt://neo4j:neo4j@localhost:7687&#39;
```
On neo4j 4.1, I am using multiple databases under the same server. I would like to specify the database I am using either in the connection string or somewhere else.

In py2neo I can do something like this:
```python
graph = Graph(host=&#39;localhost&#39;, port=7687, auth=(&#39;neo4j&#39;,&#39;pwd&#39;), name=&#39;dbname&#39;)
```
Is there any way to do this in neomodel?",1610464408,https://stackoverflow.com/q/65686699,nolio,"['neomodel', 'neo4j', 'python']"
65683749,Neo4j ETL takes time to migrate from RDBMS to Graph,"Trying the option of going with ETL as in Production we would like to use this option but once I start connecting my RDBMS to Graph as mentioned in the link https://neo4j.com/labs/etl-tool, it is taking a lot of time as below:

[![enter image description here][1]][1]

Firstly, the goal is to create a POC for ProductSales correlation, the current dataset I am having has 175000 rows(can reduce the size) from two tables. Once we know that it works then we look more into this. What would you recommend to get the graph for this?


  [1]: https://i.stack.imgur.com/lEtFx.png",1610453640,https://stackoverflow.com/q/65683749,Samir Kurry,"['cypher', 'neo4j']"
65682935,Cypher to show relationships of hidden nodes,"I’m a total beginner in Cypher and I’m struggling to obtain the result I want.

So I have nodes that all have a property called &#171;&#160;level&#160;&#187;. I want to keep only a certain level, but I want to recreate the missing links.

Here is my dataset:

[![enter image description here][1]][1]



in CSV:

    n
    &quot;{owner:Team A,name:MySubscription,level:1}&quot;
    &quot;{name:Database,level:2}&quot;
    &quot;{owner:Team A,name:Service A,level:3}&quot;
    &quot;{owner:Team A,name:MyTopic,level:2}&quot;
    &quot;{name:Service B,level:3}&quot;
    &quot;{name:Service C,level:3}&quot;
    &quot;{name:MySecret,level:1}&quot;

I want to keep only the nodes that are `level &gt;= 2` but I want to recreate the links like so:

[![enter image description here][2]][2]

Could you help me create the query that does just this?


  [1]: https://i.stack.imgur.com/khZ1D.png
  [2]: https://i.stack.imgur.com/b5FMh.png",1610450516,https://stackoverflow.com/q/65682935,DoubleMiP,"['neo4j', 'graph', 'cypher']"
65678587,Could not open Neo4j Session for transaction; nested exception is org.neo4j.ogm.exception.ConnectionException: Could not create driver instance,"I am facing this issue while running the spring boot project having database in neo4j.

***Could not open Neo4j Session for transaction; nested exception is rg.neo4j.ogm.exception.ConnectionException: Could not create driver instance***


This is the error in the console:

***Caused by: java.lang.ClassNotFoundException: org.neo4j.ogm.driver.ExceptionTranslator
	at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:606) ~[na:na]
	at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:168) ~[na:na]***


What can be done to resolve this issue?",1610430345,https://stackoverflow.com/q/65678587,Shreya,"['spring', 'spring-boot', 'rest', 'java', 'neo4j']"
65676685,Using DASK to read files and write to NEO4J in PYTHON,"I am having trouble parallelizing code that reads some files and writes to neo4j. 

 - I am using dask to parallelize the **process_language_files** function (3rd cell from the bottom). 
 - I try to explain the code below, listing out the functions (First 3 cells).
 - The errors are printed at the end (Last 2 cells).
 - I am also listing environments and package versions at the end.

If I remove dask.delayed and run this code sequentially, its works perfectly well. 

Thank you for your help. :)

==========================================================================

Some functions to work with neo4j.
```python
from neo4j import GraphDatabase
from tqdm import tqdm

def get_driver(uri_scheme=&#39;bolt&#39;, host=&#39;localhost&#39;, port=&#39;7687&#39;, username=&#39;neo4j&#39;, password=&#39;&#39;):
&quot;&quot;&quot;Get a neo4j driver.&quot;&quot;&quot;
    connection_uri = &quot;{uri_scheme}://{host}:{port}&quot;.format(uri_scheme=uri_scheme, host=host, port=port)
    auth = (username, password)
    driver = GraphDatabase.driver(connection_uri, auth=auth)
    return driver

def format_raw_res(raw_res):
&quot;&quot;&quot;Parse neo4j results&quot;&quot;&quot;
    res = []
    for r in raw_res:
        res.append(r)
    return res

def run_bulk_query(query_list, driver):
&quot;&quot;&quot;Run a list of neo4j queries in a session.&quot;&quot;&quot;
    results = []
    with driver.session() as session:
        for query in tqdm(query_list):
            raw_res = session.run(query)
            res = format_raw_res(raw_res)
            results.append({&#39;query&#39;:query, &#39;result&#39;:res})
    return results

global_driver = get_driver(uri_scheme=&#39;bolt&#39;, host=&#39;localhost&#39;, port=&#39;8687&#39;, username=&#39;neo4j&#39;, password=&#39;abc123&#39;)  # neo4j driver object.=

```

This is how we create a dask client to parallelize.
```python
from dask.distributed import Client
client = Client(threads_per_worker=4, n_workers=1)
```

The functions that the main code is calling.
```python
import sys
import time
import json

import pandas as pd

import dask

def add_nodes(nodes_list, language_code):
&quot;&quot;&quot;Returns a list of strings. Each string is a cypher query to add a node to neo4j.&quot;&quot;&quot;
    list_of_create_strings = []
    create_string_template = &quot;&quot;&quot;CREATE (:LABEL {{node_id:{node_id}}})&quot;&quot;&quot;

    for index, node in nodes_list.iterrows():
        create_string = create_string_template.format(node_id=node[&#39;new_id&#39;])
        list_of_create_strings.append(create_string)

    return list_of_create_strings
        
def add_relations(relations_list, language_code):
&quot;&quot;&quot;Returns a list of strings. Each string is a cypher query to add a relationship to neo4j.&quot;&quot;&quot;
    list_of_create_strings = []
    create_string_template = &quot;&quot;&quot;
        MATCH (a),(b) WHERE a.node_id = {source} AND b.node_id = {target} 
        MERGE (a)-[r:KNOWS {{ relationship_id:{edge_id} }}]-(b)&quot;&quot;&quot;

    for index, relations in relations_list.iterrows():
        create_string = create_string_template.format(
            source=relations[&#39;from&#39;], target=relations[&#39;to&#39;],
            edge_id=&#39;&#39;+str(relations[&#39;from&#39;])+&#39;-&#39;+str(relations[&#39;to&#39;]))
        list_of_create_strings.append(create_string)

    return list_of_create_strings


def add_data(language_code, edges, features, targets, driver):
&quot;&quot;&quot;Add nodes and relationships to neo4j&quot;&quot;&quot;
    add_nodes_cypher = add_nodes(targets, language_code)  # Returns a list of strings. Each string is a cypher query to add a node to neo4j.
    node_results = run_bulk_query(add_nodes_cypher, driver)  # Runs each string in the above list in a neo4j session.


    add_relations_cypher = add_relations(edges, language_code)  # Returns a list of strings. Each string is a cypher query to add a relationship to neo4j.
    relations_results = run_bulk_query(add_relations_cypher, driver)  # Runs each string in the above list in a neo4j session.    
    
    # Saving some metadata
    results = {
        &quot;nodes&quot;: {&quot;results&quot;: node_results, &quot;length&quot;:len(add_nodes_cypher),}, 
        &quot;relations&quot;: {&quot;results&quot;: relations_results, &quot;length&quot;:len(add_relations_cypher),}, 
    }
    return results


def load_data(language_code):
&quot;&quot;&quot;Load data from files&quot;&quot;&quot;
    # Saving file names to variables
    edges_filename = &#39;./edges.csv&#39;
    features_filename = &#39;./features.json&#39;
    target_filename = &#39;./target.csv&#39;
    
    # Loading data from the file names
    edges = helper.read_csv(edges_filename)
    features = helper.read_json(features_filename)
    targets = helper.read_csv(target_filename)
    
    # Saving some metadata
    results = {
        &quot;edges&quot;: {&quot;length&quot;:len(edges),}, 
        &quot;features&quot;: {&quot;length&quot;:len(features),}, 
        &quot;targets&quot;: {&quot;length&quot;:len(targets),},
    }
    return edges, features, targets, results
```

The main code.
```python
def process_language_files(process_language_files, driver):
&quot;&quot;&quot;Reads files, creates cypher queries to add nodes and relationships, runs cypher query in a neo4j session.&quot;&quot;&quot;
    edges, features, targets, reading_results = load_data(language_code)  # Read files.

    writing_results = add_data(language_code, edges, features, targets, driver)  # Convert files nodes and relationships and add to neo4j in a neo4j session.
    
    return {&quot;reading_results&quot;: reading_results, &quot;writing_results&quot;: writing_results}  # Return some metadata


# Execution starts here
res=[]
for index, language_code in enumerate([&#39;ENGLISH&#39;, &#39;FRENCH&#39;]):
    
    lazy_result = dask.delayed(process_language_files)(language_code, global_driver)
    res.append(lazy_result)
```

Result from res. These are dask delayed objects.
```python
print(*res)
Delayed(&#39;process_language_files-a73f4a9d-6ffa-4295-8803-7fe09849c068&#39;) Delayed(&#39;process_language_files-c88fbd4f-e8c1-40c0-b143-eda41a209862&#39;)
```

The errors. Even if use dask.compute(), I am getting similar errors.
```python
futures = dask.persist(*res)
AttributeError                            Traceback (most recent call last)
~/Code/miniconda3/envs/MVDS/lib/python3.6/site-packages/distributed/protocol/pickle.py in dumps(x, buffer_callback, protocol)
     48         buffers.clear()
---&gt; 49         result = pickle.dumps(x, **dump_kwargs)
     50         if len(result) &lt; 1000:

AttributeError: Can&#39;t pickle local object &#39;BoltPool.open.&lt;locals&gt;.opener
```

==========================================================================

|# Name                 |Version          |         Build  |Channel      |
|-----------------------|-----------------|----------------|-------------|
|dask                   |2020.12.0        |  pyhd8ed1ab_0  |  conda-forge|
|jupyterlab             |3.0.3            |  pyhd8ed1ab_0  |  conda-forge|
|neo4j-python-driver    |4.2.1            |  pyh7fcb38b_0  |  conda-forge|
|python                 |3.9.1            |    hdb3f193_2  |             |
",1610413673,https://stackoverflow.com/q/65676685,Vaibhav yB Shah,"['dask', 'dask-delayed', 'neo4j', 'python-3.9', 'dask-distributed']"
65669613,How do I return relationship properties (Neo4j + Spring data)?,"# Project Details

I am following along with these docs [Spring Data Neo4j][2] using Kotlin and I am struggling to return the relationship from a repository query:

**Database layout**

I have a `User` node and an `Skill` node with the following relationship:

[![enter image description here][1]][1]

**Entities**

Skill
```Kotlin
@Node
data class Skill(
        @Id
        val uid: UUID,

        val title: String,
) {

    constructor(title: String) : this(UidGenerator.makeOne(), title)

}
```

User
```Kotlin
@Node
data class User(
        @Id
        var uid: UUID,

        @Relationship(type = &quot;DEMONSTRATES&quot;)
        val demonstrates: List&lt;Demonstrates&gt;,

        val firstName: String,
        val lastName: String,
) {

    constructor(demonstrates: List&lt;Demonstrates&gt;, firstName: String, lastName: String)
            : this(UidGenerator.makeOne(), demonstrates, firstName, lastName)

}
```

**Relationship Properties**

```Kotlin
@RelationshipProperties
data class Demonstrates(
        @TargetNode
        val skill: Skill,

        val rating: Int,
)
```

# The Problem I am having

When I inject the following repository and call the `getDemonstrationList` I am getting the error that follows.

```Kotlin
@Repository
interface MyRepository : Neo4jRepository&lt;Skill, UUID&gt; {

    @Query(&quot;&quot;&quot;
        MATCH (:User)-[d:DEMONSTRATES]-&gt;(:Skill) RETURN d
    &quot;&quot;&quot;)
    fun getDemonstrationList(): List&lt;Demonstrates&gt;

}
```

```
Caused by: org.springframework.data.neo4j.core.mapping.NoRootNodeMappingException: Could not find mappable nodes or relationships inside Record&lt;{d: relationship&lt;4&gt;}&gt; for org.springframework.data.neo4j.core.mapping.DefaultNeo4jPersistentEntity@750a04ec
	at org.springframework.data.neo4j.core.mapping.DefaultNeo4jEntityConverter.read(DefaultNeo4jEntityConverter.java:106) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.neo4j.core.mapping.DefaultNeo4jEntityConverter.read(DefaultNeo4jEntityConverter.java:67) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.neo4j.core.mapping.Schema.lambda$getRequiredMappingFunctionFor$0(Schema.java:96) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.neo4j.repository.query.Neo4jQuerySupport.lambda$getMappingFunction$0(Neo4jQuerySupport.java:105) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.neo4j.core.PreparedQuery$AggregatingMappingFunction.apply(PreparedQuery.java:218) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.neo4j.core.PreparedQuery$AggregatingMappingFunction.apply(PreparedQuery.java:154) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.neo4j.core.DelegatingMappingFunctionWithNullCheck.apply(DelegatingMappingFunctionWithNullCheck.java:45) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.neo4j.core.DelegatingMappingFunctionWithNullCheck.apply(DelegatingMappingFunctionWithNullCheck.java:35) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.neo4j.core.DefaultNeo4jClient$DefaultRecordFetchSpec.lambda$partialMappingFunction$0(DefaultNeo4jClient.java:325) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:195) ~[na:na]
	at java.base/java.util.Iterator.forEachRemaining(Iterator.java:133) ~[na:na]
	at java.base/java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801) ~[na:na]
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484) ~[na:na]
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474) ~[na:na]
	at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:913) ~[na:na]
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) ~[na:na]
	at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:578) ~[na:na]
	at org.springframework.data.neo4j.core.DefaultNeo4jClient$DefaultRecordFetchSpec.all(DefaultNeo4jClient.java:312) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.neo4j.core.Neo4jTemplate$DefaultExecutableQuery.getResults(Neo4jTemplate.java:575) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.neo4j.repository.query.Neo4jQueryExecution$DefaultQueryExecution.execute(Neo4jQueryExecution.java:51) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.neo4j.repository.query.AbstractNeo4jQuery.execute(AbstractNeo4jQuery.java:85) ~[spring-data-neo4j-6.0.2.jar:6.0.2]
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:137) ~[spring-data-commons-2.4.2.jar:2.4.2]
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:121) ~[spring-data-commons-2.4.2.jar:2.4.2]
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:152) ~[spring-data-commons-2.4.2.jar:2.4.2]
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:131) ~[spring-data-commons-2.4.2.jar:2.4.2]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.2.jar:5.3.2]
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:80) ~[spring-data-commons-2.4.2.jar:2.4.2]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.2.jar:5.3.2]
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123) ~[spring-tx-5.3.2.jar:5.3.2]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:388) ~[spring-tx-5.3.2.jar:5.3.2]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-5.3.2.jar:5.3.2]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.2.jar:5.3.2]
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137) ~[spring-tx-5.3.2.jar:5.3.2]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.2.jar:5.3.2]
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97) ~[spring-aop-5.3.2.jar:5.3.2]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.2.jar:5.3.2]
	at org.springframework.data.repository.core.support.MethodInvocationValidator.invoke(MethodInvocationValidator.java:98) ~[spring-data-commons-2.4.2.jar:2.4.2]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.2.jar:5.3.2]
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:215) ~[spring-aop-5.3.2.jar:5.3.2]
	at com.sun.proxy.$Proxy68.getDemonstrationIds(Unknown Source) ~[na:na]
	at com.ntr.neo4j.Neo4jApplication.run(Neo4jApplication.kt:44) ~[classes/:na]
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:804) ~[spring-boot-2.4.1.jar:2.4.1]
	... 5 common frames omitted
```

# My question

I am pretty new to Kotlin and Neo4j but I do understand the Spring framework. From what I understand, the repository is not able to workout that it needs to create a `Demonstrates` instance list out of the result of my query. I am interested in getting the `rating` property off the relationship but the tutorial is not really clear on how I can do that. Please let me know what I am missing in order to get my query to return a list of `Demonstrates`?


  [1]: https://i.stack.imgur.com/nIKbw.png
  [2]: https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#reference",1610378537,https://stackoverflow.com/q/65669613,Nicholas Robinson,"['neo4j', 'kotlin', 'spring-data-neo4j', 'spring-data', 'java']"
65668303,Store user name and password with neo4j connection string,"What is the format (if any) for adding user name and password to neo4j v4 connection strings? So far, I&#39;ve seen just examples like ```bolt://localhost:7010``` with authentication being added as extra arguments to the connection calls.

Here&#39;s why I&#39;m asking:

I have an ASP.NET app which connects to both MS SQL and neo4j DBs. For MS SQL, I can add the connection string to the ```/configuration/connectionStrings``` in web.config formatted like this

``` &lt;add name=&quot;MyDB&quot; connectionString=&quot;Data Source=.\SQLEXPRESS;Initial Catalog=MyDB;UID=user;PWD=pwd&quot; /&gt;```

or

``` &lt;add name=&quot;MyDB&quot; connectionString=&quot;Data Source=.,1433;Initial Catalog=MyDB;UID=user;PWD=pwd&quot; /&gt;```


It contains host name, instance name or port name, plus the credentials. I can then encrypt the connectionStrings part of web.config using standard IIS tools. 

For ease of management, I&#39;d like to reuse it for neo4j connection strings as well. I could store the string in MSSQL-like format
``` &lt;add name=&quot;MyNeo4jDB&quot; connectionString=&quot;Data Source=.,7010;UID=user;PWD=pwd&quot; /&gt;```
but I don&#39;t want to invent my own format.

Thanks",1610373712,https://stackoverflow.com/q/65668303,Bolek,['neo4j']
65653283,GraphQL &amp; Neo4j : how to modify a property with a mutation request?,"I have article nodes in a Neo4j database. One of his property is a boolean: &quot;saved: false&quot;.
The property name of this node is &quot;saved&quot;.

I have a React interface where I want users to be able to save articles as favorites.
So what I would like to do is change the property &quot;saved&quot; to true when they want to save an article or set to false when they want to cancel the favorite.

This process can be done with a graphql request but I don&#39;t know how to write my request to modify a node property.

Example: The user wants to save the article with id = 1, so he clicks on the button &quot;favorite&quot; and the article node property id = 1 and the node property &quot;saved&quot; goes from false to true.

I just want to update a node property, like this I think:

    type Mutations {
        saved(article:ID! director:ID!) : ??? (string ?)
          @cypher(statement:&quot;MATCH (a:Article {id: $id, saved:$saved})
                             SET a.saved += true &quot;)
    }
    schema {
       mutations: Mutations
    }

How can I do it ?

",1610281810,https://stackoverflow.com/q/65653283,jos97,"['graphql', 'neo4j', 'grandstack']"
69176618,Simulate a MERGE in Neptune&#39;s OpenCypher implementation,"I&#39;m trying to run a `MERGE` query against an AWS Neptune database using their [new OpenCypher implementation](https://aws.amazon.com/about-aws/whats-new/2021/07/amazon-neptune-supports-opencypher/) but `MERGE` is [not yet supported as a clause](https://docs.aws.amazon.com/neptune/latest/userguide/access-graph-opencypher-limitations.html).

Is there a way to get the behaviour of a `MERGE` without using a `MERGE` in Neptune&#39;s OpenCypher implementation?

I&#39;m hoping it&#39;s possible to do something like:

```
MATCH (ee:Person {name: &quot;Sam&quot;})

IF ee IS NULL THEN
  CREATE ...
ELSE
  SET ee += {...}
END
```

Obviously this is just pseudocode, but is there any way of achieving this behaviour without handling it in the application making the call?",1631617652,https://stackoverflow.com/q/69176618,Sam Martin,"['amazon-web-services', 'amazon-neptune', 'cypher']"
69173123,Cypher chain query and pruning,"I have a complex cypher query that needs pruning.

This is a simple example
```sql
MATCH (n0) WHERE ID(n0) = 50
CALL {
    WITH n0
    MATCH (n0)-[r0*1]-(n1)
    RETURN n1 AS ns, r0 AS rs LIMIT 5
UNION ALL
    MATCH (n1)-[r1*1]-(n2)
    RETURN n2 AS ns, r1 AS rs LIMIT 5
}
RETURN collect(ns)+n0 AS nss
```
After executing the first match(`MATCH (n0)-[r0*1]-(n1)`) in the subquery and returning, I want to use the result `n1` returned by the first match as the starting nodes for the second match(`MATCH (n1)-[r1*1]-(n2)`)

But in the second match, the result returned by the first match cannot be obtained.",1631602476,https://stackoverflow.com/q/69173123,qqqqDonl,['cypher']
69162801,Cypher: start (and end) with multiple nodes,"I use Cypher in rglobi, a module in R to interact with globalbioticinteraction (aka GLOBI).
I have a list of insect species from a monitor.
I need to find out how the species found interact.
I give an example with only two species for example

    &quot;START sourceTaxon = node:taxons(name=(&#39;Ablerus celsus&#39; OR &#39;Anagrus atomus&#39;)),targetTaxon = node:taxons(name=(&#39;Ablerus celsus&#39; OR &#39;Anagrus atomus&#39;)) MATCH sourceTaxon&lt;-[:CLASSIFIED_AS]-source-[rel:EATEN_BY|HAS_PARASITE]-&gt;target-[:CLASSIFIED_AS]-&gt;targetTaxon RETURN distinct(targetTaxon.name),type(rel),sourceTaxon.name&quot;
",1631536561,https://stackoverflow.com/q/69162801,Enrico Gabrielli,['cypher']
69107029,Cypher set a property to the sum of the properties of distinct nodes,"I&#39;m trying to sum up the property df of all descendents and set it as a new property. I need to use the distinct clause, so that I do not sum up the same value several times. The sum function cannot be used with the SET clause.

    MATCH (n:Ontology)&lt;-[:isA*0..13]-(m:Ontology)
    WITH distinct m AS terms, n AS model
    SET model.DF = sum(model.df)
    RETURN model.id, model.DF
The only way I could manage to use the sum function is within the WHERE clause but not in combination with the distinct.

    MATCH (n:Ontology)&lt;-[:isA*0..13]-(m:Ontology)
    WITH n AS model, sum(m.df) AS DF
    SET model.DF= DF
    RETURN model.id, model.DF
Is there a way to first use distinct and then set the new property to the sum?",1631120110,https://stackoverflow.com/q/69107029,user16862406,"['distinct', 'sum', 'set', 'cypher']"
69017229,Cypher - Add multiple connections,"I have 2 nodes:

Students   and Subjects.

I want to be able to add multiple student names to multiple subjects at the same time using cypher query.
So far I have done it by iterating through the list of names of students and subjects and executing the query for each. but is there a way to do the same in the query itself?

This is the query I use for adding 1 student to 1 subject:

     MATCH 
     (s:Student)-[:STUDENT_BELONGS_TO]-&gt;(c:Classroom),
     (u:Subjects)-[:SUBJECTS_TAUGHT_IN]-&gt;(c:Classroom)
      WHERE
       s.id = ${&quot;$&quot;}studentId
       AND c.id = ${&quot;$&quot;}classroomId
       AND u.name = ${&quot;$&quot;}subjectNames
       AND NOT (s)-[:IN_SUBJECT]-&gt;(u)
       CREATE (s)-[:IN_SUBJECT]-&gt;(u)

So I want to be able to receive multiple subjectNames and studentIds at once to create these connections. Any guidance for multi relationships in cypher ?",1630512324,https://stackoverflow.com/q/69017229,StephM,['cypher']
68991944,Convert gremlin query to cypher query,"In the gremlin query, use id to query the neighbor nodes of the current node and make some restrictions, for example, limit the number of neighbor nodes to 4, and the search distance is 1-4
```
g.V(2)
.store(&quot;v&quot;)
.repeat(
    bothE()
    .limit(4)
    .store(&quot;e&quot;)
    .subgraph(&quot;sg&quot;)
    .otherV()
    .store(&quot;v&quot;))
.times(4)
.cap(&quot;v&quot;)
.unfold()
```
I converted it into a cypher query
```
match (n) where id(n) = 2
return n as v, null as e
union all
unwind range(1, 4) as _
CALL {
    optional match p=(v)-[r]-(m)
    with *, count(p) as psz where psz &gt; 5
    with nodes(p) as v, relationships(p) as e
    return v, e
}

return v, e
```
Only the node with id 2 in the returned result.",1630373902,https://stackoverflow.com/q/68991944,qqqqDonl,"['gremlin', 'cypher']"
68940714,Cypher query for gremlin traversal,"New to cypher query 
```
g.V().has(&#39;Entity1&#39;,&#39;id&#39;,within(id1)).in(&#39;Entity2&#39;).
where(__.out(&#39;Entity3&#39;).where(__.out(&#39;Entity4&#39;).has(&#39;name&#39;,within(name))))

```

how to convert the above gremlin to cypher and return adjacent Entity2 invertex.

Here condition is 
out(&#39;Entity3&#39;) should be out of Entity2
out(&#39;Entity4&#39;) should be out of Entity3 and name in the provided list of values 

Return adjacent vertex of inEntity2",1629989158,https://stackoverflow.com/q/68940714,HashDhi,"['cypher', 'gremlin']"
68720658,openCypher client for AWS Neptune,"I&#39;m looking for a graph exploration tool similar to &lt;https://github.com/prabushitha/gremlin-visualizer&gt; for querying AWS Neptune while using openCypher to enjoy the new offering:  
 &lt;https://aws.amazon.com/blogs/database/announcing-opencypher-for-amazon-neptune-building-better-graph-applications-with-opencypher-and-gremlin-together/&gt;.  
I&#39;m familiar with the Jupyter notebook &lt;https://github.com/aws/graph-notebook&gt; but I&#39;m looking for other alternatives.",1628565154,https://stackoverflow.com/q/68720658,Avner Levy,"['cypher', 'amazon-neptune']"
68713891,nodejs recover createCipher data with createCipheriv,"I have some encrypted data in my database

I did it few years ago using `crypto.createCipher`

```
const cipher = crypto.createCipher(&#39;aes192&#39;, password);
```

As `createCipher` and `createDecipher` is deprecated, I would like to change to `createCipheriv` and `createDecipheriv`. The problem is that the data I have in my database are encoded without iv.
Is it possible to decode with `createDecipheriv` data encoded with `createDecipher` and to generate the same secret with `createCipher` and `createCipheriv`.

I tried setting the iv to `null` but not working

Thanks, because the database migration is an heavy work !",1628519534,https://stackoverflow.com/q/68713891,Ajouve,"['node.js', 'cypher']"
68644413,azure cosmos gremlin select column,"My object to display property name like select or ValueMap (&#39;Name&#39;); not want want to display all Column . want selected columns ( Azure cosmos Gremlin API)



Gremlin code :

        g.addV(&quot;company&quot;).property(&quot;id&quot;, &quot;1&quot;).property(&quot;pKey&quot;, &quot;Sales&quot;).property(&quot;Name&quot;, &#39;Sams&#39;).property(&quot;City&quot;, &#39;NY&#39;)
      .addV(&quot;company&quot;).property(&quot;id&quot;, &quot;2&quot;).property(&quot;pKey&quot;, &quot;Sales&quot;).property(&quot;Name&quot;, &#39;Target&#39;).property(&quot;City&quot;, &#39;NJ&#39;)
      .addV(&quot;company&quot;).property(&quot;id&quot;, &quot;3&quot;).property(&quot;pKey&quot;, &quot;Sales&quot;).property(&quot;Name&quot;, &#39;Target&#39;).property(&quot;City&quot;, &#39;NJ&#39;)
      .addV(&quot;company&quot;).property(&quot;id&quot;, &quot;4&quot;).property(&quot;pKey&quot;, &quot;Sales&quot;).property(&quot;Name&quot;, &#39;Walmart&#39;).property(&quot;City&quot;, &#39;NJ&#39;)
      .addV(&quot;company&quot;).property(&quot;id&quot;, &quot;5&quot;).property(&quot;pKey&quot;, &quot;Sales&quot;).property(&quot;Name&quot;, &#39;Macys&#39;).property(&quot;City&quot;, &#39;NJ&#39;)
      .addV(&quot;company&quot;).property(&quot;id&quot;, &quot;6&quot;).property(&quot;pKey&quot;, &quot;Sales&quot;).property(&quot;Name&quot;, &#39;Walmart&#39;).property(&quot;City&quot;, &#39;NJ&#39;)

Final query 

       g.V().hasLabel(&#39;company&#39;).has(&#39;pKey&#39;  , &#39;Sales&#39;).order().by(&quot;id&quot;, decr)
    .as(&#39;a&#39;).group().by(&#39;Name&#39;).unfold().where(select(values).count(local).is(gt(1))).as(&#39;b&#39;)


",1628040736,https://stackoverflow.com/q/68644413,user16529217,"['azure', 'cypher', 'gremlin', 'azure-cosmosdb']"
68621778,Cypher numerical index and query on array property,"Is it possible to index integers in an array property in Cypher and have that index used effectively in queries?

For example if vertices have an array property t with integer values, would it be possible to query nodes where property t has any entry in some range, for example any x &lt; t &lt; y, and have that query supported by an index on the array?",1627908062,https://stackoverflow.com/q/68621778,Greg,"['indexing', 'cypher']"
68576410,Dom Traversal with lxml and save their relashionship into a Key/Value Pair Cypher Query,"Considering the following html, 

    &lt;body&gt;
      &lt;div id=&quot;wrapper&quot;&gt;
        &lt;div id=&quot;header&quot;&gt;
          &lt;h1&gt;Logo&lt;/h1&gt;
          &lt;div id=&quot;nav&quot;&gt;
            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;&quot;&gt;Products&lt;/a&gt;&lt;/li&gt;            
            &lt;/ul&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div id=&quot;content&quot;&gt;
          &lt;div id=&quot;feature&quot;&gt;
            &lt;p&gt;Feature&lt;/p&gt;
          &lt;/div&gt;
          &lt;div class=&quot;article column1&quot;&gt;
            &lt;p&gt;Column One&lt;/p&gt;
          &lt;/div&gt;
          &lt;div class=&quot;article column2&quot;&gt;
            &lt;p&gt;Column Two&lt;/p&gt;
          &lt;/div&gt;
          &lt;div class=&quot;article column3&quot;&gt;
            &lt;p&gt;Column Three&lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div id=&quot;footer&quot;&gt;
          &lt;p&gt;&amp;copy; Copyright 2011&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/body&gt;

I would like to traverse each nodes of the Dom tree and save them nodes alongside with their relationships into a Key-Value Pair Cypher statement which would be inserted into a graph database. My Cypher statement is on the following format  

    dom_nodes = {:tree {tag: node.tag, class: node.get(class), text: node.text}

The edges holding the relationship are in the following format: A vertex depicting the child and the parent node linked by their relationship edge.  

    edges = (p:tree {tag: node.tag}),(k:tree{tag: node.tag}) CREATE (p)-[:relation_of]-(k)&quot;

looking at `(p)-[:element_of]-&gt;(k)` illustrate the relationship between the 2 nodes. i.e 
`div,` a container relation where `h1`  resides. 

Using Lxml and xpath, I have been able to ran an iteration, but I just noticed I need a recursion, 

    from lxml import etree
      from lxml import html 
      root = html.parse(&quot;about.html&quot;)
      body = root.xpath(&quot;/html/body&quot;)
      for t in body:    
        for b in t.xpath(&quot;div&quot;):
           print(&quot;===============================&quot;)
           d = b.xpath(&quot;descendant::*&quot;)
           for e in d:
             print(e.attrib)
             print(e.text)

This is the alternate function which can perform a recursion with my limited knowledge, unfortunately, I cannot run with it. 

     def node_fetch(node):
        kids = [{&#39;tag&#39;: child.tag, &#39;class&#39; : child.get(&quot;class&quot;), &quot;node_id&quot; : child.get(&quot;id&quot;), &quot;text&quot; : child.text.strip() if child.text else &quot;&quot;, &#39;children&#39;: node_fetch(child)} for child in node]
        return kids

How do I properly build the recursive function to be able to process the Key/Value pair relationship edge and Vertices ? ",1627563645,https://stackoverflow.com/q/68576410,alexander,"['xpath', 'python-3.x', 'cypher', 'lxml', 'graph']"
68572546,GraphDB - 1 vertex having multiple properties,"Could you please help me understand if we can have multiple array properties in 1 vertex.. For example, 

```
   &quot;id&quot;: &quot;CU10611973PH&quot;,
    &quot;label&quot;: &quot;Phone-Home&quot;,
    &quot;type&quot;: &quot;vertex&quot;,
    &quot;properties&quot;: {
      &quot;PhonePreference&quot;: [
        {
          &quot;id&quot;: &quot;c63cf5c9-329b-456e-b94e-0c500587780f&quot;,
          &quot;value&quot;: &quot;Primary&quot;
        }
      ],
      &quot;PhoneType&quot;: [
        {
          &quot;id&quot;: &quot;11f241d8-8e84-479b-b6a4-aeab7e039665&quot;,
          &quot;value&quot;: &quot;Home&quot;
        }
      ],
      &quot;PhoneNumber&quot;: [
        {
          &quot;id&quot;: &quot;5795e2ec-6d8c-424c-b42d-f01b587caeca&quot;,
          &quot;value&quot;: &quot;22222222222&quot;
        }
      ],
      &quot;pk&quot;: [
        {
          &quot;id&quot;: &quot;CU10611973PH|pk&quot;,
          &quot;value&quot;: &quot;pk&quot;
        }
      ]
    }
  },
  {
    &quot;id&quot;: &quot;CU10611973PC&quot;,
    &quot;label&quot;: &quot;Phone-cell&quot;,
    &quot;type&quot;: &quot;vertex&quot;,
    &quot;properties&quot;: {
      &quot;PhonePreference&quot;: [
        {
          &quot;id&quot;: &quot;488c54b2-f256-4053-adc5-c07ec2e1a629&quot;,
          &quot;value&quot;: &quot;Primary&quot;
        }
      ],
      &quot;PhoneType&quot;: [
        {
          &quot;id&quot;: &quot;2f5263e7-f42b-487f-a185-338682a68fdd&quot;,
          &quot;value&quot;: &quot;Cell&quot;
        }
      ],
      &quot;PhoneNumber&quot;: [
        {
          &quot;id&quot;: &quot;a967516d-986c-4eac-929a-b86824677922&quot;,
          &quot;value&quot;: &quot;123456789&quot;
        }
      ],
      &quot;pk&quot;: [
        {
          &quot;id&quot;: &quot;CU10611973PC|pk&quot;,
          &quot;value&quot;: &quot;pk&quot;

```

So here we are having 2 vertex, one for Phone-Home and one for Phone-Cell. Is there a way to make it come under 1 vertex with 2 set of properties .",1627547086,https://stackoverflow.com/q/68572546,Sneha Nair,"['azure-cosmosdb-gremlinapi', 'graph-databases', 'cypher', 'gremlin']"
68567648,When building a springboot app it fails with &quot;No decryption for FailsafeTextEncryptor. Did you configure the keystore correctly?&quot;,"I&#39;m running a springboot application it&#39;s got secret keys and access keys that are encrypted using the config server. The decryption works fine at runtime, however when building the application there are unit tests that are running and they fail because of failed decryption (when i remove cypher and put plain text keys this works fine). Is it possible to access the config server and decrypt the keys at build time?",1627508391,https://stackoverflow.com/q/68567648,Cliford Mlotshwa,"['spring', 'spring-cloud', 'cypher', 'encryption', 'spring-boot']"
68447620,How to reverse engineer simple checksum,"I have some hex data, of which I now the meaning (it&#39;s like time, location, ecc...):

    01 64 00 00
    01 01 01 2E
    84 88 BE 00
    00 AE 11 06
    F8 03 C3 89

Followed by a checksum/cypher:

    56 3B 87 9B

And another simple example (just the last bit is changing):

    01 64 00 00
    01 01 01 2E
    84 88 BE 00
    00 AE 11 06
    F8 03 C3 88

With the following checksum/cypher:

    DF 82 05 B3

And I have more of these examples.

Is there a way to figure out (reverse engineer) which checksum or cypher is used?
I have reasons to believe that it might be just a simple checksum or a simple cypher, nothing too fancy.

Thank you very much
",1626733432,https://stackoverflow.com/q/68447620,Lorenzo Zappa,"['reverse-engineering', 'cypher', 'checksum']"
68347381,Changing node reference in RedisGraph relationship,"I&#39;m starting to use RedisGraph and got some good support here and glad there&#39;s a community around it :)

I&#39;m currently trying to achieve a basic thing: moving a relation to a different node:

```
(bob:User {uid: 1})-[p:Paid {amount: 5, date: &quot;Feb 5 2021 10:10:05&quot;}]-&gt;(alice:User {uid: 2})
```

Bob was mistaken, he didn&#39;t pay Alice but John and would like to fix it.

```
(bob)-[p]-&gt;(john:User {uid: 3})
```

I must preserve the properties for `[p]` and ideally I would even keep the same id…

Neo4j has the `apoc.refactor.mergeNodes` function does that but I&#39;m not sure how to achieve a similar result in RedisGraph.

There seems to be a way with `SET`, `WITH` and `DELETE` but I couldn&#39;t get something grammatically correct that would work.

Any clue about that?

Thanks for sharing! :D",1626092859,https://stackoverflow.com/q/68347381,vinyll,"['redisgraph', 'cypher']"
68329545,Architecture and querying in RedisGraph,"I&#39;m new to graphs, RedisGraph and Cypher and this took me a few hours without solving.

I have users paying other users.
A payment can be deposited from a user.
Some other user can eventually withdraw that deposit, but a deposit can also never be withdrawn.

I ended up with this:

```
(u:User)-[d:Deposit]-&gt;[t:Transaction]&lt;-[w:Withdrawal]-(u:User)
```

Howerver at some point I need to find the transactions that have no Withdrawal.

My 2 questions:
- what would be a better architecture?
- even though you have a better logic, what is the way to retrieve nodes without the Withdrawal edge in the example?

Help will be very much appreciated! &#128583;&#127995;‍♂️",1625933905,https://stackoverflow.com/q/68329545,vinyll,"['redis', 'redisgraph', 'cypher', 'graph']"
68259483,Openssl generate pkcs8 key,"I want to generate pkcs8 key with openssl. I have two commands. The first one will generate the key and certificate and the second one will convert the key into pkcs8 format.

I am wondering if it is possible to do all this in a single command?


    openssl req -newkey rsa:2048 -keyout pk.key.key -x509 -days 365 -out crt.crt
    
    openssl pkcs8 -topk8 -in pk.key &gt; pkcs8.key

Thanks",1625503177,https://stackoverflow.com/q/68259483,kevin,"['openssl', 'cypher', 'key', 'certificate']"
68142675,Assigning numerical values to letters in a word,"I am new to programming. I want to slowly write a program piece by piece that codes and decodes a sentence based on Chapman&#39;s code.&lt;br /&gt;
&lt;https://1drv.ms/u/s!Ah-IzfOzjlZ_ungI4M_yjxY9_kig?e=e6Qzir&gt;&lt;br /&gt;
&lt;https://1drv.ms/u/s!Ah-IzfOzjlZ_unnDyEXct45dwu60?e=0oK49w&gt;

 
The first piece is to assign the letters of a chosen keyword &quot;CONSTANTINOPLE&quot; their respective numbers.

|C|O|N|S|T|A|N|T|I|N|O|P|L|E|
|-|-|-|-|-|-|-|-|-|-|-|-|-|-|
|2|9|6|12|13|1|7|14|4|8|10|11|5|3|

A is 1.&lt;br /&gt;
C is 2 because although it is the 3rd letter of the alphabet, there is no B in the keyword.

So far I have been able to assign the correct numbers to the letters, however, printing them out has them incorrect if there are more than 1 of that letter in the keyword.

```
word = &#39;constantinople&#39;
alphabet = &#39;abcdefghijklmnopqrstuvwxyz&#39;

count = 1
list = [None] * len(word)

for letter in alphabet:
    for char in word:        
        if letter is char:
            list[(word.index(char))] = (count+1)
            count += 1       

print(tuple(word))
print(list)
```

This results in:

```

(&#39;c&#39;, &#39;o&#39;, &#39;n&#39;, &#39;s&#39;, &#39;t&#39;, &#39;a&#39;, &#39;n&#39;, &#39;t&#39;, &#39;i&#39;, &#39;n&#39;, &#39;o&#39;, &#39;p&#39;, &#39;l&#39;, &#39;e&#39;)
[2, 10, 8, 12, 14, 1, None, None, 4, None, None, 11, 5, 3]

```
Which is close to the desired answer of&lt;br /&gt;

[2, 9, 6, 12, 13, 1, 7, 14, 4, 8, 10, 11, 5, 3] &lt;br /&gt;

The incorrect values are for repeated characters in the keyword (o,n,t). Rather than inserting them into the correct index, the value is incremented it seems.



",1624712759,https://stackoverflow.com/q/68142675,dave_m,"['arrays', 'python', 'encoder', 'cypher', 'list']"
68121032,cosmos gremlins json data ingest,"Azure Cosmos Gremlins API.

Assume Partition key - division

Germline query to add node 

    g.addV(&#39;person&#39;).
      property(&#39;firstName&#39;,&#39;Thomas&#39;).
      property(&#39;lastName&#39;, &#39;Andersen&#39;).
      property(&#39;age&#39;, 44)

How I will insert similar JSON data into cosmos from cosmos gremlin API or from python code  .Please check address has multiple row .

    persondata = {
        firstName: &#39;Thomas&#39;,
        lastName: &#39;Andersen&#39;,
        age: 44,
        Address: [
            {&quot;id&quot;: 1, &quot;city&quot;: &quot;city1&quot;, &quot;comment&quot;: &quot;something useful, I&#39;m sure&quot;},
            {&quot;id&quot;: 2, &quot;city&quot;: &quot;city2&quot;, &quot;comment&quot;: &quot;wisdom from the interwebs&quot;},
            {&quot;id&quot;: 3, &quot;city&quot;: &quot;city3&quot;, &quot;comment&quot;: &quot;.....&quot;}
        ]
    
    };
    
    g.addV(&#39;person&#39;, persondata );

similar article available -
http://5.9.10.113/59629769/how-to-insert-data-as-json-object-with-gremlin-api-in-azure-cosmos-db


In other words is it possible to ingest direct JSON data into gremlin API ( SQL API - possible)

e.g:

    {
        &quot;id&quot;: &quot;AndersenFamily&quot;,
        &quot;lastName&quot;: &quot;Andersen&quot;,
        &quot;pKey&quot;: &quot;Andersen&quot;,
      } 

 

below link for SQL APT - JSON 
https://docs.microsoft.com/en-us/azure/cosmos-db/sql-query-working-with-json

",1624559355,https://stackoverflow.com/q/68121032,Jack,"['gremlin', 'azure-cosmosdb-gremlinapi', 'azure-cosmosdb', 'cypher', 'python']"
67891550,Detect if a text encrypted using AES CBC is padded or not,"I have some data which could be encrypted using `AES/CBC/NoPadding` or `AES/CBC/PKCS5Padding`.

I want to decrypt that data. So need to decide on which algo to use for decryption. Based on the data, is it possible to figure out if the data which is encrypted is padded or not?
or is there any other solution to this?",1623171910,https://stackoverflow.com/q/67891550,DreamCoder,"['cryptography', 'encryption', 'aes', 'cypher']"
67745962,cypher-dsl java unwind a collection,"I&#39;m new to cypher-dsl java.
The problem is we need a dynamic relationship type in a query, but this isn&#39;t supported yet, nor does it work with spring spel, in the current query we have.
We decided therefore to use cypher-dsl.
I need to build a statement that uses unwind with a collection of strings and can&#39;t find a way to do it.

    &quot;MATCH (source:Browse{nodeId: $sourceId}) 
     UNWIND $destIds as destId 
     MERGE (destination:Phantom{nodeId: destId}) &quot;
The $destIds in the 2nd line is where the collection is used now, in a spring-data @Query annotation.

I&#39;d love an example or an explanation how to do that.

Thanks a lot.
",1622239996,https://stackoverflow.com/q/67745962,omer keynan,"['cypher', 'java']"
67706622,Cypher - Repeating to merge nodes until none left,"I am very new to Cypher and I have been experimenting with building graphs from CSV files.

In my current test, I am loading many relationships patterned as:
  (start)-[:Connects]-&gt;(middle)&lt;-[:Connects]-(end)
But the csv file contains lines for &quot;start-&gt;end&quot; and &quot;end-&gt;start&quot; so you end up with a double linkage.

I wanted to merge the &#39;middle&#39; nodes and found the apoc.refactir.mergeNodes command and so wrote the following to find a path that starts at a node, ends at the same node, and then merges the two middle nodes.
```
MATCH (s:start), (mid1:middle), (mid2:middle) WHERE (s)-[:CONNECTS]-&gt;(mid1)&lt;-[:CONNECTS]-()-[:CONNECTS]-&gt;(mid2)&lt;-[:CONNECTS]-(s)
WITH head(collect([mid1,mid2])) AS nodes
CALL apoc.refactor.mergeNodes(nodes,{properties:&quot;combine&quot;, mergeRels:true})
YIELD node RETURN node
```
This worked, but only merged one pair of nodes each run.

Looking for a way to repeat the operation I found the apoc.periodic.commit command which looked like it would do what I wanted.  So.

```
CALL apoc.periodic.commit(&#39;
MATCH (s:start), (mid1:middle), (mid2:middle) WHERE (s)-[:CONNECTS]-&gt;(mid1)&lt;-[:CONNECTS]-()-[:CONNECTS]-&gt;(mid2)&lt;-[:CONNECTS]-(s)
WITH head(collect([mid1,mid2])) AS nodes LIMIT $limit
CALL apoc.refactor.mergeNodes(nodes,{properties:&quot;combine&quot;, mergeRels:true})
YIELD node RETURN node&#39;,{limit:100})
```

But this does nothing and the failed batches are returning 1.

I am guessing it is something with the limit, but not sure where to go next.  Maybe there is an easier way to this?

Thanks for any pointers.",1622037979,https://stackoverflow.com/q/67706622,Stephen Cooper,['cypher']
67652339,redisgraph.js - Parsing results of MERGE command,"The [documentation][1] has the following example to merge relationships _if_ all the end-points exist. If the `MERGE` were to be run in the [Javascript client][2], then how can I find out, if the `MERGE` created the nodes and relationships or not? In other words, how can I deduce if the nodes were present beforehand or not?

At the moment, it seems, some methods of [`ResultSet`][3] for statistics might have to be used. Any thoughts?

```cypher
GRAPH.QUERY DEMO_GRAPH
&quot;MERGE (charlie { name: &#39;Charlie Sheen&#39; })
 MERGE (wallStreet:Movie { name: &#39;Wall Street&#39; })
 MERGE (charlie)-[r:ACTED_IN]-&gt;(wallStreet)&quot;
```


  [1]: https://oss.redislabs.com/redisgraph/commands/#merge
  [2]: https://github.com/RedisGraph/redisgraph.js
  [3]: https://redisgraph.github.io/redisgraph.js/ResultSet.html",1621704373,https://stackoverflow.com/q/67652339,cogitoergosum,"['cypher', 'redisgraph', 'redis', 'redis-cluster', 'node.js']"
67647979,How to work around &quot;Multiple types for relationship not supported&quot;?,"We have a graph in which users have access to functions through an asymmetric (multi-layered) team structure, or directly. So we have these patterns

`(user)-[:MEMBER_OF]-&gt;(team)-[:MEMBER_OF]-&gt; // --(team)-[:CAN_RUN]-&gt;(function)`

`(user)-[:MEMBER_OF]-&gt;(team)-[:CAN_RUN]-&gt;(function)`

`(user)-[:CAN_RUN]-&gt;(function)`

With graphdbs that support multiple edge types, this works

`MATCH (u:User)-[:MEMBER_OF|CAN_RUN*]-&gt;(f:Function)`

but AgensGraph throws me a &quot;Multiple types for relationship not supported&quot;.

What is the AgensGRaph way to do this?",1621675927,https://stackoverflow.com/q/67647979,Graphileon,"['cypher', 'agens-graph']"
67050744,AgensGraph syntax error on unbound node in where condition,"I&#39;m trying to run the following query in AgensGraph 2.1.3 (data from [my other query](/q/67007556/3127111)):

    match p=(a:temporary)-[:KNOWS*0..]-&gt;(b) 
    where not ()-[:KNOWS]-&gt;(a) and not (b)-[:KNOWS]-&gt;() 
    with p, a match (k)-[:HAS]-&gt;(a) where k.name=&#39;k1&#39; return p;

But it yields:

    ERROR:  syntax error at or near &quot;)&quot;
    LINE 1: ...atch p=(a:temporary)-[:KNOWS*0..]-&gt;(b) where not ()-[:KNOWS]...
                                                                 ^

The same works in Neo4j so maybe I should just use a different syntax, but I can&#39;t figure out which one.",1618179993,https://stackoverflow.com/q/67050744,watery,"['cypher', 'agens-graph']"
67050699,cypher query with subpath and exists in redisgraph,"I&#39;m evaluating RedisGraph and I&#39;m trying to replicate a result I have in Neo4j.

Graph and query are from [my other question](/q/67007556/3127111), I&#39;m trying to achieve the same result: the path `f1 &lt;- (friend) m2 &lt;- (sibling) b3 &lt;- (coworker) d4` (and none of the `p*` nodes)

Nodes:

    CREATE (a:temporary {name: &#39;m2&#39;});
    CREATE (a:temporary {name: &#39;f1&#39;});
    CREATE (a:temporary {name: &#39;b3&#39;});
    CREATE (a:temporary {name: &#39;d4&#39;});
    
    CREATE (a:temporary {name: &#39;p5&#39;});
    CREATE (a:temporary {name: &#39;p6&#39;});
    CREATE (a:temporary {name: &#39;p7&#39;});
    
    CREATE (a:temporary {name: &#39;k1&#39;});
    CREATE (a:temporary {name: &#39;k2&#39;});
    
and relations:

    MATCH (a) WHERE a.name = &#39;b3&#39; MATCH (b) where b.name = &#39;m2&#39; CREATE (a)-[:KNOWS {type: &#39;sibling&#39;}]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;m2&#39; MATCH (b) where b.name = &#39;f1&#39; CREATE (a)-[:KNOWS {type: &#39;friend&#39;}]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;d4&#39; MATCH (b) where b.name = &#39;b3&#39; CREATE (a)-[:KNOWS {type: &#39;coworker&#39;}]-&gt;(b);

    MATCH (a) WHERE a.name = &#39;p7&#39; MATCH (b) where b.name = &#39;p6&#39; CREATE (a)-[:KNOWS {type: &#39;friend&#39;}]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;p6&#39; MATCH (b) where b.name = &#39;p5&#39; CREATE (a)-[:KNOWS {type: &#39;coworker&#39;}]-&gt;(b);

    MATCH (a) WHERE a.name = &#39;k1&#39; MATCH (b) where b.name = &#39;b3&#39; CREATE (a)-[:HAS]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;k1&#39; MATCH (b) where b.name = &#39;d4&#39; CREATE (a)-[:HAS]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;k1&#39; MATCH (b) where b.name = &#39;m2&#39; CREATE (a)-[:HAS]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;k1&#39; MATCH (b) where b.name = &#39;f1&#39; CREATE (a)-[:HAS]-&gt;(b);

    MATCH (a) WHERE a.name = &#39;k2&#39; MATCH (b) where b.name = &#39;p5&#39; CREATE (a)-[:HAS]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;k2&#39; MATCH (b) where b.name = &#39;p7&#39; CREATE (a)-[:HAS]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;k2&#39; MATCH (b) where b.name = &#39;p6&#39; CREATE (a)-[:HAS]-&gt;(b);

The original Cypher query:

    match p=(a:temporary)-[:KNOWS*0..]-&gt;(b) 
    where not ()-[:KNOWS]-&gt;(a) and not (b)-[:KNOWS]-&gt;() 
    and exists { match (k)-[:HAS]-&gt;(a) where k.name=&#39;k1&#39; } 
    return p

Gives the following error, about the subpath in the `EXISTS`:

    Invalid input &#39;(&#39;: expected &#39;:&#39;, &#39;,&#39; or &#39;}&#39; line: 1, column: 112, offset: 111 errCtx: ... (b)-[:KNOWS]-&gt;() and exists { match (k)-[:HAS]-&gt;(a) where k.name=&#39;k1&#39; } r... errCtxOffset: 40

I&#39;ve rewritten it like this (with an additional `MATCH` clause: is this equivalent to the above?

    GRAPH.QUERY test &quot;match p=(a:temporary)-[:KNOWS*0..]-&gt;(b) where not ()-[:KNOWS]-&gt;(a) and not (b)-[:KNOWS]-&gt;() with a, p match (k)-[:HAS]-&gt;(a) where k.name=&#39;k1&#39;  return p&quot;
",1618179542,https://stackoverflow.com/q/67050699,watery,"['redisgraph', 'cypher', 'graph-traversal']"
67030828,"Given a plain text and a possible cipher text, determine whether the cipher text can be formed from the plain text using the mentioned scheme","The alphabets are enumerated as A = 0, B = 1, C = 2, ... , Z = 25. Consider an encryption scheme where a character with value Ci in the plaintext is replaced by another character with value Cj using the formula Cj = (Ci + 5) % 26. After replacement, the resulting string is shuffled (permuted) at random to obtain the cipher text.

Given a plain text and a possible cipher text, your task is to determine whether the cipher text can be formed from the plain text using the above mentioned scheme.

(Assume that all the strings are in uppercase)

Input Format:

The first line of the input contains a string indicating the plain text.

The second line of the input a string indicating a possible cipher text

Output Format:

Display Yes or No (no newline after the output)

Example:

Input:

PYTHON
TDMSUY

Output:

Yes

Input:

JOCPNPTEL
JQYVSUTHO

Output:

No

**Please answer in Python**",1618029076,https://stackoverflow.com/q/67030828,Harsh Verma,"['cryptography', 'python', 'cypher']"
67013883,"Trying to connect to SQL Server via pyodbc, TLS_DHE cypher suite issue","Using Python in Windows 7 I&#39;m trying to connect to SQL Server via pyodbc and I get this message:

&gt; [08001] [Microsoft][ODBC Driver 17 for SQL Server]SSL Provider: An existing connection was forcibly closed by the remote host.\r\n (10054) (SQLDriverConnect); [08001] [Microsoft][ODBC Driver 17 for SQL Server]Client unable to establish connection (10054)

Here is my connection string:

    cnxn = pyodbc.connect(&quot;&quot;&quot;
    DRIVER={ODBC Driver 17 for SQL Server};
    SERVER=servername;
    DATABASE=dbname;
    UID=username;%s&quot;&quot;&quot; % passwordstring)

I am able to connect to my local SQL express instance using pyodbc with no problem.

When I google the error message I get this link:

https://docs.microsoft.com/en-us/troubleshoot/windows-server/identity/apps-forcibly-closed-tls-connection-errors

It says I need to disable the TLS_DHE cypher and shows a powershell script, but when I try to run the script it gives me this error:

The term &#39;Get-TlsCipherSuite&#39; is not recognized as the name of a cmdlet, function, script file, or operable program.

When I try to find another way to disable the TLS_DHE cypher, Microsoft displays some C+ code.  Does pyodbc have some option to not use certain cyphers or what can I do?

Update:

Okay, it worked when I changed the driver to the version 11 driver, i.e. this connection string:

    cnxn = pyodbc.connect(&quot;&quot;&quot;
    DRIVER={ODBC Driver 11 for SQL Server};
    SERVER=servername;
    DATABASE=dbname;
    UID=username;%s&quot;&quot;&quot; % passwordstring)

I&#39;m guessing the 11 version doesn&#39;t have the TLS_DHE cypher suite or something.

It would still be good to know how to disable the TLS_DHE cypher suite in Window 7 though.

Thanks.
",1617931688,https://stackoverflow.com/q/67013883,Roger Perkins,"['cypher', 'windows-7', 'pyodbc', 'tls1.2', 'sql-server']"
66932381,Thick client application that would verify legit check itself back to a source,"I have an application built which the locations pay a yearly fee per user to keep using it. I looked around and unless I am not using good key words for a best practice solutions. 

I looked at the google 2fa but not sure it that is a good practice or will suite my needs. Then I was thinking of putting code where the application would on startup go an verify itself to maybe a webservice?

Any help would be appreciated.
Thanks in advance",1617460896,https://stackoverflow.com/q/66932381,robinhood1995,"['authentication', 'code-signing', 'cypher', 'google-authentication']"
66917113,Noe4j cypher - check in where statment foreach pair of path nodes,"Let&#39;s say that I am querying all paths as below:

    MATCH p = (r:startNode)-[*]-&gt;(:endNode)

and it returns some paths like

    A-&gt;B-&gt;C
    A-&gt;D-&gt;E

What I would like to do is to check in where statement some conditions between node-node and relationship-&gt;node. I mean for example I would like to check does ```B.someProperty == C.someProperty``` and ```relationFromB_To_C.property.Contains(C.otherProperty)```. How can I do it? Is there some easy way using cypher or should I switch to target SDK for C#?


",1617355172,https://stackoverflow.com/q/66917113,Bartnik,['cypher']
66547108,How do I search for nodes without incoming edges/relations in AgensGraph?,"I&#39;ve tried a bunch of cypher queries, most coming from [this question](/questions/10952332/return-node-if-relationship-is-not-present), but none worked.

E.g.: 

    postgres=# match (a)&lt;-[r]-() where r is null return *;
     a | r
    ---+---
    (0 rows)

The last one I tried is this:

    match (n) where not (n)&lt;-[]-() return *

obtaining a syntax error:

    postgres=# match (n) where not (n)&lt;-[]-() return *;
    ERROR:  syntax error at or near &quot;)&quot;
    LINE 1: match (n) where not (n)&lt;-[]-() return *;


I finally fired up Neo4j and found that the above mentioned cypher query works there.

What&#39;s the equivalent in AgensGraph (2.1.3) Cypher?


NOTE
----

While waiting for the correct solution, I worked around the issue with the following sequence of queries:

1. mark all nodes having an outgoing relation as *children* `match (a)&lt;-[]-(b) SET b.child=true;`
1. find all *non-childen* nodes `match(a) where a.child is null return a;`
1. remove the *child* marking `match(a) where a.child is not null remove a.child;`

Eventually wrapped within a transaction so not to alter the graph properties.

",1615293758,https://stackoverflow.com/q/66547108,watery,"['agens-graph', 'cypher']"
66298328,Normalize node property cypher linear and log,"Just when I thought I had understood the basics of cypher ....
I would like to create 2 new properties of a node and set a normalized value and a log normalized value based on an existing property that contains an integer, (call it count).  Setting the properties is easy.  I am having problems calculating them.

So I tried (first with a linear normalization)

    match (n:MYLABEL) where n.count &gt; 0
    with n
    set n.count_n = n.count/max(n.count)

When I run 

    match (n:MYLABEL) where n.count &gt; 0 return max(n.count)

I get the largest nr of count.  But if I run

    match (n:MYLABEL) where n.count &gt; 0 return  n.count, max(n.count) 

I get the same values for n.count and max(n.count).  So I realized max needs to operate on a list of all counts.  So I tried

      match (n:MYLABEL) where n.count &gt; 0  
      with n, collect(n.count) as cl
      return  n.count, max(cl) 

and I STILL get a count and [count] as output (same value).  I think I am missing something fundamental here.  Can anyone assist with what the cypher would look like for linear and log normalization? Grateful for your help.

",1613871590,https://stackoverflow.com/q/66298328,johnaco,"['cypher', 'normalization']"
66147160,Cypher relating distant nodes and displaying the merged relationship,"I can display two nodes which relate through other nodes.
In this case a `Person` `created` an `object` `during` a `project.

I can match this using the following:

    MATCH (p:Person)-[]-()-[]-(Project)
    WHERE p.name = &quot;Bob&quot;
    RETURN p, Project

However, no relationship is displayed in Neo4J&#39;s browser between the two, obviously there is no direct relationship, I do not want to add one, but they are related via another node. So adding a relationship visually only, not actually explicitly stating it in the data.

Take the following:

    MATCH (p:Person)-[]-()-[]-(Project)
    RETURN p, Project

No single person is identified, no single project, how would I know who was involved in which project, and I display a coded relationship, condense/merge relationships in between?",1613003577,https://stackoverflow.com/q/66147160,Spatial Digger,['cypher']
66139673,Cypher BFS with multiple Relations in Path,"I&#39;d like to model autonomous systems and their relationships in Graph Database (memgraph-db) 

There are two different kinds of relationships that can exist between nodes:

 - undirected peer2peer relationships (edges without arrows in image)
 - directed provider2customer relationships (arrows pointing to provider in image)

The following image shows valid paths that I want to find with some query

[![valid paths (source: caida.org)][1]][1]

They can be described as

    (s)-[:provider*0..n]-&gt;()-[:peer*0..n]—()&lt;-[:provider*0..n]-(d)

or in other words

&gt;  0-n c2p edges followed by 0-n p2p edges followed by 0-n p2c edges


I can fix the first and last node and would like to find a (shortest/cheapest) path. As I understand I can do BFS if there is ONE relation on the path. 

Is there a way to query for paths of such form in Cypher? 

As an alternative I could do individual queries where I specify the length of each of the segments and then do a query for every length of path until a path is found. 

i.e. 

    MATCH (s)&lt;-[]-&gt;(d)                            // All one hop paths
    MATCH (s)-[:provider]-&gt;()-[:peer]-(d)         
    MATCH (s)-[:provider]-&gt;()&lt;-[:provider]-(d)
    ...


  [1]: https://i.stack.imgur.com/9ktV3.png",1612970206,https://stackoverflow.com/q/66139673,xuma202,"['cypher', 'redisgraph', 'graph-databases', 'memgraphdb']"
66138655,Java Input byte array has wrong 4-byte ending unit,"I am trying to convert the following string into a Public Key using X509 and KeyFactory. The Code that I have written so far is:

    public static void main(String args[]) throws Exception {
		String key = &quot;MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAidRWp1iB0s2LKnAyAxUKCMmsKK9bMTdRUItZVRcV4lB0RXGla0wRTNeR6r5oqNo6poHUJ+QGPjAHDCztMjAZdtuMSQ+Lohn+TjDMIEi2sUNeXhZuXchwEE+3QTgPpIOGhjJtv4wmTjXD5UaZbYWuydNpgvFEDsF4jf02xM8t8a7nOgQIriPi83fa4XHXcoCcG&quot;
				+ &quot;EHDbpbtYUhVq12rJEBXUoVM1zi9LcDhEsgilpzRPlkT6zC+89SkgYHWTRtO2shLpJcnThkR1nyLqHU2Zgn1hSrNsy+T97bNL1Umhcs7e94WJ7WWO6PoSst4cknPIZhhRbeBHoJ9rdV+XLBoew7buDQSht2Jn&quot;
				+ &quot;zAm6A6Pvi+XhLVRlIEMLOsG6Y92Lwhuc21oSKeqklv9yDfMznJm0aeCbm3TWZehAfPD9EKJ4LgvSVbT&quot;
				+ &quot;tXSiOVvPS8JtzIedISqioSvPPP5v4qqdbqobGBv2uE0sdwYhXh+dTIFSO4WG+dQHMZpdZu38lFBec3y&quot;
				+ &quot;EuZJuKpvtX5AvdYgCEwMioZxE3ph4X3SJEbcqfR1KuuGnYwg6nmSEwotDVg55pEtSsgu3j2KRgM8GA&quot;
				+ &quot;7lkageikM4D6mq6vQ5fkedfzz8PuvQNe8BH3h2UZYmRjNvfKd8wt2bRKKFK7K4jCYT5riYo+5aEWS&quot;
				+ &quot;SrWvL+ECAwEAAQ==&quot;;
		getKey(key);
		  }
	public static PublicKey getKey(String key){
	    try{
	    	byte[] byteKey = Base64.getDecoder().decode(key.getBytes());	
	    	X509EncodedKeySpec X509publicKey = new X509EncodedKeySpec(byteKey);
	        KeyFactory kf = KeyFactory.getInstance(&quot;RSA&quot;);

	        return kf.generatePublic(X509publicKey);
	    }
	    catch(Exception e){
	        e.printStackTrace();
	    }

	    return null;
	}

The error that I received, is the following: 

    java.lang.IllegalArgumentException: Input byte array has wrong 4-byte ending unit
	at java.base/java.util.Base64$Decoder.decode0(Base64.java:781)
	at java.base/java.util.Base64$Decoder.decode(Base64.java:567)
	at WannaCry.getKey(WannaCry.java:46)
	at WannaCry.main(WannaCry.java:27)

I&#39;m not sure if I&#39;m getting the wrong key, as this is from my assignment. This is the key I have to use for the Key.

    MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAidRWp1iB0s2LKnAyAxUKCMmsKK9bMTdRUItZ
    VRcV4lB0RXGla0wRTNeR6r5oqNo6poHUJ+QGPjAHDCzt/MjAZdtuMSQ+Lohn+TjDMIEi2sUNeXhZuXch
    w/EE+3QTgPpIOGhjJtv4wmTjXD5UaZbYWuydNpgvFEDsF4jf02xM8t8a7nOgQIriPi83f/a4XHXcoCcG
    EHDbpbtYUhVq12rJEBXUoVM1zi9LcDhEsgil/pzRPlkT6zC+89SkgYHWTRtO2shLpJcnThkR1nyLqHU2
    Zgn1hSrNsy+T97bNL1Umhcs7/e94WJ7WWO6PoSs/t4cknPIZhhRbeBHoJ9rdV+XLBoew7buDQSht2Jn/
    zAm6A6Pvi+XhLVRlIEMLOsG6Y92Lwhuc21oS/Keqklv9yDfMznJm0aeCbm3TWZehAfPD9EKJ4LgvSVbT
    tXSiOVvPS8JtzIedISqioSvPPP5v4qqdbqobGBv2uE0sdwYhXh+dTIFSO4WG+dQHMZpdZu38l/FBec3y
    EuZJuK/pvtX5AvdYgCEwMioZxE3ph4X3S/JEbcqfR1KuuGnYwg6nmSEwotDVg55pEtSsgu3j2KRgM8GA
    7lkageikM4D6m/q6vQ5fkedfzz8PuvQn/Ne8BH3h2UZYmRjNvfKd8wt2bRKKFK7K4jCYT5riYo+5aEWS
    SrWvL+ECAwEAAQ==
I have of course removed all of the line breakers (&quot;/&quot;) but I am getting this error, or sometimes I am getting

&gt; Invalid Byte Array Character D",1612966691,https://stackoverflow.com/q/66138655,Jefferey John Smith,"['cypher', 'java', 'arrays']"
66026483,redisgraph create edge between nodes if not exist already in high traffic,"I have the following cypher query.

```
MATCH (a:ACTOR {id: &#39;Charlie&#39;})
MATCH (m:MOVIE {id: &#39;TwoAndAHalfMen&#39;})
OPTIONAL MATCH (a)-[e:ACTED {prop1: val1}]-&gt;(m)
 WITH COUNT(e) AS c, a, m
 WHERE c=0 CREATE (a)-[:ACTED {prop1: val1, prop2: &#39;&lt;cur-time&gt;&#39; }]-&gt;(m)
```

We have an `actor` node and a `movie` node. If there is no edge between the `actor` and the `movie` nodes, then a new edge `ACTED` should be created, with some edge properties.

The above query works fine in an idle database with not much traffic, often responding in less than 1 millisecond. However, when there is a lot of traffic, this particular query alone takes a long time, in the order of multiple seconds. While the other queries finish fine.

I suspect that the reason for the slowness is the `COUNT` function is trying to take all the nodes and somehow gets delayed when there are constant writes. I may be wrong here and just making an assumption.

I do not need to know the total number of edges, and is interested to know only if the edge is there or not. So I tried to do this query in a different way as:

```
MATCH (a:ACTOR {id: &#39;Charlie&#39;})
MATCH (m:MOVIE {id: &#39;TwoAndAHalfMen&#39;})
WHERE NOT EXISTS(
  MATCH (a)-[e:ACTED {prop1: val1}]-&gt;(m)
) 
CREATE (a)-[:ACTED {prop1: val1, prop2: &#39;&lt;cur-time&gt;&#39; }]-&gt;(m)
```

But for this I get an error from the `redisgraph` as:
```
RedisGraph does not currently support map projection
```

Is there any other way to optimally create an edge between two nodes if one does not exist already ? I cannot use a `MERGE` command because the `prop2` that I set will be a different value, when I have to create a new edge.

Please note that this should work in redisgraph and not enough if it works on neo4j or some such.",1612351263,https://stackoverflow.com/q/66026483,Sankar,"['graph-theory', 'cypher', 'redis', 'redisgraph']"
65914866,Pass the parameter to cypher,"Good day.
I want to wrap the query below in a function with a parameter.

    match p=((p1:p1)-[l]-(p2:p1))
      where (p1.id in [269618,387956,390435,1178574,263256])
        and (p2.id in [269618,387956,390435,1178574,263256])
      return
        upper(type(l)) as Type
        ,case when id(startNode(l))=id(p1) then &#39;DOWN&#39; else &#39;UP&#39; end as Relation_Vector
        ,p2.Short_Name as Visible_Name
        ,l.Shares
      ;

Примерно так:

    CREATE OR REPLACE FUNCTION f (IN text) &lt;-- 269618,387956,390435,1178574,263256
      RETURNS TABLE (...)
      LANGUAGE &#39;sql&#39;
    AS $BODY$
     -- text up
    $BODY$;

How can I pass a list of vertex IDs to the function?
Thank you in advance for your answer.",1611733711,https://stackoverflow.com/q/65914866,Андрей Никитин,"['parameters', 'cypher', 'agens-graph']"
65893421,How to sum all values in a returned column Cypher?,"I have written the following Cypher query.
```none
MATCH (c:Customers {name:&#39;Paul Pogba&#39;})-[:ORDERED]-&gt;(o:Orders)-[:BOUGHT]-&gt;(i:Items) Return c, i.kit, count(i)
```

I get a table like this as my output. 

```none
╒═════════════════════╤═════════════╤══════════╕
│&quot;c&quot;                  │&quot;i.kit&quot;      │&quot;count(i)&quot;│
╞═════════════════════╪═════════════╪══════════╡
│{&quot;name&quot;:&quot;Paul Pogba&quot;}│&quot;bumper&quot;     │1         │
├─────────────────────┼─────────────┼──────────┤
│{&quot;name&quot;:&quot;Paul Pogba&quot;}│&quot;wing mirror&quot;│1         │
├─────────────────────┼─────────────┼──────────┤
│{&quot;name&quot;:&quot;Paul Pogba&quot;}│&quot;bonnet&quot;     │1         │
├─────────────────────┼─────────────┼──────────┤
│{&quot;name&quot;:&quot;Paul Pogba&quot;}│&quot;boot&quot;       │2         │
├─────────────────────┼─────────────┼──────────┤
│{&quot;name&quot;:&quot;Paul Pogba&quot;}│&quot;wheel&quot;      │1         │
├─────────────────────┼─────────────┼──────────┤
│{&quot;name&quot;:&quot;Paul Pogba&quot;}│&quot;windscreen&quot; │1         │
├─────────────────────┼─────────────┼──────────┤
│{&quot;name&quot;:&quot;Paul Pogba&quot;}│&quot;door&quot;       │1         │
└─────────────────────┴─────────────┴──────────┘
```
How to sum all values in column &quot;count(i)&quot; using Cypher in neo4j? 


  [1]: https://i.stack.imgur.com/voRwa.png",1611614454,https://stackoverflow.com/q/65893421,sano4ek4774,['cypher']
65660941,Cypher: How to create a recursive cost query with alternates?,"I have the following structure:

`(:pattern)-[:contains]-&gt;(:pattern)`
...basically a hierarchy of patterns that use other patterns as content. These constitute trees.

Certain patterns are generated by certain generators:

    (:generator)-[:canProduce]-&gt;(:pattern)

The canProduce relationship has a cost value associated with it as a property. Multiple generators can create the same pattern.

I would like to figure out, with a query, what patterns I need to generate to produce a particular output - and which generators to choose to have the lowest cost. I started like this:

    MATCH (p:pattern {name: &#39;preciousPattern&#39;})-[:contains *]-&gt;(ps:pattern) RETURN ps

so far so good. The results don&#39;t contain the starting pattern, so I made this:

    MATCH (p:pattern {name: &#39;preciousPattern&#39;})-[:contains *]-&gt;(ps:pattern)
    WITH p+collect(ps) as list
    UNWIND list as patterns
    RETURN patterns

That does not feel elegant, but it also does not provide the hierarchy
I can of course do a path query (MATCH path = MATCH...) but the results don&#39;t seem very useful.

Also, now I need to connect the cost from the generator relationship. 

I tried this:

    MATCH (p:pattern {name: &#39;awesome&#39;})-[:contains *]-&gt;(ps:pattern)
    WITH p+collect(ps) as list
    UNWIND list as rec
    CALL {
    WITH rec
    MATCH (rec)-[r:canGenerate]-(g:generator)
    return r.GenCost as GenCost, g.name AS GenName
    }
    return rec.name, GenCost , GenName

The problem I have now is that if any of the patterns that are part of another patterns can be generated by multiple generators, I just get double entries in the list, but what I want is separate lists for each alternative possibility, so that I can generate the cost.

This is my pattern tree:

 - Awesome
   - input1
   - input2
     - input 3

Input 3 can be generated by 2 different generators. I now get:

    Awesome   |  2    | MainGen
    input1    |  3    | TestGen1
    input2    |  2.5  | TestGen2
    input3    |  1.25 | TestGen3
    input4    |  1.4  | TestGen4

What I want is this: Two lists (or n, in the general case, where I might have n possible paths), one

    Awesome   |  2    | MainGen
    input1    |  3    | TestGen1
    input2    |  2.5  | TestGen2
    input3    |  1.25 | TestGen3 

and one:

    Awesome   |  2    | MainGen
    input1    |  3    | TestGen1
    input2    |  2.5  | TestGen2
    input4    |  1.4  | TestGen4

each set representing one alternative set, so that I can calculate the costs and compare. 

I have no idea how to do something like that. Any suggestions?

Thanks!

Regards,
    CS
 





",1610335160,https://stackoverflow.com/q/65660941,cschormann,"['graph-databases', 'cypher']"
65645377,How to create nodes with parameterized labels in Cypher,"It has been a while (2 years) since that same question was asked. Back then, creating nodes or relationships with parameterized labels was not supported in Cypher. Is it better supported today?

What I want to accomplish is to simply to create nodes in Neo4J using Cypher, from a CSV file, providing that the file contains 2 columns, one for node type and one for node name:
```
  LOAD CSV WITH HEADERS FROM &#39;https://xyz/nodes.csv&#39; AS line
  WITH line.type as label
  CREATE (:EVAL(label) { name: line.name })
```
Here is the [link to the same question][1], asked 2 years ago.

  [1]: https://stackoverflow.com/questions/52706569/how-to-create-nodes-with-variable-labels-in-cypher",1610212361,https://stackoverflow.com/q/65645377,Quiche31,"['cypher', 'neo4j']"
65639662,How i find neo4j cypher?,"![enter image description here][1]


  [1]: https://i.stack.imgur.com/Zlhot.jpg


I&#39;m trying to implement Friend Recommend.

Its starts from Node&quot;You&quot;. And, I want to find Node&quot;Anna&quot;.

In other words, It&#39;s a person whom two or more of my friends know in common. And example node of above is Anna. 

I&#39;d appreciate if your help.


node: Person

relationship: Friendship

```
MATCH (neo:Person {name: &quot;You&quot;})-[*2]-&gt;(target:Person)
MATCH (neo)-[:FRIENDSHIP]-&gt;(friend:Person)
MATCH (target)-[rel:FRIENDSHIP]-&gt;(friend)
WHERE target.name &lt;&gt; &quot;You&quot;
RETURN rel
```
",1610170173,https://stackoverflow.com/q/65639662,camlyport,"['neo4j', 'cypher']"
65638012,Optimizing Cypher query for finding 2nd degree contacts,"I&#39;ve inherited the query below, which, given a specific person (pid), identifies all people who visited the same location as that person, at the same time, with a given amount of overlap, and within a provided date range (1st degree contacts), as well all contacts of those people found using the same match conditions (2nd degree contacts). The query works, but performance is very poor (execution can take 10+ minutes depending on inputs, but ideally should complete in seconds). The aren&#39;t many people and locations, but there are many visits. 

What can be done to optimize this? Any guidance would be appreciated.

**System:**
Using Neo4j 4.1.0 Community on AWS t2.medium EC2 (1 vCPU, 4GB RAM).

**Data Volume:**
Nodes: 91 people, 85 locations; 
Relationships: 135,085 Visits

    WITH &quot;%s&quot; as pid, datetime(&quot;%s&quot;) as fromTime, datetime(&quot;%s&quot;) as toTime, [%s] as types, %s as minoverlap, %s as extend, datetime() as timeNow  
    MATCH (p1:Person { id: pid })-[r1]-(l:Location)-[r2]-(p2:Person)
    WITH  p1, r1, l, r2, p2, fromTime, toTime, types, minoverlap, extend, timeNow,
        CASE WHEN r1.endTime IS NULL THEN timeNow ELSE r1.endTime END as r1EndTime,
        CASE WHEN r2.endTime IS NULL THEN timeNow ELSE r2.endTime END as r2EndTime
    WHERE p1.type IN types AND p2.type IN types AND r1.startTime &gt;  fromTime AND r1EndTime &lt; toTime AND r2.startTime &gt; fromTime AND r2EndTime &lt; toTime
    WITH p1, r1, l, r2, p2, fromTime, toTime, types, minoverlap, extend, timeNow,
        apoc.coll.max([r1.startTime.epochMillis, r2.startTime.epochMillis]) as overlapStart,
        apoc.coll.min([(r1EndTime.epochMillis + extend), (r2EndTime.epochMillis + extend)]) as overlapEnd  
    WHERE overlapStart &lt;= overlapEnd AND (overlapEnd - overlapStart) &gt; minoverlap
    OPTIONAL MATCH (p2)-[r3]-(l2:Location)-[r4]-(p3:Person)
    WITH p1, r1, l, r2, p2, r3, l2, r4, p3, fromTime, toTime, types, minoverlap, extend, timeNow, overlapStart,
          CASE WHEN r3.endTime IS NULL THEN timeNow ELSE r3.endTime END as r3EndTime,
          CASE WHEN r4.endTime IS NULL THEN timeNow ELSE r4.endTime END as r4EndTime
    WHERE p3.type IN types AND r3.startTime &gt;  fromTime AND r3EndTime &lt; toTime AND r4.startTime &gt; fromTime AND r4EndTime &lt; toTime
    WITH p1, r1, l, r2, p2, r3, l2, r4, p3, overlapStart,
        apoc.coll.max([r3.startTime.epochMillis, r4.startTime.epochMillis]) as overlapStart1,
        apoc.coll.min([(r3EndTime.epochMillis + extend), (r4EndTime.epochMillis + extend)]) as overlapEnd1  
        WHERE overlapStart1 &lt;= overlapEnd1 AND (overlapEnd1 - overlapStart1) &gt; minoverlap AND overlapStart1 &gt; overlapStart
    RETURN p1, r1, l, r2, p2, r3, l2, r4, p3



",1610150969,https://stackoverflow.com/q/65638012,Neo4jNoob,"['neo4j', 'cypher', 'graph-databases']"
65634333,match using variable and create relationship between the results of the same variable,"I have this relationship:

[![enter image description here][1]][1]

and I have built this clause:
[![enter image description here][2]][2]

My point is that I want now to create a relationship between 1 and 2 after this match, so instead of RETURN n.name, I would need something like: CREATE n1 -[A_RELATIONSHIP]- n2 

where n1 = &quot;Serving Gateway&quot; and n2 = &quot;eNode-B&quot;.

Practically saying that if those two of the same Label (NetworkFunction) match in this case (as they are both related through another node with a different label but a send or receive relationship), create a relationship called &quot;X&quot; between them

How can I achieve that?

  [1]: https://i.stack.imgur.com/2qPpg.png
  [2]: https://i.stack.imgur.com/cRlRy.png",1610129783,https://stackoverflow.com/q/65634333,maiky,"['neo4j', 'cypher']"
65630723,Need to optimize Neo4j Query,"I am creating a social media app whose back-end is Neo4j. Here, I want to fetch friends activities on user&#39;s homepage. I have put a limit of 10 activities per scroll.
This is my current Neo4j Query:

    MATCH (m:Person { id: &#39;$id&#39;})-[:FOLLOWS*1..1]-&gt;(f:Person)-[:HAS_ACTIVITY]-&gt;(la:Activity)-[:NEXT*0..]-&gt;(act:Activity)
    WHERE act.verb IN [&#39;post&#39; ,&#39;post_media_item&#39; ,&#39;watch_activity&#39;] 
    RETURN f, act ORDER BY act.published DESC LIMIT 10

In the above query user are depicted by Person node and User-feed is depicted by Activity node. &quot;m&quot; is current user whose friends &quot;f&quot; are depicted by the relationship &quot;Follows&quot;. Activity for each user are interlinked with the relationship &quot;NEXT&quot; and are linked with Person node with relationship &quot;HAS_ACTIVITY&quot;. It is intentional to keep maximum hops blank as a Person can have any number of activities.

For this query as Friend List of a person grows, so does the overall query execution time.
Currently for a user having 50 friends the time taken is 3-5 seconds.
I have to perform further aggregation from the result of this query which takes query execution time to 7-10 seconds.

Please find attached a screenshot of PROFILE and EXPLAIN:

[![PROFILE][1]][1]
[![PROFILE][2]][2]

How can I optimize my Cypher query so that I get the quickest result irrespective of a number of friends?

Neo4j Version used: 3.0.6


  [1]: https://i.stack.imgur.com/UjzVS.png
  [2]: https://i.stack.imgur.com/ioQIa.png",1610115581,https://stackoverflow.com/q/65630723,Gautam kapoor,"['cypher', 'query-optimization', 'performance', 'neo4j']"
65600229,How to continue executing a Neo4J Cypher request after MATCH is not matched?,"I have the following params in my Neo4J:

```
{
  &quot;lists&quot;: [
    {
      &quot;from&quot;: &quot;someone&quot;,
      &quot;to&quot;: &quot;somebody&quot;
    }
  ]
}

```


And the following query:
```
MATCH (c:Concept{name:&#39;infranodus&#39;}) WITH c, $lists AS list
UNWIND CASE WHEN list = [{}] THEN [null] ELSE list END AS l 
WITH l 
MATCH (cp1:Concept{name:l.from}) 
WITH cp1 
MATCH (cp2:Concept{name:&#39;somebody&#39;}) 
RETURN cp1,cp2;
```

The query above will work. 

However, if I replace `l.from` with a non-existent parameter, e.g. `l.about`, then — as the match doesn&#39;t happen —&#160;the second `cp2` match doesn&#39;t fire. 

How can I change this behavior and continue executing this query even if `cp1` is not found? Maybe there&#39;s a way to pass on a dummy variable as a result?

```
MATCH (c:Concept{name:&#39;infranodus&#39;}) WITH c, $lists AS list
UNWIND CASE WHEN list = [{}] THEN [null] ELSE list END AS l 
WITH l
MATCH (cp1:Concept{name:l.about}) 
WITH cp1 
MATCH (cp2:Concept{name:&#39;somebody&#39;}) 
RETURN cp1,cp2;
```",1609953129,https://stackoverflow.com/q/65600229,Aerodynamika,"['neo4j', 'cypher']"
65598673,How to use the int[] in where IN clause in Cypher Query (using C#),"I have this cypher query

    int[] pIds = new int[] {101, 012}; 
    var query = _graphClient.Cypher.Read
                .OptionalMatch($&quot;(p: {Labels.PERSON})&quot;)
                .Where($&quot;p.Id IN [{pIds}]&quot;) 
                .Return&lt;Person&gt;(p);

On debugging it looks like this: 

    OPTIONAL MATCH (p: Person)
    WHERE p.Id IN [System.Int32[]] 
    RETURN distinct p

****


The values that I should pass in this where clause [101, 012], but its not. Because pIds[0] = 101, pIds[1] = 012 - and its never read in the cypher query. 

Where am I going wrong and its failing to pass the values? How should I pass the int[] in the Where IN... 
",1609947272,https://stackoverflow.com/q/65598673,Aiswarya Rajagopalan,"['neo4j', 'c#', 'cypher']"
65596963,How to check if a UNWIND parameter exists in Neo4J Cypher?,"I have a Neo4J Cypher query where in some cases some parameters might not exist. 

So, for example, in this part of the statement:

```
UNWIND statement.mentionsRelations as mentionsRelation 
MATCH (c:Concept{name:mentionsRelation.name})
```

I want to proceed to `MATCH` only if `mentionsRelation.name` exists. 

How do I add this check?

I tried with `CASE` but I think I&#39;m placing it at a wrong place...

Thank you!",1609940816,https://stackoverflow.com/q/65596963,Aerodynamika,"['neo4j', 'cypher']"
65582926,Neo4j: How to return nodes which have a specific node in common?,"I am wondering how to return all the nodes with ```Label_C``` which have at least one node with ```LABEL_A``` in common if the number of the output nodes connected to such a node with ```LABEL_A``` is greater than or equal to a threshold. The target node can thus be reached through a path from any of the desired output nodes.

The structure is ```(common:Label_A)-[:REL_1]-&gt;(:LABEL_B)&lt;-[:REL_2]-(output:Label_C)```

My attempt:
```
MATCH (common:Label_A)-[:REL_1]-&gt;(:LABEL_B)&lt;-[:REL_2]-(output:Label_C)
WITH DISTINCT common, output, count(id(common)) AS cnt WHERE cnt &gt;= [THRESHOLD]
RETURN DISTINCT output
```
Look at the appended image for an example. The threshold is set to be 3.
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/TeqXz.jpg",1609864548,https://stackoverflow.com/q/65582926,cspecial,"['path', 'neo4j', 'cypher']"
65578335,Remove unnecessary relationships between nodes?," I tried to build a graph model using data, here is the cypher query

    LOAD CSV WITH HEADERS FROM &#39;file:///y.csv&#39; AS line
    MERGE (a:Employee {empid:line.EmpID})
	   ON CREATE SET a.firstname = line.FirstName, a.lastname = line.LastName
    MERGE (y:Year {year:toInteger(line.YearofJoining)}) 
	   ON CREATE SET y.month = line.MonthNamofJoining
    MERGE (c:Location {city:line.City}) 
	   ON CREATE SET c.pincode = line.PinCode,c.county = line.County,c.state = 
    line.State,c.region = line.Region
    MERGE (ag:Age {age:toInteger(line.AgeinYrs)})
    MERGE (a)-[:AGE]-&gt;(ag)
    MERGE (ag)-[:LOCALITY]-&gt;(c)
    MERGE (c)-[:JOINING_YEAR]-&gt;(y)
   
I need to return all connecting path between four employees, so I tried below query
   
    MATCH p = (a:Employee)-[:AGE]-&gt;(ag)-[:LOCALITY]-(c)-[:JOINING_YEAR]-(y)
    WHERE a.empid IN [&#39;840300&#39;,&#39;840967&#39;,&#39;346058&#39;,&#39;320954&#39;]
    return p limit 25
But the result i got correct but there are many unnecessary paths. i am uploading the resulted graph please check and correct where i am doing wrong.[resulted image][1]


 


  [1]: https://i.stack.imgur.com/voJcI.png",1609847474,https://stackoverflow.com/q/65578335,robin,"['cypher', 'neo4j']"
65563406,neo4j fulltext index search with special charcters,"We are using neo4j version 4.1.1,
and we have a graph that represents a structure of objects. &lt;br&gt;
we support translation using nodes for translation and the connection between an object and a translation node is the object name and description.&lt;br&gt;
for example:&lt;br&gt;
(n:object)-[r:Translation]-(:ru) 
&lt;br&gt;
means that on relationship r is the name and description of object n in russian.&lt;br&gt;
In order to search by name and description we implemented a fullText index like that:
&lt;br&gt;
```CALL db.index.fulltext.createRelationshipIndex(&quot;TranslationRelationshipIndex&quot;,[&quot;Translation&quot;],[&quot;Name&quot;,&quot;Description&quot;], { eventually_consistent: &quot;true&quot; })```
&lt;br&gt;

We also support search for items in order to do it we are using the index to query and we have names like &quot;UFO41.SI01V03&quot;:
&lt;br&gt;
```CALL db.index.fulltext.queryRelationships(&#39;TranslationRelationshipIndex&#39;, &#39;*FO41.SI0*&#39;) YIELD relationship, score&#160;```
&lt;br&gt;
but for names as shown above([0-9.*]) no results are returned&lt;br&gt;
while results are returned for name like &quot;*ab.or*&quot;&lt;br&gt;
&lt;br&gt;
Is there any one who knows how to make it work? I&#39;ve tried all 46 analyzers available.
I know we can solve it just using ```match()-[r]-() where r.Name contains &quot;&lt;string&gt;&quot;```
but we prefer a more efficient index-using solution to this problem.

stay safe!
and thanks in advance.

p.s if needed I can supply a few lines to recreate it locally just ask.",1609766510,https://stackoverflow.com/q/65563406,ram abigadol,"['neo4j', 'cypher', 'fulltext-index']"
65562174,Shortest path of multiple shortest pathes,"I have 2 groups of nodes, persons and movies, and I want to find the closest movie to each person. I found the shortest path to the closest movie this way:

    match path = shortestPath( (p: {id: 1)-[*]-(:MOVIE))
    with path order by length(path)
    return collect(path)[0]

Now, and I want to find the closest movie to each person (for each person, *the shortest path* **of the shortest paths between the person and all movies**) but, I didn&#39;t find a way to take the shortest path for each person separated.

I wish to have something like that:
 

    match (p:PERSON)
    with p
    match path = shortestPath( (person)-[*]-(:MOVIE) )
    with person.id as p_id, path ORDER BY length(path)
    return collect(path)[0]
 

but, the query order by length the whole response. I didn&#39;t find a way to order the paths collection per person_id individually",1609760735,https://stackoverflow.com/q/65562174,user1997656,"['neo4j', 'cypher']"
65541309,Neo4J Subquery over same property to calculate ratio,"I&#39;m working with a tweets graph. I&#39;m trying to get the ratio between tweets in spanish and tweets in english.

When checking the number of tweets by language:
```
MATCH (twtEs:Tweet)&lt;-[:HAS_WRITEN]-()-[:HAS_AS_PROFILE_LANGUAGE]-&gt;(l:Language)
RETURN DISTINCT l.languageCode, count(*)
\\ Result:
╒════════════════╤══════════╕
│&quot;l.languageCode&quot;│&quot;count(*)&quot;│
╞════════════════╪══════════╡
│&quot;en&quot;            │165392    │
├────────────────┼──────────┤
│&quot;es&quot;            │73693     │
└────────────────┴──────────┘
```
We can see the counts for each language. 

But when trying to calculate the ratio directly:
```
MATCH (twtEs:Tweet)&lt;-[:HAS_WRITEN]-()-[:HAS_AS_PROFILE_LANGUAGE]-&gt;(:Language{languageCode:&#39;es&#39;})
WITH count(twtEs) AS tweetsEs 
MATCH (twtEn:Tweet)&lt;-[:HAS_WRITEN]-()-[:HAS_AS_PROFILE_LANGUAGE]-&gt;(:Language{languageCode:&#39;en&#39;})
WITH count(twtEn) as tweetsEn, tweetsEs
RETURN tweetsEs/tweetsEn as RatioTweetsEsvsEn;
\\ Result:
╒═══════════════════╕
│&quot;RatioTweetsEsvsEn&quot;│
╞═══════════════════╡
│0                  │
└───────────────────┘
```
Thats what I obtain, when it should be 0,44557.
I&#39;ve been checking the documentation and other answers in Stackoverflow but haven&#39;t found something similar to use as example. Probably the second query is incorrect but I&#39;m strugling to resolve it.

Thanks in advance.

I&#39;m running:
- Neo4j Browser version: 3.2.20
- Neo4j Server version: 3.5.8 (community)",1609604122,https://stackoverflow.com/q/65541309,Uabalabadubdub,"['neo4j', 'cypher']"
65536771,How can I run a multiple-MATCH search without returning null?,"Hi I have a sample query if you&#39;d like to see an idea of the graph I&#39;m going to be referring to:

```CREATE (u:User {name: &quot;Tim Cook&quot;})-[:FOLLOWS]-&gt;(t:Thing {name: &quot;Italy&quot;}), (t)&lt;-[:TAGGED]-(p:Post {name: &quot;Post 1&quot;})&lt;-[:WROTE]-(u1:User {name: &quot;Elon Musk&quot;}), (u)-[:FOLLOWS]-&gt;(u2:User {name: &quot;Oprah&quot;})-[:WROTE]-&gt;(p1:Post {name: &quot;Post 2&quot;}), (u)-[:FOLLOWS]-&gt;(u3:User {name: &quot;Joe Biden&quot;})-[:WROTE]-&gt;(p2:Post {name: &quot;Post 3&quot;})```

Also here: [![enter image description here][1]][1]

I am trying to get all posts where the user either follows the author directly (someone who &quot;WROTE&quot; a post) OR where the person follows a Thing that was &quot;TAGGED&quot; in a post.

So in the example query, if you are Tim Cook, you should receive Posts 2 and 3 because you follow the authors directly, and Post 1 because you follow Italy that was TAGGED in that post.

I&#39;ve been searching everywhere, it&#39;s a hard thing to search for. Landed here. I&#39;m using &quot;OPTIONAL&quot; so that if the user isn&#39;t following any people the first one doesn&#39;t crash the whole query, or if they aren&#39;t following any things, the second one doesn&#39;t crash. However, with how I did it below, it returns Null for either of the queries that are empty.

So if there are no matches for the first part and 6 for the second, I end up with an array of length 7. [null, post1, post2, ...post6].

How should I be doing this instead, please? Thank you in advance!

```
OPTIONAL MATCH (this)-[:FOLLOWS]-&gt;(u1)-[:WROTE]-&gt;(post:Post)
RETURN post
ORDER BY post.id
UNION
OPTIONAL MATCH (this)-[:FOLLOWS]-&gt;(t:Thing)&lt;-[:TAGGED]-(post:Post)
RETURN post
ORDER BY post.id
```
`this` refers to the Tim Cook user node in the above example.

  [1]: https://i.stack.imgur.com/qHPuQ.png


I also would like to return if the user follows the author (the User who &quot;WROTE&quot;). So I think I can add an &quot;EXISTS&quot; or is there a way to specify which query returned a post? E.g. if the post was returned by the first MATCH above, then they clearly follow the author. If returned by the 2nd, and not the first, then they don&#39;t. What&#39;s the best way to tackle this query/how should I be doing this instead, please? Thank you in advance!",1609571147,https://stackoverflow.com/q/65536771,Dan Fein,"['neo4j', 'cypher']"
65536295,How can i display the all nodes and relationships between two nodes in neo4j?,"Created Year and Month nodes and connected them to Employee node.
 Here is the Cypher:

    MERGE (y:Year {year:toInteger(line.YearofJoining)})
    MERGE (m:Month {month:line.MonthNamofJoining)})
    MERGE (y)-[:MONTH]-&gt;(m)

    MERGE (a:Employee {empid:line.EmpID, firstname:line.FirstName, lastname:line.LastName, 
    gender:line.Gender})
    MERGE (m)-[:EMPLOYEE]-&gt;(a)
How can I show the nodes and relationship between two nodes? for example, if I select two different employee id, here I want to display what are the relationship between two employees (will two employees as common properties first name, Lastname, month, year etc..)


Thanks in advance
",1609565355,https://stackoverflow.com/q/65536295,robin,"['neo4j', 'cypher']"
65514120,neo4j cypher - Match node where another specific node of the same type doesn&#39;t exist,"# Background #

I have a neo4j database set up with the following nodes;

    (:game)-[:teamscore]-(:team)

The &#39;game&#39; node would contain an `id`, a `date` and a `name`

The &#39;team&#39; node link would contain an `id`, a `teamname` and an `score`.


# Desired Outcome #

I am looking to match nodes where `teamname` = &quot;TeamA&quot; but only where there isn&#39;t a linked node that exists with a different team for that &#39;game&#39;.

### (in plain English) ###
I want to return all nodes relating to a game where only &#39;TeamA&#39; has scored (and not conceded).


# What I have so far #

    MATCH(g:game)-[:teamscore]-(t:team)
    WHERE g.team = &quot;TeamA&quot;
    RETURN g, t

I thought about adding some kind of `NOT (g)-[:teamscore]-(:team)` to the WHERE clause but I&#39;m not sure how I could do this in a way which doesn&#39;t eliminate the node which I do want to match.

Thanks in advance for any help on this!",1609365684,https://stackoverflow.com/q/65514120,Simon,"['neo4j', 'cypher']"
65493606,Neo4j &gt; User-defined stored procedures: Would a stored procedure be faster than many cypher queries called from python?,"# The problem: #

Each iteration of a python **loop** sends a cypher-query to Neo4j that returns values.
This takes a considerable amount of time and is a **bottleneck**, as the number of loop items is 50 or more.


# Environment #

 - windows server 2019, 
 - Neo4j Server version: 3.5.9 (community), 
 - python 3.6 
 - Neo4j python driver 4.2.1

# Question #

***Would one call to a **custom stored procedure** be faster than repeated client requests to Neo4j?*** 

## Details ##

The stored procedure would be passed cypher parameters for **all** 50 items, and need to return results for **all** 50.


",1609251505,https://stackoverflow.com/q/65493606,Zippy242,"['stored-procedures', 'cypher', 'neo4j', 'python']"
65483143,Neo4j loading csv for a very long time,"Hi everyone on Stackoverflow,

I have simple query to load csv, but browser takes long time to load and still shows loading sign.

Here is my query:

    LOAD CSV WITH HEADERS FROM &quot;file:///ratings_small.csv&quot; AS line 
    WITH line MERGE (u:User{name:line.userId}) 
    MERGE (m:Movie {movieId:line.movieId}) 
    MERGE (u)-[r:RATED {rating:line.rating}]-&gt;(m) 
    RETURN u, m, r

I don&#39;t see mistake in the code..

ratings_small.csv has following columns:

userId	movieId	rating	timestamp

1	31	2.5	1260759144

1	1029	3	1260759179

1	1061	3	1260759182

1	1129	2	1260759185

1	1172	4	1260759205

There are 100 004 records.

Kind regards,
Anna",1609184434,https://stackoverflow.com/q/65483143,Anna,"['load-csv', 'neo4j', 'cypher']"
65476524,What is the best way to store dates using Neo4j graph database?,"I am currently working on a graph database where every node has a start date and an end date. I am using a structure that was recommended by neo4j, [where day, month and year all are stored as separate nodes.][1] So all the nodes in my graph are connected with the day node through a `:Start_Date` and `:End_Date relationship`. The graph consists of a lot of nodes that are connected to the day node, that is why we decided to store the day, month and year as a separate nodes. Our query would now look like 

    MATCH (a:something)-[:StartDate]-&gt;(d:Date_Day), (a)-[:EndDate]-&gt;(c:Date_Day)
    MATCH (d)-[:In_Month]-&gt;(m:Date_Month)-[:In_Year]-&gt;(y:Date_Year), (c)-[:In_Month]-&gt;(m1:Date_Month)-[:In_Year]-&gt;(y1:Date_Year)

 and it would return [the following table][2]. Is there a way to return this as a date or to query on a date? We would also like to add a timestamp in order to store when a node was mutated. What is the best way to accomplish this?


  [1]: https://i.stack.imgur.com/evOiT.png
  [2]: https://i.stack.imgur.com/26hAy.png",1609153025,https://stackoverflow.com/q/65476524,Stephan Bos,"['neo4j', 'cypher', 'graph']"
65476177,Neo4j - Match a pattern with multiple mandetory nodes,"I have ```:Post``` nodes that have multiple ```:Tag``` nodes connected with ```:HAS_TAG``` relationships.

All ```:Tag``` nodes have a property called ```name``` which is the name of a particular tag.

[![enter image description here][1]][1]

So, One post will have multiple tag nodes connected to the post with ```:HAS_TAG``` relationships.

Now, i want to query all posts that have **all** tags which will be provided at the runtime.

For example, i want to find all **Posts** that have &#39;**HONDA**&#39; and &#39;**BIKES**&#39; tags.

I tried ```MATCH (p:Post)-[r:HAS_TAG]-(t:Tag) WHERE t.name in [&#39;BIKES&#39;,&#39;HONDA&#39;] RETURN p```. But it also returns posts that have only one of the provided tag names.


  [1]: https://i.stack.imgur.com/LPT0M.png",1609151199,https://stackoverflow.com/q/65476177,Lahiru Udana,"['neo4j', 'cypher']"
65456092,Cypher Neo4j - Rank similar entities based on same relationships,"In image you see nodes P which are of the same type, all of them have relations to nodes of type C. This is just a generic view with not to many details but all entities has parameter ID. Lets say that I have P1 with distinct relationship patterns i.e to C1-C5... How can I then fetch similar entities of type P that has same relationships and rank on the amount of similar relationships...

Result I would like to have is based on that I have P1 with known HasProperty to C1 a ranked result as:

P2, has 4 similar relationships and also having C1  
P3, has 3 similar relationships and also having C1  
P4, has 2 similar relationships and also having C1

![Neo4j](https://i.stack.imgur.com/Ivo6u.png)

Thanks!",1608983473,https://stackoverflow.com/q/65456092,user3154653,"['neo4j', 'cypher']"
65454835,How to query supplementary relationship in graph?,"I have a graph database where every node is having a relationship `intersects` with the nodes that it intersects. Additionally, the `intersects` has a property `degrees` (angle at which the intersection of these two nodes happen). 

I want to order the nodes which intersect a given node at a specified angle. 

Since the intersection between two nodes is supplementary, I am saving only one relationship between the two nodes (example, (a)-[:intersects]-&gt;(b) and (b)-[:intersects]-&gt;(a) are similar things, but the angle will be different for the two, and this angle is supplementary). For example, if I need all cities intersecting City A at 45 degrees angle, the two queries are:

```
GRAPH.QUERY Nearby &quot;MATCH (a:City { name: &#39;A&#39; })-[t:intersects]-&gt;(b:City) return b.name, b.degrees ORDER BY abs(t.degrees - 45)&quot;

GRAPH.QUERY Nearby &quot;MATCH (a:City { name: &#39;A&#39; })&lt;-[t:intersects]-(b:City) return b.name, b.degrees ORDER BY abs(abs(t.degrees - 180) - 45)&quot;
```

I want to combine these two queries in one (avoid the sorting in the client library). Is it possible to do it in redis graph? I was going to try `(a)-[:intersects]-(b)` and use the case...when but seems like the support to get the src node is not available yet.

Any help would be really appreciated.

",1608972626,https://stackoverflow.com/q/65454835,psr,"['cypher', 'redisgraph']"
65453281,Neo4j get response of nested array of objects from graph,"I&#39;m new to neo4j and cypher and am having trouble with grouping queries with &#39;WITH&#39; and &#39;Collect&#39;,
so i have this graph as shown in the image below :[![enter image description here][1]][1]

What i want is a response like this :

```
processes:[
     {
      node,
      subprocesses:[
                    {node , events: [
                                     {node}
                                    ] 
                    },
                    { //
                    }
                   ]
     },
     {
      node,
      subprocesses:[
                    {node , events: [
                                     {node}
                                    ] 
                    },
                    { //
                    }
                   ]
     }
]
```
my current request : 

```
match (n:Group)-[r:DID_PROCESS]-&gt;(n2:Process) 
optional match (n2)-[r2:SUB_PROCESS]-&gt;(n3:Process) 
optional match (n3)-[he:HAS_EVENT]-&gt;(e:Event) 
where id(n)=21 with n , [n2,type(r2),n3,[type(he),e]] as rela 
return {group: n , tree:collect(rela)}
```


I hope my explanation of the problem was clear , Thanks in advance !!

  [1]: https://i.stack.imgur.com/BSUxd.png",1608950777,https://stackoverflow.com/q/65453281,Oelmounkad,"['neo4j', 'cypher']"
65437022,CSV data Import into neo4j,"I have a data in my excel sheet like the screenshot below: &lt;br&gt;
[![enter image description here][2]][2]
&lt;br&gt;
but i want to import it with relationship into neo4j like this:
[![enter image description here][1]][1]
So can some one please guide me how to do this with neo4j Thanks 


  [1]: https://i.stack.imgur.com/nvWGM.png
  [2]: https://i.stack.imgur.com/czPSy.png",1608805677,https://stackoverflow.com/q/65437022,Sibtain Shahbaz,"['neo4j', 'graph-databases', 'cypher']"
65432237,how to calculate a distinct count for nodes,"I need your help in neo4j project. I have two nodes Author and Article. The relationship  between those is 
```
(author:Author)-[:WRITES]-&gt;(article:Article)
```
An article could be written by more than one author. So i want to calculate which are the top 5 authors with the most collaborations (with different authors). Also, i want to return author names and number of collaborations. I tried the below but it didn&#39;t work.

```
MATCH (article:Article)&lt;-[:WRITES]-(author:Author)
with article, collect(distinct author.name) as authors
RETURN authors,size(authors)-1 as numberofcollaborations
ORDER BY numberofcollaborations DESC
LIMIT 5; 
``` 

Any ideas?",1608766627,https://stackoverflow.com/q/65432237,person,"['cypher', 'cypher-3.1', 'neo4j-apoc', 'neo4j']"
65424886,Neo4j Cypher : return nodes with id as a dictionary,"I have nodes with these properties:
```cypher
MATCH (n:A) RETURN n
```
```json
[
  {
    &quot;name&quot;: &quot;114s09A.1&quot;,
    &quot;_id&quot;: &quot;114s09A.1&quot;,
    &quot;id&quot;: &quot;114s09A.1&quot;,
    &quot;created_n4j&quot;: &quot;2020-12-21T09:56:11.256000000Z&quot;,
    &quot;type&quot;: &quot;A&quot;,
    &quot;updated_n4j&quot;: &quot;2020-12-21T09:56:11.256000000Z&quot;
  },
  {
    &quot;name&quot;: &quot;114s09A.2&quot;,
    &quot;_id&quot;: &quot;114s09A.2&quot;,
    &quot;id&quot;: &quot;114s09A.2&quot;,
    &quot;created_n4j&quot;: &quot;2020-12-21T09:56:11.257000000Z&quot;,
    &quot;type&quot;: &quot;A&quot;,
    &quot;updated_n4j&quot;: &quot;2020-12-21T09:56:11.257000000Z&quot;
  }
]
```
Is there a way to build the cypher query so that the result would be shaped as a dictionary where `id` would be the key ?

```json
[
  {
    &quot;114s09A.1&quot;: {
      &quot;name&quot;: &quot;114s09A.1&quot;,
      &quot;id&quot;: &quot;114s09A.1&quot;,
      &quot;created_n4j&quot;: &quot;2020-12-21T09:56:11.256000000Z&quot;,
      &quot;type&quot;: &quot;A&quot;,
      &quot;updated_n4j&quot;: &quot;2020-12-21T09:56:11.256000000Z&quot;
    }
  },
  {
    &quot;114s09A.2&quot;: {
      &quot;name&quot;: &quot;114s09A.2&quot;,
      &quot;id&quot;: &quot;114s09A.2&quot;,
      &quot;created_n4j&quot;: &quot;2020-12-21T09:56:11.257000000Z&quot;,
      &quot;type&quot;: &quot;A&quot;,
      &quot;updated_n4j&quot;: &quot;2020-12-21T09:56:11.257000000Z&quot;
    }
  }
]
```

The closest I came up to so far is :

```cypher
MATCH (n:A) RETURN n._id AS _id, properties(n) AS properties
```
```json
[
  {
    &quot;_id&quot;:&quot;114s09A.1&quot;,
    &quot;properties&quot;:{
      &quot;name&quot;: &quot;114s09A.1&quot;,
      &quot;id&quot;: &quot;114s09A.1&quot;,
      &quot;created_n4j&quot;: &quot;2020-12-21T09:56:11.256000000Z&quot;,
      &quot;type&quot;: &quot;A&quot;,
      &quot;updated_n4j&quot;: &quot;2020-12-21T09:56:11.256000000Z&quot;
    }
  },
  {
    &quot;_id&quot;:&quot;114s09A.2&quot;,
    &quot;properties&quot;:{
      &quot;name&quot;: &quot;114s09A.2&quot;,
      &quot;id&quot;: &quot;114s09A.2&quot;,
      &quot;created_n4j&quot;: &quot;2020-12-21T09:56:11.257000000Z&quot;,
      &quot;type&quot;: &quot;A&quot;,
      &quot;updated_n4j&quot;: &quot;2020-12-21T09:56:11.257000000Z&quot;
    }
  }
]
```",1608729162,https://stackoverflow.com/q/65424886,Guillaume de Bure,"['cypher', 'neo4j']"
65419081,Is there a way to preform calculations in a cypher query?,"Is there a way to order by a calculated value based on relationships, rather than a label? For reference, I have a database containing users and skills.  If applicable, each user node has a relationship with a skill node.  Each skill has a specific value tied to it that represents how important that skill is.  If a user wants to find similar users, what I am currently doing matching all distinct users with similar skills.  What I want to do is sum up the values contained in each skill node that I&#39;m looking for for a particular user, and sort from greatest to least.  For example, if I&#39;m looking for people that like to swim, run, and bike if Billy likes to swim and run I would take the values stored in each similar skill and sum them to use as the property to sort by.  Is this possible in purely cypher, or would I have to return the list of results and then calculate/sort outside of cypher?  If anyone has any other advice on how to better structure the database that would also be helpful.",1608698035,https://stackoverflow.com/q/65419081,arthurm8739,"['neo4j', 'cypher']"
65397502,Merge Duplicate Paths,"I am trying to compare and merge identical paths. I am following along with [this example][1], but it is only comparing each element in a path to a constant.

My problem is as follows. Consider three graphs

    a-&gt;b-&gt;c-&gt;d
    b-&gt;c-&gt;d
    a-&gt;b-&gt;c-&gt;e

Created by the query ```CREATE p = (:x {name: &#39;a&#39;}) -[:next]-&gt; (:y {name: &#39;b&#39;})-[:next]-&gt; (:x {name: &#39;c&#39;})-[:next]-&gt; (:y {name: &#39;d&#39;}), q = (:y {name: &#39;b&#39;})-[:next]-&gt; (:x {name: &#39;c&#39;})-[:next]-&gt; (:y {name: &#39;d&#39;}), r = (:x {name: &#39;a&#39;}) -[:next]-&gt; (:y {name: &#39;b&#39;})-[:next]-&gt; (:x {name: &#39;c&#39;})-[:next]-&gt; (:y {name: &#39;e&#39;}) RETURN *```

I want to find and then merge all equivalent paths so that I get:

    a-&gt;b-&gt;c-&gt;d
          |
          v
          e

My current idea for an approach is using a query to collect all identical paths in lists and then merging the overlapping nodes and relationships in the paths. For example, I want a query to get

    [ 
      [ [b-c-d, b-c-d], [a-b-c, a-b-c] ] // comparison of path 1 to paths 2 and 3
      [ [b-c, b-c] ] // comparison of paths 2 and 3
    ]

Then I want to extract all unique nodes and merge them using apoc.refactor.mergeNodes. Followed by apoc.refactor.mergeRelationships on relationships connecting the now identical nodes.

Is this the correct approach? How would I construct a query to obtain the overlapping paths?


  [1]: https://neo4j.com/developer/kb/comparing-relationship-properties-within-a-path/",1608572512,https://stackoverflow.com/q/65397502,Sven Voigt,"['cypher', 'neo4j']"
65395824,How to delete large amount of relationships in cypher?,"I have created a large amount of relationships (millions) that I want to delete with a Cypher request.

    call apoc.periodic.iterate(&#39;MATCH (a:CAR)-[r:REL_NAME]-&gt;() DELETE r&#39;,&#39;&#39;, {batchSize:50000})

Is it the right syntax ?",1608565837,https://stackoverflow.com/q/65395824,jos97,"['cypher', 'neo4j']"
65395289,Need help designing neo4j query,"Neo4j newbie here.
I have setup following relationship

    Customer - [Buys] -&gt; Stocks

I am pulling most popular stock as

    MATCH (n:Customer)-[:BUYS]-&gt;(s:Stock) RETURN s,count(distinct n) as cnt order by cnt desc limit 1

`Buy relation have Quantity, unit price and invoice date` properties.



I need to find 2 things.

 1. What did customer buy before and after purchasing most popular stock
    
 
 2. Display the customer who placed orders in the most consecutive
    calendar months?

For pt1: I have created separate query to pull most popular stock and trying following options.

    Match (cust:Customer)-[b:BUYS]-&gt;(s:Stock)
    where b.inInvoiceDate &lt; (match (p)-[b1:Buys]-&gt;(s1:Stock {StockCode=&#39;18102&#39;}) return b1.InvoiceDate) limit 10 --This fails

I am looking to do it this way, but its not working

    Match (cust:Customer)-[b:BUYS]-(s:Stock) where s.StockCode = &#39;22866&#39;
    with cust, apoc.date.format(b.InvoiceDate, &quot;ms&quot;, &quot;yyMMdd&quot;) as last_purchase_dt
    call {
    match (cust)-[prevb:BUYS]-(prevs:Stock) where apoc.date.format(b.InvoiceDate, &quot;ms&quot;, &quot;yyMMdd&quot;) &lt; last_purchase_dt order by b.InvoiceDate desc limit 1
    return cust, prevs.StockCode
    
    Union
    
    match (cust)-[nextb:BUYS]-(nexts:Stock) where apoc.date.format(b.InvoiceDate, &quot;ms&quot;, &quot;yyMMdd&quot;) &gt; last_purchase_dt order by b.InvoiceDate asc limit 1
    return cust, nexts.StockCode
    }

Is there a way like in sql world where i can create temporary tables and refer them?",1608563703,https://stackoverflow.com/q/65395289,Aman Madan,"['neo4j', 'multiple-resultsets', 'cypher']"
65393118,query to copy a node with relations in neo4j without the clone procedure,"I want to copy a node with all its properties and relations with others nodes. Im using Neo4j version 3.4.7 so I can&#39;t use the clone procedure. My node might have different types of relations and I want to copy them all. I wanted to use this query 

    match (map:student {name:&#39;test&#39;})  create (copy:student) set copy=map with copy,map match (map)-[r1]-&gt;(n) with collect(r1) as rels,map,copy,n foreach( rel in rels | create (copy)-[r2:type(rel)]-&gt;(n) set r2+=rel) return copy,n


but I get invalid syntax error using type(rel) in foreach. Is there a way to do this without knowing the types of relations?
",1608555092,https://stackoverflow.com/q/65393118,pouyeh,"['cypher', 'neo4j']"
65382473,How to take specific char from csv file?,"I am new to neo4j and i need your help!

I have create an article node in neo4j and i want to read a csv file which contains info about citations among articles (articleId, --[Cites]-&gt;,articleId). The format of csv file follows 

```
&quot;1001	9910248&quot;
&quot;1001	9910268&quot;
&quot;9304045	9204040&quot;
&quot;9308122	9203084&quot;
&quot;9308122	9204035&quot;
&quot;9308122	9205041
``` 

1001 is an id of one article and 9910248 is an id of another article. I want to read this file and create the following relationship  (article)-[:CITES]-&gt;(article). How could i do that?

I have tried the below but it didn&#39;t work.

```
LOAD CSV FROM &quot;file:///C:/Citations.csv&quot; AS line
FIELDTERMINATOR &quot;\t&quot; 
MERGE (article:Article {id: line[0]})
WITH article, SPLIT(article.id, &quot; &quot;) AS art
MERGE (article)-[:CITES]-&gt;(toarticle:TArticle {id: art})

```
",1608483672,https://stackoverflow.com/q/65382473,person,"['neo4j', 'cypher']"
65373228,Simple but very long request,"I&#39;m trying to do this simple request :

```
MATCH (p:Player)
MERGE (a:Alias {name:p.name})
MERGE (p)-[r:AKA]-&gt;(a)
RETURN count(*)
```

It will register every old nickname for a player.

I just want to create/merge a node Alias for each Player, and connect them.

There are around 100k Player nodes.

I don&#39;t understand why it&#39;s taking so long.

When I&#39;m describing the request, I have : 

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/cCJT3.png

I really don&#39;t understand why I have a branch with around 3 billions rows.",1608403246,https://stackoverflow.com/q/65373228,Zofren,"['performance', 'neo4j', 'request', 'cypher']"
65363826,How can I call this APOC procedure selectively? (only on a subset of nodes),"I have a Neo4J database with a number of nodes of label com. These nodes contain a key property - which uniquely groups them in the fashion that I want. They also have a timestamp property, as well as a number of other integer properties. 

Here&#39;s the issue I&#39;m facing: I want to use the APOC graph grouping procedure to aggregate these nodes together, based on their key properties. However, I want to do so *selectively* - such that I only aggregate the nodes if their timestamp property meets a provided time window.

I have tried to MATCH and filter the nodes with a WHERE clause based on their timestamp, but I am unable to specifically pass those nodes to the [`nodes.group`](https://neo4j-contrib.github.io/neo4j-apoc-procedures/3.5/virtual/graph-grouping/) procedure. Basically, I need to figure out how to CALL `nodes.group` only on a specific subset of nodes. I&#39;d appreciate any help. 

Here is the CALL I&#39;m performing:

```
CALL apoc.nodes.group([&#39;com&#39;], [&#39;key&#39;], [{val1: &#39;sum&#39;, val2: &#39;sum&#39;, val3: &#39;sum&#39;,&#39; time_start: &#39;collect&#39;}]) YIELD node
```

As I mentioned above, I tried performing a 

```
MATCH (c:com) WHERE c.time_start &gt;= datetime(&#39;2020-12-16T21:45:05Z&#39;)
```

...prior to the procedure and then chaining queries, but it did not work.

The procedure still got called on ALL nodes of com relationship, not just the ones I filtered.",1608325056,https://stackoverflow.com/q/65363826,burrito_padawan,"['cypher', 'database', 'neo4j-apoc', 'neo4j']"
65333254,How connect Result nodes Neo4j,"Neo4j has a tick box option &#39;connect results nodes&#39; which i gather runs a second query to connect nodes after your initial query.

eg 

```
   MATCH (n:User) 
   where n.Verified = &#39;false&#39;
   return n
   order by n.followers DESC
   Limit 40
```
This query returns 40 nodes which are connected to each other. While this works in the Neo4j browser, I cant quite get it to connect in Neo4j bloom. So question is whats the second query thats run to connect the result nodes under the hood?

Thanks 

",1608166527,https://stackoverflow.com/q/65333254,Delta1x,"['neo4j-apoc', 'neo4j', 'cypher-shell', 'cypher']"
65331699,Checking every relationship of a path triggers way too many dbhits,"I am running a query to find the path from a user to a permission node in neo4j and I want to make sure it doesn&#39;t traverse some relationships. Therefore I&#39;ve used the following cypher :

    PROFILE 
    MATCH path = (u:user { _id: &#39;ea6b17e0-3b9e-11ea-b206-e7610aa23593&#39; })-[r:accessRole|isMemberOf*1..5]-&gt;(n:PermissionSet { name: &#39;project&#39;})
    WHERE all(x IN r WHERE NOT (:PermissionSet)-[x]-&gt;(:user))
    RETURN path

I didn&#39;t expect the where clause to trigger so many hits. I believe I&#39;m not writing my test correctly.
(2000 nodes/ 3500 rels =&gt; 350,000 hits for &quot;(:PermissionSet)-[x]-&gt;(:user)&quot;

any advice?",1608155780,https://stackoverflow.com/q/65331699,Yoann Maingon,"['neo4j', 'cypher']"
65322069,Forming relationships among Null nodes in neo4j,"I have a CSV with lots of optional data fields (some cells will be null) in between. For example, 
```
A    B    C
1         abc
2    xyz
```
Here, `A` is the only column with no null values. Now, I have to create relationships among these nodes like this `A -&gt; B -&gt; C`. In here if `B` is null, `C` must form a relationship with `A`, else with `B`. How do I load this data in the database more efficiently? Thanks in advance.",1608116844,https://stackoverflow.com/q/65322069,Hema Chandran,"['neo4j', 'graph', 'database', 'cypher']"
65313046,Neo4j MERGE constraint violation on non-constraint property value,"The issue I&#39;m having is similar to this issue [Cypher &#39;Node Already Exists&#39; issue with MERGE](https://stackoverflow.com/questions/35381968/cypher-node-already-exists-issue-with-merge), but it doesn&#39;t look like my constraint (```id```) is being violated. Instead, I&#39;m getting an error about another property which shouldn&#39;t be a constraint at all. I&#39;m using apoc to connect to a mongo db and have verified that the mongo db is okay. This is my query:

```
CALL apoc.mongodb.get(&#39;mongodb://[HOSTNAME]:[PORT],&#39;dbname&#39;,&#39;tablename&#39;,null,true) YIELD value as elt
MERGE (e:TableElements {id : elt.pid})
ON MATCH SET 
    e.symbol = elt.sym,
    e.electron_cfg = elt.el
ON CREATE SET 
    e.atomic_number = elt.num,
    e.symbol = elt.sym,
    e.electron_cfg = elt.el,
    e.atomic_weight = elt.weight,
    e.name = elt.name;
```

And I&#39;m getting this error:
```
Node(1) already exists with label `TableElements` and property `name` = &#39;HYDROGEN&#39;
```
All issues with duplicate elements aside, how is it possible that I&#39;m getting a constraint violation on a property that I haven&#39;t identified as a constraint? My understanding of MERGE is that it merges only on the properties specified in the merge clause which I think just consists of all nodes with property ```id``` matching the incoming ```elt.pid``` and I&#39;ve already verified that there aren&#39;t any duplicate ```elt.pid```s, so I&#39;m not sure what could be happening.
",1608063292,https://stackoverflow.com/q/65313046,asdf,"['neo4j', 'cypher']"
65298867,Export data from Neo4j Sandbox,"So i&#39;ve worked with Neo4j sandbox and i have a whole graph there , but my sandbox is gonna expire so i have to export the data , and import it in my localhost community neo4j instance , i tried to use APOC , but the problem is when i call `apoc.export.cypher.all(.....)` it doesnt work because i have to add `apoc.export.file.enabled=true` in the `neo4j.conf` file in my sandbox instance.

-&gt; Whole error : `Failed to invoke procedure apoc.export.cypher.all : Caused by: java.lang.RuntimeException: Export to files not enabled, please set apoc.export.file.enabled=true in your neo4j.conf`

The problem here is that i can&#39;t access the config file on my sandbox , but i can connect to it using `cypher-shell`.

is there any suggestions so that i can export my data before the sandbox expires. Thanks in advance !!",1607996278,https://stackoverflow.com/q/65298867,Oelmounkad,"['cypher-shell', 'cypher', 'neo4j-apoc', 'neo4j']"
65288691,Neo4j : Semantic difference between &quot;WITH DISTINCT x RETURN count (x)&quot; and &quot;RETURN count (distinct x)&quot;?,"I have a Neo4j database where I&#39;m trying to count the (distinct) nodes reachable by paths of length at most 10 through any relation. My question is quite simple, if you can spare the time, but it&#39;s quite specific and I&#39;m not sure I can find this topic in the documentation.
My initial approach was this:
`MATCH path = (a)-[*1..10]-(b) WHERE a.name=&quot;blabla&quot;
RETURN count(distinct b);`
but I&#39;ve been told I should use 
`MATCH path = (a)-[*1..10]-(b) WHERE a.name=&quot;blabla&quot; WITH distinct b
RETURN count(b);` instead.
Is there any particular reason to use one over the other? At first glance both seem equivalent, and seem to yield the same results, but I&#39;m wondering if they actually are.

Thanks for your time!",1607947196,https://stackoverflow.com/q/65288691,Ark,"['cypher', 'neo4j', 'database']"
65278432,Removing redundant Nodes from the relationship,"This is a sample of the data

```
CaseID,name,child,parent
1,register request,examine thoroughly, null
1,examine thoroughly,register request,check ticket
1,check ticket,examine thoroughly,decide
1,decide,check ticket,reject request
1,reject request,decide, null
6,register request,null,examine casually
6,examine casually,register request,check ticket
6,check ticket,examine casually,decide
6,decide,check ticket,pay compensation
6,pay compensation,Mike,200,decide, null

```
Basically, I would like to group by [name] and get all activities with their [children] using Cypher.

Having null in either parent or child means it doesn&#39;t have such link.

The following query creates a caretsian product and it makes it very big, while I want to distinct the Activities and get their respective successor.

```
MATCH (p:Activity),(c:Activity)
WHERE p.child=c.name AND c.child &lt;&gt; p.name
CREATE (p)-[r:PRODUCES]-&gt;(c)
RETURN collect(r)
```

But unfortunately it produces a cartesian product between all records and it makes the relationship very big.

So, I want just the distinct activities (unique activities) with their respective successors.",1607879715,https://stackoverflow.com/q/65278432,Belal Mohammed,"['neo4j', 'cypher']"
65268516,How do I group nodes by a different node property and order by a different one in Neo4j?,"I am working with [crimes in Boston][1] dataset, with each crime as nodes in Neo4j. I want to query and display the most committed crimes each year to get a result like this:


|Year | offense_code_group        | count(offense_code_group) |
|:----|:-------------------------:|--------------------------:|
|2015 | Aggravated Assault        |       5827                |
|2016 | Larceny From Motor Vehicle|      11534                |
|2017 | Verbal Disputes           |       12049               |
|2018 | Investigate Person        |         8724              |


*Note: The result is just an example of how I want it to group and look, not the actual result I&#39;ll get after querying the dataset.*

But this is the best I have been able to do so far:
[query and output in neo4j desktop][2]

I know there is no GROUP BY clause in Neo4j and I have tried using collect(), but I can&#39;t get it to work. 


  [1]: https://www.kaggle.com/ankkur13/boston-crime-data?select=crime.csv
  [2]: https://i.stack.imgur.com/MeqmS.png",1607798401,https://stackoverflow.com/q/65268516,Divya Rustagi,"['cypher', 'dataset', 'sql', 'aggregate-functions', 'neo4j']"
65262319,Neo4j query to get a document with no parent,"I have a relation in neo4j 
```
(d:Document)-[r:HAS_PARENT]-&gt;(p:Document)
```
but sometime my document have parents. 

I want to fetch documents who are not linked with other document by the HAS_PARENT relation ship 

How can I do ? 


Thanks in advance",1607755549,https://stackoverflow.com/q/65262319,user2626210,"['cypher', 'neo4j']"
65246908,Separating matching nodes in a query result,"I defined the directed relation ``Know`` on person nodes. For example, if Sara knows Alice then Sara-&gt; Alice. I wrote this Cypher query to find all the people who know both the right and left side of the directed relation. 
 
    match ((n:Person)-[:Know]-&gt; (m:Person)),(p:Person)
    where EXISTS ((m)&lt;-[:Know]-(p)-[:Know]-&gt;(n))
    RETURN m,n,p

I need to get subgraphs with 3 nodes in the query&#39;s result but the result I get is a graph with many nodes. Is there any method to change the query to generate subgraphs with just 3 nodes (for example, a subgraph of Alex-&gt; Sara, Alex-&gt; Alice, Sara-&gt; Alice and if Sara has the same condition on two other people it is shown in another subgraph). This requires repeating some nodes in the output.",1607669308,https://stackoverflow.com/q/65246908,Jennifer L,"['neo4j', 'cypher']"
65241258,How to loop throught a list property in each node and see if it appears in other node property?,"I have data in Neo4j looking like this: (ARTICLE) and (TOPIC) nodes.

In each ARTICLE nodes I have a property that contains a list of strings like this, the property is topics:

&quot;topics&quot;: [&quot;sun&quot;, &quot;sky&quot;]

I have a lot of topics nodes and I would like to create a relation between ARTICLE nodes and TOPICS nodes every time the string correponding to the name of a TOPIC node.

For example if I have a TOPIC node with the property topic and the value sun, I would like to create a relationship between article containing the string sun (in the topics list property of ARTICLE nodes) and TOPIC nodes.

How can I do this ? I thought about looping in every list of nodes and see if it is in topic nodes.",1607629368,https://stackoverflow.com/q/65241258,jos97,"['cypher', 'neo4j']"
65222369,Neo4j Cypher query to fetch posts created by followers,"I am creating an app kind of like Facebook. It is an app where people can share products and collections of products. In the &quot;create a post&quot; popup, people can either select a product or a collection (group of products but consider it as a single object) or just text to create a post. I need to fetch the posts created by my followers.

Each post will have a property of type PRODUCT, COLLECTION, OR TEXT  to indicate what type of post it is.

In my neo4j DB, there is a Post object, product object, collection object and user object.
When you create a post, relations will be created between them. 

```
(post)-[:CREATED_BY]-&gt;(USER)
(post{type:&quot;PRODUCT&quot;})-[:INCLUDES]-&gt;(product)
(post{type:&quot;COLLECTION})-[:INCLUDES]-&gt;(collection)
```
This is what I tried to get the posts of type &quot;PRODUCT&quot;. IT shows an error. but just to give a basic idea of our properties.

```

   MATCH (user:User{lastName: &quot;mylastname&quot;})-[:FOLLOWS {status: &quot;accepted&quot;}]-&gt;(following) WITH following 
   OPTIONAL MATCH (post:Post {type: &quot;PRODUCT&quot;})-[r:CREATED_BY]-&gt;(following) WITH post,user, r OPTIONAL 
   MATCH 
   (post)-[:INCLUDES]-&gt;(product:Product) WITH COLLECT({post:post, datetime: r.datetime, 
   type:&quot;PRODUCT&quot;,product:product user: following}) as productPosts
   UNWIND productPosts AS row
   RETURN row
   ORDER BY row.datetime DESC
   SKIP 0
   LIMIT 10

```",1607536742,https://stackoverflow.com/q/65222369,Nourish Cherish,"['cypher', 'neo4j']"
65221248,Case insensitive parameter match,"I would like to match pets and their owners. Currently I do:

```
MATCH (n:Person) WITH n MATCH (p:Pet{owner: n.name})
RETURN *
```

This works, but doesn&#39;t find all my results. 

The reason it fails to find all my results is because the letter case between `p.owner` and `n.name` doesn&#39;t always match. The Person `name` could be upper or lower case, and the Pet `owner` could be upper or lower case. There is no consistency and sanitising the data before database input is not an option in this scenario.

What I need is to match Persons and Pets while ignoring any casing issues, ideally by lowercasing both the `p.owner` and `n.name`.

I tried using `toLower()` but that doesn&#39;t let me lowercase the `owner` in the query (syntax error).
",1607532719,https://stackoverflow.com/q/65221248,Juicy,"['neo4j', 'cypher']"
65219893,Creating many relationships in one script,"I am a relative newbie to the world of cypher programming, and therefore hoping for a solution to this problem from the experts community here.

I am creating a graph from an excel file, which contains different categories, items and so on. One item can belong to multiple categories and so on.

I have generated the relevant create relationship statements (there are about 200 of them). However, when i put them through neo4j browser, the interface complains that i can only run one match - create command at a time.

i am not using any other programming language or their API and simply using neo4j browser to achieve this.

Kindly suggest path forward.

my env : neo4j desktop 4.1.3 on Windows 10 Enterprise.
apoc plugin is enabled, but i m not using it yet.

Thanks
raghav",1607528090,https://stackoverflow.com/q/65219893,Raghav,"['neo4j', 'cypher']"
65217212,What would be a good query to recommend artists to a user?,"[![enter image description here][1]][1]

My Neo4j database has two nodes: USER and ARTIST. Users can follow other users and users can like artists. I would like to write a query that does the following:

- For a specific user, let&#39;s say Iza, check who this user is following, which would be Stefan in this case.
- For the users Iza is following, check which artists they have liked which Iza hasn&#39;t liked herself. In this case that would be Arctic Monkeys and Fall Out Boy. Then, return all the artists that meet the criteria.

I&#39;m still fairly new to Cypher and I could really use a helping hand to figure out how to write a query like this. Any help is welcome!


  [1]: https://i.stack.imgur.com/K10zE.png",1607518589,https://stackoverflow.com/q/65217212,Vawkx,"['cypher', 'neo4j']"
65198980,Neo4j: how to avoid node to be created again if it is already in the database?,"I have a question about Cypher requests and the update of a database.
I have a python script that does web scraping and generate a csv at the end. I use this csv to import data in a neo4j database.

The scraping is done 5 times a day. So every time a new scraping is done the csv is updated, new data is added to the the previous csv and so on.
I import the data after each scraping.
Actually when I import the data after each scraping to update the DB, I have all the nodes created again even if it is already in the DB.

For example the first csv gives 5 rows and I insert this in Neo4j.
Next the new scraping gives 2 rows so the csv has now 7 rows. And if I insert the data I will have the first five rows twice in the DB.
I would like to have everything unique and not added if it is already in the database.

For example when I try to create node ARTICLE I do this:

    CREATE (a:ARTICLE {id:$id, title:$title, img_url:$img_url, link:$link, sentence:$sentence, published:$published})

I think MERGE instead of CREATE should solve the solution, but it doesn&#39;t and I can&#39;t figure it out why.

How can I do this ?

",1607430712,https://stackoverflow.com/q/65198980,jos97,"['cypher', 'neo4j']"
65197753,How to find the head of a series of connected nodes in Neo4j with Cypher?,"I&#39;m still quite new with Neo4j and I thought this would be a really easy task but after some serious goolging I realized it&#39;s probably not so easy (or I just used the wrong keywords...) 

I&#39;m trying to find the head of a series of nodes connected with a particular relationship. The relationship is based on the timestamp property of each node. Here&#39;s my first attempt query:

```
MATCH (n1)-[:RELATIONSHIP*]-&gt;()
ORDER BY n1.timestamp
RETURN n1
```

Then I found the `startNode` function and tried:

```
MATCH ()-[rel:RELATIONSHIP]-&gt;()
RETURN startNode(rel)
```

But it doesn&#39;t always return the start nodes. Sometimes it returns some nodes in the middle. I&#39;d like to find all of the heads and connect them to nodes of some other labels. Thanks!",1607425565,https://stackoverflow.com/q/65197753,Calvin Ku,"['cypher', 'neo4j']"
65153130,Export/Dump database in neo4j?,"How can I dump a database in neo4j? 
I have tried to follow the recommendations on the website and nothing works.",1607134420,https://stackoverflow.com/q/65153130,Sergio Esteban,"['cypher', 'neo4j']"
65150834,SET a property during a custom cypher query,"Is something like this advisable?
```
GetConversationsByMember(userId: ID!): [Conversation]
    @cypher(
        statement: &quot;&quot;&quot;
            MATCH (u:User {id: $userId})-[:IN_CONVERSATION]-&gt;(c:Conversation)-[:NEWEST_MESSAGE]-&gt;(newestMessage)
            SET c.hasReadNewest = EXISTS((u)-[:HAS_READ]-&gt;(newestMessage))
            RETURN c
    &quot;&quot;&quot;)
```
I have the `hasReadNewest` property on the `Conversation` node and I want to dynamically set it when getting all conversations for a user. Right now I&#39;m running into this error `Neo4jError: Set property for property &#39;hasReadNewest&#39; is not allowed for user &#39;neo4j&#39; with roles [PUBLIC, admin] restricted to READ.` and questioning this approach altogether.",1607116508,https://stackoverflow.com/q/65150834,Matt Larson,"['neo4j', 'cypher', 'grandstack', 'graphql']"
65146031,Neo4j/cypher/GraphQL match statement that considers a HAS_READ relationship per User per Message or Conversation,"I have Conversation nodes that have Users and Messages. Users are members of the conversations and the messages are a linked list: Conversation-&gt;[:NEWEST_MESSAGE]-&gt;Message-&gt;[:NEXT_MESSAGE]-&gt;etc. Each conversation can have multiple Users and they can all write messages. Pretty straightforward. I&#39;m attempting to weave in a read status per user per message via a HAS_READ relationship from User. My current custom query statement to get conversations by user with just the newest message:
```
GetConversationsByMember(userId: ID!): [Conversation]
    @cypher(
        statement: &quot;&quot;&quot;
            MATCH (u:User {id: userId})-[:IN_CONVERSATION]-&gt;(c:Conversation)
            MATCH (c)-[:NEWEST_MESSAGE]-&gt;(newestMessage)
            RETURN c, newestMessage
    &quot;&quot;&quot;)
```
Since I have the userId, is there a way to check if `EXISTS((u)-[:HAS_READ]-(m))` and dynamically add that to each message? Or even just add a `hasRead` property to the `Conversation` node based on whether a user HAS_READ the newest message?

Here is my Conversation type def:
```
type Conversation {
    id: ID!
    newestMessage: Message @cypher(statement: &quot;&quot;&quot;
        MATCH (c:Conversation {id: this.id})-[:NEWEST_MESSAGE]-&gt;(newestMessage:Message) 
        RETURN newestMessage
    &quot;&quot;&quot;)
    messages: [Message] @cypher(statement: &quot;&quot;&quot;
        MATCH (c:Conversation {id: this.id})-[:NEWEST_MESSAGE|NEXT_MESSAGE*]-&gt;(message:Message) 
        RETURN message
    &quot;&quot;&quot;)
    members: [User] @relation(direction: IN, name: &quot;IN_CONVERSATION&quot;)
    owner: User @relation(direction: IN, name: &quot;OWNS&quot;)
    createdAt: DateTime!
    updatedAt: DateTime!
    deletedAt: DateTime
}
```

and my Message type def:
```
type Message {
    id: ID!
    body: String!
    user: User @relation(direction: IN, name: &quot;WROTE&quot;)
    next: Message @relation(direction: OUT, name: &quot;NEXT_MESSAGE&quot;)
    createdAt: DateTime!
    updatedAt: DateTime!
    deletedAt: DateTime
}
```

I&#39;m using the GRAND stack, so these are all part of my schema file. ",1607094742,https://stackoverflow.com/q/65146031,Matt Larson,"['graphql', 'apollo', 'neo4j', 'cypher']"
65143834,Neo4j: Slow match under unwind,"I&#39;m trying to read in a row of data (not from csv but passed as parameters) by unwinding and then merging. It seems that the match part of the query under the unwind is taking a really long time (whereas a simple create is more or less instant). I&#39;m a bit confused because the the match should be fairly quick to run since it can index on the label first. 

Here&#39;s a minimal version of my query (way more data will be input than just an id in real life):

    WITH *, timestamp() as time0
    WITH * UNWIND range(0, 9000) as unwound_data0
    MERGE (node0:Node {id: unwound_data0}) ON CREATE SET node0.dbcreated = time0
    WITH time0, collect(node0) as nodes0
    RETURN time0

If I simplify it to 

    UNWIND range(0, 9000) as unwound_data0
    MATCH (node0: Node)
    RETURN node0

It takes just as long. But if I change match to create, then its very fast.

Any ideas on how to speed this up?",1607085944,https://stackoverflow.com/q/65143834,Lucidnonsense,"['neo4j', 'cypher']"
65130450,Auto-Decryption Question from Computer Science Circles (Python),"I&#39;m doing this exercise from computer science circle. Here&#39;s the information:

&gt; Write a program which does the following. First, it should read one line of input, which is the encoded message, and will consist of capital letters and spaces. 
Your program must try decoding the message with all 26 possible values of the shift S; out of these 26 possible original messages, print the one which has the highest goodness.
For your convenience, we will pre-define the variable letterGoodness for you, a list of length 26 which equals the values in the frequency table above,
letterGoodness = [.0817,.0149,.0278,.0425,.1270,.0223,.0202,...

I&#39;ve done some coding but it kept saying &#39;list index out of range&#39; at line 24 (the letterGoodness[diff] line). I checked but couldn&#39;t find out why.

Here&#39;s the code:

```
#subtask 1: shifting values
a = input ()
def Decode(S):
   b = &quot;&quot;
   for i in range (0, len (a)):
      if a[i] != &quot; &quot;:
         if ord(a[i]) + int(S) &lt;= 90:
            c = chr(ord(a[i]) + int(S))
            b = b + c
         else:
            c = chr(ord(a[i]) + int(S) - 65)
            b = b + c
      else:
         b = b + a[i]
   return b
#subtask 2: determining goodness
goodness = 0
maxx = 0
for S in range (1, 27):
   b = Decode (S)
   for ii in range (0, len(b)):
      if b[ii] != &quot; &quot;: 
         diff = (ord(b[ii]) - 65)
         goodness = goodness + letterGoodness[diff]
         if goodness &gt; maxx:
            maxx = goodness
            out = b

print (out)
```
Thanks for reading this and helping me!! I really appreciate it :))",1607014387,https://stackoverflow.com/q/65130450,Grace,"['python', 'cypher', 'encryption', 'python-cryptography', 'cryptography']"
65130292,Cypher path thorugh only list of nodes,"I&#39;m using cypher and I need to build a query that returns paths that go from node &#39;START&#39; to node &#39;END&#39; only through specified nodes of type &#39;REGION&#39;, as in the picture:  

[Example][1]


  [1]: https://i.stack.imgur.com/PA79y.png

For example I want to get the paths that go only through node &#39;a&#39; and &#39;b&#39;, so I should get back &#39;Only 1&#39; and &#39;Only 2&#39;, and not &#39;Only 3&#39; as it can go through &#39;c&#39;.
My problem is to find a simple way to create a path without specifying which nodes to exclude.

The script I used to create the graph:

```
MERGE (st:START)
MERGE (nd1:END {name: &quot;Only 1&quot;})
MERGE (nd2:END {name: &quot;Only 2&quot;})
MERGE (nd3:END {name: &quot;Only 3&quot;})
MERGE (nd4:END {name: &quot;Other 2&quot;})

MERGE (a:Region {name: &quot;a&quot;})
MERGE (b:Region {name: &quot;b&quot;})
MERGE (c:Region {name: &quot;c&quot;})
MERGE (d:Region {name: &quot;d&quot;})

MERGE (st)&lt;-[:PART_OF]-(a)
MERGE (st)&lt;-[:PART_OF]-(b)
MERGE (st)&lt;-[:PART_OF]-(c)
MERGE (st)&lt;-[:PART_OF]-(d)

MERGE (a)&lt;-[:DEPENDS_ON]-(nd1)

MERGE (a)&lt;-[:DEPENDS_ON]-(nd2)
MERGE (b)&lt;-[:DEPENDS_ON]-(nd2)

MERGE (a)&lt;-[:DEPENDS_ON]-(nd3)
MERGE (b)&lt;-[:DEPENDS_ON]-(nd3)
MERGE (c)&lt;-[:DEPENDS_ON]-(nd3)

MERGE (a)&lt;-[:DEPENDS_ON]-(nd4)
MERGE (c)&lt;-[:DEPENDS_ON]-(nd4)
```

Thanks.",1607013898,https://stackoverflow.com/q/65130292,Yoni S,"['cypher', 'neo4j']"
65109911,How to insert knowledge for non concrete entrys in MongoDB,"I&#39;m new with MongoDB. I&#39;m trying to build a query I would do in Cypher like that:

    CREATE (a)-[:grandpaOf]-&gt;(b) where (a)-[:fatherOf]-&gt;()-&gt;[:fatherOf]-&gt;(b) return a, b

Is there a way of using variables like this in MongoDB? So I have some concrete entrys of who&#39;s whose father and I want one query that inserts me the grandfather thing for all these entries. ",1606918756,https://stackoverflow.com/q/65109911,Kathi,"['cypher', 'mongodb', 'variables']"
65109847,How optimised is this Cypher query?,"[Edit] I&#39;m using Neo4j 4.2.1

I have this need for a Cypher query that brings back a complete tree given its root node. All nodes and relationships must be fetched and present only once in the returned sets. Here&#39;s what I have come to:

    MATCH p = (n)-[*..]-&gt;(m)
    WHERE id(n) = 0
    WITH relationships(p) AS r
    WITH distinct last(r) as rel
    WITH [node IN [startNode(rel), endNode(rel)] | node] AS tmp, rel
    UNWIND tmp AS node
    RETURN collect(DISTINCT node) AS nodes, collect(distinct rel) AS relationships;

Running the query on our database to get about 820 nodes makes the thing crash for lack of memory (5Gb allowed). Hard to believe. So I&#39;m wondering : Is this query ill-born? Is there one technique I&#39;m using that shouldn&#39;t be used for my purpose?",1606918573,https://stackoverflow.com/q/65109847,Julian,"['cypher', 'query-optimization', 'neo4j']"
65099536,Cypher: Correlated variables in Union,"I need to answer the following query: Top-three store cities based on store sales and store sales for all the other cities combined.

With the following query

    // Top 3 cities
    MATCH (t:Store)&lt;-[:HasStore]-(s:Sales)
    WITH t.StoreCity AS StoreCity, t, sum(s.StoreSales) AS StoreSales
    ORDER BY sum(s.StoreSales) DESC LIMIT 3
    // All other cities
    WITH StoreCity, StoreSales, collect(t) AS TopThreeCities
    MATCH (t1:Store)&lt;-[:HasStore]-(s:Sales)
    WHERE NOT(t1 IN TopThreeCities)
    // JOIN of the two results -&gt; I would need the UNION
    RETURN StoreCity, StoreSales, &quot;Other cities&quot; AS StoreCity1, sum(s.StoreSales) AS StoreSales1

I was able to obtain the following answer


    &quot;A&quot;	10	&quot;Other Cities&quot;	50
    &quot;B&quot;	9	&quot;Other Cities&quot;	50
    &quot;C&quot;	8	&quot;Other Cities&quot;	50

But I would like to obtain

    &quot;A&quot;	10
    &quot;B&quot;	9
    &quot;C&quot;	8
    &quot;Other Cities&quot;	50

Any idea how to obtain this ? I have tried many possibilities without any success :-(",1606861918,https://stackoverflow.com/q/65099536,Esteban Zimanyi,"['correlated-subquery', 'union', 'neo4j', 'cypher']"
65097060,Union of queries depending on variable in list,"I have a big Cypher query that is depending on a variable.

Example:

`With REGION = &#39;Canada&#39;`

`query`


I want to execute this query several times based on different values on a list and return the UNION.

Something like:

`regions = [&#39;Canada&#39;,&#39;Europe&#39;]`

`query_with_Canada UNION query_with_Europe`",1606850269,https://stackoverflow.com/q/65097060,Guilherme Costa,"['cypher', 'neo4j']"
65089818,Questions with multiple matches in the same Cypher query,"Suppose I have the following graph 

    CREATE 
    (n1:Person {name: &quot;David Wallace&quot;, role: &quot;CFO&quot;, dept: &quot;management&quot;}),
    (n2:Person {name: &quot;Ryan Howard&quot;, role: &quot;VP, North East Region&quot;, dept: &quot;management&quot;}),
    (n3:Person {name: &quot;Toby Flenderson&quot;, role: &quot;HR Rep.&quot;, dept: &quot;HR&quot;}),
    (n4:Person {name: &quot;Michael Scott&quot;, role: &quot;Regional Manager&quot;, dept: &quot;management&quot;}),
    (n5:Person {name: &quot;Todd Pecker&quot;, role: &quot;Travel Sales Rep.&quot;, dept: &quot;Sales&quot;}),
    (n6:Person {name: &quot;Angela Martin&quot;, role: &quot;Senior Accountant&quot;, dept: [&quot;Accounting&quot;, &quot;Party Planning Committee&quot;]}),
    (n7:Person {name: &quot;Dwight Schrute&quot;, role: [&quot;Sales&quot;, &quot;Assistant to the Regional Manager&quot;], dept: &quot;Sales&quot;}),
    (n8:Person {name: &quot;Jim Halpert&quot;, role: [&quot;Sales&quot;, &quot;Assistant Regional Manager&quot;], dept: &quot;Sales&quot;}),
    (n9:Person {name: &quot;Pam Beesley&quot;, role: &quot;Receptionist&quot;, dept: &quot;Reception&quot;}),
    (n10:Person {name: &quot;Creed Barton&quot;, role: &quot;Quality Assurance Rep.&quot;, dept: &quot;Quality Control&quot;}),
    (n11:Person {name: &quot;Darryl Philbin&quot;, role: &quot;Warehouse Foreman&quot;, dept: &quot;Warehouse&quot;}),
    (n12:Person {name: &quot;Kevin Malone&quot;, role: &quot;Accountant&quot;, dept: &quot;Accounting&quot;}),
    (n13:Person {name: &quot;Oscar Martinez&quot;, role: &quot;Accountant&quot;, dept: &quot;Accounting&quot;}),
    (n14:Person {name: &quot;Meredith Palmer&quot;, role: &quot;Supplier Relations&quot;, dept: &quot;Supplier Relations&quot;}),
    (n15:Person {name: &quot;Kelly Kapoor&quot;, role: &quot;Customer Service Rep.&quot;, dept: &quot;Customer Service&quot;}),
    (n16:Person {name: &quot;Jerry DiCanio&quot;, dept: &quot;Warehouse&quot;}),
    (n17:Person {name: &quot;Madge Madsen&quot;, dept: &quot;Warehouse&quot;}),
    (n18:Person {name: &quot;Lonnie Collins&quot;, dept: &quot;Warehouse&quot;}),
    (n19:Person {name: &quot;Andy Bernard&quot;, role: &quot;Regional Director in Sales&quot;, dept: &quot;Sales&quot;}),
    (n20:Person {name: &quot;Phyllis Lapin&quot;, role: &quot;Sales&quot;, dept: &quot;Sales&quot;}),
    (n21:Person {name: &quot;Stanley Hudson&quot;, role: &quot;Sales&quot;, dept: &quot;Sales&quot;}),
    (n1)-[:manages]-&gt;(n2),
    (n2)-[:manages]-&gt;(n3),
    (n2)-[:manages]-&gt;(n4),
    (n2)-[:manages]-&gt;(n5),
    (n4)-[:manages]-&gt;(n6),
    (n4)-[:manages]-&gt;(n7),
    (n4)-[:manages]-&gt;(n8),
    (n4)-[:manages]-&gt;(n9),
    (n4)-[:manages]-&gt;(n10),
    (n4)-[:manages]-&gt;(n11),
    (n4)-[:manages]-&gt;(n14),
    (n4)-[:manages]-&gt;(n15),
    (n6)-[:manages]-&gt;(n12),
    (n6)-[:manages]-&gt;(n13),
    (n8)-[:manages]-&gt;(n19),
    (n11)-[:manages]-&gt;(n16),
    (n11)-[:manages]-&gt;(n17),
    (n11)-[:manages]-&gt;(n18),
    (n19)-[:manages]-&gt;(n20),
    (n19)-[:manages]-&gt;(n21);

and I have the following query

&gt; Does Michael directly manage more employees than Jim Halpert?

I come up with the following Cypher query 

    MATCH (p:Person)&lt;-[:manages]-(n:Person)
    WHERE n.name = &quot;Michael Scott&quot;
    MATCH (q:Person)&lt;-[:manages]-(m:Person)
    WHERE m.name = &quot;Jim Halpert&quot;
    RETURN count(p) &gt; count(q)

The query returns ```false```. I checked both ```count(p)``` and ```count(q)``` are 8. I was wondering why is this? Also, what&#39;s the scope of ```MATCH``` statement meaning will ```p``` and ```q``` bind to the different variables (i.e., variable only visible in the MATCH statement scope; I can re-use the same variable for different MATCH statement)?

Thanks!",1606822811,https://stackoverflow.com/q/65089818,xxks-kkk,"['neo4j', 'cypher']"
65082997,How do I use a python variable value to name a new node created in neo4j,"I have the following line of code

```tx.run(CREATE n)``` using the bolt library for neo4j to python.

I will be receiving a user input which I store in a variable, and I wish to name the node according to that. How should I approach this? Thanks

Another instance could be this. I get a CQL syntax error with this 

```def add_plyr(tx, playername_, username_):
    if(tx.run(&quot;MATCH(n:Player{name: playername_})&quot; &quot;RETURN n&quot;)):
        tx.run(&quot;CREATE (playername_:Player)&quot;)
        tx.run(&quot;MATCH(username_:User)(playername_:Player)&quot; &quot;CREATE (playername_)-[r:IN_TEAM]-&gt;(username_)&quot;)
    else:
        tx.run(&quot;MATCH(username_:User)(playername_:Player)&quot; &quot;CREATE (playername_)-[r:IN_TEAM]-&gt;(username_)&quot;)
```

The ```tx.run(&quot;CREATE (playername_:Player)&quot;)``` line throws up the following error

```neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: Variable `playername_` not defined (line 1, column 22 (offset: 21))
&quot;MATCH(n:Player{name: playername_})RETURN n&quot;```

                      ",1606781814,https://stackoverflow.com/q/65082997,Karl Stark,"['python', 'bolt', 'cypher', 'neo4j']"
65057865,neo4j shortest path with common relation property,"As the picture below shows we have nodes with relations but with different properties. how can I find shortest path between node A and node E with condition that relations in the path should have common property? for example here it only should give THE PATH with property &quot;a&quot; from node A to node B because a here is common.



[![unique labeled path][1]][1]


  [1]: https://i.stack.imgur.com/8BDr0.jpg

**Edit**
I want to find shortest path between node a and e based on available relations between a and next node (here relation properties are a, b and c) how can I find shortest path between a and e in which relations property is same(here property a)
for example it should return only  the path with property a (and the path would be a&gt;b&gt;d&gt;e)",1606634553,https://stackoverflow.com/q/65057865,M.B,"['cypher', 'shortest-path', 'neo4j', 'graph-databases', 'path']"
65047183,cypher aggregating common node type between two distinct node types,"[![Graph View][1]][1]

- I have two distinct types of nodes (LABELS in redisgraph). The blue circles in the diagram are called `WORKLOAD`. The yellow ones are called `API`.

- Between two workloads, there is a relationship/edge `ACCESSES_WORKLOAD` (indicated by the lightest blue/cyan edge). In the attached image, `front-end` workload accesses `user` and `order` workloads. The `order` workload accesses `user` workload.

- Between a `API` node and a `WORKLOAD` node there exists two types of relationships/edges. One is called a `CONTAINS_API` (dark blue link in the image) and another is called a `ACCESSES_API` (violet link in the image). For example, in the attached image, the `user` workload contains eight `API`s, Out of which six are consumed by `front-end` (the list: includes `3 /customers/...`, `/addresses`, `/register`, `/cards`). The two remaining `API`s are consumed by the `orders` (the list: `/cards/{cardsId}` and `/addresses/{addressesId}`.

- The `front-end` also accesses three `API` that are contained by the `orders` workload too (`/orders/...`)

- It is also possible that two `WORKLOAD`s may have an `ACCESSES_WORKLOAD` edge between them, but without any `API` as node as common between them.

- A `WORKLOAD` may have an extra edge/relationship called `CAUSES_ATTACK` to an `API` in addition to the `ACCESSES_API` edge. It is indicated by green color in the image. This may not exist always. In the attached image, the `front-end` workload has this edge to the `/catalogue/sock` API but not with any of the other `API`s.

Now I want to get the list of all workload-pairs and the ID of the `API` nodes in between them, if any. The cypher query that I tried is:
```
MATCH (w1)
MATCH (w1)-[awe:ACCESSES_WORKLOAD]-&gt;(w2 {deleted_time: -1})
OPTIONAL MATCH (w2)-[:CONTAINS_API]-&gt;(a:API)
OPTIONAL MATCH (w1)-[:ACCESSES_API]-&gt;(a)
OPTIONAL MATCH (w1)-[cae:CAUSES_ATTACK]-&gt;(a)
WHERE ID(w1) IN %s
RETURN DISTINCT awe, w1, w2, collect(ID(a)), collect(distinct cae.name)
```

An output that I was expecting was table like below:
```
w1             | w2          | API IDs List           | Attack Name
======================================================================
front-end-node | user-node   | [6 elements in a list] | null
orders-node    | user-node   | [2 elements in a list] | null
front-end-node | orders-node | [3 elements in a list] | null
front-end-node | some-node   | [1 element in a list]  | attack-name
```

But what I am getting is:

```
w1             | w2          | API IDs List           | Attack Name
======================================================================
front-end-node | user-node   | [8 elements in a list] | null
orders-node    | user-node   | [8 elements in a list] | null
front-end-node | orders-node | [3 elements in a list] | null
front-end-node | some-node   | [1 element in a list]  | attack-name
```

In the first two rows, for the `user` node, I am getting the list of all the `API`s contained by the `user` workload and not just the `API`s accessed by the `front-end` and `orders`. The `collect(ID(a))` is aggregating all the `API` nodes with a `CONTAINS_API` edge/relationship with the `w2 WORKLOAD` in the query instead of the `API`s with only `ACCESSES_API` with `w1 workload`.

If I were to map my expectation to JSON for brevity, the output I require will be like:
```
{
  sourceWorkloadID: &lt;ID(front-end)&gt;
  targetWorkloadID: &lt;ID(user)&gt;
  apis: [ ID(/cards), ID(/register), ID(/addresses), ID(/customers/...)]  // len here is six
  attack: null
},
{
  sourceWorkloadID: &lt;ID(orders)&gt;
  targetWorkloadID: &lt;ID(user)&gt;
  apis: [ ID(/cards/{cardsId), ID(/addresses/{addressesId})] // len here is two
  attack: null
}, {3rd row}, {4th row}
```

Can someone help fix the cypher query ? I am doing this in `redisgraph` via `cypher`. I cannot use neo4j-only query options/utils/helpers. Thanks.


  [1]: https://i.stack.imgur.com/pdDtZ.png",1606546269,https://stackoverflow.com/q/65047183,Sankar,"['redisgraph', 'cypher', 'graph-databases', 'redis', 'neo4j']"
65037257,Neo4j Returning object with aggregation like elasticsearch,"We have a graph of ecommerce products with node labels items,item_prices,brand,product_attributes. 
What is needed is something like Elasticsearch with aggreagtions/Facets along with query results.
Here&#39;s current query
````    
CALL db.index.fulltext.queryNodes(&#39;name_brand&#39;, &#39;heater or Winegar&#39;) 
YIELD node as srchresult 
CALL{

WITH srchresult 
CALL {

WITH srchresult 
MATCH (a:items)
WHERE a.item_id=srchresult.item_id
OPTIONAL MATCH (a:items)-[:ITEM_PRICE]-&gt;(ip:item_prices)-[:BUSINESS]-&gt;(b:businesses) 
WHERE a.item_id=srchresult.item_id AND EXISTS( (a)-[:ITEM_PRICE]-(ip) )
RETURN a,ip,b ORDER BY ip.sale_price LIMIT 1 

}

RETURN a,ip LIMIT 300 }
RETURN a.item_id,a.name,a.brand_name,a.ratings,a.ratings_count, 
ip.sale_price,ip.list_price,ip.seller_id,a.icon LIMIT 10
````

node with label item_attributes has attributes like 
````
{name:cpu,value:i7}
````
Now how to return them aggregated along with normal item search result. Returned results are to be 10 but aggregation has to be on 300.

Another Option is to just return aggregated item_id of 300 and run aggregation separetly on Elasticsearch with item_ids. For which again need to run same query again as there&#39;s no documentation to return aggregation (collect) with other result rows;",1606479547,https://stackoverflow.com/q/65037257,Avi,"['cypher', 'neo4j']"
65018933,Execute parallel create/merge using only Cypher,"I have a cypher script which loads the content from a CSV and then tries to load it into the graph. What it basically looks like is something similar to that:

    LOAD CSV WITH HEADERS
    FROM &#39;file:///data.csv&#39;
    AS row
    MERGE (o:Order {Id:toInteger(row.tr_ID)})
    	ON CREATE SET 
        	o.Created = toInteger(row.tr_Created)
    		
    // read credit card and create a relation to an order (if applicable)
    FOREACH (n IN CASE WHEN row.cc_CrdId = &#39;NULL&#39; THEN [] ELSE [1] END |
    	MERGE (cc:CreditCard {Id:row.cc_CrdId})
    		ON CREATE SET
    			cc.Created = toInteger(row.cc_CrdCreated)
    	MERGE (o)-[:WITH_CC]-&gt;(cc)
    )

This script reads the file row by row. But I was wondering if it is somehow possible to execute the logic for multiple rows in parallel.

I saw [this][1] article for parallel cypher but don&#39;t really understand how I could use it. I don&#39;t know if some kind of **lock** needs to be implemented.


  [1]: https://neo4j.com/labs/apoc/4.1/cypher-execution/parallel/",1606381580,https://stackoverflow.com/q/65018933,user2128702,"['cypher', 'neo4j']"
65005344,neo4j: Get last node in a path,"I&#39;m pretty new to neo4j and I managed to create nodes and relationships between them. But now I&#39;m trying to get the last nodes. Given I&#39;ve the following graph:

[![enter image description here][1]][1]

Each node references the previous day. Now I want start at &quot;Day 1&quot; to get the last node (&quot;Day 4&quot;) to determine it&#39;s date. How can I do this? After I read https://neo4j.com/docs/cypher-manual/current/functions/scalar/#functions-endnode I tried `MATCH mypath = (b:Days)&lt;-[prevDay]-(endnode) RETURN endNode(prevDay) AS lastDay`. Unfortunately this query returns me Day 1, Day 2 and Day 3. The last day (&quot;Day 4&quot;) is not returned. So how can I get &quot;Day 4&quot; only?

  [1]: https://i.stack.imgur.com/A0qyi.png",1606309767,https://stackoverflow.com/q/65005344,Nrgyzer,"['neo4j', 'cypher']"
64994974,After update to neo4j 4.2 not work apoc functions from reader role,"neo4j version 4.2.0

apoc version 4.2.0.0

After update to neo4j 4.2 not work apoc functions from reader role, return error:

&gt; message: Executing a user defined function is not allowed for user
&gt; &#39;User&#39; with roles [PUBLIC, reader].

Yes, it&#39;s qute simple just find in docs need to run script for grant privileges:

    GRANT EXECUTE FUNCTION apoc.* ON DBMS TO reader

But here start real problems it&#39;s return error:

&gt; This operation is not supported while running in compatibility mode
&gt; with version Neo4j 4.1

Can&#39;t find anything about this *compatibility* in google or in config, run with spicifig cypher version like this not help:

    CYPHER 4.2 GRANT EXECUTE FUNCTION apoc.* ON DBMS TO reader
    ",1606252689,https://stackoverflow.com/q/64994974,Atterratio,"['cypher', 'neo4j-apoc', 'neo4j']"
64976869,Neo4j path query / sorting properties in path,"Pretty simple shortest path query on the Movies data set:

    MATCH path=shortestPath((p1:Person)-[*0..15]-(p2:Person)) WHERE toLower(p1.name) = toLower(&#39;Halle Berry&#39;) AND toLower(p2.name) = toLower(&#39;Tom Hanks&#39;) 
    RETURN relationships(path) AS relationships, nodes(path) AS nodes

How can I sort the roles array? I.e. on this particular movie, they had a bunch of roles. I can sort it on the app side, but would be nice to do it on the Neo side. When it comes to Nodes, I&#39;ve been doing this with UNWIND, but that doesn&#39;t seem to work on path properties.",1606167469,https://stackoverflow.com/q/64976869,SledgeHammer,"['cypher', 'neo4j']"
64962352,Is it possible to query relations from two node which the number of relation greater than a certain value,"I am a newbie who just started learning graph database and I have a problem querying the relationships between nodes.

My graph is like this:

![enter image description here][1]

[1]: https://i.stack.imgur.com/96QMf.png

There are multiple relationships from one node to another, and the IDs of these relationships are different.

How to find relationships where the number of relationships between two nodes is greater than 2，or is there a problem with the model of this graph?

Just like on the graph, I want to query node **d** and node **a**.

I tried to use the following statement, but the result is incorrect:

    match (from)-[r:INVITE]-&gt;(to)
    with from, count(r) as ref
    where ref &gt;2
    return from

It seems to count the number of relations issued by all from, not the relationship between from--&gt;to.
",1606103727,https://stackoverflow.com/q/64962352,Ran,"['neo4j', 'cypher']"
64953388,Query Neo4j for many date ranges,"I am using neo4j database. For each relationship, I keep a pair of dates in properties that spacify when the relationship holds e.g.
```
{
  &quot;identity&quot;: 1,
  &quot;type&quot;: &quot;HAS_NAME&quot;,
  &quot;properties&quot;: {
	  &quot;start&quot;: 1989,
	  &quot;end&quot;: 1990
  }
}
```
which means, that the relationship was true between 1989 and 1990. Now, I would like to extend properties to have many pairs of dates e.g.
```
{
  &quot;identity&quot;: 1,
  &quot;type&quot;: &quot;HAS_NAME&quot;,
  &quot;properties&quot;: {
	  &quot;start1&quot;: 1989,
	  &quot;end1&quot;: 1990,
	  &quot;start2&quot;: 2001,
	  &quot;end2&quot;: 2002,
	  &quot;start3&quot;: 2010,
	  &quot;end3&quot;: 2015,
	  ...
  }
}
```
which means, that the relationship was true between 1989 and 1990 and also between 2001 and 2002 and between 2010 and 2015. I would like to be able to query for relationships by dates, e.g. &quot;find all relationships that were true between `queryStart` and `queryEnd`&quot;. 

In the above example, I could write
```
WHERE (queryEnd &gt; start1 AND queryStart &lt; end1) 
OR (queryEnd &gt; start2 AND queryStart &lt; end2) 
OR (queryEnd &gt; start3 AND queryStart &lt; end3)
```

However, I do not know how many pairs the relationship will have. Is there a standard approach to achieve that in neo4j? I do not have to keep those dates in properties.",1606043104,https://stackoverflow.com/q/64953388,rarry,"['cypher', 'neo4j']"
64947597,Search paths where all nodes are in a relationship with same node,"Using the below graph as an example: I am trying to determine all ***Persons*** which ***are_sons*** of ***Persons*** all ***born*** in the same country:

[![Graph][1]][1]

Is there an elegant way to achieve this with Cypher?


  [1]: https://i.stack.imgur.com/XabEK.jpg",1605989609,https://stackoverflow.com/q/64947597,Guilherme Costa,"['cypher', 'neo4j']"
64945298,Nested UNWIND not returning from higher UNWIND in Cypher query,"I have the following query

    UNWIND $towns as town
    MERGE (a:area:Town {Name: town.name, uuid: town.uuid}) with a, town
    MATCH (p:parish{Name: town.parish}) with a, p, town
    MERGE (a)-[:in]-(p) with a, town
    UNWIND town.categories as category
    MATCH (c:LocationCategory {uuid: category}) 
    MERGE (a)-[:category]-(c) 
    RETURN a

`town.categories` can be null so I&#39;m guessing the second `UNWIND` doesn&#39;t return a row for the null values of the categories, fine. But I&#39;don&#39;t care about returning any row from the second unwind because it might not return any. But I want to return all the original `a` nodes. How do I break the second unwind so I can return `a` regularly as if it wasn&#39;t there?",1605975473,https://stackoverflow.com/q/64945298,Deeswoc,"['neo4j', 'cypher']"
64940321,Fetch nodes according to parents and two way relations,"I have to solve some problem with &quot;complex&quot; queries in Cypher. Maybe this is simple for an expert but I am a complete newbie.

With these relations, I need to know if given a list of items and a particular item, I could use it.
Some items enables to use other items, and some items need (required) items.

[items_relations][1]

Examples (see image):
- If I have Item A, could I use Item B? Yes
- If I have Item B, could I use Item D? Yes
- If I have Item B, could I use Item E? No, because Item C is also requerid.
- If I have Item A and B, could I use Item E? No, because Item C is also requerid.
- If I have Item A and B and C, could I use Item E? Yes.

I know my list of items, not empty, ex: [&#39;Item A&#39;, &#39;Item B&#39;]
and the item I need, ex: &#39;Item D&#39;

Return can be a Boolen or the needed item.

The graph can be created with this:
```
MERGE (n:Item {name: &#39;Item A&#39; });
MERGE (n:Item {name: &#39;Item B&#39; });
MERGE (n:Item {name: &#39;Item C&#39; });
MERGE (n:Item {name: &#39;Item D&#39; });
MERGE (n:Item {name: &#39;Item E&#39; });

MATCH (it: Item { name: &#39;Item A&#39; })
  MATCH (otherIt: Item { name: &#39;Item B&#39; })
  MERGE (it)-[:Enables]-&gt;(otherIt);

MATCH (it: Item { name: &#39;Item A&#39; })
  MATCH (otherIt: Item { name: &#39;Item C&#39; })
  MERGE (it)-[:Enables]-&gt;(otherIt);

MATCH (it: Item { name: &#39;Item B&#39; })
  MATCH (otherIt: Item { name: &#39;Item D&#39; })
  MERGE (it)-[:Enables]-&gt;(otherIt);

MATCH (it: Item { name: &#39;Item B&#39; })
  MATCH (otherIt: Item { name: &#39;Item E&#39; })
  MERGE (it)-[:Enables]-&gt;(otherIt);

MATCH (it: Item { name: &#39;Item C&#39; })
  MATCH (otherIt: Item { name: &#39;Item E&#39; })
  MERGE (it)-[:Enables]-&gt;(otherIt);

MATCH (it: Item {name: &#39;Item B&#39;})
 MATCH (req: Item {name: &#39;Item E&#39;})
 MERGE (req)-[:Requires]-&gt;(it);

MATCH (it: Item {name: &#39;Item C&#39;})
 MATCH (req: Item {name: &#39;Item E&#39;})
 MERGE (req)-[:Requires]-&gt;(it);
```


  [1]: https://i.stack.imgur.com/iU4wO.png",1605938505,https://stackoverflow.com/q/64940321,LeaTex,"['relationship', 'cypher', 'neo4j', 'graph', 'nodes']"
64939356,Neo4j: Cypher return duplicate result,"For test case as below
```
create
(user:B{bid : 1234, arn : &#39;foo&#39;, customerHash : &#39;hariom&#39;}),
(user2:B{bid : 1234, arn : &#39;foo2&#39;, customerHash : &#39;hariom&#39;}),
(user3:B{bid : 1234, arn : &#39;foo3&#39;, customerHash : &#39;hariom&#39;}),
(group:A{bid : 1234, groupId : &#39;fooGroup&#39;, customerHash : &#39;hariom&#39;}),
(group2:A{bid : 1234, groupId : &#39;fooGroup2&#39;, customerHash : &#39;hariom&#39;})

Create
(group)-[r3:A_B]-&gt;(user),
(group)-[r4:A_B]-&gt;(user3)
```
When I run the below query
```
Match (x1:A) with x1 
optional Match (x1)-[A_B]-(x2:B) with x1 , count(x2) as x3 
optional Match (x1)-[A_B]-(x4:B) with x1 , x3 , x4 
where x1.customerHash= &#39;hariom&#39; and x1.bid in [1234] and x3 = 2 and x4.arn CONTAINS &#39;foo&#39; 
return x1 as AwsIamGroup SKIP 0 LIMIT 10
```
i get duplicated nodes for node with groupId = fooGroup. I can use distinct to filter out duplicated results.
 
Why am I getting duplicated results?

What is the performance impact of using DISTINCT clause?",1605926977,https://stackoverflow.com/q/64939356,Nischal Kumar,"['cypher', 'neo4j']"
64934044,Neo4j ORDER BY custom sorting?,"I have a query where a part of it looks like:

    WITH ... person ORDER BY person.name

The issue is that person.name contains the full name i.e. &quot;Albert Einstein&quot;. So Albert Einstein appears before &quot;Peter Albert&quot;.

Is there a way to do the order by on the persons last name? I.e. some kind of custom comparator? Of course, taking into account one name people like Madonna :).

I know I could go into the data and split all the names, but I&#39;d like to avoid doing that if possible. ",1605893136,https://stackoverflow.com/q/64934044,SledgeHammer,"['spring-data-neo4j', 'neo4j', 'cypher']"
64918717,Setting multiple porerties using paramters- neo4j cypher,"I want to set the name and desripion of an object using parameters. I tried a statement but it doesn&#39;t work. 
````
             MATCH(user: User{ID: $userId})&lt;-[:CREATED_BY]-(cart: Cart {ID: $cartId})
             SET cart.name = $name, cart.description = $description
             RETURN cart
````
all the variables are properly initialized. THis statement works if I use the values directly instead of using parameters. but doesn&#39;t work when i use paramters. ",1605814231,https://stackoverflow.com/q/64918717,Nourish Cherish,"['cypher', 'javascript', 'neo4j']"
64912100,Cypher paged-listing query optimization,"We have the following data model in a Neo4j database.
Nodes with label **Post**, and nodes with **User**

The relation between **Post** and **User** is *(Post)-[:POSTED_BY]-&gt;(User)*. It indicates that a post was created by the given user.

On Post nodes, there is a property named `sort_order` which gives the order by which post nodes should be retrieved. The `sort_order` is **unique** and **index-backed**; a unique constraint is enforced in the schema.

In a listing request, I need to get the posts for a given user ordered by `sort_order`, and in pages of 10 (for example)

According to [Neo4j Documentation][1], the order operation is skipped by the planner because the nodes are already ordered based on the index of the selected property `sort_order`. This limits the database hits and time required to complete the query by the selected page size. This applies perfectly for such a query:

    MATCH (post:Post)
    where post.sort_order &gt; 0
    return post
    order by post.sort_order desc
    limit 10
if the hint `post.sort_order &gt; 0` is given.

Once I need to retrieve the posts by a given **User**, the query will fetch all Post nodes related to the selected User ordering them in memory, and returning the current page (of 10 records). After profiling the following required query, it appears to ignore the index.

    MATCH (post:Post)-[:IN]-&gt;(user:User {id: 3})
    where post.sort_order &gt; 0
    return post
    order by post.sort_order desc
    limit 10

Is there are any hidden problems in the query or the data model ?

Or, if any optimizations can be done to the query, data model, or indices.

The used neo4j version is 3.5.23

  [1]: https://neo4j.com/docs/cypher-manual/current/query-tuning/advanced-example/#advanced-query-tuning-example-index-backed-order-by",1605790448,https://stackoverflow.com/q/64912100,Oday Fraiwan,"['cypher', 'graph-databases', 'neo4j']"
64904074,Return nodes which do not have a property value in another node set,"I&#39;m rather new to Neo4j, but have not been able to find what I&#39;m looking for in the documentation. I&#39;m using version 3.5 which does not support sub queries.

I have two sets of nodes, which for simplicity&#39;s sake I&#39;ll call ```Rocks``` and ```Bicycles```. These sets have some similar properties, but no relationships and they are entirely distinct - there are no nodes in ```Rocks``` which are in ```Bicycles```. However, they may have the same value for a particular property called &quot;color&quot;. But for a node in ```Rocks``` that property is spelled ```color``` and for a node in ```Bicycles``` it&#39;s spelled ```colour```.

What I want is to return all the nodes in ```Bicycles``` which do not have a ```colour``` value found in any of the nodes in ```Rocks```.

Here&#39;s my query to return all the colors of the nodes in ```Rocks```:
```
MATCH (r:Rocks) WITH r.color AS excludecolors RETURN excludecolors
```

Which returns exactly what I expect - a list of hex values for the colors: ```[&quot;ff5733&quot;, &quot;#0a8a00&quot;, &quot;4f28ff&quot;, ...]```

Now I want to return all the colors in ```Bicycles``` *EXCLUSIVE* of the colors that I found in the set of ```Rocks```
```
MATCH (r:Rocks) WITH r.color AS excludecolors RETURN excludecolors
MATCH (b:Bicycles) WHERE NOT b.colour IN [excludecolors] RETURN DISTINCT b.colour
```

However, this returns everything in Bicycles - including the colors in ```excludecolors```! I can exclude them manually by entering particular values I want to exclude:

```
MATCH (b:Bicycles) WHERE NOT b.colour IN [&quot;ff5733&quot;, &quot;#0a8a00&quot;] RETURN DISTINCT b.colour
```

but there are far too many to do by hand. How can I return only the colors found in ```Bicycles``` and not in ```Rocks```? The closest equivalent I can think of would be the SQL outer join, but I&#39;m quite stumped about how to do this in cypher",1605749707,https://stackoverflow.com/q/64904074,hello_internet,"['cypher', 'neo4j']"
64899649,Adding a Relationship Property to a return node using C# neo4j client?,"I have this query where two nodes of the same label could have a relationship:

```
Match (n:MyObject)-[r:SOME_RELATIONSHIP]-&gt;(n1:MyObject) Return n, n1
```

The :SOME_RELATIONSHIP has properties that I wanted to access in a cypher query using C#. While I can return the following:

```
Match (n:MyObject)-[r:SOME_RELATIONSHIP]-&gt;(n1:MyObject) Return n, n1, r.propertyToGet
```

Is it possible to return say n1 with an additional property from the relationship? So say n1 has 4 properties, it will be 5 with the new property coming from the relationship?

eg:

``` 
{
  &quot;n1&quot; : {
    &quot;originalprop1&quot;: &quot;somevalue1&quot;,
    &quot;originalprop2&quot;: &quot;somevalue2&quot;,
    &quot;originalprop3&quot;: &quot;somevalue3&quot;,
    &quot;originalprop4&quot;: &quot;somevalue4&quot;,
    &quot;newprop&quot;: &quot;value_from_relationship&quot;,
  }
}
```",1605726075,https://stackoverflow.com/q/64899649,Patrick,"['cypher', 'neo4j']"
64893476,How to count the number of common nodes in Neo4j - query,"I have graph database (neo4j) with two nodes: **Person**, **Word**. 
The **Person** node is in relation with **Word**, and for example two Person nodes can be combined with the same Word. 

I would like to return count of Word nodes, which are with the relationship between two Persons (two persons have relationship with the same word). 

For example I have the nodes `Person {name: &#39;Bart}&#39;` and `Person {name: &#39;Jack&#39;}`. I would like to count how many Word nodes have relationship with this two persons pic rel
[![example graph database][1]][1]


  [1]: https://i.stack.imgur.com/X0SQ5.png",1605703751,https://stackoverflow.com/q/64893476,Bartłomiej Olech,"['cypher', 'neo4j', 'graph-databases']"
64893270,Neo4j delete swapped duplicates in results,"I want to find method-pairs that read or write the same field, for this i wrote this query:

    match (c:Class)-[:DECLARES]-&gt;(m1:Method), (c)-[:DECLARES]-(m2:Method), (c)-[:DECLARES]-(f:Field), (m1)-[:WRITES|READS]-&gt;(f), (m2)-[:WRITES|READS]-&gt;(f) 
    return m1.name, m2.name, f.name

Now i have the problem, that there are several duplicates in the results. 

[![enter image description here][1]][1]

I want every &quot;m1.name&quot; and &quot;m2.name&quot; pair to be unique. Is there a way to filter out results that are swaped versions of other results? 


  [1]: https://i.stack.imgur.com/BV7QU.png",1605702980,https://stackoverflow.com/q/64893270,Norwort,"['cypher', 'neo4j']"
64883345,depth in nodes of the same label in custom query,"I have in my database `Company` with:
```
@Relationship(type = &quot;COLLECTS_FROM&quot;)
private Set&lt;Company&gt; subCompanies
```

What I&#39;m trying to achieve is to create two queries:
 - get the company with limited depth 2 for nodes of the same type (so company which collects from different companies, which collects from different companies)
 - get the company with full depth for nodes of the same type (similar to previous, but just all the way down without any limitations.

I had a few attempts to solve this and here are those:
 - first approach was to use `findById(ID,2)` and `findById(ID,999999)`, but this query has a huge performance drop and I ran into StackOverflow exception, that&#39;s why I&#39;m trying to create my own methods similar to what I found [here][1].

 - second approach was to use custom query (which were actually working in case of different node types):

```
    @Query(&quot;Match (company:Company {name:$name})-[relation:COLLECTS_FROM*0..2]-&gt;(secondCompany:Company) RETURN company,relation,secondCompany&quot;)
    Company customerWithCustomDepth(String name);
```
Unfortunately while using the same node types I ran into the `IncorrectResultSizeDataAccessException: Incorrect result size: expected at most 1` and when I changed return type to the list 3 records were returned (actually the first one of them is what I would like to get, but it seems like specifying `secondCompany` in the return statement populates nodes that I don&#39;t want to have in my return type.

 - on the third approach I did similar to the second, but it also returned 3 rows (the first one is what I wanted).
```
@Query(&quot;Match p = (company:Company {name:$name})-[relation:COLLECTS_FROM*0..2]-&gt;(secondCompany:Company) RETURN p&quot;)
```

 - and fourth one once again 3 companies, instead of a single one (the first one is what I wanted)
```
@Query(&quot;MATCH (company:Company {name:$name} ) WITH company MATCH p=(company)-[COLLECTS_FROM*0..2]-&gt;(m) RETURN p&quot;)
```

And that&#39;s basically it. I feel like I&#39;m close, but a little detail is missing. Maybe instead of trying to fix the query, I should somehow limit the result to get the first row from the Query? Any help will be really appreciated.

**update after receiving @cybersam answer:**

The general purpose of this query is to create a tree graph, that&#39;s why I would like to get a company with their sub-companies inside (and companies in the sub-companies), not only the parent one.

I could use second, or third approach and just grab the first element on the server side:
```
result.stream()
.findFirst()
.orElseThrow();
```
but I believe it should be able to do it on the service side.



  [1]: https://stackoverflow.com/questions/36488427/why-is-findoneid-depth-getting-unacceptably-slow-performance-when-adding",1605647275,https://stackoverflow.com/q/64883345,degath,"['cypher', 'spring-data-neo4j', 'neo4j', 'spring-data']"
64881497,Java + SpringBoot + Neo4j : Is there a way to bypass the OGM?,"I would like to perform Cypher queries from my Java code and get JSON replies, just as I would get in Neo4j&#39;s Browser app. That is, get unmapped results, and retrieve the nodes and relationships descriptions I would get otherwise. Is it possible?",1605639086,https://stackoverflow.com/q/64881497,Julian,"['java', 'spring-boot', 'cypher']"
64875641,Unable to Launch the Neo4j Console App After Upgrade to macOS Big Sur,"Yesterday, I upgraded my iMac to macOS Big Sur. When I attempted to launch the Neo4j Console app in Terminal, it returned a series of errors. I was running 3.5.20 of the Community Server. 

I thought I could resolve these errors by installing the latest version of the Community Server. I downloaded and installed version 3.5.24. When I attempted to launch the 3.5.24 database, it returned the following errors, which are similar to those version 3.5.20 produced.

    Starting Neo4j.
    2020-11-17 12:36:06.242+0000 WARN  dbms.active_database is deprecated.
    2020-11-17 12:36:06.275+0000 INFO  ======== Neo4j 3.5.24 ========
    2020-11-17 12:36:06.299+0000 INFO  Starting...
    2020-11-17 12:36:15.159+0000 ERROR Failed to start Neo4j: Starting Neo4j failed: Component &#39;org.neo4j.server.database.LifecycleManagingDatabase@39993624&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;The jurisdiction policy files are not signed by the expected signer! (Policy files are specific per major JDK release.Ensure the correct version is installed.)&quot;. Starting Neo4j failed: Component
    
    &#39;org.neo4j.server.database.LifecycleManagingDatabase@39993624&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;The jurisdiction policy files are not signed by the expected signer! (Policy files are specific per major JDK release.Ensure the correct version is installed.)&quot;.
    org.neo4j.server.ServerStartupException: Starting Neo4j failed: Component &#39;org.neo4j.server.database.LifecycleManagingDatabase@39993624&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;The jurisdiction policy files are not signed by the expected signer! (Policy files are specific per major JDK release.Ensure the correct version is installed.)&quot;.
    	at org.neo4j.server.exception.ServerStartupErrors.translateToServerStartupError(ServerStartupErrors.java:45)
    	at org.neo4j.server.AbstractNeoServer.start(AbstractNeoServer.java:187)
    	at org.neo4j.server.ServerBootstrapper.start(ServerBootstrapper.java:124)
    	at org.neo4j.server.ServerBootstrapper.start(ServerBootstrapper.java:91)
    	at org.neo4j.server.CommunityEntryPoint.main(CommunityEntryPoint.java:32)
    
    Caused by: org.neo4j.kernel.lifecycle.LifecycleException: Component &#39;org.neo4j.server.database.LifecycleManagingDatabase@39993624&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;The jurisdiction policy files are not signed by the expected signer! (Policy files are specific per major JDK release.Ensure the correct version is installed.)&quot;.
    	at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:473)
    	at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:111)
    	at org.neo4j.server.AbstractNeoServer.start(AbstractNeoServer.java:180)
    	... 3 more
     
    Caused by: java.lang.RuntimeException: Error starting org.neo4j.graphdb.facade.GraphDatabaseFacadeFactory, /Users/ciro/Applications/neo4j-community-3.5.24/data/databases
    	at org.neo4j.graphdb.facade.GraphDatabaseFacadeFactory.initFacade(GraphDatabaseFacadeFactory.java:232)
    	at org.neo4j.graphdb.facade.GraphDatabaseFacadeFactory.newFacade(GraphDatabaseFacadeFactory.java:148)
    	at org.neo4j.server.database.CommunityGraphFactory.newGraphDatabase(CommunityGraphFactory.java:41)
    	at org.neo4j.server.database.LifecycleManagingDatabase.start(LifecycleManagingDatabase.java:90)
    	at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:452)
    	... 5 more
     
    Caused by: org.neo4j.kernel.lifecycle.LifecycleException: Component &#39;org.neo4j.bolt.BoltServer@e156110&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;The jurisdiction policy files are not signed by the expected signer! (Policy files are specific per major JDK release.Ensure the correct version is installed.)&quot;.
    	at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:473)
    	at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:111)
    	at org.neo4j.graphdb.facade.GraphDatabaseFacadeFactory.initFacade(GraphDatabaseFacadeFactory.java:227)
    	... 9 more
     
    Caused by: java.lang.ExceptionInInitializerError
    	at javax.crypto.Cipher.getInstance(Cipher.java:518)
    	at sun.security.ssl.JsseJce.getCipher(JsseJce.java:189)
    	at sun.security.ssl.SSLCipher.isTransformationAvailable(SSLCipher.java:483)
    	at sun.security.ssl.SSLCipher.&lt;init&gt;(SSLCipher.java:472)
    	at sun.security.ssl.SSLCipher.&lt;clinit&gt;(SSLCipher.java:81)
    	at sun.security.ssl.CipherSuite.&lt;clinit&gt;(CipherSuite.java:67)
    	at sun.security.ssl.SSLContextImpl.getApplicableSupportedCipherSuites(SSLContextImpl.java:345)
    	at sun.security.ssl.SSLContextImpl.access$100(SSLContextImpl.java:46)
    	at sun.security.ssl.SSLContextImpl$AbstractTLSContext.&lt;clinit&gt;(SSLContextImpl.java:577)
    	at java.lang.Class.forName0(Native Method)
    	at java.lang.Class.forName(Class.java:264)
    	at java.security.Provider$Service.getImplClass(Provider.java:1728)
    	at java.security.Provider$Service.newInstance(Provider.java:1686)
    	at sun.security.jca.GetInstance.getInstance(GetInstance.java:236)
    	at sun.security.jca.GetInstance.getInstance(GetInstance.java:164)
    	at javax.net.ssl.SSLContext.getInstance(SSLContext.java:156)
    	at io.netty.handler.ssl.JdkSslContext.&lt;clinit&gt;(JdkSslContext.java:73)
    	at io.netty.handler.ssl.SslContext.newServerContextInternal(SslContext.java:465)
    	at io.netty.handler.ssl.SslContextBuilder.build(SslContextBuilder.java:571)
    	at org.neo4j.ssl.SslPolicy.nettyServerContext(SslPolicy.java:81)
    	at org.neo4j.bolt.BoltServer.createSslContext(BoltServer.java:202)
    	at org.neo4j.bolt.BoltServer.createProtocolInitializer(BoltServer.java:170)
    	at org.neo4j.bolt.BoltServer.lambda$createConnectors$0(BoltServer.java:149)
    	at java.util.stream.Collectors.lambda$toMap$58(Collectors.java:1321)
    	at java.util.stream.ReduceOps$3ReducingSink.accept(ReduceOps.java:169)
    	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1384)
    	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
    	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
    	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
    	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
    	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
    	at org.neo4j.bolt.BoltServer.createConnectors(BoltServer.java:149)
    	at org.neo4j.bolt.BoltServer.start(BoltServer.java:124)
    	at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:452)
    	... 11 more
     
    Caused by: java.lang.SecurityException: Can not initialize cryptographic mechanism
    	at javax.crypto.JceSecurity.&lt;clinit&gt;(JceSecurity.java:93)
    	... 45 more
     
    Caused by: java.lang.SecurityException: The jurisdiction policy files are not signed by the expected signer! (Policy files are specific per major JDK release.Ensure the correct version is installed.)
    	at javax.crypto.JarVerifier.verifyPolicySigned(JarVerifier.java:336)
    	at javax.crypto.JceSecurity.loadPolicies(JceSecurity.java:378)
    	at javax.crypto.JceSecurity.setupJurisdictionPolicies(JceSecurity.java:323)
    	at javax.crypto.JceSecurity.access$000(JceSecurity.java:50)
    	at javax.crypto.JceSecurity$1.run(JceSecurity.java:85)
    	at java.security.AccessController.doPrivileged(Native Method)
    	at javax.crypto.JceSecurity.&lt;clinit&gt;(JceSecurity.java:82)
    	... 45 more

The database was running just fine before the upgrade. Has anyone experienced this error? Any ideas on how to get the Community Server database working again?

Thanks in advance for your help.

Regards,
Ciro



",1605617528,https://stackoverflow.com/q/64875641,Ciro Pinto-Coelho,"['cypher', 'neo4j', 'java']"
64867381,Loosing the ability to sort/filter on custom queries in GRANDstack,"I&#39;m trying to enhance my existing GRANDstack application by implicitly filtering some types. You may also think of this as access-control.

I have a type called HousingUnit. Previously, the Query for HousingUnit was automatically created through schema augmentation. Now I want to limit the returned HousingUnits via a pattern. The request to /graphql will carry a JWT which has some information that will be made available as cypherParams (e.g. userEmail) to identify the current user. For HousingUnit (and other types) I only want to return the types that are CREATED_BY the Organization the user is a part of. A solution for the HousingUnit query looks like this.

```javascript
HousingUnit: async (parent, info, context, resolveInfo) =&gt; {
      const session = context.driver.session()
      const cypher = `MATCH (u:UserAccount) WHERE u.email = $cypherParams.userEmail MATCH (u)-[:WORKS_FOR]-&gt;(o:Organization)
        WITH o
        MATCH (o)&lt;-[:WORKS_FOR]-(:UserAccount)&lt;-[:CREATED_BY]-(housingUnit:HousingUnit) RETURN housingUnit`
      const results = await session
        .run(cypher, {
          cypherParams: context.cypherParams,
        })
        .then((result) =&gt; {
          return result.records.map((record) =&gt; {
            const obj = record.toObject()
            console.log(obj)
            return obj.housingUnit.properties
          })
        })
        .catch(console.log)
        .then((results) =&gt; {
          session.close()
          return results
        })
      return results
    },
```

My problem is that due to my explicit cypher query and return of results, I can not due any other filtering or sorting.

The requests

```graphql
query {
  HousingUnit(orderBy:name_asc) {
    name
  }
}
```

and

```graphql
query {
  HousingUnit(orderBy:name_desc) {
    name
  }
}
```

will yield the same order of results.
Furthermore, we have a lot of different types and I hope there&#39;s a simpler way of doing this (maybe middleware or decorators, reusing augmented queries).",1605570615,https://stackoverflow.com/q/64867381,manonthemat,"['graphql', 'neo4j', 'grandstack', 'apollo-server', 'cypher']"
64848507,Cypher query to recursively traverse family tree?,"Querying a graph database with Cypher, I&#39;m trying to walk an indefinite distance up a tree from a starting node, and return each node with information about that node&#39;s relationships. 

For example, take a family tree:

[![enter image description here][1]][1]

I&#39;d like to start at &quot;James&quot; (node id 4), and get a response with rows for each node along with the edge data defining that node&#39;s relationships. 

If I do something like: 

```
MATCH (p:Person)&lt;-[r:Related]-(p2:Person)
WHERE id(p)=4
RETURN p, r, p2
```

I get

[![enter image description here][2]][2]

To get rid of the duplicated data, I can collect some of the results like:

```
MATCH (p:Person)&lt;-[r:Related]-(p2:Person)
WHERE id(p)=4
RETURN id(p), p, collect(r.relationship), collect(id(p2))
```

gives me

[![enter image description here][3]][3]

But I still only have the initial node. How do I expand this to include rows in this format (or something similar) for each node all the way up the tree, including the leaf nodes? 


  [1]: https://i.stack.imgur.com/VNklI.png
  [2]: https://i.stack.imgur.com/bVJhd.png
  [3]: https://i.stack.imgur.com/5eYPp.png",1605466499,https://stackoverflow.com/q/64848507,nicholas,"['cypher', 'redisgraph']"
64838643,"Return actors and movies, which where not directed by a specific director, but have worked together with this director in other movies. Cypher (neo4j)","For example: 

The query below will return the 10 actors with the most co-operations with Lana Wachowski. 
```
MATCH (actor:Person)-[:ACTED_IN]-&gt;(m:Movie)&lt;-[:DIRECTED]-(lana:Person {name:  &#39;Lana Wachowski&#39;})
RETURN actor.name , COUNT(m), collect(m.title)
ORDER by COUNT(m) desc
LIMIT 10
```

However I want a query which will return the movies the above actors :ACTED_IN, which were not directed by Lana Wachoswki,

I did something like this, but eventually will return me all the actors who had a co-operation with this director and not the top 10 in an order.

```
MATCH (actor:Person)-[:ACTED_IN]-&gt;(m:Movie)&lt;-[:DIRECTED]-(lana:Person {name:  &#39;Lana Wachowski&#39;}),
(actor:Person)-[:ACTED_IN]-&gt;(other:Movie)
WITH actor, other
WHERE NOT EXISTS((lana)-[:DIRECTED]-&gt;(other:Movie)&lt;-[:ACTED_IN]-(actor))
RETURN actor.name , other.title
```
",1605388195,https://stackoverflow.com/q/64838643,KostasM,"['cypher', 'neo4j']"
64832428,Cypher request: How to iterate through keyword node property with variable and next create a relationship if it appears in article nodes?,"In my Neo4j database I have ARTICLE nodes and KEYWORD nodes which I would like to link automatically only if the keyword appears in the article title. 

I would like to iterate throught all KEYWORD nodes with a variable to see with fulltext (CALL db.index.fulltext.queryNodes) if it APPEARS_IN the ARTICLE node. And if it appears in I create a relationship between the ARTICLE node and the KEYWORD node.

First we have to do this:

1)`CALL db.index.fulltext.createNodeIndex(&quot;titleInArticle&quot;,[&quot;ARTICLE&quot;],[&quot;title&quot;])`

2)And next this is the idea:

    FOREACH $keyword IN TOPIC_NODE
    WITH $keyword  as keyword
    MATCH (k:KEYWORD { name: $keyword  })
    WITH k
    CALL db.index.fulltext.queryNodes(&quot;titleInArticle&quot;, keyword) YIELD node, score
    CREATE (node)-[:TALKS_ABOUT]-&gt;(k)

My ARTICLE nodes look like this: (a:ARTICLE {title property})

My KEYWORD nodes look like this: (k:KEYWORD {keyword property})

In 2) I don&#39;t know how to code this.

I also tried this:

    MATCH (t:KEYWORD)
    WITH t.keyword as keyword
    FOREACH keyword in t
    CALL db.index.fulltext.queryNodes(&quot;titleInArticle&quot;, keyword) YIELD node, score
    CREATE (node)-[:TALKS_ABOUT]-&gt;(t)


",1605345549,https://stackoverflow.com/q/64832428,LJRB,"['neo4j', 'cypher']"
64831589,Unable to connect to neo4j from nodejs using neo4j driver,"I am using neo4j-driver to connect to neo4j via nodejs but I am facing an issue.
&lt;br&gt;&lt;br&gt;
It gives the error failed to connect to server even when the database is up and running and can be accessed via neo4j browser.

```shell
Neo4jError: Failed to connect to server. Please ensure that your database is listening on 
the correct host and port and that you have compatible encryption settings both on 
Neo4j server and driver. Note that the default encryption setting has changed in 
Neo4j 4.0. Caused by: connect ECONNREFUSED 127.0.0.1:7687

    at captureStacktrace (/mnt/d/Codes/SIMply/server/node_modules/neo4j-driver/lib/result.js:277:15)
    at new Result (/mnt/d/Codes/SIMply/server/node_modules/neo4j-driver/lib/result.js:68:19)
    at Session._run (/mnt/d/Codes/SIMply/server/node_modules/neo4j-driver/lib/session.js:174:14)
    at Session.run (/mnt/d/Codes/SIMply/server/node_modules/neo4j-driver/lib/session.js:135:19)
    at /mnt/d/Codes/SIMply/server/database/randProviderdata.js:25:19
    at processTicksAndRejections (internal/process/task_queues.js:97:5) {
  code: &#39;ServiceUnavailable&#39;,
  name: &#39;Neo4jError&#39;
}
```

The driver connection settings is

```js
const neo4j = require(&#39;neo4j-driver&#39;);

const driver = neo4j.driver(&#39;bolt://localhost&#39;, neo4j.auth.basic(&#39;neo4j&#39;, &#39;password&#39;));

module.exports = driver;
```

I use this exported driver in different files which are used to add data.&lt;br&gt;
This is the code I am using to add data to the database.
```js
const fs = require(&#39;fs&#39;);
const path = require(&#39;path&#39;);
const driver = require(&#39;./config&#39;);

const filePath = path.join(__dirname, &#39;providerdata.json&#39;);

const addData = async () =&gt; {
	fs.readFile(filePath, { encoding: &#39;utf-8&#39; }, async (err, data) =&gt; {
		if (err) {
			console.log(err);
		}
		let session;
		try {
			session = driver.session();
			await session.run(&#39;MATCH (a:Provider) DETACH DELETE a&#39;);
			await session.close();
		} catch (error) {
			console.log(error);
		}
		const providerData = JSON.parse(data);
		for (let index = 0; index &lt; providerData.length; index++) {
			const d = providerData[index];
			session = driver.session();
			try {
				await session.run(&#39;CREATE (a:Provider {name:$name,id:$id})&#39;, {
					name: d.name,
					id: d.id,
				});
				await session.close();
			} catch (error1) {
				console.log(error1);
			}
		}
	});
	await driver.close();
	console.log(&#39;done&#39;);
};

addData();
```
&lt;br&gt;
This whole code was working around a week ago but now is running into this problem.",1605336475,https://stackoverflow.com/q/64831589,Atharva Thorve,"['neo4j', 'neo4j-driver', 'cypher', 'database', 'node.js']"
64826253,Why duplicated results query with cypher neo4j,"I am implementing the example database Movies en Neo4j. I already search something about duplicated rows but I still have doubts 

I am using **XOR**. I am getting the

    MATCH (m:Movie)&lt;-[r]-(p:Person)
    WHERE m.title STARTS WITH &#39;The&#39; 
    XOR (m.released = 1999 OR m.released = 2003)
    RETURN m.title, m.released
    So, my result is

[![enter image description here][1]][1]

As you can see, there are duplicated rows, I don&#39;t understand why there are doing that and the number of duplicated results is according to what?

&gt; I know that DISTINCT removes duplicated. But I am interested in understanding why the query duplicated the results and the number of duplicated is according to what?.


  [1]: https://i.stack.imgur.com/r6tVH.png",1605292494,https://stackoverflow.com/q/64826253,Marco Feregrino,"['neo4j', 'database', 'cypher', 'graph']"
64826013,Neo4j persistent named graph,"I&#39;m coming from the RDF world where named graphs are persistent and can be used like a collection of triples. Moreover you can query against one single named graph or over the whole triplestore. I&#39;m looking for the same features (or a workaround to achive them) in Neo4j.

Neo4j&#39;s Graph Catalog is well [documented][1]. As I understood, named graphs in Neo4j are stored entirely in-memory (so lost after a restart) with a subset of nodes you define for analytic purpose.

Is there a way to create persistents named graphs in Neo4j?
A graph that is stored in the disk with the data and that permits to fast access to a subset of nodes (nodes can be added or removed from the named graph).

  [1]: https://neo4j.com/docs/graph-data-science/current/management-ops/graph-catalog-ops/",1605291355,https://stackoverflow.com/q/64826013,Alessio,"['named-graphs', 'neo4j', 'cypher']"
64825622,Neo4j/Cypher optionally create a Node and relationship based on whether a JSON object is empty or not,"First off, I am using the GRANDstack with Flutter as my frontend. Not super relevant, but for context. I have a CreatePost mutation:
```
mutation CreatePost(\$body: String!, \$userId: ID!, \$imageReference: CreateImageReference!, \$mentions: [String!]) {
  CreatePost(body: \$body, userId: \$userId, imageReference: \$imageReference, mentions: \$mentions) {
    id,
    body,
    createdAt {
      formatted
    },
    updatedAt {
      formatted
    },
    user {
      username
    },
    imageReference {
      downloadURL
    }
  }
}
```
that is successfully sending my `CreateImageReference` input as JSON with `name` and `downloadURL` attributes. The custom input type:
```
input CreateImageReference {
    name: String!
    downloadURL: String!
}
```
in my schema file is straightforward and being accepted by apollo/graphql just fine. I am logging the &quot;graphqlResponse&quot; to monitor everything and there appears to be no issue up to this point. 

I am attempting to &quot;optionally create&quot; this `ImageReference` node and a relationship to the `Post` node based on whether the `$imageReference` parameter is null or not. My custom mutation with cypher query without the addition of the `ImageReference` logic: 
```
CreatePost(body: String!, userId: ID!, imageReference: CreateImageReference!, mentions: [String!]): Post
    @cypher(
      statement: &quot;&quot;&quot;
        MATCH (u:User {id: $userId})-[:MEMBER_OF]-&gt;(g:Group)
        OPTIONAL MATCH (g)-[rel:NEWEST_POST]-&gt;(prevNewest:Post)
        CREATE (u)-[:WROTE]-&gt;(p:Post {id: apoc.create.uuid(), body: $body, createdAt: datetime(), updatedAt: datetime()})&lt;-[:NEWEST_POST]-(g)
        MERGE (u)-[hp:HAS_PARTICIPATED]-&gt;(g)
        ON MATCH SET hp.updatedAt = p.createdAt
        ON CREATE SET hp.createdAt = p.createdAt, hp.updatedAt = p.createdAt
        FOREACH(i in CASE WHEN NOT rel IS NULL THEN [1] ELSE [] END |
        DELETE rel CREATE (p)-[:NEXT_POST]-&gt;(prevNewest))
        WITH p
        OPTIONAL MATCH (allMentionedUsers:User)
        WHERE allMentionedUsers.id in $mentions
        UNWIND allMentionedUsers as mentionedUser
        MERGE (p)-[:MENTIONS]-&gt;(mentionedUser)
        // Add CREATE ImageReference and
        // Add CREATE relationship (HAS_ATTACHMENT) between ImageReference and Post here
        RETURN p
    &quot;&quot;&quot;)
```
What is the most efficient way to check if the variable $imageReference `IS NULL` and do nothing if it is vs. run the CREATE node/relationship statements when `NOT IS NULL`:
```
CREATE (i:ImageReference {id: apoc.create.uuid(), name: $imageReference[&#39;name&#39;], downloadURL: $imageReference[&#39;downloadURL&#39;]}
WITH i
CREATE (p)-[:HAS_ATTACHMENT]-(i)
``` 
Here is an attempt with CASE:
```
CASE $imageReference
WHEN null []
ELSE CREATE (i:ImageReference {
    id: apoc.create.uuid(), 
    name: $imageReference[&#39;name&#39;], 
    downloadURL: $imageReference[&#39;downloadURL&#39;],
    createdAt: datetime(),
    updatedAt: datetime(),
    deletedAt: null
})
CREATE (p)-[:HAS_ATTACHMENT]-&gt;(i)
WITH i END
```
that is throwing a `&quot;Neo4jError: Failed to invoke procedure `apoc.cypher.doIt`: Caused by: org.neo4j.exceptions.SyntaxException: Invalid input &#39;S&#39;: expected &#39;l/L&#39; (line 10, column 3 (offset: 678))&quot;,`.

Here is an attempt with FOREACH that is successfully creating the Post, but not the ImageReference with no errors to indicate why:
```
FOREACH (i in CASE WHEN NOT $imageReference IS NULL THEN [1] ELSE [] END |
    CREATE (ir:ImageReference {
        id: apoc.create.uuid(), 
        name: $imageReference[&#39;name&#39;], 
        downloadURL: $imageReference[&#39;downloadURL&#39;],
        createdAt: datetime(),
        updatedAt: datetime(),
        deletedAt: null
    })
    CREATE (p)-[:HAS_ATTACHMENT]-&gt;(ir))
```
If I execute this part:
```
CREATE (ir:ImageReference {
    id: apoc.create.uuid(), 
    name: $imageReference[&#39;name&#39;], 
    downloadURL: $imageReference[&#39;downloadURL&#39;],
    createdAt: datetime(),
    updatedAt: datetime(),
    deletedAt: null
})
CREATE (p)-[:HAS_ATTACHMENT]-&gt;(ir))
```
without the CASE or FOREACH, it successfully creates the Node and relationship as expected, which is fine until I want to create a post without an ImageReference. Perhaps the solution is to just create two different queries?",1605289591,https://stackoverflow.com/q/64825622,Matt Larson,"['graphql', 'apollo', 'neo4j', 'grandstack', 'cypher']"
64814930,Neo4J CSV into Props,"I&#39;m using cypher and the neo4j browser to create nodes from csv input. 

I want to read in each row of my csv file with headers and then create a node with that row as properties. 

MY current code is:

```
LOAD CSV WITH HEADERS FROM &#39;&lt;yourFilePath&gt;&#39; AS ROW
WITH ROW 
CREATE (n:node $ROW)
```

This throws an error saying parameter missing.",1605237011,https://stackoverflow.com/q/64814930,Hysii,"['cypher', 'neo4j']"
64807266,Query to write hops and return all the properties from the middle nodes or a better way to do it and skip hops?,"Node A is connected to Node E through different nodes B (B can be repeating), C and D etc as given below.

    (A)--(C)--(D)--(E)
    (A)--(B)--(C)--(D)--(E)
    (A)--(B)--(B)--(C)--(D)--(E)
    (A)--(B)--(B)--(B)--(C)--(D)--(E)

There could be up to 7 B nodes between A and C or no B node at all (like the first case above).

Question: How to get all the E1, E2, E3, E4 connected to A1 with a single query and return properties from all A, B, C, D and E nodes? I could not return the properties using the hops.

    MATCH (A {Id:30})-[*1..6]-(E) RETURN DISTINCT A.Name, E.Name; 

But we want to return B.Name (If there are multiple B nodes in the middle their names too), C.Name and D.Name too. Happy to skip hopping completely if required. Help please? Thanks in advance.

",1605196461,https://stackoverflow.com/q/64807266,Jay,"['cypher', 'neo4j']"
64806930,CYPHER query based on sum relationship property array,"In my graph, relationships have a property named `list`. `list` is an array of int.

It looks like this:

    (head:Node)-[r:RELATIONSHIP {list:...}]-&gt;(tail:Node)

I&#39;d like to query all tails in the graph, where the sum of list is &gt; 0.

Intuitively, I would do:

    MATCH (:Node)-[r:RELATIONSHIP]-&gt;(tail:Node)
    WHERE sum(r.list) &gt; 0
    RETURN tail

This does not work unfortunately. It throws an error. How can I write this query?
Thanks
",1605195200,https://stackoverflow.com/q/64806930,Filippo Grazioli,"['cypher', 'neo4j']"
64803153,Error in Import Shape file of neo4j using cypher query,"I have installed below ,
 1. Neo4j Desktop IDE with neo4j version - 3.5.17 
 2. Java version 8 
 3. Spatial 0.26.2-neo4j-3.5.2

**Try to import shape file to neo4j through cypher query,** 

**call spatial.importShapefile(&quot;file:///home/.local/share/neo4j-relate/dbmss/dbms-3ad2b2c1-94c6-4482-8b1f-bcfe3f413670/import/cb_2019_us_state_500k.shp&quot;)**

but it produces the error :
Failed to invoke procedure `spatial.importShapefile`: Caused by: java.lang.NoClassDefFoundError: Could not initialize class org.geotools.data.DataUtilities


how to fix this? Can anyone tell to solve this issues?",1605180871,https://stackoverflow.com/q/64803153,Esai S,"['spatial', 'java', 'neo4j', 'cypher']"
64800808,Neo4j: How can we compare one relationship property with another relationship property and modify the relationship accordingly,"I am new to neo4j db and I will try to explain my issue. So I have a list of RFID tags and I am adding the start time end time and duration of these tags when contacted with each other. I would like to iterate through these relations and find whether this start time and end time of one relation coincides with the other relation and then do some modification to the relation. Below is my relation.

    +------------------------------------------------------------------------------+
    | m.tagId | n.tagId | rel                                                      |
    +------------------------------------------------------------------------------+
    | 1       | 2       | [:CONTACTED {StartTime: 6.3, Duration: 2.7, EndTime: 9}] |
    | 1       | 2       | [:CONTACTED {StartTime: 6, Duration: 2.3, EndTime: 8.3}] |
    +------------------------------------------------------------------------------+

What I need to do is, when StartTime of relation 1 is &lt;= EndTime  of relation 2 and  StartTime of relation 2 is &lt;=  EndTime of relation 1 then modify the relation like this

    +------------------------------------------------------------------------------+
    | m.tagId | n.tagId | rel                                                      |
    +------------------------------------------------------------------------------+
    | 1       | 2       | [:CONTACTED {StartTime: 6, Duration: 3, EndTime: 9}] |

That is new relation&#39;s StartTime is MIN(6,6.3) and EndTime is MAX(8.3,9)

What I am looking for is a nested loop to iterate through all the relationships and check the condition then add/delete the relationship. Is there any possible way to do this?",1605171799,https://stackoverflow.com/q/64800808,Tony Joy,"['cypher', 'neo4j']"
64798330,Substitute one chain of nodes into anoter chain of nodes in graphdb ? like string substitution,"Let say I have a chain/list of nodes :

     (:node {uid:333})--&gt;(:node {uid:102})--&gt;(:node {uid:155})--&gt;...

I want to substitute/replace one or several consecutive nodes with another chain of nodes.

     (:node {uid:255})--&gt;(:node {uid:107})
 
it seem to me that the number of operations to achieve this are too many to have them in single query.

     1. input [255,107]
     2. create the (255)--&gt;(107)
     3. find the place where to insert in the original chain
     4. connect this node to (255)--&gt;(107)
     5. connect the tail-107 to the original chain (if it does not end)
     6. delete the part to be replaced..

the problem is that if it is not single query then it become even more complex.

How would you do this ? (have to  work like string substitution)

One idea to simplify it is to find the positions in the chain and work with indexes .
   ",1605158298,https://stackoverflow.com/q/64798330,sten,"['neo4j', 'redisgraph', 'python', 'cypher']"
64794114,Redis Graph : Searching for n-consecutive nodes with moded-property?,"In python code I get a list of uids of nodes f.e. [1,2,3].

I want to build a query to find a consecutively connected nodes and return the parent.

So in this case the query will look like this:


      match (n0)--&gt;(n1)--&gt;(n2)--&gt;(n3) 
      where n1.uid % 100 = 1 % 100 and n2.uid % 100 = 2 % 100 and n3.uid % 100 = 3 % 100
      return n0 

as you can see this is not very scalable if I use longer lists f.e. [5,3,104,202,....]
The query will grow alot.

Is there a shortcut I can use to handle lists of different sizes. Keep in mind that the order of the nodes have to match the data-list.",1605128762,https://stackoverflow.com/q/64794114,sten,"['neo4j', 'redisgraph', 'cypher']"
64791890,Neo4j and Cypher: Reversing Only One Arrow,"Let&#39;s say I have three nodes in my Neo4j graph, with directed relationships like this: `(a)&lt;--(b)--&gt;(c)`. Furthermore, assume that `(b)` does NOT have the property `visit_type_name`, whereas both `(a)` and `(c)` do. Now what I would like to do is reverse ***only one*** of these arrows. For the moment, it does not matter which one, although being able to specify conditions, involving properties, on which one to reverse would be nice. I tried the following:
```
MATCH(x)-[r]-&gt;(y)
WHERE NOT EXISTS(()--&gt;(x))
    AND NOT EXISTS(x.visit_type_name)
DELETE r
MERGE(y)--&gt;(x)
```
My thought was that after this code reversed, say, the arrow `(a)&lt;--(b)` to `(a)--&gt;(b)`, then `(b)` would no longer be parent-less, and the `MATCH` would not continue on and do the same thing with the `(b)--&gt;(c)` link. Unfortunately, Cypher does continue and reverse both arrows, which is not what I want. So then I tried this, thinking that I needed to change the granularity of the Cypher match:
```
MATCH(y)
WITH y
MATCH(x)-[r]-&gt;(y)
WHERE NOT EXISTS(()--&gt;(x))
    AND NOT EXISTS(x.visit_type_name)
DELETE r
MERGE(y)--&gt;(x)
```
Unfortunately, this does the same thing as before. 

&gt; How can I reverse only one arrow in this situation?

Is there a way to finalize the first arrow reversal transaction before moving on? 

Many thanks for your time!",1605118372,https://stackoverflow.com/q/64791890,Adrian Keister,"['cypher', 'neo4j']"
64772530,Unwinding and merging the results with dynamic labels in Neo4J Client for C#,"I am currently trying to unwind a list of objects that I want to merge to the database using the Neo4J Client. What I would like to do is unwind the list and create the nodes with a label generated based on a property from the items themselves instead of hardcoding a label name. From what I can find I have to use the [APOC](https://neo4j.com/labs/apoc/4.1/overview/apoc.merge/apoc.merge.node/) merge method to do so. However, I am unable to translate this to the Neo4J client. In the neo4J explanation they yield a node after the apoc.merge.node call and then return the node. However, I cannot simply return the node nor can I set the node (I got to the point of just messing about, and at one point I got the labels to work but it overwrote all properties with the last item in the list). 

I seem to miss something fundamental but i&#39;m not quite sure what. Does anyone here know how to do this with neo4J client (and if possible, give a bit of an explanation what is going on)? I am very new to the development world and I feel I am just missing a crucial piece of understanding when it comes to this..  

The code that I tried that turned all properties into the last node&#39;s properties but at least created the labels as I expected: 

```
        public async void CreateBatchItems(List&lt;TToDataBase&gt; itemList)
        {
            await Client.Cypher
            .Unwind(itemList, &quot;row&quot;)
            .Merge(&quot;(n)&quot;)
            .With(&quot;row, n&quot;)
            .Call(&quot;apoc.merge.node([n.Name], n)&quot;).Yield(&quot;node&quot;)
            .Set(&quot;n += node&quot;)
            .ExecuteWithoutResultsAsync();
        }

```

Thank you in advance!

Edit: 

Some clarification about the input:
The objects are actually very basic, as (at least for now), they merely contain a name and an objectID (and these object ID&#39;s are later used to create relations). So its a very basic class with two properties: 

```
 public class Neo4JBaseClass
    {
        public Neo4JBaseClass() { }

        public Neo4JBaseClass(string name, string objectId)
        {
            Name = name;
            ObjectId = objectId;
        }

        [JsonProperty(PropertyName = &quot;ObjectId&quot;)]
        public string ObjectId { get; set; }

        [JsonProperty(PropertyName = &quot;Name&quot;)]
        public string Name { get; set; }
    }
```

I have also tried a slight variation where this class also has the added property

```
        [JsonProperty(PropertyName = &quot;PropertyMap&quot;)]
        public IProperty PropertyMap { get; set; }  
```
where PropertyMap is another basic object holding the name and objectId. This seemed like a good idea for future proofing anyway, so the propertylist can be easily expanded without having to change the base object.",1605024700,https://stackoverflow.com/q/64772530,Jasper Krom,"['neo4j', 'neo4jclient', 'cypher']"
64772226,Why code sample from neo4j python drive official documentation does not work?,"I&#39;m currently working on a project where I need to build and display graphs. I am going to do it using neo4j but I have trouble running code sample from official doc.

- I&#39;m using neo4j python driver from a jupyter lab notebook running inside a docker container.
- neo4j is running on another docker container
- both are in the same docker-compose and started at the same time

here is the link to the doc : https://neo4j.com/docs/api/python-driver/current/  
I&#39;m trying to execute the first code sample (Quick Example -&gt; Creating nodes)

I&#39;m using the same neo4j driver version than in the doc (4.1)

Here is the error I get : 

    CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: Invalid input &#39;H&#39;: expected &#39;i/I&#39; (line 1, column 57 (offset: 56))
    &quot;CREATE (a:Person)-[:KNOWS]-&gt;(f:Person {name: $friend}) WHERE a.name = &#39;$name&#39; RETURN f.name AS friend&quot;
                                                             ^}

To me it sounds like syntax won&#39;t allow to use keyword &#39;WHERE&#39; together with &#39;CREATE&#39; but I have a very poor experience with cypher for now. Anyways I took the example from official doc and it is not working do you have any idea why ?",1605023558,https://stackoverflow.com/q/64772226,Sacha Perin,"['jupyter-lab', 'neo4j', 'cypher', 'python', 'docker']"
64760219,Neo4j Cypher Aggregating Value Counts,"I am returning date that looks like this:

`&quot;Jonathan&quot; | &quot;Chicago&quot; | 6 | [&quot;Hot&quot;,&quot;Warm&quot;,&quot;Cold&quot;,&quot;Cold&quot;,&quot;Cold&quot;,&quot;Warm&quot;]`

Where the third column is a count of the values in column 4.

I want to extract values out of the collection in column 4 and create new columns based on the values. My expected output would be:

`Hot | Cold | Warm` with the values `1 | 3 | 2` representing the counts of each value. 

My current query is `match (p)-[]-&gt;(c)-[]-&gt;(w) return distinct p.name, c.name, count(w), collect (w.weather)`

I&#39;d imagine this is simple, but i cant figure it out for the life of me.",1604961294,https://stackoverflow.com/q/64760219,Hysii,"['neo4j', 'cypher']"
64754062,Property as a list or array in neo4j,"I use LOAD CSV for data ingestion in neo4j.Let&#39;s say there are two different CSVs which have data for same nodetype and both the CSVs have data for same properties but the value of the property in first CSV is getting overwritten by value of property in second CSV.

Is there away in neo4j where the values of properties can be stored as a List or an Array without getting overwritten.

Thanks in advance",1604934025,https://stackoverflow.com/q/64754062,ck22,"['neo4j', 'cypher']"
64745901,How to create a custom analyzer for full-text index in Neo4j?,"I want to create a custom analyzer for Neo4j Full-text Index. 

I tried to clone repositories from:

https://github.com/covidgraph/neo4j-additional-analyzers (repo 1) and

https://github.com/graphaware/neo4j-lucene-custom-analyzer (repo 2)

And then do `mvn clean package`.

Then copy the .jar file to the plugins folder.

I use Neo4j Desktop (Windows 10), the plugins folder location:
`C:\Users\username\AppData\Local\Neo4j\Relate\Data\dbmss\dbms-6682c57d-3895-4b8e-a465-d9d2891e8dca\plugins`

I also try to use Neo4j Docker, the plugin folder location:
`/var/lib/neo4j/plugins`


I restart Neo4j and try to run cypher command like this to get the list of available analyzer:

`CALL db.index.fulltext.listAvailableAnalyzers`

But there is no custom analyzer.

I also try to create index like this:

`CALL db.index.fulltext.createNodeIndex(&quot;movieTitle&quot;,[&quot;Movie&quot;],[&quot;title&quot;], { analyzer: &quot;whitespace_lower&quot; })` 

But I get the following error:

`Failed to invoke procedure db.index.fulltext.createNodeIndex: Caused by: java.lang.IllegalArgumentException: No such full-text analyzer: &#39;whitespace_lower&#39;.`

Note: &quot;whitespace_lower&quot; is the name of the custom analyzer from repo 1, when I try using repo 2, I get the same error. The name of the custom analyzer from repo 2 is &quot;custom_stopwords&quot;.
",1604896134,https://stackoverflow.com/q/64745901,b6a894bh744aha8,"['full-text-search', 'neo4j', 'cypher']"
64743317,"Neo4j, Cypher. Conditional merge","I have a de-normalized csv file which looks something like this:

    OrderId, OrderAmount, PersonId, PersonName, CarVIN, CarBrand, CarModel
    1, 2500, 99, John Roe, JPN32132D2312DS, Toyota, Rav-4
    2, 3200, 66, Harry Kone, NULL, NULL, NULL

And out if it, I am trying to create 3 new entities/label (Order, Person, Car) with relationships between them. A row in the csv represents a relation between an Order, Person and a Car. There&#39;s one condition that I&#39;d like to apply here. If the corresponding id of an entity (OrderId, PersonId, CarVIN) is NULL, then we don&#39;t create an entity and the corresponding relation. Here is my code so far:

    LOAD CSV WITH HEADERS
    FROM &#39;file:///source.csv&#39;
    AS row
    MERGE (o:Order {Id:row.OrderId})
    	ON CREATE SET 
        	o.Amount = row.OrderAmount
    
    MERGE (p:Person {Id:row.PersonId})
    	ON CREATE SET 
        	p.Name = row.PersonName
    		
    MERGE (c:Car {Id:row.CarVIN})
    	ON CREATE SET 
        	c.Brand = row.carBrand,
    		c.Model = row.carModel
    		
    MERGE (o)-[:MADE_BY]-&gt;(p)
    MERGE (p)-[:ORDERED]-&gt;(c)

The thing here is that for the second row:

&gt; 2, 3200, 66, Harry Kone, NULL, NULL, NULL

I don&#39;t want to create neither the car entity nor the relation between person and a car.
",1604871605,https://stackoverflow.com/q/64743317,user2128702,"['cypher', 'neo4j']"
64738823,How can restore the previous graph using cypher in neo4j,I have graph in neo4j and I am updating the Graph using cypher . Now My problem is I want to give myself privilege to restore the previous graph i.e before updation using cypher. Is it possible.? ,1604843445,https://stackoverflow.com/q/64738823,priya,"['neo4j', 'cypher']"
64735599,Installing Neo4j Database and Neo4j spatial Server plugin in Ubuntu 18.04,"My need is : To import osm file to neo4j database 

I have follow the below steps :::

1. I have installed **neo4j 3.5.2** through command in terminal(sudo apt install neo4j=1:3.5.2)
 2. Installed the **neo4j spatial server plugin** by using this link : https://github.com/neo4j-contrib/spatial/releases
3. Copy that jar file to this path: /var/lib/plugins 
4. After that restart the server by using (sudo service neo4j restart),
5. open neo4j browser, put this command **CALL SPATIAL.PROCEDURES()**, 

but it throw the error in neo4j browser: **There is no procedure with the name `spatial.procedures` registered for this database instance. Please ensure you&#39;ve spelled the procedure name correctly and that the procedure is properly deployed.**


how to fix this? Could you send the solution to solve this? also send the details to import .osm file to neo4j database

",1604818800,https://stackoverflow.com/q/64735599,Esai S,"['neo4j', 'cypher', 'neo4j-browser']"
64720139,Deleting duplicate relationships in neo4j - is this correct?,"I have developed a query which, by trial and error, appears to find all of the duplicated relationships in a Neo4j DB. I want delete all but one of these relationships but I&#39;m concerned that I have not thought of problematic cases that could result in data deletion.

So, does this query delete all but one of a duplicated relationship?

    MATCH (a)--&gt;(b)&lt;--(a)  # identify where the duplication is present
    WITH DISTINCT a, b
    MATCH (a)-[r]-&gt;(b)  # get all duplicated paths themselves
    WITH a, b, collect(r)[1..] as rs  # remove the first instance from the list
    UNWIND rs as r
    DELETE r

If I replace the `UNWIND rs as r; DELETE r` with `WITH a, b, count(rs) as cnt RETURN cnt` it seems to return the unnecessary relationships.

I&#39;m still relucant to put this somewhere to be used by others, though....

Thanks",1604688667,https://stackoverflow.com/q/64720139,Lucidnonsense,"['cypher', 'neo4j']"
64719974,neo4j performance issues with many OR clauses,"I have performance issues with one of my generated queries. The query looks something like this:

    MATCH p=(n:Person)
    WHERE n.first_name = &#39;John&#39; AND n.middle_name = &#39;A&#39; AND n.last_name = &#39;Smith&#39;
       OR n.first_name = &#39;Joe&#39; AND n.last_name = &#39;Man&#39;
       OR n.last_name = &#39;Storm&#39;
       OR n.first_name = &#39;Jonas&#39; AND n.middle_name = &#39;Q&#39; AND n.last_name = &#39;Son&#39;
       ..
       .. # 20 more OR clauses
       ..
       ..
    RETURN p

This query takes forever to run while the individual queries is very fast, e.g.:

    MATCH p=(n:Person)
    WHERE n.first_name = &#39;John&#39; AND n.last_name = &#39;Smith&#39;
    RETURN p

..returns almost instantly.

I have indexes on all properties; `first_name`, `middle_name` and `last_name`.

Debugging this is hard since queries warms up the cache. A query that takes minutes to complete first may take seconds if run directly in succession.

**Is there a way that I can rewrite the query so that it goes faster?**


(I really don&#39;t want to run the individual queries in sequence since I want the result in one batch.)",1604687829,https://stackoverflow.com/q/64719974,dacwe,"['cypher', 'neo4j']"
64719512,Mutual followers cypher script - neo4j,"I am trying to find mutual followers. People who follow me(ID) and also follows one of my follower(followerID) . The relation is [:FOLLOWS{status:accepted}] . 

For example,
MATCH (user:User)-[:FOLLOWS {status: &#39;accepted&#39;}]-&gt;(:User {ID:$ID}) RETURN user

This query gives my followers.

How do i find mutual followers when ID and followerID is given?",1604685596,https://stackoverflow.com/q/64719512,Nourish Cherish,"['cypher', 'neo4j', 'database']"
64716833,Neo4j Cypher - How to display graph of all nodes of a certain type with a common node?,"ie all nodes that are attached to the node with the name &quot;Immunodeficiency&quot; and also attached to the node with the name &quot;autosomal recessive&quot;

I tried this:

    MATCH (a)-[r*]-&gt;(b)
    WHERE a.name=&quot;Immunodeficiency&quot; AND b.name=&quot;autosomal recessive&quot;
    return a,r,b

But it&#39;s not working. It&#39;s just returning a and b without any relationships or nodes in between",1604674412,https://stackoverflow.com/q/64716833,G.T.,"['cypher', 'neo4j', 'graph-databases']"
64698807,Neo4J get shortest path between nodes going via specific node,"We have a Neo4J database that tracks people working for companies.  The general structure is -

    (Person)-[:WORKS_AT]-&gt;(Company)

A person can have multiple jobs at the same time and each company can have multiple people.

Given 2 companies (Company 1 and Company 2) we can calculate the shortest path using -

    match (start:Company {id:1}),(end:Company {id:2}), p = shortestPath((start)-[:WORKS_AT*]-(end)) return *

What we want to do, is calculate the shortest path between the 2 companies where the path includes specific people, e.g. -

    (Company 1)-(Person 1)-(Company 4)-(Person 2)-(Company 2)
would be returned instead of the following if we wanted to connect via Person 2 -

    (Company 1)-(Person 3)-(Company 2)

I have tried implementing the suggestion in https://stackoverflow.com/questions/37865457/neo4j-shortest-path-for-specific-node-labels-in-between-the-path but it returns an error -

&gt; The shortest path algorithm does not work when the start and end nodes
&gt; are the same. This can happen if you perform a shortestPath search
&gt; after a cartesian product that might have the same start and end nodes
&gt; for some of the rows passed to shortestPath. If you would rather not
&gt; experience this exception, and can accept the possibility of missing
&gt; results for those rows, disable this in the Neo4j configuration by
&gt; setting `cypher.forbid_shortestpath_common_nodes` to false. If you
&gt; cannot accept missing results, and really want the shortestPath
&gt; between two common nodes, then re-write the query using a standard
&gt; Cypher variable length pattern expression followed by ordering by path
&gt; length and limiting to one result.

EDIT : wrong article linked - should have been https://stackoverflow.com/questions/45808063/shortest-path-between-2-nodes-through-waypoints-in-neo4j

The query we are trying to run that is failing is -

    match(s:Company{ID:1})
    match(f:Company{ID:2})
    match (n:Person) where n.id in [2]
    with collect(n) as wps 
    match path=allshortestPaths((s)-[:WORKS_AT*]-&gt;(f))
    where ANY ( n in wps WHERE n in nodes(path) ) return *",1604585003,https://stackoverflow.com/q/64698807,AndyKing,"['shortest-path', 'neo4j', 'cypher']"
64696683,Neo4J: adding number rankings to an ordered output,"Let&#39;s say that there is the following query:

```
MATCH(r: Restaurant)
WITH r.restaurantName AS `Restaurant name`, r.restaurantFoodRating AS `Restaurant food rating`
ORDER BY `Restaurant food rating` DESC
RETURN `Restaurant name`, `Restaurant food rating`
```
It returns the following:

Row 1 ```&quot;Fat Bob&#39;s&quot;, 10```

Row 2 ```&quot;Slim Jim&#39;s&quot;, 9.8```

Row 3 ```&quot;Quick Rick&#39;s&quot;, 8.7```

I want my output to have a number based on the ranking of the restaurant. The highest rated restaurant is Fat Bob&#39;s, so it should have a rank of 1.

Desired output:

Row 1 ```&quot;Fat Bob&#39;s&quot;, 10, 1```

Row 2 ```&quot;Slim Jim&#39;s&quot;, 9.8, 2```

Row 3 ```&quot;Quick Rick&#39;s&quot;, 8.7, 3```

What&#39;s the best way to implement this?
",1604577275,https://stackoverflow.com/q/64696683,Big Rick,"['neo4j', 'cypher']"
64682272,Neo4j How to find a node connected somehow to another given node,"in a database I have different distinct disconnected graphs. Each graph has a root node (r:Root {name:&quot;&quot;}) which have different name properties (Root label + name property is a unique identifier). The only thing I know of these graphs is that a copy of a node with a given label (e.g :node1) can exist in each graphs. Given the root node (r:Root {name:&quot;XYZ&quot;}) and the target label (e.g. :node1) how can I find the node connected to the root that has name=XYZ without knowing how it is connected?

I tried 

    Match (n:node1)-[r*0..]-(:Root {name:&quot;XYZ&quot;}) return n

but the query is stucked. I don&#39;t know the number and the type of relationships between node1 and the root.

EDIT:
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/auGrt.png

The problem is shown above. Inside the circles there are the node labels (i omitted the other labels). Inside the cloud I have the parameters. My wish is to return the node :node1 connected to the root named &quot;pippo&quot;. The only thing I know are the labels Root, node1 (that is not unique) and the root&#39;s name (that is unique). I cannot assume anything about the way :node1 is connected to the root node.",1604501250,https://stackoverflow.com/q/64682272,Gianluca,"['neo4j', 'cypher']"
64678869,Neo4j: matching nodes with 2 more properties in common,"I am working with data from a csv file which contains 4 columns of data: ```hotelName```, ```hotelPool```, ```hotelSpa```, ```hotelGym```, where ```hotelName``` is the unique name of the hotel, ```hotelPool``` lists what kind of pool the hotel has, ```hotelSpa``` lists what kind of spa the hotel has, and ```hotelGym``` lists what kind of gym the hotel has.

Sample data as follows:

Row 1 ```&quot;California&quot;, &quot;Full-size&quot;, &quot;Full-size&quot;, &quot;Fully-equipped&quot;```

Row 2 ```&quot;Yorba&quot;, &quot;Full-size&quot;, &quot;None&quot;, &quot;Full-equipped&quot;```

Row 3 ```&quot;Heartbreak&quot;, &quot;None&quot;, &quot;Full-size&quot;, &quot;Full-equipped&quot;```

Row 4 ```&quot;Chelsea&quot;, &quot;Full-size&quot;, &quot;Full-size&quot;, &quot;Fully-equipped&quot;```

I want to match these hotels if they share 2 or more features in common.

For example, California has 2 features in common with Yorba - both hotels have full-size pools and fully-equipped gyms. 

California also has 2 features in common with Heartbreak - both hotels have full-sized spas and fully equipped gyms.

California also has 3 features in common with Chelsea - both hotels have full-sized pools, full-sized spas, and fully equipped gyms.

My desired output is pairs of hotels that have 2 or more features in common, as follows:

Row 1 ```California, Yorba, 2```
Row 2 ```California, Heartbreak, 2```
Row 3 ```California, Chelsea, 3```

How do I match based on 2 or more features?",1604487941,https://stackoverflow.com/q/64678869,Big Rick,"['neo4j', 'cypher']"
64678551,Neo4j: ordering output by values in a collection,"I am working with data from a csv file which contains four columns of data: ```stationID```, ```stationName```, ```stationLong```, ```stationLat``` where ```stationID``` is the unique number of the station, ```stationName``` is the name of the station, ```stationLong``` is the longitude of the location of the station and ```stationLat``` is the latitude of the location of the station.

Sample data as follows:

Row 1 ```1, &quot;Cranbourne&quot;, 22.6932, 100.5347```

Row 2 ```2, &quot;Dandenong&quot;, 25.6589, 98.5679```

Row 3 ```3, &quot;Flinders Street&quot;, 33.1674, 66.3287```

This data has been loaded into Neo4J and is labelled ```Station```.

I have run a query to get the distances from from each station to all other stations. For example, the distances between station &quot;Cranbourne&quot; to &quot;Dandenong&quot;, &quot;Cranbourne&quot; to &quot;Flinders Street&quot; and so on.

```
MATCH (s1: Station), (s2: Station)
WHERE s1 &lt;&gt; s2
RETURN s1.stationName AS `Station`, collect([s2.stationName, round(distance(
    point({longitude: s1.stationLong, latitude: s1.stationLat}),
    point({longitude: s2.stationLong, latitude: s2.stationLat})))]) AS `Distance to all other stations`
```

Output:

First row: ```&quot;Cranbourne&quot;, [[&quot;Dandenong&quot;, 15], [&quot;Flinders Street&quot;, 45], [&quot;Springvale&quot;, 25], [&quot;Yarraman&quot;, 19]]```

This output is what I want in terms of results, however is there a way to ensure that the output is ordered by ascending distances from the station? 

Desired output:

First row: ```&quot;Cranbourne&quot;, [[&quot;Dandenong&quot;, 15], [&quot;Yarraman&quot;, 19], [&quot;Springvale&quot;, 25], [&quot;Flinders Street&quot;, 45]]```
",1604486699,https://stackoverflow.com/q/64678551,Big Rick,"['neo4j', 'cypher']"
64657117,Neo4j: using distance() function to determine distance between houses,"I am working with data from a csv file which contains three columns of data: ```house```, ```houseLong```, ```houseLat``` where ```house``` is the unique number of the house, ```houseLong``` is the longitude of the location of the house and ```houseLat``` is the latitude of the location of the house.

Sample data as follows:

Row 1 ```1, 22.6932, 100.5347```

Row 2 ```2, 25.6589, 98.5679```

Row 3 ```3, 33.1674, 66.3287```

All the way to the last row

Row 100 ```100, 37.6532, 95.3567```

I&#39;ve imported all of this data into Neo4j - the nodes are labelled ```House```.

For each house, I&#39;m trying to work out the distance between it and the other houses. 

So for house 1, I&#39;m trying to get the distance from house 1 to house 2, house 1 to house 3, and so on until house 100.

For house 2, I&#39;m trying to get the distance from house 2 to house 1, house 2 to house 3, and so on until house 100.

I&#39;m unsure of the best way to implement this query. Right now all I can do is this:

```
MATCH (h1: House {house: 1}), (h2: House {house: 2})
WITH point({longitude: h1.houseLong, latitude: h1.houseLat}) AS point1, point({longitude: h2.houseLong, latitude: h2.houseLat}) AS point2
RETURN round(distance(point1, point2)) AS Distance
```
The above query gives me the distance between house 1 and house 2, but I&#39;m unsure of how to scale this for every house in the query.",1604380226,https://stackoverflow.com/q/64657117,Big Rick,"['cypher', 'neo4j']"
64654201,Difference between Cypher Queries. (neo4j movie db),"I am doing the exercises found in the `:play intro-neo4j-exercises` (exercise 4.10). 
Everything seems good, but I cannot understand exactly the difference between the two queries. Can someone please elaborate?

```
MATCH path =  (p:Person)-[:PRODUCED]-&gt;(m:Movie) 
WHERE NOT EXISTS( (p)-[:DIRECTED]-&gt;(:Movie) )
RETURN p.name, m.title
```
Returns:

```
|&quot;a.name&quot;      │&quot;m.title&quot;               │
╞══════════════╪════════════════════════╡
│&quot;Joel Silver&quot; │&quot;The Matrix&quot;            │
├──────────────┼────────────────────────┤
│&quot;Joel Silver&quot; │&quot;The Matrix Reloaded&quot;   │
├──────────────┼────────────────────────┤
│&quot;Joel Silver&quot; │&quot;The Matrix Revolutions&quot;│
├──────────────┼────────────────────────┤
│&quot;Stefan Arndt&quot;│&quot;Cloud Atlas&quot;           │
├──────────────┼────────────────────────┤
│&quot;Joel Silver&quot; │&quot;V for Vendetta&quot;        │
├──────────────┼────────────────────────┤
│&quot;Joel Silver&quot; │&quot;Speed Racer&quot;           │
├──────────────┼────────────────────────┤
│&quot;Joel Silver&quot; │&quot;Ninja Assassin&quot;        │
└──────────────┴────────────────────────┘
```
WHILE:
```
MATCH (p:Person)-[:PRODUCED]-&gt;(m:Movie)
WHERE NOT EXISTS( (p)-[:DIRECTED]-&gt;(m) )
RETURN p.name, m.title
```
RETURNS:

```
╒═════════════════╤════════════════════════╕
│&quot;a.name&quot;         │&quot;m.title&quot;               │
╞═════════════════╪════════════════════════╡
│&quot;Joel Silver&quot;    │&quot;The Matrix&quot;            │
├─────────────────┼────────────────────────┤
│&quot;Joel Silver&quot;    │&quot;The Matrix Reloaded&quot;   │
├─────────────────┼────────────────────────┤
│&quot;Joel Silver&quot;    │&quot;The Matrix Revolutions&quot;│
├─────────────────┼────────────────────────┤
│&quot;Nora Ephron&quot;    │&quot;When Harry Met Sally&quot;  │
├─────────────────┼────────────────────────┤
│&quot;Stefan Arndt&quot;   │&quot;Cloud Atlas&quot;           │
├─────────────────┼────────────────────────┤
│&quot;Lana Wachowski&quot; │&quot;V for Vendetta&quot;        │
├─────────────────┼────────────────────────┤
│&quot;Lilly Wachowski&quot;│&quot;V for Vendetta&quot;        │
├─────────────────┼────────────────────────┤
│&quot;Joel Silver&quot;    │&quot;V for Vendetta&quot;        │
├─────────────────┼────────────────────────┤
│&quot;Joel Silver&quot;    │&quot;Speed Racer&quot;           │
├─────────────────┼────────────────────────┤
│&quot;Lana Wachowski&quot; │&quot;Ninja Assassin&quot;        │
├─────────────────┼────────────────────────┤
│&quot;Joel Silver&quot;    │&quot;Ninja Assassin&quot;        │
├─────────────────┼────────────────────────┤
│&quot;Lilly Wachowski&quot;│&quot;Ninja Assassin&quot;        │
└─────────────────┴────────────────────────┘
```",1604356050,https://stackoverflow.com/q/64654201,KostasM,"['cypher', 'neo4j', 'graph-databases']"
64640883,Neo4J: query based on partial values of a node key [SOLVED],"I have a csv data set that contains a column of times and a column of days.

Sample data looks like this:

First row
```&quot;9:00 - 15:00&quot;, &quot;Monday, Tuesday&quot;```

Second row
```&quot;10:00 - 14:00&quot;, &quot;Saturday&quot;```

Third row
```&quot;10:00 - 14:00&quot;, &quot;Saturday&quot;```

There is multiple repeating data, and because of this the day and the time together create a unique id so only these unique values will be in the node.

I create a constraint on this as follows:

```
CREATE CONSTRAINT ON (o:OpeningHours) ASSERT (o.openingTimes, o.openingDays) IS NODE KEY
```

I load the csv file and create the nodes as follows:

```
LOAD CSV WITH HEADERS FROM &#39;file:///OpeningHours.csv&#39; AS row 
WITH row.times AS openingTimes, row.days AS openingDays 
MERGE (o:OpeningHours {openingTimes: openingTimes, openingDays: openingDays})
SET o.openingTimes = openingTimes, o.openingDays = openingDays
```

Now I want to return the nodes for all of the opening hours for Saturday, so I do this:

```
MATCH(o:OpeningHours)
WHERE o.openingDays CONTAINS &#39;Saturday&#39;
RETURN o
```

However, this query doesn&#39;t return anything. Is there a way to to this query based on a partial node key or am I off the ball completely?

Thanks guys.

EDIT:

When I run the following query

```
MATCH (o:OpeningHours)
RETURN o.openingDays
LIMIT 3
```

I get the following result:

First row
```&quot;Monday, Tuesday, Wednesday&quot;```

Second row
```&quot;Saturday&quot;```

Third row
```&quot;Sunday&quot;```

EDIT 2:

I have solved the problem, it was a typo that I didn&#39;t pick up on!",1604299230,https://stackoverflow.com/q/64640883,Big Rick,"['cypher', 'neo4j']"
64612696,Cypher: what is the use of YIELD?,"I try to understand the use of YIELD in Cypher requests. 

For example:

    CALL db.labels() YIELD label
    WHERE label CONTAINS &#39;User&#39;
    RETURN count(label) AS numLabels

But I don&#39;t understand why I have to use this and when. 
Can someone explain me what is the use and when do I have to use it?

",1604077089,https://stackoverflow.com/q/64612696,LJRB,"['cypher', 'neo4j']"
64607656,neo4j Cypher - Match query pulling data no within set parameters,"## Outline ##

I have a fairly basic `match` query that I want to get me results where the `score` field value is equal to or greater than the parameter. (10 in the below)

## The Code ##
        MATCH (u:data)
        WHERE  u.score &gt;= &quot;10&quot;
        RETURN id(u) AS id, u.score AS score
        LIMIT 10


## Output ##

Currently I receive the following back

    ╒══════╤══════════════╕
    │&quot;id&quot;  │&quot;score&quot;       │
    ╞══════╪══════════════╡
    │906674│&quot;860&quot;         │
    ├──────┼──────────────┤
    │906676│&quot;1000&quot;        │
    ├──────┼──────────────┤
    │906677│&quot;860&quot;         │
    ├──────┼──────────────┤
    │906879│&quot;860&quot;         │
    ├──────┼──────────────┤
    │906882│&quot;260&quot;         │
    ├──────┼──────────────┤
    │906888│&quot;360&quot;         │
    ├──────┼──────────────┤
    │906989│&quot;2100&quot;        │
    ├──────┼──────────────┤
    │907065│&quot;1160&quot;        │
    ├──────┼──────────────┤
    │907107│&quot;260&quot;         │
    ├──────┼──────────────┤
    │907152│&quot;5&quot;           │
    └──────┴──────────────┘


As you can see, the last row has a score of `5` which is obviously not `&gt;= 10`


## Things I&#39;ve tried ##

`WHERE  u.score &gt;= 10` returns 0 rows

`WHERE  u.score &gt;= &#39;10&#39;` returns error


Thank you in advance for the help!!",1604057933,https://stackoverflow.com/q/64607656,Simon,"['neo4j', 'cypher']"
64604158,How to fetch all the paths from root to leaf (DFS way) in Neo4j and return the result containing nodes and relationships,"I have a graph where I used following cypher to display all the paths in the Graph . This returns all the nodes .
CQL : MATCH p=(root {id: &#39;start&#39;})-[*]-&gt;(leaf) RETURN EXTRACT(x IN NODES(p) | x.name) AS result;

I want to return nodes and edges so that layman can understand what all paths exists from root to leaf in the graph . 

",1604042677,https://stackoverflow.com/q/64604158,priya,"['cypher', 'neo4j']"
64594151,neo4j-graphql-js: satisfy type using @cypher without returning a concrete node,"Often I want to create a GraphQL type that represents the results of a Cypher query that spans than one node.  I can&#39;t return a concrete node from `@cypher` in this case, as no such node exists.  I tried to return appropriately named fields from a top-level `@cypher` query but this approach did not work.

```
import { makeAugmentedSchema, neo4jgraphql } from &#39;neo4j-graphql-js&#39;;
import { ApolloServer } from &#39;apollo-server&#39;;
import neo4j from &#39;neo4j-driver&#39;;

const typeDefs = `
type Person {
    name: String
    age: Int
}

type Query {
    persons: [Person] @cypher(
        statement: &quot;&quot;&quot;
            WITH [[&quot;foo&quot;, 42], [&quot;bar&quot;, 43]] AS x UNWIND x AS y
            RETURN y[0] AS name, y[1] AS age
        &quot;&quot;&quot;
    )
}
`;

const driver = neo4j.driver(
    &#39;bolt://localhost:7687&#39;,
    neo4j.auth.basic(&#39;neo4j&#39;, &#39;password&#39;)
);


const resolvers = {
};

const schema = makeAugmentedSchema({ typeDefs, resolvers });


const server = new ApolloServer(
    {
        schema,
        resolvers,
        context: {driver}
    }
)


server.listen(4000, &#39;0.0.0.0&#39;).then(({ url }) =&gt; {
    console.log(`GraphQL API ready at ${url}`);
});
```

Query:

```
{
  persons {
    name
    age
  }
}
```

Yields the error:

```
{
  &quot;errors&quot;: [
    {
      &quot;message&quot;: &quot;String(\&quot;foo\&quot;) (of class org.neo4j.values.storable.StringWrappingStringValue)&quot;,
      &quot;locations&quot;: [
        {
          &quot;line&quot;: 2,
          &quot;column&quot;: 3
        }
      ],
      &quot;path&quot;: [
        &quot;persons&quot;
      ],
      &quot;extensions&quot;: {
        &quot;code&quot;: &quot;INTERNAL_SERVER_ERROR&quot;,
        &quot;exception&quot;: {
          &quot;code&quot;: &quot;Neo.DatabaseError.General.UnknownError&quot;,
          &quot;name&quot;: &quot;Neo4jError&quot;,
          &quot;stacktrace&quot;: [
            &quot;Neo4jError: String(\&quot;foo\&quot;) (of class org.neo4j.values.storable.StringWrappingStringValue)&quot;,
            &quot;&quot;,
            &quot;    at captureStacktrace (/home/amoe/dev/neo4j-graphql-js-return-aggregate-type/node_modules/neo4j-driver/lib/result.js:277:15)&quot;,
            &quot;    at new Result (/home/amoe/dev/neo4j-graphql-js-return-aggregate-type/node_modules/neo4j-driver/lib/result.js:68:19)&quot;,
            &quot;    at newCompletedResult (/home/amoe/dev/neo4j-graphql-js-return-aggregate-type/node_modules/neo4j-driver/lib/transaction.js:449:10)&quot;,
            &quot;    at Object.run (/home/amoe/dev/neo4j-graphql-js-return-aggregate-type/node_modules/neo4j-driver/lib/transaction.js:287:14)&quot;,
            &quot;    at Transaction.run (/home/amoe/dev/neo4j-graphql-js-return-aggregate-type/node_modules/neo4j-driver/lib/transaction.js:123:32)&quot;,
            &quot;    at _callee2$ (/home/amoe/dev/neo4j-graphql-js-return-aggregate-type/node_modules/neo4j-graphql-js/dist/index.js:222:35)&quot;,
            &quot;    at tryCatch (/home/amoe/dev/neo4j-graphql-js-return-aggregate-type/node_modules/regenerator-runtime/runtime.js:63:40)&quot;,
            &quot;    at Generator.invoke [as _invoke] (/home/amoe/dev/neo4j-graphql-js-return-aggregate-type/node_modules/regenerator-runtime/runtime.js:293:22)&quot;,
            &quot;    at Generator.next (/home/amoe/dev/neo4j-graphql-js-return-aggregate-type/node_modules/regenerator-runtime/runtime.js:118:21)&quot;,
            &quot;    at asyncGeneratorStep (/home/amoe/dev/neo4j-graphql-js-return-aggregate-type/node_modules/@babel/runtime-corejs2/helpers/asyncToGenerator.js:5:24)&quot;
          ]
        }
      }
    }
  ],
  &quot;data&quot;: {
    &quot;persons&quot;: null
  }
}
```

I know I can satisfy individual fields with a per-field `@cypher` annotation, that&#39;s not appropriate for this case.  This question is about satisfying a whole result type.

If the answer requires using a custom handler in the `resolvers` array, that&#39;s also fine, as long as I can gather the data required to satisfy the type within a single query.  Or if this is impossible, that would also be useful information.",1603984969,https://stackoverflow.com/q/64594151,amoe,"['graphql', 'neo4j-graphql-js', 'neo4j', 'cypher']"
64580313,Is it possible not to output relation column when using APOC.export?,"    MATCH (m:computer)
    
    WITH collect(DISTINCT m) AS M
    CALL apoc.export.csv.data( M, [], null, {stream:true, batchSize:100}) YIELD data as mdata

For such a query, even if just for export nodes, without relationships, it still gives the following field with all empty values:
 

     _start
      _end
      _type

And it&#39;s hard to filter out them in the process. Is there a parameter to control this? 


ADDITIONS:

    MATCH (m:SportsTeam)-[r:hasMember]-(n)
    WITH collect(DISTINCT m) AS M, collect(DISTINCT n) AS N, collect(r) as R
    CALL apoc.export.csv.data( M, [], null, {stream:true}) YIELD data
    WITH apoc.text.replace(data, &#39;(?:,&quot;_start&quot;,&quot;_end&quot;,&quot;_type&quot;|,,,)(?=\n)&#39;, &#39;&#39;) AS mdata
    CALL apoc.export.csv.data( N, [], null, {stream:true}) YIELD data as ndata
    WITH apoc.text.replace(data, &#39;(?:,&quot;_start&quot;,&quot;_end&quot;,&quot;_type&quot;|,,,)(?=\n)&#39;, &#39;&#39;) AS ndata
    CALL apoc.export.csv.data( [], R, null, {stream:true}) YIELD data as rdata
    RETURN mdata, ndata, rdata

What I am doing here is to output the node M, node N and relation R into 3 different files. After I added the 2 replace functions to get rid of the last 3 columns, it reports this error:

    neobolt.exceptions.CypherSyntaxError: Variable `N` not defined (line 5, column 28 (offset: 282))
    &quot;CALL apoc.export.csv.data( N, [], null, {stream:true}) YIELD data as ndata&quot;

Does the CALL and WITH can&#39;t be used in a row like this?

",1603914603,https://stackoverflow.com/q/64580313,marlon,"['neo4j', 'cypher', 'neo4j-apoc']"
64569614,Why so many db hit in neo4j?,"[![enter image description here][1]][1]
[![enter image description here][2]][2]
There is total 1 Category node and 2 Template node in my case. I put an * in [*] to support more further scenarios. But why there are so many db hit in this cypher for current data? 


  [1]: https://i.stack.imgur.com/mNWEl.png
  [2]: https://i.stack.imgur.com/HPBUD.png",1603876098,https://stackoverflow.com/q/64569614,Miko,"['cypher', 'graph-databases', 'neo4j']"
64556541,How to create a Hash in Neo4j from given string?,"I do the following 

CREATE (p:person { FirstName:&quot;M&quot;, LastName: &quot;H&quot; , Language: &quot;en&quot;, hash: apoc.util.sha512(&#39;1234567&#39;,&#39;salt&#39;)});

Error:
Function call does not provide the required number of arguments: expected 1 got 2.

Function apoc.util.sha512 has signature: apoc.util.sha512(values :: LIST? OF ANY?) :: STRING?
meaning that it expects 1 argument of type LIST? OF ANY?
Description: apoc.util.sha512([values]) | computes the sha512 of the concatenation of all string values of the list (line 2, column 73 (offset: 73))
&quot;CREATE (p:person { FirstName:&quot;M&quot;, LastName: &quot;H&quot; , Language: &quot;en&quot;, hash: apoc.util.sha512(&#39;1234567&#39;,&#39;salt&#39;)});&quot;

what is a Type of List argument? 
thanks rob",1603808710,https://stackoverflow.com/q/64556541,Robert Kuhlig,"['hash', 'neo4j', 'cypher']"
64551530,"How can I define a variable in FOREACH clause in neo4j, How to find the number of common properties for two nodes","As the title suggests, I have a problem of defining and storing variable in neo4j and below is my code:

    // 6. Display a list of pairs of restaurants having more than three features in common.
    MATCH(p1:Place), (p2:Place)
    WHERE p1.placeId &lt;&gt; p2.placeId
    WITH count = 0
    FOREACH(ignoreMe in CASE 
        WHEN
        p1.property1 = p2.property1 THEN [1] 
        WHEN
        p1.property2 = p2.property2 THEN [1]
        WHEN
        ...//omit for university academic requirement
        ELSE []    
        END |
        count = count + 1
    )
    FOREACH(ignoreMe in CASE 
        WHEN
        count &gt; 3 THEN [1]
        ELSE []    
        END |
        RETURN p1,p2
    )
I want to find pair of places which have over 3 features in common. When I run this code, the problem occurs because inside foreach I cannot find the variable count. Is there any alternative solution to this? Or is there more efficient way to find the common features for two nodes? Any suggestion is appreciated.
[![error screenshot][1]][1]


  [1]: https://i.stack.imgur.com/5pvCG.png",1603791002,https://stackoverflow.com/q/64551530,Stan Peng,"['neo4j', 'cypher']"
64551373,How to select the node with the highest number of incoming relationships?,"I have a database with 3 types of nodes:
**articles** (in blue)
**entities** (in pink)
and **solution** (in green).
They are linked with **APPEARS_IN** or **PART_OF** relationships.
[![Structure of the dataset][1]][1]


  [1]: https://i.stack.imgur.com/jRnEQ.jpg
I&#39;m trying to select the solution node which has **the hishest number of incoming relationships** (&quot;Link with Unity Pro en Fran&#231;ais&quot;), I tryed with this query with a threshold (&gt;2) but it is not exactly what I want to do, because here I know that the highest number of incoming relationship is 3, but it can be different for other examples:

    MATCH (q:Question {title:&quot;Comment avoir l&#39;aide en ligne en fran&#231;ais sur Unity Pro?&quot;})&lt;-[:APPEARS_IN]-(e:Entity)
    MATCH (e:Entity)-[r:PART_OF]-&gt;(s:Solution)
    WITH collect(e) AS entities, s, count(r) AS num WHERE num &gt; 2
    RETURN s

**How can I find the &#39;solution&#39; node or nodes (in green) with the highest number of incoming relationships?** ",1603790477,https://stackoverflow.com/q/64551373,pat_triccia,"['cypher', 'neo4j']"
64538892,Neo4J right way of writing a cypher query,"At the moment I have the following cypher query:

    MATCH (co1:CORPORATION)&lt;-[:is_employee_of]-(p:PERSON)-[:has_personal_account]-&gt;(a1:ACCOUNT)- 
    [:transfer_origin]-&gt;(t:TRANSFER)&lt;-[:transfer_destination]-(a2:ACCOUNT)&lt;-[:has_corporate_account]- 
    (co2:CORPORATION)-[:incorporated_in]-&gt;(c:COUNTRY)
    WHERE c.IS_TAX_HAVEN = 1
    RETURN co1

This query has a lot of relationships and nodes in the MATCH.
Is this the right way to write a query or do I have to split up this MATCH?",1603721750,https://stackoverflow.com/q/64538892,Julian de Bruin,"['cypher', 'neo4j']"
64535312,Neo4j Cypher query: Find node by input path,"I have a graph that contains a tree hierarchy of the system. In this graph, one root has indexed label &#39;MainRoot&#39;, all other relationships are type &#39;hasParent&#39;.
I would like to construct a query that would have list of nodes names (=inputPath) as an input and return the node at the end of query. 

Now i have this working example, which last returned item is the specified node with the name &quot;java&quot;, as I want (located in Root/src/main/java):
```
// Input
WITH [&quot;Root&quot;, &quot;src&quot;, &quot;main&quot;, &quot;java&quot;] AS inputPath
// Iterator
UNWIND range(0,size(inputPath)-2) AS i
MATCH (parent)&lt;-[:hasParent]-(child)
WHERE (parent.name = inputPath[i]) AND (child.name = inputPath[i+1])
RETURN child
```

However, I would like to somehow let the query now, that the first parent element of the query is the node with the indexed label &#39;MainRoot&#39;.
1) I expect it would be more efficient since it will now, in which node to start the traversal.
2) If I have structure e.g. Root/example/Root/src/main/java, the query would also return this &#39;java&#39; node, which I obviously don&#39;t want to return.

Any idea how could I do that?",1603708013,https://stackoverflow.com/q/64535312,Lukasmp3,"['neo4j', 'cypher']"
64524380,How to add to a string value of a property instead of rewriting it in Cypher Neo4J?,"Suppose I make a request in Neo4J (3.5) Cypher and I want to rewrite the last letter of the value in the property of a node rather than rewriting it. 

I do add a string with the following request, but how to replace the last letter &quot;a&quot; for example with &quot;o&quot; and then add the string after?

```
MATCH (c:Context{name:&#39;lisaksa&#39;}) WITH c.name AS cname, c SET c.name = cname + &#39;_new&#39;;

```
",1603633429,https://stackoverflow.com/q/64524380,Aerodynamika,"['neo4j', 'cypher']"
64522770,How to integrate path patterns with cypher morpheus?,"I&#39;m trying use Cypher query with Spark. I&#39;m following this guide: https://github.com/opencypher/morpheus
but I&#39;m not able to use path patterns `p=()-[]-&gt;()`.
My main problem is that I want to calculate the level of relationship. 
For example:
`p=(u)-[:rel]-(f) 
return length(p)`
Thank&#39;s for answer.",1603622331,https://stackoverflow.com/q/64522770,Miriam Vittoria D&#39;Aloia,"['apache-spark', 'cypher', 'neo4j', 'scala']"
64499145,"Neo4j compare two Arrays, Cypher Query","Is there a way to compare two arrays in `Neo4j` cypher query ? I have real estates already created with for each some `amenities` as string property separated with comma.

My need is to get all nodes labeled `Estate` where `amenities split` contain `array parameter`.

    MATCH (e:Estate)
    WHERE (a IN [&quot;Laundry&quot;,&quot;Dryer&quot;] WHERE a IN SPLIT(e.amenities,&quot;,&quot;))
    RETURN e

How to achieve this ?",1603452594,https://stackoverflow.com/q/64499145,Jhakiz,"['neo4j', 'cypher']"
64485324,Neo4j/Cypher FOREACH square brackets and use of &quot;THEN [1]&quot;,"I have seen multiple examples of cypher FOREACH statements that reference the number 1 in square brackets and I cannot find documentation on it. This is a working statement:
```
FOREACH(i in CASE WHEN NOT rel IS NULL THEN [1] ELSE [] END |
DELETE rel CREATE (newest)-[:NEXT_SUB_REPLY]-&gt;(prevNewest))
```
and as happy as I am that it is working, I would like to understand more about the use of square brackets and the use of the number 1. From the context I understand that it loops through and when 
```
CASE WHEN NOT rel IS NULL
```
is true, it executes
```
DELETE rel CREATE (newest)-[:NEXT_SUB_REPLY]-&gt;(prevNewest)
```

and otherwise it does nothing. The Neo4j [docs][1] are very light on FOREACH and don&#39;t go into either the use of square brackets or using a 1 in the THEN clause. 


  [1]: https://neo4j.com/docs/cypher-manual/current/clauses/foreach/",1603379780,https://stackoverflow.com/q/64485324,Matt Larson,"['graph-databases', 'neo4j', 'cypher', 'cypher-3.1']"
64480529,Assign match result to a second variable and perform filter,"Is there a way to duplicate the results of a query to another variable, then perform some filtering on the second variable so potentially two different results return?

I&#39;m trying to first save a path to a variable, then assign that result to a second variable, then perform a WHERE on that second variable, while returning the results from the origina query (first variable)

    MATCH
    	(a:Account {id : &#39;3edcfba7-e95b-4d22-9793-e5f983ebde33&#39;})
    MATCH
    	(target:Vertex { id : &#39;59255ad6-0397-4b2d-9e69-6999131cea16&#39;})
    	&lt;-[:PARENT*]-
    	(a)
    OPTIONAL MATCH
    	p=
    		(new_parent:Vertex {id : &#39;3a63f643-f437-4415-b046-b324aa697f42&#39;})
    		&lt;-[:PARENT*]-
    		(a)
    WITH
    	p
    	, target
	    , p AS child
	    WHERE
		    NONE(x IN nodes(child) WHERE x = target)
    RETURN
    	p
    	, target
    	, child // this can return null",1603363244,https://stackoverflow.com/q/64480529,A. L,"['cypher', 'neo4j']"
64471062,How to create random relationships between nodes?,"I&#39;m trying to create random transaction between bank accounts. I have created the following query:

    //Create transactions
    CALL apoc.periodic.iterate(&quot;
    match (a:BANK_ACCOUNT)
    WITH apoc.coll.randomItem(collect(a)) as sender
    return sender&quot;, &quot;
    MATCH (b:BANK_ACCOUNT)
    WHERE NOT sender = b
    WITH apoc.coll.randomItem(collect(b)) as receiver
    MERGE (sender)-[r:HAS_TRANSFERED {time: datetime()}]-&gt;(receiver)
    set r.amount = rand()*1000&quot;,
    {batchSize:100, parallel:false});

I would assume that it would create 100 random transactions between random bank accounts. Instead it creates 1 new bank account and 1 new relationship. What am I doing wrong and what should I do?

Thanks for your help !",1603311056,https://stackoverflow.com/q/64471062,jvilledieu,"['cypher', 'neo4j']"
64457321,fetching a tree for a particular node in neo4j,"I want all children of a given node with their interconnection with each other. For example A-&gt;B-&gt;C-&gt;D is a tree and I want a tree from A(starting point), Output should be &lt;br /&gt;
  A-&gt;B&lt;br /&gt;
  B-&gt;C&lt;br /&gt;
  C-&gt;D&lt;br /&gt;
and not as&lt;br /&gt;
  A-&gt;B&lt;br /&gt; 
  A-&gt;C&lt;br /&gt; 
  A-&gt;D&lt;br /&gt;

`MATCH (fromNode:Part{partNumber:&quot;100&quot;})-[:HAS_BOM_PROPERTY]-&gt;(BomNode:BomProperties)-[*]-&gt;(toNode:Part) return fromNode{.*}, toNode{.*},BomNode{.*}` 

I am using above query, it is giving me all the nodes connected with partNumber 100 at all levels but I want them along with their relationship with respective parent element and not all directly connected to partNumber 100.

     ",1603258949,https://stackoverflow.com/q/64457321,Sonal Pachpute,"['neo4j', 'cypher']"
64444991,Spring data neo4j custom @QueryResult doesn&#39;t recognize enums,"I&#39;m trying to create a custom `@QueryResult` with multiple fields from different nodes, but it seems like the query result mechanism is unable to map enum correctly.

This is an example that I made for this scenario. I created a basic enum as:

```
public enum MyEnum{
    SOMETHING, SOMETHING_ELSE
}
```

And spring data neo4j repository method with the query:
```
    @Query(&quot;Match (people:People)-[:LIVES_IN]-&gt;(country:Country) &quot; +
            &quot;RETURN people.enum&quot;)
    List&lt;WithEnumQueryResult&gt; findPeople();
```

when I trigger it throws an exception:
```
org.springframework.data.mapping.model.MappingInstantiationException: Failed to instantiate pl.degath.WithEnumQueryResult using constructor pl.degath.WithEnumQueryResult(pl.degath.MyEnum) with arguments SOMETHING_ELSE
```


I was able to see through trial and error that:

```
@Builder
@Getter
@QueryResult
public class WithEnumQueryResult{
    private final MyEnum enum; //this one I would like to have, but throws error
    private final String enum; //this returns my enum as String (doesn&#39;t throw error)
    private final People people; //this one has correct enum as a property of people (doesn&#39;t throw error)
}
```


I tried also add some @Converter e.g. `@Convert(EnumStringConverter.class)` annotation in front of my enum property, but it didn&#39;t help out.


Any ideas on how can I make my QueryResult recognize enums?


*EDIT:*

As mentioned in a comment from the accepted answer, it seems like enums require no-args constructors, so I had to change my immutable object into the:

```
@Builder
@Getter
@NoArgsConstructor(access = AccessLevel.PRIVATE)
@AllArgsConstructor
@QueryResult
public class WithEnumQueryResult{
    private MyEnum enum; //enum is visible now!
}
```

",1603196271,https://stackoverflow.com/q/64444991,degath,"['neo4j', 'spring-data-neo4j', 'enums', 'java', 'cypher']"
64443366,Neo4j real-time recommendation performance,"I am trying to understand the performance of neo4j in real-time recommendation systems.

The following is a cypher query (taken from their sandbox) which computes top 100 most similar users (in cosine-distance) to the query user &quot;Cynthia Freeman&quot;:

```cypher
MATCH 
    (p1:User {name: &quot;Cynthia Freeman&quot;})-[x:RATED]-&gt;(m:Movie)&lt;-[y:RATED]-(p2:User)
WITH 
    COUNT(m) AS numberMovies, 
    SUM(x.rating * y.rating) AS xyDotProduct,
    SQRT(REDUCE(xDot = 0.0, a IN COLLECT(x.rating) | xDot + a^2)) AS xLength,
    SQRT(REDUCE(yDot = 0.0, b IN COLLECT(y.rating) | yDot + b^2)) AS yLength,
    p1, p2 
WHERE
    numberMovies &gt; 10
RETURN 
    p1.name, p2.name, xyDotProduct / (xLength * yLength) AS sim
ORDER BY sim DESC
LIMIT 100;
```

If my understanding is correct, there&#39;s no *magic* behind the [`LIMIT`](https://neo4j.com/docs/cypher-manual/current/clauses/limit/) clause, as the distance computation still needs to be done vs. all other users, so resolving this query in real-time seems a bit of a stretch, unless neo4j is doing something behind the scenes.

In another example, they pre-compute this `[:SIMILARITY]` relationship between user nodes and store it in the graph, thus querying the top-N most similar users becomes an ordering of nodes. This will intuitively make the graph dense, so there are no storage advantages over simply using a similarity matrix.

Am I missing something fundamental about the way graph databases (and neo4j in particular) work? How can this scale to real-time applications, where there can be tens of thousands of users, and even more products that they interact with?",1603190066,https://stackoverflow.com/q/64443366,Alexandru Dinu,"['recommendation-engine', 'cypher', 'neo4j', 'performance']"
64442208,Create Relationship between child nodes,"I want to create a new relationship between nodes of the same label based on their relationship to the same parent node. The attached picture is an example:

![Nodes overview](https://i.stack.imgur.com/sVxhR.png)

Only (Person)/Authors that worked on the **same** Article should have a relationship [WORKED_WITH] to another. Is there an elegant way, to do this using cypher or maybe apoc? So far the only solution I came up with is by creating a RESULT of each article name with a list (collect) of the authors. Which then would have to be used (py2neo) to create the relationship.

Thanks for your help.

",1603185688,https://stackoverflow.com/q/64442208,JDizzle,"['neo4j', 'cypher', 'neo4j-apoc']"
64427605,Neo4j 4 and .NET Core Identity Framework,"I want to use .NET Core Identity Framework with the new Neo4j version 4 in ASP.net Core but any implementation I looked for, does not support the new Neo4j.
Like:

[Neo4j.AspNet.Identity.Core][1]


[Neo4j.AspNetCore.Identity][2]


  [1]: https://github.com/cskardon/Neo4j.AspNet.Identity.Core#neo4jaspnetidentitycore
  [2]: https://github.com/francnuec/Neo4j.AspNetCore.Identity",1603111469,https://stackoverflow.com/q/64427605,Amirhosein Rajabi,"['asp.net-core', 'cypher', 'neo4j', 'asp.net-identity']"
64412381,Find max depth with bidiretional graph,"using neo4j I&#39;m trying to find max depth in this graph:

[![graph][1]][1]

Using this query I find deph value 20 (because I have this bidirectional relationship):

    MATCH p=(u:User)-[:Amico*]-&gt;(f:User)
    RETURN p, length(p) order by length(p) desc limit 1

How can I have the true value of this depth?

  [1]: https://i.stack.imgur.com/GIxzm.png",1603018026,https://stackoverflow.com/q/64412381,Francesco Bocci,"['cypher', 'neo4j']"
64396370,Java Neo4j reduce the number of transactions to improve the performance,"I&#39;m trying to generate a Neo4j database using Java based on the computation of Kleene matrix. To simplify, each node has an id with the form ```m&amp;n``` where m and n are integers, and for each level ```i``` in this graph, I want to find all nodes with id&#39;s as ```*&amp;i``` and ```i&amp;*``` so I can combine them to get new nodes with ```i``` as an intermediate node. For example, the current level is 2, then from nodes whose id&#39;s are ```1&amp;2``` and ```2&amp;3```, it can create a new node with id ```1&amp;3```. And it also connects the new nodes to its parent nodes.
And my codes look like this:
```
foreach(level i){
   foreach(nodeid id_m ends with i){//
      foreach(nodeid id_n starts with i){
          try(Transaction tx = graph.beginTx()){
            Node m = tx.findNode(id_m);
            Node n = tx.findNode(id_n);
            Node newNode = tx.createNode();
            newNode.setProperties(...);
            newNode.createRelationshipTo(m);
            newNode.createRelationshipTo(n);
            tx.commit();
          }
      }
   }
}
``` 
Both ```id_m``` and ```id_n``` are searched and put in lists by Java function in the outer loop. Each time when the code creates a new node, it commits the transaction once. However when there are a huge number of new nodes created(approximately millions of new nodes), it gets incredibly slow(more than 4 hours, which is not acceptable). 
I was thinking about the following solutions:
1) using multithreads to create these nodes, but it might not suit my case since each time creating a relationship between two nodes, both nodes will be locked until it&#39;s committed, and the same nodes might appear in different threads.
2) saving the new node information to a queue and commit it to Neo4j database when its size is too large. However without new nodes created to the database, it&#39;s not able to connect them with their parents. So it seems like impossible to reduce the number of transactions.

So is there any other possible ways to improve the performance of this code? Or is it possible to implement this by Neo4j clauses? Any help would be much appreciated.",1602882272,https://stackoverflow.com/q/64396370,BrandNewStory,"['java', 'cypher', 'neo4j']"
64395026,How do I get a list of Neo4j nodes in a directed graph starting from a subnode?,"I have a very large graph that has one root node that fans out into multiple nodes. I need to get a list of ALL of the nodes in the subgraph. Other than label, they don&#39;t have a common attribute. They are only connected by the &quot;connections&quot; 

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/lwZiR.png

Looking at my very simplified graph, I wanted to start from B

MATCH (n: {label:&#39;B&#39;}) and get a list of all the subnodes [E,C,H,F]

or Start with D and get [G] or 
start with C and get [H,F]

I though this would get me where I needed to go 

    https://neo4j.com/labs/apoc/4.1/graph-querying/expand-subgraph/

But i can&#39;t get the results. ",1602875244,https://stackoverflow.com/q/64395026,billDickens,"['cypher', 'neo4j']"
64390987,Neo4j Cypher query for a linked list to conditionally create a NEWEST_REPLY vs modifying NEWEST_REPLY to NEXT_REPLY,"I have a linked list of replies off of a Post that looks like this: 

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/355Pp.png

With the &quot;first&quot; reply in the list having a NEWEST_REPLY relationship to Post and subsequent replies having a NEXT_REPLY relationship. The query to get the above graph:
```
MATCH (p:Post {id: $postId})-[:NEWEST_REPLY|NEXT_REPLY*]-&gt;(r:Reply) 
return p, r
```
I want to create a cypher query that either

 1. Creates a reply and creates the NEWEST_REPLY relationship when there are no replies OR
 2. Creates a reply, deletes the current NEWEST_REPLY relationship, creates a NEXT_REPLY relationship to the previous NEWEST_REPLY and a NEWEST_REPLY relationship to the new Reply.

This statement: 
```
MATCH (p:Post {id: $postId})-[rel:NEWEST_REPLY]-&gt;(previousNewestReply:Reply)
DELETE rel
CREATE (r:Reply { id: apoc.create.uuid(), body: $body, createdAt: datetime(), updatedAt: datetime() })
WITH r, p, previousNewestReply
MATCH (u:User)
WHERE u.id = $userId 
CREATE (r)&lt;-[:WROTE]-(u)
CREATE (r)&lt;-[:NEWEST_REPLY]-(p)
CREATE (r)-[:NEXT_REPLY]-&gt;(previousNewestReply)
RETURN u, p
```
achieves number 2. 

What I now need to do is conditionally run this statement if the `rel` in `MATCH (p:Post {id: $postId})-[rel:NEWEST_REPLY]-&gt;(previousNewestReply:Reply)` exists, but if it does not exist, just create NEWEST_REPLY for the first time as well as creating the reply and the `User-[:WROTE]-&gt;Reply` relationship. I&#39;m new to cypher and digging into MERGE, CASE, predicate functions and apoc.when() and not sure which would be the simplest and most appropriate.

Here&#39;s an attempt at using CASE:
```
MATCH (p:Post {id: &quot;db7ee38c-fe60-430e-a7c7-0b2514401343&quot;})
RETURN
CASE EXISTS( (p)-[rel:NEWEST_REPLY]-&gt;(replies:Reply) )
WHEN true  THEN DELETE rel CREATE (r:Reply { id: apoc.create.uuid(), body: &quot;new with CASE1&quot;, createdAt: datetime(), updatedAt: datetime() }) WITH r, p, replies MATCH (u:User) WHERE u.id = &quot;e14d409e-d970-4c5c-9cc7-3b224c774835&quot; CREATE (r)&lt;-[:WROTE]-(u) CREATE (r)&lt;-[:NEWEST_REPLY]-(p) CREATE (r)-[:NEXT_REPLY]-&gt;(replies)
WHEN false THEN CREATE (r:Reply { id: apoc.create.uuid(), body: &quot;new with CASE2&quot;, createdAt: datetime(), updatedAt: datetime() }) WITH r, p, previousNewestReply MATCH (u:User) WHERE u.id = &quot;e14d409e-d970-4c5c-9cc7-3b224c774835&quot; CREATE (r)&lt;-[:WROTE]-(u) CREATE (r)&lt;-[:NEWEST_REPLY]-(p) END
AS result;
```
And running into the following SyntaxError:
```
Invalid input &#39;r&#39;: expected whitespace, comment, &#39;{&#39;, node labels, MapLiteral, a parameter, a parameter (old syntax), a relationship pattern, &#39;(&#39;, &#39;.&#39;, &#39;[&#39;, &#39;^&#39;, &#39;*&#39;, &#39;/&#39;, &#39;%&#39;, &#39;+&#39;, &#39;-&#39;, &quot;=~&quot;, IN, STARTS, ENDS, CONTAINS, IS, &#39;=&#39;, &#39;~&#39;, &quot;&lt;&gt;&quot;, &quot;!=&quot;, &#39;&lt;&#39;, &#39;&gt;&#39;, &quot;&lt;=&quot;, &quot;&gt;=&quot;, AND, XOR, OR, WHEN, ELSE or END (line 4, column 24 (offset: 145))
&quot;WHEN true  THEN DELETE rel CREATE (r:Reply { id: apoc.create.uuid(), body: &quot;new with CASE1&quot;, createdAt: datetime(), updatedAt: datetime() }) WITH r, p, replies MATCH (u:User) WHERE u.id = &quot;e14d409e-d970-4c5c-9cc7-3b224c774835&quot; CREATE (r)&lt;-[:WROTE]-(u) CREATE (r)&lt;-[:NEWEST_REPLY]-(p) CREATE (r)-[:NEXT_REPLY]-&gt;(replies)&quot;
```
My sense is that the logic I am attempting in either THEN statements is too complex for a CASE. Is there a more appropriate with to essentially do an if/else off of whether or not the NEWEST_REPLY relationship exists off of a specific Post?",1602857977,https://stackoverflow.com/q/64390987,Matt Larson,"['neo4j', 'cypher']"
64378773,Neo4j get the biggest node whose property is smaller than a specific value,"In my Neo4j database, there are many nodes with the same nodeID and different levels, and they are connected through a path. Each time I&#39;m trying to find the node that has the biggest level which is smaller than a specific level ```n```. I use the following Cypher query, which starts searching from the most current node with the nodeID ```id```. 
```
MATCH (:Node{NodeID:id,Current:&#39;true&#39;})-[:type*0..]-&gt;(m:Node{NodeID:id}) 
WHERE m.Level &lt; n
RETURN m
ORDER BY m.Level DESC
LIMIT 1
```
And the index I create for this database is as following:
```
CREATE INDEX Nodes FOR(n:Node) ON (n.NodeID, n.Level)
```
However, it&#39;s kind of slow especially when the path is long and I need to repeat this process thousands of times. So my question is, is there any better way of implementation and do I need to modify my index to improve the performance? Thanks in advance for your help!",1602791532,https://stackoverflow.com/q/64378773,BrandNewStory,"['neo4j', 'cypher']"
64375493,Cypher: Group by community id,"My database in Neo4j looks like this: 

    (a:ARTICLE)-[:SIMILAR]-(a:ARTICLE)

ARTICLES nodes have the community property, it is the id of cluster.

I would like to group articles by community_id, I tried this but nothing happened:

    MATCH (a:ARTICLE)-[:SIMILAR]-(a:ARTICLE)
    WITH a, collect(a.community) as community
    RETURN a

Where am I wrong ?
",1602777768,https://stackoverflow.com/q/64375493,LJRB,"['neo4j', 'cypher']"
64373442,Is there a simple way to &quot;unpack&quot; a list in Neo4j?,"I have a string attribute in my Neo4j database that is actually a list cast as string (e.g. &quot;[1,1,3,10]&quot;). I realize I can alter the load program to make those separate fields (e.g. elem1 = 1, elem2 = 1, elem3 = 3, elem4 = 10) but I want to be able to recast the ones already loaded. 

I could write a python but hoping that someone has a &quot;in cypher&quot; way to do this. ",1602771036,https://stackoverflow.com/q/64373442,billDickens,"['neo4j', 'cypher']"
64368615,Search through all properties of nodes of an unknown path and return nodes with highest matching rate,"I&#39;m building a search function in Cypher with a single input field for a graph search. The tricky part is, I don&#39;t know the labels and properties and the search query could consist of multiple words. The search should return the most relevant nodes, which can be direct-matching nodes and indirect-matching nodes, which means a node is connected to one or many direct-matching nodes. A sample search query could be: ***iphone john doe***. 

My first iteration was matching all nodes, iterating over all properties and doing a simple case-insensitive string comparison of the property value with list of search strings aka `$queries`:

    MATCH (n)
    WITH n, [k in KEYS(n) WHERE any(q IN $queries WHERE toLower(toString(n[k])) CONTAINS q) | k] AS keys
    UNWIND keys AS key
    RETURN DISTINCT n

That works quite nice, but simply returns too many matches. For my sample query, it would return all `Product` nodes which contain the word ***iPhone*** and all `Customer` nodes which contain partly the name ***John*** or ***Doe***.

What I would like to get as a result is a path of nodes with the most matches, for example:

    (p:Product {name: iPhone 11 64GB})&lt;-[:CONTAINS]-(o:Order)&lt;-[:ORDERED]-(c:Customer {firstName: John, lastName: Doe})

That means my search algo should not only consider the matches on properties of each node, but the total number of matches for a path of connected nodes. 

My first assumption is that I have break the search process down into two steps:
1. search all nodes that match on one or more properties with the search strings in the query (the more matches the higher the relevance). the result is basically a subgraph.
2. find connections betweens the nodes of the subgraph and count the number of matches of a path of connected nodes (the distance between the nodes of a path should also be a criteria for the relevance, but is not important at the moment). the result is a path of nodes.

Here&#39;s where I got stuck. Does my assumption make sense or is there another way (maybe better) to do it? Is it even possible to do it with Cypher and Neo4j (not considering the performance as a factor)?

I would be very happy about some opinions or sample queries how it could be done.",1602754188,https://stackoverflow.com/q/64368615,zrkl,"['cypher', 'nodes', 'search', 'graph', 'neo4j']"
64366534,Check and update nodes in neo4j python-loopover,"I am having a json array of user detail nodes and I do loop over it and check if a **node** already exists with the specific numeric id property; if it exists then check the &#39;id&#39; property of the node, if the &#39;id&#39; is numeric(**isdigit**) then do nothing but if &#39;id&#39; is not property then update the &#39;**id**&#39; property and set it to the &#39;**numeric_id**&#39;.

    for x in all_json:
        f_id = x.get(&quot;id&quot;,&#39;&#39;)
        f_num_id = x.get(&#39;numaric_id&#39;,&#39;&#39;)
        tnode = self.find_user_friend(f_num_id, uid) 
        if tnode is not None:
             #### Update id to numeric id #####
             if tnode[&#39;n&#39;][&#39;id&#39;].isdigit():
                pass
             else:
                 tnode[&#39;n&#39;][&#39;id&#39;] = f_num_id
                 tnode[&#39;n&#39;].push()
The current process takes time as it searches for every individual node then checks and then update the node. I am looking for the optimized solution. I am beginner in neo4j and familiar with **UNWIND** and **FOREACH** in neo4j but can&#39;t really implement it for now. 

Help will be appreciated",1602745864,https://stackoverflow.com/q/64366534,Mubeen Mubarik,"['neo4j', 'optimization', 'cypher', 'neo4j-apoc']"
64361712,Neo4J Movie-Graph - actors with same age,"I want to analyze in Neo4J with the movie data set provided (: play movie-graph) those actors who were born in the same year, and then perform a query that allows me to obtain which actors of the same age have worked together. To do this, I have tried to create a relationship type &quot;HAS_SAME_AGE&quot; in the database between actors who were born in the same year, but it gave me an error and I don&#39;t know how to continue.

This is what I have written:

`MATCH (a:Person),(b:Person)
WHERE a.born=b.born
WITH a AS PersonA, b AS PersonB
MERGE (PersonA)-
[:HAS_SAME_AGE]-(PersonB)`

Can someone help me fill in the correct code? Any help would be appreciated!
",1602710722,https://stackoverflow.com/q/64361712,Mary1980,"['cypher', 'neo4j']"
64357251,Neo4j Cypher - Changing datetime to epoch timestamp,"I&#39;m looking to convert a `datetime()` (e.g. `&quot;2019-10-19T20:57:52.541000000Z&quot;`) 

to the same format that would be output by `timestamp()` (e.g. `1571518672541`)


I understand to convert it one way you would use something like the following;

`RETURN datetime({epochmillis:1571518672541}) AS theDate`

However I would actually like to do the reverse of this and am really struggling with understanding the Neo4j documentation.


I found this question where the title is labelled for what I believe I want, but the output seems to be wrong so just found that even more confusing;
https://stackoverflow.com/questions/51168792/converting-datetime-to-epoch-milliseconds-using-cypher-in-neo4j


Any advice is appreciated!",1602691288,https://stackoverflow.com/q/64357251,Simon,"['neo4j', 'cypher']"
64351401,Why there is link between parent node and child node in neo4j,"1.I created Tweet and TweetLeaf nodes then create realatioships by using following code

    MERGE (n:Tweet {id:&#39;13084664&#39;, title:&#39;A&#39;})
    
    MERGE (cl1:TweetLeaf {id:&#39;13085170&#39;, title:&#39;AB&#39;, reply_to:&#39;13084664&#39;})
    
    MERGE (cl2:TweetLeaf {id:&#39;13085179&#39;, title:&#39;TESTING Team&#39;, reply_to:&#39;13085170&#39;})
    
    MERGE (cl2:TweetLeaf {id:&#39;13085352&#39;, title:&#39;TESTING Team&#39;, reply_to:&#39;13085170&#39;})
    
    MERGE (cl4:TweetLeaf {id:&#39;13085443&#39;, title:&#39;TESTING Team&#39;, retweet_to:&#39;13085352&#39;})
    
    MERGE (cl5:TweetLeaf {id:&#39;13085356&#39;, title:&#39;TESTING Team&#39;, retweet_to:&#39;13085352&#39;})
    
    //parent and leaf.....
    MATCH (parent:Tweet)
    MATCH (c:TweetLeaf)
    WHERE NOT (c)-[:reply]-&gt;() 
    AND parent.id = c.reply_to
    WITH parent, c
    MERGE (c)-[:reply_to]-&gt;(parent)
    //RETURN c, parent
    
    //leaf to leaf reply_to.....
    MATCH (c1:TweetLeaf)-[]-()
    WHERE exists (c1.reply_to)
    
    MATCH (d1:TweetLeaf)
    WHERE NOT (d1)-[]-&gt;() and exists (d1.reply_to)
    AND c1.id = d1.reply_to
    
    WITH c1, d1
    MERGE (d1)-[:reply_to]-&gt;(c1)
    //RETURN c1, d1
    
    //leaf to leaf retweet_to....
    MATCH (c2:TweetLeaf)
    WHERE exists (c2.retweet_to)
    AND NOT (c2)-[]-&gt;()
    
    MATCH (d2:TweetLeaf)-[]-&gt;()
    WHERE d2.id = c2.retweet_to
    
    WITH c2, d2
    MERGE (c2)-[:retweet_to]-&gt;(d2)
    //RETURN c2, d2
2.The final result should be like the screenshot below
[![enter image description here][1]][1]


However, in my output there is not link between node A and node AB. The screenshot show my output graph
[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/2i9aP.png
  [2]: https://i.stack.imgur.com/RvPLF.png",1602671372,https://stackoverflow.com/q/64351401,Jay Parkkk,"['cypher', 'neo4j']"
64349986,How to know if timeout occurred in cypher query?,"I&#39;m using `apoc.cypher.runTimeboxed` https://neo4j.com/labs/apoc/4.1/cypher-execution/cypher-timeboxed/ 

I&#39;m using the HTTP API of neo4j. I&#39;m making HTTP post requests like below.

[![HTTP request on developer tools of my browser][1]][1]


Here I do **NOT** see any difference if the results are really empty or if the results are empty because **TIMEOUT OCCURRED**. I think there should be a warning or error message.

  [1]: https://i.stack.imgur.com/B1MBp.png",1602666320,https://stackoverflow.com/q/64349986,canbax,"['neo4j', 'neo4j-apoc', 'cypher']"
64349482,Combine two cypher queries into single query and single result,"I created the query to get list of people in country &amp; some avg calculation: 

```
Match (people:People)-[:LOCATED_IN]-&gt;(address:Address), (people)-[:SOME]-&gt;(calc)
RETURN address.country as name, count(*) as count, avg(calc.value) as value
```

Which returns corect values for instance:

```
name, count, value
PL  , 5    , 10
UK  , 3    , 20
US  , 6    , 30
DE  , 3    , 40
```

What I&#39;m trying to achive is also get the countries of people that they know, so expected result should look e.g. like this:

```
name, count, value, knowsAlso
PL  , 5    , 10   , UK,US
UK  , 3    , 20   , DE
US  , 6    , 30   , 
DE  , 3    , 40   , 
```

I created a separate query to get that information by passing the $country:

```
Match (firstPerson:Person)-[:LOCATED_IN]-&gt;(firstAddress:Address),
      (firstPerson:Person)-[:FRIEND_WITH]-&gt;(secondPerson:Person),
      (secondPerson:Person)-[:LOCATED_IN]-&gt;(secondAddress:Address)
WHERE firstAddress.country = $country
AND firstAddress.country &lt;&gt; secondAddress.country
RETURN DISTINCT secondAddress.country
```

but in this scenario I need to invoke it for each record on the result set from first query which doesn&#39;t seem to be effective. Is there a way to invoke my second query directly on the result set of the previous query? Or ideally, make these two queries as a single query?",1602664407,https://stackoverflow.com/q/64349482,degath,"['cypher', 'neo4j']"
64343604,Neo4J Cypher - subtract duration from timestamp,"I am trying to create a dynamic query which will get me results from &quot;today&quot; (when submitted) and so many days backwards.

Lets say for the sake of the example that I want the last 14 days of data, from today.

The field `first_submitted` is recorded by use of `timestamp()`

I have tried the following code;

    match(u:data) WHERE u.first_submitted &gt; timestamp()}-duration(&#39;P14D&#39;) AND u.first_submitted &lt; timestamp() RETURN u.first_submitted LIMIT 10

However I receive the error

    Neo.ClientError.Statement.TypeError: Cannot subtract `Duration` from `Long`


I tried a few different ways of coding this but am turning up very confused with the syntax and Neo4J&#39;s documentation surrounding this.

Alternatively, if you can think of a better way to do this that isn&#39;t resource too heavy please let me know.

Thanks in advance!

P.S. I&#39;m not sure what the &quot;data.apoch&quot; stuff I keep seeing is exactly but when I try to run any of these commands I receive errors so if I can avoid the need of this library please.",1602625551,https://stackoverflow.com/q/64343604,Simon,"['cypher', 'neo4j']"
64342114,How to improve query efficiency in Neo4j?,"I need to export a portion of database with the function apoc.export.cyphe.data().
Here&#39;s the code which I use to call the function:

    MATCH path = (p1:Author)-[r:CO_AUTHORSHIP]-(p2:Author) WITH collect(p1)+collect(p2) as 
    export_nodes,collect(r) as export_rels CALL 
    apoc.export.cypher.data(export_nodes,export_rels,&#39;/tmp/export.cypher&#39;,{format:&#39;cypher- 
    shell&#39;,cypherFormat: &#39;updateAll&#39;}) YIELD file, source, format, nodes, relationships, 
    properties,timeRETURN nodes, relationships, time

The problem is that the query
    MATCH path = (p1:Author)-[r:CO_AUTHORSHIP]-(p2:Author) 
takes more than an hour!

I have a database with 467437 CO_AUTHORSHIP relationships. Each node of the database represent an author. For each relationship edge I store data about articles (number of articles, types, venues, titles and years) written by both the authors.

I there a way to improve the efficiency of that query?",1602618183,https://stackoverflow.com/q/64342114,Francesco Binucci,"['neo4j', 'cypher', 'graph']"
64333436,Neo4J Unicity wonders : singleton or aggregation issue,"I&#39;m new to Neo4J and have a question for you guys.
I import a CSV file and it duplicates my nodes instead of merging them. 

**Example** 

CSV FILE :
```
Id1,Id2,Relation
Alice,Bob,KNOWS
Morgane,Bob,KNOWS
Bob,James,KNOWS
```

I would like to have a result as such
```
Alice---(KNOWS)---&gt;Bob&lt;---(KNOWS)---Morgane
                      ^
                      |
                  (KNOWS)
                      |
                    James

```

Though what happens is :
```
Alice---(KNOWS)---&gt;Bob
Morgane---(KNOWS)---&gt;Bob
Bob---(KNOWS)---&gt;James
```

I would like Bob to be a singleton, but it I get multiple &quot;Bob&quot; with different inner id&#39;s. I would like to merge all the Bobs together.
Anyone have an idea ?

*(Note that the arrow between James &amp; Bob should be the otherway around on the &quot;wanted result&quot;, but it&#39;s ok, it&#39;s not so much the problem here)*

edit : I tried creating a constraint before importing the data, but it doesn&#39;t seem to be working :
```CREATE CONSTRAINT ON (a:Person) ASSERT a.name IS UNIQUE;```

Thanks for your help !",1602584865,https://stackoverflow.com/q/64333436,the owl - Yte,"['singleton', 'neo4j', 'cypher']"
64331991,Cypher query with group by inside aggregation,"I created a cypher query which returns list of people in country &amp; some avg calculation:
	
	Match (people:People)-[:LOCATED_IN]-&gt;(address:Address), (people)-[:SOME]-&gt;(calc)
    RETURN address.country as name, count(*) as count, avg(calc.value) as value

Which returns for instance:

    name, count, value
	PL  , 5    , 10
	UK  , 3    , 20
	US  , 6    , 30
    DE  , 3    , 40
	

What I&#39;m trying to achieve right now is to group a few of them in some custom groups. 
For instance, if the country is PL &amp; UK return it AS Custom:

    name   , count, value
	Custom , 8    , 15
	US     , 6    , 30
    DE     , 3    , 40


I was able to achieve it by creating two separate queries one where I specified:
`WHERE address.country IN [&#39;PL&#39;,&#39;UK&#39;]` and second with negation, and I combined it after that.
Is there any easier solution for that?",1602579634,https://stackoverflow.com/q/64331991,degath,"['neo4j', 'cypher']"
64315304,neo4j: Shortest path that includes specific relationship,"I have the graph model below and am trying to write a Cypher query that finds the shortest path from a `Person` to a `Skill` that includes at least one instance of the relationship `HAS_SKILL` in the path.

In the model

 - a `Person` is connected to another `Person` via the `IS_CONNECTED_TO` relationship
 - a `Person` is connected to a `Skill` via `HAS_SKILL`
 - a `Skill` is connected to another `Skill` via the `IS_RELATED_TO` relationship

[![enter image description here][1]][1]

I have come up with the following query, which works but unwraps all the relationships in the path to check that the `HAS_SKILL` relationship is one of the relationships.

```
match (person:Person {id: &quot;48&quot;}), (skill:Skill {id: &#39;10667&#39;}),
path = shortestPath((p)-[*..30]-(s))
WHERE ANY(r in relationships(path) where type(r) = &#39;HAS_SKILL&#39;)
return path;
```

Is there a more effecient way to do this?

I have played around with relationship pattern matching in `(p)-[*..30]-(s)` but I couldn&#39;t get it work in the same way that `ANY` in the where clause works?

This is using neo4j 4.1.0.

  [1]: https://i.stack.imgur.com/1uGTf.png",1602495558,https://stackoverflow.com/q/64315304,user783836,"['cypher', 'neo4j']"
64312462,how to create tree structure in neo4j with multiple relationships?,"1.For example I create multiple Tweet nodes, these tweet nodes have id,reply_to id and retweet_id.  Assuming I have 6 nodes. The code below shows the nodes I create.
   

    CREATE (n:Tweet:Node {id:&#39;123&#39;, title:&#39;A&#39;});
    CREATE (cl:TweetLeaf:Node {id:&#39;234&#39;, title:&#39;IT Team&#39;, reply_to:&#39;123&#39;});
    CREATE (cl:TweetLeaf:Node {id:&#39;testingTeam&#39;, title:&#39;TESTING Team&#39;, reply_to:&#39;234&#39;});
    CREATE (cl:TweetLeaf:Node {id:&#39;588&#39;, title:&#39;TESTING Team&#39;, reply_to:&#39;testingTeam&#39;});
    CREATE (cl:TweetLeaf:Node {id:&#39;kk&#39;, title:&#39;TESTING Team&#39;, retweet_to:&#39;588&#39;});
    CREATE (cl:TweetLeaf:Node {id:&#39;119&#39;, title:&#39;TESTING Team&#39;, retweet_to:&#39;kk&#39;});

2.Now I would like to create a hierarchy tree and trying to create two relationships. Here is the code I tried, but the relationship retweet can not be created successfully.

    CREATE (n:Tweet:Node {id:&#39;123&#39;, title:&#39;A&#39;});
    CREATE (cl:TweetLeaf:Node {id:&#39;234&#39;, title:&#39;IT Team&#39;, reply_to:&#39;123&#39;});
    CREATE (cl:TweetLeaf:Node {id:&#39;testingTeam&#39;, title:&#39;TESTING Team&#39;, reply_to:&#39;234&#39;});
    CREATE (cl:TweetLeaf:Node {id:&#39;588&#39;, title:&#39;TESTING Team&#39;, reply_to:&#39;testingTeam&#39;});
    CREATE (cl:TweetLeaf:Node {id:&#39;kk&#39;, title:&#39;TESTING Team&#39;, retweet_to:&#39;588&#39;});
    CREATE (cl:TweetLeaf:Node {id:&#39;119&#39;, title:&#39;TESTING Team&#39;, retweet_to:&#39;kk&#39;});
    
    
    MATCH (c:TweetLeaf)
    WHERE NOT (c)-[:reply_to]-&gt;() or not (c)-[:retweet]-&gt;()
    MATCH (parent:Node {id:c.reply_to}),(retweet:Node {id:c.retweet_id})
    CREATE (c)-[:reply_to]-&gt;(parent),(c)-[:retweet]-&gt;(retweet)

",1602482676,https://stackoverflow.com/q/64312462,Jay Parkkk,"['cypher', 'neo4j']"
64307524,Cypher - finding most common user + storing it,"I&#39;m using Cypher in the StackOverflow database. I&#39;m trying to find the user with the most upvotes, and then search the database for the number of posts that user made. I understand how to get the user with the most upvotes

MATCH (u:User)
ORDER BY u.upvotes DESC
RETURN 1;

But I don&#39;t know how to get that value and use it to find the number of posts that user made (connected to Post nodes).

Thank you!",1602440381,https://stackoverflow.com/q/64307524,stillstriving21,"['neo4j', 'cypher']"
64288432,Return a node if no relationship exists else return the other node,"I&#39;m using gds and getting nodeIds back from a function. I want to return the node if it doesn&#39;t belong to a specific relationship but if it does then return the other node in the relationship. e.g

if I have a list of nodes with ids 5, 8, 1, 3, 5 and these are dogs. Currently i can get all the dogs by  the statement:

`RETURN gds.util.asNode(nodeId) AS node`

And I would get the all the dogs like this 
```
Rex
Max
Dorothy
Spike
Wall-E 
```

I want to return the name of the owner if the dog has one so lets say Dorothy and Wall-E have an owner called Macy and Tyrone respectively. The list I would want to return is:

```
Rex
Max
Macy
Spike
Tyrone 
```

How can I accomplish this. I would use subqueries in a CASE statement but I&#39;m not sure how much I&#39;m actually allowed to do so since CASE seems a bit limited.",1602285520,https://stackoverflow.com/q/64288432,Deeswoc,"['neo4j', 'cypher']"
64281303,Neo4j/GraphQL - get the last node in a linked list in order to continue the linked list with newly created nodes,"I have a linked list of Posts in a Group. A Group has a FIRST_POST and then subsequent NEXT_POST relationships. The GraphQL typedef looks like this:
```
type Group {
    id: ID!
    name: String!
    membersList: [User] @relation(direction: IN, name: &quot;MEMBER_OF&quot;)
    engagesIn: Conversation @relation(direction: OUT, name: &quot;ENGAGES_IN&quot;)
    posts: [Post] @cypher(statement: &quot;&quot;&quot;
        MATCH (g:Group {id: this.id})-[:FIRST_POST|NEXT_POST*]-&gt;(post:Post) 
        RETURN post
    &quot;&quot;&quot;)
    createdAt: DateTime
    updatedAt: DateTime
}
```
The cypher query `MATCH (g:Group {id: this.id})-[:FIRST_POST|NEXT_POST*]-&gt;(post:Post) RETURN post` returns all of a specific Group&#39;s posts. I want to create a new Post and add it to the Group in my schema&#39;s typedef. Here&#39;s one stab at it that I know is not correct, but is where my current efforts are:
```
CreatePost(body: String!, userId: ID!): Post
    @cypher(
      statement: &quot;&quot;&quot;
        MATCH (u:User {id: $userId})-[:MEMBER_OF]-&gt;(g:Group)-[:FIRST_POST|NEXT_POST*]-&gt;(lp:Post) return Last(collect(p))
        CREATE (p:Post { id: apoc.create.uuid(), body: $body, createdAt: datetime(), updatedAt: datetime() }) 
        WITH p, lp
        MATCH (u:User)
        WHERE u.id = $userId 
        CREATE (p)&lt;-[:WROTE]-(u)
        CREATE (p)-[:NEXT_POST]-&gt;(lp)
        RETURN u, p
    &quot;&quot;&quot;)
```
This is a custom mutation that accept post body and userId arguments. This line `MATCH (u:User {id: $userId})-[:MEMBER_OF]-&gt;(g:Group)-[:FIRST_POST|NEXT_POST*]-&gt;(lp:Post) return Last(collect(p))` would return the last post, though I know I cannot return here and haven&#39;t successfully found a way to alias that MATCH. Ultimately I need to CREATE the NEXT_POST relationship off of the last NEXT_POST in that group with `CREATE (p)-[:NEXT_POST]-&gt;(&lt;LAST POST IN GROUP&gt;)`. The first line also uses the userId to find the group as Users are MEMBER_OF only one Group and Posts belong to only one Group. ",1602250929,https://stackoverflow.com/q/64281303,Matt Larson,"['graphql', 'cypher', 'neo4j', 'neo4j-graphql-js', 'graph-databases']"
64281164,"Neo4j cypher query, need to return multiple levels node information with relationships","I have a huge graph, millions of nodes. And i need to match a pattern
 ex. (node0)-[rel1]-&gt;(node2)-[rel3]-&gt;(node4) can be more can be less, and sometimes there can be id&#39;s or names specified (node0)-[rel1]-&gt;(node2{name:&#39;smth&#39;)-[rel3]-&gt;(node4) with a limit of 100 node0

I need to get get all the nodes and the relationships, in one query if possible if not then multiple.
to form some mini graph on front end.


PS.Is it possible to specify (node0)-[rel1]-&gt;(node2) to find atleast one pattern for each node0, for node0.name = &#39;name1&#39;, node0.name = &#39;name2&#39;, node0.name = &#39;name3&#39;

 ",1602250433,https://stackoverflow.com/q/64281164,Terminator,"['cypher', 'neo4j']"
64271197,"problem with Neo4j query, calling foreach for the previous match results","I have this class (node):

    case class User(name: String, lastName: String, age: Int, city: String)

I&#39;m trying to add relationships for an existing node (name=Alice) with this query:

    MATCH (user:User {name: $name}),(friend:User) WHERE friend.name IN [$fNames] WITH user,friend CREATE (user)-[f:FRIEND]-&gt;(friend) RETURN f

I&#39;m passing in fNames = List(Bob, David), and all nodes exist in db (for Alice, Bob and David).
This query returns no results, and that one neither:

    MATCH (user:User {name: $name})-[f:FRIEND]-&gt;(friend:User) RETURN friend

I tried using FOREACH in the first query but was getting errors (something about Nodes vs Paths).
My goal is to add FRIEND relationships (edges) between Alice and all User nodes (vertices) with &quot;name&quot; field in fNames list.
How can I do that using a single cipher query?
Thanks,

Joe
",1602194237,https://stackoverflow.com/q/64271197,Joe,"['cypher', 'scala', 'neo4j']"
64267815,Neo4j match a random single node of a certain type of nodes,"I have a node for groups and that users are members of. I would like to auto-assign a User to a Group at random when they register. Is there a way to randomly MATCH a single node of a certain type. 
```
MATCH (g:Group) return g
```
The above will give me all groups. To create the relationship I would do the following:
```
MATCH (u:User {id: &lt;ID&gt;}), (g:Group {id: &lt;ID&gt;}) CREATE (u)-[r:MEMBER_OF]-&gt;(g) RETURN type(r)
```
But I would like to do something like this:
```
CREATE(u:User {
  id: apoc.create.uuid(), 
  firstName: $firstName, 
  username: $username, 
  phoneNumber: $phoneNumber, 
  createdAt: datetime(),
  updatedAt: datetime(),
  role: &#39;USER&#39;
  }
)
  WITH u
  MATCH (g:Group)
  //
  CREATE (u)-[:MEMBER_OF]-&gt;(g)
  return u
```
where I would match a random group and then create the MEMBER_OF relationship. Eventually there may be other considerations, but for now I would love to just randomly select a group and then create the relationship.",1602178370,https://stackoverflow.com/q/64267815,Matt Larson,"['neo4j', 'cypher']"
64257892,Neo4j forming json array,"I tried forming a json array in neo4j but it returned that my array cannot read the items from event. My code is as follows:
```
MERGE (n:item{id: event.id, description:[x:event.123,y:event.456,z:event.789]})
```
Thank you in advanced for the help!",1602142814,https://stackoverflow.com/q/64257892,lj4r2020,"['json', 'neo4j', 'cypher']"
64251807,How to create histogram output using neo4j Cypher query?,"With `create_time` and `delete_time` attributes in our graph model entities, is there an efficient way to create queries that will return the counts, similar to a histogram, indicating in which time bins the entities &quot;existed&quot;?  The time bins will also be a variable.  For example, per year for the last 10 years, or per month for the past 36 months, or per day for the past 30 days.  The times are stored in integer format (but this can be changed if needed). ",1602102298,https://stackoverflow.com/q/64251807,Paul Hudgins,"['neo4j', 'cypher']"
64217974,How do I choose to create a node based on whether it exists in the database in neo4j?,"I tried the following but it threw this error. I wish to only create a new person node if there isnt a person node in the existing database that has the exact same properties.

org.neo4j.driver.exceptions.ClientException: Invalid input &#39;R&#39;: expected

```
MERGE (n:Person{id: abc.id}) 
MERGE (m:Place{place:def.id}) 
MERGE (o:Thing{id:abcd.id})
WITH n,m,o
OPTIONAL MATCH (n) – [:present_at] -&gt; x with n,m,o, collect (distinct x) as known_place
OPTIONAL MATCH (m) – [:is] -&gt; y with n,m,o, collect (distinct y) as known_thing
FOREACH (a in ( CASE WHEN NOT m IN known_place THEN [1] ELSE [] END ) CREATE (n)-[:present_at] -&gt;(m))
FOREACH (a in ( CASE WHEN NOT o IN known_thing THEN [1] ELSE [] END ) CREATE (m)-[:is] -&gt;(o))
```",1601945896,https://stackoverflow.com/q/64217974,lj4r2020,"['cypher', 'neo4j', 'graph-databases']"
64213952,Neo4J Cypher query equivalent to select for update,"I have two instances of my application running.

Each one has a cypher query running on a scheduled job to grab the data for the DB and send it off to a service. Problem is that each instance grabs the data and sends it off, so duplicate data is received by the service.

What I have done so far is to have a property as a flag set to true when the data is matched/queried from the DB.

so my query is along the lines of:

Match (n)
where sentData=false
SET sentData=true
return n.

I was hoping that the data would be locked by one instance with the SET in the MATCH query and the other instance would not be able to grab it or modify it, but it does and so still duplicate data is sent to the service. 

In oracle, for example, I would do a &quot;select for update&quot; then one instance would grab the lock during the select and when doing an update one instance would do it and the other one would throw an exception.

I am only new to graph DB&#39;s so I apologies if the terminology is not fully correct.
Thanks
",1601921218,https://stackoverflow.com/q/64213952,goldengreen,"['neo4j', 'cypher', 'graph-databases']"
64207031,Neo4j: Count the number of neighbours with a specific label for each node,"As a sort of validation test, I want to count the number neighbouring nodes with a given labelB for every node with labelA and then return any labelA for each the number of neighbours is not equal to 2.

Basically, `parent:parent_name` should always have 2 connected nodes with have label `child_name`. How do I return the nodes for which this statement is False?

At the moment I am doing a very time consuming &quot;match everything in neo4j&quot; and then groupby and count in python Pandas.

Cypher:

    MATCH (parent: parent_name) 
    MATCH (parent)--&gt;(child: child_name)
    RETURN parent.id, child.id, &#39;child_name&#39; as child_label, &#39;parent_name&#39; as parent_label

Pandas post-processing:

    grouped = df.groupby([&#39;child_label&#39;, &#39;child.id&#39;]).apply(len)
    result = grouped[grouped != 2].index  # returns pairs of child_label and child.id

I can&#39;t do this at scale. Finding neighbours is one of the main use-cases of graphs! There must be a way to do this!

Maybe using `UNDWIND` for each `parent_name`? If I use `count` under an `UNWIND` it simply counts the total, not the number for that node...",1601894447,https://stackoverflow.com/q/64207031,Lucidnonsense,"['neo4j', 'cypher']"
64204213,how to extract the properties from a neo4j cypher collection from the query result,"I have a Neo4j Cypher query where I return the result as a COLLECTION like this:

    RETURN COLLECT(r) AS Shipper
now I try to use

    shippers  = result.records[0].get(&#39;Shipper&#39;).properties;
but I get undefined value for shippers. I cannot seem to locate in the docs how to retrieve the properties from a COLLECTION. The raw collection data looks like this:

    [{&quot;identity&quot;:{&quot;low&quot;:1112,&quot;high&quot;:0},&quot;start&quot;:{&quot;low&quot;:320,&quot;high&quot;:0},&quot;end&quot;:{&quot;low&quot;:447,&quot;high&quot;:0},&quot;type&quot;:&quot;SHIPPED_WITH&quot;,&quot;properties&quot;:{&quot;name&quot;:&quot;DHL&quot;,&quot;account&quot;:&quot;483097049790yrh&quot;}},{&quot;identity&quot;:{&quot;low&quot;:1111,&quot;high&quot;:0},&quot;start&quot;:{&quot;low&quot;:320,&quot;high&quot;:0},&quot;end&quot;:{&quot;low&quot;:442,&quot;high&quot;:0},&quot;type&quot;:&quot;SHIPPED_WITH&quot;,&quot;properties&quot;:{&quot;name&quot;:&quot;UPS&quot;,&quot;account&quot;:&quot;12345T6741&quot;}}]

I know I can avoid using the collection and retrieve the data in loop of some sort but I figure there is a better way. I am expecting to get an array of objects. Any help would be appreciated.",1601883189,https://stackoverflow.com/q/64204213,MichaelE,"['node.js', 'neo4j', 'cypher']"
64192909,Neo4j ver. 4.1.1 Cypher Syntax Error &quot;USING PERIODIC COMMIT&quot;,"From  [neo4d lessons learned example from NASA][1]

References a github project showing how NASA used Neo4J to create a lessons learned database. It is from 2015 and I&#39;ve been struggling to get the Cypher code running on newer versions of Neo4j (I&#39;m learning as I go).

The error message I am getting is
[![enter image description here][2]][2]
My modified version is below.


    MATCH (n)
    OPTIONAL MATCH (n)-[r]-()
    DELETE n,r;

    USING PERIODIC COMMIT 500
    LOAD CSV WITH HEADERS FROM &#39;file:///Users/kevin/Neo4j/doctopics-master/data/llis.csv&#39; 
    AS line
    WITH line
    Limit 1
    RETURN line

    USING PERIODIC COMMIT
    LOAD CSV WITH HEADERS
    FROM &#39;file:///Users/kevin/Neo4j/doctopics-master/data/llis.csv&#39; AS line
    WITH line, SPLIT(line.LessonDate, &#39;-&#39;) AS date
    CREATE (lesson:Lesson { name: ToInteger(line.`LessonId`) } )
    SET lesson.year = ToInteger(date[0]),
       lesson.month = ToInteger(date[1]),
       lesson.day = ToInteger(date[2]),
       lesson.title = (line.Title),
       lesson.abstract = (line.Abstract),
       lesson.lesson = (line.Lesson),
       lesson.org = (line.MissionDirectorate),
       lesson.safety = (line.SafetyIssue),
       lesson.url = (line.url)
    MERGE (submitter:Submitter { name: toUpper(line.Submitter1) })
    MERGE (center:Center { name: toUpper(line.Organization) })
    MERGE (topic:Topic { name: ToInteger(line.Topic) })
    MERGE (category:Category { name: toUpper(line.Category) })
    CREATE (topic)-[:Contains]-&gt;(lesson)
    CREATE (submitter)-[:Wrote]-&gt;(lesson)
    CREATE (lesson)-[:OccurredAt]-&gt;(center)
    CREATE (lesson)-[:InCategory]-&gt;(category);
    USING PERIODIC COMMIT
    LOAD CSV WITH HEADERS
    FROM &#39;file:///Users/kevin/Neo4j/doctopics-master/data/topicCategory.csv&#39; AS line
    MATCH (topic:Topic { name: ToInteger(line.Topic) })
    MATCH (category:Category { name: toUpper(line.Category) })
    CREATE (topic)-[:AssociatedTo]-&gt;(category)
    ;


    // Topic, Correlation.
    // Adds a relation to each topic using their correlation
    // as a property of the relationship

    // Load.
    USING PERIODIC COMMIT
    LOAD CSV WITH HEADERS
    FROM &#39;file:///Users/kevin/Neo4j/doctopics-master/data/topicCorr.csv&#39; AS line

    MATCH (topic:Topic), (topic2:Topic)
    WHERE topic.name = ToInteger(line.Topic) AND topic2.name = ToInteger(line.ToTopic)

    MERGE (topic)-[c:CorrelatedTo {corr : ToFloat(line.Correlation)}]-(topic2)
    ;


    USING PERIODIC COMMIT
    LOAD CSV WITH HEADERS
    FROM &#39;file:///Users/kevin/Neo4j/doctopics-master/data/topicTerms.csv&#39; AS line
    MATCH (topic:Topic { name: ToInteger(line.Topic) })
    MERGE (term:Term { name: toUpper(line.Terms) })
    CREATE (term)-[r:RankIn {rank : ToInteger(line.Rank)}]-&gt;(topic)
    ;

    USING PERIODIC COMMIT
    LOAD CSV WITH HEADERS
    FROM &#39;file:///Users/kevin/Neo4j/doctopics-master/data/topicLabels.csv&#39; AS line
    MATCH (topic:Topic { name: ToInteger(line.Topic) })
    SET topic.label = line.Label
   ;

The original Cypher code and data is in [David Meza&#39;s Repo][3]

I&#39;d just like to get something ready to demo to our company tomorrow morning to &#39;sell&#39; the &#39;lessons learned&#39; and usage of a graph database. Any help will be appreciated. 


Thanks


  [1]: https://neo4j.com/blog/nasa-critical-data-knowledge-graph/?ref=blog
  [2]: https://i.stack.imgur.com/Ftm2e.png
  [3]: https://github.com/davidmeza1/doctopics%20https://codeload.github.com/davidmeza1/doctopics/zip/master",1601803013,https://stackoverflow.com/q/64192909,KevinY,"['cql', 'neo4j', 'cypher']"
64190972,How to merge multiple filed which contain null value,"1.I&#39;m trying to import JSON file and create a graph but value.replyto_user_id replyto_id contain null value,

   

    CALL apoc.load.json(&quot;file:///tweets.json&quot;)
    YIELD value
    MERGE (t:Tweets
    {
    id: value.id,
    created_at: value.created_at,
    text: value.text,
    user_id: value.user_id,
    retweet_id: value.retweet_id,
    retweet_user_id: value.retweet_user_id,
    user_mentions: value.user_mentions,
    replyto_id: value.replyto_id,
    replyto_user_id: value.replyto_user_id
    }
    )
  

2.Erro message: Cannot merge node using null property value. Then I tired 

    CALL apoc.load.json(&quot;file:///tweets.json&quot;)
    YIELD value 
    with value where value.replyto_user_id and replyto_id  is not null
    {
    id: value.id,
    created_at: value.created_at,
    text: value.text,
    user_id: value.user_id,
    retweet_id: value.retweet_id,
    retweet_user_id: value.retweet_user_id,
    user_mentions: value.user_mentions,
    replyto_id: value.replyto_id,
    replyto_user_id: value.replyto_user_id
    }
    )

",1601783055,https://stackoverflow.com/q/64190972,Jay Parkkk,"['cypher', 'neo4j']"
64182792,delete and update properties of neo4j nodes,"this post is actually for ensuring about correctness of a cypher query. Assume you want to remove misspelled properties from all nodes and set value of those into new property, e.g like this:

    match (u:User) set u.username = u.userrname remove u.userrname
As I noticed, it will check all nodes in label `User` whether it has property `userrname`, if exists it would set new property `username` with existing value and then remove the `userrname`. else, nothing would happen.

Am I right?",1601718009,https://stackoverflow.com/q/64182792,Zahra Ashouri,"['cypher', 'neo4j']"
64167019,&quot;Query Optimization&quot; : Neo4j Query builds a cartesian product between disconnected patterns -,"I’m supposed to have graph of multiple nodes(more than 2) with their relationships at 1st degree, second degree, third degree.
  
 **For that right now I am using this query**
 

    WITH [&quot;1258311979208519680&quot;,&quot;3294971891&quot;,&quot;1176078684270333952&quot;,”117607868427845”] as ids 
    MATCH (n1:Target),(n2:Target) WHERE n1.id in ids and n2.id in ids and n1.id&lt;&gt;n2.id and n1.uid=103 and n2.uid=103 
    MATCH p = ((n1)-[*..3]-(n2)) RETURN p limit 30


In which 4 nodes Id’s are mention in **WITH[ ]** and next **[*..3]** it is used to draw **3rd degree graph** between the selected nodes.

**WHAT the ABOVE QUERY DOING**

After running the above query it will return the mutual nodes in case of second degree [*..2] if any of the 2 selected nodes have mutual relation it’ll return.

**WHAT I WANT**

*1)     First of all I want to optimize the query, as it is taking so much time and this query causing the Cartesian product which slow down the query process.

*2)     As in this above query if any 2 nodes have mutual relationship it will return the data, I WANT, the query will return **mutual nodes** attached with all selected nodes. Means if we have some nodes in return, these nodes must have relation to all selected target nodes.*

Any suggestions to modify the query, to optimize the query.",1601620136,https://stackoverflow.com/q/64167019,Mubeen Mubarik,"['cypher', 'neo4j-apoc', 'neo4j']"
64161587,RegEx that matches &quot;variable&quot; strings/sequences? + backtracking?,"I want to use regex like language to match against variable-string (in my case sequence of character|words|numbers stored in a graph DB).

I found a way to implement RegEx engine :
https://deniskyashif.com/2019/02/17/implementing-a-regular-expression-engine/

the problem is that it matches against static string. My case is sort of what I call variable-string/sequence.

F.e. let say I have stored the following sequences :

&gt; who; why; when; where;

Keep in mind I dont have the sequences available (so that I can loop over them), they are deconstructed to a graph. (you can think of interface to the sequence like a function which given prefix predicts/returns the next character)

if I match against regex :  w* it should match/return all of the strings one after another /like in backtracking/

if i use : whe* =&gt; when, where 

etc..

Is there a way to modify NFA, DFA in such a way that it will accommodate variable-string ?

I just started exploring implementing NFA and think the change has to be here : 

      function search(nfa, word) { .... } 

it has to be search that passes the next expected regex-symbol/state i.e. given the previous string-symbol does the next-predicted-string-symbol match the expected regex-symbol ?
 
The regex should &#39;drive&#39; the match, rather than the string ! It should be doable because the regex is deconstructed to finite states with the transitions..

what do you think ?

-----

they are stored as a tree in graph db...f.e.can be represented as :

     lvl5: (where:.)
     lvl4: (wher:e), (when:.), (whom:.),  
     lvl3: (whe:r), (whe:n), (who:m), (who:.), (why:.)
     lvl2: (wh:y) , (wh:o), (wh:e)
     lvl1: (w:h)
     lvl0: w h y o .
",1601578322,https://stackoverflow.com/q/64161587,sten,"['nfa', 'cypher', 'graph-databases', 'regex', 'dfa']"
64154046,Improve performance of neo4j query with multiple OPTIONAL MATCH,"I am new to Neo4j and have a query that I want to improve. Any help or recommendations would be appreciated.

```
MATCH (s:Source),
(s)-[:SourceContext]-&gt;(c:Context),
(c)-[:ContextFunction]-&gt;(f:Function)
OPTIONAL MATCH (c)&lt;-[*1..2]-(e:Entity)
OPTIONAL MATCH (c)&lt;-[*1..2]-(au:Author)
OPTIONAL MATCH (c)&lt;-[*1..2]-(p:Period)
OPTIONAL MATCH (c)&lt;-[*1..2]-(u:Unit)
OPTIONAL MATCH (c)&lt;-[*1..2]-(a:AttributeSet)
OPTIONAL MATCH (c)&lt;-[*1..2]-(t:Timeseries)
WITH e,t,p,u,s,a,f,au
WHERE
(t.id in [3450] or t.id is null) AND
(e.id in [16260] or e.id is null)
AND s.id = 16
AND (a.id = 0 or a.id is NULL)
return {SourceID: s.id, EntityID: e.id, TimeSeriesID: t.id, PeriodID: p.id, UnitID: u.id, FunctionID: f.id, AttributeSetID: a.id}
```

See neo4j profile plan
[here][1]


  [1]: https://i.stack.imgur.com/dErgQ.png",1601550180,https://stackoverflow.com/q/64154046,Febre,"['neo4j', 'cypher']"
64147554,"Neo4j CQL: For each node, return oldest related node X","I have something like `(p:Post)-[:USED]-&gt;[e:Email] RETURN e.address, p.createdAt` that would return:

![sample results screenshot][1]

I&#39;m trying to get only the oldest `p.createdAt` for each unique email address.
For the above example, it&#39;d be:

![desired results screenshot][2]

Additionally, I&#39;d like to know just how old that post is in number of months.

![desired results with months][3]

I currently have this query but it&#39;s just returning all the posts and all the post ages:

    MATCH (p:Post)-[:USED_EMAIL]-&gt;(e:Email)
    WITH p, e.address AS email
      ORDER BY p.createdAt ASC
    WITH email, COLLECT(p.createdAt) AS collection
    WITH email, collection[0] AS oldestPost, duration.inMonths(datetime(collection[0]), datetime()) AS durationMonths
    WITH email, oldestPost, durationMonths.months AS numMonthsAgo
    RETURN email, oldestPost, numMonthsAgo

Please help. I&#39;m getting completely turned around trying to figure this out!

Thanks!

  [1]: https://i.stack.imgur.com/yNemP.png
  [2]: https://i.stack.imgur.com/ODwWH.png
  [3]: https://i.stack.imgur.com/mhdUe.png",1601512216,https://stackoverflow.com/q/64147554,perfectlywrong,"['foreach', 'cypher']"
64137436,How to fetch indirect relations through another node recursively in Neo4j?,"I have requirement where I need to traverse recursively through a graph to map out connections through an intermediate Connection node.

For example consider the Movie graph. If two people have worked on a movie, they can be considered to know each other. 
With this indirect relations, I would like to map out all the connections in different tiers of a person.

    MATCH (p1:Person {name:&#39;Tom Hanks&#39;})--&gt;(m:Movie)&lt;--(p2:Person) RETURN p1, p2, apoc.create.vRelationship(p1, &#39;KNOWS&#39;, {movie:m.title}, p2)

With this I can get the tier one connections, but I need to do this recursievely.

If the relationship &#39;KNOWS&#39; was a real relations, I could run

    MATCH (p1:Person {name:&#39;Tom Hanks&#39;})-[rel:KNOWS*]-&gt;(p2:Person) RETURN p1, p2, rel

But from what I read and tried, I cannot do this for virtual relationships.
Is there something I can do to achieve this?
",1601468393,https://stackoverflow.com/q/64137436,Sankaran Namboodiri,"['neo4j', 'cypher', 'graph-databases']"
64132606,neo4j - cypher query to find nodes which properties match object parameter,"I&#39;m looking for a query which can find all of the nodes which have properties that match a parameter which is an object. The properties of the node can be a superset (contain more properties than the filter)

e.g.

    :param obj : { first : &quot;first&quot; }

    CREATE (n:Test { first : &quot;first&quot;, second : &quot;second&quot; });
    CREATE (m:Test { first : &quot;first&quot; });
    CREATE (f:Fail { first : &quot;bad&quot;, second : &quot;second&quot; });
    MATCH (c)
    	WHERE
    		PROPERTIES(c) = $obj
    RETURN c;

`n` and `m` should be returned as they are matching on `first : &quot;first&quot;`",1601449973,https://stackoverflow.com/q/64132606,A. L,"['cypher', 'neo4j']"
64125612,Getting counts of a specific list of labels from a Neo4j result set,"I have a graph database that for business logic reasons has semi-redundant labels for a feature count. For example, if a `foo` node has three instances of a feature, it would have the labels `featureCount0`, `featureCount1`, `featureCount2`, and `featureCount3`, among other unrelated labels that relate to different static inherent attributes of `foo` (which also has numerical property values assigned).

As part of my overall process, I&#39;m trying to get the [mode](https://en.wikipedia.org/wiki/Mode_(statistics)) of a feature count among the `foo` children of a given parent node `bar`. My draft query looks like

```cypher
MATCH (u:bar)
WHERE ID(u) = 927646 // Target bar ID for testing
WITH u
MATCH (u)-[:PARENT_OF]-(l:foo)
RETURN 
    COUNT(l:featureCount0) AS feature0,
    COUNT(l:featureCount1) AS feature1,
    COUNT(l:featureCount2) AS feature2,
    COUNT(l:featureCount3) AS feature3,
    COUNT(l:featureCount4) AS feature4,
    COUNT(l:featureCount5) AS feature5
```

Mysteriously, all the feature counts come out to be the same number, and that number is greater than the total count of `l:foo` in the result set. I am very clearly not counting what I think I&#39;m counting.

If it&#39;s really not tractable I can hop out to Python and do it there, but I&#39;d like to minimize language hopping in my overall process. Since `foo` has multiple other unrelated labels, I&#39;m not interested in any method that simply spits out a list of all labels on `foo` -- I&#39;m interested only in this specific subset of labels and, in fact, actively do not want information about the others at  this stage.",1601404403,https://stackoverflow.com/q/64125612,Philip Kahn,"['cypher', 'neo4j']"
64105991,count the number of nodes after shortest path neo4j,"```
MATCH (FooB:Actor { name: &#39;Foob&#39; }),(AnnaH:Actor { name: &#39;Anna Hathaway&#39; }), p = shortestPath((Foob)-[act:ACTED_IN*]-(AnnaH))
RETURN p
```
So this returns a graph `p` that is the shortest path from actors Foob to Anna Hathaway. How do I now count all nodes in `p` with a label of &quot;chocolate&quot;? ",1601310153,https://stackoverflow.com/q/64105991,mevster,"['neo4j', 'cypher']"
64090817,Neo4j (cypher): How do I find all nodes with a specific relationship?,"In a neo4j database with nodes, linked by the `&#39;ARTICLE_OF&#39;` relationship, **how do I find all nodes with this relationship?** Direction doesn&#39;t matter.

I tried a possible solution from [here](https://www.remwebdevelopment.com/blog/sql/some-basic-and-useful-cypher-queries-for-neo4j-201.html), **but it seems outdated.** I swapped `SOME_RELATIONSHIP` with my `ARTICLE_OF`, but it didn&#39;t work.
```cypher
start n=node(*)
match n-[:ARTICLE_OF]-()
return distinct n
```
When I run it I get the following **error**:
```
START is deprecated, use: `MATCH (n)` instead.
        (line 1, column 1 (offset: 0))
&quot;start n=node(*)&quot;
 ^
```
I tried swapping `start` with `match`, but that only resulted in more errors. Let me know if you want to see those as well, but I think someone with experience might immediately see what I&#39;m doing wrong.

",1601224442,https://stackoverflow.com/q/64090817,Queuebee,"['neo4j-browser', 'cypher', 'neo4j']"
64068003,Is it necessary to create a constraint on a &quot;secondary label&quot; on Neo4j?,"I am parsing some CSV files to import that data on my Neo4j Enterprise single-instance database, and I set the NODE KEY type constraints on every node label so it is sped up as suggested by the docs, but I found nothing mentioning constraints on &quot;secondary labels&quot;, that is, a label `MainObj`/`SecondaryObj` I am setting to a node after doing a merge on the primary key `code` with the &quot;primary label&quot; `Obj`.

I have noticed some slowness with this label on big CSVs (first-stage development with smaller CSVs didn&#39;t hint any type of performance issues) but I am unsure if I should blame this, and wonder if with a constraint on those 2 labels it would be resolved, and if so, what keys should I use on those constraints since I am not using them to do queries on import-time (only later when they&#39;re available on read queries from GraphQL)

This is the constraint I got:

```
label: Obj
key: &quot;code&quot;
keys: [&quot;code&quot;]
unique: true
```

This is the Cypher with the Merges:

```
// main obj
MERGE (mainObj:Obj {code: row.objs.main.code})
SET mainObj.make = row.objs.main.make,
    mainObj.isMain = true,
    mainObj:MainObj

// secondary obj
MERGE (secondaryObj:Obj {code: row.objs.secondary.code})
SET secondaryObj.make = row.objs.secondary.make,
    secondaryObj.isSecondary = true,
    secondaryObj:SecondaryObj
```",1601051378,https://stackoverflow.com/q/64068003,Guillermo,"['neo4j', 'cypher']"
64046753,How do I translate this Cypher query to OrientDB SQL,"Having the following cypher query:

     MERGE (r:Root)
     MERGE (r)&lt;-[:N]-(n1:T {id: &#39;a&#39;})
     SET n1.description = &#39;d1&#39;
     WITH r,n1
     MERGE (n1)&lt;-[:N]-(n2:T {id: &#39;b&#39;})
     SET n2.description = &#39;d2&#39;
     WITH r,n2
     MERGE (n2)&lt;-[:N]-(n3:T {id: &#39;c&#39;})
     SET n3.description = &#39;d3&#39;

how do I express the equivalent in OrientDB SQL?",1600951568,https://stackoverflow.com/q/64046753,Lambder,"['neo4j', 'orientdb', 'cypher', 'orientdb3.0']"
64046729,Return data if relationship doesn&#39;t exists between the two nodes Neo4j,"There are two Nodes with label
 1. Order
 2. Status (By default 5 Status Nodes are created)
    - ```{code: START}```
    - ```{code: PLACED}```
    - ```{code: DISPATCHED}```
    - ```{code: DELIVERED}```
    - ```{code: COMPLETED}```
    

There exists a relationship between two nodes &quot;**HAS_STATUS**&quot;. When the order proceeds I&#39;ve made a relation of **order** with the respective **status**.

            (start)      (placed)
               Status  Status
                   \   /
                    \ / 
         Status----Order1------Status
    (dispatched)     |           (delivered)
                     |
                   Status 
                 (completed)



            (start)      (placed)
               Status  Status
                   \   /
                    \ / 
         Status----Order2------Status
    (dispatched)               (delivered)
                     

I want to execute 2 queries:

1. Get all orders which are completed
2. Get all order which are not completed

For the first one **it returns Order1 as expected**:
&gt; Match (order:Order)-[:HAS_STATUS]-(status:Status) where
&gt; status.code=&quot;COMPLETED&quot; return order{.*}

For the second **it returns Order1 and Order2 (It should return only Order2)**
&gt; Match (order:Order)-[:HAS_STATUS]-(status:Status) where not status.code=&quot;COMPLETED&quot; return order{.*}

***Please help me on the second one. I hope my explaination made you clear about the scenario.***

Thanks!",1600951469,https://stackoverflow.com/q/64046729,Abhishek Pankar,"['neo4j', 'cypher', 'relationship']"
64038029,Neo4J apoc.create.vRelationship unique relationsip,"A few months back I asked https://stackoverflow.com/questions/60845782/neo4j-return-a-relationship-that-isnt-defined and the answer was perfect.

    MATCH (p:part)&lt;-[:SUPPLIES]-(:supplier)-[:LOCATED_IN]-&gt;(c:country)
    RETURN p, c, apoc.create.vRelationship(p, &#39;IS_IN&#39;, {}, c) as rel

The problem I am having with the above solution is I now have two nodes with lots of the exact same relationship type between them. Is there a way to return a distinct relationship based on it&#39;s type?

",1600907929,https://stackoverflow.com/q/64038029,Adam Williamson,"['neo4j', 'cypher', 'neo4j-apoc']"
64020419,Cypher Connect nodes in a path returned by gds.alpha.kShortestPaths.stream,"I run `gds.alpha.kShortestPaths.stream` using Neo4j 4.0.2. The algorithm yields a path. 
The path has the nodes connected with `NEXT` relationship. I need to find the actual relationships in the Graph that connect the nodes in the path. I came up with a kludgy query that is based on my knowing how long the path is:
```
...
YIELD path
with nodes(path) as nodes with nodes[0] as n0, nodes[1] as n1, nodes[2] as n2, nodes[3] as n3
match (n0)-[r1]-(n1)
match (n1)-[r2]-(n2)
match (n2)-[r3]-(n3)
return n0, n1, n2, n3, r1, r2, r3
```
Obviously this solution is inadequate and the only reason I posted it here is to illustrate what I need to do for a path of any length.

Thank you ",1600829947,https://stackoverflow.com/q/64020419,David Makovoz,"['cypher', 'path', 'neo4j']"
64016543,How to create constraint on multiple properties in Neo4j,"i want to create an unique constraint involving multiple properties but i keep getting the same error executing: 
```CREATE CONSTRAINT UQ_TimeGender ON (tg:TimeGender) ASSERT (tg.date, tg.time, tg.sex) is NODE KEY;```

Neo.DatabaseError.Schema.ConstraintCreationFailed
Unable to create CONSTRAINT ON ( timegender:TimeGender ) ASSERT exists(timegender.date, timegender.time, timegender.sex):Node(7) with label `TimeGender` must have the properties (date, time, sex)

When i check TimeGender node it has the properties date, time and sex.",1600803065,https://stackoverflow.com/q/64016543,Teodora Gorgieva,"['cypher', 'neo4j']"
64015802,How can I create a node and use to this node in query at the same time in Neo4j?,"I have two queries in Neo4j as following,

```
MERGE (temp:Temp)
SET temp = {tid: &#39;blabla&#39;, title_ids: [], pid: &#39;blabla&#39;}
```
Firstly I&#39;m creating a node with query as above. Then, I am running to code following query,

```
CALL apoc.periodic.commit(
    &quot;
    MATCH(temp:Temp)
    WITH temp
    MATCH (t1:Title)-[r:TO]-&gt;(t2:Title)
    WHERE t1.tid = temp.tid
    AND NOT exists((t2)&lt;-[:LIKE|:DISLIKE|:LOVE]-(:User {pid: temp.pid}))
    AND NOT t2.tid IN temp.title_ids
    AND t2.tid &lt;&gt; temp.tid
    WITH COLLECT(r) AS relationships, SUM(r.weight) AS total
    UNWIND relationships AS relation
    WITH COLLECT([relation.weight / total, ENDNODE(relation).tid]) AS rels
    LIMIT 1
    
    MATCH(temp:Temp)
    WITH temp, rels
    CALL apoc.do.when(
        SIZE(rels) &gt; 0 AND SIZE(temp.title_ids) &lt; 10,
        &#39;
        WITH
        REDUCE(
            s={x: rand()}, r IN rels | CASE
            WHEN s.x IS NULL THEN s
            WHEN s.x &lt; r[0] THEN {x: NULL, target: r[1]}
            ELSE {x: s.x - r[0]} END
        ).target AS target
        SET $temp.tid = target, $temp.title_ids = $temp.title_ids + target
        RETURN 1 AS result
        &#39;,
        &#39;RETURN 0 AS result&#39;,
        {temp: temp, rels: rels}
    ) YIELD value
    RETURN value.result
    &quot;
) YIELD batchErrors

MATCH (temp:Temp)
WITH temp.title_ids AS titles
MATCH(title:Title)
WHERE title.tid IN titles
RETURN title
```

There is no problem so far. But when I run these queries together, I get an error like that,

&gt; WITH is required between SET and CALL (line 4, column 1 (offset: 76))
&quot;CALL apoc.periodic.commit(&quot;
 ^

My first question is how can I merge these queries and run together?
And the second question is optional. I&#39;m newbie in Neo4j, so I&#39;m sure there are some easier ways to optimize these queries. How can I edit these queries to better?

Thanks in advance.",1600799790,https://stackoverflow.com/q/64015802,E. Zeytinci,"['cypher', 'neo4j']"
64013350,Neo4j if a node has no outgoing edges delete that node otherwise return its next nodes,"I&#39;m trying to use Neo4j Cypher to implement the following function: given a node, check if it has any outgoing edges with a specific relationship type. If so, return the nodes it can reach out by those edges, otherwise delete this node. And my code is like this
```
MATCH (m:Node{Properties})
WITH (size((m)-[:type]-&gt;(:Node))) AS c,m 
WHERE c=0
DETACH DELETE m
```
However I don&#39;t know how to apply the if/else condition here, and this code only implements part of what I need. I&#39;d really appreciate your help and suggestions!

For example the database is like this:

A-[type]-&gt;B

A-[type]-&gt;C

If the original node is A and it has two edges with that type to B and C, then I want the query to return B and C as result.
If the original node is B, it should be deleted because there&#39;s no such outgoing edge from B.",1600789940,https://stackoverflow.com/q/64013350,BrandNewStory,"['cypher', 'neo4j']"
64008212,Neo4J / Cypher: How to filter for the path with the latest date in the relationship?,"I an new to querying with Cypher.

    (p:Person)-[e:Evaluated {rating:3, characteristic: &quot;quality of kitchen&quot;, date: 14-09-2009})-&gt;(h:House {adress: xyz})

Every house has multiple characteristics.
Every house is rated multiple times (on different dates).

What I want to achieve is to match path (p)-[e]-(h), but I want to filter for only the paths with the most recent evaluation date.

This path is the starting point for further analysis.

This filter should probably work with WITH or WHERE function, but after a lot of struggling with the query I try my luck here :)



",1600771999,https://stackoverflow.com/q/64008212,Rob Brand,"['neo4j', 'cypher']"
64001217,Graph generation in Neo4j for GDS computations,"I am working on a CSV file that has a structure similar to: 

    aId, Amount, bId 
    int, float, int 
Here aId, and bId have constraints on Node A, and B respectively.
On loading the Nodes, and relationships initially, 

    LOAD CSV with headers FROM &#39;file:///abc.csv&#39; as row
    MERGE (a: A {aid: toInteger(row.aID)})
    MERGE (b: B {bid: toInteger(row.bID)})
    CREATE (a)-[:HAS_SENT {amt: toFloat(row.Amount)}]-&gt;(b)

There are 1490 labels and 1299 relationships.

Now I wish to use different Graph Data Science Libraries to perform various computations on the file. To project a graph for this, I estimated the same using `CALL gds.graph.create.estimate([&#39;A&#39;],[&#39;HAS_SENT&#39;])` that returned 851 Nodes, and 1299 relationships.

However, when I tried to create the graph, `CALL gds.graph.create(&#39;mySampleGraph&#39;,[&#39;A&#39;],[&#39;HAS_SENT&#39;])`, it returned the same number of nodes, but with 0 relationship. 

What did I miss out, and how is it possible for me to get mappings correct? ",1600731496,https://stackoverflow.com/q/64001217,user8996213,"['graph-databases', 'neo4j', 'graph-data-science', 'cypher']"
63993612,Iterate through Neo4j graph matching on node properties,"I have for example the following graph in Neo4j

```
(startnode)-[:BELONG_TO]-(Interface)-[:IS_CONNECTED]-(Interface)-[:BELONG_TO]-

#the line below can repeat itself 0..n times
(node)-[:BELONG_TO]-(Interface)-[:IS_CONNECTED]-(Interface)-[:BELONG_TO]-
#up to the endnode
(endnode)
```
There is an Interface properties I also need to match on. I do not want to follow all the paths, I just the one with Interface Node property I am looking for. For example Interface.VlanList CONTAINS &quot;,23,&quot;

I have done the following in Cypher but it applies that I already know how many iterations I am going to find which in reality is not the case.

```
match (n:StartNode {name:&quot;device name&quot;}) -[:BELONG_TO]- (i:Interface) -[:IS_CONNECTED]- (ii:Interface)-[:BELONG_TO]-(nn:Node) -[:BELONG_TO]- (iii:Interface) -[:IS_CONNECTED]- (iiii:Interface) -[:BELONG_TO]-(nnn:Node)
where i.VlanList CONTAINS &quot;,841,&quot;
AND ii.VlanList CONTAINS &quot;,841,&quot;
AND iii.VlanList CONTAINS &quot;,841,&quot;
return n, i,ii,nn,iii,iiii,nnn
```

I have been looking at the documentation but can not work out how the above could be resolved.",1600695958,https://stackoverflow.com/q/63993612,Fabien,"['cypher', 'neo4j']"
63982623,How to use Predicates correctly in cypher allShortestPaths,"
**Summary**
I have the following graph structure and the idea is that `manager` has certain `permissions` on given `resources` As seen in the picture, there are three resources and one context (manager). Further we see some inheritance on the resources. `break` is owned by `shift`. And `lunch` is owned by break. I want to design a query that returns all shortest paths from the manager to each resource. For example the shortest path from `manager` to `shift` will be the `permission` relationship seen going out from the manager where the permitted field is allowed. The question lies with finding the shortest path to break. Ideally, I want the shortest path to `break` to go via shift and not via lunch. In other words permissions present on the parent are to be inherited for a child without any **direct permissions** 

**What I have tried:**
I did manage to write the correct query but here&#39;s my problem - the result correctly eliminates a few resources 

**Code**
Here is the query I have tried so far. It correctly computes the shortest path to resources with one catch - it considers both the shortest path to `break`. One via `lunch` [should not happen] and one via shift [I want this]. Further it omits shift all together because it is purely an &quot;ancestor&quot; (refer to the query) and not a &quot;child&quot; which I understand. 

```
MATCH (ancestors:Resource)&lt;-[:OWNED_BY*..15]-(child:Resource)
MATCH (principal:Resource{id: &quot;p-id&quot;})&lt;-[grant:GRANTED_TO]-(context:Context{id:&quot;c-id&quot;})-[permission:PERMISSION]-&gt;(ancestors), path = allShortestPaths((context)-[*..15]-(child))
RETURN DISTINCT path
```
Here&#39;s the output for the query when executed in my browser.

```
{
  &quot;start&quot;: {
&quot;identity&quot;: 22,
&quot;labels&quot;: [
      &quot;Context&quot;
    ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;manager&quot;,
&quot;id&quot;: &quot;adef1b8c-3141-44bc-a1ec-1644fa6db79a&quot;
    }
  },
  &quot;end&quot;: {
&quot;identity&quot;: 41,
&quot;labels&quot;: [
      &quot;Resource&quot;
    ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;break&quot;,
&quot;context_id&quot;: &quot;&quot;,
&quot;id&quot;: &quot;b8519676-312a-4ba4-8004-404c7d782706&quot;,
&quot;source_id&quot;: &quot;break-guid&quot;
    }
  },
  &quot;segments&quot;: [
    {
      &quot;start&quot;: {
&quot;identity&quot;: 22,
&quot;labels&quot;: [
          &quot;Context&quot;
        ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;manager&quot;,
&quot;id&quot;: &quot;adef1b8c-3141-44bc-a1ec-1644fa6db79a&quot;
        }
      },
      &quot;relationship&quot;: {
&quot;identity&quot;: 4,
&quot;start&quot;: 22,
&quot;end&quot;: 20,
&quot;type&quot;: &quot;PERMISSION&quot;,
&quot;properties&quot;: {
&quot;permitted&quot;: &quot;allow&quot;,
&quot;name&quot;: &quot;read&quot;,
&quot;id&quot;: &quot;dad8b6a0-b039-4105-87d4-ca151963e1a7&quot;
        }
      },
      &quot;end&quot;: {
&quot;identity&quot;: 20,
&quot;labels&quot;: [
          &quot;Resource&quot;
        ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;shift&quot;,
&quot;context_id&quot;: &quot;&quot;,
&quot;id&quot;: &quot;2ba8d928-d534-4179-9fad-c85f584ce6d5&quot;,
&quot;source_id&quot;: &quot;guid&quot;
        }
      }
    },
    {
      &quot;start&quot;: {
&quot;identity&quot;: 20,
&quot;labels&quot;: [
          &quot;Resource&quot;
        ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;shift&quot;,
&quot;context_id&quot;: &quot;&quot;,
&quot;id&quot;: &quot;2ba8d928-d534-4179-9fad-c85f584ce6d5&quot;,
&quot;source_id&quot;: &quot;guid&quot;
        }
      },
      &quot;relationship&quot;: {
&quot;identity&quot;: 21,
&quot;start&quot;: 41,
&quot;end&quot;: 20,
&quot;type&quot;: &quot;OWNED_BY&quot;,
&quot;properties&quot;: {

        }
      },
      &quot;end&quot;: {
&quot;identity&quot;: 41,
&quot;labels&quot;: [
          &quot;Resource&quot;
        ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;break&quot;,
&quot;context_id&quot;: &quot;&quot;,
&quot;id&quot;: &quot;b8519676-312a-4ba4-8004-404c7d782706&quot;,
&quot;source_id&quot;: &quot;break-guid&quot;
        }
      }
    }
  ],
  &quot;length&quot;: 2.0
}

{
  &quot;start&quot;: {
&quot;identity&quot;: 22,
&quot;labels&quot;: [
      &quot;Context&quot;
    ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;manager&quot;,
&quot;id&quot;: &quot;adef1b8c-3141-44bc-a1ec-1644fa6db79a&quot;
    }
  },
  &quot;end&quot;: {
&quot;identity&quot;: 41,
&quot;labels&quot;: [
      &quot;Resource&quot;
    ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;break&quot;,
&quot;context_id&quot;: &quot;&quot;,
&quot;id&quot;: &quot;b8519676-312a-4ba4-8004-404c7d782706&quot;,
&quot;source_id&quot;: &quot;break-guid&quot;
    }
  },
  &quot;segments&quot;: [
    {
      &quot;start&quot;: {
&quot;identity&quot;: 22,
&quot;labels&quot;: [
          &quot;Context&quot;
        ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;manager&quot;,
&quot;id&quot;: &quot;adef1b8c-3141-44bc-a1ec-1644fa6db79a&quot;
        }
      },
      &quot;relationship&quot;: {
&quot;identity&quot;: 24,
&quot;start&quot;: 22,
&quot;end&quot;: 60,
&quot;type&quot;: &quot;PERMISSION&quot;,
&quot;properties&quot;: {
&quot;permitted&quot;: &quot;deny&quot;,
&quot;name&quot;: &quot;read&quot;,
&quot;id&quot;: &quot;9b52f239-43b5-4b17-a29a-91bfeebca001&quot;
        }
      },
      &quot;end&quot;: {
&quot;identity&quot;: 60,
&quot;labels&quot;: [
          &quot;Resource&quot;
        ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;lunch&quot;,
&quot;context_id&quot;: &quot;&quot;,
&quot;id&quot;: &quot;8c96482d-517f-4421-b1e8-4f4826438cf1&quot;,
&quot;source_id&quot;: &quot;lunch-guid&quot;
        }
      }
    },
    {
      &quot;start&quot;: {
&quot;identity&quot;: 60,
&quot;labels&quot;: [
          &quot;Resource&quot;
        ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;lunch&quot;,
&quot;context_id&quot;: &quot;&quot;,
&quot;id&quot;: &quot;8c96482d-517f-4421-b1e8-4f4826438cf1&quot;,
&quot;source_id&quot;: &quot;lunch-guid&quot;
        }
      },
      &quot;relationship&quot;: {
&quot;identity&quot;: 23,
&quot;start&quot;: 60,
&quot;end&quot;: 41,
&quot;type&quot;: &quot;OWNED_BY&quot;,
&quot;properties&quot;: {

        }
      },
      &quot;end&quot;: {
&quot;identity&quot;: 41,
&quot;labels&quot;: [
          &quot;Resource&quot;
        ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;break&quot;,
&quot;context_id&quot;: &quot;&quot;,
&quot;id&quot;: &quot;b8519676-312a-4ba4-8004-404c7d782706&quot;,
&quot;source_id&quot;: &quot;break-guid&quot;
        }
      }
    }
  ],
  &quot;length&quot;: 2.0
}

{
  &quot;start&quot;: {
&quot;identity&quot;: 22,
&quot;labels&quot;: [
      &quot;Context&quot;
    ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;manager&quot;,
&quot;id&quot;: &quot;adef1b8c-3141-44bc-a1ec-1644fa6db79a&quot;
    }
  },
  &quot;end&quot;: {
&quot;identity&quot;: 60,
&quot;labels&quot;: [
      &quot;Resource&quot;
    ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;lunch&quot;,
&quot;context_id&quot;: &quot;&quot;,
&quot;id&quot;: &quot;8c96482d-517f-4421-b1e8-4f4826438cf1&quot;,
&quot;source_id&quot;: &quot;lunch-guid&quot;
    }
  },
  &quot;segments&quot;: [
    {
      &quot;start&quot;: {
&quot;identity&quot;: 22,
&quot;labels&quot;: [
          &quot;Context&quot;
        ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;manager&quot;,
&quot;id&quot;: &quot;adef1b8c-3141-44bc-a1ec-1644fa6db79a&quot;
        }
      },
      &quot;relationship&quot;: {
&quot;identity&quot;: 24,
&quot;start&quot;: 22,
&quot;end&quot;: 60,
&quot;type&quot;: &quot;PERMISSION&quot;,
&quot;properties&quot;: {
&quot;permitted&quot;: &quot;deny&quot;,
&quot;name&quot;: &quot;read&quot;,
&quot;id&quot;: &quot;9b52f239-43b5-4b17-a29a-91bfeebca001&quot;
        }
      },
      &quot;end&quot;: {
&quot;identity&quot;: 60,
&quot;labels&quot;: [
          &quot;Resource&quot;
        ],
&quot;properties&quot;: {
&quot;name&quot;: &quot;lunch&quot;,
&quot;context_id&quot;: &quot;&quot;,
&quot;id&quot;: &quot;8c96482d-517f-4421-b1e8-4f4826438cf1&quot;,
&quot;source_id&quot;: &quot;lunch-guid&quot;
        }
      }
    }
  ],
  &quot;length&quot;: 1.0
}
``` 

Is there any way to write a query that gives me shortest path (permissions) to all resources and in case there isn&#39;t a shortest path, take the permissions of the immediate parent. Any help will be appreciated. Thank you

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/X07TD.png",1600628575,https://stackoverflow.com/q/63982623,Harshil,"['graph-databases', 'neo4j', 'cypher']"
63975799,How can I get Spring Data Neo4j (SDN) to initialise and optional relationships collection with an empty list in Kotlin?,"Accessing Neo4j in Kotlin using SDN, I have an entity with relationships which I&#39;m only using to read from the db. Looks a bit like this:
```kotlin
@NodeEntity
class Parent() {
    @Relationship(type = &quot;CHILD_OF&quot;, direction = Relationship.INCOMING)
    lateinit var children: List&lt;Child&gt;
    ...
```

I&#39;m using a custom query with an optional match to retrieve these objects. It looks like this (the actual query is more complex, but this is the problematic part):
```cypher
MATCH (parent:Parent) WHERE ID(parent) IN $parentIds
OPTIONAL MATCH (parent)&lt;-[r1:CHILD_OF]-(child:Child)
RETURN DISTINCT parent, child, r1
```

When there are children related to the parent returned by the query, it works fine. However, when the Parent has no children, and I try to access `parentObject.children`, I get:
```
kotlin.UninitializedPropertyAccessException: lateinit property children has not been initialized
```

What I&#39;d like to happen is, when there are no related `Child` entities returned by the query, the `children` field should be an empty list instead of being unset.

Is there a way for me to tell the Cypher query or SDN to do that?",1600579550,https://stackoverflow.com/q/63975799,Graham Lea,"['neo4j', 'spring-data-neo4j', 'cypher', 'kotlin']"
63969887,How to convert a node to multiple relationships in Neo4j,"I have a Neo4j database that stores some information about scientific articles and their authors. I need to refactor my database in the following way, as shown in the image below. Each yellow node represents an author. Red nodes are articles. I need to remove red nodes and connect authors if they are co-authors of the same article.

![][1]

  [1]: https://i.stack.imgur.com/8jOlw.png",1600526048,https://stackoverflow.com/q/63969887,Francesco Binucci,"['neo4j', 'cypher']"
63964654,Neo4J: Return latest data node for each value of a given key,"I am working on a dataset in Neo4J that gets updated regularly, and I want to write a single query that will get me the latest data node for each value of a given key in the database, but I&#39;m not sure how to do it.

Here&#39;s an example of how my data looks (simplified):

```json
[
  {
    &quot;timestamp&quot;: &quot;&lt;timestamp - 3 days ago&gt;&quot;,
    &quot;component&quot;: &quot;a&quot;,
    &quot;value&quot;: &quot;1&quot;
  },
  {
    &quot;timestamp&quot;: &quot;&lt;timestamp - 1 day ago&gt;&quot;,
    &quot;component&quot;: &quot;a&quot;,
    &quot;value&quot;: &quot;2&quot;
  },
  {
    &quot;timestamp&quot;: &quot;&lt;timestamp - 6 days ago&gt;&quot;,
    &quot;component&quot;: &quot;b&quot;,
    &quot;value&quot;: &quot;5&quot;
  },
  {
    &quot;timestamp&quot;: &quot;&lt;timestamp - 4 days ago&gt;&quot;,
    &quot;component&quot;: &quot;b&quot;,
    &quot;value&quot;: &quot;9&quot;
  },
  {
    &quot;timestamp&quot;: &quot;&lt;timestamp - 2 days ago&gt;&quot;,
    &quot;component&quot;: &quot;b&quot;,
    &quot;value&quot;: &quot;11&quot;
  },
  ...
}
```

From this example data, I would want to return one row for each unique `component`, and it would be the most recent based on the timestamp:

```json
[
  {
    &quot;timestamp&quot;: &quot;&lt;timestamp - 1 day ago&gt;&quot;,
    &quot;component&quot;: &quot;a&quot;,
    &quot;value&quot;: &quot;2&quot;
  },
  {
    &quot;timestamp&quot;: &quot;&lt;timestamp - 2 days ago&gt;&quot;,
    &quot;component&quot;: &quot;b&quot;,
    &quot;value&quot;: &quot;11&quot;
  },
  ...
]
```

Or if I just return specific columns that I care about:

```
| component | value |
| ---       | ---   |
| a         | 2     |
| b         | 11    |
| ...       | ...   |
```

Is there a good, concise way of doing this with cypher?",1600481756,https://stackoverflow.com/q/63964654,wcase6,"['cypher', 'neo4j']"
63952269,get the root parent node using neo4j," I&#39;ve imported a csv file to neo4j and created nodes and relationships for them.   

   

In the above the first two nodes comes under db1 and last four nodes comes under db2.
How to find that last four nodes belongs to db2?

Below is the code and csv file
    columnname,tablename,databasename,systemname
    abc,1a,db1,Finance
    def,1a,db1,Finance
    ghi,1a,db1,Finance
    klm,1a,db1,Finance
    abc,1a,db2,Medical
    def,1a,db2,Medical
    ghi,1a,db2,Medical
    klm,1a,db2,Medical
    nop,1a,db2,Medical
    qrs,1a,db2,Medical
    
    I&#39;ve created nodes and relationships for the above csv file in neo4j
    This is for getting unique values   
        CREATE CONSTRAINT ON (c:ColumnName) ASSERT c.ColumnName IS UNIQUE;
        CREATE CONSTRAINT ON (c:TableName) ASSERT c.TableName IS UNIQUE;
        CREATE CONSTRAINT ON (c:DatabaseName) ASSERT c.DatabaseName IS UNIQUE;
        CREATE CONSTRAINT ON (c:SystemName) ASSERT c.SystemName IS UNIQUE;
    
    This is for loading csv file and creating nodes and relationships
  
        LOAD CSV WITH HEADERS FROM &quot;file:///test.csv&quot; AS line
        MERGE (ColumnName:ColumnName {ColumnName: line.ColumnName})
        MERGE (TableName:TableName {TableName:line.TableName})
        MERGE (DatabaseName: DatabaseName {DatabaseName:line.DatabaseName})
        MERGE (SystemName: SystemName {SystemName:line.SystemName})

    This is creating relationships among the nodes
         MERGE (ColumnName)-[:iscolumnof]-&gt;(TableName)
         MERGE (TableName)-[:istableof]-&gt;(DatabaseName)
         MERGE (DatabaseName)-[:isdatabaseof ]-&gt;(SystemName)
		 
	 If, i select one node &#39;nop&#39;and expand i&#39;ll get the node(1a) 1a and if i expand 1a i&#39;ll get all the 
    nodes(columns). How to find that &#39;nop&#39; belongs to &#39;db2&#39;?
[![csv file][1]][1]


  [1]: https://i.stack.imgur.com/kF5Sp.png",1600418515,https://stackoverflow.com/q/63952269,Ravali,"['cypher', 'neo4j']"
63949582,Neo4j Cannot merge node using null property value,"**Problem Statement :** I am trying to import the CSV data (will provide sample of it) into Neo4J
I am trying to follow the tutorial from YouTube (by Neo4J - https://www.youtube.com/watch?v=Eh_79goBRUk) on trying to get it work.

However,  when I try to run the following query , it fails at 
Cannot merge node using null property value for customer_id (Failure when processing file &#39;/Users/zuperduper/stuff.csv&#39; on line 2.)


**Dataset**

There aren&#39;t any null in the fields , all of the fields are populated.
```
customer_id,review_id,product_id,product_category,review_date
33620853,R1QRX00VPUAA1G,B00A7W0VLY,Baby,2014-10-23
40919284,R1SZE4TH7QPXG6,B00NGV8RUU,Baby,2014-10-18
36567020,R2NST8F25WDOG2,B00LIRJ2NU,Baby,2014-10-15
```


**Cypher Code**

```
// CREATE UNIQUE CONSTRAINTS FOR THIS
CREATE CONSTRAINT ON (c:Review_id) ASSERT c.review_id IS UNIQUE;
CREATE CONSTRAINT ON (c:Product_category) ASSERT c.product_category IS UNIQUE;
CREATE CONSTRAINT ON (c:Customer_id) ASSERT c.customer_id IS UNIQUE;
CREATE CONSTRAINT ON (c:Product_id) ASSERT c.product_id IS UNIQUE;

// LOAD STUFF
//USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM
&#39;file:///Users/zuperduper/stuff.csv&#39; AS line
WITH line , SPLIT(line.review_date,&#39;/&#39;) AS date 

CREATE (review_id:Review_ID {id: toInteger(line.`review_id`)})
SET review_id.year = toInteger(date[0]) 
SET review_id.month = toInteger(date[1])
SET review_id.day = toInteger(date[2])

MERGE (customer_id:Customer_id {customer_id: toInteger(line.`customer_id`)})
MERGE (Product_category:Product_category {customer_id: toInteger(line.product_category)})
MERGE (product_id:Product_id {customer_id: toInteger(line.product_id)})

CREATE (customer_id)-[:WRITES]-&gt;(review_id)
CREATE (product_id)-[:CONTAINS]-&gt;(review_id)
CREATE (product_category)-[:PARTOF]-&gt;(product_id)
```

I am using Neo4j 4.1.0

I am not to sure if I should create the customer first and use the merge later. Just need some guidance on this ",1600405179,https://stackoverflow.com/q/63949582,prasys,"['neo4j', 'cypher']"
63949016,Why does a modest MATCH and CREATE query spin in Neo4j browser?,"# Overview #

I am using Neo4j desktop browser to create a graph of page relationships within a website. I&#39;m sure csv load makes this more efficient, but doesn&#39;t seem like this query should cause as many problems as it does.

 1. Creation of nodes takes longer than expected (syntax preference?)
 2. Relationship creation spins and times out/crashes

. . .
# Problem 1 #
### Creation of nodes takes longer than expected (syntax preference?) ###

I am creating about 6,500 very basic nodes (1 piece of information within each):

`create (a1:link {description:&quot;www.samplelink.com/example1&quot;})`

I am building my query in Excel and copy-pasting it into the neo4j browser. I can construct it one of two ways:

```
create (a1:link {description:&quot;www.samplelink.com/example1&quot;})
create (a2:link {description:&quot;www.samplelink.com/example2&quot;})
create (a3:link {description:&quot;www.samplelink.com/example3&quot;})
...x6,000
```

OR

```
create (a1:link {description:&quot;www.samplelink.com/example1&quot;}),
(a2:link {description:&quot;www.samplelink.com/example2&quot;}),
(a3:link {description:&quot;www.samplelink.com/example3&quot;}),
...x6,000
```

**Q: Is there a preferred syntax? What&#39;s the advantage to each?**
6,500 nodes (especially basic ones without a lot of information), doesn&#39;t seem like there would be a massive performance improvement. The query takes anywhere between 5 mins and 15+ minutes with the program&#39;s stated actual runtime either 7,000 ms or 47,000 ms. But actual browser spinning takes MUCH longer than the stated final runtime.

. . .
# Problem 2 #

### Relationship creation spins and times out/crashes ###

I construct (what I interpret are) very simple match clauses to assign the nicknames. The string matches are literal (with no regexp), there&#39;s no graph traversal, and the relationships are straightforward.

```
match (a1:link {description:&quot;www.samplelink.com/example1&quot;})
match (a2:link {description:&quot;www.samplelink.com/example2&quot;})
match (a3:link {description:&quot;www.samplelink.com/example3&quot;})
...x6,000

create (a1)-[:REF]-&gt;(a3)
create (a1)-[:REF]-&gt;(a47)
create (a5832)-[:REF]-&gt;(a9)
...x5,000
```

This query runs for 2+ hours and then crashes/times out.

**Q: Again syntax-wise, am I doing something incredibly memory hungry? Should this be written a slightly different way? One MATCH phrase with commas? One CREATE phrase for the relationships?**

. . . 

# My reading materials #

**1. I considered this article on cardinality:**

https://neo4j.com/developer/kb/understanding-cypher-cardinality/

It seems like maybe I&#39;m accidentally creating a massive cross-product of relationships rather than each single relationship as intended...? I also don&#39;t know whether the MATCH syntax is doing something funny with the way neo4j outputs &quot;rows&quot;, holds those in memory, and then does the desired operation on each row.

Is it more efficient to do the MATCH within one MATCH phrase? Same with the CREATE for the relationships.

```
MATCH (a1:link {desc:&quot;alpha&quot;}),
(a2:link {desc:&quot;beta&quot;}),
(a3:link {desc:&quot;gamma&quot;})
```

**2. Indexes**

I saw a lot of places people commenting on other spinning query posts, to create an index.

I did try to create an index `CREATE INDEX ON :link(description)`, but coming from a SQL background, I don&#39;t understand how this would materially speed up a query with only 6,500 literal string matches.

**3. Similar hang problem**

https://stackoverflow.com/questions/27439424/neo4j-crashes-on-batch-import?rq=1

Approved answer, third point, suggests breaking it into smaller transactions of 100 per MATCH/CREATE. I guess I could do this? It seems like a lot of fiddling in Excel to make sure my MATCH clause includes the proper nodes for the CREATE sections. Seems like neo4j should be able to handle 6,500 nodes and 5,000 basic relationships in memory...I&#39;m not doing anything advanced here.

# Updates #

I am re-running the query now, in the &quot;MATCH node, node, node&quot; format not &quot;MATCH node MATCH node MATCH node&quot; format. I only have 1 CREATE statement, a random relationship between 2 nodes. This (apparently massive) MATCH clause with a single CREATE clause is taking 15+ minutes. So I think it&#39;s a matter of holding all the nodes in memory that&#39;s the problem.

Query ends with an error: &quot;Neo.TransientError.General.StackOverFlowError - There is not enough stack size to perform the current task. This is generally considered to be a database error, so please contact Neo4j support. You could try increasing the stack size: for example to set the stack size to 2M, add `dbms.jvm.additional=-Xss2M&#39; to in the neo4j configuration (normally in &#39;conf/neo4j.conf&#39; or, if you are using Neo4j Desktop, found through the user interface) or if you are running an embedded installation just add -Xss2M as command line flag.&quot;

I constructed it extremely basic MATCH node1 MATCH node2 CREATE (node1)-[:REL]-&gt;(node2); and stringing these queries together. Each mini-query runs consecutively, but in my Neo4j browser it take literally 2 seconds per query (after a 30 second warm-up to process/compile the initial query). 300 queries will take 10 mins at this rate. And I have 5,000 statements to get through. There has to be a more efficient way when people are creating graphs with thousands/millions/billions of nodes. Is it as simple as &quot;Don&#39;t use Neo4j browser?&quot; and use csv load?",1600400573,https://stackoverflow.com/q/63949016,ChillyNeo,"['cypher', 'neo4j']"
63939252,Neo4j create ranking by region by vendor based on similarity,"I am able to create recommendation with materials not bought by user using materials in common(similarity) and showed as recommendation engine

    MATCH (eid:eid{id:&#39;102&#39;})-[:BOUGHT]-&gt;(mat:material)&lt;-[:BOUGHT]-(someOthereid:eid)-[:BOUGHT]-&gt;(m2:material)
    WHERE
        NOT((eid)-[:BOUGHT]-&gt;(m2))
        AND eid &lt;&gt; someOthereid
    RETURN distinct m2,eid

and recommendation based ranking by location by vendor irrespective of similarity (recommends all materials excluding own)

    match (n:bookdb)
    match (m:material{id:n.mat}) match(eid:eid{id:&#39;104&#39;}) match(ecl:ecountry{id:n.eloc}) 
    match(ven:vendor{id:n.ven}) match(vloc:vlocation{id:n.vloc})  
    WHERE NOT (m)&lt;-[:BOUGHT]-(eid)
    with distinct eid, m,count(m) as timessold,ven,vloc
    return  distinct eid,m,timessold,ven,vloc  order by timessold desc,m

but unable to create one query using both first and second query ,create ranking by location by vendor with respective to similarity (as in first query). Please suggest..

I am expecting recommendation on similar materials bought by ranking group by vendor by region 

I am adding sample data 

[![enter image description here][1]][1]


and my result should be like it should first show me by ranking of number of times material bought with respect to vendor location and vendor i.e. ORDER BY timessold desc,vlocation,vendor. I am getting result but ranking is not working with respect to vlocation and vendor

my expected result should be .. lets consider enduserid=104 then result should be like below scheenshot.. material recommended)excluding material enduserid already bought) order by vendor,vendorlocation here timessold is number of times material sold by vendor from vendorlocation to enduserid

[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/QBgsL.png
  [2]: https://i.stack.imgur.com/A9551.png


and if we consider enduserid=106 then no material should get recommended as there is no material in common",1600349673,https://stackoverflow.com/q/63939252,user3828029,"['graph-databases', 'cql', 'database', 'neo4j', 'cypher']"
63936851,"In Neo4j how to group by one return key, instead of all non aggregate keys in return?","[Neo4j documentation][1] mentions that:


&gt; 4.3. Aggregating functions To calculate aggregated data, Cypher offers aggregation, analogous to SQL’s GROUP BY.
&gt; 
&gt; Aggregating functions take a set of values and calculate an aggregated
&gt; value over them. Examples are avg() that calculates the average of
&gt; multiple numeric values, or min() that finds the smallest numeric or
&gt; string value in a set of values. When we say below that an aggregating
&gt; function operates on a set of values, we mean these to be the result
&gt; of the application of the inner expression (such as n.age) to all the
&gt; records within the same aggregation group.
&gt; 
&gt; Aggregation can be computed over all the matching subgraphs, or it can
&gt; be further divided by introducing grouping keys. These are
&gt; non-aggregate expressions, that are used to group the values going
&gt; into the aggregate functions.
&gt; 
&gt; Assume we have the following return statement:
&gt; 
&gt; RETURN n, count(*)
&gt; 
&gt; **We have two return expressions: n, and count(*). The first, n, is not an aggregate function, and so it will be the grouping key. The
&gt; latter, count(*) is an aggregate expression. The matching subgraphs
&gt; will be divided into different buckets, depending on the grouping
&gt; key.** The aggregate function will then be run on these buckets,
&gt; calculating an aggregate value per bucket.

I cannot figure out how to:

    RETURN n, m COLLECT(n);

for example, and only use `n` as the grouping key, not both `n` and `m`.


  [1]: https://neo4j.com/docs/cypher-manual/current/functions/aggregating/",1600341310,https://stackoverflow.com/q/63936851,Siddhartha Sehgal,"['neo4j', 'cypher', 'group-by']"
63934416,Match relationships if a certain parameter exists,"I&#39;ve been using neo4j for a while and recently i got stuck with a query that i don&#39;t seem to be able to succesfully run.

My goal: I have a type of relationship called `HAS_RELATIONSHIP`. this type of rel sometimes hasa property called `verified`. I want to get a subgraph of those relationships that don&#39;t have this property so i can afterwards add the property.

What I have done so far:

    Match (a)-[r:HAS_RELATIONSHIP]-(b) 
    where  r.verified=False 
    set r.verified=True
    LIMIT 5
    return r, a, b

the part that is not working is `where r.verified=False` it should be something like `exists(r)=verified` but t doesn&#39;t seem to exist this kind of query. I have checked on `OPTIONAL` MATCH, but it seems it is neither the solution.

Any ideas?",1600332286,https://stackoverflow.com/q/63934416,Alvaro,"['neo4j', 'cypher']"
63932764,updating fulltext search index,"Is it possible to update a fulltext search index? I can&#39;t find anything in the documentation state for or against it.

E.g.

    CALL db.index.fulltext.createNodeIndex(
    		&quot;FullTextIndex&quot;,
    		[
    			&quot;Node&quot;
    		],
    		[
    			&quot;title&quot;, 
    			&quot;description&quot;
    		]);

If I wanted to update either the label or property, is there any way to do so without dropping and rebuilding it?",1600325731,https://stackoverflow.com/q/63932764,A. L,"['neo4j', 'cypher']"
63928225,Cypher : representing nested graphs?,"How would you represent graph of graphs in Graph DB.
F.e. mnemonically it may look like this :


    ((a)-&gt;(b))-&gt;(c)
    ((a)-&gt;(b))-&gt;((c)-&gt;(d))

In a sense (a)-&gt;(b) for (c) act as a single node, but is internally two linked nodes.
And of course you should be able to nest them further.

Is there some graph structure that I can use to represent this.

------

      (a)&lt;-[:1]-(ab)-[:2]-&gt;(b)
      (ab)&lt;-[:1]-(abc)-[:2]-&gt;(c)

???

------

@bouteillebleu : second variant 

     (a)-[:fst]-&gt;(ab)-[:snd]-&gt;(b)
     (ab)-&gt;(c)",1600291940,https://stackoverflow.com/q/63928225,sten,"['redisgraph', 'cypher', 'neo4j']"
63916796,Neo4j cypher query poor performance,"I have these nodes:

 1. `user{user_id}: users`
 2. `thread{thread_id, published_date, like_count, comment_count, view_count}: posts`
 3. `tag_id{tag_id}: the tag of the post`

And these relationships:
1. `(user) - [: FOLLOWED] -&gt; (tag)` // the user follows the tag
2. `(thread) - [: BELONG_TO] -&gt; (tag)` // the post belongs to tag
3. `(user) - [: READ] -&gt; (thread)` // user reads the post

Now I want to query 5 posts belong to tag user follow user has not read that thread, and that thread must be up to date, order by point DESC. I created index on User(user_id), Tag(tag_id), Thread(thread_id) and i run this cypher query from the browser:

```
MATCH (u:User)-[:FOLLOWED]-&gt;(t:Tag)&lt;-[:BELONG_TO]-(th)
WHERE u.user_id = 3 AND NOT EXISTS((u)-[:READ]-&gt;(th))
WITH u.user_id AS user_id, th.thread_id AS thread_id,
t.tag_id AS tag_id,duration.inDays(datetime(),
datetime(th.published_date)).days AS days,
(0.5*th.like_count + 0.3*th.comment_count + 0.2*th.view_count) AS point
ORDER BY days DESC
RETURN DISTINCT thread_id SKIP 0 LIMIT 5
```

With just 1 node in database (also embedded ) took 235 ms. Obviously something is going wrong. What could be the problem. Pleace hepl me",1600247435,https://stackoverflow.com/q/63916796,Anh,"['neo4j', 'cypher']"
63910182,Cypher merge query creates new nodes instead of merging,"So I&#39;m trying to figure out why this keeps creating new nodes instead creating relationships to the existing nodes. Using this example: https://neo4j.com/docs/cypher-manual/current/clauses/unwind/

I feel like my query is basically the same thing. But as you can see below, instead of relating 222 and 333 both to 111, it creates 2 nodes as 111

### Parameters
```
:params {components:[{targetId: &quot;111&quot;, dependencyId: &quot;222&quot;},{targetId: &quot;111&quot;, dependencyId:&quot;333&quot;}]}
```

### Query
```
UNWIND $components AS component
MERGE (dependency:Component {Id: component.dependencyId })
MERGE (dependency)&lt;-[:DEPENDS_ON]-(target:Component {Id: component.targetId })
RETURN dependency, target
```

One thing I noticed is that if I run the following query twice, it doesn&#39;t create the duplicate which seems to contradict what&#39;s happening in the UNWIND query above:

```
MERGE (c:Component {Id: &quot;111&quot;})
```

[![enter image description here][1]][1]

  [1]: https://i.stack.imgur.com/JzibD.png",1600205828,https://stackoverflow.com/q/63910182,Sinaesthetic,"['neo4j', 'cypher']"
63909483,Is it possible to import multiple node types in the same csv in neo4j?,"I want to import some different types of nodes in neo4j where the nodes only differ on the type and not the data. Is it possible to import something like this:

```
NodeType,Id,Name
NodeX,1,Yolo
NodeY,2,World
```

And get two nodes, one of type `NodeX` and one of type `NodeY` somehow?

What I would like to write is something like this:

```
LOAD CSV WITH HEADERS FROM &quot;file:///nodes.csv&quot; as row
WITH row WHERE row.Id IS NOT NULL
MERGE (c:row.NodeType {id: row.Id, name: row.Name});
```",1600202065,https://stackoverflow.com/q/63909483,Tomas Jansson,"['neo4j', 'cypher']"
63903964,"use match statement when using neo4j driver, the returned result.record is nil","match statement:

```
result, errRet = session.Run(&quot;MATCH (n) return n&quot;, nil)

log.Printf(&quot;hello here: %+v&quot;, result)
```

result:

```
&amp;{err:&lt;nil&gt; iter:0xc00017c600 stream:0xc00072b020 cypher:MATCH (n) return n params:map[] allReceived:false unconsumed:{root:{next:&lt;nil&gt; prev:&lt;nil&gt; list:&lt;nil&gt; Value:&lt;nil&gt;} len:0} record:&lt;nil&gt; summary:&lt;nil&gt;}
```

actual data in db:

![actual data in db][1]


  [1]: https://i.stack.imgur.com/gMcBf.png

As i searched and couldn&#39;t find the answer. Plz show me which part i&#39;m wrong, and very appreciated for it.

btw, create statement really works fine for me.",1600179837,https://stackoverflow.com/q/63903964,brickzzhang,"['neo4j', 'go', 'cypher']"
63901430,Create relationship between each two nodes for a set of nodes,"I have created many nodes in neo4j, the attributes of these nodes are the same, they all have user_id and item_id, the code used is as follows:
```
LOAD CSV WITH HEADERS FROM &#39;file://data.csv&#39; AS row
CREATE (main:Main_table {USER_ID: row.user_id,
                         ITEM_ID: row.item_id}
       )
CREATE INDEX ON :Main_table(USER_ID);
CREATE INDEX ON :Main_table(ITEM_ID);
```
Now I want to create relationship between the nodes with the same user_id or item_id. For example, if node A, B and C have the same USER_ID, I want to create `(A)-[:EDGE]-&gt;(B)`, `(A)-[:EDGE]-&gt;(C)` and `(B)-[:EDGE]-&gt;(C)`. In order to achieve this goal, I tried the following code:
```
MATCH (a:Main_table),(b:Main_table)
WHERE a.USER_ID = b.USER_ID
CREATE (a)-[:USER_EDGE]-&gt;(b);
MATCH (a:Main_table),(b:Main_table)
WHERE a.ITEM_ID = b.ITEM_ID
CREATE (a)-[:ITEM_EDGE]-&gt;(b);
```
But due to the large amount of data (3000000 nodes, 100000 users), this process is very slow, how can I quickly complete this process? Any help would be greatly appreciated!",1600171387,https://stackoverflow.com/q/63901430,polaraaa,"['neo4j', 'cypher']"
63901093,Neo4j: Why do multiple match expressions work but one single match does not?,"I want to return the nodes `h` that have ancestors `camera=red` (red node in the diagram) and `vph=1` (pink node in the diagram). 
There are quite a few nodes on the way from those ancestors to `h` and there is more than 1 path for each ancestor which sometimes overlap. 
Indeed there each path from each ancestor must pass through a `Run` node before reaching a `File` (green node in the diagram).

[![enter image description here][1]][1]
I can run a query:

    match p1=(:camera {value: &#39;red&#39;})-[*]-&gt;(h:File)
    match p2=(:vph {value: 1})-[*]-&gt;(h:File)
    return h

and it returns the nodes. But I don&#39;t think that is what I want. 

However, when I run:

    match p1=(:camera {value: &#39;red&#39;})-[*]-&gt;(h),
    p2=(:vph {value: 1})-[*]-&gt;(h)
    where h:File
    return h

it returns no rows/nodes. This 

Why does chaining the expressions in this way not work?
I cannot work out how to export a subgraph so the image is the only thing I can do right now.

[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/C8Kdu.png
  [2]: https://i.stack.imgur.com/XJVeD.png",1600170135,https://stackoverflow.com/q/63901093,Lucidnonsense,"['neo4j', 'cypher']"
63896249,Unable to load CSV in neo4j due to periodic commit error,"This is the error I am getting while loading a CSV file: 

&gt; Neo.ClientError.Statement.SemanticError: Executing queries that use
&gt; periodic commit in an open transaction is not possible.

This is the code that I am using: 

    USING PERIODIC COMMIT
    LOAD CSV WITH HEADERS FROM &#39;file:///bs140513_032310.csv&#39; AS line
    WITH line,
      SPLIT(line.customer, &quot;&#39;&quot;) AS customerID,
      SPLIT(line.age, &quot;&#39;&quot;) AS customerAge,
      SPLIT(line.gender, &quot;&#39;&quot;) AS customerGender,
      SPLIT(line.zipcodeOri, &quot;&#39;&quot;) AS customerZip,
      SPLIT(line.merchant, &quot;&#39;&quot;) AS merchantID,
      SPLIT(line.zipMerchant, &quot;&#39;&quot;) AS merchantZip,
      SPLIT(line.category, &quot;&#39;&quot;) AS transCategory



",1600151049,https://stackoverflow.com/q/63896249,Harsh Solanki,"['cypher', 'neo4j']"
63883504,Neo4J cypher:recommend products using NOT clause or any,"I am able to create relationship between material and the enduser who bought it using below code
but now I want to find materials not bought by enduser using materials in common and show as recommendation engine in graph. lets say A bought 1,2,3 products and B bought 1,3 products,c has 5, here I want to recommend product 2 to B customer and c with no products as c and rest doesnt have product in common to recommend

     MATCH(f:material),(t:enduser) WHERE NOT (f)-[:BOUGHT]-&gt;(t) return f,t

I tried using Not clause but its showing all products
",1600083455,https://stackoverflow.com/q/63883504,user3828029,"['cql', 'database', 'neo4j', 'cypher', 'graph-databases']"
63873684,Path that contains specific nodes in the middle?,"In Cypher you can get path anchored on two nodes f.e.


     match path=(a)-[r:rel*1..5]-&gt;(b)
     where a.val = 1 and b.val = 2
     return path

the question is how can I get paths that contain say node &#39;(x) where x.val = 5&#39; in the middle, instead of all paths",1600018470,https://stackoverflow.com/q/63873684,sten,"['redisgraph', 'path', 'cypher', 'neo4j']"
63854932,How to merge nodes of the same community with Cypher in Neo4j?,"There is a graph, each of its nodes contains property `communityId` to indicate which community the node belongs to. The nodes are connected with `LINK` relationship, which contains `weight` property.

What I want is to merge those nodes of the same community into a big node. The links between those big nodes (aka. communities) must be synthesized/combined **reasonably**: the `weight` property of the link must be added up, based on individual nodes in each community connected to the other. Direction of the link must be respected.

In the result graph, I will only see connected *community* nodes.

The closest function is [Merge Nodes](https://neo4j.com/labs/apoc/4.1/graph-updates/graph-refactoring/merge-nodes/), function `apoc.refactor.mergeNodes()`. However, I&#39;m dissatisfied with the result because:

+ Problem 1: The result community nodes have self-link.
+ Problem 2: Weights of the links are not combined although the documentation says so.

Problem 1 can be fixed by writing one more Cypher to remove self-links. But problem 2 can only be tackled with low-level access to the Graph (like `mergeNodes()` above).

Is there any elegant approach to have my desired graph (*community* nodes) in **one go**? Or at least, problem 2 must be fixed somehow.

## Reproducibility

Graph:

```
CREATE (a:User {name: &quot;A&quot;, communityId: 2}), (b:User {name: &quot;B&quot;, communityId: 2}), (c:User {name: &quot;C&quot;, communityId: 2}), (x:User {name: &quot;X&quot;, communityId: 1}), (y:User {name: &quot;Y&quot;, communityId: 1}), (z:User {name: &quot;Z&quot;, communityId: 1}), (w:User {name: &quot;W&quot;, communityId: 1}), (a)-[:LINK {weight: 1}]-&gt;(b), (b)-[:LINK {weight: 1}]-&gt;(c), (c)-[:LINK {weight: 1}]-&gt;(a), (b)-[:LINK {weight: 1}]-&gt;(z), (z)-[:LINK {weight: 1}]-&gt;(x), (z)-[:LINK {weight: 1}]-&gt;(w), (w)-[:LINK {weight: 1}]-&gt;(y), (y)-[:LINK {weight: 1}]-&gt;(x), (b)-[:LINK {weight: 1}]-&gt;(w)
```

[![enter image description here][1]][1]

Cypher:

```
MATCH (n:User)
WITH n.communityId AS communityId, COLLECT(n) AS nodes
CALL apoc.refactor.mergeNodes(nodes, {
    properties: {
        name: &#39;combine&#39;,
        communityId: &#39;discard&#39;,
        weight: &#39;combine&#39;
    },
    mergeRels: true
})
YIELD node
RETURN node
```

[![enter image description here][2]][2]

## System Requirement

- Windows 8.1 x64
- Neo4j Desktop v1.3.4 (Engine v4.1.1.)
- APOC v4.1.0.2
- Graph Data Science Library v1.3.2


  [1]: https://i.stack.imgur.com/FENx4.png
  [2]: https://i.stack.imgur.com/a40RR.png",1599862320,https://stackoverflow.com/q/63854932,JoyfulPanda,"['cypher', 'graph-data-science', 'neo4j-apoc', 'neo4j']"
63851091,Cypher - Match node by properties of its connected nodes?,"We&#39;ve built a Neo4j model where each &quot;Entity&quot; node is linked to a set of &quot;Attribute&quot; nodes, each of which carrying one &quot;label&quot; and one &quot;value&quot; properties.

What would be the (most efficient) Cypher request to fetch that &quot;Entity&quot; node that has all the requested &quot;Attribute&quot; neighbours given their &quot;label&quot;/&quot;value&quot; properties?",1599842379,https://stackoverflow.com/q/63851091,Julian,"['neo4j', 'cypher']"
63846507,Neo4j subgraph of different nodes with different labels and relationship if any,"I recently started using neo4j and its query language &quot;cypher&quot; for working with building/metering data. 

My current graph database consists of different nodes (with different labels such as: point,meter,elec,equip ..etc. just to name a few), and each having different properties (not relevant in this context).

What I would like to do, is to get a sub-graph of different nodes which have different labels. For instance I would like to get all the nodes labeled as &quot;point&quot; as well as the ones labeled &quot;equip&quot; and the ones labeled as &quot;meter&quot;. To do so I tried the following query:

    MATCH (p:point)
    MATCH (e:equip)
    MATCH (m:meter)
    RETURN p, e, m

However that does not work since: **This query builds a cartesian product between disconnected patterns.**

I am trying to get these so that, if a node labeled &quot;point&quot; is connected to either an &quot;equip&quot; or &quot;meter&quot; node, I would get the relationship. If nothing is connected to the &quot;point&quot; node, it would just be stand alone. Therefore I could have one subgraph with the &quot;point&quot; to &quot;meter&quot;/&quot;equip&quot; connections and visually identify the isolated &quot;point&quot;.

I also tried something like:

    MATCH (p:point)--(e:equip)
    RETURN p,e

But that only return the &quot;point&quot; nodes which are somewhat connected to an &quot;equip&quot; node. Not giving me the isolated nodes labeled &quot;point&quot; as well.

Looking forward to your input on this (simple case I guess).

Best!",1599825002,https://stackoverflow.com/q/63846507,Thibaut ,"['neo4j', 'cypher']"
63844042,Cypher: Loop over distinct nodes in multiple paths,"I have a neo4j graph with nodes that I need to increment a flag on all of the nodes on paths from a start to end node. But I need to increment this flag only ONCE, even if it lies on multiple paths.

I use the following query, but obviously it loops through all of the paths so the flag is incremented more than once:

    MATCH paths = (end:Operation)-[DEPENDS_ON*]-&gt;(start:Operation )
           WHERE id(start) = 304
           AND end.final = true 
           UNWIND [ops IN nodes(paths)] AS op
           SET op.flag = op.flag + 1


![enter image description here](https://i.stack.imgur.com/FIeSm.jpg)

How can I unwind or collect the distinct nodes on all paths then increment the property?


",1599815396,https://stackoverflow.com/q/63844042,IamMowgoud,"['graph-databases', 'neo4j', 'cypher', 'graph']"
63839053,Neo4j handling date time values as different nodes,"I am importing a CSV file with financial data in it. How do I model the graph in such a way that the YEAR, MONTH, and DAY values are shown as three different nodes. 

    Created_Date,TransactionId
    2017-10-17 12:37:00.287,1 
    2018-03-15 02:00:48.930,2

I checked a few of documentation, and all of them helped me form just a single node.  

    LOAD CSV with headers FROM &#39;file:///filename.csv&#39; as row
    WITH apoc.date.parse(row.Created_Date, &quot;ms&quot;, &quot;yyyy-MM-dd HH:MM:SS&quot;) AS ms
    MERGE (d:Date {date: date(datetime({epochmillis: ms}))})

The structure I am looking for is more of **TransId - Year - Month - Date**. How do I manage to get this with the datetime library?",1599781999,https://stackoverflow.com/q/63839053,user8996213,"['neo4j', 'cypher', 'graph-databases']"
63829008,Neo4j cypher query - How to return path nodes but not include the nodes with identical specific properties,"I’m trying to MATCH nodes from the Neo4j database and filter the result I get from the path value with no success.

I’m currently using a query like this:

    MATCH path = (x:x)-[y:y]-&gt;(f:f) return DISTINCT nodes(path)

and the result I get is:
&gt; [{“property1”:“prop1&quot;}, {“property2”:“b”}, {“property3”:“c”}]
&gt;
&gt; [{“property1”:“prop2&quot;}, {“property2”:“b”}, {“property3”:“c”}]
&gt;
&gt; [{“property1”:“prop3&quot;}, {“property2”:“b”}, {“property3”:“c”}]

but I want the returning result to be distinct  by a pair of node properties (property2 and property3)

so the result should be only one of the three:

&gt; [{“property1”:“prop1&quot;}, {“property2”:“b”}, {“property3”:“c”}]

I don’t mind what is the value I get in “property1”, it can be any of the three.

is there a way to accomplish this?
",1599738350,https://stackoverflow.com/q/63829008,tzach,"['cypher', 'neo4j']"
63827953,How to load csv with header value that contains a cypher keyword in Neo4j,"I am loading a CSV in `neo4j` but a header value named &#39;intent&#39; is not able to load as properties in below case.

    LOAD CSV WITH HEADERS FROM &quot;filePath&quot; AS row
    CREATE (cmd:Command {name: row.command, description: row.description,}), (act:Activity {name: row.intent})

because &#39;`IN`&#39; is a keyword in Cypher I guess which is why row. The intent is not get executed properly, please help me with the issue.
Any suggestions.",1599734462,https://stackoverflow.com/q/63827953,Aman Swarnkar,"['cypher', 'neo4j', 'database', 'graph-databases']"
63811755,How to explain the execution path of this Cypher query?,"Imagine the following graph:

[![enter image description here][1]][1]

And this query:

    MATCH(p:Person {id:1})
    MATCH (p)-[:KNOWS]-(s)
    CREATE (p)-[:LIVE_IN]-&gt;(:Place {name: &#39;Some Place&#39;})

Now, why five `LIVE_IN`, `Place` are created even though `s` is not involved in the `CREATE` statement? is there any place in the docs that explain this behavior?

**Note:**  this is not about `MERGE` vs `CREATE`, although `MERGE` can solve it.

**EDIT:** In response to @Tomaz answer: I have deliberately placed `MATCH (p)-[:KNOWS]-(s)` in the query and I know how it will behave. I am asking for found explanations. For example, is `CREATE` will execute for each path or row in the matched patterns regardless of the node involved in the `CREATE`? what if you have complex matched patterns such as, disconnected graph, Trees...etc?

Also note that the direction of relationship `KNOWS` (`-` vs `-&gt;`) will effect the number of returned rows (9 vs 1), but `CREATE` will execute five times regardless of the direction.

**Update:**

I have added 3 other node `Office` and issued the following query:

    MATCH(p:Person {id:1})
    MATCH (p)-[:KNOWS]-(s)
    MATCH (o:Office)
    CREATE (p)-[:LOVE]-&gt;(:Place {name: &#39;Any Place&#39;})

And as result: 15 `LOVE` `Place` have been created, so it seems to me that cypher performs *Cartesian Product* between all nodes:

`p` refer to 1 nodes, `s` refer to 5 nodes, `o` refer to 3 nodes =&gt; 1 * 5 * 3 = 15

But I can not confirm this form neo4j docs unfortunately.


  [1]: https://i.stack.imgur.com/pZoir.png",1599654668,https://stackoverflow.com/q/63811755,adnanmuttaleb,"['insert', 'neo4j', 'cypher', 'graph']"
63809594,How can I use the `with` statement with `call.apoc.do.when` in Neo4j?,"Firstly, you can create sample nodes with following commands,

```
CREATE (t1:Title { tid: &#39;123abc&#39;})
CREATE (t2:Title { tid: &#39;123def&#39;})
CREATE (t3:Title { tid: &#39;123456&#39;})
CREATE (t4:Title { tid: &#39;123789&#39;})
CREATE (u:User { pid: &#39;456def&#39;})

CREATE (t1)-[r:TO]-&gt;(t2)
CREATE (t2)-[r:TO]-&gt;(t3)
CREATE (t3)-[r:TO]-&gt;(t4)
CREATE (u)-[r:LIKE]-&gt;(t3)
```
Here is the graph,

[![graph][1]][1]

I have a query like that in Neo4j,

```
MATCH (t1:Title)-[r:TO]-&gt;(t2:Title)
WHERE t1.tid = &#39;123abc&#39;
AND NOT exists((t2)&lt;-[:LIKE|:DISLIKE|:LOVE]-(:User {pid: &#39;456def&#39;}))
WITH COLLECT(r) AS rels
LIMIT 1

WITH rels
CALL apoc.do.when(
	SIZE(rels) &gt; 0,
    &#39;RETURN REDUCE(total = 0, x IN rels | total + x.weight) AS result&#39;,
    &#39;RETURN 0 AS result&#39;
) YIELD value
RETURN value.result
```

I want to use `rels` variable in `do.when` blog. There is a no problem for `SIZE(rels) &gt; 0` expression, but in `if statement` returns error like that,

&gt;&gt; Failed to invoke procedure `apoc.do.when`: Caused by: org.neo4j.exceptions.SyntaxException: Variable `rels` not defined (line 1, column 31 (offset: 30))
&quot;RETURN REDUCE(total = 0, x IN rels | total + x.weight) AS result&quot;

I&#39;m newbie in Neo4j. I think, there is a special case for `REDUCE`. How can I solve this problem? Thanks in advance.


  [1]: https://i.stack.imgur.com/4cbC5.png",1599646810,https://stackoverflow.com/q/63809594,E. Zeytinci,"['neo4j', 'cypher']"
63806286,why I use this cql import csv data failed?,"I try to import relationships data use csv file which contains 25000 rows , then I use this cypher:
``` 
USING PERIODIC COMMIT 500 LOAD CSV WITH HEADERS FROM &#39;http://127.0.0.1:88/static/relations/261.csv&#39; AS line  
MATCH (a:user{value:line.userId}),(b:device{value:line.deviceId})  
MERGE (a)-[rel:myrelname]-&gt;(b)  
WITH rel, COALESCE(rel.eventOccurTime, []) + line.eventOccurTime AS eventOccurTime
UNWIND eventOccurTime as r0
WITH rel, collect(distinct r0) AS unique
set rel.eventOccurTime= unique ,rel.business_name=&#39;data-test&#39; 
```
after 30 minutes ,I get this error: 
**[Neo.DatabaseError.Statement.ExecutionFailed]: Connection reset, reference 0b8a3600-d715-44bf-8c5b-4260edeab459.** 

how can I fix it ?",1599634598,https://stackoverflow.com/q/63806286,Li Eric,"['neo4j', 'cypher', 'cql']"
63796752,Move relationship between nodes and avoid duplicates,"I have a sample graph which looks like this:
[![Graph][1]][1]

So the nodes p1,p2 and p3 have see and execute entitlements on m1 and j1.
I need to move all entitlements from j1 to m1.

So the final graph should look like this:

I tried it with the query:

    MATCH (ur:Role)-[c:CAN]-&gt;(e:Entitlement)-[o:ON]-&gt;(s:Role { id:&#39;j1&#39;})
    OPTIONAL MATCH  (t:Role {id:&#39;m1&#39;})
    CREATE (e)-[o2:ON]-&gt;(t)
    set o2=o
    delete o


This works, but it also creates duplicate entitlements in the graph which I need to avoid.
[![Post Query][2]][2]

What I need is this. To avoid duplicates which are already present on m1.

[![Good graph][3]][3]

I also tried a `MERGE` instead of `CREATE` but it does not work as well.

Also, I have a restriction to not use `APOC` procedures.

  [1]: https://i.stack.imgur.com/GAVR8.png
  [2]: https://i.stack.imgur.com/KVvI6.png
  [3]: https://i.stack.imgur.com/1TdWS.png",1599577793,https://stackoverflow.com/q/63796752,Amit,"['neo4j', 'graph', 'cypher', 'database']"
63788833,Neo4j count Query,"````
match(m:master_node:Application)-[r]-(k:master_node:Server)-[r1]-(n:master_node) 
where (m.name contains &#39;&#39; and (n:master_node:DeploymentUnit or n:master_node:Schema)) 
return distinct m.name,n.name
````
Hi,I am trying to get total number of records for the above query.How I change the query using count function to get the record count directly.

Thanks in advance",1599549166,https://stackoverflow.com/q/63788833,ck22,"['neo4j', 'cypher', 'count']"
63786823,how could i use &quot;line&quot; twice?,"    LOAD CSV WITH HEADERS FROM &#39;http://127.0.0.1/static/relations/252.csv&#39; AS line  
    MATCH (a:ip{value:line.userIp}),(b:email{value:line.ucEmail})  
    MERGE (a)-[rel:mayrelations]-&gt;(b)  
    WITH rel, COALESCE(rel.spendTime, []) + line.spendTime AS spendTime
    UNWIND spendTime as r0
    WITH rel, collect(distinct r0) AS unique
    set rel.spendTime= unique  


    WITH rel, COALESCE(rel.eventOccurTime, []) + line.eventOccurTime AS eventOccurTime
    UNWIND eventOccurTime as r1
    WITH rel, collect(distinct r1) AS unique
    set rel.eventOccurTime= unique


This syntax does not work, and raises the error: &quot;Variable `line` not defined&quot;, I believe this means &#39;line&#39; variable can be used only once. How can I use it twice?
",1599536713,https://stackoverflow.com/q/63786823,Li Eric,"['cypher', 'neo4j']"
63786398,User&#39;s web path in neo4j-cypher,"I have a table with user&#39;s web path ordered by timestamp: 
```
    user_id                             from_page_id        to_page_id          event_type  timestamp
0   USER355A155307089387404434774906    pages/mine/mine     pages/mine/mine     pv          1598936406406
1   USER355A155307089387404434774906    pages/mine/mine     /pages/score/score  pv          1598936408261
2   USER355A155307089387404434774906    pages/mine/mine     pages/mine/mine     click       1598936408311
3   USER355A155307089387404434774906    pages/mine/mine     /pages/score/score  click       1598936410824
4   USER355A155307089387404434774906    pages/score/score   /pages/scoreDetai   pv          1598936410878
...
```
I would like to construct the graph of user&#39;s web path by:
```
LOAD CSV WITH HEADERS FROM &quot;file:///data.csv&quot; AS line
CREATE (p1: Page {url: line.from_page_id, user: line.user_id}), (p2: Page {url: line.to_page_id, user: line.user_id}),
(u)-[:VIEWS]-&gt;(p1), (u)-[:VIEWS]-&gt;(p2), (p1)-[:NEXT]-&gt;(p2);

MATCH (u:User), (p:Page) WHERE u.id = p.user
CREATE (u)-[:VISITS]-&gt;(p);
```
But this gives me the user&#39;s one event (click) at a time. 

[![enter image description here][1]][1]

What I want is to output the whole web path with each event/click grouped by session. For example for user ***4906 the first two lines are like one session, from third line starts a new session. We can see that fourth row ends with url (to_page_id): /pages/score/score and fifth row starts with the same url (from_page_id): pages/score/score therefor it&#39;s one session just different timestamps. 

[![enter image description here][2]][2]

How can I do that?


  [1]: https://i.stack.imgur.com/dvJKM.png
  [2]: https://i.stack.imgur.com/HyMUP.png",1599532495,https://stackoverflow.com/q/63786398,Azamat ,"['neo4j', 'cypher']"
63780655,Delete duplicate nodes between two nodes in Neo4j,"Due to unwanted scrip execution my database has some duplicate nodes and it looks like this

[![Bad Graph][1]][1]

From the image, there are multiple nodes with &#39;see&#39; and &#39;execute&#39; from p1 to m1.
I tried to eliminate them using this:

   

    MATCH (ur:Role)-[c:CAN]-&gt;(e:Entitlement{action:&#39;see&#39;})-[o:ON]-&gt;(s:Role {id:&#39;msci&#39;}) 
    WITH collect(e) AS rels WHERE size(rels) &gt; 1 
    FOREACH (n IN TAIL(rels) | DETACH DELETE n)

Resulting in this:

[![Worse Graph][2]][2]

As you can see here, it deletes all the nodes with &#39;see&#39; action.
I think I am missing something in the query which I am not sure of.
The good graph should be like this:

[![Good graph][3]][3]

EDIT: Added one more scenario with extra relations
[![Bad graph2][4]][4]


  [1]: https://i.stack.imgur.com/nHnpc.png
  [2]: https://i.stack.imgur.com/tMpKc.png
  [3]: https://i.stack.imgur.com/TVsZ0.png
  [4]: https://i.stack.imgur.com/yN1rc.png",1599493308,https://stackoverflow.com/q/63780655,Amit,"['neo4j', 'cypher', 'database', 'graph']"
63756254,neo4j - declare variables that are available for node creation in FOREACH clause and also for the RETURN clause,"I&#39;m working on neo4j graph with the following labels: Store, User, Product


the relationships are: (store)-[:OF]-&gt;(user), (product)-[:OF]-&gt;(user), (store)-[:SELL]-&gt;(product)

when adding or updating a store, products can be added, updated, attached or removed from the store.
update can be done only if the product has no attachment to other store. 

I have the following adding Store query which is working:

    OPTIONAL MATCH (user: User {id: $userId} )
    CREATE (store:Store)-[:OF]-&gt;(user)
    SET store = $store
    WITH store, user
    OPTIONAL MATCH (p: Product {id: &quot;hu1&quot;})-[:OF]-&gt;(user)  
    WITH store, p,  
    CASE WHEN NOT (:Store)-[:SELL]-&gt;(p) OR                 
    (:Store {id: &#39;12asd&#39;})-[:SELL]-&gt;(p) THEN [1]      
    ELSE [] END as array              
    FOREACH(
        x in array |              
        MERGE (p)-[:OF]-&gt;(user)          
        ON MATCH SET p += $product1         
        ON CREATE SET p = $product1         
        MERGE (store)-[:SELL]-&gt;(p)         
    ) 
    RETURN store, p

(it might seem weird that one of my condition is checking the store id, when i just created it, but this query in the code handles more situations when it is needed, and i don&#39;t wont to trouble with the whole code)

the modification needed is moving the creation of the store to the FOREACH statement because, i don&#39;t wont to create the store if one of the products didn&#39;t pass one of the CASE conditions.

i tried moving the store creation inside the FOREACH statement using MERGE -

    OPTIONAL MATCH (user: User {id: $userId} ) 
    WITH user
    OPTIONAL MATCH (p: Product {id: &quot;1&quot;})-[:OF]-&gt;(user)  
    WITH p,  
    CASE WHEN NOT (:Store)-[:ON]-&gt;(p) OR                 
    (:Store {id: &#39;st&#39;})-[:ON]-&gt;(p) 
    THEN [1]      
    ELSE [] END as array              
    FOREACH(
        x in array |              
        MERGE (p)-[:OF]-&gt;(user)          
        ON MATCH SET p += $product1         
        ON CREATE SET p = $product1         
        MERGE (store:Store {id: &#39;st&#39;})
        ON MATCH SET store += $store         
        ON CREATE SET store = $store         
        MERGE (store)-[:ON]-&gt;(p)         
    ) 
    RETURN store, p 


but i got this error: 

&gt; Neo4jError: Variable `store` not defined

pointing on the `store` variable in the RETURN statement.


i tried adding another WITH statement between the FOREACH and the RETURN but i got the same error only pointing on the store variable in the WITH clause.

how can i declare a variable out side of the FOREACH clause so i could create node for it in the FOREACH and also use it in the RETURN ?",1599324085,https://stackoverflow.com/q/63756254,Itay Tur,"['cypher', 'neo4j-driver', 'neo4j']"
63748325,Finding the &quot;GAP&quot; in node values ? or next?,"Let say I have a nodes with values a multiples of 10. I want to find the first GAP in the values.
Here is how I would do it in numpy :


     &gt; np.where(np.diff([11,21,31,51,61,71,91]) &gt; 10)[0][0] + 2
     &gt; 4  i.e. 41

How would I do this in Cypher... ?

     match (n) where n.val % 10 = 1
     with n.val
     order by val ....???

I&#39;m using RedisGraph.

PS&gt;
  if no GAP it should return the next value i.e. biggest + 10, if possible !",1599255660,https://stackoverflow.com/q/63748325,sten,"['neo4j', 'redisgraph', 'cypher']"
63740817,Neo4j - Filter on the basis of multiple types of relationships,"If

    match(d:person)-[r]-(e:person)

and r could be of many types such as `KNOWS, FRIEND_OF, LIKES, DISLIKES`
and I would like to filter only those relationships of `KNOWS` and `DISLIKES`, then how should I express this in cypher?

I know that for a single relationship type, it goes like this

    match(d:person)-[r:KNOWS]-(e:person)

but I would like to do it for multiple relationship types",1599220904,https://stackoverflow.com/q/63740817,Abbas Gadhia,"['cypher', 'neo4j']"
63729121,apoc.periodic.iterate fails the batch if there is an duplicate data in parameter,"I am using an apoc.periodic.iterate query to store millions of data . Since the data may contain duplicates I am using MERGE action to create nodes but unfortunately whenever the data is duplicated the whole batch is getting with error like this 

&quot;LockClient[200] can&#39;t wait on resource RWLock[NODE(14), hash=1645803399] since =&gt; LockClient[200] &lt;-[:HELD_BY]- RWLock[NODE(101)&quot;

 - Changing parallel as false works fine 
 - Also by removing duplicates the query is passed successfully 

But both of the above solution takes more time since dealing with millions of data . Is there any alternate solution like making a it to wait for the lock ",1599155274,https://stackoverflow.com/q/63729121,Mahesh Khanna,"['cypher', 'neo4j-apoc', 'neo4j']"
63724796,How can you insert a nested list into neo4j (cypher query language) with a direct relationship,"I want to insert a multi level list into neo4j 4.1.1 via cypher query language.

The data I want to insert is a list of reports returned in json. One of the properties is the models behind the report. I would like to make a node for each report in my list + a node for every model on the given report and add a relationship between the report and the model (given on the report). This will be a daily data refresh, so I would like to create new report nodes if they do not exist in the neo4j database, if the report already exist I want to overwrite the data in case we have new information.

Example data:
```
[
    {
        &quot;name&quot;: &quot;Report 1&quot;,
        &quot;description&quot;: &quot;Report Description&quot;,
        &quot;createdBy&quot;: &quot;TRAINING1&quot;,
        &quot;id&quot;: &quot;04CA095985D9A838E10000000A4E740E&quot;,
        &quot;created&quot;: &quot;2020-02-14T14:27:56.371Z&quot;,
        &quot;changed&quot;: &quot;2020-02-14T14:27:56.371Z&quot;,
        &quot;isTemplate&quot;: false,
        &quot;isSample&quot;: false,
        &quot;models&quot;: [
            {
                &quot;description&quot;: &quot;Model 1&quot;,
                &quot;id&quot;: &quot;id of the model&quot;,
                &quot;isPlanning&quot;: true
            },
            {
                &quot;description&quot;: &quot;Model 2&quot;,
                &quot;id&quot;: &quot;id of the model&quot;,
                &quot;isPlanning&quot;: true
            },
            {
                &quot;description&quot;: &quot;Model 3&quot;,
                &quot;id&quot;: &quot;id of the model&quot;,
                &quot;isPlanning&quot;: true
            },
          
        ],
        &quot;changedBy&quot;: &quot;TRAINING1&quot;,
        &quot;openURL&quot;: &quot;URL of the report&quot;
    },
     {
        &quot;name&quot;: &quot;Report 2&quot;,
        &quot;description&quot;: &quot;Report Description&quot;,
        &quot;createdBy&quot;: &quot;TRAINING1&quot;,
        &quot;id&quot;: &quot;0653F758E5264C49E10000000A4E740E&quot;,
        &quot;created&quot;: &quot;2020-02-14T14:27:56.371Z&quot;,
        &quot;changed&quot;: &quot;2020-02-14T14:27:56.371Z&quot;,
        &quot;isTemplate&quot;: false,
        &quot;isSample&quot;: false,
        &quot;models&quot;: [
            {
                &quot;description&quot;: &quot;Model description&quot;,
                &quot;id&quot;: &quot;id of the model&quot;,
                &quot;isPlanning&quot;: true
            },
            {
                &quot;description&quot;: &quot;Model description&quot;,
                &quot;id&quot;: &quot;id of the model&quot;,
                &quot;isPlanning&quot;: true
            },
            {
                &quot;description&quot;: &quot;Model description&quot;,
                &quot;id&quot;: &quot;id of the model&quot;,
                &quot;isPlanning&quot;: true
            },
          
        ],
        &quot;changedBy&quot;: &quot;TRAINING1&quot;,
        &quot;openURL&quot;: &quot;URL of the report&quot;
    },
    {
        &quot;name&quot;: &quot;Report Name 3&quot;,
        &quot;description&quot;: &quot;Report description 3&quot;,
        &quot;createdBy&quot;: &quot;TRAINING1&quot;,
        &quot;id&quot;: &quot;0653F758E5264C49E10000000A4E740E&quot;,
        &quot;created&quot;: &quot;2020-02-14T14:27:55.010Z&quot;,
        &quot;changed&quot;: &quot;2020-02-14T14:27:55.010Z&quot;,
        &quot;isTemplate&quot;: false,
        &quot;isSample&quot;: false,
        &quot;models&quot;: [
            {
                &quot;description&quot;: &quot;description of the model&quot;,
                &quot;id&quot;: &quot;id of the model&quot;,
                &quot;isPlanning&quot;: true
            },
            {
                &quot;description&quot;: &quot;model description&quot;,
                &quot;id&quot;: &quot;this is an id&quot;,
                &quot;isPlanning&quot;: true
            },
            {
                &quot;description&quot;: &quot;model description&quot;,
                &quot;id&quot;: &quot;this is an id&quot;,
                &quot;isPlanning&quot;: true
            }
        ],
        &quot;changedBy&quot;: &quot;TRAINING1&quot;,
        &quot;openURL&quot;: &quot;URL of the report&quot;
    }
]
```
The graph I would like to become is the following:
[Example graph][1]


  [1]: https://i.stack.imgur.com/7eTZJ.png

The query I tried was the following:
```
UNWIND $propsArray as props
      MERGE (sac:sacreports { id: props.id })
        ON CREATE
          SET sac = {id: props.id, name: props.name }
          UNWIND props.models as model
          MERGE (m: sacmodels {id: model.id})
          ON CREATE SET m = {id: model.id, description: model.description }
          ON MATCH SET m = {id: model.id, description: model.description }
        ON MATCH 
          SET sac = {id: props.id, name: props.name, description: props.description }
          UNWIND props.models as model
          MERGE (m: sacmodels {id: model.id})
          ON CREATE SET m = {id: model.id, description: model.description }
          ON MATCH SET m = {id: model.id, description: model.description }
          
      RETURN sac
```
I get the following error: Neo4jError: WITH is required between MERGE and UNWIND (line 7, column 11 (offset: 181)).

Any suggestion on how to perform this operation?

Thanks in advance!",1599140032,https://stackoverflow.com/q/63724796,BrechtArnou,"['neo4j', 'cypher']"
63721385,Get neo4j&#39;s internal unique ID with cyper and assign it to my object,"I&#39;m creating a new object like this, which has at this point a placeholder id:
```
    var query = client.Cypher
    .Create(&quot;(e:Example{newExample})&quot;)
    .WithParam(&quot;newExample&quot;, newExample)
    .Return(e =&gt;  e.As&lt;Example&gt;())
    .Results;
```

But my object needs a unique id, which I need to request it from the server etc. Neo4j has internally a unique id for all nodes. Is there a way to retrieve this id from neo4j and assign it to my object id?

I&#39;ve read, that this is generally a bad idea since the id&#39;s could be reused from neo4j after a node has been removed. But since the object with this node id was this node, the id doesn&#39;t exist anymore for me also. So I don&#39;t see what stands against this.

Otherwise I can use GUID I know about that way.",1599127711,https://stackoverflow.com/q/63721385,TobiasW,"['.net', 'neo4j', 'cypher']"
63719910,Create a social network csv in neo4j / Connections with a timestamp,"First of, I checked previous questions and found some answers but couldn&#39;t transfer the solution to my exact problem. The question which comes the closest to my problem is [this one here.][1]

**My problem:**

I have a large *.csv* file which contains interactions from different **ids** with a **timestamp**. The columns are *source*, *target* and *servertime* and a row looks like this:

&gt; B_655, B_632, 2020-07-03 00:11:48.828

As the different devices measure the connections in both directions it is common that the same connection but with switched source and target occure at nearly the same time:

&gt; B_632, B_655, 2020-07-03 00:11:47.258

Also the different devices measure every 15s, therefore a longer connection (an interaction which lasted 45s) will have 3 different rows.

&gt; B_655, B_632, 2020-07-03 00:11:48.828  
B_655, B_632, 2020-07-03 00:12:03.828  
B_655, B_632, 2020-07-03 00:12:18.828

I know want to have all of this data in my Neo4j database and have bigger weights on the connections between two ids (source &amp; target) which occured more often, but also be able to investigate the graph with regard to the time. For example I want to query how many new connection id *B_649* had between date X and date y.

**The IDs are unique but as I stated earlier they can appear in the source-column as well as in the target-column.**

In was able to read in the data in neo4J browser but struggled with establishing the connection. A Cypher-Query which worked to read my csv file was as follows:

&lt;!-- begin snippet: js hide: false console: true babel: false --&gt;

&lt;!-- language: lang-html --&gt;

    LOAD CSV WITH HEADERS FROM &#39;file:///connections.csv&#39; AS row
    WITH row.source as sourcetag, datetime(replace(row.servertime, &#39; &#39;, &#39;T&#39;)) as timestamp, row.target as beacon
    RETURN timestamp, sourcetag, beacon
    limit 3

&lt;!-- end snippet --&gt;

Does somebody know a way to import such a social-network into neo4j?
Many thanks in advance!

  [1]: https://stackoverflow.com/questions/39841928/how-to-import-social-network-relation-csv-dict-of-list-file-into-neo4j-graph-d",1599122333,https://stackoverflow.com/q/63719910,maximusKarlson,"['neo4j', 'cypher', 'social-networking', 'csv', 'import']"
63714375,Cannot access property of nodes returned from schema procedure call,"
I want to view the schema of my graph (Neo4j v4.1.1) that has a large number of labels and relationship types. I am working on a query to specify the labels of interest so that the result is less crowded.

    CALL db.schema.visualization() YIELD nodes, relationships 
    UNWIND nodes AS n 
    UNWIND relationships AS r 
    RETURN n, r

But I can&#39;t access any of the properties of the nodes and relationships returned by the procedure call. I have tried:
- `n.labels`
- `n[&quot;labels&quot;]`
- `keys(n)`
- `properties(n)`
- `labels(n)`

All of the above return either empty or null values. How can I access these properties so that I can filter the schema results by label?
",1599086168,https://stackoverflow.com/q/63714375,recentadvances,"['cypher', 'neo4j']"
63714108,Neo4j cypher query to delete child and grandchild nodes of a a specific node,"I’m looking for a cypher query to include in python module where I’m trying to delete a the nodes and sub nodes along with relationships of them if one specific node property matches. 
For example, if Node match I found is 
match (n) where n.name = ‘parent’ 
Then I want to delete all the nodes/relationships connected to that specific node along with sub-nodes and their relationships of those nodes I am trying to delete .

Sample Data : https://photos.app.goo.gl/5PPnNSLVRKvJzm6a8

So, basically I am looking for the query which will delete all the nodes(N1 to N8) after parents node (PN1) and associated relationships. So PN1 and rest of other nodes having incoming relationships will stay.
",1599084210,https://stackoverflow.com/q/63714108,CodeSwat,"['cypher', 'neo4j', 'python']"
63702351,Is variable length relationship is traversed in BFS manner in Neo4j?,"If we have the following graph:

[![enter image description here][1]][1]

And the following query:

    MATCH (me)-[:KNOWS*1..2]-(remote_friend)
    WHERE me.name = &#39;Filipa&#39;
    RETURN remote_friend.name

Is `&quot;Dilshad&quot;` guaranteed to be returned before `&quot;Anders&quot;`, in other words, is `:KNOWS*1..2` guaranteed to be traversed in BFS manner?

  [1]: https://i.stack.imgur.com/65IIf.png",1599037874,https://stackoverflow.com/q/63702351,adnanmuttaleb,"['cypher', 'breadth-first-search', 'neo4j', 'graph']"
63702268,Merging Nodes in Neo4j,"I am trying merge two neo4j graphs using CYPHER. The first one is the example of Countries and their Capitals. The second one is a sample example I created. 

    WITH &quot;https://gist.githubusercontent.com/jimmycrequer/7aa867900d0cf0b9588d4354f09cb286/raw/countries.json&quot; AS url
    CALL apoc.load.json(url) YIELD value AS v
    MERGE (c:Country {name: v.name})
    SET c.population = v.population, c.area = v.area
    CREATE (capital:City {name: v.capital})
    CREATE (c)&lt;-[:IS_CAPITAL_OF]-(capital)
    FOREACH (n IN v.neighbors |
      MERGE (neighbor:Country {name: n})
      MERGE (c)-[:IS_NEIGHBOR_OF]-(neighbor)
    )

To this, I&#39;m trying to add my graph
//Manufacturers

    MERGE (BMW:Manufacturer {name:&quot;BMW&quot; , headquarters :&quot;Germany&quot; , employees :100306,factories:25 ,revenue:95.8 ,production:1668982 ,sales: 1688982 })
    MERGE(Germany:Country)-[:MANUFACTURERS]-&gt;(BMW)

The Node Germany has the following properties

    id:103, area:357022, name:Germany, population:8288000

When, I try to look for the final output. I see there is an empty blank node created for the relationship [:MANUFACTURERS] and a node `BMW` is created.[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/qJCal.png",1599037559,https://stackoverflow.com/q/63702268,Betafish,"['cypher', 'neo4j']"
63691017,Quicker way to write a dict to a neo4j database using python,"I have a dict and a cypher query with placeholders. My code currently works:

    def set_dict(self, tx, my_dict):
        for i, j in my_dict.items():
            tx.run(&quot;MERGE (n:property_1 {i: $i})
            SET n.j = $j; &quot;,
            i=i, j=j)


This works, but rather than looping through and executing `tx.run`, is there a more pythonic/faster was of executing a dict as a placeholder in a CQL string?

",1598974845,https://stackoverflow.com/q/63691017,pymat,"['cypher', 'python', 'python-3.x', 'neo4j']"
63686724,How do I use Louvain Algorithm with cypher projection?,"I try to use the Louvain Algorithm with a cypher projection:

```
CALL algo.beta.louvain.stream(
&#39;MATCH (t:Tag)
    WHERE EXISTS(t.count_primaryTag_2019)
    OR EXISTS(t.count_secondaryTag_2019)
    RETURN  id(t) AS id&#39;,
&#39;MATCH (n:Tag)-[c:CONNECTED_TO]-(m:Tag) 
    WHERE EXISTS(c.count_question_2019)
    RETURN id(n) AS source, id(m) AS target&#39;,
{graph:&#39;cypher&#39;, direction:&#39;BOTH&#39;})
```
My understanding of this sub-graph is, that it should be undirected and therefor I use de &quot;direction: &#39;BOTH&#39;&quot;.
But after executing the query I get the following error:
```
Neo.ClientError.Procedure.ProcedureCallFailed
Failed to invoke procedure `algo.beta.louvain.stream`: Caused by: java.lang.IllegalArgumentException: Incompatible directions between loaded graph and requested compute direction. Load direction: &#39;OUTGOING&#39; Compute direction: &#39;BOTH&#39;
```


----------


My thought process was, that while building the sub-graph with the cypher projection, it creates two directed relationships for each connected node. Something like this:

&gt; (A)--&gt;(B); (A)&lt;--(B)

And therefore we have a &quot;semi-undirected&quot; graph and therefore the Louvain Algorithm can only be executed with the &#39;OUTGOING&#39; direction while working with cypher-projections.

So I tried to run the algorithm while setting the direction to &#39;OUTGOING&#39;:
```
CALL algo.beta.louvain.stream(
&#39;MATCH (t:Tag)
    WHERE EXISTS(t.count_primaryTag_2019)
    OR EXISTS(t.count_secondaryTag_2019)
    RETURN  id(t) AS id&#39;,
&#39;MATCH (n:Tag)-[c:CONNECTED_TO]-(m:Tag) 
    WHERE EXISTS(c.count_question_2019)
    RETURN id(n) AS source, id(m) AS target&#39;,
{graph:&#39;cypher&#39;, direction:&#39;OUTGOING&#39;})
 ```
&lt;s&gt;Now I don&#39;t produce an error. Instead, no communities are getting generated at all.&lt;/s&gt;
Now I can generate communities, but I am not certain if it is correct, what I am doing. (edited)


----------

**Finally my question:**
How can I use cypher-projection with the Louvain Algorithm in Neo4j? The created sub-graph has to be undirected.",1598959556,https://stackoverflow.com/q/63686724,Moritz Kampfinger,"['cypher', 'neo4j']"
63686233,Cypher - How to sum edge weight for each node,"Suppose to have the following DB:

    create (a:fooNode{name:&#39;A&#39;}),(b:fooNode{name:&#39;B&#39;}),(c:fooNode{name:&#39;C&#39;}),(d:fooNode{name:&#39;D&#39;}),(e:fooNode{name:&#39;E&#39;}),(p1:pNode{name:&#39;p1&#39;}),(p2:pNode{name:&#39;p2&#39;}),(a)-[e1:Edge{w:10}]-&gt;(p1),(b)-[e2:Edge{w:30}]-&gt;(p1),(c)-[e3:Edge{w:25}]-&gt;(p1),(d)-[e4:Edge{w:15}]-&gt;(p2),(e)-[e5:Edge{w:20}]-&gt;(p2), (source:fooNode{name:&#39;Node 0&#39;}), (source)-[:Edge]-&gt;(a), (source)-[:Edge]-&gt;(b), (source)-[:Edge]-&gt;(c), (source)-[:Edge]-&gt;(d), (source)-[:Edge]-&gt;(e)

This image should clarify the idea.
[![enter image description here][1]][1]

Now I&#39;m interested in having as result the sum of the incoming nodes&#39; weight per &#39;pNode&#39;. Something like:*[
p1: 65,
p2: 35]*

Please notice that ***I cannot know the names of the nodes in advance***, except for the source node, called &#39;Node 0&#39; in the example DB. Firstly, i thought about computing the path from &#39;Node 0&#39; to whichever &#39;pNode&#39;, but I don&#39;t know how to procede further.


  [1]: https://i.stack.imgur.com/Nf2Bw.png",1598957550,https://stackoverflow.com/q/63686233,Daniele Buonadonna,"['path-finding', 'neo4j', 'cypher']"
63670902,Using UNWIND and CREATE to create multiple relationships,"I have the following query:

    UNWIND [100, 200, 300] AS CODENUM
    MATCH (system1:System), (group1:SystemGroup)
    WHERE system1.Name = &#39;Main&#39; AND group1.Name = &#39;MainGroup&#39;
    CREATE (system1)-[:CODE_CODENUM]-&gt;(group1)

it creates 3 relationships, but the name remains the same for all - CODE_CODENUM 

I want CODE_100, CODE_200, CODE_300
How to achieve this?

I tried wrapping CODENUM in curely brackets but I get error:

    Neo.ClientError.Statement.ParameterMissing: Expected Parameter(s): CODENUM

",1598877162,https://stackoverflow.com/q/63670902,Decard Cain,"['neo4j', 'cypher', 'database']"
63666886,not clause in neo4j as recommendation engine,"I am able to create relationship between material and the enduser who bought it using below code

    match (n:demodb)
    merge (f:material {id:n.material})
    merge (t:enduser {id:n.endUser})
    create (f)-[r:BOUGHT]-&gt;(t) return f,t limit 100;

but now I want to find materials not bought by enduser and show as recommendation engine in graph. I am new to cypher and Neo4J . please suggest

I tried using Not clause but its not working or may be I am missing",1598860472,https://stackoverflow.com/q/63666886,user3828029,"['graph', 'cypher', 'database', 'neo4j']"
63666375,Could I use neo4j gds shortest path algorithm with multiplication instead of addition?,"I use neo4j database to calculate the shortest path between nodes.The whole graph include 400K nodes.I could use the shortestPath algorithm like below when I calculate the weight with addition operation, but how should I do if I wants to use multiplication operation to calculate the weight the nodes?
```
MATCH (sourceNode:entity{name: $name}) 
CALL gds.alpha.shortestPath.deltaStepping.stream({
     startNode: sourceNode, 
     nodeProjection: &quot;*&quot;, 
     relationshipProjection: {
         all: {
         type: &quot;*&quot;, 
         properties: &quot;weight&quot;,
         orientation: &quot;UNDIRECTED&quot; 
         } 
     }, 
     relationshipWeightProperty: &quot;weight&quot;, 
     delta: 1.0 
     })
YIELD nodeId, distance 
WHERE gds.util.isFinite(distance) 
RETURN sourceNode.name, 
       gds.util.asNode(nodeId).name AS aim_entity,
       distance 
ORDER BY distance;
```",1598858220,https://stackoverflow.com/q/63666375,YayangLee,"['neo4j', 'neo4j-apoc', 'cypher', 'graph-data-science']"
63663535,Neo4j imports zero records from csv,"I am new to Neo4j and graph database. While trying to import a few relationships from a CSV file, I can see that there are no records, even when the file is filled with enough data.

    LOAD CSV with headers FROM &#39;file:/graphdata.csv&#39; as row WITH row
    WHERE row.pName is NOT NULL
    MERGE(transId:TransactionId)
    MERGE(refId:RefNo)
    MERGE(kewd:Keyword)
    MERGE(accNo:AccountNumber {bName:row.Bank_Name, pAmt:row.Amount, pName:row.Name})

 
Followed by:

    LOAD CSV with headers FROM &#39;file/graphdata.csv&#39; as row WITH row
    WHERE row.pName is NOT NULL
    MATCH(transId:TransactionId)
    MATCH(refId:RefNo)
    MATCH(kewd:Keyword)
    MATCH(accNo:AccountNumber {bName:row.Bank_Name, pAmt:row.Amount, pName:row.Name})
    MERGE(transId)-[:REFERENCE]-&gt;(refId)-[:USED_FOR]-&gt;(kewd)-[:AGAINST]-&gt;(accNo)
    RETURN *

 
Edit (table replica): 



    TransactionId	Bank_Name	RefNo	Keyword	Amount	AccountNumber	AccountName
    12345	           ABC	     78	       X	 1000	    5421	     WE
    23456	           DEF	     	       X	 2000	    5471	 
    34567	           ABC	     32	       Y	 3000	    4759	     HE

Is it likely the case that the Nodes and relationships are not created at all? How do I get all these desired relationships?




",1598835714,https://stackoverflow.com/q/63663535,user8996213,"['neo4j', 'cypher']"
63660923,RedisGraph: Merge nodes and move all the reletionships?,"In RedisGraph using Cypher/python is there a way to

 Merge two nodes and move all the relationships from the old node to the new node ?

I suspect there are no pure Cypher solution... in that case what will be the equivalent atomic operations and how to combine them to achieve MERGE-nodes+rel

neo4j have apoc.refactor.mergeNodes(nodes, options), apoc.refactor.mergeRelationships(rels, options), but that doesn&#39;t help me !:(  because I&#39;m using RedisGraph.

the problem is that in RG I dont have lower level access to do enumeration/iteration to do this programmatically !!


-----------

this worked in one direction I have to apply -&gt; the reverse &lt;- second time.

	    MATCH (old)-[r:q]-&gt;(from_to)
		WHERE old.val = $old
		MATCH (new) WHERE new.val = $new
		MERGE (new)-[nr2:q]-&gt;(from_to)
		SET nr2.val = r.val
		DELETE r

any way to combine it in single query ?",1598812785,https://stackoverflow.com/q/63660923,sten,"['redisgraph', 'cypher', 'graph-databases', 'graph']"
63649859,Optimizing a Cypher query to analyze topology in a network,"I have a network (e.g. a water network) and I want to find topological structures :  clusters (circular paths), bridges (relationships that connect clusters) and trees (the remaining).

[![network][1]][1]

The Cypher statement to create the example network is here.(https://www.dropbox.com/s/e1gtqxlm9ngaau5/Cypher%20to%20create%20example%20network.cql?dl=0) The blue relationships are the clusters I am looking for, the red ones the bridges and the green ones the trees.


To find the clusters, I have two approaches, both of which return the correct results. But both are far too slow.

Approach 1:
Start from the relations and look if there is a second path between the start and end node.
This one takes about 10M db hits

```
MATCH (n:WN)-[r:PIPE]-&gt;(m:WN) 
WHERE EXISTS((n)-[r]-&gt;(m)-[:PIPE*2..]-(n))
RETURN r
```


Approach 2:
Start by looking for circular paths, ignoring directions. (about 12000) and then extract the unique relationships.
This one takes about 20M db hits.


```
MATCH path=(n:WN)-[:PIPE*..]-(n)
RETURN 
     apoc.coll.subtract(
	      apoc.coll.flatten(COLLECT(relationships(path))
		  ),
		  []
	 )
	AS clusterRelationships

```

Is there a smarter approach, returning results faster?

  [1]: https://i.stack.imgur.com/KkFrc.png",1598721919,https://stackoverflow.com/q/63649859,Graphileon,"['neo4j', 'topology', 'cypher']"
63641001,conditional creations of relations?,"I have a query to move relations, but if there are existing target relations they are not replaced, so I end up with two similar connections.


        match (new:state) where new.val = {new}
		match (b:state)-[r1:q]-&gt;(p:state)-[r2:q]-&gt;(n:state)
		where b.val = {blast} and p.val = {past} and n.val = {now}
		merge (b)-[nr1:q]-&gt;(new)-[nr2:q]-&gt;(n)
		set nr1.val = r1.value, nr2.val = r2.val
		delete r1, r2

if (b)-[:q]-&gt;(new) exists, nr1 does not override it, but creates new relation, so I end up with two .

I want to create nr1 or nr2 if r1 or r2 are not yet present and if present sum the values, otherwise just copy them",1598649707,https://stackoverflow.com/q/63641001,sten,"['redisgraph', 'cypher']"
63625790,Neo4j ego network (query optimization),"I would like to query the ego network of a given node. My current code takes almost 1 sec. on a database with 42k nodes and 2 million edges to return 4k rows. This seems extremely slow. How can I optimize it?

There is an unique constraint/index on Topic.name.

The query:

```
match (n:Topic)-[e]-(m: Topic) 
where n.name = &#39;raman&#39;
with collect(m.name) as ms, n
match (m1:Topic)-[e]-(m2:Topic)
where (m1.name in ms or m1.name = n.name) and (m2.name in ms or m2.name = n.name) and m1.name &lt; m2.name
return m1.name, m2.name, e.weight;
```

The execution profile:

```
Query executed in 842ms. Query type: READ_ONLY.
Profile:
----------&gt; NodeUniqueIndexSeek@neo4j[records: 1; dbHits: 2] {identifiers: [n]; arguments: {Order=&quot;n.name ASC&quot;, PageCacheHitRatio=0.0, Details=&quot;UNIQUE n:Topic(name) WHERE name = $autostring_0, cache[n.name]&quot;, PageCacheMisses=0, EstimatedRows=1.0, DbHits=2, Rows=1, PageCacheHits=0}}
---------&gt; Expand(All)@neo4j[records: 179; dbHits: 180] {identifiers: [n, e, m]; arguments: {Order=&quot;n.name ASC&quot;, PageCacheHitRatio=0.0, Details=&quot;(n)-[e]-(m)&quot;, PageCacheMisses=0, EstimatedRows=95.69165595671438, DbHits=180, Rows=179, PageCacheHits=0}}
--------&gt; Filter@neo4j[records: 179; dbHits: 179] {identifiers: [n, e, m]; arguments: {Order=&quot;n.name ASC&quot;, PageCacheHitRatio=0.0, Details=&quot;m:Topic&quot;, PageCacheMisses=0, EstimatedRows=95.69165595671438, DbHits=179, Rows=179, PageCacheHits=0}}
-------&gt; EagerAggregation@neo4j[records: 1; dbHits: 179] {identifiers: [n, ms]; arguments: {PageCacheHitRatio=0.0, Details=&quot;n, collect(m.name) AS ms&quot;, Memory=11448, PageCacheMisses=0, EstimatedRows=9.782211199760225, DbHits=179, Rows=1, PageCacheHits=0}}
----------&gt; NodeUniqueIndexSeek@neo4j[records: 179; dbHits: 358] {identifiers: [n, ms, m1]; arguments: {PageCacheHitRatio=0.0, Details=&quot;UNIQUE m1:Topic(name) WHERE name IN ms, cache[m1.name]&quot;, PageCacheMisses=0, EstimatedRows=244.48469730942983, DbHits=358, Rows=179, PageCacheHits=0}}
----------&gt; NodeUniqueIndexSeek@neo4j[records: 1; dbHits: 3] {identifiers: [n, ms, m1]; arguments: {PageCacheHitRatio=0.0, Details=&quot;UNIQUE m1:Topic(name) WHERE name = cache[n.name], cache[m1.name]&quot;, PageCacheMisses=0, EstimatedRows=9.782211199760225, DbHits=3, Rows=1, PageCacheHits=0}}
---------&gt; Union@neo4j[records: 180; dbHits: 0] {identifiers: [n, ms, m1]; arguments: {PageCacheHitRatio=0.0, PageCacheMisses=0, EstimatedRows=254.26690850919005, DbHits=0, Rows=180, PageCacheHits=0}}
--------&gt; Distinct@neo4j[records: 180; dbHits: 0] {identifiers: [n, ms, m1]; arguments: {PageCacheHitRatio=0.0, Details=&quot;n, ms, m1&quot;, Memory=2143856, PageCacheMisses=0, EstimatedRows=254.2610272318913, DbHits=0, Rows=180, PageCacheHits=0}}
----------&gt; NodeUniqueIndexSeek@neo4j[records: 32220; dbHits: 64440] {identifiers: [n, ms, m2]; arguments: {PageCacheHitRatio=0.0, Details=&quot;UNIQUE m2:Topic(name) WHERE name IN ms, cache[m2.name]&quot;, PageCacheMisses=0, EstimatedRows=244.48469730942983, DbHits=64440, Rows=32220, PageCacheHits=0}}
----------&gt; NodeUniqueIndexSeek@neo4j[records: 180; dbHits: 540] {identifiers: [n, ms, m2]; arguments: {PageCacheHitRatio=0.0, Details=&quot;UNIQUE m2:Topic(name) WHERE name = cache[n.name], cache[m2.name]&quot;, PageCacheMisses=0, EstimatedRows=9.782211199760225, DbHits=540, Rows=180, PageCacheHits=0}}
---------&gt; Union@neo4j[records: 32400; dbHits: 0] {identifiers: [n, ms, m2]; arguments: {PageCacheHitRatio=0.0, PageCacheMisses=0, EstimatedRows=254.26690850919005, DbHits=0, Rows=32400, PageCacheHits=0}}
--------&gt; Distinct@neo4j[records: 32400; dbHits: 0] {identifiers: [n, ms, m2]; arguments: {PageCacheHitRatio=0.0, Details=&quot;n, ms, m2&quot;, Memory=2143856, PageCacheMisses=0, EstimatedRows=254.2610272318913, DbHits=0, Rows=32400, PageCacheHits=0}}
-------&gt; CartesianProduct@neo4j[records: 32400; dbHits: 0] {identifiers: [n, ms, m1, m2]; arguments: {PageCacheHitRatio=0.0, PageCacheMisses=0, EstimatedRows=6608.799242711218, DbHits=0, Rows=32400, PageCacheHits=0}}
------&gt; Apply@neo4j[records: 32400; dbHits: 0] {identifiers: [n, ms, m1, m2]; arguments: {PageCacheHitRatio=0.0, PageCacheMisses=0, EstimatedRows=0.45638084942956914, DbHits=0, Rows=32400, PageCacheHits=0}}
-----&gt; CacheProperties@neo4j[records: 32400; dbHits: 0] {identifiers: [n, ms, m1, m2]; arguments: {PageCacheHitRatio=0.0, Details=&quot;cache[m2.name], cache[m1.name]&quot;, PageCacheMisses=0, EstimatedRows=0.45638084942956914, DbHits=0, Rows=32400, PageCacheHits=0}}
----&gt; Expand(Into)@neo4j[records: 7848; dbHits: 5431444] {identifiers: [e, m2, n, m1, ms]; arguments: {PageCacheHitRatio=0.0, Details=&quot;(m1)-[e]-(m2)&quot;, Memory=2688168, PageCacheMisses=0, EstimatedRows=15.21306094348127, DbHits=5431444, Rows=7848, PageCacheHits=0}}
---&gt; Filter@neo4j[records: 3924; dbHits: 0] {identifiers: [e, m2, n, m1, ms]; arguments: {PageCacheHitRatio=0.0, Details=&quot;cache[m1.name] &lt; cache[m2.name]&quot;, PageCacheMisses=0, EstimatedRows=0.45638084942956914, DbHits=0, Rows=3924, PageCacheHits=0}}
--&gt; Projection@neo4j[records: 3924; dbHits: 3924] {identifiers: [e, m2, n, `e.weight`, m1, `m2.name`, ms, `m1.name`]; arguments: {PageCacheHitRatio=0.0, Details=&quot;cache[m1.name] AS `m1.name`, cache[m2.name] AS `m2.name`, e.weight AS `e.weight`&quot;, PageCacheMisses=0, EstimatedRows=0.45638084942956914, DbHits=3924, Rows=3924, PageCacheHits=0}}
-&gt; ProduceResults@neo4j[records: 3924; dbHits: 0] {identifiers: [e, m2, n, `e.weight`, m1, `m2.name`, ms, `m1.name`]; arguments: {PageCacheHitRatio=0.0, GlobalMemory=6986840, planner-impl=&quot;IDP&quot;, runtime=&quot;INTERPRETED&quot;, runtime-impl=&quot;INTERPRETED&quot;, version=&quot;CYPHER 4.1&quot;, DbHits=0, Details=&quot;`m1.name`, `m2.name`, `e.weight`&quot;, planner-version=&quot;4.1&quot;, runtime-version=&quot;4.1&quot;, PageCacheMisses=0, EstimatedRows=0.45638084942956914, planner=&quot;COST&quot;, Rows=3924, PageCacheHits=0}}
```

[![enter image description here][1]][1]


Thanks!


  [1]: https://i.stack.imgur.com/l5Q8i.png",1598574047,https://stackoverflow.com/q/63625790,CC.,"['graph-databases', 'neo4j', 'cypher']"
63621573,Get shortest circle path without repeating any nodes,"I need a query that will get me the shortest circle path between nodes (so if there are multiple paths just returns the shortest one). In addition, these paths shouldn&#39;t contain repeated nodes. Examples:

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/wxR7I.png

In this case, if I pass &quot;Item B&quot; as input, I should receive the path &quot;Item B -&gt; Item C -&gt; Item E -&gt; Item B&quot; since the other path &quot;Item B -&gt; Item C -&gt; Item A -&gt; Item C -&gt; Item E - Item B&quot; not only is longer but also contains repeated nodes (Item C)

Using the same picture, if I pass &quot;Item A&quot; as input, I should receive the path &quot;Item A -&gt; Item C  -&gt; Item A&quot;

In addition, it would be nice if the response could include all the nodes involved, without repeating the starting and final node that is the same in all cases.

Thanks in advance!",1598550417,https://stackoverflow.com/q/63621573,Nicolas,"['neo4j', 'cypher', 'graph-databases']"
63617909,Cypher &amp; Neo4j : for loop with Cypher request,"I have a list of words that I want to use as seed labels in Neo4j. 

These labels are renewed everyday so I would like to automate my Cypher requests.

Here is the list I have today:

List : `list_of_labels = [&#39;crise sanitaire&#39;, &#39;face crise&#39;, &#39;confinement avril&#39;, &#39;crise coronavirus&#39;, &#39;virus guerre&#39;]`

I tried this with variables in my Cypher requests:

`def create_seed_property(tx, i):    j = 0    while j &lt; len(list_of_labels): tx.run(&quot; MATCH (n:ARTICLE  {label: $i}) SET n.seed_label = $j RETURN n &quot;)    j +=1`

And next I did this:

`for i in list_of_labels: session.read_transaction(create_seed_property(i))`

I don&#39;t know where I&#39;m wrong.

[ADDENDUM]

I would like to add `seed_label` = 0 for &#39;crise sanitaire&#39;, `seed_label` = 1 for &#39;face crise&#39; etc. I want to add `seed_label` property for each string in the list_of_labels list. But the list is renewed every day, that&#39;s why I try to automate it.",1598537474,https://stackoverflow.com/q/63617909,LJRB,"['cypher', 'neo4j', 'python']"
63617786,How to exclude/blacklist relationship types from apoc.path.expandConfig or similar?,"So I am trying to find paths between a pair of nodes, of different types. The code is shown below. The graph is pretty large and have many different types of relationships, some of which I would like to exclude/blacklisted from the path, since they are extremely redundant/uninteresting. 

From what I can see `apoc.path.expandConfig` [does not allow for that natively.][1] Is there are a way I can achieve this? 

    MATCH (sourceNode:SourceLabel {symbol: &quot;&lt;source node&gt;&quot;})
    MATCH (targetNode:TargetLabel {name:&quot;&lt;target node&gt;&quot;})
    CALL apoc.path.expandConfig(g, {
    	labelFilter: &quot;IntermediaryLabel1, IL2a|IL2b|IL2c, &gt;TargetLabel&quot;,
        minLevel: 1,
        maxLevel: 3,
        terminatorNodes: [targetNode],
        uniqueness: &quot;NODE_PATH&quot;,
        limit: 50
    })
    YIELD path
    RETURN path, length(path) AS hops
    ORDER BY hops


  [1]: https://neo4j.com/labs/apoc/4.1/graph-querying/expand-paths-config/#path-expander-paths-config-config-relationship-filters",1598537159,https://stackoverflow.com/q/63617786,posdef,"['cypher', 'neo4j-apoc', 'neo4j']"
63616072,"How can I include a list of relationships specific to each node returned in the unwind block, in a Neo4j cypher query?","Given a graph where members of an organisation, have one or several relationships to that organisation, and members have incidents, I&#39;m am attempting to return a list of incidents, each including the associated member and a list of their relationships to the organisation.

the graph structure:
`(org)&lt;-[MEMBER_OF|ADMIN_OF|MANAGER_OF|VISITOR_OF]-(member)-[:HAS]-&gt;(incidents)`


The query I&#39;m current attempting:

```cypher
MATCH (incidents:Incident)&lt;-[:HAS]-(member:Person)-[rels]-&gt;(org:Org {
  orgId: $orgId
})

WITH org,
     member,
    rels,
     collect(incidents) AS collectedIncidents
UNWIND collectedIncidents AS incident
RETURN incident {
       . *,
         org:properties(org),
         member:properties(member),
         roles: rels
       } AS result
  ORDER BY incident.createdAt DESC
  SKIP $skip
  LIMIT $limit

```

The result after I created **2 incidents on one member**:
```
[ { member: { 
       createdAt: 1598524633129,
       uuid: &#39;5f430e1b-29d1-49bf-bbcc-fe1b68400378&#39;,
    },
    org: { createdAt: 1598524632522,
       name: &#39;Murder Hornet Inc&#39;,
       uuid: &#39;1a69e9a1-4126-4557-b1ff-8f621b25e23d&#39;,
       orgId: &#39;MHI&#39;,
       updatedAt: 1598524632522 },
    roles:
     Relationship {
       identity: 167,
       start: 156,
       end: 155,
       type: &#39;ADMIN_OF&#39;,
       properties: {} 
     },
    uuid: &#39;42050b82-f777-4a8a-a063-9bc43e4cf80d&#39;,
    createdAt: 1598524637746,
    },
  { member: { 
       createdAt: 1598524633129,
       uuid: &#39;5f430e1b-29d1-49bf-bbcc-fe1b68400378&#39;,
     },
    org: { 
       createdAt: 1598524632522,
       name: &#39;Murder Hornet Inc&#39;,
       uuid: &#39;1a69e9a1-4126-4557-b1ff-8f621b25e23d&#39;,
       orgId: &#39;MHI&#39;
     },
    roles:
     Relationship {
       identity: 167,
       start: 156,
       end: 155,
       type: &#39;ADMIN_OF&#39;,
       properties: {} 
      },
     uuid: &#39;21c86703-4f7b-4c67-8344-0131b011b925&#39;,
     createdAt: 1598524637746,
    },
  { member: { 
       createdAt: 1598524633129,
       uuid: &#39;5f430e1b-29d1-49bf-bbcc-fe1b68400378&#39;,
    },
    org:
     { createdAt: 1598524632522,
       name: &#39;Murder Hornet Inc&#39;,
       uuid: &#39;1a69e9a1-4126-4557-b1ff-8f621b25e23d&#39;,
       orgId: &#39;MHI&#39;,
       updatedAt: 1598524632522 },
    roles:
     Relationship {
       identity: 165,
       start: 156,
       end: 155,
       type: &#39;MEMBER_OF&#39;,
       properties: {} },
    uuid: &#39;42050b82-f777-4a8a-a063-9bc43e4cf80d&#39;,
    createdAt: 1598524637746
    },
  { member:
     { 
       createdAt: 1598524633129,
       uuid: &#39;5f430e1b-29d1-49bf-bbcc-fe1b68400378&#39;,
      },
    org:
     { createdAt: 1598524632522,
       name: &#39;Murder Hornet Inc&#39;,
       uuid: &#39;1a69e9a1-4126-4557-b1ff-8f621b25e23d&#39;,
       orgId: &#39;MHI&#39;,
      },
    roles:
     Relationship {
       identity: 165,
       start: 156,
       end: 155,
       type: &#39;MEMBER_OF&#39;,
       properties: {} },
    uuid: &#39;21c86703-4f7b-4c67-8344-0131b011b925&#39;,
    createdAt: 1598524637746,
 } 
]

```

Note that here, I&#39;ve created **2 incidents on one member**, and I get 4 results back. I&#39;ve also attempted to collect the `rels` in the `WITH` statement, which provides some equally odd results.

How can I get a list of unique incidents, including the related member, and the relationships that member has to the org? Ideally I would like just the relationship type in an array (given that there could be one or several relationships to the organisation).

",1598531508,https://stackoverflow.com/q/63616072,bigmadwolf,"['neo4j', 'cypher']"
63603115,Most sort by mutual relationships neo4j,"I want to create a query in cypher but I have problems with one part this is how it should look

 - Select one thread
 - Get users that interacted with that thread
 - Get top threads sorted by the number of users that interacted with both threads (The first- preselected one and second which I am looking for )


[![Example Graph][1]][1]


  [1]: https://i.stack.imgur.com/5ju71.png",1598464127,https://stackoverflow.com/q/63603115,Damian Grzanka,"['neo4j', 'cypher']"
63598541,update multiple related nodes simultaneously in neo4j with java,"I want to copy multiple nodes and then delete the old ones simultaneously. I wrote a multithread java application for this purpose.
My cypher query is as below:
```
String cypher= &quot;MATCH (a:Person {surname:\&quot;&quot;+ Thread.currentThread().getName()+&quot;\&quot;})
      		create (b:Person) 
      		set b.surname=a.surname
      		SET b.version = &#39;2&#39;
      		WITH a,b
      		MATCH (a)-[r:has_indication]-&gt;(c)
      		WITH COLLECT(r) AS rels, a, b, c
      		FOREACH (rel in rels |
      		       CREATE (b)-[r2:has_indication]-&gt;(c) 
      		       SET r2+=rel
      		)
      		with a,b,c
      		MATCH (c)-[r3:has_indication]-&gt;(a)
      		WITH COLLECT(r3) AS rels2, a, b, c
      		FOREACH (rel in rels2 |
      		       CREATE (c)-[r3:has_indication]-&gt;(b) 
      		       SET r3+=rel 
      		) 
      		DETACH DELETE a &quot; ;
```
and my java code is as below :
```
public void run() {
       Driver driver = GraphDatabase.driver(
       		  &quot;bolt://localhost:7687&quot;, AuthTokens.basic(&quot;neo4j&quot;, &quot;neo4j&quot;));
       Session session = driver.session();
       session.runAsync( cypher);		
}
```
I use 3 thread , when the three nodes have relation with each other only one node get updated but when these node don&#39;t have relation with each other , all the three nodes got updated successfully.
How can I update them even when they have relation with each other simultaneously?
I am using neo4j enterprise version 3.4.7 .",1598447886,https://stackoverflow.com/q/63598541,zahra.dgh,"['cypher', 'neo4j', 'neo4j-driver']"
63584551,Cypher: How to get all possible variable-length chains and output concatenated string of node properties?,"First time using neo4j. This is what my graph looks like.
![Graph DB][1]

The central node is of type `Job`, and the child nodes are of type `Word`. Each Word node has property `word` (i.e. `Word.word`), which is equivalent to the node labels such as &quot;react&quot;, &quot;php&quot; etc. in the attached image.

What I am trying to do is for each chain of child nodes, generate a concatenated string of Word.word property values. For example, for the attached graph, I want to return something like:

```
[ &quot;php&quot;, &quot;react js&quot;, &quot;javascript&quot;, &quot;full stack development&quot;, &quot;multithreaded load-balancing reactor engine&quot;]
```

My current brute force approach looks like this:
```cypher
match (webdev:Job {name:&quot;Web Developer&quot;}),
(webdev)-[a00:Appearance]-&gt;(w1:Word),
(w1)-[a01:Appearance]-&gt;(w2:Word),
(w2)-[a02:Appearance]-&gt;(w3:Word)
return w1.word + &#39; &#39; + w2.word + &#39; &#39; + w3.word as name

union

match (webdev:Job {name:&quot;Web Developer&quot;}),
(webdev)-[a00:Appearance]-&gt;(w1:Word),
(w1)-[a01:Appearance]-&gt;(w2:Word)
where not ((w2)--&gt;())
return w1.word + &#39; &#39; + w2.word as name

union

match (webdev:Job {name:&quot;Web Developer&quot;}),
(webdev)-[a00:Appearance]-&gt;(w1:Word)
where not ((w1)--&gt;())
return w1.word as name
```
which produces the output:
```
[&quot;multithreaded load-balancing reactor&quot;,&quot;full stack development&quot;,&quot;react js&quot;,&quot;php&quot;,&quot;javascript&quot;] 
```
This works for chains of length &lt;= 3, but obviously it fails for length &gt; 3. Notice how the string &quot;multithreaded load-balancing reactor&quot; should be &quot;multithreaded load-balancing reactor engine&quot;.

**My question is: how to I generalize this for all chains of variable length?**

  [1]: https://i.stack.imgur.com/DayEs.png",1598378020,https://stackoverflow.com/q/63584551,SDatta,"['neo4j', 'cypher']"
63575096,Recommendation engine in cypher Neo4J,"I am new to cypher. I have a table with customers bought materials. my target is to create recommendation to customers. lets say A bought 1,2,3 products and B bought 1,3 products, here I want to recommend product 2 to B customer. kindly suggest

    MATCH (p:Rbe{endUser:1012444})-[:BOUGHT]-&gt;(p:material)&lt;-[:BOUGHT]-(peer:endUser)-[:BOUGHT]-&gt;(reco:material)
    WHERE not (p)-[:BOUGHT]-&gt;(reco) 
    RETURN reco as Recommendation

Any recommendations?",1598344817,https://stackoverflow.com/q/63575096,user3828029,"['neo4j', 'cypher']"
63565721,Neo4j finding a path between two stations,"Assume a train passes between stations.

The data structure connecting two stations is as follows:
```
(x:Station)&lt;-[:Departure]-(:Train)-[:Arrival]-&gt;(y:Station)
```
I need to find the path between station `A` and station `B`. The path does not have to be direct (with one train) but it can pass through other stations",1598289317,https://stackoverflow.com/q/63565721,Elhanan Schwarts,"['neo4j', 'cypher']"
63563077,neo4j how to return all paths from a selected starting node,"Hello I have a graph db like this one: 
[![enter image description here][1]][1]

my wish is to retrieve all the nodes connected through the `r` relationship starting from a selected node. E.g.

if I select `a`, then I expect two rows as a response:

    a,b,c
    a,d

if I select `b` then I expect one row:

    b,c

I tried with `match p=(:a)-[:r*..]-&gt;() return p` but it returns this
[![enter image description here][2]][2]


and in python I get this that i don&#39;t know how to parse:

    &lt;Path start=&lt;Node id=93 labels=frozenset({&#39;a&#39;}) properties={&#39;name&#39;: &#39;A&#39;}&gt; end=&lt;Node id=94 labels=frozenset({&#39;b&#39;}) properties={&#39;name&#39;: &#39;B&#39;}&gt; size=1&gt;
    &lt;Path start=&lt;Node id=93 labels=frozenset({&#39;a&#39;}) properties={&#39;name&#39;: &#39;A&#39;}&gt; end=&lt;Node id=95 labels=frozenset({&#39;c&#39;}) properties={&#39;name&#39;: &#39;C&#39;}&gt; size=2&gt;
    &lt;Path start=&lt;Node id=93 labels=frozenset({&#39;a&#39;}) properties={&#39;name&#39;: &#39;A&#39;}&gt; end=&lt;Node id=96 labels=frozenset({&#39;d&#39;}) properties={&#39;name&#39;: &#39;D&#39;}&gt; size=1&gt;

&lt;br&gt;

Edit: I discovered function nodes() so I tried with `match p=(:a)-[:r*..]-&gt;() return nodes(p)` that returns kinda what I need:

[![enter image description here][3]][3]

but it still duplicates the path `a,b,c` in `a,b` and `a,b,c`. How can I remove the first row?


  [1]: https://i.stack.imgur.com/e4QzV.png
  [2]: https://i.stack.imgur.com/h3fj7.png
  [3]: https://i.stack.imgur.com/H62Ok.png",1598279444,https://stackoverflow.com/q/63563077,Gianluca,"['graph-databases', 'cypher', 'neo4j', 'python', 'graph']"
63529933,Counting IN and OUT relations to a Node?,"I&#39;m using this query to count IN and OUT relations to a node :

	    match (a)-[]-&gt;(b)
		where b.val = 11
		return count(a.val) as n
		union
		match (b)-[]-&gt;(c)
		where b.val = 11
		return count(c.val) as n 

Is this a good way of doing it, seem too cumbersome to me. Is there a better way ?",1598043240,https://stackoverflow.com/q/63529933,sten,"['cypher', 'redisgraph', 'neo4j']"
63523508,Popoto.js create new graph from cypher-query,"I would like to know if there is a method to create a graph based on a cipher-query or create a scheme based on a cipher-query that was sent via the rest.post method. I can&#39;t find anything that works in the existing functions.

A sample query would be like: `MATCH (n)-[:LOCATED_IN]-&gt;(m) WHERE m.name contains &quot;ger&quot; RETURN n,m LIMIT 20`",1598015245,https://stackoverflow.com/q/63523508,Lukas S,"['node.js', 'cypher', 'd3.js', 'javascript', 'neo4j']"
63505922,Neo4j: How to avoid out of memory in large but simple transaction,"I want to add to each node in my database a new property that is just the lowercased variant of the original property:

`MATCH (c:CONCEPT) WHERE c.preferredName IS NOT NULL SET c.preferredName_lc = toLower(c.preferredName) RETURN COUNT(c)`

Due to the large size of nodes in the database I run into memory issues:

`Can&#39;t allocate 512 bytes due to exceeding memory limit; used=2147483648, max=2147483648`

Can I somehow break this down to multiple transactions while still staying with such a simple query? Or is there another way to achieve the same result in a more memory-efficient way?

Thanks!",1597929277,https://stackoverflow.com/q/63505922,khituras,"['cypher', 'neo4j']"
63477398,Database &#39;neo4j&#39; is unavailable. Cannot reset neo4j database,"I have my community 4.1.1 neo4j service installed on the ubuntu commandline running on my windows machine. I have been using neo4j steadily for a month or two now, just recently it has prevented me from accessing the neo4j database, it will say this in neo4j browser:

`Database &#39;neo4j&#39; is unavailable. Run :sysinfo for more info.`

I have tried uninstalling neo4j and reinstalling but that has not worked either. I tried playing around with the default listen address previously, but now with the reinstall all config data is back to normal. Running ./neo4j-community-4.1.1/bin/cypher-shell under bin does not work. It says:

`Unable to establish connection in 3000ms`

If I run ./neo4j-community-4.1.1/bin/cypher-shell -a 192.168.0.19 it says:

`Database &#39;neo4j&#39; is unavailable`

When I run ./neo4j-community-4.1.1/bin/neo4j-admin check-consistency --database=neo4j it also states:

`.2020-08-18 22:12:16.868+0000 WARN [o.n.c.ConsistencyCheckService] Index was dirty on startup which means it was not shutdown correctly and need to be cleaned up with a successful recovery.
        Index file: /home/thomp105/neo4j-community-4.1.1/data/databases/neo4j/neostore.relationshipgroupstore.db.id.`

I would love to reset everything from scratch but I am unsure how
At this point I cannot even access the browser at localhost:7474. It hangs indefinitely trying to load.

I am truly stumped. Anyone have any advice on how I navigate this issue?
",1597789138,https://stackoverflow.com/q/63477398,lovgrandma,"['neo4j', 'database', 'redis', 'node.js', 'cypher']"
63473826,Commas in MERGE clause like there are in MATCH clause?,"The following works fine in neo4j 4:

```
MATCH (a)--&gt;(b)&lt;--(c), (b)--&gt;(d)
RETURN a
```

But the following returns an error:
```
MERGE (a)--&gt;(b)&lt;--(c), (b)--&gt;(d)
RETURN a
```

Error text:
**Neo.ClientError.Statement.SyntaxError**
```
Invalid input &#39;,&#39;: expected whitespace, a relationship pattern, ON, FROM GRAPH, USE GRAPH, CONSTRUCT, LOAD CSV, START, MATCH, UNWIND, MERGE, CREATE UNIQUE, CREATE, SET, DELETE, REMOVE, FOREACH, WITH, CALL, RETURN, UNION, &#39;;&#39; or end of input (line 1, column 22 (offset: 21))
&quot;MERGE (a)--&gt;(b)&lt;--(c), (b)--&gt;(d)&quot;
                     ^
```

If I understand correctly, merge provides a level of upsert functionality. But is merge more restricted in matching capability than match? How do I merge [complex non-linear patterns that require comma separations](https://stackoverflow.com/a/34090944/1412255)? ",1597772099,https://stackoverflow.com/q/63473826,Peeyush Kushwaha,"['neo4j', 'cypher']"
63465166,Neo4j Data Import Slowness,"I have to load around 5M Records in the Neo4j DB so I broke the excel into the chunks of 100K the Data is in Tabular Format and I am using CyperShell for that but seems like it has been more than 8 hours and it&#39;s still stuck on the first chunk 


I&#39;m Using 

```
USING PERIODIC COMMIT
LOAD CSV WITH HEADERS from &#39;file://aa.xlsx&#39; as row
MERGE (p1:L1 {Name: row.sl1})
MERGE (p2:L2 {Name: row.sl2})
MERGE (p3:L3 {Name: row.sl3, Path:row.sl3a})
MERGE (p4:L4 {Name: row.sl4})
MERGE (p5:L4 {Name: row.tl1})
MERGE (p6:L3 {Name: row.tl2})
MERGE (p7:L2 {Name: row.tl3, Path:row.tl3a})
MERGE (p8:L1 {Name: row.tl4})
MERGE (p1)-[:s]-&gt;(p2)-[:s]-&gt;(p3)-[:s]-&gt;(p4)-[:it]-&gt;(p5)-[:t]-&gt;(p6)-[:t]-&gt;(p7)-[:t]-&gt;(p8)
```

Can Anyone Suggest me the changes or alternate Method to load the data in faster way

Data in Excel Format
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/nQqIH.png",1597740956,https://stackoverflow.com/q/63465166,Panda,"['neo4j', 'cypher']"
63455736,RedisGraph - UNWIND batch of queries,"I would like to execute a batch of queries in RedisGraph with the Python API in order to speed up the creation of big knowledge graphs.

In **Neo4J**, the *UNWIND* command can be used by the Neo4J Python API and allows to parallelize queries. In this snippet, you can seen how the Python API supports *UNWIND* - the `run` method takes `batch` as parameter. `batch` is a list of dictionaries. Every dictionary has `head_id`, `tail_id` and `properties` as keys.

    with session.begin_transaction() as tx:  # In this transaction relationships are inserted in the database
        cypher_query = &#39;UNWIND $batch as row &#39; \
        &#39;MATCH (head:Node) WHERE head.id = row.head_id &#39; \
        &#39;MATCH (tail:Node) WHERE tail.id = row.tail_id &#39; \
        &#39;CREATE (head)-[rel:RELATIONSHIP]-&gt;(tail) &#39; \
        &#39;SET rel += row.properties&#39;
    
         tx.run(cypher_query, batch=batch)

In **RedisGraph**, *UNWIND* is also available (as it is a Cypher command). However, I don&#39;t know how to pass a batch in the Python API:

    cypher_query = &#39;UNWIND $batch as row &#39; \
            &#39;MATCH (head:Node) WHERE head.id = row.head_id &#39; \
            &#39;MATCH (tail:Node) WHERE tail.id = row.tail_id &#39; \
            &#39;CREATE (head)-[rel:RELATIONSHIP]-&gt;(tail) &#39; \
            &#39;SET rel += row.properties&#39;
    r = redis.StrictRedis()
    r.execute_command(&#39;GRAPH.QUERY&#39;, graph_name, cypher_query)  #No batch can be passed!!

Do you know a solution? Thanks.",1597685048,https://stackoverflow.com/q/63455736,Filippo Grazioli,"['redisgraph', 'redis-py', 'redis', 'cypher', 'neo4j']"
63448072,Creating nodes and relations from JSON (dynamically),"I&#39;ve got a couple hundred JSONs in a structure like the following example: 

    {
	&quot;JsonExport&quot;: [
		{
			&quot;entities&quot;: [
				{
					&quot;identity&quot;: &quot;ENTITY_001&quot;,
					&quot;surname&quot;: &quot;SMIT&quot;,
					&quot;entityLocationRelation&quot;: [
						{
							&quot;parentIdentification&quot;: &quot;PARENT_ENTITY_001&quot;,
							&quot;typeRelation&quot;: &quot;SEEN_AT&quot;,
							&quot;locationIdentity&quot;: &quot;LOCATION_001&quot;
						},
						{
							&quot;parentIdentification&quot;: &quot;PARENT_ENTITY_001&quot;,
							&quot;typeRelation&quot;: &quot;SEEN_AT&quot;,
							&quot;locationIdentity&quot;: &quot;LOCATION_002&quot;
						}
					],
					&quot;entityEntityRelation&quot;: [
						{
							&quot;parentIdentification&quot;: &quot;PARENT_ENTITY_001&quot;,
							&quot;typeRelation&quot;: &quot;FRIENDS_WITH&quot;,
							&quot;childIdentification&quot;: &quot;ENTITY_002&quot;
						}
					]
				},
				{
					&quot;identity&quot;: &quot;ENTITY_002&quot;,
					&quot;surname&quot;: &quot;JACKSON&quot;,
					&quot;entityLocationRelation&quot;: [
						{
							&quot;parentIdentification&quot;: &quot;PARENT_ENTITY_002&quot;,
							&quot;typeRelation&quot;: &quot;SEEN_AT&quot;,
							&quot;locationIdentity&quot;: &quot;LOCATION_001&quot;
						}
					]
				},
				{
					&quot;identity&quot;: &quot;ENTITY_003&quot;,
					&quot;surname&quot;: &quot;JOHNSON&quot;
				}
			],
			&quot;identification&quot;: &quot;REGISTRATION_001&quot;,
			&quot;locations&quot;: [
				{
					&quot;city&quot;: &quot;LONDON&quot;,
					&quot;identity&quot;: &quot;LOCATION_001&quot;
				},
				{
					&quot;city&quot;: &quot;PARIS&quot;,
					&quot;identity&quot;: &quot;LOCATION_002&quot;
				}
			]
		}
	]
    }

With these JSON&#39;s, I want to make a graph consisting of the following nodes: Registration, Entity and Location. This part I&#39;ve figured out and made the following:

    WITH &quot;file:///example.json&quot; AS json_file
    CALL apoc.load.json(json_file,&quot;$.JsonExport.*&quot; ) YIELD value AS data
    MERGE(r:Registration {id:data.identification})
    WITH json_file
    CALL apoc.load.json(json_file,&quot;$.JsonExport..locations.*&quot; ) YIELD value AS locations
    MERGE(l:Locations{identity:locations.identity, name:locations.city})
    WITH json_file
    CALL apoc.load.json(json_file,&quot;$.JsonExport..entities.*&quot; ) YIELD value AS entities
    MERGE(e:Entities {name:entities.surname, identity:entities.identity})


All the entities and locations should have a relation with the registration. I thought I could do this by using the following code:

    MERGE (e)-[:REGISTERED_ON]-&gt;(r)
    MERGE (l)-[:REGISTERED_ON]-&gt;(r)

However this code doesn’t give the desired output. It creates extra &quot;empty&quot; nodes and doesn&#39;t connect to the registration node. So the first question is: How do I connect the location and entities nodes to the registration node. And in light of the other JSON&#39;s, the entities and locations should only be linked to the specific registration.

Furthermore, I would like to make the entity -&gt; location relation and the entity - entity relation and use the given type of relation (SEEN_AT or FRIENDS_WITH) as label for the given relation. How can this be done? I&#39;m kind of lost at this point and don’t see how to solve this. If someone could guide me into the right direction I would be much obliged.
",1597656300,https://stackoverflow.com/q/63448072,JHJH,"['neo4j', 'json', 'cypher']"
63443428,"update property in all edges, fast?","I want to update a property in every &quot;edge&quot; every n-cycles/seconds/minutes.
As you may suspect this is time consuming and probably wont work well.

One possible approach is to do it in chunks.
The question is what is the best way to do it.

Here is how a full sweep will look like :

     match (n1)-[x:q]-(n2)
     set x.decay = x.decay * exp(-rate)


So the idea is to decay the edges and remove them when they hit a specific value.

If I do it in chunks how do I keep track which ones I decayed already so that I skip them, faster and cheaper.
",1597627101,https://stackoverflow.com/q/63443428,sten,"['neo4j', 'cypher']"
63433433,UNWIND statement in a Cypher Query,"I have these nodes:

 1. `user{user_id}: users`
 2. `thread{thread_id, post_date} : posts`
 3. `tag_id{tag_id}: the tag of the post`

And these relationships:
1. `(user) - [: FOLLOWED] -&gt; (tag)` // the user follows the tag
2. `(thread) - [: BELONG_TO] -&gt; (tag)` // the post belongs to tag
3. `(user) - [: READ] -&gt; (thread)` // user reads the post

Now I want to query for each tag that user follows 5 posts that user has not read. I wrote cypher as follows:

    MATCH (u:User)-[:FOLLOWED]-&gt;(t:Tag)
    WHERE u.id = 39792
    WITH collect(t) as tLists
    UNWIND tLists as t
    MERGE (u:User)-[:FOLLOWED]-&gt;(t:Tag)&lt;-[:BELONG_TO]-(th:Thread)&lt;-[r:READ]-()
    WHERE not (u)-[:READ]-&gt;(th)
    RETURN u.id, th.id, t.id, duration.inDays(datetime(), datetime({ epochmillis: apoc.date.parse(th.post_date)})).days as time, count(r) as count_view
    ORDER BY time DESC, count_view DESC
    LIMIT 5

But it doesn&#39;t work. Help me
",1597555235,https://stackoverflow.com/q/63433433,Anh,"['cypher', 'neo4j']"
63431337,MERGE the edges even if the values differ?,"the following query will create (n1)-&gt;(n2) pair.
If the nodes already exists they will be reused.

       match (n1:X),(n2:X) where n1.val = 11 and n2.val = 12 
       merge (n1)-[x:q {val: 0 }]-&gt;(n2)

the problem is that if the edge with x.val that is different will create new connection.

Is there a way to disregard it ?

I want a single Query, which sets the value first time its called and afterwards ignore the value... OR I have to have two different queries one to set the pair and second w/o x.val that will just merge ? 



---

this seem to work, but i would hear other possibilities :

      		on create set x.val = 0.001

",1597530239,https://stackoverflow.com/q/63431337,sten,"['redisgraph', 'neo4j', 'cypher']"
63427242,Order the result by the number of relationships,"I have a directed multigraph. With this query I tried to find all the nodes that is connected to node with the `uuid` n1_34

```
MATCH (n1:Node{uuid: &quot;n1_34&quot;}) -[r]- (n2:Node) RETURN n2, r
```

This will give me a list of `n2` (n1_1187, n2_2280, n2_1834, n2_932 and n2_722) and their relationships among themselves which are exactly what I need. 

[Nodes n1_1187, n2_2280, n2_1834, n2_932 and n2_722 are connected to the node n1_34][1]

Now I need to order them based on the relationship it has within this subgraph. So for example, n1_1187 should be on top with 4 relationships while the others have 1 relationship. 

I followed this post: https://stackoverflow.com/questions/29571966/extract-subgraph-from-neo4j-graph-with-cypher but it gives me the same result as the query above. I also tried to return `count(r)` but it gives me 1 since it counts all unique relationships not the relationships with a common source/target.

Usually with networkx I can copy this result into a subgraph then count the relationships of each node. Can I do that with neo4j without modifying the current graph? How?

Please help. Or is there other way?

  [1]: https://i.stack.imgur.com/q88qp.png",1597502504,https://stackoverflow.com/q/63427242,24carats,"['graph', 'relationship', 'neo4j', 'cypher', 'directed-graph']"
63420274,Cypher Match-MERGE query fails on ConstraintValidationFailed,"I&#39;m trying to create a `Node` with `Relation` using Match-Merge query with a `Unique Constraint` to avoid duplicate Node.  

I have `Unique Constraint` on `C` label for property name:  

    | 11 | &quot;c_name&quot;        | &quot;ONLINE&quot; | 100.0             | &quot;UNIQUE&quot;    | &quot;BTREE&quot;    | &quot;NODE&quot;     | [&quot;C&quot;]   | [&quot;name&quot;]             | &quot;native-btree-1.0&quot; |
      

And I&#39;m using this query: 

    MATCH (n:N)
    where id(n)=10
    MERGE (n)-[r:Relates]-&gt;(c:C {name: &quot;Test&quot;, parts: [&quot;Test&quot;]})

The `N` Node always exists but Node `C` can be non-existent and I expect it to be created if so.  

I get this error when `C` with duplicate `name` exists! 
 

    ConstraintValidationFailed: Node(373009) already exists with label `C` and property `name` = &#39;Test&#39;


What is the problem? doesn&#39;t `Merge` query make the duplicate Node to be merged or skipped?

",1597440853,https://stackoverflow.com/q/63420274,Ariyan,"['neo4j', 'cypher', 'constraints']"
63412081,Find specific unknown depth grandchildren in neo4j cypher,"I am looking to find any root node that has a specific (great? great?) grand child at an unknown depth, that passes through multiple nodes and relationships of different types before it finally reaches the `ListItem` nodes that is always related to its parent with `HAS_SELECTED`.

I have tried both:

```
MATCH (r:Root)-[HAS_SELECTED*]-&gt;(l:ListItem {alias: &#39;test&#39;})
RETURN r
```

and

```
MATCH (r:Root)-[HAS_SELECTED*]-&gt;(l:ListItem)
WHERE l.alias = &#39;test&#39;
RETURN r
```

An example graph could be

```
r   r    r                r
    |    |                |
    c  ListItem           c
    |                     |
    c                     c
    |                     |
 ListItem(alias = test) ListItem(alias=somethingElse)
```

How would i find the `r` that ends up being related to the `ListItem` that has the alias of &quot;test&quot; without knowing all the intermediate relationships and nodes, or even how many intermediate relationships and nodes there may be?",1597405261,https://stackoverflow.com/q/63412081,bizzehdee,"['cypher', 'neo4j']"
63398821,Neo4J Matching Nodes Based on Multiple Relationships,"I had another thread about this where someone suggested to do

```
MATCH (p:Person {person_id: &#39;123&#39;})
WHERE ANY(x IN $names WHERE
  EXISTS((p)-[:BELONGS]-(:Face)-[:CORRESPONDS]-(:Image)-[:HAS_ACCESS_TO]-(:Dias {group_name: x})))
MATCH path=(p)-[:ASSOCIATED_WITH]-(:Person)
RETURN path
```

This does what I need it to, returns nodes that fit the criteria without returning the relationships, but now I need to include another param that is a list.

```
....(:Dias {group_name: x, second_name: y}))
```

I&#39;m unsure of the syntax.. here&#39;s what I tried
```
WHERE ANY(x IN $names and y IN $names_2 WHERE..
```
this gives me a syntax error :/",1597334036,https://stackoverflow.com/q/63398821,SunLightGirl99,"['cypher', 'neo4j']"
63384365,Neo4J Matching Nodes Based On Relationships,"I have the following statement:

    MATCH path=(p:Person {person_id: &#39;123&#39;})-[:ASSOCIATED_WITH]-(:Person)
    where exists((p)-[:BELONGS]-(:Face)-[:CORRESPONDS]-(:Image)-[:HAS_ACCESS_TO]-(:Dias {group_name: &#39;group&#39;}))
    RETURN path

It returns 3 nodes, 2 relationships. This is what I would like to happen but the group_name I will actually be passing is an array. How do I add the condition to check for the value in the array while still maintaining 3 nodes and two relationships? The only relationship I want to return back is ASSOCIATED_WITH. The 3 nodes being, the main person_id of &quot;123&quot; and the two associated persons.

",1597264500,https://stackoverflow.com/q/63384365,SunLightGirl99,"['neo4j', 'cypher']"
63382626,Neo4j OGM fails to clear null-ed relationship on save,"- Neo4j Community 4.0.3
- Windows 10 
- bolt driver accessed via Java 11 OGM framework
- Steps to reproduce...

I&#39;ve created the two (`Car` and `Person`) classes below, then run the third (`PocTest`) class as a JUnit test.  I&#39;d expected the final assertNull to pass, but it fails: the relationship that had been set, saved, then cleared and saved again, did not appear to have its clearing/null-ing persisted by the final save.  

This seems odd to me, so I&#39;m wondering if it&#39;s a bug... but accept it is most likely a lack of knowledge on my part.  

(I&#39;m wondering if I need to create an explicit relationship class, then use its identifier to delete it, but given I may not want any other attributes on that, I&#39;d prefer not to if I don&#39;t need to.)

Any understanding anyone could provide to me on this would be most welcome. Thank you!



```
import org.neo4j.ogm.annotation.GeneratedValue;
import org.neo4j.ogm.annotation.Id;
import org.neo4j.ogm.annotation.NodeEntity;
import org.neo4j.ogm.annotation.Relationship;

@NodeEntity( label = &quot;Car&quot; )
public class Car {

  @GeneratedValue
  @Id
  private Long id;

  @Relationship( type = &quot;DRIVER&quot;, direction = Relationship.OUTGOING )
  private Person driver;

  public Long getId()
  {
    return this.id;
  }

  public Person getDriver()
  {
    return this.driver;
  }

  public void setDriver( final Person driver )
  {
    this.driver = driver;
  }
}
```

```
import org.neo4j.ogm.annotation.Id;
import org.neo4j.ogm.annotation.NodeEntity;

@NodeEntity( label = &quot;Person&quot; )
public class Person {

  @Id
  private String name;

  public String getName()
  {
    return this.name;
  }

  public void setName( final String name )
  {
    this.name = name;
  }
}
```

```
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNull;

import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;
import org.neo4j.ogm.config.Configuration;
import org.neo4j.ogm.session.Session;
import org.neo4j.ogm.session.SessionFactory;
import org.springframework.util.StringUtils;

public class PoCTest {

  private static SessionFactory ogmSessionFactory;

  @BeforeAll
  private static void createSessionFactory()
  {
    final Configuration config = new Configuration.Builder().uri( &quot;bolt://localhost:7687&quot; )
          .credentials( &quot;neo4j&quot;, &quot;blahblahblah...&quot; )
          .useNativeTypes()
          .verifyConnection( true )
          .build();
    ogmSessionFactory = new SessionFactory( config, PoCTest.class.getPackageName() );
  }

  private static Session getOgmSession()
  {
    return ogmSessionFactory.openSession();
  }

  @Test
  void testCreateCarChangeDriver()
  {
    final Car car = new Car();
    final Person fred = new Person();
    fred.setName( &quot;fred&quot; );
    car.setDriver( fred );       // sets the relationship as expected
    getOgmSession().save( car ); // saves the relationship as expected
    assertEquals( &quot;fred&quot;, getOgmSession().load( Car.class, car.getId() ).getDriver().getName() ); // passes
    car.setDriver( null );       // then we clear the relationship (&quot;fred&quot; is no longer the driver)
    getOgmSession().save( car ); // then *save* it... _but_...
    // Bug! The save ^ has *not* cleared the relationship...
    assertNull( getOgmSession().load( Car.class, car.getId() ).getDriver() ); // &lt;- and this line fails!
  }
}
```
",1597256588,https://stackoverflow.com/q/63382626,dmgh,"['neo4j', 'java', 'cypher']"
63364291,Return empty list for albums without photos,"I have a Neo4j database with Albums that contain a list of Photos. Each Photo in turn has a list of Thumbnails. I wrote a query to give me every album including all of its photos (including their thumbnails):


    MATCH (a:Album)
    OPTIONAL MATCH (a)&lt;-[:BELONGS_TO]-(p:Photo)
    OPTIONAL MATCH (p)&lt;-[to:THUMBNAIL_OF]-(t:Thumbnail)
    WITH a,p,{uri: t.uri, size: to.size} as thumbnails
    WITH a,{id: p.id, uri: p.uri, thumbnails: collect(thumbnails)} as photo
    RETURN a.id as albumId, a.name as albumName, collect(photo) as photos

The result of this query looks like this:

    ╒══════════════════════════════════╤═════════════╤═════════════════════════════════════════════════════════════════╕
    │&quot;albumId&quot;                         │&quot;albumName&quot;  │&quot;photos&quot;                                                         │
    ╞══════════════════════════════════╪═════════════╪═════════════════════════════════════════════════════════════════╡
    │&quot;41dmzLK7bCP3Tbm7aVtXH-61LVgJmW57&quot;│&quot;Summer 2019&quot;│[{&quot;id&quot;:null,&quot;thumbnails&quot;:[{&quot;size&quot;:null,&quot;uri&quot;:null}],&quot;uri&quot;:null}] │
    ├──────────────────────────────────┼─────────────┼─────────────────────────────────────────────────────────────────┤
    │&quot;sM4hwUEAfdeQNktoGRRSW4POrugUldyF&quot;│&quot;New Album&quot;  │[{&quot;id&quot;:&quot;VO5ixGVygrZ5Z9-H903bJ0XDY6gEbr4s&quot;,&quot;thumbnails&quot;:[{&quot;size&quot;:&quot;│
    │                                  │             │LARGE&quot;,&quot;uri&quot;:&quot;YVZ9Cz4P2yBPPtpadAmA3yt1&quot;},{&quot;size&quot;:&quot;MEDIUM&quot;,&quot;uri&quot;:&quot;│
    │                                  │             │X4TADPTbKe2CTY832TVeEdHk&quot;},{&quot;size&quot;:&quot;SMALL&quot;,&quot;uri&quot;:&quot;hyy34CeUB36HvxU│
    │                                  │             │1YDVE7aTV&quot;},{&quot;size&quot;:&quot;TINY&quot;,&quot;uri&quot;:&quot;7h9ADu1Xbm1YDuBBTEKVKaCA&quot;}],&quot;ur│
    │                                  │             │i&quot;:&quot;xHpxm7zpe1U4v6gTEAm3kdcm&quot;}]                                  │
    └──────────────────────────────────┴─────────────┴─────────────────────────────────────────────────────────────────┘

The album &quot;Summer 2019&quot; does not contain any photos and I would like the photos to be an empty list instead of the current value with everything set to null. I thought the optional match would help in this case but apparently it doesn&#39;t. I guess this is because I create custom structs in my query.

How can I change my query to achieve that?",1597170511,https://stackoverflow.com/q/63364291,Selim,"['neo4j', 'cypher']"
63350770,How to loop over an object in neo4j using cypher,"Hi i am using nodejs with neo4j-driver and i create relations like this (USER-[ values from the object ]-&gt;SUBREDDIT)

Username is predefined so this isn&#39;t a problem but the subreddit name and values of relations is inside the object. 

The object is really huge so i would prefer use some cypher magic to loop over this object and create relations, bad i have no idea how to do it.

I am also wondering if this is good approach to do that or if it is more efficient to just loop over this object in JavaScript and make more queries 




I am trying to make write query, names of objects  (like &#39;63&#39;) are meaningless, the name of target node is in sub property, rest of the are relation properties

    &#39;62&#39;: {
      n: 1,
      ups: 15.730142943532986,
      gilded: 0,
      upvote_ratio: 0.9253025260901756,
      num_comments: 2.7759075782705267,
      num_crossposts: 0,
      score: 15.730142943532986,
      sub: &#39;r/aww&#39;
    },
    &#39;63&#39;: {
      n: 2,
      ups: 33.58852601401853,
      gilded: 0,
      upvote_ratio: 1.2799872062537179,
      num_comments: 7.8618886115333115,
      num_crossposts: 0,
      score: 33.58852601401853,
      sub: &#39;r/FreeKarma4U&#39;
    }",1597114041,https://stackoverflow.com/q/63350770,Damian Grzanka,"['node.js', 'neo4j', 'cypher']"
63340253,Neo4j Cypher has ultra-restrictive pattern comprehension - or am I using it wrong?,"I recently picked up Neo4j as it seemed the best type of database to store data I&#39;m currently scraping off a number of online discussion forums. The primary structure of the graph is Community -&gt; Forum -&gt; Thread -&gt; Post -&gt; Author

I&#39;m trying to write the Cypher queries to resolve GraphQL queries, and would like to paginate (for example) the Forum -&gt; Thread connection. The relationship is CONTAINS which holds an `order` property i.e. `(f:Forum)-[:CONTAINS]-&gt;(t:Thread)`

From the neo4j-graphql-js library I picked up on their usage of pattern comprehension to run an &quot;inner query&quot; on the child nodes. For example:

```
MATCH (f:Forum { id: $id })
RETURN f { .id, .name, .url, threads: [(f)-[:CONTAINS]-&gt;(t:Thread) | t { .id, .title, .url }] }
```

I&#39;d really like to use ORDER BY, LIMIT and SKIP on the inner pattern comprehension, but unfortunately this is not supported: https://github.com/opencypher/openCypher/issues/202 - the neo4j-graphql-js library gets around this by using `apoc.coll.sortMulti` but I&#39;ve noticed performance is not great &amp; a lot slower than if I were to use the ORDER BY clause on a top-level pattern equivalent.

Since I&#39;m new to graph DBMS, this has got me wondering if I may have misunderstood how a graph DB is supposed to be used. From a &quot;frontender&quot; perspective, the ability to implement paginating in the lowest-level query language seems like a critical piece, but again, maybe I&#39;ve not understood things correctly. Square peg, round hole, and all that!

Is this a fair evaluation? Is there another option in Cypher that will solve this? Or, should I just go back to use an SQL database for this use case?",1597062603,https://stackoverflow.com/q/63340253,Matty F,"['graphql', 'neo4j', 'cypher']"
63306262,Conditional partial merge of pattern into graph,"I&#39;m trying to create a relationship that connects a person to a city -&gt; state -&gt; country without recreating the city/state/country nodes and relationships if they do already exist - so I&#39;d end-up with only one USA node in my graph for example

I start with a person
```
CREATE (p:Person {name:&#39;Omar&#39;, Id: &#39;a&#39;})
RETURN p
```
then I&#39;d like to turn this into an `apoc.do.case` statement with apoc
or turn it into one merge statement using unique the constraint that creates a new node if no node is found or otherwise matches an existing node
```
// first case where the city/state/country all exist
MATCH (locality:Locality{name:&quot;San Diego&quot;})-[:SITUATED_IN]-&gt;(adminArea:AdministrativeArea { name: &#39;California&#39; })-[:SITUATED_IN]-&gt;(country:Country { name: &#39;USA&#39; })
MERGE (p)-[:SITUATED_IN]-&gt;(locality)-[:SITUATED_IN]-&gt;(adminArea)-[:SITUATED_IN]-&gt;(country)
return p

// second case where only state/country exist
MATCH (adminArea:AdministrativeArea { name: &#39;California&#39; })-[:SITUATED_IN]-&gt;(country:Country { name: &#39;USA&#39; })
MERGE (p)-[:SITUATED_IN]-&gt;(locality:Locality{name:&quot;San Diego&quot;})-[:SITUATED_IN]-&gt;(adminArea)-[:SITUATED_IN]-&gt;(country)
return p

// third case where only country exists
MATCH (country:Country { name: &#39;USA&#39; })
MERGE (p)-[:SITUATED_IN]-&gt;(locality:Locality{name:&quot;San Diego&quot;})-[:SITUATED_IN]-&gt;(adminArea:AdministrativeArea { name: &#39;California&#39; })-[:SITUATED_IN]-&gt;(country)
return p

// last case where none of city/state/country exist, so I have to create all nodes + relations
MERGE (p)-[:SITUATED_IN]-&gt;(locality:Locality{name:&quot;San Diego&quot;})-[:SITUATED_IN]-&gt;(adminArea:AdministrativeArea { name: &#39;California&#39; })-[:SITUATED_IN]-&gt;(country:Country { name: &#39;USA&#39; })
return p
```

The key here is I only want to end-up with one (California)-&gt;(USA). I don&#39;t want those nodes &amp; relationships to get duplicated",1596819692,https://stackoverflow.com/q/63306262,Tralala,"['neo4j', 'neo4j-apoc', 'cypher']"
63301879,neo4j local cluster start failed,"I am trying to set up a **local cluster** in neo4j and following this tutorial (https://neo4j.com/docs/operations-manual/current/tutorial/local-causal-cluster/#tutorial-local-cluster-configure-cores). I have downloaded the latest **enterprise version 4.1.1** and have followed all the steps mentioned in the tutorial. However I am confused at one step where it is mentioned that we should move to bin directory and run command &quot;`neo4j start`&quot; . When I run this command it says neo4j service not found so I searched about it and found that I should install neo4j as a service first then the start command will start the service. When I install it the service will run for the core-01 instance, following the tutorial for core-02 and core-03 I am supposed to start neo4j also but again the start command will not work unless I install it. 

Following this am I supposed to install 3 different services or it is supposed to be a single service for the whole cluster of 3 instances? If single then the neo4j service will always points to the **core-01** instance.

Skipping start command If I run the command `neo4j console` in the bin directory of 3 instances then I get this error in all three consoles

&gt; [![Database &#39;system&#39; is waiting for a total of 3 core members...][1]][1]


  [1]: https://i.stack.imgur.com/4BiDX.png


How I am supposed to handle this?? Am I not setting **neo4j** service properly or there is some issue in configuration ?",1596803216,https://stackoverflow.com/q/63301879,Mubeen Mubarik,"['deployment', 'neo4j', 'cypher', 'neo4jclient', 'cluster-computing']"
63288471,Neo4j Variable Length Relationship,"In Neo4j, using a graph of airports and their flights:

* Nodes with the label of Flight have the properties month and weekday.
* Nodes with the label of Airport have the property abbr (=abbreviation).
* A Flight has three relationships with An Airport: [:ORIGIN], [:DIVERTED_TO]*, [:DESTINATION], and in all cases the arrow points at the Airport.

(*shows the additional airports on the way of the flight.)

I need to show a visual route between JFK airport and SFO airport, which leaves on January 8th (Flight.month 1 and Flight.weekday 8) and must stop at DFW airport (it can stop in more airports).

This is the code which I&#39;ve tried but didn&#39;t work for mr:

    MATCH (f:Flight)-[:ORIGIN]-&gt;(j:Airport{abbr:&#39;JFK&#39;})
    MATCH (s:Airport{abbr:&#39;SFO&#39;})&lt;-[:DESTINATION]-(f)-[:DIVERTED_TO*1..5]-&gt;(d:Airport{abbr:&#39;DFW&#39;})
    WHERE f.month=1 AND f.weekday=8
    RETURN f,j,s,d
    LIMIT 1

In case it might be helpful, there are more details about the fields [here](https://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236&amp;DB_Short_Name=On-Time).

Thank you very much in advance!",1596733324,https://stackoverflow.com/q/63288471,Lifrey,"['cypher', 'neo4j']"
63281849,Neo4j merge query on a node with indexed constraint takes 4-6sec,"I am running a Neo4j merge cypher query in my Java Application which performs a merge on a node with a label as well as a property which is indexed. Irrespective of match or create I am setting some properties on the matched or created node.
The query on an average takes close to 4-6sec. 
Code snippet of the query:
```
@Query(&quot;MERGE (u:User {userId: {userId}}) set u.lat={lat}, u.lng={lng}, u.accuracy={accuracy}, &quot;
      + &quot; u.brandId={brandId}, u.updatedAt={updatedAt}, u.createdAt={createdAt} &quot;
      + &quot; return u&quot;)
  User saveUserCypher(@Param(&quot;userId&quot;) Long userId, @Param(&quot;lat&quot;) Double lat, @Param(&quot;lng&quot;) Double lng,
      @Param(&quot;accuracy&quot;) Integer accuracy, @Param(&quot;brandId&quot;) Integer brandId,
      @Param(&quot;updatedAt&quot;) String updatedAt, @Param(&quot;createdAt&quot;) String createdAt);
```
 1. Neo4j server version: 3.3.2 (Community Edition) 
 2. StandAlone Machine
 3. Server Hardware Conf: 72vCPU 144GB RAM (basically using c5d.18xlarge
    AWS EC2 instance to host the neo4j server)

I have already tried using Spring Data Neo4j save function and it takes even more time so I resorted back to writing cypher.
I have also increased the page cache size of the server to 60g.  
Is such high query time expected? I was hoping for the query to be executed in subsecond. Please suggest what optimizations/improvement can be done?  

Thanks in advance.
**Edit 1**: [Added the profile of the query][1]



  [1]: https://i.stack.imgur.com/sEdh2.png",1596710450,https://stackoverflow.com/q/63281849,Pulkit Suhasaria,"['spring-data-neo4j', 'cypher', 'neo4j']"
63241843,"My cypher query where I count incoming relationship seems slow, need some help to improve performance","Dear Cypher/Neo4j experts,

I have the following part of a graph where I have Countries, Cities, Companies and Projects modelled. I have the following Cypher query where I get the Country nodes, as well as the unique identifiers of the contained city nodes, a count of the LOCATED_IN and a count of the MAY_BE_EXECUTED_IN relationships

    MATCH (country:Country)
    OPTIONAL MATCH (country)-[:CONTAINS]-&gt;(city:City)
    OPTIONAL MATCH (:Project)-[may_be_executed_in:MAY_BE_EXECUTED_IN]-&gt;(country)
    OPTIONAL MATCH (:Company)-[located_in:LOCATED_IN]-&gt;(country)
    RETURN DISTINCT country {.*
        , city: COLLECT(DISTINCT city.identifier)
        , MAY_BE_EXECUTED_IN_Count: COUNT(DISTINCT may_be_executed_in)
        , LOCATED_IN_Count: COUNT(DISTINCT located_in)
    }
    ORDER BY country.identifier ASCENDING


[![graph extract][1]][1]

There are 76 Country nodes and about 10000 Company nodes in the database. When I run the query it takes about 30 to 40 seconds, when I leave out the `MAY_BE_EXECUTED_IN_Count: COUNT(DISTINCT may_be_executed_in)` part the query completes in approx 40 milliseconds. I realize that the resources allocated to neo4j play a role, but my guess is that my query is not good. Any help would be appreciated.

  [1]: https://i.stack.imgur.com/4jM5w.png",1596525118,https://stackoverflow.com/q/63241843,Sam,"['neo4j', 'cypher']"
63232817,When should inferred relationships and nodes be used over explicit ones?,"I was looking up how to utilise temporary relationships in Neo4j when I came across this question: https://stackoverflow.com/questions/23645257/cypher-temp-relationship
and the comment underneath it made me wonder when they should be used and since no one argued against him, I thought I would bring it up here.

I come from a mainly SQL background and my main reason for using virtual relationships was to eliminate duplicated data and do traversals to get properties of something instead.

For a more specific example, let&#39;s say we have a robust cake recipe, which has sugar as an ingredient. The sugar is what makes the cake sweet.

Now imagine a use case where I don&#39;t like sweet cakes so I want to get all the ingredients of the recipe that make the cake sweet and possibly remove them or find alternatives.

Then there&#39;s another use case where I just want foods that are sweet. I could work backwards from the sweet ingredients to get to the food or just store that a cake is sweet in general, which saves time from traversal and makes a query easier. However, as I mentioned before, this duplicates known data that can be inferred.

Sorry if the example is too strange, I suck at making them. I hope the main question comes across, though.",1596470182,https://stackoverflow.com/q/63232817,Xapper,"['neo4j', 'cypher']"
63222598,Compute highest and lowest occurrence of relationship in one query [Neo4j],"I tried to compute the highest and lowest occurrence of co authorship relationship between authors over specific years with cypher using the
````WHERE```` clause, with an array of years. When testing only one value in array of years, i get the right values, but with more years in array, the counting of ```minAmount``` and ```maxAmount``` are accumulating all years, then things become wrong.

The following code working with one year in array:
```
MATCH (i:Institution{name:&#39;UnB&#39;})-[rel:ASSOCIATED_TO]-(a1:Author)[co:COAUTHOR]-(a2:Author) WHERE co.year IN [2018]

WITH a1,count (co) as amount

WITH MIN(amount) as minAmount, MAX(amount) as maxAmount

return  minAmount,maxAmount
```
I tried to use ```FOREACH```,```CASE``` and others to loop over years in array of years and compute the highest and lowest BY YEAR separated, but without success.",1596418047,https://stackoverflow.com/q/63222598,Lucas Lemos,"['neo4j', 'cypher']"
63218287,"Cypher query to return graph as object, where each parent node contains an array of its children?","I have a graph like the one below:

[![enter image description here][1]][1]

   [1]: https://i.stack.imgur.com/8d7N2.png

**What cypher query must I use to return the graph as an object, where each parent node contains an array of its children nodes?**

Example:
```
state: {
  name: &#39;New York&#39;
  publishingCompanies: [
    {
      name: &#39;Penguin&#39;
      authors: [
        {
          name: &#39;George Orwell&#39;,
          books: [
            { name: &#39;Why I Write&#39;},
            { name: &#39;Animal Farm&#39;},
            { name: &#39;1984&#39; }
          ]
        },
        {
          name: &#39;Vladimir Nobokov&#39;
          books: [
            { name: &#39;Lolita&#39; }
          ]
        },
        ...
      ]
    },
    { 
      name: &#39;Random House&#39;,
      authors: [
        ...
      ]
    }
  ]
}
```

I tried to use `apoc.convert.toTree`, but it returned an array of paths from `State` to `Book`.",1596384987,https://stackoverflow.com/q/63218287,Dan,"['neo4j-apoc', 'cypher', 'neo4j']"
63211536,Cypher - Conditional SET,"I&#39;m trying to update a node in Neo4j, I&#39;m passing variables to the query, and this variables could be null, and I don&#39;t want to update the node&#39;s property if the variable is null, so I tried this:

    MATCH (n:address {id: $id})
      SET n = {
        name: COALESCE($name, n.name),
        streetAddress: COALESCE($streetAddress, n.streetAddress),
        build: COALESCE($build, n.build),
        door: COALESCE($door, door),
        latitude: COALESCE($latitude, n.latitude),
        longitude: COALESCE($longitude, n.longitude)
      }
    
    RETURN (n)

But it gives the following error:

    Neo4jError: Expected parameter(s): name, streetAddress, build, latitude, longitude

What can I do?",1596331653,https://stackoverflow.com/q/63211536,Diego Francisco,"['cypher', 'neo4j']"
63204836,Nodejs neo4j-driver Trying to read and return result set of over 4m records,"[UPDATE]
I had a few good recommendations on the Neo4j community forum here: https://community.neo4j.com/t/nodejs-neo4j-driver-trying-to-read-and-return-result-set-of-over-4m-records/22705/13

Suggestion 1) Only search on Campaigns with an Industry Sector ID - so add a label to Campaign nodes with an industry sector ID &#39;HasIndustrySector&#39;.

Suggestion 2) Split the query into two parts: 1st part, grab all campaigns with industry sector. 2nd Part, Aggregate the relationships to be optionally searched together as such:

```
MATCH (c:Campaign)
WHERE c.industrySectorId IS NOT NULL
RETURN id(c) as campaignId

MATCH (c)-[r:SENT_EMAIL|OPENED|CLICKED]-(p)
WHERE id(c) = $campaignId
WITH c, type(r) as type, count(distinct p) as count LIMIT 1000
WITH c, {type: type, count: count} as data
WITH c, collect(data) as totals
RETURN c.campaignId AS campaignId, c.industrySectorId AS industrySectorId, c.senddate AS sendDate, c.subjectLine AS subject, c.preHeader AS preHeader, totals
```

This has actually resulted in the query completing. The result of profile on this query is:

134178426 total db hits in 5 ms (it says 5ms, but it definitely took around 50+ seconds to actually complete and return the result of the profile).

[![enter image description here][1]][1]

[ORIGNAL QUESTION]

We have a new server running dedicated enterprise Neo4j.

Recently imported data from MSSQL database producing around 100m nodes and equal number of relationships.

I have connected the neo4j-driver for nodejs fine and run many queries successfully.

However, I am at a point where I need to read/stream around 4 million records from a particular node label.

I have used both session and reactive session to try to do this, but the results just never appear, even if I leave it for hours. However, if I put a LIMIT clause on the query, I get results fine for anything up to 500,000. However, going above this there is just no response at all and also I can&#39;t see anything in the logs.

Here is the query:

```
cypher runtime=slotted 
MATCH (c:Campaign)
OPTIONAL MATCH (c)&lt;-[:HAS]-(i:IndustrySector)
WITH c,i
OPTIONAL MATCH (c {campaignId: c.campaignId})-[sent:SENT_EMAIL]-&gt;(sp:Person)
OPTIONAL MATCH (c {campaignId: c.campaignId})&lt;-[opened:OPENED]-(op:Person)
OPTIONAL MATCH (c {campaignId: c.campaignId})&lt;-[clicked:CLICKED]-(cp:Person)
WITH c, i, COUNT(DISTINCT(sp)) AS totalSent, COUNT(DISTINCT(op)) AS totalOpened, COUNT(DISTINCT(cp)) AS totalClicked
RETURN c.campaignId AS campaignId, i.industrySectorId AS industrySectorId, c.senddate AS sendDate, c.subjectLine AS subject, c.preHeader AS preHeader, totalSent, totalOpened, totalClicked
```

As you can see I have set the cypher runtime to use slotted. I have tried this without but it seems to send the entire results back in one batch, rather than streaming row by row.

Here are two versions I have tried, first is normal session. The second is using reactive session:

```
// Normal Session
session.run(query)
.subscribe({
onKeys: keys =&gt; {
},
onNext: record =&gt; {
},
onCompleted: () =&gt; {
},
onError: error =&gt; {
}});

// Reactive Session
rxSession.run(query)
.records()
.pipe(map(record =&gt; record.toObject()))
.subscribe({
...same as above
})
```

One other thing I tried was to use SKIP and LIMIT on the query so processing in batches of 10k records. This works fine until it reaches 520,000 records then just hangs again.

Would be very grateful if anyone is able to point me to where I am going wrong or a better way to achieve what I want. I have looked at the apoc library such as apoc.periodic.iterate however that is only applicable to performing write operations.

Thanks for any help.


  [1]: https://i.stack.imgur.com/9TEUn.png",1596282339,https://stackoverflow.com/q/63204836,mrpetem,"['node.js', 'cypher', 'neo4j']"
63203270,Python: parallel Neo4J batch writes,"I want to display word relationships in **Neo4j 4.0**. I wrote a scraper in **Python 3.8** which reads 3.000 text files and afterwards stores the information in Neo4J with the **Neo4j Python Driver 4.1**. The whole process takes 0.5-2 seconds per text file. I am currently trying to speed up these writes by executing them parallel. After reading the docs:

&gt; sessions may only host one transaction at a time. For parallel execution, multiple sessions should be used.
https://neo4j.com/docs/driver-manual/current/cypher-workflow/#driver-sessions

I decided to batch the processing of each file/text into one transaction in one session. So for each file I create and afterwards close a new session:
```python
driver = GraphDatabase.driver(&#39;uri&#39;, auth=(&#39;user&#39;, &#39;password&#39;), encrypted=False)

def feed_word_list(tx, word_list, title, headline):
    ...
    #example batch
    batch = {&#39;batch&#39;:[{&#39;from&#39;:&#39;start&#39;,&#39;to&#39;:&#39;end&#39;,&#39;from_tf&#39;:3,&#39;to_tf&#39;:4}]}
    tx.run( &#39;UNWIND $batch as tuples &#39;
            &#39;MERGE (word1: Word {title: tuples.from}) &#39;
            &#39;MERGE (word2: Word {title: tuples.to}) &#39;
            &#39;MERGE (text1: Text {title: $title, headline: $headline}) &#39;
            &#39;MERGE (text1) -[:CONTAINS {term_frequency: tuples.from_tf}]-&gt; (word1) &#39;
            &#39;MERGE (text1) -[:CONTAINS {term_frequency: tuples.to_tf}]-&gt; (word2) &#39;
            &#39;MERGE (word1) -[:IS_NEIGHBORING]-&gt; (word2) &#39;
            , batch, title=title, headline=headline)

def parse_write(f):
    text = parse(f)
    with driver.session() as session:
        session.write_transaction(feed_word_list, text.text, text.identifier, text.headline)

#path is a directory of files
def scrape(path):
    #files is a list of files, which can processed independently 
    files = create_files_list(path)
    with Pool(2) as p:
        p.map(process_file, files)
    driver.close()
```
It runs into the following exception/error:
```python
Transaction failed and will be retried in 1.0903621073189202s (LockClient[220] can&#39;t wait on resource RWLock[NODE(11398), hash=1487896506] since =&gt; LockClient[220] &lt;-[:HELD_BY]- RWLock[NODE(10846), hash=1926906302] &lt;-[:WAITING_FORsource RWLock[NODE(11398), hash=1487896506] since =&gt; LockClient[220] &lt;-[:HELD_BY]- RWLock[NODE(10846), hash=1926906302] &lt;-[:WAITING_FOR]- LockClient[222] &lt;-[:HELD_BY]- RWLock[NODE(11398), hash=1487896506])
FIXME: should always disconnect before connect
```
My assumption would be that there too many parallel connections which are locking each other. But as far as I understood: ```with Pool(2) as p:``` there are only two parallel executions. So my questions is: How are parallel writes with python and Neo4j possible?",1596270662,https://stackoverflow.com/q/63203270,tschomacker,"['python', 'parallel-processing', 'neo4j', 'bulkinsert', 'cypher']"
63195695,How to use a query parameter for ORDER BY?,"I have a query where I want the results sorted by a field determined by the user. Not an outlandish feature, I&#39;d expect. But I can&#39;t figure out how to do this in Neo4J/Cypher.

This is the basic query:

    MATCH (o:SomeThing)
    ORDER BY o.id
    SKIP 0
    LIMIT 20
    RETURN o

Pretty simple. Except of course `ORDER BY`, `SKIP` and `LIMIT` need to be supplied by the user, so we get this:

    const query = `MATCH (o:SomeThing)
        ORDER BY $order
        SKIP $skip
        LIMIT $limit
        RETURN o`;

    session.run(query, { order: &#39;o.name&#39;, skip: 0, limit: 20 });

This works fine for skip and limit, but `ORDER BY` doesn&#39;t work. It probably doesn&#39;t work because `order` contains a string, whereas we need a field expression. But how do I pass that as a parameter?

The docs aren&#39;t very helpful. It really sounds like this isn&#39;t possible, but that sounds hard to believe for such an obvious use case. So what am I missing?",1596212977,https://stackoverflow.com/q/63195695,mcv,"['cypher', 'neo4j']"
63189271,How to get the relationships in a couple of paths?,"I&#39;m the new to neo4j(stackoverflow too),I have a question that I googled a long time but I can&#39;t find answer.
I want to get the relationships in a couple of paths,I use this cql find 3 paths 

    match p=(a)-[*]-&gt;(b) where id(a)=20 AND id(b)=25 return relationships(p)
Here&#39;s the result
[paths result][1]


  [1]: https://i.stack.imgur.com/ndwVb.png

As you can see,there are few relationship are repetitive.
How can I get the relationship(or count) that not repetitive in the result?",1596187988,https://stackoverflow.com/q/63189271,EZeta,"['cypher', 'neo4j']"
63178904,Convert Natural Language to Cypher queries,"I&#39;m working on creating a knowledge graph of relationships between entities in emails, using neo4j. I now need to convert natural language search queries into cypher queries. I have been unable to find anything concrete with regards to this. How do I proceed?",1596132504,https://stackoverflow.com/q/63178904,Nikhil John,"['neo4j', 'cypher', 'knowledge-graph', 'graph-databases']"
63175424,neo4j query with filter (contains),"i made a query with NEO4j that works fine and quickly **without** filter (Contains + OR/AND conditions) , but when i added the filter the query is stuck and not responding.
Without the filter there is +- 70,000 results
Query example below:

```
MATCH (movie: movie) WHERE  (movie.movie=&quot;xxx_xxxx&quot; )
with movie
MATCH (movie)-[found:found]-&gt;(n:firstName)
with n, movie
MATCH (n)-[:cinema|secondName*0..1]-&gt;(g)-[p:cinema]-&gt;(cinema:cinema)&lt;-[found:found]-(movie)
with n,g,cinema,movie
OPTIONAL MATCH (cinema)-[as:ID]-&gt;(id:ID)&lt;-[found:found]-(movie)
with n,g,cinema,id,movie
OPTIONAL MATCH (id:ID)-[p2:cinema]-&gt;(cinema2:cinema)&lt;-[found:found]-(movie)
with n,g,cinema,id,cinema2
OPTIONAL MATCH path2 = ((cinema:cinema)-[as:ID]-&gt;(id:ID)-[p2:cinema]-&gt;(cinema2:cinema))
with path2,n,g,id,cinema,cinema2
MATCH path = (n)-[:cinema|secondName*0..1]-&gt;(g)-[p:cinema]-&gt;(cinema:cinema)
with n,cinema,path,path2
WHERE
(  (  toLower(n.nickname) CONTAINS toLower(&quot;jhon&quot;) OR
 toLower(g.nickname) CONTAINS toLower(&quot;jhon&quot;) OR
 toLower(cinema.address) CONTAINS toLower(&quot;jhon&quot;)
)   )
return DISTINCT NODES(path)+COALESCE (NODES(path2),[]), RELATIONSHIPS(path)+COALESCE (RELATIONSHIPS(path2),[])
SKIP 0 LIMIT 5
```


Do you have any idea why the filter stuck the query?",1596119587,https://stackoverflow.com/q/63175424,veyobi6284,"['cypher', 'neo4j']"
63164044,How can I import a Cypher query to my Node.js logic?,"I&#39;m not a very experienced developer but I am looking too structure my project so it is easier to work on. 

Lets say I have a function like this: 


    const x = async (tx, hobby) =&gt; {
      const result = await tx.run(
        &quot;MATCH (a:Person) - [r] -&gt; (b:$hobby) &quot; +
        &quot;RETURN properties(a)&quot;,
        { hobby }
      )
      return result
    }

Can I put my cypher query scripts in seperate files, and reference it? I have seen a similar pattern for SQL scripts. 

This is what I&#39;m thinking: 

    const CYPHER_SCRIPT = require(&#39;./folder/myCypherScript.cyp&#39;)
    
    const x = async (tx, hobby) =&gt; {
      const result = await tx.run( 
        CYPHER_SCRIPT,
        { hobby }
      )
      return result
    }

..or will i need to stringify the contents of the .cyp file? 
Thanks",1596065951,https://stackoverflow.com/q/63164044,Blobafet,"['node.js', 'cypher', 'neo4j']"
63160423,Neo4J Match subnodes by relationship,"I have a graph that contains mechanical parts that are composed of other parts, and I want to show a whole composition of a big part. All the relevant nodes in my graph have the &quot;Structure&quot; label, and when one part is composed of other parts there is a &quot;PartProperty&quot; relationship. So I need a query that has a starting point defined by a name such as &quot;Vehicle&quot; or &quot;CombusionEngine&quot; and then it should find all outgoing &quot;PartProperty&quot; relationships from this node. Some of the sub-parts also have sub-parts and some don&#39;t.

Here is an example of the composition:

![][1]

When I just match the relationship I only get the first subelement and when I match the second level, the Elements without substructure will disappear.

  [1]: https://i.stack.imgur.com/2T1oA.jpg",1596048306,https://stackoverflow.com/q/63160423,AlabaSchmallaba,"['cypher', 'neo4j']"
63158937,Pivoting data in Cypher,"I&#39;ve just gotten into working with a Neo4J database, and I&#39;m having a hard time figuring out a good way to pivot some data that I&#39;m working with.

I have a basic query that looks like this:
`MATCH (n:DATA) WHERE n.status =~ &quot;SUCCESS&quot; return n.group as Group, n.label as Label, avg(toFloat(n.durationMillis)/60000) as Minutes`, which produces tall narrow data like this:

```
|Group  |Label  |Minutes|
|-------|-------|-------|
|group1 |label1 |1.0    |
|group1 |label2 |2.0    |
|group1 |label3 |5.0    |
|group2 |label1 |3.0    |
|group2 |label3 |2.0    |
...
```

What I would like to do is pivot this data to provide a short wide view as a summary table:

```
| Group | label1 | label2 | label3 |
| ----- | ------ | ------ | ------ |
|group1 | 1.0    | 2.0    | 5.0    |
|group2 | 3.0    | -      | 2.0    |
...
```

Is there a simple way to do this with Cypher?
",1596042724,https://stackoverflow.com/q/63158937,wcase6,"['neo4j', 'cypher', 'neo4j-apoc']"
63144722,apoc.load.jdbc check row property before create,"I&#39;m using Apoc.load.jdbc to get data from Oracle Database and create row from it, here is the code:
```
call apoc.load.driver(&#39;oracle.jdbc.driver.OracleDriver&#39;)
WITH &quot;jdbc:oracle:thin:@10.82.14.170:1521/ORACLE&quot; as url
CALL apoc.load.jdbc(url,&quot;select * from Patients&quot;,[],{credentials:{user:&#39;KCB&#39;,password:&#39;123&#39;}}) YIELD row
Create (p:Person) set p=row
return p
```
That code work fine but I want to check row property before create it. Such as:
```
If (row.ID!=p.ID) 
{
  set p=row
}
Else{Not set} 
```
How can I do that with my code? Thanks a lot!",1595983281,https://stackoverflow.com/q/63144722,An Duy,"['neo4j', 'cypher']"
63110400,Neo4j: Updating node for multiplte cases,"I am designing a query that can handle updating my node for multiple cases. However, I can&#39;t seem to achieve one particular case. 

Data model: 

Platform for individual owners to sell their cars online The user can buy a car and when they do a calendar node is created with a time stamp as a property (i.e. start_ts). If the user decides to sell the car on a later date, another time stamp is added to the calendar node as a property (i.e. end_ts).

Case:

My issue is when a user has sold his car, but then if the user wants to buy back the car he sold, a new node (Calendar) isn&#39;t created.

Note: I use MERGE instead of CREATE for the case where I want to just update the user da

Query:
 ```
UNWIND $userdata AS user
MATCH (u:User {ID:user.ID})
// Updating properties
SET u += user
WITH u, user

// Check if car is already assigned to another user
OPTIONAL MATCH (cr:Car)&lt;-[:ON]-(cal:Calendar)&lt;-[:BOUGHT]-(us:User)
WHERE NOT EXISTS(cal.end_ts) AND NOT us.ID = user.ID AND cr.ID IN $cars
SET cal.end_ts=datetime()
WITH u

// Check if car is removed
OPTIONAL MATCH (cr:Car)&lt;-[:ON]-(cal:Calendar)&lt;-[:BOUGHT]-(u)
WHERE NOT EXISTS(cal.end_ts) AND NOT cr.ID IN $cars 
SET cal.end_ts=datetime()
WITH u

// Attach car to user
OPTIONAL MATCH (c:Car)
WHERE c.ID IN $cars
FOREACH (ignoreMe IN CASE WHEN c IS NULL THEN [] ELSE [1] END  | MERGE (c)&lt;-[:ON]-(cal:Calendar)&lt;-[:BOUGHT]-(u)
ON CREATE SET cal.start_ts=datetime())
RETURN DISTINCT u AS data
 ```
I am not sure how to solve this issue.
Thanks in advance
",1595834140,https://stackoverflow.com/q/63110400,Tarendran Vivekananda,"['neo4j', 'cypher']"
63104209,Find a number of photos inside a photo album,"I have photo albums and their photos stored in Neo4j. I would like to be able to find one album and get a certain amount of photos. The goal is to lazily load photos as required (pagination).

Now I can do the following to achieve what I want:

    match(p:Photo)-[bt:BELONGS_TO]-&gt;(a:Album) where a.name = &quot;Summer 2019&quot; return a, collect(p)[..4] as photos

However I would like to be able to sort the list of photos by different criteria such as their upload date or creation date. I&#39;m not exactly sure whether this is the best approach to do this.

    match(p:Photo)-[bt:BELONGS_TO]-&gt;(a:Album) where a.name = &quot;Summer 2019&quot; return a, collect(p)[4..] as photos order by p.file_name

Fails and tells me the following:

&gt; In a WITH/RETURN with DISTINCT or an aggregation, it is not possible to access variables declared before the WITH/RETURN: p

I would like to keep the exact same format of the result (one album, one page of photos) if possible so that I don&#39;t have to do complicated mapping inside my application code:

    ╒══════════════════════╤══════════════════════════════════════════════════════════════════════╕
    │&quot;a&quot;                   │&quot;photos&quot;                                                              │
    ╞══════════════════════╪══════════════════════════════════════════════════════════════════════╡
    │{&quot;name&quot;:&quot;Summer 2019&quot;}│[{&quot;file_name&quot;:&quot;cat.jpeg&quot;},{&quot;file_name&quot;:&quot;dog.jpeg&quot;},{&quot;file_name&quot;:&quot;birdi│
    │                      │e.jpeg&quot;},{&quot;file_name&quot;:&quot;bird.jpeg&quot;}]                                   │
    └──────────────────────┴──────────────────────────────────────────────────────────────────────┘

**Is there a clean way to get this format while being able to sort the photos?**",1595788846,https://stackoverflow.com/q/63104209,Selim,"['neo4j', 'cypher']"
63079363,Neo4j - Find missing node to complete circle,"I am trying to get a query that starting from a node, it returns the missing node that, when making a new relation to it, would complete a circle. Also it should respond which is the node that, if the circle is close, will end up having a relationship with the input node. Example:

Let&#39;s say I have B -&gt; C and C -&gt; A. In this case, if I pass A as input, I would like to receive `{ newRelationToMake: B, relationToInputNode: C }` as a result, since connecting A -&gt; B will result in a closed circle ABC and the relation that the node A will be having will come from C.

Ideally, this query should work for a maximum of n depths. For example for a depth of 4, with relations B -&gt; C, C -&gt; D and D -&gt; A, and I pass A as input, I would need to receive `{ newRelationToMake: C, relationToInputNode: D}` (since if I connect A -&gt; C I close the ACD circle) but also receive `{newRelationToMake: B, relationToInputNode: D }`(since if I connect A -&gt; B I would close the ABCD circle).

Is there any query to get this information?

Thanks in advance!",1595614791,https://stackoverflow.com/q/63079363,Nicolas,"['cypher', 'neo4j']"
63078280,Using Multiple With and Where Clauses on an Import for the same Node type,"Is there a way to use multiple where clauses as seen below? Currently it will run and process the first group of *MERGE* clauses after the first *WITH* but the second and third *MERGE* groups after the other *WITH* Clauses do not run. I assume it is because the first *WITH* clauses has a following *WHERE NOT* Clause that filters out what the second and third *WITH* Clauses are requesting?
Anyone know of a way to run this all in one still in one statement? I am running this through Kettle, and for my purpose it must be in a single statement.

    LOAD CSV WITH HEADERS FROM &#39;file:///detail.csv&#39; AS row
    MERGE	(gpath:GranPath {circPathInstID:row.CircPathInstID})
    	ON CREATE SET
    		gpath.circPathHumID = row.CircPathHumID,
    		gpath.category = row.Type,
    	ON MATCH SET
    		gpath.circPathHumID = row.CircPathHumID,
    		gpath.category = row.Type,
    WITH row, gpath
    WHERE NOT gpath.category IN [&#39;ETHERNET&#39;,&#39;PRI TRUNKS&#39;,&#39;CUSTOMER SIP TRUNKS&#39;,&#39;ETHERNET TRANSPORT&#39;, &#39;EPON ETHERNET TRANSPORT&#39;]
    MERGE	(upath:UnmNonEthPath {name:row.CircPathHumID, status:row.CurrentPending})
    MERGE	(upath)-[:DATA_SOURCE {source:&quot;GRANITE&quot;}]-&gt;(gpath)
    WITH row, gpath
    WHERE gpath.category IN [&#39;ETHERNET&#39;,&#39;PRI TRUNKS&#39;,&#39;CUSTOMER SIP TRUNKS&#39;]
    MERGE	(usvc:UnmService {name:row.CircPathHumID, status:row.CurrentPending})
    MERGE	(usvc)-[:DATA_SOURCE {source:&quot;GRANITE&quot;}]-&gt;(gpath)
    WITH row, gpath
    WHERE gpath.category IN [&#39;ETHERNET TRANSPORT&#39;, &#39;EPON ETHERNET TRANSPORT&#39;]
    MERGE	(uxp:UnmTransport {name:row.CircPathHumID, status:row.CurrentPending})
    MERGE	(uxp)-[:DATA_SOURCE {source:&quot;GRANITE&quot;}]-&gt;(gpath)",1595610395,https://stackoverflow.com/q/63078280,MrCash,"['neo4j', 'cypher', 'neo4j-apoc']"
63076269,Getting node/edge creation/removal statistics,"I am running a `Python (3.8)` script which uses `pip` library `neo4j 4.0.0` to interact with a community edition `neo4j 4.1.1` server.

I am running many queries which use `MERGE` to update or create if nodes and relationships don&#39;t exist.
So far this is working well, as the database is getting the data as intended.

From my script&#39;s side, I would like however to know how many nodes and edges were created in each query.
The issue is that in these `Cypher` queries that I send to the database from my script, I call `MERGE` more than one time and also use `APOC` procedures (though the `APOC` ones are just for updating labels, they don&#39;t create entities).

Here is an example of a query:

	comment_field_names: List[str] = list(threads[0].keys())
	cypher_single_properties: List[str] = []
	for c in comment_field_names:
		cypher_single_properties.append(&quot;trd.{0} = {1}.{0}&quot;.format(c, &quot;trd_var&quot;))
	cypher_property_string: str = &quot;, &quot;.join(cypher_single_properties)
	
	
	with driver.session() as session:
		crt_stmt = (&quot;UNWIND $threads AS trd_var &quot;

					&quot;MERGE (trd:Thread {thread_id:trd_var.thread_id}) &quot;
					&quot;ON CREATE SET PY_REPLACE &quot;
					&quot;ON MATCH SET PY_REPLACE &quot;

					&quot;WITH trd AS trd &quot;
					&quot;CALL apoc.create.addLabels(trd, [\&quot;Comment\&quot;]) YIELD node &quot;

					&quot;WITH trd as trd &quot;
					&quot;MERGE (trd)-[r:THREAD_IN]-&gt;(Domain {domain_id:trd.domain_id}) &quot;
					&quot;ON CREATE SET r.created_utc = trd.created_utc &quot;
					&quot;ON MATCH SET r.created_utc = trd.created_utc &quot;

					&quot;RETURN distinct &#39;done&#39; &quot;)
		crt_params = {&quot;threads&quot;: threads}

		# Insert the individual properties we recorded earlier.
		crt_stmt = crt_stmt.replace(&quot;PY_REPLACE&quot;, cypher_property_string)
		
		run_res = session.run(crt_stmt, crt_params)

This works fine and the nodes get created with the properties passed from the `threads` `Dict` which is passed through the variable `crt_params` to `UNWIND`.

However, the `Result` instance in `run_res` does not have any `ResultSummary` inside it with a `SummaryCounters` instance for me to access statistics of created nodes and relations.
I suspect this is because of:

    &quot;RETURN distinct &#39;done&#39; &quot;

However, I am not sure if this is the reason.

Hoping someone may be able to help me set up my queries so that, no matter the number of `MERGE` operations I perform, I get the statistics for the whole query that was sent in `crt_stmt`.

Thank you very much.",1595602893,https://stackoverflow.com/q/63076269,Blitzkoder,"['cypher', 'neo4j', 'neo4j-python-driver']"
63059210,Match by preferred relationship attribute in Cypher,"In a large graph I would like to select the recursive paths, where the relationship matches either value B or value C, like here below

`match path=(a:item)-[rel:refers*]-&gt;(aa:item)
where rel.name= &#39;B&#39; or rel.name=&#39;C&#39; 
return path`

The above statement returns **all** the items when the relationship matches both values, I would like to choose the rel.name = &#39;B&#39; relationship **and only** if rel.name=&#39;B&#39; does not exist go for rel.name=&#39;C&#39;

Is there a way to define this in Cypher, rather than returning everything and then filtering out the unwanted items ?

Thanks",1595522725,https://stackoverflow.com/q/63059210,Branko W,"['neo4j', 'cypher']"
63054479,apoc.path.subgraphAll - How to Set Blacklist and Return Only Wanted Nodes &amp; Relationships,"Further to https://stackoverflow.com/questions/62968588/apoc-path-subgraphall-doesnt-return-a-graph/63009429#63009429 I&#39;m trying to return a sequence of paths using:

    MATCH (av:Architecture_View {`view identifier`:&#39;SV-01&#39;})-[:`HAS PART`]-&gt;(av_child:Architecture_View),(excludedNode:Node:TRAK)
    WHERE excludedNode.name IN [&#39;Software&#39;,&#39;Role&#39;,&#39;Physical&#39;,&#39;Organisation&#39;,&#39;Job&#39;]
    //pattern is (Architecture_View)-[:SUPPLIES]-&gt;(Node)-[:`SUPPLIED TO`]-&gt;(Architecture_View)
    CALL apoc.path.subgraphAll(av,{
    beginSequenceAtStart: true,
    sequence: &quot;Architecture_View,SUPPLIES&gt;,Node,`SUPPLIED TO`&gt;,Architecture_View&quot;,
    blackListNodes:[excludedNode]
    })
    YIELD nodes, relationships
    RETURN nodes, relationships;

The problem with this is that:-
 * the blacklist specified in blackListNodes:[excludedNode] doesn&#39;t work - these nodes are returned in the result set
 * the returned graph includes paths that aren&#39;t in the specified sequence

[![Result Graph - Showing Paths Not in Sequence][1]][1]


  [1]: https://i.stack.imgur.com/i508S.jpg

Is my specification of the sequence and / or blacklist incorrect?",1595507921,https://stackoverflow.com/q/63054479,wikitect,"['cypher', 'neo4j', 'neo4j-apoc']"
63048662,Unable to create fulltext search with eventually_consistent setting,"I am currently getting the error

    Missing kernel to cypher mapping for limitation: EVENTUALLY_CONSISTENT

When I try to create on a node/label that has a fulltext index setup.

Fulltext search index setup code:

    CALL db.index.fulltext.createNodeIndex(
    		&quot;titleAndKeywords&quot;,
    		[
    			...label_names
    		],
    		[
    			...properties
    		],
    		{
    			eventually_consistent : &quot;true&quot;
    		});

Removing the `eventually_consistent` in the creation fixes this

On version 4.0.4",1595487814,https://stackoverflow.com/q/63048662,A. L,"['neo4j', 'cypher']"
63041572,Return non-matching nodes while creating relationships Neo4j Cypher,"I wrote a script to to batch create a bunch of relationship in neo4j. Here is the cypher:

```cypher
:param batch =&gt; [{startId: &#39;abc123&#39;, endId: &#39;abc321&#39;}, {startId: &#39;abc456&#39;, endId: &#39;abc654&#39;]
UNWIND $batch as row
MATCH (from {id: row.startId}
MATCH (to {id: row.endId}
CREATE (from)-[rel:HAS]-&gt;(to)
RETURN rel
```

The problem that there might be some startId/endId entries that don&#39;t match any nodes and are silently ignore. Is there a way to return the list of rows that don&#39;t match any nodes and create the relationship for the nodes that do match?

I tried OPTIONAL MATCH to fail-fast as soon an id doesn&#39;t find a startId/endId however, the query execution was really slow.",1595445201,https://stackoverflow.com/q/63041572,nolio,"['neo4j', 'cypher']"
63040855,Set Property of a Realtionship to label in Neo4j,"I have a few Realtionships in Neo4J with the label &quot;[r:Absatraction]&quot;. They all have a Property on them like &quot;SysML:refine&quot; or &quot;SysML:trace&quot; or &quot;SysML:verify&quot;. 
These &quot;Abstractions connect differently labeled nodes. Now I want Neo4j to replace the Label &quot;Abstraction&quot; with the labels from the &quot;SysML&quot; Property. So that on the graph one can see &quot;[r:refine],[r:verify]...&quot;.
I tried: apoc.create.addLabels, but it only seems to work for nodes.
Is there a way to do that?",1595442343,https://stackoverflow.com/q/63040855,AlabaSchmallaba,"['neo4j-apoc', 'neo4j', 'cypher']"
63034433,Neo4j: Return subtrees in Cypher,"I have a graph database like this one [![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/M4C0w.png

Is there a way to return the two subtrees as a tree structure excluding &quot;B&quot; relationships? My wish is to generate a JSON describing the hierarchical structure of the two subtrees in a format like this

    {
      &quot;graph&quot;:{
        &quot;food&quot;: {
          &quot;attr1&quot;:&quot;some attr&quot;,
          &quot;children&quot;: {
            &quot;pizza&quot;:{
              &quot;attr1&quot;:&quot;some attr&quot;,
              &quot;children&quot;:{
                &quot;pizza1&quot;:{
                  &quot;attr1&quot;:&quot;some attr&quot;
                },
                &quot;pizza2&quot;:{
                  &quot;attr1&quot;:&quot;some attr&quot;
                },
                &quot;pizza3&quot;:{
                  &quot;attr1&quot;:&quot;some attr&quot;
                }
              }
            },
            &quot;pie&quot;:{
              &quot;attr1&quot;:&quot;some attr&quot;,
              &quot;children&quot;:{}}
          }
        },
        &quot;topping&quot;: {
          &quot;attr1&quot;:&quot;some attr&quot;,
          &quot;children&quot;: {
            &quot;meat&quot;:{
              &quot;attr1&quot;:&quot;some attr&quot;,
              &quot;children&quot;:{
                &quot;pepperoni&quot;:{
                  &quot;attr1&quot;:&quot;some attr&quot;
                },
                &quot;beef&quot;:{
                  &quot;attr1&quot;:&quot;some attr&quot;
                }
              }
            },
            &quot;vegetables&quot;:{
              &quot;attr1&quot;:&quot;some attr&quot;,
              &quot;children&quot;:{
                &quot;onion&quot;:{
                  &quot;attr1&quot;:&quot;some attr&quot;
                },
                &quot;eggplant&quot;:{
                  &quot;attr1&quot;:&quot;some attr&quot;
                }
              }
            }
          }
        }
      }
    }

I know there&#39;s APOC plugin for Neo4j but I don&#39;t know if it can be used for something like this.

 ",1595421676,https://stackoverflow.com/q/63034433,Gianluca,"['json', 'neo4j', 'graph', 'tree', 'cypher']"
63033320,Querying nodes based on relationships between two different nodes,"I have a graph with two different types of nodes A and B connected by a relationship rel. It exists such that there may be multiple nodes of A connected to one of B. 
My exact problem is this, suppose I have 2 nodes a1, a2 of type A connected to b1 via the relationship rel. I have node a3 of type A related to node b2. I want to find a node b3 which contains a1, a2 and a3 and then form a relationship between b3 and b2, b1 if they fulfill a property(b3.prop/b2.prop&gt;x &amp; b3.prop/b1.prop&gt;x). Is it possible to write a query in cypher that handles multiple relationships like this? ",1595417905,https://stackoverflow.com/q/63033320,dlman,"['neo4j', 'cypher']"
63006493,Neo4J Not Require Relationship for Query,"I&#39;m using this Query to get Family Tree of a family, It works fine if every branch has 3 generations, but as long as one generation doesn&#39;t have children, it won&#39;t get the children of other branches.
This is my Query
```
Match p=(a:Person)-[a1:PARENT_OF]-&gt;(b:Person)-[b1:PARENT_OF]-&gt;(c:Person) 
where a.ID=&#39;9101&#39;
WITH a,b,a1,b1,{id:c.ID,name:c.TEN,gioitinh:c.GIOI_TINH,loaiqh:b1.type} as thehe1
WITH a,a1,b1,{id:b.ID,name:b.TEN,gioitinh:b.GIOI_TINH,loaiqh:a1.type,loaiqh1:b1.type, children:collect(thehe1)} as thehe2
WITH  {id:a.ID,name:a.TEN,gioitinh:a.GIOI_TINH,loaiqh:a1.type, children:collect(thehe2)} as phahe 
return phahe
```
That happen when one or more Person (b) don&#39;t have Children, that mean Relationship (b1) and (c) don&#39;t exist in that case. Query will return just 2 generations for all Person (b) but But not all (b) don&#39;t have children that make my Query lack of data.

What should I do to make the Relationship (b1) not Require? Sorry for my bad English and Thanks!",1595298693,https://stackoverflow.com/q/63006493,An Duy,"['neo4j', 'cypher']"
63004532,Finding all Leaf Nodes in Neo4j efficiently,"I am trying to write a query in Cypher that returns all leaf nodes given a specific root node. 

Right now I have been using:

    MATCH (root:Node {name: &#39;Name&#39;})&lt;-[:REL *]-(leaf:Node)
    WHERE NOT (leaf)&lt;-[:REL]-()
    RETURN leaf

The problem with this query is that as the database becomes larger, it becomes exponentially slower because every single possible leaf node that connects to my root is checked in the not clause. To omit the not clause, I can return the entire path like this:

    MATCH p=(root:Node {name: &#39;Name&#39;})&lt;-[:REL *]-(leaf:Node) 
    RETURN p

The second query is a lot faster as the number of nodes/relationships in the graph increases, but I would prefer to return just the leaf nodes instead of the path.      

Is there a way to run this query more efficiently on a larger data set?",1595283091,https://stackoverflow.com/q/63004532,Matthew Daniel,"['neo4j', 'graph-theory', 'cypher']"
63003328,Get data from neo4j,"I am writing code to retreive data  from neo4j using scala. My code is as follows:

    def getData(type: String): mutable.Buffer[String] = {
        val driver  = getDriverInsatnce()
        val session = driver.session
          val query=
            s&quot;&quot;&quot;
               |MATCH (a:$type)
               |RETURN a.Id as Id
               |&quot;&quot;&quot;.stripMargin
    
          val result = session.run(query)
          val Ids= result.list().asScala.map(s =&gt; s.get(&quot;Id&quot;).asString())
        session.close()
        return Ids
      }

It gives me result sometimes. Means it  returns Id sometimes but sometime it returns Empty ArrayBuffer(). How can I correct it?",1595276976,https://stackoverflow.com/q/63003328,user8996213,"['cypher', 'neo4j', 'scala']"
62998373,Neo4j Cypher select where exists query,"I have a graph structure like this:[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/SMnZU.png

I need to select all `ContentItem` nodes they have any connections with the other nodes.

I am also passing in a list of ids for each of the nodes for filtering purposes.  i.e. I pass in a list of the neo4j ids for the items I wish to INCLUDE in the search.  Any `ContentItem` that is related to any of the other nodes which have an id passed in should return.

I&#39;ve tried with a UNION as this felt like the simplest way, but I&#39;m not sure that it&#39;s correct.

    MATCH (n:ContentItem) WHERE id(n) IN $neoIds
    WITH n
    OPTIONAL MATCH (n:ContentItem)-[:IN]-&gt;(pt:PulseTopic) WHERE id(pt) IN $pulseTopics RETURN n
    UNION
    OPTIONAL MATCH (n:ContentItem)-[:IN]-&gt;(pst:SubPulseTopic) WHERE id(pst) IN $subPulseTopics RETURN n
    UNION
    OPTIONAL MATCH (n:ContentItem)-[:FROM]-&gt;(s:Supplier) WHERE id(s) IN $suppliers RETURN n
    UNION
    OPTIONAL MATCH (n:ContentItem)-[:USED_FOR]-&gt;(ua:UseArea) WHERE id(ua) IN $useAreas RETURN n
    UNION
    OPTIONAL MATCH (n:ContentItem)-[:IN]-&gt;(blt:BLTopic) WHERE id(blt) IN $blTopics RETURN n

Firstly when I reference the record in python I get an error:

    for r in tx.run(cypherStep2, paramsStep2):
        d = r[&#39;n&#39;][&#39;id&#39;]

...gives:

`TypeError: &#39;NoneType&#39; object is not subscriptable`

I&#39;m not sure why that would be.  If I just do `MATCH (n:ContentItem) WHERE id(n) IN $neoIds RETURN n` I don&#39;t get this error, so I&#39;m thinking this is something to do with the `UNION`.

And secondly, I am wondering if this will actually filter ContentItem on `$neoIds` passed in or whether `OPTIONAL MATCH (n:ContentItem)` means ANY `ContentItem` in the `UNION`.

What is the best way to do a query like this, please?",1595257530,https://stackoverflow.com/q/62998373,Doug,"['neo4j', 'cypher']"
62991817,How to WHERE a param that is an array,"So I have the following code:

    MATCH 
    	(a:Account {
    		id : $account_id
    	})
    	-[:OWNER]-&gt;
    	(p:Project)
    	WHERE
    		p.id IN $ids
    RETURN p

Params

    account_id : string
    ids : Array&lt;string&gt;

How do I only return matching Project nodes where their id is contained in the $ids param?",1595235083,https://stackoverflow.com/q/62991817,A. L,"['neo4j', 'cypher']"
62990642,delete all edges of a certain type,"I have a neo4j database that has nearly 5 million nodes and 12 million edges. I want to delete a type (*UsedAt*) of edge (relationship). There are nearly 3 million edges of the type *&quot;UsedAt&quot;*.

I&#39;m writing a query like 

`match ()-[e:UsedAt]-&gt;() delete e`

This takes too much time. Never stops.

I also tried
`CALL apoc.periodic.iterate(&quot;match ()-[e:UsedAt]-&gt;() return e&quot;, &quot;delete e&quot;, {batchSize:1000, parallel:true})`

That also never stops. How can I delete all edges (relationships) of a certain type efficiently on a relatively large database?",1595230611,https://stackoverflow.com/q/62990642,canbax,"['cypher', 'neo4j', 'graph-databases']"
62975957,Neo4j- APOC trigger fires without any reason,"I have the following two triggers named &#39;loadEnrollments&#39; and &#39;loadDeenrollments&#39;.

    CALL apoc.trigger.add(&#39;loadEnrollments&#39;,
    &quot;UNWIND apoc.trigger.nodesByLabel($assignedLabels, &#39;Enrollment&#39;) AS node
     MERGE (p1:SPerson { name: node.name, cell: node.cell, created_at: node.created_at})
     WITH p1, node
     MATCH (n:SPerson)
     WITH node, COUNT(n) as size
     CALL apoc.do.when(
     size&gt;3,
     &#39;
     MATCH(p1:SPerson),(c:Course)
     WHERE p1.name=node.name AND c.name=\&quot;Paradigm Shifting 101\&quot;
     CREATE (p1)-[:Waitlist]-&gt;(c)
	 SET p1.status=2
     WITH node
     RETURN NULL&#39;,
     &#39;
     MATCH(p1:SPerson),(c:Course)
     WHERE p1.name=node.name AND c.name=\&quot;Paradigm Shifting 101\&quot;
     CREATE (p1)-[:Enrolled]-&gt;(c)
	 SET p1.status=1
     WITH node
     RETURN NULL&#39;, {node:node}) YIELD value
     DETACH DELETE node&quot;,

     { phase: &#39;after&#39; })



    CALL apoc.trigger.add(&#39;loadDeenrollments&#39;,
    &quot;
    UNWIND apoc.trigger.nodesByLabel($assignedLabels, &#39;Deenrollment&#39;) AS node
     MATCH (p1:SPerson {name: node.name, cell: node.cell})
     MATCH (c:Course {name: &#39;Paradigm Shifting 101&#39;})
     CREATE (p1)-[:Deenrolled]-&gt;(c)
	   SET p1.status=3
     WITH p1, node,c
     MATCH (p1:SPerson {name: node.name, cell: node.cell})-[r:Enrolled]-&gt;(c)
     DELETE r
     DETACH DELETE node
     WITH p1,c
     MATCH (p1)-[r:Enrolled]-&gt;(c)
     WITH COUNT(r) as k
     CALL apoc.do.when(
     k&lt;3,     &#39;
      MATCH (p1:SPerson)-[:Waitlist]-&gt;(c:Course)
      WITH min(p1.created_at) AS min
      MATCH (p1:SPerson),(c:Course)
      WHERE p1.created_at = min
      CREATE (p1)-[:Random]-&gt;(c)
      RETURN p1,c&#39;,
     &#39;
     MATCH (n:SPerson) RETURN n
     &#39;,{k:k}
     ) YIELD value
     RETURN NULL&quot;,

     { phase: &#39;after&#39; })


When I load both of them and create a &#39;Enrollment&#39; nodes by the following commands. The &#39;loadenrollment&#39; trigger works as desired and create SPerson nodes for cat1,cat2 and cat3 and creates an &#39;enrolled&#39; relationship with the &#39;course&#39; node.


    CREATE (:Enrollment { name: &quot;cat1&quot;, cell: &quot;123&quot;, created_at: TIMESTAMP()});
    CREATE (:Enrollment { name: &quot;cat2&quot;, cell: &quot;123&quot;, created_at: TIMESTAMP()});
    CREATE (:Enrollment { name: &quot;cat3&quot;, cell: &quot;123&quot;, created_at: TIMESTAMP()});

The Problem occurs when I create the 4th node 

    CREATE (:Enrollment { name: &quot;cat4&quot;, cell: &quot;123&quot;, created_at: TIMESTAMP()});
Ideally, it should create a SPerson node for cat4 and add a &#39;waitlist&#39; relationship with the &#39;course&#39; node.
But for some reason when I create that node it adds the &#39;waitlist&#39; relationship but also adds the &#39;Random&#39; relationship that I defined in the second trigger(&#39;loadDeenrollments&#39;). This should never happen as this trigger would only trigger when I create a &#39;Deenrollment&#39; node but for some reason it is executing that trigger.

Also, I tried adding just the &#39;loadEnrollments&#39; trigger and it works as desired(obviously, as there is no &#39;loadDeenrollments&#39; trigger) i.e. creating the four &#39;SPerson&#39; nodes and with three nodes having &#39;enrolled&#39; relationship and one having &#39;waitlist&#39; relationship.

I don&#39;t know whats&#39;s wrong. Any help is appreciated!",1595129708,https://stackoverflow.com/q/62975957,Mohammed Faraz ali,"['neo4j', 'neo4j-apoc', 'cypher']"
62967428,Handling parameterised order by filters within neo4j cypher,"I am working on the cypher below but I am not sure how to implement parameterised sorting. I want to sort with the parameters $field and $sort where $field could be: &#39;species.name&#39;, &#39;species.description&#39;, &#39;species.scientificName&#39;, &#39;monthCount&#39;, &#39;eats&#39;  or &#39;eatenBy&#39; and $sort is only &#39;asc&#39; or &#39;desc&#39;. If either of those values is hardcoded then the cypher runs but when passed as a parameter it fails. Any help would be greatly appreciated! :)


```
MATCH (s:Species)
  WHERE toLower(s.name) CONTAINS toLower($search)

WITH s

OPTIONAL MATCH (s)-[e:EATS]-&gt;(eatsSpecies:Species)
OPTIONAL MATCH (s)&lt;-[:EATEN_BY]-(eatenBySpecies:Species)
OPTIONAL MATCH (s)&lt;-[:IS_ABOUT]-(image:Image)
OPTIONAL MATCH (s)-[:FALLS_UNDER]-&gt;(primary:Primary)
OPTIONAL MATCH (s)-[:MEASURED_BY]-&gt;(month:Month)

WITH s, eatsSpecies, eatenBySpecies, image, primary, month

WITH s,
     count(DISTINCT eatsSpecies.name) AS eats,
     count(DISTINCT eatenBySpecies.name) AS eatenBy,
     primary,
     image,
     count(distinct month) as monthCount

WITH {
       name:              s.name,
       scientificName:    s.scientificName,
       description:       s.description,
       primary:           case when exists(primary.GUID) then true else false end,
       active:            case when exists(s.active) then s.active else true end,
       months:            monthCount,
       guid:              s.GUID,
       eats:              eats,
       eatenBy:           eatenBy,
       image: case when exists(image.url) then true else false end
     } AS species order by $field $sort

SKIP $skip
LIMIT $limit

RETURN collect(species)

```",1595067940,https://stackoverflow.com/q/62967428,helomelo,"['neo4j', 'graph-databases', 'cypher']"
62952768,attach debugger to neo4j procedure jar,"I&#39;m developing [a neo4j procedure in java][1]. I can test it with the custom data below.

```
@Test
public void commonTargetTest2() {
    // This is in a try-block, to make sure we close the driver after the test
    try (Driver driver = GraphDatabase.driver(embeddedDatabaseServer.boltURI(), driverConfig);
            Session session = driver.session()) {
        // And given I have a node in the database
        session.run(
                &quot;CREATE (n1:Person {name:&#39;n1&#39;}) CREATE (n2:Person {name:&#39;n2&#39;}) CREATE (n3:Person {name:&#39;n3&#39;}) CREATE (n4:Person {name:&#39;n4&#39;}) CREATE (n5:Person {name:&#39;n5&#39;})&quot;
                        + &quot;CREATE (n6:Person {name:&#39;n6&#39;}) CREATE (n7:Person {name:&#39;n7&#39;}) CREATE (n8:Person {name:&#39;n8&#39;}) CREATE (n9:Person {name:&#39;n9&#39;}) CREATE (n10:Person {name:&#39;n10&#39;})&quot;
                        + &quot;CREATE (n11:Person {name:&#39;n11&#39;}) CREATE (n12:Person {name:&#39;n12&#39;}) CREATE (n13:Person {name:&#39;n13&#39;})&quot;
                        + &quot;CREATE (n14:Person {name:&#39;n14&#39;}) CREATE &quot;
                        + &quot;(n1)-[:KNOWS]-&gt;(n6),(n2)-[:KNOWS]-&gt;(n7),(n3)-[:KNOWS]-&gt;(n8),(n4)-[:KNOWS]-&gt;(n9),(n5)-[:KNOWS]-&gt;(n10),&quot;
                        + &quot;(n7)-[:KNOWS]-&gt;(n11),(n8)-[:KNOWS]-&gt;(n12),(n9)-[:KNOWS]-&gt;(n13),&quot;
                        + &quot;(n11)-[:KNOWS]-&gt;(n14),(n12)-[:KNOWS]-&gt;(n14),(n13)-[:KNOWS]-&gt;(n14);&quot;);

        // name of the procedure I defined is &quot;p1&quot;, below I&#39;m calling it in cypher
        StatementResult result = session
                .run(&quot;CALL p1([1,3], [], 3, 0) YIELD nodes, edges return nodes, edges&quot;);

        InternalNode n = (InternalNode) result.single().get(&quot;nodes&quot;).asList().get(0);
        assertThat(n.id()).isEqualTo(13);
    }
}
```

This works fine but the data is newly generated with `CREATE` statements and it is very small. I want to test my procedure with an existing neo4j database server. So that I can see the performance/results of my procedure with real/big data.

I can also achieve that with the below code. I can connect to an up and running neo4j database.
```
@Test
public void commonTargetTestOnImdb() {
    // This is in a try-block, to make sure we close the driver after the test
    try (Driver drv = GraphDatabase.driver(&quot;bolt://localhost:7687&quot;, AuthTokens.basic(&quot;neo4j&quot;, &quot;123&quot;));
            Session session = drv.session()) {

        // find 1 common downstream of 3 nodes
        StatementResult result = session.run(
                &quot;CALL commonStream([1047255, 1049683, 1043696], [], 3, 2) YIELD nodes, edges return nodes, edges&quot;);

        InternalNode n = (InternalNode) result.single().get(&quot;nodes&quot;).asList().get(0);
        assertThat(n.id()).isEqualTo(5);
    }

}
```

**NOW**, my problem is that I can&#39;t debug the codes of my procedure if I connect to an existing database. I package a JAR file and put it inside `plugin` folder of my neo4j database so that neo4j can call my procedure. I think I should debug the JAR file. I&#39;m using vscode and java extensions to debug and run tests. How can I debug JAR file with vscode?
 
  [1]: https://neo4j.com/docs/java-reference/current/extending-neo4j/procedures-and-functions/introduction/",1594984244,https://stackoverflow.com/q/62952768,canbax,"['unit-testing', 'cypher', 'neo4j', 'testing', 'java']"
62952566,Match pairs of nodes with reciprocal relationships,"I have a data model where nodes of the same label are connected by relationships of the same type:

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/NOXlt.png

There is no hierarchy or &#39;logic&#39; which of the `:Concept` nodes is the start node of the reciprocal relationship.

My goal is to get all unique pairs of nodes. Wen you match on the `:Concept` nodes, you get two pairs, one starting at `123` the other starting at `234`:

    MATCH (c1:Concept)-[:REL]-&gt;(c2:Concept)
    RETURN [c1.concept_id, c2.concept_id]

Result:

    [123, 234]
    [234, 123]

Is there a way to get each pair only once? The order of the pairs does not matter.",1594983468,https://stackoverflow.com/q/62952566,Martin Preusse,"['neo4j', 'cypher']"
62943204,Neo4j- questions on Syntax apoc trigger,"I have the following APOC trigger which contains a apoc procedure. This works as desired but I am wondering if I used a lot of WITH statements, is that the way to go? or is there a better way to refactor this code. I am still new to neo4j so not sure.

The control flow- Whenever the Enrollment node is created, it creates an SPerson node and depending on the size(number of SPerson nodes) it creates an enrolled or waitlist(if size&gt;3, and deletes enrolled relation) relation with the course node.  

    CALL apoc.trigger.add(&#39;loadEnrollments&#39;,   
    &quot;UNWIND apoc.trigger.nodesByLabel($assignedLabels, &#39;Enrollment&#39;) AS node
     MERGE (p1:SPerson { name: node.name, cell: node.cell, created_at: node.created_at})
     WITH p1, node
     MATCH (c:Course {name: &#39;Paradigm Shifting 101&#39;})
     WITH node
     MATCH (n:SPerson)
     WITH node, COUNT(n) as size
     CALL apoc.do.when(
     size&gt;3,
     &#39;MATCH(p1:SPerson),(c:Course) 
     WHERE p1.name=node.name
     CREATE (p1)-[:Waitlist]-&gt;(c)
     WITH p1,c 
     MATCH (e:Enrollment) DETACH DELETE e&#39;,
     &#39;MATCH(p1:SPerson),(c:Course) 
     WHERE p1.name=node.name
     CREATE (p1)-[:Enrolled]-&gt;(c)
     WITH p1,c 
     MATCH (e:Enrollment) DETACH DELETE e&#39;, {node:node}) YIELD value
     DETACH DELETE node&quot;, 
     
     { phase: &#39;after&#39; });",1594932271,https://stackoverflow.com/q/62943204,Mohammed Faraz ali,"['neo4j', 'neo4j-apoc', 'cypher']"
62941820,Can&#39;t match-where-limit in Cypher?,"It&#39;s a simple query, but for some reason it&#39;s not working


```cypher
SELECT (n:myBaseLabel) WHERE NOT n:myPossibleSubLabel LIMIT 20
```

This is the most simple case, where I really don&#39;t care what gets returned. The objective is to run

```cypher
SELECT (n:myBaseLabel) WHERE NOT n:myPossibleSubLabel AND NOT n:myExclusionLabel SET n:myExclusionLabel LIMIT 25000
```

in a loop to iteratively apply the label `myExclusionLabel` to instances of `myBaseLabel` that don&#39;t have `myPossibleSubLabel`. Both the iterative loop and the existence of this exclusion label are for performance reasons in querying the graph, since it has ~50M nodes. Since I&#39;m looping and excluding, I don&#39;t care about which get tagged in a given loop, I just want to reduce the memory load while breaking the execution into chunks so I don&#39;t entirely lock up the database for a day updating this.

However, in the simple test case I keep getting an error at the `I` of `LIMIT`, saying:

&gt; Invalid input &#39;I&#39;: expected &#39;o/O&#39; (line 1, column 58 (offset: 57))

which makes no sense to me.",1594926112,https://stackoverflow.com/q/62941820,Philip Kahn,"['cypher', 'neo4j']"
62921178,Neo4j Optimizing query to get all distinct tags,"I&#39;ve a list of Questions and tags in my database with the following relationship.

    (q:Question)-&gt;[:HAS_TAG]-&gt; (t:Tag)

I&#39;m running a query to get all tags which are present on some questions.

    MATCH (q:Question),(t:Tag)
    WHERE q.id &lt; 2 AND (q)-[:HAS_TAG]-&gt;(t)
    return DISTINCT(t.name)

When I run the profile I can see that although the results has only 5 tags, it is scanning all the Tags. Is there a way to optimize this?

I&#39;m new to Graph databases so couldn&#39;t figure out a way to optimize this. I&#39;m already having an index on `Tag.name` and `Question.id`.




[![profile results][1]][1]


  [1]: https://i.stack.imgur.com/fwDBb.png",1594836373,https://stackoverflow.com/q/62921178,Avi Yadav,"['cypher', 'neo4j']"
62900832,Neo4j Syntax Exception while creating an apoc procedure inside a apoc trigger,"I am creating an apoc procedure inside a apoc trigger. The error in the logs says this 

&quot;
org.neo4j.exceptions.SyntaxException: Variable `node` not defined (line 1, column 26 (offset: 25))
&quot;MATCH(p1:SPerson { name: node.name}) CREATE (p1)-[:Enrolled]-&gt;(c)&quot; 

&quot;

My apoc trigger code

     CALL apoc.trigger.add(&#39;loadEnrollments&#39;,   
    &quot;UNWIND apoc.trigger.nodesByLabel($assignedLabels, &#39;Enrollment&#39;) AS node
     MERGE (p1:SPerson { name: node.name, cell: node.cell, created_at: node.created_at})
     WITH p1, node
     MATCH (c:Course {name: &#39;Paradigm Shifting 101&#39;})
     MATCH (n:SPerson)
     WITH p1, node, COUNT(n) as size
     CALL apoc.do.when(
     size&gt;3,&#39;MERGE (p1)-[:Waitlist]-&gt;(c)&#39;,
     &#39;MATCH(p1:SPerson { name: node.name}) CREATE (p1)-[:Enrolled]-&gt;(c)&#39;) YIELD value
     DETACH DELETE node&quot;, 
     { phase: &#39;after&#39; });
",1594748113,https://stackoverflow.com/q/62900832,Mohammed Faraz ali,"['neo4j-apoc', 'cypher', 'neo4j']"
62891218,apoc.cypher.run subquery same result for all nodes,"please i hope you can help me with this query

    MATCH
    (user:users)-[watch:WATCH]-&gt;(m:Movies)
    where
     m.genre = 2 and
     watch.date &gt;= date({year: 2020, month: 06, day: 01}) 
     CALL apoc.cypher.run(&#39;
    	with $m as m
    	MATCH (m)&lt;-[watches_too:WATCH]-(user2:users)-[:WATCH]-&gt;(m2:Movies)
    	WHERE
    		m2.duration &gt; 50 and
    		m2.genre = 2 and
    		m.id &lt;&gt; m2.id and
    		m.subgenre = m2.subgenre and
    		watches_too.date&gt;= date({year: 2020, month: 06, day: 01})
    	RETURN m2, count(m2.id) as ocurrences
    	ORDER by ocurrences DESC
    	LIMIT 4&#39;,
    	{m:m}) YIELD value
    RETURN
     user.id, value.m2.id;

The query &quot;works&quot; mostly as I wanted, gives me movies other users watched that also watched the movie of the first user, limiting to 4 results per user, but I noticed it gives me the same 4 movies for all users...

am I doing something wrong or is it really those 4 movies the most watched per that genre?",1594715999,https://stackoverflow.com/q/62891218,user2919673,"['neo4j', 'cypher']"
62889773,Cypher: Very slow relationship creation (UNWIND),"I am using the neo4j python API and connecting to a local database. I have a graph which contains 700.000 nodes. I can very quickly create the nodes by using:

    with session.begin_transaction() as tx: 
        cypher_query = &#39;UNWIND $batch as row &#39; \
        &#39;CREATE (n:Node) &#39; \
        &#39;SET n += row&#39;
        tx.run(cypher_query, batch=batch)

The graph presents 4M relationships, and I am trying to create them in the following way:

    with session.begin_transaction() as tx: 
        cypher_query = &#39;UNWIND $batch as row &#39; \
        &#39;MATCH (head:Node) WHERE head.id = row.head_id &#39; \
        &#39;MATCH (tail:Node) WHERE tail.id = row.tail_id &#39; \
        &#39;CREATE (head)-[rel:RELATIONSHIP]-&gt;(tail) &#39; \
        &#39;SET rel += row.properties&#39;
        tx.run(cypher_query, batch=batch)

The batch size is 10K.
The creation of the relationships is extremely slow. I calculated that it&#39;d take around 30 days. Do you know a work around? Is it normal for it to be so slow?",1594710480,https://stackoverflow.com/q/62889773,Filippo Grazioli,"['neo4j', 'cypher']"
62875225,exponential performance cost on aggregated function,"I have this query

    MATCH
    (user:Users)-[watched:WATCH]-&gt;(movie1:MOVIES)&lt;-[watches_too:WATCH]-(user2:Users)-[watches_other:WATCH]-&gt;(movie2:MOVIES)
    where
     movie1.genre = &quot;action&quot; and
     movie1.title &lt;&gt; movie2.title and
     movie1.subgenre = movie2.subgenre and
     watched.date &gt;= date({year: 2020, month: 06, day: 01}) and
     watches_too.date &gt;= date({year: 2020, month: 06, day: 01})
    RETURN
     user.id, movie2.title
    LIMIT 100;

That query works, but it just return a movie2 title with almost no value, so I tried another aproach

    MATCH
    (user:Users)-[watched:WATCH]-&gt;(movie1:MOVIES)&lt;-[watches_too:WATCH]-(user2:Users)-[watches_other:WATCH]-&gt;(movie2:MOVIES)
    where
     movie1.genre = &quot;action&quot; and
     movie1.title &lt;&gt; movie2.title and
     movie1.subgenre = movie2.subgenre and
     watched.date &gt;= date({year: 2020, month: 06, day: 01}) and
     watches_too.date &gt;= date({year: 2020, month: 06, day: 01})
    RETURN
     user.id, movie2.title, count(movie2) as ocurrence
     ORDER BY user.id, ocurrence DESC
    LIMIT 100;

This way i tried to get the most watched movie by other users who also watched the same movie, but while the first query returns me in seconds results, the second took almost 2 hours to finish

Am I doing the aggregation wrong?


Also, while at it, the results went like 50 results for 1 user and 50 for another one, if I wanted to limit it to 2-3 movies per user?

Thank you for the help",1594640985,https://stackoverflow.com/q/62875225,user2919673,"['neo4j', 'cypher']"
62874069,Neo4j:Delete all relationships except for those in list,"I am trying to delete all relationships to a node except those that are in a list. I have already create a node (:Person {name: &#39;John&#39;}) and 4 other nodes (:Car). Then I MERGE all the car nodes to the person node. I then want to delete all the relationships for the person node except for those in a list (shown below)

``` 
UNWIND [{name:&#39;test1&#39;}, {name:&#39;test2&#39;}] AS test
MATCH (p:Person {name:&#39;John&#39;})
OPTIONAL MATCH (p)-[d:DRIVES]-&gt;(c:Car)
WHERE NOT EXISTS((p)-[:DRIVES]-&gt;(c:Car {name:test.name}))
DELETE d
RETURN p 
```
However the query above deletes all relationships but when I reduce the list to include only 1 car node, the above query works (i.e. the query only works when the list contains only 1 node and doesn&#39;t work when the list is larger). I am not sure why this is the case.

I am using neo4j 4.1.
Thanks in advance.",1594636663,https://stackoverflow.com/q/62874069,Tarendran Vivekananda,"['neo4j', 'cypher']"
62871443,even after null check why I am getting null value in neo4j?,"I have tried the following query, wherein I am trying to get the person who has contact and if that contact directed a movie then movie name. in this, I am trying to avoid null for movie names.

but below query is not working, **I have even tried IS NOT NULL.** and m.title &lt;&gt; NULL
 
    MATCH (a:Person)-[:HAS_CONTACT]-&gt;(b)
    OPTIONAL MATCH (b)-[:DIRECTED]-&gt;(m:Movie)
    WHERE m &lt;&gt; NULL
    RETURN a.name, b.name,m.title
    LIMIT 1


RESULT:

    	a.name	b.name	m.title
    &quot;Keanu Reeves&quot;	&quot;Rita Wilson&quot;	null",1594626761,https://stackoverflow.com/q/62871443,Nikhil Kulkarni,"['cypher', 'neo4j']"
62867601,How do I qualify and name a relationship in Neo4j APOC?,"
We have two seperate files loading neo4j using APOC. The first, loads the nodes up and that seems to be working correctly. Now I need to load the relationships. I have this json file coming in. 

    {
	&quot;0&quot;: {
		&quot;child&quot;: &quot;54690&quot;,
		&quot;compile&quot;: &quot;webgoat.combined.source&quot;,
		&quot;parent&quot;: &quot;0&quot;,
		&quot;tree&quot;: &quot;runs&quot;
	},
	&quot;1&quot;: {
		&quot;child&quot;: &quot;2&quot;,
		&quot;compile&quot;: &quot;webgoat.combined.source&quot;,
		&quot;parent&quot;: &quot;1&quot;,
		&quot;tree&quot;: &quot;calls&quot;
	},

parent and child are the two nodes that need to be connected. The name of the relationship needs to be based on **tree**, and qualified based on the **compile** field. In other words, I need the relationship created only where parent-child share the same compile string. 

This is the APOC command I have so far:

        with graphDB_Driver.session() as ses:
            ses.run(&quot;UNWIND $batch AS row MATCH (a:ProgNode{parent:row.a}) MATCH (b:ProgNode{child:row.b}) CALL apoc.merge.relationship(a, &#39;TREE&#39;, {}, apoc.map.removeKeys(properties(row), [&#39;parent&#39;, &#39;child&#39;]), b) YIELD rel RETURN 1&quot;, batch=BATCH[&quot;batch&quot;])

 

I have tried substituting a variety of variable names for &quot;TREE&quot; including row.tree, tree:row.a but nothing seems to work. I have verified that BATCH[&#39;batch&#39;] below contains the same data . 

    [{&quot;child&quot;: &quot;54690&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;0&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 0}, {&quot;child&quot;: &quot;2&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;1&quot;, &quot;tree&quot;: &quot;calls&quot;, &quot;from&quot;: 1}, {&quot;child&quot;: &quot;101&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;100&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 100}, {&quot;child&quot;: &quot;1001&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;1000&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 1000}, {&quot;child&quot;: &quot;10001&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10000&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10000}, {&quot;child&quot;: &quot;10004&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10003&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10003}, {&quot;child&quot;: &quot;10009&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10004&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10004}, {&quot;child&quot;: &quot;10007&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10005&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10005}, {&quot;child&quot;: &quot;10008&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10007&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10007}, {&quot;child&quot;: &quot;1005&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;1001&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 1001}, {&quot;child&quot;: &quot;1003&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;1002&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 1002}, {&quot;child&quot;: &quot;10028&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10022&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10022}, {&quot;child&quot;: &quot;10025&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10023&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10023}, {&quot;child&quot;: &quot;10026&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10025&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10025}, {&quot;child&quot;: &quot;10041&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10028&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10028}, {&quot;child&quot;: &quot;10034&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10029&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10029}, {&quot;child&quot;: &quot;10031&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10030&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10030}, {&quot;child&quot;: &quot;10040&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10035&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10035}, {&quot;child&quot;: &quot;10037&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10036&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10036}, {&quot;child&quot;: &quot;10051&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10041&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10041}, {&quot;child&quot;: &quot;10044&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10042&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10042}, {&quot;child&quot;: &quot;10045&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10044&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10044}, {&quot;child&quot;: &quot;10046&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10045&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10045}, {&quot;child&quot;: &quot;10050&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10048&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10048}, {&quot;child&quot;: &quot;10052&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10051&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10051}, {&quot;child&quot;: &quot;10071&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10052&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10052}, {&quot;child&quot;: &quot;10054&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10053&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10053}, {&quot;child&quot;: &quot;10061&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10054&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10054}, {&quot;child&quot;: &quot;10057&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10055&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10055}, {&quot;child&quot;: &quot;10059&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10057&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10057}, {&quot;child&quot;: &quot;10060&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10059&quot;, &quot;tree&quot;: &quot;calls&quot;, &quot;from&quot;: 10059}, {&quot;child&quot;: &quot;1007&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;1006&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 1006}, {&quot;child&quot;: &quot;10063&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10062&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10062}, {&quot;child&quot;: &quot;10065&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10063&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10063}, {&quot;child&quot;: &quot;10067&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10065&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10065}, {&quot;child&quot;: &quot;10068&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10067&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10067}, {&quot;child&quot;: &quot;10070&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10068&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10068}, {&quot;child&quot;: &quot;1009&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;1007&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 1007}, {&quot;child&quot;: &quot;10072&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10071&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10071}, {&quot;child&quot;: &quot;10074&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10072&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10072}, {&quot;child&quot;: &quot;10102&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10088&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10088}, {&quot;child&quot;: &quot;10090&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10089&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10089}, {&quot;child&quot;: &quot;1011&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;1009&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 1009}, {&quot;child&quot;: &quot;10093&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10091&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10091}, {&quot;child&quot;: &quot;10094&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10093&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10093}, {&quot;child&quot;: &quot;10097&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10095&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10095}, {&quot;child&quot;: &quot;10098&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10097&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10097}, {&quot;child&quot;: &quot;10100&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10098&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10098}, {&quot;child&quot;: &quot;103&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;101&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 101}, {&quot;child&quot;: &quot;10261&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10102&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10102}, {&quot;child&quot;: &quot;10107&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10103&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10103}, {&quot;child&quot;: &quot;10106&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10105&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10105}, {&quot;child&quot;: &quot;10129&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10107&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10107}, {&quot;child&quot;: &quot;10115&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10108&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10108}, {&quot;child&quot;: &quot;10110&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10109&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10109}, {&quot;child&quot;: &quot;1013&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;1011&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 1011}, {&quot;child&quot;: &quot;10114&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10112&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10112}, {&quot;child&quot;: &quot;10116&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10115&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10115}, {&quot;child&quot;: &quot;10117&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10116&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10116}, {&quot;child&quot;: &quot;10118&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10117&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10117}, {&quot;child&quot;: &quot;10126&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10119&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10119}, {&quot;child&quot;: &quot;10121&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10120&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10120}, {&quot;child&quot;: &quot;10125&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10123&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10123}, {&quot;child&quot;: &quot;10127&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10126&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10126}, {&quot;child&quot;: &quot;10128&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10127&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10127}, {&quot;child&quot;: &quot;10138&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10129&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10129}, {&quot;child&quot;: &quot;10131&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10130&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10130}, {&quot;child&quot;: &quot;10137&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10133&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10133}, {&quot;child&quot;: &quot;10135&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10134&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10134}, {&quot;child&quot;: &quot;10136&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10135&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10135}, {&quot;child&quot;: &quot;10139&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10138&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10138}, {&quot;child&quot;: &quot;10151&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10139&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10139}, {&quot;child&quot;: &quot;1045&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;1014&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 1014}, {&quot;child&quot;: &quot;10141&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10140&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10140}, {&quot;child&quot;: &quot;10143&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10141&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10141}, {&quot;child&quot;: &quot;10145&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10143&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10143}, {&quot;child&quot;: &quot;10146&quot;, &quot;compile&quot;: &quot;webgoat.combined.source&quot;, &quot;parent&quot;: &quot;10145&quot;, &quot;tree&quot;: &quot;runs&quot;, &quot;from&quot;: 10145}, 

Thoughts ?",1594598371,https://stackoverflow.com/q/62867601,billDickens,"['cypher', 'neo4j-apoc', 'neo4j']"
62860498,Skip reverse path in neo4j query,"I have an example graph of 5 nodes connected via 4 edges.
[![enter image description here][1]][1]
```
    create (a:Person {name:&#39;A&#39;}), (b:Person {name:&#39;B&#39;}),  (c:Person {name:&#39;C&#39;}), (d:Person {name:&#39;D&#39;}), (e:Person {name:&#39;E&#39;}), (b)-[:KNOWS]-&gt;(a), (b)-[:KNOWS]-&gt;(c), (d)-[:KNOWS]-&gt;(c), (d)-[:KNOWS]-&gt;(e)
```

And I would like to select all the node triplets barring duplicates.

    MATCH (p)--(q)--(r) RETURN DISTINCT p,q,r
[Here is the playground][2] 

What I want as a result is only 3 triplets
```
a-b-c
b-c-d
c-d-e
```

but what I get instead is also the reversed triplets

```
a-b-c
b-c-d
c-d-a
c-b-a
d-c-b
e-d-c
```

How can I avoid selecting reverse path?

Thanks
  


  [1]: https://i.stack.imgur.com/65wEu.png
  [2]: https://console.neo4j.org/r/9b4m6t",1594553406,https://stackoverflow.com/q/62860498,Selvin,"['cypher', 'neo4j']"
62857999,How to join 2 MATCH outputs in middle of cypher query,"I am trying to write work on a cypher query on neo4j browser version 3.1.4 (version change is not possible). My expertise level with cypher queries is quite beginner level

I have a query along below lines:

```
WITH SomeCollection

MATCH (x:xType)&lt;- someRelationalMatchLogic which contains y as part of it             // FIRST MATCH PART
        WHERE (x.name = &#39;test&#39;) AND some logic on y

// SECOND MATCH PART

WITH x, y, SomeCollection
  WHERE some additional post processing based on x and y value and collection values
RETURN x
```
I would like following MATCH query to be inserted in above &quot;// SECOND MATCH PART SECTION&quot;
```
MATCH (x:xType)&lt;- someDifferentReltionalMatchLogic which contains y as part of it
        WHERE (x.name = &#39;test&#39;) AND some logic on y
```

So that I can get a joint / union match result before proceeding with remainder of query.    

Currently my only working option is I copy paste full query, and use the 2nd match block instead of first in pasted section, and use UNION between the 2.

Given the actual query before and after MATCH is pretty big, it seems a very dirty and inefficient approach.

The only other approach I could think of based on my searches was CALL subquery with UNION usage is subquery for 2 MATCH as demostrated here https://neo4j.com/docs/cypher-manual/current/clauses/call-subquery/

But for some reason this CALL approach is giving errors in my neo4j version, I thought I was may be incorrectly writing my query, so I directly used first example in link and even that gave error
E.g. used from link:
```
UNWIND [0, 1, 2] AS x
CALL {
  WITH x
  RETURN x * 10 AS y
}
RETURN x, y
```
Error(s):
```
mismatched input &#39;{&#39; expecting {HexLetter, CYPHER, EXPLAIN, PROFILE, USING, PERIODIC, COMMIT, UNION, ALL, CREATE, DROP, INDEX, ON, CONSTRAINT, ASSERT, IS, UNIQUE, EXISTS, LOAD, CSV, WITH, HEADERS, FROM, AS, FIELDTERMINATOR, OPTIONAL, MATCH, UNWIND, MERGE, SET, DETACH, DELETE, REMOVE, FOREACH, IN, DISTINCT, RETURN, ORDER, BY, L_SKIP, LIMIT, ASCENDING, ASC, DESCENDING, DESC, JOIN, SCAN, START, NODE, RELATIONSHIP, REL, WHERE, SHORTESTPATH, ALLSHORTESTPATHS, OR, XOR, AND, NOT, STARTS, ENDS, CONTAINS, NULL, COUNT, FILTER, EXTRACT, ANY, NONE, SINGLE, TRUE, FALSE, REDUCE, CASE, ELSE, END, WHEN, THEN, CALL, YIELD, KEY, UnescapedSymbolicName, EscapedSymbolicName}
```
[![enter image description here][1]][1]


AND
```
extraneous input &#39;x&#39; expecting {&#39;;&#39;, &#39;(&#39;, UNION, CREATE, LOAD, WITH, OPTIONAL, MATCH, UNWIND, MERGE, SET, DETACH, DELETE, REMOVE, FOREACH, RETURN, START, CALL, YIELD, SP}
```
[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/yt5vD.png
  [2]: https://i.stack.imgur.com/7UpuF.png


Any inputs towards addressing this CALL error, and / or helping achieve the join x and y output of those 2 MATCH blocks in that query section before proceeding further through any alternate suggestions will be greatly appreciated.",1594536896,https://stackoverflow.com/q/62857999,Saurabh Mittal,"['neo4j', 'cypher']"
62844577,Getting an unclear Error Message in Neo4j with APOC batch loader,"I am loading a large number of Neo4j nodes into the system from a json file. It is failing with this error message &quot;Failed to invoke procedure `apoc.merge.node`: Caused by: java.lang.NullPointerException&quot; - I am not seeing enough information to figure out what I am doing wrong and as this is the first time i have used this, I just don&#39;t see it. This is the last 7 or so errors on the error stack. Looks like the error originates when merge_node is called. 

      File &quot;F:\ClientSide\current\testload1.py&quot;, line 104, in &lt;lambda&gt;
        nodes.apply(lambda h: merge_node(h), axis=1)
      File &quot;F:\ClientSide\current\testload1.py&quot;, line 61, in merge_node
        ses.run(&quot;UNWIND $batch AS row CALL apoc.merge.node([&#39;ProgNode&#39;, row.nodetype], {node:row.node}, apoc.map.removeKeys(properties(row), [&#39;nodetype&#39;, &#39;node&#39;])) YIELD node RETURN 1&quot;, batch=BATCH[&quot;batch&quot;])
      File &quot;C:\Users\Bill Dickenson\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\work\simple.py&quot;, line 217, in run
        self._autoResult._run(query, parameters, self._config.database, self._config.default_access_mode, self._bookmarks, **kwparameters)
      File &quot;C:\Users\Bill Dickenson\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\work\result.py&quot;, line 101, in _run
        self._attach()
      File &quot;C:\Users\Bill Dickenson\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\work\result.py&quot;, line 202, in _attach
        self._connection.fetch_message()
      File &quot;C:\Users\Bill Dickenson\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\io\_bolt3.py&quot;, line 326, in fetch_message
        response.on_failure(summary_metadata or {})
      File &quot;C:\Users\Bill Dickenson\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\io\_bolt3.py&quot;, line 512, in on_failure
        raise Neo4jError.hydrate(**metadata)
    neo4j.exceptions.ClientError: Failed to invoke procedure `apoc.merge.node`: Caused by: java.lang.NullPointerException

The &quot;batch&quot; data structure contains lists of variables like this one 

    {&#39;EIEO&#39;: True, &#39;FILECOUNT&#39;: 1, &#39;KDM&#39;: &#39;data:Writes&#39;, &#39;changed&#39;: False, &#39;ctx&#39;: &#39;113540257&#39;, &#39;level&#39;: &#39;code&#39;, &#39;location&#39;: [55, 8, 55, 94], &#39;node&#39;: 100, &#39;quvioDensity&#39;: 1.0, &#39;quviolations&#39;: 2, &#39;szAFP&#39;: &#39;&#39;, &#39;szaep&#39;: 17, &#39;szlocs&#39;: 2, &#39;text&#39;: &#39;FilemavenWrapperPropertyFile=newFile(baseDirectory,MAVEN_WRAPPER_PROPERTIES_PATH);&#39;, &#39;type&#39;: &#39;localVariableDeclarationStatement&#39;}

and the code that is processing it looks like this, including the print statement that generated the data above.  

    def merge_node(args):
        global INNODE, NODECOUNT
        &quot;&quot;&quot;
        Function to create nodes from a batch.
        &quot;&quot;&quot;
        INNODE += 1
        if (INNODE % 10000) == 0:
            print(&quot;...Sent %s of %s for processing&quot; % (INNODE, NODECOUNT))
        if len(BATCH[&#39;batch&#39;]) == 4:
            print(BATCH[&#39;batch&#39;][3])
        if (len(BATCH[&#39;batch&#39;]) &gt; 1000) or (INNODE == NODECOUNT):
            if INNODE == NODECOUNT:
                print(&quot;...Final Record (%s) added and transmitted&quot; % INNODE)
                BATCH[&#39;batch&#39;].append(args.to_dict())            
            with graphDB_Driver.session() as ses:
                ses.run(&quot;UNWIND $batch AS row CALL apoc.merge.node([&#39;ProgNode&#39;, row.nodetype], {node:row.node}, apoc.map.removeKeys(properties(row), [&#39;nodetype&#39;, &#39;node&#39;])) YIELD node RETURN 1&quot;, batch=BATCH[&quot;batch&quot;])
            reset_batch()
        BATCH[&#39;batch&#39;].append(args.to_dict())

Oddly enough, this runs locally with this error. When it runs against my remote Neo4j db, it processes fine ( no errors) but does NOT generate anything on the server. So I assume its failing up there but APOC is redirecting the console and just moving on. 

Anyone see what I am doing incorrectly ? ",1594434589,https://stackoverflow.com/q/62844577,billDickens,"['neo4j', 'neo4j-apoc', 'cypher']"
62844486,How to show relationships in an optional manner in neo4j?,"I have multiple nodes and relationships in neo4j, certain nodes have relationship depth as 4, while certain have 2. I&#39;m using neo4j&#39;s HTTP API to get the data in graph format

Sample query:
```
MATCH p= (n:datasource{resource_key:&#39;ABCD&#39;})-[:is_dataset_of]-(c:dataset)-[q]-(v:dataset_columns)-[s]-(b:component)-[w]-(e:dashboard) return p
```

If i use this query then i can get output if this exact relationship is present but I also want to get the output if the 2nd relationship is not available, Any pointers on how to achieve this?",1594433607,https://stackoverflow.com/q/62844486,David,"['neo4j', 'cypher']"
62844274,Limit Neo4j apoc.path.expand by relationship property value,"Is it possible in a weighted Neo4j graph to find all paths within n hops of a given node with the constraints that only the top m relationships (by weight) from each node are returned/further expanded? 

For example, given the following graph:

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/N50IT.png

This query...

```
MATCH (n0:Foo {n: &quot;a&quot;})
CALL apoc.path.expand(n0, &quot;TO&gt;&quot;, &quot;&quot;, 1, 3)
YIELD path as p
WHERE ALL (x in relationships(p) where x.score &gt; 0.02)  // Additional constraint not directly related to the question
RETURN p, length(p) AS hops
ORDER BY hops
```

... returns:

```
╒═══════════════════════════════════════════════════════════════════════╤══════╕
│&quot;p&quot;                                                                    │&quot;hops&quot;│
╞═══════════════════════════════════════════════════════════════════════╪══════╡
│[{&quot;n&quot;:&quot;a&quot;},{&quot;score&quot;:0.03},{&quot;n&quot;:&quot;d&quot;}]                                   │1     │
├───────────────────────────────────────────────────────────────────────┼──────┤
│[{&quot;n&quot;:&quot;a&quot;},{&quot;score&quot;:0.03},{&quot;n&quot;:&quot;d&quot;},{&quot;n&quot;:&quot;d&quot;},{&quot;score&quot;:0.11},{&quot;n&quot;:&quot;k&quot;}]│2     │
├───────────────────────────────────────────────────────────────────────┼──────┤
│[{&quot;n&quot;:&quot;a&quot;},{&quot;score&quot;:0.03},{&quot;n&quot;:&quot;d&quot;},{&quot;n&quot;:&quot;d&quot;},{&quot;score&quot;:0.1},{&quot;n&quot;:&quot;j&quot;}] │2     │
├───────────────────────────────────────────────────────────────────────┼──────┤
│[{&quot;n&quot;:&quot;a&quot;},{&quot;score&quot;:0.03},{&quot;n&quot;:&quot;d&quot;},{&quot;n&quot;:&quot;d&quot;},{&quot;score&quot;:0.12},{&quot;n&quot;:&quot;l&quot;}]│2     │
└───────────────────────────────────────────────────────────────────────┴──────┘
```

Is it possible to also **limit the outgoing relationships from each node to e.g. the top 2 by score**.

The expected output would be:
```
╒═══════════════════════════════════════════════════════════════════════╤══════╕
│&quot;p&quot;                                                                    │&quot;hops&quot;│
╞═══════════════════════════════════════════════════════════════════════╪══════╡
│[{&quot;n&quot;:&quot;a&quot;},{&quot;score&quot;:0.03},{&quot;n&quot;:&quot;d&quot;}]                                   │1     │
├───────────────────────────────────────────────────────────────────────┼──────┤
│[{&quot;n&quot;:&quot;a&quot;},{&quot;score&quot;:0.03},{&quot;n&quot;:&quot;d&quot;},{&quot;n&quot;:&quot;d&quot;},{&quot;score&quot;:0.11},{&quot;n&quot;:&quot;k&quot;}]│2     │
├───────────────────────────────────────────────────────────────────────┼──────┤
│[{&quot;n&quot;:&quot;a&quot;},{&quot;score&quot;:0.03},{&quot;n&quot;:&quot;d&quot;},{&quot;n&quot;:&quot;d&quot;},{&quot;score&quot;:0.12},{&quot;n&quot;:&quot;l&quot;}]│2     │
└───────────────────────────────────────────────────────────────────────┴──────┘
```",1594430910,https://stackoverflow.com/q/62844274,glp,"['neo4j', 'neo4j-apoc', 'cypher']"
62834719,NEO4J - RHEL7 - Cannot create constraint on empty DB,"Deployed NEO4j on a hardened RHEL7 using ansible.
No constraint can be created even though the DB is empty. Any idea on how to debug this or what could be the cause? Other objects can be created. It seems to be a problem with some core library...
We have the same install on another instance which works fine, so I suppose it must be something related to the deployment...even though there were not install errors 

Thanks.

Error logs below:

020-07-09 12:11:13.898+0000 ERROR [o.n.b.v.r.ErrorReporter] Client triggered an unexpected error [Neo.DatabaseError.Schema.ConstraintCreationFailed]: Unable to create CONSTRAINT ON ( equipment:Equipment ) ASSERT equipment.UUID IS UNIQUE:
, reference 0a5adcde-dbeb-4ef0-b9aa-9bf32ef58e63.
2020-07-09 12:11:13.898+0000 ERROR [o.n.b.v.r.ErrorReporter] Client triggered an unexpected error [Neo.DatabaseError.Schema.ConstraintCreationFailed]: Unable to create CONSTRAINT ON ( equipment:Equipment ) ASSERT equipment.UUID IS UNIQUE:
, reference 0a5adcde-dbeb-4ef0-b9aa-9bf32ef58e63. Unable to create CONSTRAINT ON ( equipment:Equipment ) ASSERT equipment.UUID IS UNIQUE:

org.neo4j.kernel.impl.query.QueryExecutionKernelException: Unable to create CONSTRAINT ON ( equipment:Equipment ) ASSERT equipment.UUID IS UNIQUE:

               at org.neo4j.bolt.v1.runtime.TransactionStateMachineSPI$1.start(TransactionStateMachineSPI.java:158)
               at org.neo4j.bolt.v1.runtime.TransactionStateMachine$State.startExecution(TransactionStateMachine.java:444)
               at org.neo4j.bolt.v1.runtime.TransactionStateMachine$State$1.execute(TransactionStateMachine.java:259)
               at org.neo4j.bolt.v1.runtime.TransactionStateMachine$State$1.run(TransactionStateMachine.java:240)
               at org.neo4j.bolt.v1.runtime.TransactionStateMachine.run(TransactionStateMachine.java:81)
               at org.neo4j.bolt.v1.runtime.BoltStateMachine$State$2.run(BoltStateMachine.java:457)
               at org.neo4j.bolt.v1.runtime.BoltStateMachine.run(BoltStateMachine.java:225)
               at org.neo4j.bolt.v1.messaging.BoltMessageRouter.lambda$onRun$3(BoltMessageRouter.java:93)
               at org.neo4j.bolt.runtime.MetricsReportingBoltConnection.lambda$enqueue$0(MetricsReportingBoltConnection.java:69)
               at org.neo4j.bolt.runtime.DefaultBoltConnection.processNextBatch(DefaultBoltConnection.java:195)
               at org.neo4j.bolt.runtime.MetricsReportingBoltConnection.processNextBatch(MetricsReportingBoltConnection.java:87)
               at org.neo4j.bolt.runtime.DefaultBoltConnection.processNextBatch(DefaultBoltConnection.java:143)
               at org.neo4j.bolt.runtime.ExecutorBoltScheduler.executeBatch(ExecutorBoltScheduler.java:170)
               at org.neo4j.bolt.runtime.ExecutorBoltScheduler.lambda$scheduleBatchOrHandleError$2(ExecutorBoltScheduler.java:153)
               at java.util.concurrent.CompletableFuture$AsyncSupply.run(Unknown Source)
               at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
               at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
               at java.lang.Thread.run(Unknown Source)
Caused by: org.neo4j.kernel.impl.query.QueryExecutionKernelException: Unable to create CONSTRAINT ON ( equipment:Equipment ) ASSERT equipment.UUID IS UNIQUE:

               at org.neo4j.cypher.internal.javacompat.ExecutionEngine.executeQuery(ExecutionEngine.java:65)
               at org.neo4j.bolt.v1.runtime.TransactionStateMachineSPI$1.start(TransactionStateMachineSPI.java:144)
               ... 17 more
Caused by: org.neo4j.cypher.CypherExecutionException: Unable to create CONSTRAINT ON ( equipment:Equipment ) ASSERT equipment.UUID IS UNIQUE:

               at org.neo4j.cypher.internal.compatibility.v3_4.ExceptionTranslationSupport$class.translateException(ExceptionTranslationSupport.scala:35)
               at org.neo4j.cypher.internal.compatibility.v3_4.ExceptionTranslatingQueryContext.translateException(ExceptionTranslatingQueryContext.scala:41)
               at org.neo4j.cypher.internal.compatibility.v3_4.ExceptionTranslatingQueryContext.createUniqueConstraint(ExceptionTranslatingQueryContext.scala:128)
               at org.neo4j.cypher.internal.runtime.interpreted.UpdateCountingQueryContext.createUniqueConstraint(UpdateCountingQueryContext.scala:125)
               at org.neo4j.cypher.internal.compatibility.v3_4.runtime.executionplan.procs.ProcedureCallOrSchemaCommandExecutionPlanBuilder$$anonfun$6.apply(ProcedureCallOrSchemaCommandExecutionPlanBuilder.scala:80)
               at org.neo4j.cypher.internal.compatibility.v3_4.runtime.executionplan.procs.ProcedureCallOrSchemaCommandExecutionPlanBuilder$$anonfun$6.apply(ProcedureCallOrSchemaCommandExecutionPlanBuilder.scala:78)
               at org.neo4j.cypher.internal.compatibility.v3_4.runtime.executionplan.procs.PureSideEffectExecutionPlan.run(PureSideEffectExecutionPlan.scala:55)
               at org.neo4j.cypher.internal.compatibility.LatestRuntimeVariablePlannerCompatibility$ExecutionPlanWrapper$$anonfun$run$1.apply(LatestRuntimeVariablePlannerCompatibility.scala:128)
               at org.neo4j.cypher.internal.compatibility.LatestRuntimeVariablePlannerCompatibility$ExecutionPlanWrapper$$anonfun$run$1.apply(LatestRuntimeVariablePlannerCompatibility.scala:124)
               at org.neo4j.cypher.exceptionHandler$runSafely$.apply(exceptionHandler.scala:89)
               at org.neo4j.cypher.internal.compatibility.LatestRuntimeVariablePlannerCompatibility$ExecutionPlanWrapper.run(LatestRuntimeVariablePlannerCompatibility.scala:124)
               at org.neo4j.cypher.internal.PreparedPlanExecution.execute(PreparedPlanExecution.scala:29)
               at org.neo4j.cypher.internal.ExecutionEngine.execute(ExecutionEngine.scala:119)
               at org.neo4j.cypher.internal.javacompat.ExecutionEngine.executeQuery(ExecutionEngine.java:61)
               ... 18 more
Caused by: org.neo4j.kernel.api.exceptions.schema.CreateConstraintFailureException: Unable to create constraint org.neo4j.kernel.api.schema.constaints.UniquenessConstraintDescriptor@6: Existing data does not satisfy CONSTRAINT ON ( label[1]:label[1] ) ASSERT label[1].property[0] IS UNIQUE: Failed to populate index for :Equipment(UUID) [provider: {key=lucene+native, version=2.0}] [labelId: 1, properties [0]]
               at org.neo4j.kernel.impl.newapi.Operations.indexBackedConstraintCreate(Operations.java:1239)
               at org.neo4j.kernel.impl.newapi.Operations.uniquePropertyConstraintCreate(Operations.java:943)
               at org.neo4j.internal.kernel.api.SchemaWrite.uniquePropertyConstraintCreate(SchemaWrite.java:66)
               at org.neo4j.cypher.internal.runtime.interpreted.TransactionBoundQueryContext.createUniqueConstraint(TransactionBoundQueryContext.scala:670)
               at org.neo4j.cypher.internal.compatibility.v3_4.ExceptionTranslatingQueryContext$$anonfun$createUniqueConstraint$1.apply$mcZ$sp(ExceptionTranslatingQueryContext.scala:128)
               at org.neo4j.cypher.internal.compatibility.v3_4.ExceptionTranslatingQueryContext$$anonfun$createUniqueConstraint$1.apply(ExceptionTranslatingQueryContext.scala:128)
               at org.neo4j.cypher.internal.compatibility.v3_4.ExceptionTranslatingQueryContext$$anonfun$createUniqueConstraint$1.apply(ExceptionTranslatingQueryContext.scala:128)
               at org.neo4j.cypher.internal.compatibility.v3_4.ExceptionTranslationSupport$class.translateException(ExceptionTranslationSupport.scala:33)
               ... 31 more
Caused by: org.neo4j.kernel.api.exceptions.schema.UniquePropertyValueValidationException: Existing data does not satisfy CONSTRAINT ON ( label[1]:label[1] ) ASSERT label[1].property[0] IS UNIQUE: Failed to populate index for :Equipment(UUID) [provider: {key=lucene+native, version=2.0}] [labelId: 1, properties [0]]
               at org.neo4j.kernel.impl.api.state.ConstraintIndexCreator.awaitConstrainIndexPopulation(ConstraintIndexCreator.java:244)
               at org.neo4j.kernel.impl.api.state.ConstraintIndexCreator.createUniquenessConstraintIndex(ConstraintIndexCreator.java:135)
               at org.neo4j.kernel.impl.newapi.Operations.indexBackedConstraintCreate(Operations.java:1224)
               ... 38 more
Caused by: org.neo4j.kernel.api.exceptions.index.IndexPopulationFailedKernelException: Failed to populate index for :Equipment(UUID) [provider: {key=lucene+native, version=2.0}] [labelId: 1, properties [0]]
               at org.neo4j.kernel.impl.api.index.IndexPopulationFailure$1.asIndexPopulationFailure(IndexPopulationFailure.java:47)
               at org.neo4j.kernel.impl.api.index.FailedIndexProxy.failureCause(FailedIndexProxy.java:80)
               at org.neo4j.kernel.impl.api.index.FailedIndexProxy.awaitStoreScanCompleted(FailedIndexProxy.java:75)
               at org.neo4j.kernel.impl.api.index.FlippableIndexProxy.awaitStoreScanCompleted(FlippableIndexProxy.java:325)
               at org.neo4j.kernel.impl.api.index.AbstractDelegatingIndexProxy.awaitStoreScanCompleted(AbstractDelegatingIndexProxy.java:122)
               at org.neo4j.kernel.impl.api.state.ConstraintIndexCreator.awaitConstrainIndexPopulation(ConstraintIndexCreator.java:232)
               ... 40 more
Caused by: java.lang.NoSuchMethodError: org.apache.lucene.codecs.blocktree.BlockTreeTermsWriter.validateAutoPrefixSettings(II)V
               at org.apache.lucene.codecs.autoprefix.AutoPrefixPostingsFormat.&lt;init&gt;(AutoPrefixPostingsFormat.java:77)
               at org.apache.lucene.codecs.autoprefix.AutoPrefixPostingsFormat.&lt;init&gt;(AutoPrefixPostingsFormat.java:52)
               at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
               at sun.reflect.NativeConstructorAccessorImpl.newInstance(Unknown Source)
               at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(Unknown Source)
               at java.lang.reflect.Constructor.newInstance(Unknown Source)
               at java.lang.Class.newInstance(Unknown Source)
               at org.apache.lucene.util.NamedSPILoader.reload(NamedSPILoader.java:72)
               at org.apache.lucene.util.NamedSPILoader.&lt;init&gt;(NamedSPILoader.java:51)
               at org.apache.lucene.util.NamedSPILoader.&lt;init&gt;(NamedSPILoader.java:38)
               at org.apache.lucene.codecs.PostingsFormat$Holder.&lt;clinit&gt;(PostingsFormat.java:49)
               at org.apache.lucene.codecs.PostingsFormat.forName(PostingsFormat.java:112)
               at org.apache.lucene.codecs.lucene62.Lucene62Codec.&lt;init&gt;(Lucene62Codec.java:167)
               at org.apache.lucene.codecs.lucene62.Lucene62Codec.&lt;init&gt;(Lucene62Codec.java:82)
               at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
               at sun.reflect.NativeConstructorAccessorImpl.newInstance(Unknown Source)
               at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(Unknown Source)
               at java.lang.reflect.Constructor.newInstance(Unknown Source)
               at java.lang.Class.newInstance(Unknown Source)
               at org.apache.lucene.util.NamedSPILoader.reload(NamedSPILoader.java:72)
               at org.apache.lucene.util.NamedSPILoader.&lt;init&gt;(NamedSPILoader.java:51)
               at org.apache.lucene.util.NamedSPILoader.&lt;init&gt;(NamedSPILoader.java:38)
               at org.apache.lucene.codecs.Codec$Holder.&lt;clinit&gt;(Codec.java:47)
               at org.apache.lucene.codecs.Codec.getDefault(Codec.java:143)
               at org.apache.lucene.index.LiveIndexWriterConfig.&lt;init&gt;(LiveIndexWriterConfig.java:121)
               at org.apache.lucene.index.IndexWriterConfig.&lt;init&gt;(IndexWriterConfig.java:151)
               at org.neo4j.kernel.api.impl.index.IndexWriterConfigs.standard(IndexWriterConfigs.java:81)
               at org.neo4j.kernel.api.impl.index.IndexWriterConfigs.population(IndexWriterConfigs.java:119)
               at org.neo4j.kernel.api.impl.index.IndexWriterConfigs.population(IndexWriterConfigs.java:114)
               at org.neo4j.kernel.api.impl.index.partition.WritableIndexPartitionFactory.createPartition(WritableIndexPartitionFactory.java:45)
               at org.neo4j.kernel.api.impl.index.AbstractLuceneIndex.open(AbstractLuceneIndex.java:103)
               at org.neo4j.kernel.api.impl.index.WritableAbstractDatabaseIndex.open(WritableAbstractDatabaseIndex.java:62)
               at org.neo4j.kernel.api.impl.schema.populator.LuceneIndexPopulator.create(LuceneIndexPopulator.java:51)
               at org.neo4j.kernel.impl.index.schema.fusion.InstanceSelector.consume(InstanceSelector.java:147)
               at org.neo4j.kernel.impl.index.schema.fusion.InstanceSelector.forAll(InstanceSelector.java:90)
               at org.neo4j.kernel.impl.index.schema.fusion.FusionIndexPopulator.create(FusionIndexPopulator.java:56)
               at org.neo4j.kernel.impl.api.index.MultipleIndexPopulator$IndexPopulation.create(MultipleIndexPopulator.java:525)
               at org.neo4j.kernel.impl.api.index.MultipleIndexPopulator.lambda$create$0(MultipleIndexPopulator.java:144)
               at org.neo4j.kernel.impl.api.index.MultipleIndexPopulator.forEachPopulation(MultipleIndexPopulator.java:408)
               at org.neo4j.kernel.impl.api.index.MultipleIndexPopulator.create(MultipleIndexPopulator.java:141)
               at org.neo4j.kernel.impl.api.index.IndexPopulationJob.run(IndexPopulationJob.java:103)
               at org.neo4j.kernel.impl.api.index.IndexPopulationJobController$IndexPopulationJobWrapper.run(IndexPopulationJobController.java:82)
               at org.neo4j.kernel.impl.scheduler.ThreadPool.lambda$submit$0(ThreadPool.java:58)
               at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)
               at java.util.concurrent.FutureTask.run(Unknown Source)
               ... 3 more
",1594385481,https://stackoverflow.com/q/62834719,Catalin,"['neo4j', 'rhel', 'cypher']"
62831973,Get start and end nodes of specific path in a large graph,"I have a large graph (1,068,029 nodes and 2,602,897 relationships), and I work with it via the python API and make requests to the graph in my program flow.

I have the following queries - 

### First query

    MATCH 
    (start_node)--(o:observed_data)--(i:indicator)--(m:malware)--(end_node:attack_pattern)
    WHERE start_node.id in [id_list] 
    RETURN start_node.id, end_node.name

### Second query

    MATCH 
    (start_node)--(o1:observed_data)--(h:MD5)--(o2:observed_data)--(i:indicator)--(m:malware)--(end_node:attack_pattern)
    WHERE start_node.id in [id_list] 
    RETURN start_node.id, end_node.name

When I trying to preform the first query with id_list of size 75,000 its passes OK and returns the wanted output, but when I trying to preform the second query - the graph gets stuck, even when I decreasing the id_list to 20,000. 

The id_list is even larger than 75,000 but I split it into chunks in order to make the graph&#39;s response time faster, but if I will split it to too many chunks I will increase the number of requests to the graph, and increase the program run-time.

My question is - Is there a library&#39;s function of some sort (APOC or something like that) that performs the same action but in less time? Or maybe you have another solution that solves this problem without decreasing the id_list under 50,000?

",1594375554,https://stackoverflow.com/q/62831973,adsl,"['cypher', 'neo4j']"
62831890,any way to limit result by node,"I have this query:

    MATCH (user:Users)-[buy:Sales]-&gt;(item:Items)&lt;-[buy2:Sales]- (user2:Users)-[buy_other:Sales]-&gt;(item2:Items)
    where item.category = item2.category
    return
    user.mail, item2.id

the idea is to get items that the first user could be interested in that other user2 also bought, but i want to limit the results to max 2 item2 id per user

I know i can limit results in general, with limit 10 for example, but that means that those 10 results could all be for the same user.

Any help? thanks in advance",1594375281,https://stackoverflow.com/q/62831890,user2919673,"['cypher', 'neo4j']"
62830298,Return all relationships,"Is it possible to get all relationships in a graph without the nodes?

I&#39;m trying 

    MATCH [r:MEMBER] 
    RETURN r

But it gives me the error

    Invalid input &#39;[&#39;: expected whitespace, comment or a pattern (line 1, column 7 (offset: 6))
    &quot;MATCH [r:MEMBER] reTURN r&quot;
           ^",1594369990,https://stackoverflow.com/q/62830298,A. L,"['neo4j', 'cypher']"
62811379,Using Unwind and Dumping Data in neo4j - Query Optimization,"I am doing **batch insertion** to insert data in **neo4j** but my transaction is taking huge time as my database is increasing continuously also.

In my project, For only one case ,I am having more then **18,000 records** which are meant to be stored in db and will have relationships with a Target node.
Each record will be stored as **Friend Node**

Relationships are like

**Target_Node-[r:followed_by]-&gt;Friend_Node**

**Target_Node-[r:Friends_with]-&gt;Friend_Nod**e

**Target_Node-[r:Performs_Activity]-&gt;Friend_Node**

My query executes for all the cases separately and the chances are very likely that there maybe all three relations between a Target and Friend Node.

I am sending 20 records per thread for a single insertion which unwinds over the array of records and checks if the records is already exists in Friend_Node or Target_Node, if not then create it as a Friend_Node and then assign relation to it; If the node already have relationship and a new relation is passed to the query then a new relation will also be added between the two nodes.

Also I do check in my query if a Record do have a **Location** property then I do create a Location Node and assign the relation with that also.

**Note**: create_rel variable can be Friends_with,Followed_by or Activity_p

My **query** is as follows
    
     &quot;&quot;&quot;UNWIND [{id: &quot;1235&quot; , uid : &quot;0&quot;}] as user
    
        UNWIND &quot;&quot;&quot;+ l +&quot;&quot;&quot; as c

        OPTIONAL MATCH (n:Target {id : c.id , uid : &quot;0&quot;})

        OPTIONAL MATCH (m:Friend {id : c.id , screen_name:c.screen_name, uid : &quot;0&quot;})

        WITH coalesce(n, m) as node,user,c // returns first non-null value

        CALL apoc.do.when(node is null, &quot;MERGE (n:Friend {id:c.id, name:c.name, profile: c.profile, location:c.location, uid : user.uid}) RETURN n&quot;, &#39;&#39;, {c:c,user:user}) YIELD value

        with coalesce(node, value.n) as y,user,c

        MERGE (u:Target {id: user.id , uid : user.uid})

        &quot;&quot;&quot;+create_rel+&quot;&quot;&quot;

        foreach (sc in c.cityn | merge(cn:Location {location:sc.location, loc_lower : sc.loc_lower}) merge (y)-[:`located_at`]-(cn))

        &quot;&quot;&quot;

Db sometimes gives TransientError error also.

Feedback is appreciated as I am a learner and will appreciate valuable suggestions.

Thanks in advance
",1594285804,https://stackoverflow.com/q/62811379,Mubeen Mubarik,"['neo4j', 'cypher', 'neo4j-apoc']"
62802772,Cypher query creating new nodes instead of building relationship with existing nodes,"I currently have a query that builds a relationship between Men nodes and People nodes:

    MATCH (m:Mem)
    UNWIND m.personID as person
    MERGE (p:Person{personID:person})
    MERGE (m)-[:WITH]-&gt;(p)

The Mem nodes contain an array of PersonIDs that I am unwinding and then matching to the Person nodes with the corresponding PersonIDs. However, the query is building the relationship with ***new*** Person nodes that it creates, with just the corresponding personIDs property (and no other properties) instead of building the relationship with the ***existing*** Person nodes with the corresponding personIDs.

This is happening even though I have a unique constraint on the personID property for nodes with the Person label.

How can I write a query that build the relationships but doesn&#39;t create new nodes with the corresponding personIDs?",1594238560,https://stackoverflow.com/q/62802772,Sean,"['cypher', 'neo4j']"
62799907,Unwind array and match with other nodes using Cypher on Neo4j graph database,"I&#39;m creating an app using GRANDstack on top of a Neo4j graph database and I&#39;m struggling with writing a query that unwinds a property array, matches some IDs, pullsback names associated with the IDs and repackages them into a new array.

Essentially, I have Memory nodes (Mems) and Person nodes (Person) and their relationship is as follows: (Mems)-[WITH]-&gt;(Person). i.e. you can have a memory of something where you were WITH multiple people. The Mems nodes contain a personID property that is an array of IDs and the relationship in the graph database is built from the array of personIDs in Mems nodes that match the personIDs in the Person nodes. 

The result I&#39;m trying to achieve is like the below, however I haven&#39;t found a way to return the nicknames from the Person nodes:

[![enter image description here][1]][1]

The query I&#39;m using to generate the above is below:

    MATCH (m:Mem)-[WITH]-&gt;(p:Person)
    WHERE m.personID IS NOT NULL
    UNWIND m.personID as personID
    CALL {
    	WITH personID
    	MATCH (p:Person)
        WHERE personID = p.personID
    	RETURN p.nickname
    }
    RETURN m.mem, m.date, personID, p.nickname

I think it&#39;s close to what I need but I just can&#39;t figure out the last bit where I can return the nicknames associated with the personIDs. This might be something that APOC is more capable of doing?

  [1]: https://i.stack.imgur.com/Kjq1u.png",1594227795,https://stackoverflow.com/q/62799907,Sean,"['cypher', 'neo4j']"
62780573,Get the nodes which are all connected with my input node using py2neo and flask,"I want to fetch the connected nodes from ny neo4j database. 
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/cNZ4O.png


For example If I give the input as 2 and then I have to fetch 1,3,4 and 5.I tried to explore the question but answer is related to neo4j only. I need a query with py2neo. is there anyway i can get it?

I tried this
https://stackoverflow.com/questions/33487787/how-to-get-all-nodes-connected-to-one-node-in-neo4j-graph-in-py2neo
https://stackoverflow.com/questions/33483158/how-to-get-all-connected-nodes-in-neo4j-graph-in-py2neo

But these are all with neo4j not with py2neo",1594142169,https://stackoverflow.com/q/62780573,user8996213,"['cypher', 'neo4j', 'py2neo', 'python', 'python-3.x']"
62775115,How to get counts of Edges related to a node in one query - NEO4J,"I have two questions.

What is the best way to index user activities like posts, reposts, comments, upvotes, and downvotes. My current solution is representing every activity as a POST. It should work, but I know its quite expensive to regard upvotes and downvotes as new nodes when I can just use a relationship to represent this. But then, I want to be able to fetch everything once and order.

Secondly: When I run the following excluding the `WITH` and following `MATCH`, The result is larger but as I try to get the counts of reposts, replies and upvotes. The result keeps getting smaller and eventually nothing.


    MATCH (me:User {id: &quot;172ed572-e3af-d3ee-77c0-8d9d181b12f1&quot;})-[:COLLEAGUE_OF]-(u:User)-[posted:POSTED]-&gt;(p:Post) WHERE posted.date &gt;= 0
    WITH p, posted, u AS user MATCH (p)-[ro:REPOST_OF]-(:Post)
    WITH count(ro) AS reposts, posted, ro, user MATCH (p)-[rt:REPLY_TO]-&gt;(:Post)
    WITH count(rt) AS replies, posted, user, reposts MATCH (p)-[uv:UP_VOTE]-&gt;(:Post)
    WITH count(uv) AS upvotes, posted, user, reposts, replies, p
    RETURN p AS post,  posted, user, reposts, replies
    ORDER BY -posted.date",1594124225,https://stackoverflow.com/q/62775115,Emmanuel Sunday,"['neo4j', 'cypher']"
62774848,How to select Array element with Cypher Query,"I&#39;m trying to implement a Cypher Query to select an element inside an Array.
This is my csv row:

    user_id,name,review_count,friends,useful,funny,cool
    ntlvfPzc8eglqvk92iDIAw,Rafael,553,&quot;[&#39;oeMvJh94PiGQnx_6GlndPQ&#39;, &#39;wm1z1PaJKvHgSDRKfwhfDg&#39;, &#39;IkRib6Xs91PPW7pon7VVig&#39;, &#39;A8Aq8f0-XvLBcyMk2GJdJQ&#39;]&quot;,628,225,227

I want to select, for example, friends[0] and find him proprieties.
Query will be like this:

    MATCH (u:User) WHERE u.name = &#39;Rafael&#39; RETURN ??u.friends[0], u.friends[1] ..??",1594123408,https://stackoverflow.com/q/62774848,Francesco Bocci,"['neo4j', 'cypher']"
62774330,Count how many dates in a list are between two dates,"I have the given schema
```
(t1:Tag)-[c:CONNECTED_TO]-(t2:Tag)
```

Each relationship of type :CONNECTED_TO has a property that is storing dates as a list.
```
{
  &quot;dates&quot;: [
    &quot;2019-11-27&quot;,
    &quot;2019-01-24&quot;,
    &quot;2017-06-27&quot;
  ]
}
```

Now I want to find each relationship where one of the dates is between two dates.
```
MATCH ()-[c:CONNECTED_TO]-()
WHERE ANY (item IN c.dates WHERE date({year: 2019, month: 12}) &gt; item &gt;= date({year: 2019, month: 10}))
RETURN c
```

But in addition, I also want to count how many dates in the list-property are between those two dates. For the above example, it should return 1 because only one date on the list is between 2019-12-01 and 2019-10-01.

How can I do that?

**Edit**

I found the following solution for my problem:
```
MATCH ()-[c:CONNECTED_TO]-()
WITH [x IN range(0,size(c.dates)-1) WHERE date({year: 2019, month: 12}) &gt; c.dates[x] &gt;= date({year: 2019, month: 1})] AS index, id(c) AS id
RETURN id, size(index) AS Size
```

Sadly this solution is very slow. The date-list can be of size 10.000 or higher. If there is somebody with a faster solution I would be happy to know.",1594121558,https://stackoverflow.com/q/62774330,Moritz Kampfinger,"['neo4j', 'cypher']"
62773318,Store a collection as a node in Neo4j,"I have a query that returns two variables A &amp; B. A returns collections that contain a variable number of values. B is a mathematical score related to each collection. I want to store A as nodes in the database with property B. Then if possible to check each node of A against the other nodes and create a relationship if both the values of B&gt; some number. Is this possible in Neo4j? 
An example of what my A and B looks like
```
MATCH (t:Trans)-[:CONTAINS]-&gt;(i2:Item), (t:Trans)-[:CONTAINS]-&gt;(i1:Item), (t:Trans)-[:CONTAINS]-&gt;(i3:Item) 
WITH i1, i2, i3, COUNT(*) as c
WHERE c&gt;100
WITH COLLECT({i1: i1, i2:i2, i3:i3, c: c}) AS data
UNWIND data AS d
WITH COLLECT({i1:d.i1.I_ID, i2:d.i2.I_ID, i3:d.i3.I_ID}) as Itemset, d
RETURN Itemset, d.c as NumTransactions
```

```
A                       B
{a,b,c}                 45
{e,f}                   23
{a,e,f}                 12
{d}                     89
```",1594118152,https://stackoverflow.com/q/62773318,dlman,"['neo4j', 'cypher']"
62764375,Neo4J - Post pagination for multiple Unions,"Hello I&#39;m trying to paginate over a Cypher which contains multiple Unions:

    MATCH(node:D1593731983259)
        WHERE toLower(node.name) CONTAINS {searchTerm}
    RETURN node {.*}
    UNION
    MATCH(node:D1593031169841)
        WHERE toLower(node.name) CONTAINS {searchTerm}
    RETURN node {.*}

I want to paginate the whole results to limit the number of results that all unions can have something like:

    MATCH(node:D1593731983259)
        WHERE toLower(node.name) CONTAINS {searchTerm}
    RETURN node {.*}
    UNION
    MATCH(node:D1593031169841)
        WHERE toLower(node.name) CONTAINS {searchTerm}
    RETURN node {.*}
    skip 20 limit 20 //&lt;------------ like this

But that pagination only applies on the last match for `(node:D1593031169841)` and not for the rest of them.

Can anybody help me with a workaround for this issue?

I&#39;m using Neo4J version 3.5.14

Thank you.",1594068910,https://stackoverflow.com/q/62764375,Carlos Herrera Plata,"['cypher', 'neo4j']"
62762047,Handling nested optional data in cypher Neo4j,"I am writing a cypher which handles optional data called ```questions```. The idea behind it is to create a relationship such as shown:

```
(dot:Dot)&lt;-[:IS_ABOUT]-(q:Question)&lt;-[:IS_ABOUT]-(a:Answer)
```

The data that is being passed in as questions, which is an array which contains text, answers and optional guid values. This questions parameter could also be an empty array, and also as new data is being added to the questions array they won&#39;t contain or have a guid.

The issue is when I run the query it fails to execute and run, I have had no luck with ```UNWIND ``` either, any help would be greatly appreciated!

If the question and answer contain a guid then it should match and update the values but if the question and answer contain no guid then it should create new nodes.

```
WITH [
  {
    text: &quot;something&quot;,
    guid: &quot;9a4aeac0-4ea4-469a-80c1-908573a4ad55&quot;,
    answer: [
      {
        text: &quot;something&quot;,
        guid: &quot;9a4aeac0-4ea4-469a-80c1-908573a74635&quot;,
        correct: false
      },
      {
        text: &quot;something&quot;,
        guid: &quot;9a4aeac0-4ea4-469a-80c1-908573a4ad22&quot;,
        correct: false
      },
      {
        text: &quot;something&quot;,
        guid: &quot;9a4aeac0-4ea4-469a-80c1-908573a4a987&quot;,
        correct: false
      }
    ]
  },
  {
  	text: &quot;something&quot;,
    answer: [
      {
        text: &quot;something&quot;,
        correct: false
      },
      {
        text: &quot;something&quot;,
        correct: false
      },
      {
        text: &quot;something&quot;,
        correct: false
      }
    ]
  }
] as questions

MATCH (d:Dot{GUID: &quot;9a4aeac0-4ea4-469a-80c1-908573a4ad61&quot;})

WITH d, questions

FOREACH (ignoreMe IN CASE WHEN questions IS NOT NULL THEN [1]
  ELSE []
  END |
  FOREACH (question IN questions |
    MERGE (q:Trivia:Question { GUID: question.guid })
      ON CREATE SET q.GUID = apoc.create.uuid(), q.creationDate = datetime(), q.text = question.text
      ON MATCH SET q.text = question.text
    MERGE (q)-[g:IS_ABOUT]-&gt;(dot)
      ON CREATE SET g.creationDate = datetime()
    FOREACH (answer IN question.answer |
      MERGE (a:Trivia:Answer { GUID: answer.guid })
        ON CREATE SET a.GUID = apoc.create.uuid(), a.creationDate = datetime(), a.text = answer.text, a.
          correct = answer.correct
        ON MATCH SET  a.text = answer.text, a.correct = answer.correct
      MERGE (a)-[t:TO]-&gt;(q)
        ON CREATE SET t.creationDate = datetime()
    )
  )
)

RETURN d
```",1594059322,https://stackoverflow.com/q/62762047,helomelo,"['neo4j', 'cypher']"
62718023,Neo4J - JPA - Doesn&#39;t return the relationship entity,"I have a following data model in Neo4J graph database.

    (Employee)--[:REPORTS_TO]--&gt;(Employee) // n-to-1 relation
    (Employee)--[:HAS_SKILL]--(Skill) // 1-to-n relation

My JPA entity classes:

    @NodeEntity
    public class Employee {
        @Id
        private String id;
        private String name;
    
        @Relationship(type = &quot;REPORTS_TO&quot;, direction = Relationship.OUTGOING)
        private Employee manager;
    
        @Relationship(type = &quot;HAS_SKILL&quot;, direction = Relationship.OUTGOING)
        private Set&lt;Skill&gt; skills; //Can have multiple skills
    }

 and

    @NodeEntity
    public class Skill {
    
        @Id
        private String id;
        private String name;
    }

I want to search Employee who has skill named `X` (for e.g.).
So in my Java Application I wrote JPA method with named query as follows:

    @Query(&quot;match (e:Employee)-[:HAS_SKILL]-&gt;(s:Skill{name:$0}) return e&quot;)
    List&lt;Employee&gt; findBySkill(String skill);

The query works perfectly and returns the employees who has the desired skill.  
But when I print the Objects the Relationship entities of the Employee (`manager` and `skills`) are `null`.  

Then I tried the below query:  

    match (e:Employee)-[:HAS_SKILL]-&gt;(s:Skill{name:$0}) match (e)-[r]-&gt;(m) return e,r,m

Now this query returned all the entities which were null in the previous one but also listed additional Employee node which doesn&#39;t match the skill but it was a manager node of an employee who has the desired skill.

So how can I get all employees which has skill X and the result should contain the relationship entities as well (meaning relationship entities not null)?",1593788331,https://stackoverflow.com/q/62718023,G.S,"['java', 'neo4j', 'spring-data-jpa', 'cypher']"
62717257,is is Possible oin CYPHER to Set (Copy) the Labels of Another Node?,"I want to set the labels of a newly-merged node to the labels of an existing node. I&#39;m pretty sure that the following worked :-

    SET sub_practice:labels(pract_parent)

but it doesn&#39;t work in 4.1 and throws an error.",1593785723,https://stackoverflow.com/q/62717257,wikitect,"['cypher', 'neo4j']"
62711420,filtering a fulltext search with a relationship constraint,"I am currently trying to filter the nodes retrieved from a fulltext search based on an existing relationship.

Here&#39;s the code (please note the &#39;note sure how to properly filter&#39; line

    CALL db.index.fulltext.queryNodes(
    	&quot;titleAndKeywords&quot;, 
    	$search_text) 
    YIELD node
    WITH node
    	WHERE $label in labels(node)
    OPTIONAL MATCH // &lt;-- not sure how to properly filter
    	(a:Account {
    			id : $account_id
    		})
    	-[:MEMBER]-&gt;
    	(node)
    	WHERE a IS NOT null
    WITH
    	node,
    	COLLECT(node) AS nodes,
    	COUNT(node) AS total
    OPTIONAL MATCH
    	(node)
    	WHERE
    		node.account_id = $account_id
    WITH
    	nodes + COLLECT(node) AS n,
    	total + COUNT(node) AS total
    UNWIND n AS node
    WITH
    	node,
    	total
    		SKIP $skip
    		LIMIT $limit
    WITH
    	COLLECT(node) AS results,
    	total
    RETURN results, total

So, from the code, for the first OPTIONAL MATCH, I am trying to get only the nodes which have a MEMBER relationship. However, what this full query does is return me duplicates",1593764804,https://stackoverflow.com/q/62711420,A. L,"['cypher', 'neo4j']"
62697806,How do you find all nodes with exactly N relationships of a single type?,"I have some nodes A connected to nodes B via a relationship rel. What query will I write to return all B which are related to exactly 3 A or exactly 4 A or exactly n A via the relation rel? I achieved this for 2 by using the following match clause:
```
MATCH (a1:A)&lt;-[:rel]-(b:B)-[:rel]-&gt;(a2:A)
```
I also require to know which 3 A are connected to that B as I need to count the occurrences of that set of 3 A",1593697474,https://stackoverflow.com/q/62697806,dlman,"['cypher', 'neo4j']"
62687370,Neo4J CYPHER in C# or Java: Return JSON output from “call db.schema.nodeTypeProperties()”?,"When calling `db.schema.nodeTypeProperties()` from within the Neo4J Broswer, the Code side tab returns the complete JSON schema in the Response drop-down. Is it possible to retrieve this JSON result in C# or Java using the Neo4J.Driver? I would like to deserialize the JSON text into C# classes.

[Screen-cap of Response drop-down from db.schema.nodeTypeProperties()][1]

I have explored the Neo4J.Driver `IDriver`, `IAsyncSession` and `IResultCursor` calls and cannot find a way to retrieve the JSON dataset.


  [1]: https://i.stack.imgur.com/NI5yl.png",1593651259,https://stackoverflow.com/q/62687370,MirelesJ,"['cypher', 'c#', 'neo4j', 'java', 'json']"
62671936,javascript neo4j-driver how to convert datetime into string,"I&#39;m currently getting the error

&gt;&#39;String cannot represent value: { year: { low: 2020, high: 0 }, month: { low: 7, high: 0 }, day: { low: 1, high: 0 }, hour: { low: 7, high: 0 }, minute: { low: 35, high: 0 }, second: { low: 45, high: 0 }, nanosecond: { low: 914000000, high: 0 }, timeZoneOffsetSeconds: { low: 0, high: 0 }, timeZoneId: null }&#39;

which is caused by one of my properties being stored as `datetime()`. What would be the way to convert this into a string?

I am using the neo4j-driver from npm",1593589229,https://stackoverflow.com/q/62671936,A. L,"['cypher', 'neo4j', 'javascript']"
62660385,Node is deleted and cannot be used to create a relationship,"I have a node-link model ( which is a graph ) of an electricity grid in Neo4j, so this should fit like a glove.
The nodes and links are objects of their own, which are traversable in an abstract manner.
Link has a starting node (:Link) – [:begint_bij] –&gt; (:Node) and an ending node (:Link) – [:eindigt_bij] –&gt; (:Node)
Every :Node and :Link has references to one or more objects. Links and Nodes are uniquely defined by their references in this model.

The model is generated by the object-oriented GIS model and because of the generating method ( which I have no influence on ) redundant Node Link (pairs) are in the dataset.

[Node-Link Energy Grid graph model picture][1]

In the picture we see a cloud of Nodes ( purple ) and Links ( green ) surrounding an electricity cable.

You can see the redundant pairs clearly with a pattern:
A Node-Link pair where the Node has only relationship to ( cables, gisreferences and links ) and the link has only relationships to ( cables, gisreferences and nodes )

For removing the redundant Node-Link pairs I have come up with this query:

```Call apoc.periodic.iterate (
&quot;MATCH (fld:e_lv_function_cable ) where not exists(fld.done) Return fld&quot;,
&quot;match (fld) - [:GenObject] - (fn:Node)
 match (fn) - [:begint_bij] - (l1:Link)
with [(fn) - [] - (obj1) | labels(obj1)] AS conn1, [(l1) - [] - (obj2) | labels(obj2)] AS conn2, fn, l1, fld
where all( lb1 IN  conn1 where lb1[0] in  [&#39;e_lv_function_cable&#39;,&#39;GisReference&#39;,&#39;Link&#39;] )
  and all( lb2 IN  conn2 where lb2[0] in  [&#39;e_lv_function_cable&#39;,&#39;GisReference&#39;,&#39;Node&#39;] )
with l1, fn, fld
match (l1) - [:eindigt_bij] - (n2) 
match (l2:Link) - [r] - (fn) - [:begint_bij] - (l1) 
Call apoc.do.when (
  n2 is not null and l2 is not null and r is not null,
  &#39;Call apoc.create.relationship(l2, type(r), {}, n2) YIELD rel Detach Delete l1, fn&#39;,
  &#39;&#39;,
  {n2: n2, l2: l2, r: r, l1: l1, fn: fn}) YIELD value
with fld
set fld.done=true
&quot;, {batchSize:100, parallel:false}) yield batches, total return batches, total
```

And it does the job. 

However in a few cases I get an error ( in the debug log ):

Failed to invoke procedure `apoc.do.when`: Caused by: org.neo4j.graphdb.NotFoundException: Node[] is deleted and cannot be used to create a relationship

And sometimes:

Failed to invoke procedure `apoc.do.when`: Caused by: java.lang.IllegalStateException: Kernel API returned non-existent relationship type: -1

And the set done=true is never done.

And it almost makes sense to me.

Can anyone please:
-	(better) explain to me what is causing this, and
-	Point me at a query that does the job 100% 

Thx.



  [1]: https://i.stack.imgur.com/9Rbtk.png",1593529136,https://stackoverflow.com/q/62660385,Mobius,"['neo4j', 'cypher']"
62659708,Neo4j WHERE NOT clause for different nodes not working,"I will explain briefly my query:

    match (a)-[:requires]-(b), 
          (a)-[:instanceOf]-&gt;(n)&lt;-[:superclassOf*]-(c:Host_configuration),
          (h)-[:instanceOf]-&gt;(z)&lt;-[:superclassOf*]-(t:Host)  
    where not b = h 
    return distinct a, b

My wish is to return all `(a)-[:requires]-(b)` patterns (where `a` is somehow a subclass of `Host_configuration` but `b` is not a subclass of `Host`. &lt;br&gt; 
This query however returns **also** nodes that actually are subclasses of `Host`
&lt;br&gt;
**EDIT**&lt;br&gt;
I don&#39;t want to retrieve all `a` elements connected to `b` elements that are not tied to `Host`. I want to retrieve all patterns between `a` and `b` that are not like `(a)-[:requires]-(h)` ",1593527115,https://stackoverflow.com/q/62659708,Gianluca,"['where-clause', 'cypher', 'neo4j']"
62654086,Improve Neo4j Cypher query performance,"````
USING PERIODIC COMMIT LOAD CSV WITH HEADERS FROM &quot;file:///sample.csv&quot; 
AS row WITH row 
MATCH (server:Server {  name:row.`SOURCE_HOST`, source:&#39;sample&#39;   })
MATCH (server__1:Server__1 {  name:row.`TARGET_HOST`, source:&#39;sample&#39;   })
MERGE (server)-[:DEPENDS_ON]-&gt;(server__1)
````
this query is taking very long time to create the relationships.
there are 1875 server and server__1 nodes each
Thanks in advance",1593508510,https://stackoverflow.com/q/62654086,ck22,"['neo4j', 'performance', 'cypher']"
62651472,Cannot aggregate total with a CALL with UNION,"I&#39;m trying to get the total rows of my union but it only shows a total of 1 for each (rather than 2)

    CALL {
    	OPTIONAL MATCH 
    		(a:Account { 
    				id : $account_id 
    			})
    		-[:MEMBER]-&gt;
    		(n:Workspace)
    	RETURN n
    	
    	UNION
    
    	OPTIONAL MATCH
    		(n:Workspace { 
    			account_id: $account_id 
    		})
    	RETURN n
    }
    WITH n, COUNT(n) AS total
    RETURN n, total

Is it possible to aggregate the `total`?



Current non-`UNION` query (works)

				OPTIONAL MATCH 
					(a:Account { 
							id : $account_id 
						})
					-[:MEMBER]-&gt;
					(n:Workspace)
				WITH 
					COLLECT(n) AS nodes, 
					COUNT(n) AS total
				OPTIONAL MATCH
					(n:Workspace { 
						account_id: $account_id 
					})
				WITH
					nodes + COLLECT(n) AS n,
					total + COUNT(n) AS total
				UNWIND n AS node
				WITH 
					node, 
					total
						SKIP $skip
						LIMIT $limit
				WITH 
					COLLECT(node) AS results, 
					total
				RETURN results, total ",1593498457,https://stackoverflow.com/q/62651472,A. L,"['cypher', 'neo4j']"
62639979,Cypher - Aggregation with optional match,"I have the following node structure in database:
```
Artifact {id:&#39;art1&#39;}
|ArtifactProperty {key:&#39;prop1_1&#39;, value:1}
|ArtifactProperty {key:&#39;prop1_2&#39;, value:2}
=Artifact {id:&#39;art1_1&#39;}
=|ArtifactProperty {key:&#39;prop1_1_1&#39;, value:1}
=|ArtifactProperty {key:&#39;prop1_1_2&#39;, value:2}
==Artifact {id:&#39;art1_1_1&#39;}
==|ArtifactProperty {key:&#39;prop1_1_1_1&#39;, value:1}
==|ArtifactProperty {key:&#39;prop1_1_1_2&#39;, value:2}
==Artifact {id:&#39;art1_1_2&#39;}
==|ArtifactProperty {key:&#39;prop1_1_2_1&#39;, value:1}
==|ArtifactProperty {key:&#39;prop1_1_2_2&#39;, value:2}
==Artifact {id:&#39;art1_1_3&#39;}
==|ArtifactProperty {key:&#39;prop1_1_3_1&#39;, value:1}
==|ArtifactProperty {key:&#39;prop1_1_3_2&#39;, value:2}
```

Where an Artifact is a node that can be related to other Artifact nodes via a CURRENT relation and/or ArtifactProperties also via a CURRENT relation. The CURRENT relation holds the id of the root

My goal is to fetch all artifacts whith its children and properties.

The following request:
```
MATCH (a:Artifact)-[:CURRENT {root: &#39;art1&#39;}]-&gt;(c:ArtifactProperty)
OPTIONAL MATCH (a:Artifact)-[:CURRENT {root: &#39;art1&#39;}]-&gt;(b:Artifact) 
WITH a {.id, children: collect(b {.id}), properties: collect(c {.key, .value})} as mapped
return mapped.id, mapped.children, mapped.properties
```

Provides the following result:
```
╒═══════════╤══════════════════════════════════════════════════════════════════════╤══════════════════════════════════════════════════════════════════════╕
│&quot;mapped.id&quot;│&quot;mapped.children&quot;                                                     │&quot;mapped.properties&quot;                                                   │
╞═══════════╪══════════════════════════════════════════════════════════════════════╪══════════════════════════════════════════════════════════════════════╡
│&quot;art1_1&quot;   │[{&quot;id&quot;:&quot;art1_1_3&quot;},{&quot;id&quot;:&quot;art1_1_2&quot;},{&quot;id&quot;:&quot;art1_1_1&quot;},{&quot;id&quot;:&quot;art1_1_3│[{&quot;value&quot;:1.0,&quot;key&quot;:&quot;prop_1_1_1&quot;},{&quot;value&quot;:1.0,&quot;key&quot;:&quot;prop_1_1_1&quot;},{&quot;v│
│           │&quot;},{&quot;id&quot;:&quot;art1_1_2&quot;},{&quot;id&quot;:&quot;art1_1_1&quot;}]                               │alue&quot;:1.0,&quot;key&quot;:&quot;prop_1_1_1&quot;},{&quot;value&quot;:2.0,&quot;key&quot;:&quot;prop_1_1_2&quot;},{&quot;value│
│           │                                                                      │&quot;:2.0,&quot;key&quot;:&quot;prop_1_1_2&quot;},{&quot;value&quot;:2.0,&quot;key&quot;:&quot;prop_1_1_2&quot;}]           │
├───────────┼──────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────┤
│&quot;art1_1_1&quot; │[]                                                                    │[{&quot;value&quot;:1.0,&quot;key&quot;:&quot;prop_1_1_1_1&quot;},{&quot;value&quot;:2.0,&quot;key&quot;:&quot;prop_1_1_1_2&quot;}│
│           │                                                                      │]                                                                     │
├───────────┼──────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────┤
│&quot;art1&quot;     │[{&quot;id&quot;:&quot;art1_1&quot;},{&quot;id&quot;:&quot;art1_1&quot;}]                                     │[{&quot;value&quot;:1.0,&quot;key&quot;:&quot;prop_1_1&quot;},{&quot;value&quot;:2.0,&quot;key&quot;:&quot;prop_1_2&quot;}]       │
├───────────┼──────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────┤
│&quot;art1_1_2&quot; │[]                                                                    │[{&quot;value&quot;:1.0,&quot;key&quot;:&quot;prop_1_1_2_1&quot;},{&quot;value&quot;:2.0,&quot;key&quot;:&quot;prop_1_1_2_2&quot;}│
│           │                                                                      │]                                                                     │
├───────────┼──────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────┤
│&quot;art1_1_3&quot; │[]                                                                    │[{&quot;value&quot;:1.0,&quot;key&quot;:&quot;prop_1_1_2_1&quot;},{&quot;value&quot;:2.0,&quot;key&quot;:&quot;prop_1_1_2_2&quot;}│
│           │                                                                      │]
```


The issue is my results are repeated for Artefacts with children (properties and children fields contain twice the same result).

There is probably a better way to perform this aggregation than to do an OPTIONAL MATCH so let me know if   I did not pick the best option.

EDIT:
This is the result I am trying to get, note that each child and property appear only once:

```
╒═══════════╤══════════════════════════════════════════════════════════════════════╤══════════════════════════════════════════════════════════════════════╕
│&quot;mapped.id&quot;│&quot;mapped.children&quot;                                                     │&quot;mapped.properties&quot;                                                   │
╞═══════════╪══════════════════════════════════════════════════════════════════════╪══════════════════════════════════════════════════════════════════════╡
│&quot;art1_1&quot;   │[{&quot;id&quot;:&quot;art1_1_3&quot;},{&quot;id&quot;:&quot;art1_1_2&quot;},{&quot;id&quot;:&quot;art1_1_1&quot;}]               │[{&quot;value&quot;:1.0,&quot;key&quot;:&quot;prop_1_1_1&quot;},{&quot;value&quot;:2.0,&quot;key&quot;:&quot;prop_1_1_2&quot;}    │
│           │                                                                      │                                                                      │
│           │                                                                      │                                                                      │
├───────────┼──────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────┤
│&quot;art1_1_1&quot; │[]                                                                    │[{&quot;value&quot;:1.0,&quot;key&quot;:&quot;prop_1_1_1_1&quot;},{&quot;value&quot;:2.0,&quot;key&quot;:&quot;prop_1_1_1_2&quot;}│
│           │                                                                      │]                                                                     │
├───────────┼──────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────┤
│&quot;art1&quot;     │[{&quot;id&quot;:&quot;art1_1&quot;}]                                                     │[{&quot;value&quot;:1.0,&quot;key&quot;:&quot;prop_1_1&quot;},{&quot;value&quot;:2.0,&quot;key&quot;:&quot;prop_1_2&quot;}]       │
├───────────┼──────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────┤
│&quot;art1_1_2&quot; │[]                                                                    │[{&quot;value&quot;:1.0,&quot;key&quot;:&quot;prop_1_1_2_1&quot;},{&quot;value&quot;:2.0,&quot;key&quot;:&quot;prop_1_1_2_2&quot;}│
│           │                                                                      │]                                                                     │
├───────────┼──────────────────────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────────────────┤
│&quot;art1_1_3&quot; │[]                                                                    │[{&quot;value&quot;:1.0,&quot;key&quot;:&quot;prop_1_1_2_1&quot;},{&quot;value&quot;:2.0,&quot;key&quot;:&quot;prop_1_1_2_2&quot;}│
│           │                                                                      │]
```

",1593439744,https://stackoverflow.com/q/62639979,Zillon,"['cypher', 'neo4j']"
62634060,two match and with queries return no results,"With my following query, I expected a `r` to be an array and `t` to be a number. But when I run the query, it just shows (no changes, no records).

When run individually, their output is as expected. So what is wrong with my query?

    MATCH 
    	(a:Account { 
    			id : $account_id 
    		})
    	-[:MEMBER]-&gt;
    	(n:Workspace)
    WITH 
    	COLLECT(n) AS nodes, 
    	COUNT(n) AS total
    MATCH 
    	(n:Workspace { 
    		account_id: $account_id 
    	})
    WITH
    	nodes + COLLECT(n) AS r,
    	total + COUNT(n) AS t
    RETURN r, t",1593419275,https://stackoverflow.com/q/62634060,A. L,"['cypher', 'neo4j']"
62631436,"neo4j. Matching nodes, but I need to return edges if there","Think to a Cypher query like this:

```
MATCH (n)
WHERE &lt;complex condition&gt;
RETURN n
```

But I need to return also possible edges between those nodes. Is it possible?",1593406448,https://stackoverflow.com/q/62631436,Paolo.Bolzoni,"['neo4j', 'cypher']"
62624836,prevent (?i) to change to ({1}i) in a query String of PreparedStatement using neo4j-jdbc-3.5.1driver,"The following lines of code

    String query =&quot;MATCH (n) WHERE n.name =~ &#39;(?i).*SUBSTRING.*&#39; RETURN n&quot;;
    final PreparedStatement  statement = connection.prepareStatement(query);
	
will change the query String 
`&quot;MATCH (n) WHERE n.name =~ &#39;(?i).*SUBSTRING.*&#39; RETURN n&quot;`
  
in the prepareStatement (by using replacePlaceholders method ) 

to `&quot;MATCH (n) WHERE n.name =~ &#39;({1}i).*SUBSTRING.*&#39; RETURN n&quot;` 
	

means it replace ? by {1}   
	
How to prevent the change of `(?i)` and to not become `({1}i)` when passed to prepareStatement() and have always `(?i)` even if we pass via replacePlaceholders regex?
	
Below I give more info of the problem:

The same task that would perform as LIKE clause in Cypher queries is made by the following construct: 

    MATCH (n) where n.Name =~ &#39;.*SUBSTRING.*&#39; return n.Name, n;

and to make it case insensitive: 

    MATCH (n) WHERE n.name =~ &#39;(?i).*SUBSTRING.*&#39; RETURN n;

And by using neo4j-jdbc-3.5.1.jar

The org.neo4j.jdbc.Neo4jPreparedStatement.java

    /**
     * Default constructor with connection and statement.
     *
     * @param connection   The JDBC connection
     * @param rawStatement The prepared statement
     */
    protected Neo4jPreparedStatement(Neo4jConnection connection, String rawStatement) {
    	super(connection);
    	this.statement = PreparedStatementBuilder.replacePlaceholders(rawStatement);//&lt;----LINE X
    	this.parametersNumber = PreparedStatementBuilder.namedParameterCount(statement);
    	this.parameters = new HashMap&lt;&gt;(this.parametersNumber);
    	this.batchParameters = new ArrayList&lt;&gt;();
    }

And in org.neo4j.jdbc.utils.PreparedStatementBuilder

    /**
         * This method return a String that is the original raw string with all valid placeholders replaced with neo4j curly brackets notation for parameters.
         * &lt;br&gt;
         * i.e. MATCH n RETURN n WHERE n.name = ? is transformed in MATCH n RETURN n WHERE n.name = {1}
         *
         * @param raw The string to be translated.
         * @return The string with the placeholders replaced.
         */
        public static String replacePlaceholders(String raw) {
            int index = 1;
            String digested = raw;
    
            String regex = &quot;\\?(?=[^\&quot;]*(?:\&quot;[^\&quot;]*\&quot;[^\&quot;]*)*$)&quot;;
            Matcher matcher = Pattern.compile(regex).matcher(digested);
    
            while (matcher.find()) {
                digested = digested.replaceFirst(regex, &quot;{&quot; + index + &quot;}&quot;);
                index++;
            }
    
            return digested;
        }
    	
In replacePlaceholders() the `?` is transformed to `{1}`.	",1593359363,https://stackoverflow.com/q/62624836,Schwertfisch,"['jdbc', 'cypher', 'neo4j']"
62597958,Neo4j CompositeIndex using relationship,"I have a (simplified) data model like this:

    @NodeEntity
    class MyNode {
        String name;

        @Relationship(value = &quot;REL&quot;)
        RelParent parent;
    }

I am trying to create a composite index on uniqueness of name and parent, so a MyNode object cannot exist with same name and same parent (they can exist with same name but different parent).

I tried with:

    @CompositeIndex(value= {&quot;name&quot;, &quot;parent&quot;}, unique=true)

But that throws an exception:  org.neo4j.ogm.exception.core.MetadataException: Incorrect CompositeIndex definition on MyNode. Property parent does not exists.

Is there a way to use CompositeIndex in the way I tried above?",1593185207,https://stackoverflow.com/q/62597958,user2327866,"['spring-data-neo4j', 'spring-data', 'neo4j', 'cypher']"
62592989,Cypher get all nodes but not every relationship for visualisation with neovis.js,"My graph consists only of nodes with the label Tag, which are joined by a relationship :CONNECTED_TO.

```
(:Tag)-[:CONNECTED_TO]-(:Tag)
```

In addition, :CONNECTED_TO has a property called count_question, which is an int value.

Now I would like to visualize my graph with **neovis.js**.
Therefore I would like to visualize every node from my network but only those relationships whose value for the count_question property matches a certain value.

I already tried to query my graph as followed
```
MATCH (t1:Tag)-[c:CONNECTED_TO]-(t2:Tag) 
WHERE c.count_question &gt; 50 
AND id(t1) &gt; id(t2)
RETURN t1, c, t2
```
But this will only give me the nodes who are linked by the relationship and not every node.

So how do I query by graph correctly, or is there a way to do this with neovis.js?",1593167936,https://stackoverflow.com/q/62592989,Moritz Kampfinger,"['neo4j', 'cypher']"
62582113,How can I create relationships in neo4j/Cypher from a csv that depend on the type of nodes?,"I am trying to import a csv into Neo4j that contains relationships between people, organizations, banks, assets, etc., where there is only one relationship per row. The column names are ***FROM, A.Type, TO, B.type***, and then different properties. Here, the from and to labels have the name, and A-B.type say if it belongs to a person, org., etc. respectibly.

I managed to create the nodes (around 3500) depending on type with ```FOREACH```, like so:

```FOREACH (_ IN CASE WHEN line.`A.type` = &#39;ASSET&#39; THEN [1] ELSE [] END | MERGE (asset:Asset {Name:line.FROM}))```

```FOREACH (_ IN CASE WHEN line.`A.type` = &#39;BANK&#39; THEN [1] ELSE [] END | MERGE (bank:Bank {Name: line.FROM}))```

.
.
.

```FOREACH (_ IN CASE WHEN line.`B.type` = &#39;ACTIVO&#39; THEN [1] ELSE [] END | MERGE (asset:Asset {Name:line.TO}))```

```FOREACH (_ IN CASE WHEN line.`B.type` = &#39;BANCO&#39; THEN [1] ELSE [] END | MERGE (bank:Bank {Name: line.TO}))```

.
.
.


My problem now is creating the relationships per row, I&#39;ve tried many different ways and nothing seems to work. 
For Example:

1. In this case, I changed the ```FOREACH``` to two different nodes depending on if they are on the FROM or TO column:
```
WITH &#39;link&#39; as line
LOAD CSV WITH HEADERS FROM url AS line
WITH line WHERE line.FROM = &#39;ASSET&#39; AND line.TO = &#39;ORGANIZATION&#39;
MERGE (a1:Asset {Name:line.FROM})
MERGE (o2:Organization {Name:line.TO})
CREATE (a1)-[con:PROPERTY_OF]-&gt;(o2) 
```
2. I also tried a variation of the code for creating nodes:

``` FOREACH(n IN (CASE WHEN line.`A.type` = &#39;ASSET&#39; THEN [1] ELSE [] END) |
  FOREACH(t IN CASE WHEN line.`B.type` = &#39;ORGANIZATION&#39; THEN [1] ELSE [] END |
   MERGE (asset)-[ao:CONNECTED_WITH]-&gt;(organization))) ```

3. This time I used the APOC library to try generating dinamic relationships depending on the relashionship type:

``` 
WITH asset, organization, line
CALL apoc.create.relationship(asset, line.RelationshipType, NULL, organization) YIELD rel
RETURN asset, rel, organization
 ```

And different variations of each, creating the nodes from scratch or matching them. Everytime the query seems to work, it runs, but it creates no relationships or it creates a single relationship between new nodes that don&#39;t exist in the csv, with no name or label.


I am completely new to Cypher/Neo4j and am at my wits end, if someone could point out my mistakes and how to correct them, it would be HIGHLY appreciated.

Thank you in advance! ",1593110059,https://stackoverflow.com/q/62582113,Luis Ayarzagoitia,"['neo4j', 'graph-databases', 'cypher', 'database']"
62579053,A method to sum all values in a returned column using Cypher in Neo4j,"I have written the following Cypher query to get the frequency of a certain item from a set of orders.
```
MATCH (t:Trans)-[r:CONTAINS]-&gt;(i:Item) 
WITH i,COUNT(*) AS CNT,size(collect(t)) as NumTransactions 
RETURN i.ITEM_ID as item, NumTransactions, NumTransactions/CNT as support
```
I get a table like this as my output
```
Item NumTransactions Support
A          2            1
B        1132           1
C        2049           1
```
And so on. What I mean to do is divide each NumTransaction by the total number of transactions. i.e. the sum of the entire num transactions column, to get the support but instead it divides NumTransactions by itself. Can someone point me to the correct function if it exists or an approach to do so?",1593099316,https://stackoverflow.com/q/62579053,dlman,"['cypher', 'neo4j']"
62564951,unintended effects from batch cypher query,"I have a batch query that that I am executing in batches passing an `$attribs` parameter.

`$attribs` is:
```
[{
  attribs: [{row_attribs:{attrKey:&quot;attrValue&quot;}}],
  match_crit:[ {matchKey:&quot;matchVal&quot;}]
}]
```

Query:

    UNWIND $attribs AS attrib_dict
    UNWIND attrib_dict.attribs as attrib_row
    UNWIND attrib_dict.match_crit as match_row
    CREATE (src:{src_ent})
    SET src += attrib_row.row_attribs
    WITH src, match_row
    MATCH (to:Article} {{name:match_row.matchKey})
    CREATE (src)-[:REL]-&gt;(to)


I am writing in batches of 250 yet on each batch something like 40k nodes are being created (very many duplicates causing this large number). How could this be? Could this be because I have multiple UNWIND clauses in my query? I assume something is getting funky with how I am handling the params within my query but don&#39;t want to start hacking away on my code without a purpose or understanding.

NB I would normally write in much larger batches (appx 5k nodes) but was encountering out of memory errors and I am guessing this explosion of node creation is the reason for that error.
",1593037453,https://stackoverflow.com/q/62564951,Mason Edmison,"['cypher', 'neo4j']"
62564153,Create multiple relationships in Neo4j using array of integers using Cypher,"I&#39;m new to Neo4j and Cypher and have just imported two csvs - one is a list of places and the other is a list of people. 

Each place has multiple peopleIDs for the people that have visited it stored as integers in an array.

Similarly, Each person has multiple placeIDs for the places they have visited stored as integers in an array.

I&#39;m struggling when creating the relationships between the people and place nodes in my graph. I have tried the following, which works for individual IDs, but it doesn&#39;t create any relationships from an array of IDs:

    MATCH (p1:People),(p2:Place)
    WHERE p1.placeID = p2.placeID
    CREATE (p1)-[:VISIT]-&gt;(p2)

The headers for the People csv file are as follows:
[![People csv headers][1]][1]

The headers for the Places csv file are as follows:
[![enter image description here][2]][2]

I guess that I need to use `FOREACH` or `UNWIND` or both but I can&#39;t find any good examples of how to achieve what I&#39;m after


  [1]: https://i.stack.imgur.com/fNaws.png
  [2]: https://i.stack.imgur.com/YwNYO.png",1593033104,https://stackoverflow.com/q/62564153,Sean,"['neo4j', 'cypher']"
62562417,AES-128-CBC cipher in java,"I&#39;m trying to implement encrypt with AES/128/CBC, but I need to encrypt with a 64 bytes key, But I have the problem with the length.

It is possible encrypt AES/128/CBC with a 64 bytes key or not, because I have the cipher algoritm in php with a 64 bytes key and it works, but not in java.

This is the encrypt code:

    
	 public static String ALGORITHM = &quot;AES&quot;;
	
	 public static String AES_CBC_PADDING = &quot;AES/CBC/PKCS5Padding&quot;;

	 public static byte[] encrypt(final byte[] key, final byte[] IV, final byte[] message) throws Exception {
	  return AESManager.encryptDecrypt(Cipher.ENCRYPT_MODE, key, IV, message);
	 }

	 public static byte[] decrypt(final byte[] key, final byte[] IV, final byte[] message) throws Exception {
	  return AESManager.encryptDecrypt(Cipher.DECRYPT_MODE, key, IV, message);
	 }

	 private static byte[] encryptDecrypt(final int mode, final byte[] key, 
			 							final byte[] IV, final byte[] message) throws Exception {
	  final Cipher cipher = Cipher.getInstance(AES_CBC_PADDING);
	  final SecretKeySpec keySpec = new SecretKeySpec(key, ALGORITHM);
	  final IvParameterSpec ivSpec = new IvParameterSpec(IV);
	  cipher.init(mode, keySpec, ivSpec);
	  return cipher.doFinal(message);
	 }

	 public static String getHex(byte[] data, int length) {
	  StringBuffer sb = new StringBuffer();
	  for (int i = 0; i &lt; length; i++) {
	   String hexStr = Integer.toHexString(((int) data[i]) &amp; 0xFF);
	   if (hexStr.length() &lt; 2) {
	    sb.append(&quot;0&quot;).append(hexStr.toUpperCase());
	   } else {
	    sb.append(hexStr.toUpperCase());
	   }
	  }
	  return sb.toString();
	 }

I have this error:

    java.security.InvalidKeyException: Invalid AES key length: 64 bytes
	at com.sun.crypto.provider.AESCrypt.init(AESCrypt.java:87)
	at com.sun.crypto.provider.CipherBlockChaining.init(CipherBlockChaining.java:93)
	at com.sun.crypto.provider.CipherCore.init(CipherCore.java:591)
	at com.sun.crypto.provider.AESCipher.engineInit(AESCipher.java:346)
	at javax.crypto.Cipher.implInit(Cipher.java:805)
	at javax.crypto.Cipher.chooseProvider(Cipher.java:863)
	at javax.crypto.Cipher.init(Cipher.java:1395)
	at javax.crypto.Cipher.init(Cipher.java:1326)
	at ec.otecel.tuenti.balance.util.AESManager.encryptDecrypt(AESManager.java)
	at ec.otecel.tuenti.balance.util.AESManager.encrypt(AESManager.java)
	at ec.otecel.tuenti.balance.util.FreemiumUtil.ciphertoFreemium(FreemiumUtil.java)
	at ec.otecel.tuenti.balance.util.FreemiumUtil.main(FreemiumUtil.java)

I have local_policy.jar and US_export_policy.jar in C:\Program Files\Java\jdk1.8.0_241\jre\lib\security
so, what could be the problem ?



",1593025772,https://stackoverflow.com/q/62562417,JhonArias,"['encryption', 'aes', 'cypher', 'cbc-mode', 'java']"
62553417,Importing sting arrays to integer from csv to Neo4j using Cypher,"I&#39;m new to Neo4j and Cypher and I&#39;m trying to import some data from csv that includes an array of IDs. I have the query below working but as Cypher defaults to strings, I&#39;ve been unable to find the best way to convert the array of placeIDs to integers.

    LOAD CSV WITH HEADERS FROM &#39;http://localhost:11001/project-ca45d786-e360-4e3b-b4b4-eb8fe62a7b55/People-Gridv2.csv&#39; AS row
    CREATE (:People {peopleID: toInteger(row.peopleID), nickname: row.nickname, firstName: row.firstName, lastName: row.lastName, relationship: row.relationship, firstMemory: row.firstMemory, lastMemory: row.lastMemory, placeID: split(row.placeID,&quot;;&quot;)})

I hoped that I&#39;d be able to do something like the following, but it doesn&#39;t work:

    placeID: toInteger(split(row.placeID,&quot;;&quot;))

Can anyone point me in the right direction?",1592996100,https://stackoverflow.com/q/62553417,Sean,"['neo4j', 'cypher', 'csv']"
62551926,Neo4j: add properties to a relation on match and on create,"My Skript is watching to a folder and will run Cypherqueries if there are any changes.  
I try to create a relation between two nodes i created before. When a relation will be created, it should have a &quot;Create Timestamp&quot; and if the node already exist, the relation should update a &quot;Update Timestamp&quot;. Here is what i try:

    CALL apoc.load.json(&quot;path/to/my/JSON&quot;) yield value 
        WITH value.`Request`.timestamp AS request
        MATCH(a:foo), (c:bar)
        WHERE a.id = c.id
        MERGE(a)-[b:has_relation]-&gt;(c)
        ON CREATE SET 
        	b += {
            	creation_batch_timestamp:trim(request.timestamp)
                }
        ON MATCH SET 
        	b += {
            	update_batch_timestamp:trim(request.timestamp)
                }

What i get back, is a Type mismatch error &quot;expected a map but was a String&quot; (my timestamp is a String)

Is it possible to use a MERGE-Statement for creating or update a relation? How i can solve this?
Thanks for helping :).",1592991183,https://stackoverflow.com/q/62551926,ottonormal,"['nodes', 'cypher', 'neo4j']"
62545179,Neo4j - Where not exists,"Today I was coding some sample queries and I stumbled in something.

Let&#39;s say that I have the following dataset:
[![dataset][1]][1]


  [1]: https://i.stack.imgur.com/NuLGz.png

If I query:

    MATCH (c:company)-[:sells]-&gt;(p:product)&lt;-[:taxes]-(t:tax)
    WHERE NOT EXISTS {
    	MATCH (p)&lt;-[:taxes]-(t)
        WHERE t.name = &#39;tax2&#39;
    }
    RETURN c,p

Then I get all the products that don&#39;t have ONLY tax2 ( product1 and product3 )

But if I query:

    MATCH (c:company)-[:sells]-&gt;(p:product)&lt;-[:taxes]-(t:tax)
    WHERE NOT EXISTS {
    	MATCH (p)&lt;-[:taxes]-(t2)
        WHERE t2.name = &#39;tax2&#39;
    }
    RETURN c,p,t

Then I get only product1 ( which doesn&#39;t have tax2 ). This is the behavior that I was expecting from both queries. I know that in the first example, the variable &quot;t&quot; was also used in the subquery, how this affects the output?",1592954102,https://stackoverflow.com/q/62545179,julianomontini,"['neo4j', 'cypher']"
62533423,Combine two cypher queries,"Currently this is the data stored in the database

    Org Name   Org ID
    A            1
    B            2
    C            5
    D            9  

I&#39;m trying to combine these 2 queries:

    MATCH (n:Org)
    WHERE n.id in [1,2]
    RETURN n.name as group1_name, n.id as group1_id

    MATCH (n:Org)
    WHERE n.id in [5,9]
    RETURN n.name as group2_name, n.id as group2_id

I need the result to be shown like this:

    group1_id   group1_name   group2_id   group1_name
    1                A           5          C
    2                B           9          D

  ",1592910822,https://stackoverflow.com/q/62533423,user341383,"['cypher-3.1', 'cypher', 'neo4j', 'graph-databases']"
62514444,How to include failed matches values in cypher,"I&#39;m trying to return a value for every population whether the population is connected to the node or not. if there is no connection between population and allele it should just return a NULL

I tried to use optional match but this just returns all the connected nodes and no values for the not connected nodes. 

This is my current attempt at achieving it:

    MATCH (p:Population)
    with p
    OPTIONAL MATCH (p)&lt;-[s:has_support]-(a:Allele)
    RETURN a, count(p.name) limit 25

I used count as a quick check if it always returns the right amount of values, it should always return the same amount of values as population nodes in the graph database.

How do i achieve this?

Kind regard,
julian
",1592828777,https://stackoverflow.com/q/62514444,Moopsish,"['cypher', 'neo4j']"
62506540,creating map/object parameter in cypher,"I&#39;m trying to create a parameter in the cypher console with the following command:

    :param props =&gt; { status: &quot;closed&quot; }

However, it&#39;s throwing me the error

[![enter image description here][1]][1]

Is it possible to create a map/object in the cypher console?

https://neo4j.com/docs/cypher-manual/current/syntax/parameters/#cypher-parameters-create-node-with-properties

indicates that it can

  [1]: https://i.stack.imgur.com/jes61.png",1592792289,https://stackoverflow.com/q/62506540,A. L,"['cypher', 'neo4j']"
62496968,Neo4j cypher. setting reverse relationship between nodes,"I have defined all relationships `r` with a property reverse relationship `rr`.

I am able to recover all relationship types and their `rr` with a cypher query. 

Now I wish to iterate over each relation `type(r)`, get all pairs of nodes, which have this relationship. Say `(a)-&gt;[type(r)]-(b)`. Then create reverse relation ship create `(b)-[rr]-&gt;(a)` if it does not exist.  

New to cypher. Unable to make headway.

please help",1592733343,https://stackoverflow.com/q/62496968,yeshwant,"['neo4j', 'relationship', 'cypher']"
62493423,Neo4j browser seems disoriented when using 4.0-enterprise docker,"I used docker 4.0-enterprise and logged into the browser on a **remote server**.

Using, `:dbs` shows databases on the **remote server** correctly

BUT, `show databases` shows databases on **localhost**

Is this a bug or a &quot;feature&quot; ?

What do I have to do to see databases on remote host when I use `show databases` ?

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/bepWW.png",1592701855,https://stackoverflow.com/q/62493423,fodon,"['neo4j', 'cypher']"
62489760,Neo4j PHP Graphaware &#39;415 Unsupported Media Type &#39;,"The following test case (assuming correct password) 
```

    &lt;?php
    require &#39;vendor/autoload.php&#39;;
    
    use GraphAware\Neo4j\Client\ClientBuilder;
    
        $client = ClientBuilder::create()
        -&gt;addConnection(&#39;default&#39;,&#39;http://neo4j:neo4j@localhost:7474&#39;)
        -&gt;build();
    
        $result = $client-&gt;run(&#39;match (n:person) return n&#39;);

```
gives me the following error:

```

Fatal error: Uncaught Http\Client\Common\Exception\ClientErrorException: Unsupported Media Type in C:\Users\Ali\Desktop\Xamp\htdocs\Neo4j\vendor\php-http\client-common\src\Plugin\ErrorPlugin.php:72 Stack trace: #0 C:\Users\Ali\Desktop\Xamp\htdocs\Neo4j\vendor\php-http\client-common\src\Plugin\ErrorPlugin.php(54):HttpClientCommonPluginErrorPlugin-&gt;transformResponseToException(Object(GuzzleHttp\Psr7\Request), Object(GuzzleHttp\Psr7\Response)) #1 C:\Users\Ali\Desktop\Xamp\htdocs\Neo4j\vendor\php-http\httplug\src\Promise\HttpFulfilledPromise.php(34): Http\Client\Common\Plugin\ErrorPlugin-&gt;Http\Client\Common\Plugin\{closure}(Object(GuzzleHttp\Psr7\Response)) #2 C:\Users\Ali\Desktop\Xamp\htdocs\Neo4j\vendor\php-http\client-common\src\Plugin\ErrorPlugin.php(55): Http\Client\Promise\HttpFulfilledPromise-&gt;then(Object(Closure)) #3 C:\Users\Ali\Desktop\Xamp\htdocs\Neo4j\vendor\php-http\client-common\src\PluginClient.php(161): Http\Client\Common\Plugin\ErrorPlugin-&gt;handleRequest(Object(GuzzleHttp\Psr7\Request), Object(Closure), in C:\Users\Ali\Desktop\Xamp\htdocs\Neo4j\vendor\php-http\client-common\src\Plugin\ErrorPlugin.php on line 72

```
This is the $client when I var_dump it:


    object(GraphAware\Neo4j\Client\Client)#7 (2) {
      [&quot;connectionManager&quot;:protected]=&gt;
      object(GraphAware\Neo4j\Client\Connection\ConnectionManager)#2 (2) {
        [&quot;connections&quot;:&quot;GraphAware\Neo4j\Client\Connection\ConnectionManager&quot;:private]=&gt;
        array(1) {
          [&quot;default&quot;]=&gt;
          object(GraphAware\Neo4j\Client\Connection\Connection)#4 (5) {
            [&quot;alias&quot;:&quot;GraphAware\Neo4j\Client\Connection\Connection&quot;:private]=&gt;
            string(7) &quot;default&quot;
            [&quot;uri&quot;:&quot;GraphAware\Neo4j\Client\Connection\Connection&quot;:private]=&gt;
            string(38) &quot;http://neo4j:Password@localhost:7474&quot;
            [&quot;driver&quot;:&quot;GraphAware\Neo4j\Client\Connection\Connection&quot;:private]=&gt;
            object(GraphAware\Neo4j\Client\HttpDriver\Driver)#6 (2) {
              [&quot;uri&quot;:protected]=&gt;
              string(38) &quot;http://neo4j:Password@localhost:7474&quot;
              [&quot;config&quot;:protected]=&gt;
              object(GraphAware\Neo4j\Client\HttpDriver\Configuration)#5 (1) {
                [&quot;timeout&quot;:protected]=&gt;
                int(5)
              }
            }
            [&quot;session&quot;:&quot;GraphAware\Neo4j\Client\Connection\Connection&quot;:private]=&gt;
            NULL
            [&quot;timeout&quot;:&quot;GraphAware\Neo4j\Client\Connection\Connection&quot;:private]=&gt;
            int(5)
          }
        }
        [&quot;master&quot;:&quot;GraphAware\Neo4j\Client\Connection\ConnectionManager&quot;:private]=&gt;
        NULL
      }
      [&quot;eventDispatcher&quot;:protected]=&gt;
      object(Symfony\Component\EventDispatcher\EventDispatcher)#8 (2) {
        [&quot;listeners&quot;:&quot;Symfony\Component\EventDispatcher\EventDispatcher&quot;:private]=&gt;
        array(0) {
        }
        [&quot;sorted&quot;:&quot;Symfony\Component\EventDispatcher\EventDispatcher&quot;:private]=&gt;
        array(0) {
        }
      }
    }



I don&#39;t know how to interpret this or what is wrong.

    

 - My database is running properly in the neo4j browser client.

   

 - As far as I know graphaware is installed appropriately, as per the  
   instructions on the website.

 - I have tested and the error occurs at the point of running the query,
   not at the point of creating the client (even though this is    not
   indicated clearly by the error)

 - If I copy / paste the query directly into the neo4j browser client
   then it works as expected.

Any idea why I am getting this error?
",1592676251,https://stackoverflow.com/q/62489760,Ali,"['cypher', 'php', 'neo4j']"
62481305,How can I find and remove nodes for which two of a given relationship exist?,"I have a requirement that in my database some nodes should have at most one relationship of a given type. For example, nodes with the label `Heart` should be connected via `has` to at most one node of label `Body`.

Here&#39;s some test data to illustrate the issue:
```
CREATE (h:Heart {animal: &quot;zebra&quot;})
CREATE (b1:Body {animal: &quot;zebra&quot;})
CREATE (b2:Body {animal: &quot;elephant&quot;})
CREATE (b1)-[:has]-&gt;(h)
CREATE (b2)-[:has]-&gt;(h)

CREATE (h2:Heart {animal: &quot;mouse&quot;})
CREATE (b4:Body {animal: &quot;mouse&quot;})
CREATE (b5:Body {animal: &quot;leopard&quot;})
CREATE (b4)-[:has]-&gt;(h2)
CREATE (b5)-[:has]-&gt;(h2)
```

With the following query I can find all nodes with connections which don&#39;t respect this rule:
```
MATCH (n:Heart) WHERE (:Body)-[:has]-(n)-[:has]-(:Body) RETURN n
```

I&#39;d like though,  to write a statement to remove the &quot;extra&quot; relationships. Right now I&#39;ve got a query to remove the nodes composing these &quot;extra&quot; relationships, but it also removes the nodes I&#39;d like to keep (one of each).
```
MATCH (b1:Body)-[:has]-(n)-[:has]-(b2:Body) DETACH DELETE b1, b2
```
This also doesn&#39;t group relationships by the center node, so I can&#39;t really remove all nodes except one, as it would not have the desired effect.

Does anyone know how can I write a statement that will remove all &quot;extra&quot; relationships until only one relationship `has` remains for each `Heart` node? Preferably the oldest one.",1592624103,https://stackoverflow.com/q/62481305,Telmo Trooper,"['neo4j', 'cypher']"
62465857,&quot;with&quot; keyword changes the results,"query 1 

```
MATCH (n:PC)-[r:C1|C2|U]-&gt;(n2) WHERE r.date IS NULL OR (r.date &gt; 1 AND r.date &lt; 15)
WITH n,n2, 
reduce(t = 0, r in [x IN collect(r) WHERE type(x) = &#39;C1&#39; or type(x) = &#39;C2&#39;] | t + r.amount) as totalAmount1, 
reduce(t = 0, r in [x IN collect(r) WHERE type(x) = &#39;U&#39; ] | t + r.amount) as totalAmount2 
WHERE totalAmount1 &gt;= 1291 AND totalAmount2 &gt;= 1000
RETURN COUNT(*)
```

query 2
```
MATCH (n:PC)-[r:C1|C2|U]-&gt;(n2) WHERE r.date IS NULL OR (r.date &gt; 1 AND r.date &lt; 15)
WITH n, 
reduce(t = 0, r in [x IN collect(r) WHERE type(x) = &#39;C1&#39; or type(x) = &#39;C2&#39;] | t + r.amount) as totalAmount1, 
reduce(t = 0, r in [x IN collect(r) WHERE type(x) = &#39;U&#39; ] | t + r.amount) as totalAmount2 
WHERE totalAmount1 &gt;= 1291 AND totalAmount2 &gt;= 1000
RETURN COUNT(*)
```

As you can see, these 2 queries are VERY similar to each other. **The only difference is I used `WITH n,n2` instead of `WITH n` in the second query.** I expect both of them to return THE SAME results. 

**BUT** query 1 returns 0 the other returns 113. why? how?

Note: the database contains nearly 7 million nodes and 10 million edges.",1592553668,https://stackoverflow.com/q/62465857,canbax,"['cypher', 'neo4j']"
62459756,Cypher executed from Stored Procedure much slower than raw cypher,"I have a query and pattern which I used to run with different parameter values to identify and create nodes. I wanted to make writing with the query simpler, so I put the query in a stored procedure, compiled the jar, and began my processing. 

While easier to call the stored procedure and pass the parameters, the time to execute was MUCH slower (around 10 times slower), and was getting progressively worse as I loaded more and more data into the graph. When I switched back to using the raw queries (and more copy/paste) my time to execute dropped back down. 

It feels as if the database is recompiling and/or replanning every time the query in the stored procedure calls is run. 

Is there a way to cache the query from the stored procedure? 

From what I can tell, my code is identical from inside, and outside the stored procedure. The stored procedure runs, just very very slow when compared to calling the cypher outside of the procedure. 

Below is my raw cypher query

    with [&#39;register&#39;] as verbs match (e:Entity {type:&#39;PRODUCT&#39;, graphId: $graphId})
    USING INDEX e:Entity(graphId)
    with e, verbs
    match (e)-[:REFERS]-&gt;(eWord:Word {graphId:$graphId})&lt;-[:OBJ|OBL|NMOD]-(vb:Word {graphId: $graphId})-[]-&gt;(notWord:Word {graphId: $graphId})
    USING INDEX vb:Word(graphId)
    USING INDEX notWord:Word(graphId)
      where vb.lemma in verbs
    create (event:Event {graphId: $graphId, type: &#39;registerFail&#39;})
    with event, e, vb, notWord
    merge (event)-[:TRIGGER]-&gt;(vb)
    merge (event)-[:TRIGGER]-&gt;(notWord)
    merge (event)-[:RELATED_PRODUCT]-&gt;(e)
    with event
    match (event)-[:TRIGGER]-&gt;(word:Word {graphId: $graphId})-[:COMPOUND|COMPOUND_PRT]-&gt;(compWord:Word {graphId: $graphId})
    USING INDEX word:Word(graphId)
    USING INDEX compWord:Word(graphId)
    merge (event)-[:TRIGGER]-&gt;(compWord);

Here is the code to my stored procedure 

    @Procedure(name = &quot;ie.createInabilityCypher&quot;, mode = Mode.WRITE)
    public void createInabilityFromProduct(@Name(&quot;listOfVerbs&quot;) List&lt;String&gt; verbs, @Name(&quot;inabilityType&quot;) String inabilityType, @Name(&quot;graphId&quot;) String graphId) {
        
        String cypherQuery = &quot;&quot; +
                &quot;with $verbsList as verbs &quot; +
                &quot;match (e:Entity {type:&#39;PRODUCT&#39;, graphId: $graphId}) &quot; +
                &quot;USING INDEX e:Entity(graphId) &quot; +
                &quot;with e, verbs &quot; +
                &quot;match (e)-[:REFERS]-&gt;(eWord:Word {graphId:$graphId})&lt;-[:OBJ|OBL|NMOD]-(vb:Word {graphId: &#39;&quot; + graphId +&quot;&#39;})-[]-&gt;(notWord:Word {graphId: $graphId}) &quot; +
                &quot;USING INDEX vb:Word(graphId) &quot; +
                &quot;USING INDEX notWord:Word(graphId) &quot; +
                &quot;where vb.lemma in verbs &quot; +
                &quot;create (event:Event {graphId: $graphId, type: $inabilityType}) &quot; +
                &quot;with event, e, vb, notWord &quot; +
                &quot;merge (event)-[:TRIGGER]-&gt;(vb) &quot; +
                &quot;merge (event)-[:TRIGGER]-&gt;(notWord) &quot; +
                &quot;merge (event)-[:RELATED_PRODUCT]-&gt;(e) &quot; +
                &quot;with event &quot; +
                &quot;match (event)-[:TRIGGER]-&gt;(word:Word {graphId: $graphId})-[:COMPOUND|COMPOUND_PRT]-&gt;(compWord:Word {graphId: $graphId}) &quot; +
                &quot;USING INDEX word:Word(graphId) &quot; +
                &quot;USING INDEX compWord:Word(graphId) &quot; +
                &quot;merge (event)-[:TRIGGER]-&gt;(compWord)&quot;;

        Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();
        params.put(&quot;graphId&quot;, graphId);
        params.put(&quot;verbsList&quot;, verbs);
        params.put(&quot;inabilityType&quot;, inabilityType);
        tx.execute(cypherQuery, params);",1592515999,https://stackoverflow.com/q/62459756,Joshua Sperry,"['cypher', 'neo4j', 'stored-procedures']"
62454248,Neo4j query improvization,"How can I Optimise below query
````
match (e1Server:Server) where e1Server.name=&#39;XYZ&#39; 
optional match (e1Server)-[r1:AFFINITY]-(n1Server:Server)
optional match (n1Server:Server)-[r2:AFFINITY]-(n2Server:Server) where id(e1Server) &lt;&gt; id(n2Server)
optional match (n2Server:Server)-[r3:AFFINITY]-(n3Server:Server) where id(e1Server) &lt;&gt; id(n3Server) and id(n1Server) &lt;&gt; id(n3Server) 
optional match (n3Server:Server)-[r4:AFFINITY]-(n4Server:Server) where id(e1Server) &lt;&gt; id(n4Server) and id(n1Server) &lt;&gt; id(n4Server) and id(n2Server) &lt;&gt; id(n4Server) 
return distinct e1Server,n1Server,n2Server,n3Server,n4Server 
````
",1592495986,https://stackoverflow.com/q/62454248,ck22,"['neo4j', 'optimization', 'cypher']"
62450645,How to get all the indexes created on a label using cypher query in redisgraph,"How to get all the indexes created on a label using cypher query in redisgraph.

I tried below command, but it returned error message.

    CALL db.indexes();

ERROR:Procedure `db.indexes` is not registered",1592485477,https://stackoverflow.com/q/62450645,Jagadeesh Urlana,"['redis', 'cypher', 'redisgraph']"
62450549,Compute Avg of list value for each element in Neo4j,"The Problem to solve is:

    List: [x1, y1, z1], [x2, y2, z2] ...[xn, yn, zn]

Output expected: 

    [(x1+x2+..+xn)/n, (y1+y2+..yn)/n, (z1+z2+..+z3)/n]

`

I&#39;m able to perform the addition when I&#39;ve 2 list only and size is fixed using the below statement:
```
UNWIND(apoc.coll.zip([1,2,3], [4,5,6])) as output

RETURN COLLECT(apoc.coll.avg(output))
```
Output is 
```
[2.5, 3.5, 4.5]
```

But wasn&#39;t not able to compyte for dynamic number of *n* list. The size of list is constant for which avg needs to be computed.

**Neo4j Desktop Graph version**: 3.5.18 

**APOC LIbrary**: 3.5.0.12

Thanks in advance!

",1592485114,https://stackoverflow.com/q/62450549,Sudarshan Kothari,"['neo4j', 'neo4j-apoc', 'average', 'cypher']"
62438852,My match/merge process is not creating relationships in the Neo4J database,"I am very new to Neo4j/cypher/graph databases, and have been trying to follow the [Neo4j tutorial](https://neo4j.com/developer/guide-importing-data-and-etl/#export-csv) to import data I have in a `csv` and create relationships. 

The following code does what I want in terms of reading in the data, creating nodes, and setting properties. 

    /* Importing data on seller-buyer relationshsips */
    USING PERIODIC COMMIT 1000
    LOAD CSV WITH HEADERS FROM &#39;file:///customer_rel_table.tsv&#39; AS row
    FIELDTERMINATOR &#39;\t&#39;
    MERGE (seller:Seller {sellerID: row.seller})
      	ON CREATE SET seller += {name: row.seller_name,
    						     root_eid: row.vendor_eid,
    						     city: row.city}
    MERGE (buyer:Buyer {buyerID: row.buyer})
        ON CREATE SET buyer += {name: row.buyer_name};
    
    
    /* Creating indices for the properties I might want to match on */
    CREATE INDEX seller_id FOR (s:Seller) on (s.seller_name);
    CREATE INDEX buyer_id FOR (b:Buyer) on (b.buyer_name);
    
    /* Creating constraints to guarantee buyer-seller pairs are not duplicated */
    CREATE CONSTRAINT sellerID ON (s:Seller) ASSERT s.sellerID IS UNIQUE;
    CREATE CONSTRAINT buyerID on (b:Buyer) ASSERT b.buyerID IS UNIQUE;

Now I have the nodes (sellers and buyers) that I want, and I would like to link buyers and sellers. The code I have tried for this is: 

    USING PERIODIC COMMIT 1000
    LOAD CSV WITH HEADERS FROM &#39;file:///customer_rel_table.tsv&#39; AS row
    MATCH (s:Seller {sellerID: row.seller})
    MATCH (b:Buyer {buyerID: row.buyer})
    MERGE (s)-[st:SOLD_TO]-&gt;(b)

The query runs, but I don&#39;t get any relationships: 

`Query executed in 294ms. Query type: WRITE_ONLY.
No results.`

Since I&#39;m not asking it to `RETURN` anything, I think the &quot;No results&quot; comment is correct, but when I look at metadata for the DB, no relationships appear. Also, my data has ~220K rows, so 294ms seems fast. 

EDIT: At @cybersam&#39;s prompting, I tried this query: 
`MATCH p=(:Seller)-[:SOLD_TO]-&gt;(:Buyer) RETURN p`, which gives `No results.`

For clarity, there are two fields in my data that are the heart of the relationship: 
`seller` and `buyer`, where the seller sells stuff to the buyer. The seller identifiers are repeated, but for each seller there are unique seller-buyer pairs. 

What do I need to fix in my code to get relationships between the `sellers` and `buyers`? Thank you! 


",1592430211,https://stackoverflow.com/q/62438852,Savage Henry,"['neo4j', 'graph-databases', 'graph-data-science', 'cypher']"
62436831,Totalize and Relationships in depth,"I&#39;m using neo4j 3.5 community edition and trying totalize and get hops from a specific node. I&#39;m running to totalize(its working):

    MATCH (p:Person{id:123})-[r]-&gt;(m)
    RETURN p,count(distinct(r.idSale)) as qtd,sum(r.value) as value,type(r) as type,r.seg as segment,m

How I get hops when its totalize?? I&#39;m trying something like these (not working):

    MATCH (p:Person{id:123})-[r]-&gt;(m)-[r2*2]-&gt;(m2)
    RETURN p,count(distinct(r.idSale)) as qtd,sum(r.value) as value,type(r),m,count(distinct(r2.idSale)) as qtd2,sum(r2.value) as t
&gt; error : Type mismatch: expected Any, Map, Node, Relationship, Point,
&gt; Duration, Date, Time, LocalTime, LocalDateTime or DateTime but was
&gt; List&lt;Relationship&gt; (line 1, column 149 (offset: 148))

My graph is like this:
[![enter image description here][1]][1]
I&#39;m trying:
[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/BH00n.png
  [2]: https://i.stack.imgur.com/I8Y5c.png",1592421738,https://stackoverflow.com/q/62436831,Pedro Chagas junior,"['neo4j', 'cypher']"
62433047,Variable in neo4j query,"Is it possible to use variable in [tag:neo4j] query?

For example [tag:mysql]:
````
SET @id = 1;
SELECT @id;
+------+
| @id  |
+------+
|    1 |
+------+
````

Is it possible to do something similar in [tag:neo4j], like:
````
SET @id = 1;
WITH @id as id RETURN id;
````

PS: Reason - I have big and complicated query and to run this query couple times with different params I have to manually replace values in query, which is not efficient.
&lt;br&gt;With these variables I wouldn&#39;t need to change query, just update variables values...",1592408856,https://stackoverflow.com/q/62433047,cn007b,"['neo4j', 'cypher']"
62429196,Example script provided by neo4j for JavaScript won&#39;t run,"I am very new to the graph database ecosystem and for start I am experimenting with the neo4j. I would very much like to work with node and neo4j. So after a quick search I found [neo4j-driver](https://neo4j.com/developer/javascript/) that is an officially supported driver for JavaScript and an example provided which is:
```
const neo4j = require(&#39;neo4j-driver&#39;)

const driver = neo4j.driver(uri, neo4j.auth.basic(user, password))
const session = driver.session()
const personName = &#39;Alice&#39;

try {
  const result = await session.run(
    &#39;CREATE (a:Person {name: $name}) RETURN a&#39;,
    { name: personName }
  )

  const singleRecord = result.records[0]
  const node = singleRecord.get(0)

  console.log(node.properties.name)
} finally {
  await session.close()
}

// on application exit:
await driver.close()
```
now when I run this code, I immediately get the following error:
```
SyntaxError: await is only valid in async function
```
Now I thought I understood the error that I would have to wrap the try-catch block with anonymous async function to get rid of the error. The changed code body is:
```
const config = {
    &quot;neo4j&quot;: {
        &quot;url&quot;: &quot;neo4j://localhost&quot;,
        &quot;authUser&quot;: &quot;neo4j&quot;,
        &quot;authKey&quot;: &quot;adminPassword&quot;
    }
}

const neo4j = require(&quot;neo4j-driver&quot;);

const driver = neo4j.driver(
    config.neo4j.url,
    neo4j.auth.basic(config.neo4j.authUser, config.neo4j.authKey)
);

const session = driver.session();

(async () =&gt; {
    try {
        const result = await session.run(&#39;CREATE (a:Person {name: $name}) RETURN a&#39;, { name: &#39;Alice&#39; });

        const singleRecord = result.records[0];
        const node = singleRecord.get(0);

        console.log(node.properties.name);
    } catch (error) {
        console.log(&quot;Error Body: &quot;, error);
    } finally {
        await session.close();
    }
})();

await driver.close();
```
But to my dismay, I have run into another error that is very cryptic:
```
{ Neo4jError: Could not perform discovery. No routing servers available. Known routing table: RoutingTable[database=Sample database, expirationTime=0, currentTime=1592397056399, routers=[], readers=[], writers=[]]

    at captureStacktrace (/Users/pc/node_modules/neo4j-driver/lib/result.js:263:15)
    at new Result (/Users/pc/node_modules/neo4j-driver/lib/result.js:68:19)
    at Session._run (/Users/pc/node_modules/neo4j-driver/lib/session.js:174:14)
    at Session.run (/Users/pc/node_modules/neo4j-driver/lib/session.js:135:19)
    at /Users/pc/neoNode.js:20:38
    at Object.&lt;anonymous&gt; (/Users/pc/neoNode.js:31:3)
    at Module._compile (module.js:653:30)
    at Object.Module._extensions..js (module.js:664:10)
    at Module.load (module.js:566:32)
    at tryModuleLoad (module.js:506:12) code: &#39;ServiceUnavailable&#39;, name: &#39;Neo4jError&#39; }
```  
",1592397476,https://stackoverflow.com/q/62429196,gameFrenzy07,"['neo4j', 'cypher', 'javascript', 'node.js']"
62423462,How to skip an unwound list,"I have the following query

    MATCH (n:Mob)
    WITH COUNT(n) as total, COLLECT(n) as nodes
    UNWIND nodes as node
    WITH total, node
    WHERE 8000 &lt; node.order &lt; 8100
    RETURN node, total
    SKIP 10
    LIMIT 1

Right now, this query is giving me this error.

[![enter image description here][1]][1]

If I remove the SKIP part it works.

So my overall question is, how do I SKIP some of the records?

  [1]: https://i.stack.imgur.com/LxPWo.png",1592378267,https://stackoverflow.com/q/62423462,A. L,"['neo4j', 'cypher']"
62423186,Neo4j on Graphenedb How can I improve Cypher SPEED and what does Normailzing mean on Graphenedb," Here is my Cypher Query

&gt; MERGE (u:University {
        name: $university, country: $country
      })
      MERGE (u)&lt;-[:DEPARTMENT_IN]-(d:Department {
        name: $department
      })
      MERGE (d)&lt;-[:LEVEL_IN]-(l:Level {
        name: $level
      })
      MERGE (l)&lt;-[:STUDENT_OF]-(user:User {
        firstName: $firstName,
        lastName: $lastName,
        password: $password,
        email: $email,
        username
        dob: $dob,
        id: $id
      }) RETURN user, u, d, l

This works, but not very fast as what I anticipated. It takes up to 4.5 seconds to complete. Am I doing something wrong in the query, is there a faster way?

Also for the query

&gt; MATCH (u:University {name: $university})&lt;-[DEPARTMENT_IN]-(d:Department) RETURN d

On Graphenedb message saying &quot;This query has been normalized&quot;
I don&#39;t really understand.
Thanks for your answers &#128522;
[Profile of the Query][1]

  [1]: https://i.stack.imgur.com/mD5wR.png",1592377231,https://stackoverflow.com/q/62423186,Emmanuel Sunday,"['graphenedb', 'cypher', 'neo4j']"
62421750,Swapping elements in a list based on their match in a dictionary,"Alright so basically I&#39;m trying to write a function that takes a string and a dictionary that relates every letter in the alphabet to another letter in the alphabet. The function then splits the string into individual letters, swaps them for their pair in the dictionary, then puts it all back together. 
It&#39;s important to note that in my dictionary the input alphabet is the values in the (key,value) pair and I&#39;m trying to swap to the key alphabet. 
```
def substitutor(text,theDict):
    for n in list(text):
        n = [key  for (key, value) in theDict.items() if value == n]
```
What I&#39;ve tried here is to take every letter n in the list of letters &quot;list(text)&quot; and redefine it as the key in my (key,value) pair in the dictionary. 
I know I need to return something but I can&#39;t figure out what. The output ought to be either a list equivalent to list(text) but with the letters swapped or better yet a single string combining that list into one. I&#39;m super new to python so I might be missing something obvious here, would love help. ",1592369836,https://stackoverflow.com/q/62421750,lpanderson,"['python', 'cryptography', 'dictionary', 'cypher', 'alphabet']"
62420626,Filter nodes after receiving total number,"So I have the following query:

    MATCH (n:Mob)
    WITH count(n) as total, collect(n) as nodes
    WITH nodes, total
    UNWIND nodes as node
    WHERE node.order &gt; 8000 AND node.order &lt; 8100
    RETURN node, total

What I&#39;m trying to do is to get to the total number of nodes (with label Mob) as a number then filter the actual returning nodes, so that I have a subset of the total nodes.

This currently gives me the error `Invalid input &#39;H&#39;: expected &#39;i/I&#39;`. Is there anyway to do what I want in one query, or does it need to be split into two?",1592361729,https://stackoverflow.com/q/62420626,A. L,"['neo4j', 'cypher']"
62417785,Finding right path in Cypher Neo4j,"I&#39;m working with Flight Analyzer database (https://neo4j.com/graphgist/flight-analyzer).
We have there few nodes and relationships types.
Nodes: 
Airport
```
(SEA:Airport { name:&#39;SEA&#39; })
```
Flight
```
(f0:Flight { date:&#39;11/30/2015 04:24:12&#39;, duration:218, distance:1721, airline:&#39;19977&#39; })
```
Ticket
```
(t1f0:Ticket { class:&#39;economy&#39;, price:1344.75 })
```

Relationships
Destination
```
(f0)-[:DESTINATION]-&gt;(ORD)
```
Origin
```
(f0)-[:ORIGIN]-&gt;(SEA)
```
Assign
```
(t1f0)-[:ASSIGN]-&gt;(f0)
```

Now I need to find some path and I have problem with that connection ORIGIN - FLIGHT - DESTINATION.
I need to find all airports that are connected to LAX airport with sum of ticket prices &lt; 3000.

I tried
```
MATCH path = (origin:Airport { name:&quot;LAX&quot; })&lt;-[r:ORIGIN|DESTINATION*..5]-&gt;(destination:Airport)
WHERE REDUCE(s = 0, n IN [x IN NODES(path) WHERE &#39;Flight&#39; IN LABELS(x)] |
s + [(n)&lt;-[:ASSIGN]-(ticket) | ticket.price][0]
) &lt; 3000
RETURN path
```

but in this solution LAX can be ORIGIN and DESTINATION too. I only want to chose paths that always have the same order aiport1 &lt;- origin - flight1 - destination -&gt; airport2 &lt;- origin - flight2 - destination -&gt; aiport etc..

I need to include departure and arrive time so
flight1 date + duration &lt; flight2 date then flight2 date + duration &lt; flight3 date etc...",1592342419,https://stackoverflow.com/q/62417785,Paweł Żurkiewicz,"['cypher', 'neo4j']"
62412504,"Cypher: Indexing returnInvalid input &#39;i&#39;: expected whitespace comment, ON, &#39;=&#39;, node labels","This is what I am doing. I really don&#39;t know what I am doing wrong

&gt; CREATE INDEX index_user FOR (n:User) ON (n.id, n.username, n.email)

The Output is

&gt; Invalid input &#39;i&#39;: expected whitespace, comment, ON, &#39;=&#39;, node labels,
&gt; MapLiteral, a parameter, a parameter (old syntax), a relationship
&gt; pattern, &#39;,&#39;, FROM GRAPH, CONSTRUCT, LOAD CSV, START, MATCH, UNWIND,
&gt; MERGE, CREATE UNIQUE, CREATE, SET, DELETE, REMOVE, FOREACH, WITH,
&gt; CALL, RETURN, UNION, &#39;;&#39; or end of input (line 1, column 14 (offset:
&gt; 13)) &quot;CREATE INDEX index_user FOR (n:User)&quot;

",1592322549,https://stackoverflow.com/q/62412504,Emmanuel Sunday,"['neo4j', 'cypher']"
62411140,issue in Cypher query with exclusion,"I&#39;m facing issue with Cypher query exclusion.

i want to exclude Article which are linked to an Article with the propertie TypeArticle &lt;&gt; CA.

I always encounter with wrong Article classified in CA as TypeArticle

But if i do the same thing like i want to find Article linked to Article with the propertie TypeArticle = CA, it works.

The exclusion doesn&#39;t work. 1 and 2 

1

    MATCH (n:Article {TypeArticle: &#39;PF&#39;, ArticleStatut:&#39;20&#39; , ETB:&#39;CLM&#39;})--&gt;(m:Article)
    WHERE m.TypeArticle&lt;&gt;&quot;CA&quot;
    return DISTINCT n

2

    MATCH (n:Article {TypeArticle: &#39;PF&#39;, ArticleStatut:&#39;20&#39; , ETB:&#39;CLM&#39;})--&gt;(m:Article)
    WHERE NOT TypeArticle=&quot;CA&quot;
    return DISTINCT n

**BUT this work**

    MATCH (n:Article {TypeArticle: &#39;PF&#39;, ArticleStatut:&#39;20&#39; , ETB:&#39;CLM&#39;})--&gt;(m:Article)
    WHERE m.TypeArticle=&quot;CA&quot;
    return DISTINCT n

I think i missed something 

Thanks for your help, i need this for an Use case in my company...

Vincent


",1592318406,https://stackoverflow.com/q/62411140,Vincent ,"['neo4j', 'cypher']"
62403192,neo4j: Setting apoc.create.uuid() on the outside causes replacement,"Sorry don&#39;t exactly know what title i should put. Using query below to explain.
 ``` 
        UNWIND $data as data
        MERGE (d:Device {cell_id: data.cell_id})
        ON CREATE SET d+= data
        WITH d
        SET d._uuid = apoc.create.uuid()
        MERGE (g:Device_Group {group_name: $GROUP_NAME})
        WITH g,d
        MERGE (g)-[:GROUPS]-&gt;(d)
 ```
The cell data I receive is updated frequently and sometimes new devices are added. I also want to set a UUID to each corresponding device. As such I use apoc.create.uuid(). However when the device is updated a new uuid is created that replaces the old one. My issue is that I don&#39;t want the UUID to change every time the device is updated. 

Thanks in advance for the help.",1592292657,https://stackoverflow.com/q/62403192,Tarendran Vivekananda,"['cypher', 'neo4j']"
62389717,Optimise Neo4j Query,"````
match (m:Server)-[r]-(n:Middleware)-[r1]-(o:OperatingSystem),
(y:DeploymentUnit{name:n.name+m.name}) merge(y)-[:STRATEGIC_RUNS_ON]-&gt;(o) merge(y)&lt;-[:STRATEGIC_OUT_RUNS_ON]-(o)
````
I was running this query but it took more than one hour to complete.Is there a way I can optimise this query.
Server nodes:10035,
Middleware nodes:2334,
OperatingSystem nodes:43,
DeploymentUnit nodes:5014.

Thanks in advance",1592229337,https://stackoverflow.com/q/62389717,ck22,"['cypher', 'neo4j', 'optimization']"
62388772,neo4j: If statement for deleting nodes based on relationships,"I am trying to delete the nodes that has a relationship to each other node if the relationship exist. If the relationship doesnt exist delete the first node. Example:
I am using UNWIND because that is the data provided by the user.
``` 
UNWIND [{name:&#39;John&#39;}] as rows
IF EXISTS(u:Person)-[r:OWNS]-&gt;(c:Car), THEN
MATCH (u:Person)-[r:OWNS]-&gt;(c:Car)
WHERE u.user_name = rows.name
DETACH DELETE u,c
OTHERWISE
MATCH (u:Person)
WHERE u.user_name = rows.name
DETACH DELETE u
 ```
I tried using apoc.do.when however they dont allow EXISTS(u:User)-[r:OWNS]-&gt;(c:Car) as a conditional statement. ",1592226081,https://stackoverflow.com/q/62388772,Tarendran Vivekananda,"['cypher', 'neo4j']"
62381580,How to remove/delete duplicate nodes from RedisGraph,"Can someone help me on deleting duplicate nodes from the RedisGraph for a particular label. I found cypher queries in Neo4j, but the are not supporting in Redis. Please help me on this.

I used below query, then RedisInsight thrown error


    MATCH (p:Person)
    WITH p.id as id , collect(p) AS nodes 
    WHERE size(nodes) &gt;  1
    RETURN [ n in nodes | n.id ] AS ids, size(nodes)
    ORDER BY size(nodes) DESC

Error: RedisGraph does not currently support list comprehension",1592196924,https://stackoverflow.com/q/62381580,Jagadeesh Urlana,"['cypher', 'redisgraph', 'redis']"
62380890,How to add a given label to given node by using spring data neo4j?,"I use the spring data neo4j @query to add a label to a node, but there are some syntaxes. How can I transfer param correctly?

Such as :

```java
@Query(&quot;MATCH (st) WHERE st.originId = $originId SET st:$label RETURN st&quot;)  
public Node addLabel(String originId, String label);

@Query(&quot;MATCH (st) WHERE st.originId = $originId SET st:label RETURN st&quot;) 
public Node addLabel(String originId, @Param(&quot;label&quot;) String label);

@Query(&quot;MATCH (st) WHERE st.originId = $originId SET st:$1 RETURN st&quot;)
public Node addLabel(String originId, String label);
```

All of the above statements have errors.The compiler told me there was an error in &#39;:&#39;.

So, What&#39;s the correct statements?",1592191775,https://stackoverflow.com/q/62380890,sheep,"['cypher', 'spring-data', 'java', 'neo4j']"
62378907,group by function in neo4j?," ```
MATCH(b:Book)
OPTIONAL MATCH (cu:Customer)-[pu:PURCHASED]-&gt;(:Order)-[]-&gt;(b)
RETURN pu.ISBN,SUM(pu.qty) AS quantity 
```

I want to return the number of copies of each book sold – unsold books should show as 0 sold copies
this query does not return the correct answer, I just want to find a way to make a left join from the book node and then group the result by ISBN number. please help 

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/JlnT2.png",1592173413,https://stackoverflow.com/q/62378907,Fadi,"['cypher', 'group-by', 'neo4j']"
62365265,"Neo.ClientError.Statement.SyntaxError: Invalid input &#39;l&#39;: expected &#39;r/R&#39; or &#39;o/O&#39; (line 1, column 20 (offset: 19))","

When I run following query in 

    CREATE CONSTRAINT Flight_flightId_constraint ON (f:Flight) ASSERT f.flightId IS UNIQUE

I get following error : 

 `Neo.ClientError.Statement.SyntaxError: Invalid input &#39;l&#39;: expected &#39;r/R&#39; or &#39;o/O&#39; (line 1, column 20 (offset: 19)) &quot;CREATE CONSTRAINT Flight_flightId_constraint ON (f:Flight)&quot;` ^

This is from https://guides.neo4j.com/4.0-neo4j-modeling-exercises/04.html exercise. 

I do not understand why I get this syntax error becuase I ran the query as it is in tutorial",1592080535,https://stackoverflow.com/q/62365265,lpt,"['cypher', 'neo4j']"
62364566,Neo4J set new property on Relationship by Relationship ID,"I have a Neo4J Graph and want to add a new Property on the Relationships based on the `ID` of the Relationship, which is already set. The `ID` is a Property and looks like this:

 **id**:16_0beta1_1b500480_1221807483755_439038_8369

In a CSV-File I have stored 400 `IDs` and a `type` corresponding to the `IDs`. Neo4J should load the CSV-File and look through all relationships. When a Relationship `ID` matches an `ID` from the CSV-File it should `set` the new Property like this: `set r.SysML=row.type` and create a new Property on the Relationship:

**SysML**:Block

For the nodes the following clause worked well:

    LOAD CSV WITH HEADERS FROM &quot;file:///SysML.csv&quot; AS row 
    merge(n:name {id:row.sysID}) 
    on match set n.SysML=row.type
For Relationship Property i tried:

    LOAD CSV WITH HEADERS FROM &quot;file:///SysML.csv&quot; AS row 
    merge ()-[r:rel {id:row.sysID}]-&gt;() 
    on match set r.SysML=row.type

I couldn&#39;t solve it even with many variations of the relationship...
",1592075942,https://stackoverflow.com/q/62364566,AlabaSchmallaba,"['neo4j', 'cypher']"
62349169,Using a parameter with apoc.periodic.commit giving OutOfMemoryError,"I&#39;m experiencing some strange behaviour when using apoc.periodic.commit to delete all relationships (around 2million) from a single node, and then follow it up with a call to delete that node:


```
MATCH(node:SomeNodeType) 
WITH ID(node) AS nodeId
CALL apoc.periodic.commit(&quot;MATCH (node:SomeNodeType)-[rel:NodeRel]-&gt;() WHERE ID(node) = $nodeId
WITH rel LIMIT $limit DELETE rel RETURN COUNT(rel)&quot;,
{limit:2000, params: { nodeId: nodeId}})
YIELD updates
MATCH (node:SomeNodeType) WHERE ID(node) = 4 DETACH DELETE node
RETURN updates
```

This results in a Neo.TransientError.General.OutOfMemoryError.
My Neo4j instance is running in Docker, and to force this error with smaller data sizes I gave it 512m of memory using : - JAVA_OPTIONS=-Xmx512m environment variable. Giving it 2Gb instead gives the same result, the above query fails and the following succeeds:


```
CALL apoc.periodic.commit(&quot;MATCH (node:SomeNodeType)-[rel:NodeRel]-&gt;() WHERE ID(node) = 4
WITH rel LIMIT $limit DELETE rel RETURN COUNT(rel)&quot;,
{limit:2000})
YIELD updates
MATCH (node:SomeNodeType) WHERE ID(node) = 4 DETACH DELETE node
RETURN updates
```

The only real difference between the queries is the parameter being input into apoc.periodic.commit to match the SomeNodeType, and I can&#39;t think of a reason why this would cause the query to use so much more memory. Does anybody have any more insight as to what is going on here?

Using Neo4j 4.0.0 docker image with APOC 4.0.0.4

Thanks.

",1591981800,https://stackoverflow.com/q/62349169,Codie Collinge,"['neo4j', 'neo4j-apoc', 'cypher']"
62337140,JRedisGraphCompileTimeException: redis.clients.jedis.exceptions.JedisDataException: errMsg:,"I am creating Cypher query from my java program and passing that raw query to RedishGraph.Query() method. I am getting the following exception:

```
&quot;com.redislabs.redisgraph.exceptions.JRedisGraphCompileTimeException: redis.clients.jedis.exceptions.JedisDataException: errMsg: Invalid input &#39;s&#39;: expected DETACH DELETE, DELETE, DROP INDEX ON or DROP CONSTRAINT ON line: 1, column: 2, offset: 1 errCtx: dsspfnSpouseFname=&quot; errCtxOffset: 1&quot;
```

When I try to execute the same raw query in CLI/Redis Insight, successfully executing without any errors. Can some one help me what exactly this exception refers to.

Using Redis 5.0.6 version, JDK 11 and jredisgraph 2.0.2 version.",1591933456,https://stackoverflow.com/q/62337140,Jagadeesh Urlana,"['cypher', 'java', 'redis', 'redislabs', 'redisgraph']"
62334033,Cypher: Query to check if node is part of top 10 results,"I&#39;m trying to make a cypher query which does the following 

 1. Find the top 10 largest USA organisations (in terms of revenue)
 2. Return &quot;True&quot; if an organisation part of the top 10, if not return &quot;False&quot;

My attempted code looks like this to extract list of top 10 organisations is:

    MATCH (org)
    WHERE org.revenueCurrency = &#39;USD&#39;
    WITH org as topCompany
    ORDER by topCompany.revenue desc LIMIT 10
    RETURN topCompany

however not sure how to return to True or False if a company is in the top 10",1591911692,https://stackoverflow.com/q/62334033,user341383,"['neo4j-apoc', 'cypher-3.1', 'graph-databases', 'neo4j', 'cypher']"
62329669,Find string that doesn&#39;t have prefix in Neo4j,"To check that string has prefix have to use `STARTS WITH`, like:

    MATCH (n:Person) WHERE n.name STARTS WITH &#39;Pet&#39; RETURN
    
But how to check that string doesn&#39;t have prefix?

Tried next examples but no luck:

    MATCH (n:Person) WHERE n.name NOT STARTS WITH &#39;Pet&#39; RETURN
    MATCH (n:Person) WHERE n.name STARTS NOT WITH &#39;Pet&#39; RETURN
    MATCH (n:Person) WHERE n.name NOT (STARTS WITH &#39;Pet&#39;) RETURN
",1591894981,https://stackoverflow.com/q/62329669,cn007b,"['cypher', 'neo4j']"
62326465,Neo4j Bloom is missing nodes for apoc.path.subgraphAll while Neo4j Desktop Browser works as expected,"So when I run the following query against my DB I get 168 nodes returned.

```
MATCH (u:Undefined)
CALL apoc.path.subgraphNodes(u, {}) YIELD node
RETURN node
```

This works as expected in both Neo4j Bloom (1.3.2) and Desktop Browser (1.2.8)

If I run this query, so I can get the relationships as well, then I get 154 nodes returned in Bloom, while Desktop Browser still correctly returns 168 nodes as expected.

```
MATCH (u:Undefined)
CALL apoc.path.subgraphAll(u, {}) YIELD nodes, relationships
RETURN nodes, relationships
```

In my graph 154 of the nodes are tied together in this query, in one big inter-connected clump. There are 3 other small clumps of 3, 3 and 8 nodes, that make up the missing 14 nodes. These are what is being missed in Bloom.

Am I missing something? Is there an issue in Bloom?

Anyone have a better idea on how I can return all nodes and relationships, that start at a given node type/label, in Bloom, if this doesn&#39;t work?",1591884967,https://stackoverflow.com/q/62326465,Stephen Mc Gowan,"['graph-databases', 'neo4j-apoc', 'cypher', 'bloom', 'neo4j']"
62307668,Neo4j: Alternative Filter using list (General Approach),"Im trying to filter based on a list that will be applicable to a general filter as long the list has the properties of the node, its trying to filter for.

    UNWIND [{id:&#39;1002&#39;,name:&#39;Ford&#39;, type:&#39;4-wheel&#39;}] as row
    MATCH (c:Car)
    WHERE c[head(keys(row))]=row[head(keys(row))]
    RETURN c
My problem is that the query filters as OR boolean and not AND boolean. (i.e. the reults return any combination of the property of node). However I just want the node that has all the properties listed.
",1591803981,https://stackoverflow.com/q/62307668,Tarendran Vivekananda,"['neo4j', 'cypher']"
62302669,Cypher: Nested FOREACH build a &quot;real number tree&quot;. Problem is making deeper loops conditional so smaller numbers are higher precision,"I am trying to build a tree of real numbers between 0 and 6000, the precision of the tree is to vary as follows: from 0-100 the tree depth will go on to 3 decimal places i.e. 0 to 99.999, from 100 to 500 will be 2 decimal places, 500 to 1000 just 1 decimal place and from there to 6000, no decimals.  The idea is that I can then use this tree to represent millimetres, litres, kg - whatever property that needs a real number to define it. Then I can describe the property units as a property in the relationship to the real number node rather than having having separate node sets for mm, kg etc (or, worse: length, width, height - all mm) all thousands of nodes)

My problem is that I can&#39;t make the conditional FOREACH loops work. generating nodes down to unit level works a treat. I am not experienced in coding at all and I am probably missing something simple but I have tried a bunch of approaches including generating the unit precision nodes first and then trying to add the higher precision nodes later as well as this attempt to do them all in one shot, which seems neater.


    MERGE (hub:RealNumber {name:&#39;Real Numbers&#39;, mag: &#39;hub&#39;})
    MERGE (zero:RealNumber {name: 0.000, mag: [&#39;eplus3&#39;, &#39;eplus2&#39;,&#39;eplus1&#39;, &#39;eplus0&#39;, &#39;eminus1&#39;, &#39;eminus2&#39;, &#39;eminus3&#39;]})
    WITH hub, range(1000,6000,1000) AS thousands, range(100,900,100) AS hundreds,range(10,90,10) AS tens, range(1,9,1) AS units,
    range(1,9,1) AS tenths
    FOREACH (thousand IN thousands|
    	FOREACH (hundred IN hundreds |
    		FOREACH (ten IN tens |
    			FOREACH (unit IN units |
    				//FOREACH (tenth in tenths |
    
    		MERGE (a1:RealNumber {thousand:thousand, name:toFloat(thousand), mag: &#39;eplus3&#39;})&lt;-[:TENTHS]-(hub) // creates thousand nodes and connects to hub
    
    		MERGE (b1:RealNumber {hundred:hundred, name:toFloat(hundred+a1.name), mag: &#39;eplus2)&#39;})&lt;-[:TENTHS]-(a1) // creates hunded nodes chid to thousands
    		MERGE (b2:RealNumber {hundred:hundred, name:toFloat(hundred), mag: &#39;eplus2&#39;})&lt;-[:TENTHS]-(hub) //creates hundred nodes child to hub
    
    		MERGE (c1:RealNumber {ten:ten, name:toFloat(ten+a1.name), mag: &#39;eplus1&#39;})&lt;-[:TENTHS]-(a1) //creates ten nodes child to thousand &gt;hundreds
    		MERGE (c2:RealNumber {ten:ten, name:toFloat(ten+b1.name), mag: &#39;eplus1&#39;})&lt;-[:TENTHS]-(b1)//creates ten nodes child to hundreds
    		MERGE (c3:RealNumber {ten:ten, name:toFloat(ten+b2.name), mag: &#39;eplus1&#39;})&lt;-[:TENTHS]-(b2)
    		MERGE (c4:RealNumber {ten:ten, name:toFloat(ten), mag: &#39;eplus1&#39;})-[:TENTHS]-(hub) //creates ten nodes child to hub 
    
    		MERGE (d1:RealNumber {unit:unit, name:toFloat(unit+a1.name), mag: &#39;eplus0&#39;})&lt;-[:TENTHS]-(a1)
    		MERGE (d2:RealNumber {unit:unit, name:toFloat(unit+b1.name), mag: &#39;eplus0&#39;})&lt;-[:TENTHS]-(b1)
    		MERGE (d3:RealNumber {unit:unit, name:toFloat(unit+b2.name), mag: &#39;eplus0&#39;})&lt;-[:TENTHS]-(b2)
    		MERGE (d4:RealNumber {unit:unit, name:toFloat(unit+c1.name), mag: &#39;eplus0&#39;})&lt;-[:TENTHS]-(c1)
    		MERGE (d5:RealNumber {unit:unit, name:toFloat(unit+c2.name), mag: &#39;eplus0&#39;})&lt;-[:TENTHS]-(c2)
    		MERGE (d6:RealNumber {unit:unit, name:toFloat(unit+c3.name), mag: &#39;eplus0&#39;})&lt;-[:TENTHS]-(c3)
    		MERGE (d7:RealNumber {unit:unit, name:toFloat(unit+c4.name), mag: &#39;eplus0&#39;})&lt;-[:TENTHS]-(c4)
    		MERGE (d8:RealNumber {unit:unit, name:toFloat(unit), mag: &#39;eplus0&#39;})&lt;-[:TENTHS]-(hub)	
    
    		FOREACH (tenth IN tenths IN CASE WHEN a1.thousand&lt;1001 THEN [1] ELSE [] END |
    
    		MERGE (e1:RealNumber {tenth:tenth, name:toFloat(tenth)*0.1+a1.name, mag: &#39;eminus1&#39;})&lt;-[:TENTHS]-(a1) //WHERE e1.name&lt;500
    		MERGE (e2:RealNumber {tenth:tenth, name:toFloat(tenth)*0.1+b1.name, mag: &#39;eminus1&#39;})&lt;-[:TENTHS]-(b1)
    		MERGE (e3:RealNumber {tenth:tenth, name:toFloat(tenth)*0.1+b2.name, mag: &#39;eminus1&#39;})&lt;-[:TENTHS]-(b2)
    		MERGE (e4:RealNumber {tenth:tenth, name:toFloat(tenth)*0.1+c1.name, mag: &#39;eminus1&#39;})&lt;-[:TENTHS]-(c1)
    		MERGE (e5:RealNumber {tenth:tenth, name:toFloat(tenth)*0.1+c2.name, mag: &#39;eminus1&#39;})&lt;-[:TENTHS]-(c2)
    		MERGE (e6:RealNumber {tenth:tenth, name:toFloat(tenth)*0.1+c3.name, mag: &#39;eminus1&#39;})&lt;-[:TENTHS]-(c3)
    		MERGE (e7:RealNumber {tenth:tenth, name:toFloat(tenth)*0.1+c4.name, mag: &#39;eminus1&#39;})&lt;-[:TENTHS]-(c4)
    		MERGE (e8:RealNumber {tenth:tenth, name:toFloat(tenth)*0.1, mag: &#39;eminus1&#39;})&lt;-[:TENTHS]-(hub)	
    
    		)))))

On a related subject - will find efficiency be improved if I link the nodes along &quot;NEXT_THOUSAND&quot;, &quot;NEXT_HUNDRED&quot; lines or just simply sort them all and use a &quot;NEXT&quot; through the lot?

Many thanks!
",1591789159,https://stackoverflow.com/q/62302669,RDSE,"['cypher', 'neo4j']"
62293925,How do I remove objects containing NULL from a COLLECT() clause in a CYPHER query?,"I&#39;ve run into the following issue with this **Cypher** query. The overall results are returned in an array of objects, as intended. However, the `collect()` clause is giving me some trouble.

If `user` has no `myFriends` and  no `theirFriends`, an empty array should be returned. Otherwise, if `myFriends` and/or `theirFriends` has values, it should be a single array of objects of the combined friends, with the id property of the respective friend.


**Query:**
```
MATCH (user:User)
WHERE user.id IN [&#39;1&#39;, &#39;2&#39;, &#39;3&#39;]
OPTIONAL MATCH (user)-[:HAS_FRIEND]-&gt;(myFriends:User)
OPTIONAL MATCH (user)&lt;-[:HAS_FRIEND]-(theirFriends:User)
OPTIONAL MATCH (user)-[:HAS_TEACHER]-&gt;(myTeachers:User)
RETURN {
  name: user.name,
  friends: collect({id: myFriends.id}) + collect({id: theirFriends.id}),
  teachers: collect({id: myTeachers.id})
}
```
**Results in:**
```
[
  {
    name: &#39;Joe&#39;,
    friends: [{id: null}, {id: null}],
    teachers: [{id: null}]
  }, ...
]
```
**Desired result:**
```
[
  {
    name: &#39;Joe&#39;,
    friends: [],
    teachers: []
  }, {
    name: &#39;Jen&#39;,
    friends: [{id: &#39;4&#39;}, {id: &#39;6&#39;}, {id: &#39;7&#39;}],
    teachers: [{id: &#39;8&#39;}, {id: &#39;9&#39;}]
  }
]
```",1591748391,https://stackoverflow.com/q/62293925,P.S.,"['cypher', 'neo4j']"
62291212,In Neo4j how can I create relationships between one node an a collection of other nodes?,"I have a graph containing some nodes with `:SubSystem` labels. I want to add a new node with a `:Document` label and create relationships with each of the existing `:SubSystem` nodes.

When I execute this statement:
```
MATCH (s:SubSystem)
CREATE (d:Document {title:&#39;New Document&#39;})
CREATE (d)-[:DEPICTS]-&gt;(s);
```
I was surprised when Neo4j created a new `:Document` node for each `:SubSystem`. I have 12 sub-systems, so I ended up with 12 new documents each related to one sub-system. I would have expected this behavior had I written:
```
MATCH (s:SubSystem)
CREATE (:Document {title:&#39;New Document&#39;})-[:DEPICTS]-&gt;(s);
```
But I was expecting that separating the `CREATE` clauses would create 1 document then create relationships between that document and each of the sub-systems.

Can someone explain why this doesn&#39;t work as I was expecting.

EDIT:

I found a solution. This statement does what I wanted, but I still think my original attempt should have worked.
```
CREATE (d:Document {title:&#39;New Document&#39;})
WITH d MATCH (s:SubSystem) CREATE (d)-[:DEPICTS]-&gt;(s);
```",1591734087,https://stackoverflow.com/q/62291212,bikeman868,"['cypher', 'neo4j']"
62286509,Neo4j: Matching nodes in FOREACH,"I&#39;m trying to merge my assembly to several components using the code below
``` 
UNWIND $data as row
MERGE (a:Assembly)
ON CREATE SET a+= row
WITH a
UNWIND $components as components
FOREACH(id IN components.uuid | MATCH (c:Component {_uuid: id})
MERGE (a)-[:RECIPE]-&gt;(c))
``` 
However I get an error that doesnt allow match in FOREACH. If I just use merge then I will be creating  new component nodes and not match them to the components that i already have. I am looking for a query that can help me solve this task

Disclaimer: I see a simalar question in overflow but i dont quite understand the answer given as such I put my own problem.",1591717593,https://stackoverflow.com/q/62286509,Tarendran Vivekananda,"['neo4j', 'cypher']"
62286487,Cypher match path with intermediate nodes,"I have the following graph with `Stop` (red) and `Connection` (green) nodes.

[![enter image description here][1]][1]

I want to find the shortest path from `A` to `C` using a cost property on `Connection`.

I would like to avoid making `Connection` a relationship because than I loose the `CONTAINS` relationship of `Foo`.

I can match a single hop like this
```
MATCH p=(:Stop {name:&#39;A&#39;})&lt;-[:BEGINS_AT]-(:Connection)-[:ENDS_AT]-&gt;(:Stop {name:&#39;B&#39;}) RETURN p
```

but this does not work with an arbitrary number of `Connection`s like it would with relationships and `[*]`.

I also tried to make a projection down to simple relationships but it seems like I cannot do something with this without GDS.
```
MATCH (s1:Stop)&lt;-[:BEGINS_AT]-(c:Connection)-[:ENDS_AT]-&gt;(s2:Stop) RETURN id(s1) AS source, id(s2) AS target, c.cost AS cost
```

Note that the connection is unidirectional, so it must not be possible to go from `C` to `A`.

Is there a way to do this without any Neo4j plugins?

  [1]: https://i.stack.imgur.com/jquFf.png",1591717553,https://stackoverflow.com/q/62286487,Erik Hofer,"['neo4j', 'shortest-path', 'cypher']"
62285554,Get sequence of common Nodes in two Neo4j Paths,"Let&#39;s have for example the following travel routes in Neo4j:

**Tom**:  New York --&gt; Moskow --&gt; Berlin --&gt; Paris --&gt; Mumbay --&gt; Kairo --&gt; Rio --&gt; Amsterdam --&gt; Nashville

**Mary**: Madrid --&gt; New York --&gt; Moskow --&gt; Berlin --&gt; Mumbay --&gt; Kairo --&gt; New York --&gt; Nashville --&gt; Toronto

**Bob**:  New York --&gt; Nashville --&gt; Amsterdam --&gt; Rio --&gt; Kairo --&gt; Mumbay --&gt; Paris --&gt; Berlin --&gt; Moscow

Now I need to get the travel route that is most similar to Tom&#39;s route. Similarity means, the number of **common cities** that are visited in the **same sequence**, while skipping cities in between is allowed.

Expected result:

Common route of **Tom and Mary**: New York -&gt; Moskow -&gt; Berlin -&gt; Mumbay -&gt; Kairo -&gt; Nashville =&gt; **Similarity = 6**

Common route of **Tom and Bob**: New York -&gt; Nashville (also New York -&gt; Amsterdam and other paths) =&gt; **Similarity = 2**

Note: Even Tom and Bob have 9 common cities, but they are not in the same sequence, this is not counting for similarity!

Is it possible with Neo4j to get this kind of similarity?

I would be able to read all the paths and then compare them outside of Neo4j. But better would be to do this with Neo4j, because it will be more elegant and probably faster.

---

Added:

My current algorithm is a similarity matrix, where I have one path on the x-axis and another on the y-axis. Every match between x and y causes an increment of all values that are on right side **and** below the match. I other words, every value in the matrix represents the count of the common path before the cell.

Condition to increment a value is that the value is not already greater. This may happen if there are several common paths, in this case the longest path must win.

Two examples of matrix of above examples:
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/DYyPu.jpg
Full Java code:

    public static int getLongestCommonWordsInSequence(List&lt;String&gt; yList, List&lt;String&gt; xList) {
        // right = X, left = Y
        // Need dimension +1, because matches-count is incremented not on match point, but on next indexes
        int[][] matrix = new int[xList.size() + 1][yList.size() + 1];

        // Iterate y
        for (int y = 0; y &lt; yList.size(); y++) {
            // Iterate x
            for (int x = 0; x &lt; xList.size(); x++) {
                // Check if y = x
                if (yList.get(y).equals(xList.get(x))) {
                    // Increment the count
                    int newCount = matrix[x][y] + 1;
                    // Update all counts that are on right side AND below the current match
                    for (int _x = x + 1; _x &lt;= xList.size(); _x++) {
                        for (int _y = y + 1; _y &lt;= yList.size(); _y++) {
                            // Update only if value is &lt; newCount
                            if (matrix[_x][_y] &lt; newCount) {
                                matrix[_x][_y] = newCount;
                            }
                        }
                    }
                }
            }
        }

        return matrix[matrix.length - 1][matrix[matrix.length - 1].length - 1];
    }

---
Added

This is my Java code I would use to create the data of a single journey. This is only experimental. I will extend it or create any other structure if it is of advantage.

    Node journeyNode = graphDb.createNode(Label.label(&quot;Journey&quot;));
    for (Destination destination : journey.destinations) {
        Node destinationNode = graphDb.createNode(Label.label(&quot;Destination&quot;));
        destinationNode.setProperty(&quot;name&quot;, destination.name);
        journey.createRelationshipTo(destinationNode, RelationshipType.withName(&quot;Destination&quot;));
    }",1591714776,https://stackoverflow.com/q/62285554,Alexej Detert,"['neo4j', 'cypher']"
62284055,Neo4J Cypher Query find path with nodes that must be in it,"Is there a dynamic way to define a cypher query that finds a path with certain nodes in it?

For Example

I want to find a path containing &quot;A&quot;, &quot;C&quot; and &quot;G&quot; in exactly this order, where &quot;A&quot; has to be the first node and &quot;G&quot; the last.
But between these nodes any number of nodes and type of relations can exist.
So, the path &quot;A&quot;-[r]-&gt;B-[r]-&gt;&quot;C&quot;-[r]-&gt;D-[r]-&gt;E-[r]-&gt;F-[r]-&gt;&quot;G&quot; would be a valid path.

Is there a way to write this query so that I don&#39;t have to explicitly mention all these nodes?
I don&#39;t want to write something like &quot;A&quot;-[r*1..00]-&gt;&quot;C&quot;-[r*1..100]-&gt;&quot;G&quot;, but, for example, provide a list containing (&quot;A&quot;, &quot;C&quot;, &quot;G&quot;).

Thanks for your help!",1591710070,https://stackoverflow.com/q/62284055,powerweb,"['neo4j', 'cypher']"
62281394,Neo4j: Cypher for filtering based on list of properties,"I have to write a cypher query that can filter a node based on its properties that comes from a list shown in code below.

```
UNWIND [{a_id:&#39;1001&#39;, c_id:&#39;1001&#39;}] as row
match (a:Assembly)-[:RECIPE]-&gt;(c:Component)
where a.id = row.a_id and c.id = row.c_id and c.name = c_name and c.manu = c_manu
return c
```
My problem is that this codes assumes that in the list I will have all the properties sent to me and will return empty if all properties arent in the list. However the user can filter for one or any combination of the properties from the components (except for a_id &#39;This will always be in the list&#39;). I dont know how to query, to ignore those that are not in the list. ",1591701556,https://stackoverflow.com/q/62281394,Tarendran Vivekananda,"['cypher', 'filter', 'neo4j']"
62279219,Filter all nodes in returned path for criteria,"I want to get all nodes connecting `start` with `end` via `EDGE`. However, of those I only want to know the nodes that have the label `END` or that are part of a subgraph where a `CERTAIN_EDGE` is involved.

The below query returns way to many nodes and the result does not make sense as it is the same number for each count.


    MATCH p = (start)-[:EDGE*0..]-&gt;
              (between)-&gt;[:EDGE*0..]-&gt;
              (end:END)
    WHERE id(start) = {start_id} AND
            (between)-[:OTHER_EDGE*]-&gt;()-[:CERTAIN_EDGE]-&gt;()
    RETURN start, between, end

Intuitively I would apply a `FOREACH` in the return only collecting the nodes I am interested in, but it seems that `FOREACH` [cannot collect][1] stuff.


  [1]: https://neo4j.com/docs/cypher-manual/current/clauses/foreach/",1591694700,https://stackoverflow.com/q/62279219,Sim,"['cypher', 'neo4j']"
62265484,Cypher - Input to subquery without fabric?,"Based on this [documentation](https://neo4j.com/docs/cypher-manual/current/clauses/call-subquery/index.html#subquery-correlated-importing), one way to make a variable visible within a subquery is using `WITH` keyword:

```
UNWIND [&#39;Hotels&#39;, &#39;Hostels&#39;] as cat_name
CALL {
    WITH cat_name
    MATCH (:Category {category_id: cat_name})&lt;-[:IN_CATEGORY]-(:Business)&lt;-[:REVIEWS]-(:Review)&lt;-[:WROTE]-(u:User)
    RETURN DISTINCT cat_name, u.name AS name, u.pageRank20 AS pageRank20
    ORDER BY u.pageRank20 DESC
    LIMIT 10
}
RETURN cat_name, name, pageRank20
```

...got `Neo.ClientError.Statement.SyntaxError`: `Importing variables into subqueries is not available in this implementation of Cypher due to lack of support for correlated subqueries.`

Enabling [Fabric](https://neo4j.com/docs/operations-manual/current/fabric/introduction/) feature is an overkill here. (I don&#39;t want to get **Data Federation** involved for a simple dataset)

One workaround is to use `UNION` ([link](https://neo4j.com/docs/cypher-manual/current/clauses/union/)). However, if having too many, e.g. cat_name, copying &amp; pasting a lot for `UNION` doesn&#39;t look good (although it is do-able).

**Question**: Is there any other way to fulfil the intention of the query above (input a variable into subqueries), without leveraging `fabric` and `UNION`?

Environment: Neo4j Desktop v4.0.4, Windows 8.1 x64.",1591629795,https://stackoverflow.com/q/62265484,JoyfulPanda,"['cypher', 'neo4j']"
62258528,Redis requests done in 1 to 3 ms taking 300ms,"i&#39;m currently using a **Graph Database** using **Redis** for a **Julia** project.

Sometimes **Redis** requests are taking 300 ms to execute and i don&#39;t understand why.
I run a simple request 10.000 times (the code of the request is below) and it took me :

    using Redis, BenchmarkTools
    
    conn = RedisConnection(port=6382) Redis.execute_command(conn,[&quot;FLUSHDB&quot;])
    
    q = string(&quot;CREATE (:Type {nature :&#39;Test&#39;,val:&#39;test&#39;})&quot;) BenchmarkTools.DEFAULT_PARAMETERS.seconds = 1000 BenchmarkTools.DEFAULT_PARAMETERS.samples = 10000
    
    stats = @benchmark Redis.execute_command(conn,[ &quot;GRAPH.QUERY&quot;, &quot;GraphDetection&quot;, q])

And got this results :

BenchmarkTools.Trial: memory estimate: 3.09 KiB allocs estimate: 68

minimum time: 1.114 ms (0.00% GC)

median time: 1.249 ms (0.00% GC)

mean time: 18.623 ms (0.00% GC)

maximum time: 303.269 ms (0.00% GC)

samples: 10000 evals/sample: 1

The Huge difference between median time and mean time came from the problem i&#39;m talking about (the request take either [1-3] ms or [300-310] ms )
",1591606939,https://stackoverflow.com/q/62258528,Aubin MOREAU,"['julia', 'cypher', 'graph-databases', 'redis']"
62254871,Neo4j: Get Min/Max of multiple node/relationship properties,"How is it possible to find the min/max of multiple node/relationship properties?

I prepared the following graph: https://console.neo4j.org/r/3ehhme.


Its basically (U:User)-[i:invests]-&gt;(P:Project). 

1) i has the property: amount:1000

2) U has the property: availableAmount:500

I need the smaller value of 1) property of i and 2) property of U",1591589382,https://stackoverflow.com/q/62254871,Peter,"['cypher', 'neo4j']"
62253530,Cypher/Neo4j Query To Get Info Of Currect Node and Others Related With That,"


I have a social media scenario as seen in image([Case 1][1]) and wanted to create newsfeed for a user which will include **posts** of the nodes he is **following** and also his own posts.
and for that I was using this cypher query :

    MATCH (:User{id: &quot;MThIs8ibezSjylKBxux7qdusDyu1&quot;})-[:FOLLOWS]-&gt;(b) WITH b.id
    as uids 
    MATCH (u:User) -[:POSTED]-&gt; (p:Post) 
    WHERE  u.id in uids 
    OR u.id in [&quot;MThIs8ibezSjylKBxux7qdusDyu1&quot;] 
    RETURN p.caption , p.timeStamp ,p.linksArray , p.postId ORDER BY p.timeStamp DESC
   
this works perfectly fine unless a scenario occurs where the **current node** does not **follow** anyone [Case 2][2].

Now Logically it should return the posts of the current node too but that&#39;s not the case.If the user is following someone it returns posts from both of them but if the user is following no one it returns nothing.
As I&#39;m new to neo4j I would really appreciate your help. 


  [1]: https://i.stack.imgur.com/yKFAn.png
  [2]: https://i.stack.imgur.com/9ct3o.png",1591577797,https://stackoverflow.com/q/62253530,Usama Ahmed,"['neo4j', 'cypher']"
62240051,Join two matches in Neo4J,"Im new in neo4j and I need help I have the following problem:

I have a little database that describes the reviews of a movie.

Basically, the nodes are set like this:

    (Critic)-[review]-&gt;(Movie)

The review relation has an attribute called stars which describe the stars given by the critic to the movie.

An example is this.

    (Jon)-[review{stars:4}]-&gt;(Titanic)
    (Jon)-[review{stars:3}]-&gt;(Avatar)
    (Alf)-[review{stars:4}]-&gt;(Avatar)

I have an excersice that Ive been asked to get all the critics name that have given 4 star in their reviews but never gave an 3.

The answer in this case must be Alf

First I have a match for the critic that gave 4 stars (Jon,Alf) and then I get  a match for the critics that gave 3 (Jon). Now I want to inner join them to only get Alf. How I can do this? This is what ive got so far:

 

    MATCH (N:Critic)-[r:REVIEWS]-&gt;() 
    WHERE r.Stars=4 with distinct n.Name as names4
    MATCH (m:Critic)-[s:REVIEWS]-&gt;() 
    WHERE s.Stars=3 with distinct m.Name as names3, names4 as names4
    RETURN distinct [n IN names4 WHERE NOT n IN names3 ] as listC

As you se I have the two matches but I dont know how to make the inner join

",1591495195,https://stackoverflow.com/q/62240051,Juan Andr&#233;s D&#225;vila,"['group-by', 'neo4j', 'inner-join', 'cypher']"
62235952,Cypher - How to call a procedure multiple times in loop?,"In Neo4j Browser, I tried to call a procedure multiple times in a loop, but Neo4j reported the same error: **Query cannot conclude with CALL (must be RETURN or an update clause)**. Specifically,

+ With `UNWIND` ([documentation](https://neo4j.com/docs/cypher-manual/current/clauses/unwind/)):

```
UNWIND [10, 20] AS age_num
MATCH (n:User {name: &#39;a&#39;, age: age_num})
CALL apoc.nodes.delete(n)
```

...got `Neo.ClientError.Statement.SyntaxError`:

```
Query cannot conclude with CALL (must be RETURN or an update clause) (line 3, column 1 (offset: 68))
&quot;CALL apoc.nodes.delete(n)&quot;
 ^
```

+ With `apoc.periodic.iterate()` ([documentation](https://neo4j.com/docs/labs/apoc/current/graph-updates/periodic-execution/)):

```
CALL apoc.periodic.iterate(
    &quot;UNWIND [10, 20] AS age_num MATCH (n:User {name: &#39;a&#39;, age: age_num}) RETURN n&quot;,
    &quot;CALL apoc.nodes.delete(n)&quot;,
    {batchMode: &#39;SINGLE&#39;, parallel: false}
)
```

...got `errorMessages`:

```
{
  &quot;Query cannot conclude with CALL (must be RETURN or an update clause) (line 1, column 15 (offset: 14))\r\n\&quot; WITH $n AS n CALL apoc.nodes.delete(n)\&quot;\r\n               ^&quot;: 1
}
```

The procedure `apoc.nodes.delete()` here is just an example. Please don&#39;t advise me on using `DETACH DELETE` instead.

**Question**: In Cypher, how is it supposed to call a procedure multiple times in a loop, each time might have a different parameter, e.g. a different property value?

Environment: Neo4j Desktop v4.0.4, Windows 8.1 x64.",1591466897,https://stackoverflow.com/q/62235952,JoyfulPanda,"['neo4j-apoc', 'cypher', 'loops', 'neo4j']"
62228293,Relations in Neo4j,"Hi Im new to neo4j and I have a little database that describes the reviews of a movie.

Basically, the nodes are set like this:

    (Critic)-[review]-&gt;(Movie)

The review relation has an attribute called stars which describe the stars given by the critic to the movie.

An example is this.

    (Jon)-[review{stars:4}]-&gt;(Titanic)
    (Jon)-[review{stars:3}]-&gt;(Avatar)
    (Alf)-[review{stars:4}]-&gt;(Avatar)

I have an excersice that Ive been asked to get all the critics that have given 4 star in their reviews but never gave an 3.

The answer in this case must be Alf

Any idea of how I can make the MATCH in cypher?

Thanks a lot



",1591425872,https://stackoverflow.com/q/62228293,Juan Andr&#233;s D&#225;vila,"['nodes', 'grouping', 'relation', 'cypher', 'neo4j']"
62221331,Post-Calculations on Aggregations,"I&#39;m new to Neo4j and I feel stucked in simple operations that I would solve in regular SQL using subqueries. 

How can I subtract the two resulting rows? I have grouped the results and I would like to return the difference between them: 

    MATCH (seguidores:RelevantTwitterUser {location:&quot;Madrid&quot;})-[:FOLLOWS]-&gt;(seguidos:RelevantTwitterUser {location:&quot;Barcelona&quot;}) 
    WITH COLLECT({origen:seguidores.location, user:seguidores.userId}) AS ROWS
    MATCH (seguidores:RelevantTwitterUser {location:&quot;Barcelona&quot;})-[:FOLLOWS]-&gt;(seguidos:RelevantTwitterUser {location:&quot;Madrid&quot;}) 
    WITH ROWS + COLLECT({origen:seguidores.location, user:seguidores.userId}) AS allRows
    UNWIND allRows AS ROW
    RETURN ROW.origen, COUNT(ROW.user)

with the output: 

[![output example][1]][1]


  [1]: https://i.stack.imgur.com/B7Wzq.png
",1591379197,https://stackoverflow.com/q/62221331,marc-cejalvo,"['cypher', 'neo4j']"
62220884,neo4j find parent node is relationship exists,"I am trying to develop a product like a google drive. This is the second phase now. I am stuck in making cypher query and I need help.

a user A can share a file/folder with a group or another user B.

case 1: user A, shared the folder which consists of other subfolders. user B would see the shared folder. however, now user A shared a subfolder, and again user B should see only the root folder.

case 2: user A, shared the only subfolder then, user B will only see a shared subfolder

basically I need to traverse the node from bottom to its parent and their parent with CAN_ACCESS_DIR relationship if any and stop at the first node with this relationship

please help

attached [![enter image description here][1]][1]image scenario -&gt; 
find the root (JAVA) of JAVA2 and check if it has been shared (CAN_ACCESS_DIR) with the same group or a user. If yes, then we will send only the JAVA folder. If not then send only JAVA2 folder

``` queries tried
match (g:group) where g.name = &quot;group1&quot; 
match p = (d:directory { name: &quot;JAVA2&quot;})&lt;-[:LEAF | CONTAINS*0..]-(a:directory) where (d)&lt;-[:CAN_ACCESS_DIR]-(g)
unwind nodes(p) as i
return collect(distinct(i)) as result

match (u:user) where u.name = &quot;John&quot;
match (t:tower) where t.name = &quot;Genome&quot;
match (d:directory) where d.name = &quot;Root&quot;
match (u)-[:MEMBER_OF_GROUP]-&gt;(g:group)
match (d)-[:CONTAINS*0..]-&gt;(s) where (s)&lt;-[:CAN_ACCESS_DIR]-(g)&lt;-[:MEMBER_OF_GROUP]-(u)
```
not an expert in neo4j, please guide me out. thanks 


  [1]: https://i.stack.imgur.com/1eiHt.png",1591377649,https://stackoverflow.com/q/62220884,Meet Singh,"['neo4j', 'cypher']"
62205421,Neo4j query to return parent hierarchy,"I have this type of graph on a Neo4J DB:

    (Child)-[has_parent]-&gt;(Parent)-[has_parent]-&gt;(Parent)-[has_parent]-&gt;(Parent)

I have a java application using spring data to connect to Neo4J and I am trying to get a query to return Child node with full parent hierarchy.

I have @NodeEntity classes for both Child and Parent, and they are related using a @RelationshipEntity class.

Using query:

    @Query(&quot;MATCH(c:Child-[r:has_parent]-&gt;(p:Parent) return c,r,p&quot;)

Return the Child with first parent only. I have tried using @Depth annotation with values &gt;2, but it does not work.

What query do I need to get full hierarchy in this case?",1591310978,https://stackoverflow.com/q/62205421,user2327866,"['neo4j', 'cypher', 'spring-data']"
62200652,Neo4j duplicating nodes in MERGE call in Node.js code,"I&#39;m having an issue where Neo4j is duplicating nodes from a set of Merge calls. here is the cypher I am using: 

        MERGE (b:TRIGGER {name: $rname})
        MERGE (c:FIELD {name: $target})
        MERGE (b)-[:MODIFIES]-&gt;(c)
        RETURN b, c

This cypher is being sent from a function in node.js as it loops through an array of possible relationships. 

Here is the full function: 

&lt;!-- begin snippet: js hide: false console: true babel: false --&gt;

&lt;!-- language: lang-js --&gt;

    async function addTarget(rname, target, neouser, neopass,bolturi) {
      // console.log(&quot;Adding Target&quot;);
      const driver = neo4j.driver(
        // &quot;bolt://localhost&quot;,
        bolturi,
        neo4j.auth.basic(neouser, neopass)
      );
      const session = driver.session();

      try {
        await session.writeTransaction(async txc =&gt; {
          var result = await txc.run(
            `MERGE (b:TRIGGER {name: $rname})
             MERGE (c:FIELD {name: $target})
             MERGE (b)-[:MODIFIES]-&gt;(c)
             RETURN b, c`, {
              rname: rname,
              target: target
            }
          )

          result.records.map(record =&gt; {
            // console.log(`b: ${record.get(&#39;b&#39;)}, c: ${record.get(&#39;c&#39;)}`);
          })
        })
      } finally {
        // console.log(&quot;finally&quot;);
        await session.close();
        await driver.close();
      }
    }

&lt;!-- end snippet --&gt;

&lt;!-- begin snippet: js hide: false console: true babel: false --&gt;

&lt;!-- language: lang-js --&gt;

    async function addTrigger(rname, trigger, neouser, neopass, bolturi) {
      // console.log(&quot;adding trigger&quot;);
      const driver = neo4j.driver(
        // &quot;bolt://localhost&quot;,
        bolturi,
        neo4j.auth.basic(neouser, neopass)
      );
      const session = driver.session();

      try {
        await session.writeTransaction(async txc =&gt; {
          var result = await txc.run(
            `MERGE (b:TRIGGER {name: $rname})
             MERGE (c:FIELD {name: $trigger})
             MERGE (b)&lt;-[:ACTIVATES]-(c)
             RETURN b, c`, {
              rname: rname,
              trigger: trigger
            }
          )
          result.records.map(record =&gt; {
            // console.log(`b: ${record.get(&#39;b&#39;)}, c: ${record.get(&#39;c&#39;)}`);
          })
        })
      } finally {
        // console.log(&quot;finally&quot;);
        await session.close();
        await driver.close();
      }
    }

&lt;!-- end snippet --&gt;

And here is the loop I am calling it from. 

&lt;!-- begin snippet: js hide: false console: true babel: false --&gt;

&lt;!-- language: lang-js --&gt;

              var objRules = ruleList;
              for (var i = 0; i &lt; objRules.length; i++) {
                var rname = objRules[i].triggername;
                var trigger = objRules[i].trigger;
                addTrigger(rname, trigger, neouser, neopass, bolturi)
                for (var j = 0; j &lt; objRules[i].targets.length; j++) {
                  var target = objRules[i].targets[j];
                  addTarget(rname, target, neouser, neopass, bolturi)
                }
              }

&lt;!-- end snippet --&gt;

I know I am using Merge correctly, because every time I have used this before it worked perfectly. I am binding the variables to a node first, using Merge, and then using Merge for the relationship. This should create a unique node for each Field ID or Trigger only if it does not already exist and then use those nodes in the relationship Merge. 

Thank you for any help or ideas. 
 

The two differences I see now is that I am using the latest version of Neo4j 4 and Node.js. 

edit: Fixed question. I accidentally put Match in the question when it is Merge. The code was correct. 
edit 2: added addTrigger function
",1591291612,https://stackoverflow.com/q/62200652,mfontaine,"['cypher', 'node.js', 'javascript', 'neo4j']"
62189468,Is there an ampersand (&amp;) analogue to the pipe (|)?,"In the Cypher query `match (a)-[:X|Y]-(b) return a, b` we match all the a, b pairs that are either X-related or Y-related. What if we want to find all the a, b pairs that are _both_ X-related and Y-related?

Neither `match (a)-[:X&amp;Y]-(b) return a, b` nor `match (a)-[:X&amp;&amp;Y]-(b) return a, b` seems to work. Is the only way to do it using a statement like this?
```
match (a)-[X]-(b)
where (a)-[Y]-(b)
return a, b
```

*EDIT*: For some reason I said the above statement included a `with` clause. I&#39;ve removed that now.",1591257052,https://stackoverflow.com/q/62189468,Dan Saattrup Nielsen,"['neo4j', 'cypher']"
62186539,Java client Cypher query with RedisGraph redis.clients.jedis.exceptions.JedisDataException: errMsg: Invalid input &#39;p&#39;: expected PROFILE line: 1," Using RedishGraph from Redis Labs in Java project. Getting below error when I pass Map Properties as input to Cypher query.

```
 ObjectMapper oMapper = new ObjectMapper();
 Person person=new Person(2, &quot;Jagadeesh&quot;, 23);
 Map&lt;String, Object&gt; personMap = oMapper.convertValue(person, Map.class);

 Map&lt;String, Object&gt; props=new HashMap&lt;&gt;();
 props.put(&quot;props&quot;, personMap);

 ResultSet rs1 = graph.query(&quot;UserGraph&quot;, &quot;CREATE ($props)&quot;, props);
```

There was an unexpected error (type=Internal Server Error, status=500).
redis.clients.jedis.exceptions.JedisDataException: errMsg: Invalid input &#39;p&#39;: expected PROFILE line: 1, column: 4, offset: 3 errCtx: props={id=2, name=Jagadeesh, age=23} CREATE ($props) errCtxOffset: 3",1591242246,https://stackoverflow.com/q/62186539,Jagadeesh Urlana,"['redis', 'cypher', 'java', 'redisgraph']"
62185075,Neo4j - Graph Data Science library - How to cypher-query against a named graph in Graph Catalog?,"Creating a named graph from the main Neo4j Graph is [documented](https://neo4j.com/docs/graph-data-science/current/management-ops/graph-catalog-ops/#catalog-graph-create). Beside, one also knows how to list, drop, check if a named graph already exists, e.g. `CALL gds.graph.exists(&#39;my-store-graph&#39;) YIELD exists;`

However, I wonder if there is any method for *cypher-query against the just created named graph*?

One workaround is to push this named graph into an *offline/empty* Neo4j Graph, i.e. `CALL gds.beta.graph.export(&#39;my-graph&#39;, { dbName: &#39;mydatabase&#39; })`. However, this method is less convenient because we often want to check if the named graph is projected correcly before applying, e.g. PageRank on it. And the projection can be a trial-and-error cycle.",1591231853,https://stackoverflow.com/q/62185075,JoyfulPanda,"['neo4j', 'graph-databases', 'cypher', 'graph-data-science']"
62184214,Is there a Way to get Neo4j APOC connection strings to accept spaces or \ characters?,"I&#39;m working on attempting to pull process data from OSI PI JDBC into my knowledge graph in Neo4j with the APOC library. Having trouble getting the authentication setup:

With the following CYPHER query I get the error Illegal character in path at index 48 (space between Integrated Security)

    CALL apoc.load.jdbc(&quot;jdbc:pioledbent://[server]/DataSource=[server];Integrated Security=SSPI;&quot;,&quot;[AF Database].Asset.Element&quot;)
    YIELD row
    RETURN row.Name;

With this CYPHER query I am able get the JDBC driver to prompt for authentication but it always fails saying Invalid Credentials. Username must be non-empty.

    CALL apoc.load.jdbc(&quot;jdbc:pioledbent://[server]/DataSource=[Server];DCA=file.dca;ProtocolOrder=https/Soap:5461,NetTcp:5462;&quot;,&quot;[AF Database].Asset.Element&quot;) 
    YIELD row
    RETURN row.Name;

Does anyone know if APOC can accept spaces in the connection string so I can get the Integrated Security=SSPI query working?",1591225770,https://stackoverflow.com/q/62184214,ObsoleteATM,"['cypher', 'neo4j-apoc', 'neo4j']"
62183419,Efficient way to import multiple csv&#39;s in neo4j,"I am working on creating a graph database in neo4j for a CALL dataset. The dataset is stored in csv file with following columns: Source, Target, Timestamp, Duration. Here Source and Target are Person id&#39;s (numeric), Timestamp is datetime and duration is in seconds (integer).

I modeled my graph where person are nodes(person_id as property) and call as relationship (time and duration as property).
There are around 2,00,000 nodes and around 70 million relationships. I have a separate csv files with person id&#39;s which I used to create the nodes. I also added uniqueness constraint on the Person id&#39;s.

    CREATE CONSTRAINT ON ( person:Person ) ASSERT (person.pid) IS UNIQUE

I didn&#39;t completely understand the working of bulk import so I wrote a python script to split my csv into 70 csv&#39;s where each csv has 1 million nodes (saved as calls_0, calls_1, .... calls_69). I took the initiative to manually run a cypher query changing the filename every time. It worked well(fast enough) for first few(around 10) files but then I noticed that after adding relationship from a file, the import is getting slower for the next file. Now it is taking almost 25 minutes for importing a file.
Can someone link me to an efficient and easy way of doing it?

Here is the cypher query:

    :auto USING PERIODIC COMMIT 1000
    LOAD CSV WITH HEADERS FROM &#39;file:///calls/calls_28.csv&#39; AS line
    WITH toInteger(line.Source) AS Source, 
    datetime(replace(line.Time,&#39; &#39;,&#39;T&#39;)) AS time,
    toInteger(line.Target) AS Target,
    toInteger(line.Duration) AS Duration
    MATCH (p1:Person {pid: Source})
    MATCH (p2:Person {pid: Target})
    MERGE (p1)-[rel:CALLS {time: time, duration: Duration}]-&gt;(p2)
    RETURN count(rel)

I am using Neo4j 4.0.3",1591221575,https://stackoverflow.com/q/62183419,kinger,"['cypher', 'neo4j', 'load-csv']"
62172319,Neo4j db.schema.visualization gives additional recursive relationships,"I have created 2 nodes with different types and 2 relationships of the same type between them:

    CREATE (n1:Node1 {name: &#39;node1&#39;});
    CREATE (n2:Node2 {name: &#39;node2&#39;});
    MATCH (n1) where (n1.name=&#39;node1&#39;) MATCH (n2) where (n2.name=&#39;node2&#39;)
    	CREATE (n1)-[:connects {num: 7}]-&gt;(n2) CREATE (n2)-[:connects {num: 8}]-&gt;(n1);
[Screenshot][1]

Then I call *db.schema.visualization()* it gives me an additional recursive relationship for each of the node labels. Is this correct behavior or maybe I&#39;m doing something wrong?

[Screenshot][2]


  [1]: https://i.stack.imgur.com/r0EXa.png
  [2]: https://i.stack.imgur.com/BRU2P.png",1591185514,https://stackoverflow.com/q/62172319,Taras Dubyk,"['neo4j', 'graph', 'cypher']"
62161441,"How do you return created relationships using apoc.refactor.cloneNodes([nodes], true)?","The signature of apoc.refactor.cloneNodes() returns

`&quot;apoc.refactor.cloneNodes(nodes :: LIST? OF NODE?, withRelationships = false :: BOOLEAN?, skipProperties = [] :: LIST? OF STRING?) :: (input :: INTEGER?, output :: NODE?, error :: STRING?)&quot;`

The function only yields nodes for output. Is there a way to return relationships as well, or do you have to query these manually?

My current implementation looks like this, but I thought there might be a better way?
  ```
MATCH (n) WHERE n.id IN $ids
  WITH collect(n) as nodes
  CALL apoc.refactor.cloneNodes(nodes,true) yield output
  MATCH (output)-[r]-()
  SET output.id = apoc.create.uuid(), r.id = apoc.create.uuid()
  WITH collect({source:startnode(r), edge:r, target:endnode(r) }) as edges, collect (distinct output) as nodes
  RETURN *
```

search tag: `apoc.refactor.cloneNodesWithRelationships` (deprecated)

Updated to avoid cartesian products, and clarify nodesToClone and nodes:

```
MATCH (n) WHERE n.id in $ids
WITH collect(n) as nodesToClone
CALL apoc.refactor.cloneNodes(nodesToClone,true) yield output
SET output.id = apoc.create.uuid()
WITH output
MATCH (output)-[r]-()
SET r.id = apoc.create.uuid()
WITH collect({source:startnode(r), edge:r, target:endnode(r) }) as edges, collect (distinct output) as nodes
RETURN *
```",1591132122,https://stackoverflow.com/q/62161441,mattorp,"['cypher', 'neo4j']"
62134299,Inserver distance calculation and Combining Neo4j queries,"I have two queries which needs to be executed simultaneously on the neo4j server.
The first query needs to calculate the distance.
The Second Query needs to send the informations+ calculated distance in the JSON response
Pls suggest me How i could combine the  mentioned queries in Neo4j  ?



 **QUERY1:**
 
=======
   

    WITH point({ longitude:76.91859, latitude:8.487992, height: 100 }) AS p1, point({ latitude:8.495548 , longitude:76.93015, height: 100 }) AS p2 RETURN distance(p1,p2) AS dist

QUERY2:
=======
  

      MATCH (qperson:QuarantinedPersons) 
        WHERE qperson.name = &#39;Raman&#39; 
        CREATE (thereturnrecord:theDetails{theid: qperson.id,thename: 
        qperson.Name,thedetails:qperson.details,thelat:qperson.lat,thelong:qperson.long,thedistance:2000}) 
       RETURN thereturnrecord

Expected Output,similar to:
==============

   

     [
          {
            &quot;thereturnrecord&quot;: {
             &quot;identity&quot;: 3,
             &quot;labels&quot;: [
                &quot;theDetails&quot;
              ],
              &quot;properties&quot;: {
            &quot;thelong&quot;: &quot;76.91859&quot;,
            &quot;thelat&quot;: &quot;8.487992&quot;,
            &quot;thedetails&quot;: &quot;XYZ&quot;,
            &quot;thedistance&quot;: 2000(Obtained from the query),
            &quot;theid&quot;: &quot;1&quot;
          }
        }
      }




",1591021186,https://stackoverflow.com/q/62134299,VARUN ISAC,"['cypher', 'neo4j']"
62131947,neo4j look for users by radius,"I am a new noob to `neo4j`. this is my second day.      
Pretty excited about the technology and have many questions. please be patient ☺️

in the desired application, users can view uses around them   
(only in cases where both users are visible to each other using the `location_radius` ) property 


for this exercise, I generated `100,000` users with a random location in my country inside `MySql`. and they are imported to `neo4j` (relationships are created manually by python neo4j)


**1st attempt:**

create a relationship between users that are visible by the desire criteria.

a. insert all users to neo4j (fast)    
b. one by one create relationships by looking at the location of criteria of previous users (slow process, probably doing it wrong)    
this is still running, currently 13,987 nodes. 22,460,068 relationships..... is this wrong a idea? 

```
MATCH (src_u:User {user_id:1})-[:IN_SEARCH]-(u:User)
RETURN src_u, u
```


**2nd attempt**  (one the same schema)

Run the query without using the relationships 

```
MATCH (me:User {user_id:1}),(u:User)
WHERE u.user_id &lt;&gt; 1
AND me.gender &lt;&gt; u.gender
AND distance(me.location, u.location) &lt; me.location_radius 
AND distance(me.location, u.location) &lt; u.location_radius
RETURN u
```

**3rd attempt**

The same thing but try to optimize the 2nd attempt, will this query optimize the 2nd attempt?

```
MATCH (me:User {user_id:1})
WITH me
MATCH (u:User)
WHERE u.user_id &lt;&gt; 1
AND me.gender &lt;&gt; u.gender
WITH me, u, distance(me.location, u.location) as d 
WHERE d &lt; me.location_radius AND d &lt; u.location_radius
RETURN u
```

**My questions are:**

 1. is the **1st attempt** is the wrong way to go, dose millions of relationships is a wrong idea?
 2. dose **2/3 attempt** are superior to **1st attempt**?
 3. dose the **3rd attempt** dose any optimization for the **2nd attempt**? 
 4. dose a grid of &quot;Station&quot; `(Station {point(...)}` nodes (each kilometer square) and connecting users to the closest Station help (in case if **1st attempt** is too much.)?
 5. `neo4j` can replace the DB completely?, is it a good practice to store the RAW data in a relational database? 

-----

The User create query: 
```
MERGE (u:User {user_id:$user_id})
ON CREATE SET u.name=$name, u.gender=$gender, u.location=point({latitude:$latitude,longitude:$longitude}), u.location_radius=$location_radius
RETURN u
```


thank you 

shay
",1591013670,https://stackoverflow.com/q/62131947,shay te,"['geolocation', 'neo4j', 'cypher']"
62114552,IFC to Cypher via python and IfcOpenShell,"I want to convert an IFC file to a graph database to extract adjacency and accessibility of the spaces in the IFC model.
I wanted to use Neo4j, and as a part of this job, I need to extract a Cypher code from the IFC file.
I found [this code][1] but when I run it, I encounter the error below:



    AttributeError                            Traceback (most recent call last)
    &lt;ipython-input-1-b13704b3ee10&gt; in &lt;module&gt;
         20 typeDict = IfcTypeDict()
         21 
    ---&gt; 22 assert typeDict[&#39;IfcWall&#39;] == (&#39;GlobalId&#39;, &#39;OwnerHistory&#39;, &#39;Name&#39;, &#39;Description&#39;, &#39;ObjectType&#39;, &#39;ObjectPlacement&#39;, &#39;Representation&#39;, &#39;Tag&#39;)
         23 
         24 nodes = []
    
    &lt;ipython-input-1-b13704b3ee10&gt; in __missing__(self, key)
         15 class IfcTypeDict(dict):
         16     def __missing__(self, key):
    ---&gt; 17         value = self[key] = ifcopenshell.create_entity(key).wrapped_data.get_attribute_names()
         18         return value
         19 
    
    AttributeError: &#39;str&#39; object has no attribute &#39;get_attribute_names&#39;


Can anyone help me with this? or any other idea about how I can perform this task?
any help would be greatly appreciated.

Regards.

  [1]: https://gist.github.com/ysangkok/8aa7ab1c3207536518f3c3bf5f664880",1590919506,https://stackoverflow.com/q/62114552,Amir Hossein,"['graph', 'cypher', 'ifc']"
62102561,Neo4j: return error if no matching nodes found when creating a relationship?,"Apologies if this has already been asked, but I was unable to find the answer

I would like to error when trying to create a relationship between nodes, where one or both of the nodes do not exist

For example, the following code just returns no results, but I would like it to raise an error to let me know that these nodes do not exist, so that I can surface that error to my application:

```
MATCH (user1: User{uuid: &#39;123&#39;}), (user2: User{uuid: &#39;456&#39;})
CREATE (user1)-[:LIKES]-&gt;(user2)
```

Please assume that the database is empty and therefore no nodes were matched

I tried to add a constraint, but I didn&#39;t know how to approach it and if this is possible - are you able to help please?",1590842364,https://stackoverflow.com/q/62102561,RubberDuck,"['cypher', 'neo4j', 'neo4j-graphql-js']"
62097512,Return all nodes that are indirectly related to central node,"[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/n20rI.png


Hey guys! Im working with python py2neo and Im having trouble with returning &quot;COMPRAN...&quot; and &quot;COMPRAS STREETW...&quot;, which as you can see are indirectly related to &quot;Oscar&quot; by the two closest note to &quot;Oscar.&quot; My idea is to return a list with all nodes related to Oscar in the same way &quot;COMPRAN...&quot; and &quot;COMPRAS STREETW...&quot; are related.

The code Im trying is the following:

    lista = []
    for record in db.run(&quot;MATCH (a:user)-[:watched]-&gt;(b:video), (b)-[:hasTag]-&gt;(c:tag), (b)-[:hasGenre]-&gt;(d:genre), (e:video)-[:hasGenre]-&gt;(d:genre), (e:video)-[:hasTag]-&gt;(c:tag) WHERE a.name = $name RETURN e.name UNION MATCH (a:user)-[:watched]-&gt;(b:video), (b)-[:hasGenre]-&gt;(d:genre), (e:video)-[:hasGenre]-&gt;(d:genre) RETURN e.name UNION MATCH (a:user)-[:watched]-&gt;(b:video), (b)-[:hasGenre]-&gt;(d:genre), (e:video)-[:hasTag]-&gt;(c:tag) RETURN e.name&quot;, name=name, video=video, tag=tag, genre=genre):
        lista.append(record[&quot;e.name&quot;])
        return lista

My problem is that it is only returning the node with the name &quot;COMPRAS STREETW...&quot;, and my idea is that the query should return this node and &quot;COMPRAN...&quot; since they are related indirectly to &quot;Oscar&quot;. Thanks for reading and hope you can help me get this to work.
    



",1590810018,https://stackoverflow.com/q/62097512,Oscar Paredez,"['neo4j', 'python', 'cypher']"
62095685,"In Neo4j v4.0, Graph Data Science Library: why is Native Projection better than Cypher Projection in terms of performance?","The documentation [Creating graphs in the catalog](https://neo4j.com/docs/graph-data-science/current/management-ops/graph-catalog-ops/#catalog-graph-create) claims such performance advantange when using Native Projection over Cypher Projection, but does not give much explanation.

&gt; **Native projection**  
&gt; Provides the best performance...
&gt;
&gt; **Cypher projection**  
&gt; The more flexible, expressive approach with lesser focus on performance.

As I understand, all projections will end up:

&gt; Graph projections are stored entirely in-memory using compressed data structures optimized for topology and property lookup operations.

So why is the performance gain?

In addition, the assumed gained performance is for loading (materialize) the projected graph or later for processing, e.g. with PageRank algorithm?",1590792628,https://stackoverflow.com/q/62095685,JoyfulPanda,"['graph-algorithm', 'cypher', 'graph-data-science', 'neo4j']"
62092762,Can I rewrite this Cypher query to be compatible with Redis Graph?,"My use-case is that I have some agents in organisation structure. I want select for *some agent* (*can by me*) to see sum (*amount of money*) of all contracts that that agents subordinates (*and subordinates of their subordinates and so on...*) created with clients grouped by contract category.

Problem is that Redis Graph [do not currently support][1] `all` predicate. But I need to filter relations between agents because we have multiple &quot;modules&quot; with different organisation structures and I need report just from one module at the time.

My current Cypher query is:

```cypher
MATCH path = (:agent {id: 482})&lt;-[:supervised *]-(b:agent)
    WHERE all(rel IN relationships(path) WHERE
        rel.module_id = 1
        AND rel.valid_from &lt; &#39;2020-05-29&#39;
        AND &#39;2020-05-29&#39; &lt; rel.valid_to)
WITH b as mediators
MATCH (mediators)-[:mediated]-&gt;(c:contract)
    RETURN
        c.category as category,
        count(c) as contract_count,
        sum(c.sum) as sum
    ORDER BY sum DESC, category
```

This query works in Neo4j.

I don&#39;t event know if this query is correctly written for the type of result that I want.

My boss would really like to use Redis Graph instead Neo4j because of performance reasons but I can&#39;t find any way to rewrite this query to be functional in the Redis graph. Is it even possible?

**Edit 1:** I was told that we will be using graph just for currently valid data and just for one module so I no longer need functional `all` predicate but I am still interested in answer.


  [1]: https://github.com/RedisGraph/RedisGraph/issues/1059",1590778021,https://stackoverflow.com/q/62092762,Martin Sršeň,"['cypher', 'redisgraph']"
62088558,Add constraints to neo4j node based on node property value,"I am adding constraints to a neo4j database using Cypher constraints and want to create a constraint which only applies to a subset of a node type.

I can create a constraint that a `foo` field must exist on `Entity` with 

`CREATE CONSTRAINT ON (e:Entity) ASSERT EXISTS (e.foo)` 

but instead, I want to constrain only nodes with a given field. e.g 

`CREATE CONSTRAINT ON (e:Entity {constrain_flag:true) ASSERT EXISTS (e.foo)`

For example, I may have two nodes like

`(e:Entity { foo: &#39;bar&#39; , constrain_flag: true })` and

`(e:Entity { constrain_flag: false })`

I only want the constraint that `e.foo` must exist to apply to the `Entity` where `constrain_flag = true`, so both of these should be allowed. However,

`(e:Entity { constrain_flag: false })` should throw an exception.

Is there a way to do this currently with cypher and neo4j?

Thanks in advance!
",1590763398,https://stackoverflow.com/q/62088558,kernowal,"['neo4j', 'constraints', 'cypher']"
62086335,Neo4J ServiceUnavailable always in same place. No idea why,"I&#39;ve got a system that, when it is deployed, runs a lot of scripts to fill a Neo4J database. No CSV import, just regular queries creating tons of nodes and relationships.

Quite regularly, but not quite always, I get an error in one particular script, and I have no idea why. There&#39;s nothing unusual happening in that file.

The error:

    | { Neo4jError: Connection was closed by server
    |
    |     at captureStacktrace (/code/node_modules/neo4j-driver/lib/v1/result.js:200:15)
    |     at new Result (/code/node_modules/neo4j-driver/lib/v1/result.js:73:19)
    |     at Session._run (/code/node_modules/neo4j-driver/lib/v1/session.js:173:14)
    |     at Session.run (/code/node_modules/neo4j-driver/lib/v1/session.js:154:19)
    |     at Object.complete (/code/datamigrations/003/0007_yet_another_script.js:34:17)
    |     at ReadableStreamStreamer.ChunkStreamer.parseChunk (/code/node_modules/papaparse/papaparse.js:548:18)
    |     at ReadableStreamStreamer.&lt;anonymous&gt; (/code/node_modules/papaparse/papaparse.js:857:11)
    |     at ReadableStreamStreamer._streamData (/code/node_modules/papaparse/papaparse.js:1817:25)
    |     at ReadableStreamStreamer.&lt;anonymous&gt; (/code/node_modules/papaparse/papaparse.js:876:9)
    |     at IconvLiteEncoderStream.&lt;anonymous&gt; (/code/node_modules/papaparse/papaparse.js:1817:25) code: &#39;ServiceUnavailable&#39;, name: &#39;Neo4jError&#39; }

The script itself does nothing out of the ordinary. The error occurs at the first session.run of the script:

        session.run(
          `UNWIND {batch} as row
           MATCH (e:Episode {issueKey: row.issueKey})
           WITH e,row
           UNWIND row.otherIds as otherId
           MATCH (a:OtherElement {id: otherId})
           CREATE (e)-[:ENABLES]-&gt;(a)
          `,
          { batch: elements },

Admittedly it&#39;s a big batch I&#39;m creating here. Over 30k nodes. Could that cause the error? Would it be better to chunk this in batches of 10k or something?",1590756298,https://stackoverflow.com/q/62086335,mcv,"['cypher', 'neo4j']"
62083584,Constrain a property value using Cypher constraints,"I am adding constraints to a neo4j database using Cypher contraints and have a property field on a node where I want the value to be one of a set of strings. 

I have created a constraint that this field must exist but am unsure if you can constrain the value itself.

For example, my node may look like

`(e:Entity { foo: &#39;a&#39; })`

and I have the constraint

`CREATE CONSTRAINT ON (e:Entity) ASSERT EXISTS (e.foo)`

but I only want `foo` to be either `a`, `b`, `c` or `d`, so in this example, the node would be fine. However, if I were to add another node

`(e:Entity { foo: &#39;e&#39; })`,

then I would want this to fail and throw an exception.

The neo4j [Constraints documentation][1] suggests that there isn&#39;t currently a way of doing this. Has anybody come across this before and have a potential solution?

Thanks in advance!


  [1]: https://neo4j.com/docs/cypher-manual/current/administration/constraints/",1590747081,https://stackoverflow.com/q/62083584,kernowal,"['neo4j', 'cypher', 'constraints']"
62075945,converting a value to datetime in load csv in cypher,"I&#39;m trying to load csv file into neo4j using this query:  

    :auto
    
    USING PERIODIC COMMIT 
    LOAD CSV WITH HEADERS FROM &#39;file:///test.csv&#39; AS row
    MERGE (news:newsID {newsID: row.id})
      ON CREATE SET 
      news.title = row.title, 
      news.creation_date = row.creation_date,
      news.content = row.content;

I want to convert `creation_date` to datetime  
I can do that using something like:  

    WITH apoc.date.parse(&quot;2019-3-8 12:10:11&quot;, &quot;ms&quot;, &quot;yyyy-MM-dd HH:mm:ss&quot;) AS ms
    RETURN datetime({epochmillis: ms}) as cdate

But I can not use it in the `LOAD CSV` set part.   
How can I convert a field using `apoc.date.parse` and datetime in `LOAD CSV` ?",1590706964,https://stackoverflow.com/q/62075945,Ariyan,"['neo4j-apoc', 'load-csv', 'neo4j', 'cypher']"
62073645,How to add SSL cipher suites to HttpWebRequest VB.NET?,"I can&#39;t manage to securely SSL connect to a server through my VB.NET client. The server I am trying to connect is using TLS1.2 and accepts only the following cipher suites:

- TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f)   
- TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)   
- TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 (0xcca8)

However my **HttpWebRequest** specified as 

    ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls12

despite sending following 24 cipher suites none of which is compatible with any of the ones requested by the server. 

- TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 (0xc028)
- TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 (0xc027)
- TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA (0xc014)
- TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA (0xc013)
- +20 different others...

**During the handshake, how I can add any of the server requested cipher suites within the &quot;Hello&quot; packet, so the server would not refuse the HTTPS connection?** Is this done by adding few lines of code (if so, please guide me), upgrading .NET, adding or modifying Registry, or something else?",1590696500,https://stackoverflow.com/q/62073645,Gregory,"['cypher', 'tls1.2', 'ssl', 'https', 'vb.net']"
62064552,How to check if a node contains relation with other node with 2 specific codes in it but not a particular code in Neo4j Cypher Query,"I tried as below

    Match(A)-[r1]-&gt;(B) where B.Code IN [&#39;aaa&#39;, &#39;bbb&#39;] and B.Code &lt;&gt; &#39;ccc&#39; 
    return A, B

seems to be incorrect. This returns  records of B with &#39;aaa&#39; and &#39;bbb&#39; ignoring &#39;ccc&#39;. 
I dont want to return B at all if it has &#39;ccc&#39;. Not just ignore that relation. 

**Other tries: same result as above**

    Match(A)-&gt;[r1]-&gt;(B) where B.Code &lt;&gt; &#39;ccc&#39;
    With *
    Match(A)-&gt;[r1]-&gt;(B) where B.Code IN [&#39;aaa&#39;, &#39;bbb&#39;]
    return A, B 

[![enter image description here][1]][1]

Its is returning me A with aaa, A with bbb and X with aaa and X with bbb. I am expecting only X. Could you please correct where I am doing it incorrectly. 

  [1]: https://i.stack.imgur.com/eLLNG.png",1590668392,https://stackoverflow.com/q/62064552,Aiswarya Rajagopalan,"['neo4j', 'cypher']"
62055750,Neo4j - creating relationships for referential integrity,"I have ingested all the tables and columns metadata, now i&#39;m trying to create relationships using referential integrity. I have a csv file with 6 columns namely table_schema, table_name, col_name ,referenced_table_schema, referenced_table_name and referenced_column_name. Now i just need to create a relationship between the existing column nodes that are available. The cypher query that I tried

```
LOAD CSV WITH HEADERS FROM &quot;file:///column_ref_integrity.csv&quot; AS csv
 MATCH (n:column), (m:table), (o:db)
 where n.col_name=csv.col_name and m.table_name =csv.table_name and o.db_name = csv.table_schema
where n.col_name=csv.referenced_column_name and m.table_name = csv.referenced_table_name and o.db_name=referenced.db_name
 MERGE  (n{col_name:csv.col_name})-[:refers]-&gt;(n{col_name:csv.referenced_column_name}) 
```

This query doesn&#39;t seem to work. Any pointers about what I&#39;m doing wrong?",1590631159,https://stackoverflow.com/q/62055750,David,"['cypher', 'csv', 'neo4j']"
62049403,Neo4j query concerning two elements,"I need help trying to do a query in Neo4j that I can&#39;t seem to figure out. The query is to return all cakes that contain both the ingredients: Milk and Cream. 

Below is a snippet of a cake node and the ingredients (There are more ingredients and cakes but I didn&#39;t post them here as they are all formatted the same):

&lt;!-- begin snippet: js hide: false console: true babel: false --&gt;

&lt;!-- language: lang-SQL --&gt;

      (brownies:Cake {name: &quot;Brownies&quot;}),
      (brownies)-[:CONTAINS {quantity: 50, unit: &quot;grams&quot;}]-&gt;(white),
      (brownies)-[:CONTAINS {quantity: 250, unit: &quot;grams&quot;}]-&gt;(selfraising),
      (brownies)-[:CONTAINS {quantity: .5, unit: &quot;grams&quot;}]-&gt;(salt),
      (brownies)-[:CONTAINS {quantity: 125, unit: &quot;grams&quot;}]-&gt;(sugar),
      (brownies)-[:CONTAINS {quantity: 250, unit: &quot;grams&quot;}]-&gt;(cocoa),
      (brownies)-[:CONTAINS {quantity: 125, unit: &quot;grams&quot;}]-&gt;(lemonade),
      (brownies)-[:CONTAINS {quantity: 125, unit: &quot;grams&quot;}]-&gt;(cola),
      (brownies)-[:GARNISHED_WITH {how: &quot;chopped on top&quot;}]-&gt;(cherry),
      (brownies)-[:GARNISHED_WITH {how: &quot;chopped on top&quot;}]-&gt;(orange),
 

      (limeJuice:Ingredient {name: &quot;lime juice&quot;}),
      (cranberryJuice:Ingredient {name: &quot;cranberry juice&quot;}),
      (lemonJuice:Ingredient {name: &quot;lemon juice&quot;}),
      (orangeJuice:Ingredient {name: &quot;orange juice&quot;}),
      (tomatoJuice:Ingredient {name: &quot;tomato juice&quot;}),
      (lemonade:Ingredient {name: &quot;lemonade&quot;}),
      (soda:Ingredient {name: &quot;soda water&quot;}),
      (spice:Ingredient {name: &quot;spice water&quot;}),
      (cola:Ingredient {name: &quot;cola&quot;}),

&lt;!-- end snippet --&gt;

Neo4j seems to have trouble identifying ingredients but I&#39;m not entirely sure that my query is formatted correctly regardless, here is what I have so far: 
 

    MATCH(x:Cake)-[:CONTAINS]-&gt; (Ingredient: &quot;milk&quot; or &quot;cream&quot;) Return x

",1590601004,https://stackoverflow.com/q/62049403,Mark Sufex,"['cypher', 'neo4j']"
62047055,neo4j cypher filter nodes apoc dijkstra,"I have a graph, and i want to use the apoc dijkstra algorithm on it, so far everything is working. But i want to exclude certain nodes or node properties from the possible path, so that the dijkstra algorithm doesnt return a path that contains these excluded nodes or properties.

Is it possible, for example, to filter all existing nodes BEFORE calling the apoc.dijkstra algorithm?

I know that is it possible to filter the found path AFTER the algorithm, but then it is possible that there is a possible path in the graph that was not found, because the filterting of the nodes occurred afterwards..",1590593908,https://stackoverflow.com/q/62047055,Bennet L.,"['cypher', 'neo4j-apoc', 'neo4j']"
62045004,Match nodes where all relations satisfy constraints,"I&#39;m looking to find nodes that have relations where all relations satisfy that constraint. the exact example is do you have a relation in a list.

the graph is bascially cocktails, with the relations being ingredients. given a list of ingredients i want to know what I can make.

```
with [&#39;Sweet Vermouth&#39;, &#39;Gin&#39;, &#39;Campari&#39;, &#39;Bourbon&#39;] as list
...
should return Negroni, Boulevardier, ...
```

I&#39;ve been finding this tricky because we want to make sure that all relations of a node satisfy the constraint, but the number of **nodes could very easily be a subset** of the list and **not an exact match** to the ingredient list. 


this is the best I&#39;ve done so far, and it only works if you have all the ingredients, but nothing extra.
```
with [&#39;Sweet Vermouth&#39;, &#39;Gin&#39;, &#39;Campari&#39;, &#39;Bourbon&#39;] as list
MATCH (n:Cocktail)-[h:HAS]-(x)
WITH list, count(list) AS lth, n, COLLECT(DISTINCT x.name) AS cx, collect(DISTINCT h) as hh
WHERE ALL (i IN list WHERE i IN cx)
RETURN n
```


I&#39;ved looked at stackoverflow.com/a/62053139/974731. I don&#39;t think it solves my problem

[![enter image description here][1]][1]

  [1]: https://i.stack.imgur.com/CacwZ.png

as you can see the addition of Bourbon removes the Negroni, which shouldn&#39;t happen since all we&#39;ve done is add an ingredient to our bar.",1590588132,https://stackoverflow.com/q/62045004,austin,"['neo4j', 'cypher', 'graph']"
62043830,neo4j find paths between nodes with with the fewest stages,"I start to learn neo4j. I am using the graph

http://neo4j.com/graphgist/b1f6439d-2904-4fcf-8017-8c83d57ef20b#listing_category=sports-and-recreation

and I have a small issue. I do not know how to find routes that you can get from Darjeeling to Sandakphu with the fewest stages

Could anyone see how should be build correct query, should I use shortest path function?

Currently I&#39;m testing something like:

    MATCH (p:peak{name:&#39;Sandakphu&#39;})-[r*..5]-(t:town{name:&#39;Darjeeling&#39;}) 
    RETURN r
    MATCH path = ShortestPath((p)-[*..5])-(t)]
    RETURN path

",1590584695,https://stackoverflow.com/q/62043830,elizabeth.morgan0190,"['database', 'nosql', 'neo4j', 'cypher']"
62032608,Mimic a temporary view for Neo4j results,"I have a graph that consists of various pieces of evidence. I want to aggregate the confidence score between evidence between two nodes on the fly and return a new triple like `node1-[aggregate_score {agg_confidence:100}]-&gt;node2`. 

My current query:
```
MATCH (n1{name:&quot;test_node1&quot;})-[:IS_SRC_OF_EVIDENCE]-&gt;(test_ev:TestEvidence {theme:&quot;test_rel&quot;})&lt;-[:IS_TRG_OF_EVIDENCE]-(n2{name:&quot;test_node2&quot;})
WITH avg(test_ev.confidence) as agg_confidence, n1, n2
CREATE (n1)-[statement:TEST_REL{confidence:agg_confidence}]-&gt;(n2)
RETURN (n1)-[statement]-&gt;(n2)
```

From what I understand, there is no way to return a temporary relationships - only things that exist can be returned. So the next best bet would be to have something like a sub-graph that I could temporarily store this new relationship in; acting as a cache of sorts that I could regularly clear.

Before someone asserts that I should explicitly create this aggregate relationship for all sets of nodes, this is not an option as there are several metadata fields that will be filtered on that are not listed - date_published etc. which would then impact the aggregate score.

Any recommendations or has any one worked through a similar use case?
",1590533147,https://stackoverflow.com/q/62032608,Mason Edmison,"['cypher', 'neo4j']"
62004313,GraphDB - get paths among different types of nodes,"I have a graph DB (using Neo4J) consisting of 5 types of nodes, e.g. filename, type1, type2, type3 and type4.

    CREATE (:type1{name:type1_A})
    CREATE (:type1{name:type1_B})
    
    CREATE (:type2{name:type2_A})
    CREATE (:type2{name:type2_B})
    
    CREATE (:type3{name:type3_A})
    CREATE (:type3{name:type3_B})
    
    CREATE (:type4{name:type4_A})
    CREATE (:type4{name:type4_B})
    
    CREATE (:filename{name:1A_2A_3A_4A})
    CREATE (:filename{name:1A_2A_3A_4A_another})
    CREATE (:filename{name:1A_2B_3A_4A})
    CREATE (:filename{name:1A_2A_3B_4A})
    CREATE (:filename{name:1A_2A_3A_4B})

For each filename, I created 4 links (with same relationship name) as follows:

    MATCH(n:type1 {name:&#39;type1_A&#39;}) MATCH(f:filename {name:&#39;1A_2A_3A_4A}) CREATE (n)-[:linked_to]-&gt;(f)&quot; 
    MATCH(n:type2 {name:&#39;type2_A&#39;}) MATCH(f:filename {name:&#39;1A_2A_3A_4A}) CREATE (n)-[:linked_to]-&gt;(f)&quot; 
    MATCH(n:type3 {name:&#39;type3_A&#39;}) MATCH(f:filename {name:&#39;1A_2A_3A_4A}) CREATE (n)-[:linked_to]-&gt;(f)&quot; 
    MATCH(n:type4 {name:&#39;type4_A&#39;}) MATCH(f:filename {name:&#39;1A_2A_3A_4A}) CREATE (n)-[:linked_to]-&gt;(f)&quot; 

and so on for the other filenames.

Now, for instance, I&#39;d like to get all paths involving ***filename*** nodes linked to **type1_A** AND **type2_A** AND **type3_A** AND **type4_A**. In this case, I except &#39;***1A_2A_3A_4A***&#39; and &#39;***1A_2A_3A_4A_another***&#39; nodes and corresponding paths to ***type1_A***, ***type2_A*** and ***type3_A*** nodes.

Can anyone suggest me the corresponding Cypher query?

Thanks
",1590416293,https://stackoverflow.com/q/62004313,Fab,"['cypher', 'neo4j']"
61999141,Cypher aggregate function on different nodes to evaluate condition for multiple nodes,"[Metagraph of the database][1]


  [1]: https://i.stack.imgur.com/nd5ci.png

I have a Neo4j database of Reddit over a specific time period. 

I start from a specific subreddit, let&#39;s call it X. From X, I define the top_users of this subreddit as the users who have at least 1 post with a score higher than the average score of posts on this subreddit.
Next, I want to look for the other subreddits where the top_users of subreddit X are also top_users but now based on the average score of those subreddits&#39; posts and the top_users&#39; posts on those subreddits. 

This is what I already have, but not sure how to proceed. 
How should I best do this query?

    MATCH (p:Post)-[:Submitted]-&gt;(:Subreddit {display_name: &#39;X&#39;})
    WITH avg(toFloat(p.score)) as score_avg
    MATCH (u:User)-[:Submitted]-&gt;(p:Post)-[:Submitted]-&gt;(:Subreddit {display_name: &#39;X&#39;})
    WHERE p.score &gt; score_avg
    WITH DISTINCT u as top_users
    MATCH (top_users)-[:Submitted]-&gt;(:Post)-[:Submitted]-&gt;(sub:Subreddit)
    WITH sub as top_users_subs
    MATCH (p:Post)-[:Submitted]-&gt;(top_users_subs)
    WITH avg(toFloat(p.score)) as subs_score, top_users_subs",1590397407,https://stackoverflow.com/q/61999141,bjrn,"['neo4j', 'cypher']"
61997386,Neo4j -CASE statement-Create a node if it doesn&#39;t exist,"I am trying to check if a user has made a post before.
If he had made a post ,`post_id` will be `max(post_id)+1`.
Else `post_id` will be `1`.
Cypher query is below:

    MATCH (p:Post{user_id:1})
    with count(p) as c
    CASE 
    WHEN c&gt;0
    THEN create (cc:Post{user_id:1,post:1})
    ELSE with max(p.post_id+1) as new_post_id create (cc:Post{user_id:1,post:new_post_id}) END;
It produces the following error:

    Invalid input &#39;S&#39;: expected &#39;l/L&#39; (line 4, column 3 (offset: 48))
    &quot;CASE&quot;
How to solve it?
Is there a better way to find whether a node with particular property exists and do operations based on that?",1590390385,https://stackoverflow.com/q/61997386,TheGuardener,"['neo4j', 'cypher']"
61996093,Cypher commands not being recognised,"I&#39;m using Neo4j for a project, when I try to run `SHOW DATABASES`, I get this error:

```
Invalid input &#39;H&#39;: expected &#39;t/T&#39;, &#39;e/E&#39; or &#39;n/N&#39; (line 1, column 2 (offset: 1))

&quot;SHOW DATABASES&quot;
```

I&#39;m running Neo4j Browser version: 4.0.3.

Why is this function not recognized? It&#39;s referenced multiple times in the docs. I have no issues running other queries with different commands, but this is not recognized. 

How can I solve this problem? 
",1590382888,https://stackoverflow.com/q/61996093,Oli,"['cypher', 'neo4j']"
61983033,neo4j Cypher - Check if exact graph exists,"I use neo4j to represent unique flows in my system.  
I get data represented in JSON and before writing it to neo4j I need to make sure it does not exist yet.  
We can assume there is only one relation between 2 nodes and that there&#39;s only 1 entry point and 1-way relations.

To check if the graph exists I need to match the nodes, the relations, and the **relation count**.  
I&#39;m currently struggling with the count (without it I&#39;m only checking if a graph is contained).  
Here&#39;s an example of a generated query that does not work (return empty result):

```
MATCH
(n:User {userId: 1234}),
(n_0:User {userId: 3345}),
(n_1:Group {groupId: 8765}),
(n_1_0:Event {eventId:3456})

OPTIONAL MATCH
(n)--&gt;(n_rel),
(n_0)--&gt;(n_0_rel),
(n_1)--&gt;(n_1_rel),
(n_1_0)--&gt;(n_1_0_rel)

WITH
n, count(n_rel) AS n_count,
n_0, count(n_0_rel) AS n_0_count,
n_1, count(n_1_rel) AS n_1_count,
n_1_0, count(n_1_0_rel) AS n_1_0_count

WHERE (n)-[:PING {someProp:true}]-&gt;(n_0)
AND   (n)-[:JOIN {someProp:&quot;cool&quot;}]-&gt;(n_1)
AND   (n_1)-[:PUBLISH {otherProp: &quot;Hello&quot;}]-&gt;(n_1_0)
AND   n_count = 2
AND   n_0_count = 0
AND   n_1_count = 1
AND   n_1_0_count = 0

RETURN n
```

Here&#39;s a **working one** without count checks:

```
MATCH
(n:User {userId: 1234}),
(n_0:User {userId: 3345}),
(n_1:Group {groupId: 8765}),
(n_1_0:Event {eventId:3456})

WHERE (n)-[:PING {someProp:true}]-&gt;(n_0)
AND   (n)-[:JOIN {someProp:&quot;cool&quot;}]-&gt;(n_1)
AND   (n_1)-[:PUBLISH {otherProp: &quot;Hello&quot;}]-&gt;(n_1_0)

RETURN n
```

What am I missing when trying to get the relations count?

",1590306439,https://stackoverflow.com/q/61983033,nirsky,"['neo4j', 'cypher']"
61961413,Avoid creating multiple relationships for each match,"I have the following model, each `User` is linked to several `Comment` node with the `AUTHORED` relationship, each comment has a `flair` property which can be different on each comment. I also has a `Flair` node, and wish to create a new relationship between `User` nodes and `Flair` nodes.

```
+--------+                          +---------+
|        |                          |         |
|  User  +------+ REL:AUTHORED+-----+ Comment |
|        |                          |         |
+--------+                          +---------+
```

So I wrote the following query to try and do that, but it resulted in a relationship from the `User` node for each `Comment` node with the correct flair. I only want a single relationship between those nodes. How do I achieve that?
```
MATCH (a:User)-[:AUTHORED]-(c:Comment),(b:Flair)
WHERE c.flair = &#39;foo&#39; and b.name = &#39;foo&#39;
CREATE (a)-[r:VOTES_FOR]-&gt;(b)
RETURN type(a,b,r)
```",1590171376,https://stackoverflow.com/q/61961413,user12380311,"['neo4j', 'cypher']"
61944602,How to aggregate count of nodes at every depth of variable length relationship,"## Data structure
I have `User` and `Organisation` nodes in my graph stored in neo4j.

A `User` can refer another `User` (relationship: `REFFERED`)
A `User` can subscribe to an `Organisation` (relationship: `SUBSCRIBED_TO`)

## Goal
I want to find the referrals that are coming from one user (eg. friends-of-friends-of-n*/referral-of-referral-of-n*) and the subscriptions those users made, ordered by each level of depth.

## Problem
I have following cypher query:

```
MATCH p= (start:User {uid: 1})-[:REFERRED|SUBSCRIBED_TO*]-&gt;(end)
WITH *, relationships(p) as rel
WITH *, size(rel) as Depth
WITH Depth, type(rel[Depth - 1]) as Type, count(p) as Count
RETURN Depth, Type, Count
```

Returning:

```
╒═══════╤══════════════════════╤═══════╕
│&quot;Depth&quot;│&quot;Type&quot;                │&quot;Count&quot;│
╞═══════╪══════════════════════╪═══════╡
│1      │&quot;REFERRED&quot;            │10     │
├───────┼──────────────────────┼───────┤
│2      │&quot;REFERRED&quot;            │100    │
├───────┼──────────────────────┼───────┤
│3      │&quot;REFERRED&quot;            │1000   │
├───────┼──────────────────────┼───────┤
│4      │&quot;REFERRED&quot;            │10000  │
├───────┼──────────────────────┼───────┤
│4      │&quot;SUBSCRIBED_TO&quot;       │6      │
├───────┼──────────────────────┼───────┤
│2      │&quot;SUBSCRIBED_TO&quot;       │2      │
└───────┴──────────────────────┴───────┘
```
And the results are correct. However, if I want to pass on `end` in `WITH` to use a `UNION` to `MATCH` a second result with the `end` value, my result set changes.

Query:

```
MATCH p= (start:User {uid: 1})-[:REFERRED|SUBSCRIBED_TO*]-&gt;(end)
WITH *, relationships(p) as rel
WITH *, size(rel) as Depth
WITH Depth, type(rel[Depth - 1]) as Type, count(p) as Count, end
RETURN Depth, Type, Count
```
Result:

```
╒═══════╤══════════════════════╤═══════╕
│&quot;Depth&quot;│&quot;Type&quot;                │&quot;Count&quot;│
╞═══════╪══════════════════════╪═══════╡
│1      │&quot;REFERRED&quot;            │1      │
├───────┼──────────────────────┼───────┤
│2      │&quot;REFERRED&quot;            │1      │
├───────┼──────────────────────┼───────┤
│3      │&quot;REFERRED&quot;            │1      │
├───────┼──────────────────────┼───────┤
│4      │&quot;REFERRED&quot;            │1      │
├───────┼──────────────────────┼───────┤
│4      │&quot;REFERRED&quot;            │1      │
├───────┼──────────────────────┼───────┤
│4      │&quot;REFERRED&quot;            │1      │
├───────┼──────────────────────┼───────┤
│4      │&quot;REFERRED&quot;            │1      │
├───────┼──────────────────────┼───────┤

...
├───────┼──────────────────────┼───────┤
│4      │&quot;SUBSCRIBED_TO&quot;       │2      │
├───────┼──────────────────────┼───────┤
│4      │&quot;SUBSCRIBED_TO&quot;       │2      │
├───────┼──────────────────────┼───────┤
│4      │&quot;SUBSCRIBED_TO&quot;       │1      │
├───────┼──────────────────────┼───────┤
│4      │&quot;SUBSCRIBED_TO&quot;       │1      │
...
```
## Question
So my question has two parts:

 1. How would one most efficiently construct this kind of query with cypher?
 2. What paradigm or what principle of cypher makes it that the result gets spread over multiple rows when `end` is passed along",1590098919,https://stackoverflow.com/q/61944602,Sasja Vandendriessche,"['neo4j', 'cypher']"
61940206,Cypher program fails on non digit argv check,"I need to create a program that takes a command line argument to shift the letters of an input text creating a cyphered output. 
I am getting an error on the &quot;handles non-numeric key - timed out while waiting for program to exit&quot; on the code below. I have added another check to iterate through argv in order to see if it is a digit (isdigit) or not but it still doesn&#180;t work. 

```
#include &lt;cs50.h&gt;
#include &lt;stdio.h&gt;
#include &lt;ctype.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

int main(int argc, string argv[])
{
    if (argc != 2)
    {
        printf(&quot;Usage: ./caesar key\n&quot;);
        return 1;
    }

    int k = atoi(argv[1]); // store key value in K as an int
    int i;
    int key;
    for (key=0; key &lt; strlen(argv[1]); key++)
    {
        if (isdigit(argv[1][key] == 0))
        {
            printf(&quot;Usage: ./caesar key\n&quot;);
            return 1;
        }
        else
        {
            continue;
        }
    }
    string plaintext = get_string(&quot;Type your text: &quot;);  // get text input
    printf(&quot;ciphertext: &quot;);      // print title to get cyphered text

    for (i = 0; i &lt; strlen(plaintext); i++)
    {
        if (isalpha(plaintext[i]))
        {
            if (islower(plaintext[i]))
            {
                printf(&quot;%c&quot;, ((((plaintext[i] + k) - 97) % 26) + 97)); // formula to convert to alphab and then back to ascii
            }
            else if (isupper(plaintext[i]))
            {
                printf(&quot;%c&quot;, ((((plaintext[i] + k) - 65) % 26) + 65)); // formula to convert to alphab and then back to ascii
            }
        }
        else
        {
            printf(&quot;%c&quot;, plaintext[i]); // print as is
        }
    }

    printf(&quot;\n&quot;); //exit
    return 0;

}",1590081810,https://stackoverflow.com/q/61940206,snowboly,"['c', 'cypher', 'cs50']"
61911548,neo4j path query with nodes,"Env - Neo4j 4.0 enterprise
Plugins - GDS and apoc

I have a data in neo4j like below - 

    CREATE (a:hotel {hotel_id:&#39;A&#39;}),
      (b:hotel {hotel_id:&#39;B&#39;}),
      (c:hotel {hotel_id:&#39;C&#39;}),
      (d:hotel {hotel_id:&#39;D&#39;}),
      (e:hotel {hotel_id:&#39;E&#39;}),
      (f:hotel {hotel_id:&#39;F&#39;}),
	  (g:hotel {hotel_id:&#39;G&#39;}),
	  (h:hotel {hotel_id:&#39;H&#39;}),
	  (i:hotel {hotel_id:&#39;I&#39;}),
	  (a)-[:HAS]-&gt;(b),
	  (b)-[:HAS]-&gt;(c),
	  (c)-[:HAS]-&gt;(d),
	  (d)-[:HAS]-&gt;(e),
	  (e)-[:HAS]-&gt;(f),
	  (f)-[:HAS]-&gt;(g),
	  (g)-[:HAS]-&gt;(h),
	  (h)-[:HAS]-&gt;(i),
	  (ap:hotel_loc {loc_id:&#39;pp1A&#39;}),
	  (bp:hotel_loc {loc_id:&#39;pp1B&#39;}),
	  (cp:hotel_loc {loc_id:&#39;pp1C&#39;}),
	  (dp:hotel_loc {loc_id:&#39;pp1D&#39;}),
	  (ep:hotel_loc {loc_id:&#39;pp1E&#39;}),
	  (fp:hotel_loc {loc_id:&#39;pp1F&#39;}),
	  (gp:hotel_loc {loc_id:&#39;pp1G&#39;}),
	  (hp:hotel_loc {loc_id:&#39;pp1H&#39;}),
	  (ip:hotel_loc {loc_id:&#39;pp1I&#39;}),
	  (a)-[:HAS_JUNC]-&gt;(ap),
	  (b)-[:HAS_JUNC]-&gt;(bp),
	  (c)-[:HAS_JUNC]-&gt;(cp),
	  (d)-[:HAS_JUNC]-&gt;(dp),
	  (e)-[:HAS_JUNC]-&gt;(ep),
	  (f)-[:HAS_JUNC]-&gt;(fp),
	  (g)-[:HAS_JUNC]-&gt;(gp),
	  (h)-[:HAS_JUNC]-&gt;(hp),
	  (i)-[:HAS_JUNC]-&gt;(ip);
	  



2 scenerios 
1. List of the all node starting from
given a loc_id (example `pp1F`), i need to get all the nodes(hotel) and their associated :HAS_JUNC nodes.
 

    f,pp1F
    g,pp1G
    h,pp1H
    i,pp1I

2. List of all until the end.
given a loc_id (example `pp1C`), i need to all the nodes until pp1C

```
a,pp1A
b,pp1B
c,pp1C
```



I tried this query, but no results - 

    MATCH s=  (h1:hotel)-[:HAS_PROPERTY]-&gt;(start:hotel_propert {property_id:&quot;pp1A&quot;}),
    e=  (h2:hotel)-[:HAS_PROPERTY]-&gt;(end:hotel_propert {property_id:&quot;pp1C&quot;})
    WITH h1, h2, s,e match p=(h1)-[:HAS*]-&gt;(h2) RETURN s,p,e

Any help is highly appreciated.
   


",1589972880,https://stackoverflow.com/q/61911548,user3470294,"['neo4j', 'cypher']"
61911182,How to move all neo4j relationships with all their labels and properties from one node to another?,"Suppose you&#39;ve got two nodes that represent the same thing, and you want to merge those two nodes. Both nodes can have any number of relations with other nodes.

The basics are fairly easy, and would look something like this:

    MATCH (a), (b) WHERE a.id == b.id
    MATCH (b)-[r]-&gt;()
    CREATE (a)-[s]-&gt;()
    SET s = PROPERTIES(r)
    DELETE DETACH b

Only I can&#39;t create a relation without a type. And Cypher doesn&#39;t support variable labels either. I&#39;d love to be able to do something like

    CREATE (a)-[s:{LABELS(r)}]-&gt;(o)

but that doesn&#39;t work. To create the relation, you need to know the type of the relation, and in this case I really don&#39;t.

Is there a way to dynamically assign types to relationships, or am I going to have to query the types of the old relation, and then string concat new queries with the proper types? That&#39;s not impossible, but a lot slower and more complex. And this could potentially match a lot of elements and even more relationships, so having to generate a separate query for every instance is going to slow things down quite a lot.

Or is there a way to change the target of the old relationship? That would probably be the fastest, but I&#39;m not aware of any way to do that.",1589971735,https://stackoverflow.com/q/61911182,mcv,"['cypher', 'neo4j']"
61906725,Receive JSON data from Neo4j to Spring Boot API,"I&#39;m trying to send data from Neo4J to Spring boot and I want to receive a JSON like this:
```
{
  &quot;name&quot;: &quot;Alex Statham&quot;,
  &quot;people&quot;: [
    {
      &quot;name&quot;: &quot;Jason Statham&quot;,
      &quot;people&quot;: [
        {
          &quot;name&quot;: &quot;Lyna Statham&quot;
        },
        {
          &quot;name&quot;: &quot;John Statham&quot;
        }
      ]
    },
    {
      &quot;name&quot;: &quot;Will Statham&quot;,
      &quot;people&quot;: [
        {
          &quot;name&quot;: &quot;Michael Statham&quot;
        }
      ]
    }
  ]
}
```
I try many query and this one maybe the best query which returns a correct family tree for all cases, but it only return nodes with no relationship so I can&#39;t put that data to the Library I use:
```
MATCH (p1:Person {maBN:3})
CALL apoc.path.subgraphNodes(p1, {
    sequence: &#39;&gt;Person,FCHILD,&gt;Person,FCHILD,&gt;Person&#39;,
    maxLevel: 6
}) YIELD node
RETURN node, p1
```

Here is that Library: https://www.npmjs.com/package/react-tree-graph

What should I do? I don&#39;t know too much about Cypher and Neo4j.",1589957099,https://stackoverflow.com/q/61906725,An Duy,"['cypher', 'neo4j', 'api', 'spring']"
61905685,Neo4j/Cypher - LIMIT makes query run faster although less results are returned,"I have created a graph which holds information about movies and people who have worked at those movies either as crew or cast. The following query is supposed to find directors who have at least one pair of movies with X amount of years between their release dates.


    MATCH (p:Person)-[r1:CREW]-&gt;(m1:Movie), (p:Person)-[r2:CREW]-&gt;(m2:Movie)
    WHERE r1.job = &#39;Director&#39; AND r2.job = &#39;Director&#39; AND m1.movie_id &lt; m2.movie_id
    AND ABS(duration.between(m1.release_date, m2.release_date).years) &gt;= 50
    RETURN DISTINCT p.id, p.name
    LIMIT 1000000

This LIMIT at the end makes the query actually run and pretty fast too. Without that limit, the execution takes a long time and then throws a heap exception. Please note, as stated in the title, that the results returned are about 40-50. It makes no sense to me that this runs faster with the LIMIT since it does not actually LIMIT anything...or does it? Any help appreciated.

EDIT: &lt;br&gt;
I am using neo4j version 4.0.4 Community Edition&lt;br&gt;
My graph contains about 400000 nodes and 1.2 million relationships.

As requested in the comments:
Here is a profile execution with the LIMIT
[![enter image description here][1]][1]

And here is an explain plan without the LIMIT:
[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/b8G4b.png
  [2]: https://i.stack.imgur.com/TbYjM.png",1589952220,https://stackoverflow.com/q/61905685,Theo Stefou,"['limit', 'cypher', 'neo4j']"
61904929,Spring data neo4j: Invalid syntax &#39;$&#39; in Cypher。 How to replace &#39;$&#39; with &#39;{}&#39;?,"The Cypher generated by spring data neo4j uses &quot;$&quot; to pass value, which will cause a error of Invalid Syntax by neo4j. 

For example:

The Cypher generated by spring data neo4j for:

`Optional&lt;linkType&gt; findById(Long id);`

is

```&quot;MATCH ()-[r0:`linkType`]-&gt;() WHERE ID(r0)=$id WITH r0,STARTNODE(r0) AS n, ENDNODE(r0) AS m RETURN r0,n,m, ID(r0)&quot;```

This gets a error of Invalid Syntax.
I fixed this by use @Query:

```@Query(&quot;MATCH ()-[r0:`linkType`]-&gt;() WHERE ID(r0)={id} WITH r0,STARTNODE(r0) AS n, ENDNODE(r0) AS m RETURN r0,n,m, ID(r0)&quot;)
Optional&lt;linkType&gt; findById(Long id);```

However, when I want to use the PagingAndSortingRepository, I cannot use the @Query to fix this problem. Because it will add `SKIP $sdnSkip LIMIT $sdnLimit` at the edn automaticaly.

How can I fix this problem? Thanks.",1589947719,https://stackoverflow.com/q/61904929,Jie W,"['neo4j', 'cypher', 'spring-data-neo4j']"
61904621,MATCH based on sum of common node property,"I need help figuring out a MATCH statement.

My data model is as follows:

    (a:musician {name}) //individual musicians
    (b:jamSession {date, durationInHours}) //the date and length of jam sessions where 2 or more musicians participated together

and the relation

    [r:PLAYED]


I&#39;ve already figured out how to find all of the jam sessions a specific musician played at:

    MATCH (a:musician {name:&quot;Joe Smith&quot;})-[r:PLAYED]-&gt;(b:jamSession) RETURN a.name, b.date

and all of the musicians a specific musician played with

    MATCH (a:musician {name:&quot;Joe Smith&quot;})-[r:PLAYED]-&gt;(b:jamSession)&lt;-[r2:PLAYED]-(c:musician) RETURN c.name

But how do I get only the musicians that Joe Smith has played with were the sum total time of their common jam sessions was &gt;=100 hours and what date the pair of musicians meet the 100 hour milestone?",1589945504,https://stackoverflow.com/q/61904621,David Detlefsen,"['cypher', 'neo4j']"
61887664,Is it possible to fine tune the RETURN statement to skip edges between nodes of a particular type?,"I have a query of that looks something like this:

    MATCH (a:Y {uid:42})-[r]-(b:X)-[:SUB_CLASS_OF*0..]-&gt;(:X {name:&quot;node_of_interest&quot;} ) 
    RETURN a, r, b

The issue I am having is that the nodes that match `node2` tend to have LOTS of edges between them. I would like to get the links between node `a` (type Y) and node(s) that match `b` (type X), but not the edges between the different nodes that match `b`. 

So to further clarify, lets say there is a single match for `a` and  `b` matches three nodes (lets call them b1, b2, b3) I would like to return a subgraph, that has the edges between (a-b1), (a-b2) and (a-b3) but **not** (b1-b2), (b1-b3) and (b2-b3).

Is this possible?

**EDIT:** added more information and tried to clarify the code as well as what is needed.",1589880450,https://stackoverflow.com/q/61887664,posdef,"['cypher', 'neo4j']"
61871074,How to properly use apoc.periodic.iterate to reduce heap usage for large transactions?,"I am trying to use apoc.periodic.iterate to reduce heap usage when doing very large transactions in a Neo4j database.
I&#39;ve been following the advice given in [this presentation.][1] 
BUT, my results are differing from those observed in those slides.

First, some notes on my setup:

 - Using Neo4j Desktop, graph version 4.0.3 Enterprise, with APOC 4.0.0.10
 - I&#39;m calling queries using the .NET Neo4j Driver, version 4.0.1. 
 - neo4j.conf values:
   - dbms.memory.heap.initial_size=2g
   - dbms.memory.heap.max_size=4g
   - dbms.memory.pagecache.size=2g

Here is the cypher query I&#39;m running:

    CALL apoc.periodic.iterate(
    &quot;UNWIND $nodes AS newNodeObj RETURN newNodeObj&quot;,
    &quot;CREATE(n:MyNode)
    SET n = newNodeObj&quot;,
    {batchSize:2000, iterateList:true, parallel:false, params: { nodes: $nodes_in } }
    )

And the line of C#:

    var createNodesResCursor = await session.RunAsync(createNodesQueryString, new { nodes_in = nodeData });

where ```createNodesQueryString``` is the query above, and ```nodeData``` is a ```List&lt;Dictionary&lt;string, object&gt;&gt;``` where each Dictionary has just three entries: 2 strings, 1 long.

When attempting to run this to create 1.3Million nodes I observe the heap usage (via JConsole) going all the way up to the 4GB available, and bouncing back and forth between ~2.5g - 4g. Reducing the batch size makes no discernible difference, and upping the heap.max_size causes the heap usage to shoot up to almost as much as that value. It&#39;s also *really* slow, taking 30+ mins to create those 1.3 million nodes.

Does anyone have any idea what I may be doing wrong/differently to the linked presentation? I understand my query is doing a CREATE whereas in the presentation they are only updating an already loaded dataset, but I can&#39;t imagine that&#39;s the reason my heap usage is so high.

Thanks

  [1]: https://cdn.neo4jlabs.com/nodes2019/slides/Best+Practices+for+Making+(Very)+Large+Database+Updates+in+Neo4j.pdf",1589809712,https://stackoverflow.com/q/61871074,Codie Collinge,"['cypher', 'neo4j-dotnet-driver', 'neo4j']"
61850219,How to return a list of people in neo4j?,"I am new to neo4j and i am trying to answer a few practice questions. However, i am not getting the syntax and struggling to understand how to return a list of people. The following is the question i am trying to answer:

Assume we have a graph database containing two sets of nodes labelled :Reader and :Book. These nodes are connected with relationships labelled :READ.

Write the Cipher code to list all readers who have read the book with the title &quot;Moby Dick&quot;",1589710845,https://stackoverflow.com/q/61850219,kg1991,"['neo4j', 'cypher']"
61839465,Find all children of a Person along with their Spouse using Cypher,"I have a graph like this:

[![Graph data showing parent-child-parent relation][1]][1]

[1]: https://i.stack.imgur.com/9FPyY.png

Where **John** is married to **Jane** and has a child **Marry**. Also, John has another child named **Mark** whose mother is unknown.

The below cypher returns only one record matching John &amp; Jane.

    match p=(:Person {name: &quot;John&quot;)-[:PARENT_OF]-&gt;(:Person)&lt;-[:PARENT_OF]-(c:Person) 
    return [s in nodes(p) | s.name]


    ╒══════════════════════════╕
    │&quot;[s in nodes(p) | s.name]&quot;│
    ╞══════════════════════════╡
    │[&quot;John&quot;,&quot;Marry&quot;,&quot;Jane&quot;]   │
    └──────────────────────────┘

What should be the cypher that gives me the following result?

    ╒══════════════════════════╕
    │&quot;[s in nodes(p) | s.name]&quot;│
    ╞══════════════════════════╡
    │[&quot;John&quot;,&quot;Marry&quot;,&quot;Jane&quot;]   │
    ╞══════════════════════════╡
    │[&quot;John&quot;,&quot;Mark&quot;,&quot;&quot;]		   │
    └──────────────────────────┘",1589644122,https://stackoverflow.com/q/61839465,MMH,"['neo4j', 'cypher']"
61838884,Neo4j Get all nodes which related to list of nodes,"I have database with labels :Theme and :Term. Terms related to themes. I need filter for terms by themes with AND feature. It\`s will be like this: i\`m choosing couple of themes, and geting terms with these all themes.
I`m sending ids of themes.

I`ve tryed this query:
```
MATCH (n:Term)--&gt;(t:Theme)
WHERE id(t) IN [1, 2, 3]
RETURN n
```
But it`s **OR** logic. I need **AND** logic.",1589641601,https://stackoverflow.com/q/61838884,Marchyk,"['cypher', 'neo4j']"
61807255,Cypher to sum dynamic properties values,"I have some dynamic datasource property values on a node. There are around 5 datasources which could have one or more data sources. These properties are set via a [@Properties][1] annotation using a Map in Spring Data Neo4j. Once the node is saved, the values are set on the node as follows:

````
dataSource.ds1.count=&quot;10&quot;
dataSource.ds2.count=&quot;20&quot;
dataSource.ds3.count=&quot;30&quot;
... etc
````

I want to be able to sum the values of these counts dynamically if they have been set and use this value to order the results.

Here is the some of the starting Cypher I have so far which lists the properties:

````
MATCH (n:Entity)
WITH n, [k in keys(n) where k =~ &#39;dataSources.(ds1|ds2).count&#39;] as props
RETURN n.name, props
````

This returns:

````
╒═══════════╤═════════════════════════════════════════════════╕
│&quot;n.name&quot;   │&quot;props&quot;                                          │
╞═══════════╪═════════════════════════════════════════════════╡
│&quot;ENT1&quot;     │[&quot;dataSources.ds1.count&quot;,&quot;dataSources.ds2.count&quot;]│
├───────────┼─────────────────────────────────────────────────┤
│&quot;ENT2&quot;     │[&quot;dataSources.ds1.count&quot;,&quot;dataSources.ds2.count&quot;]│
├───────────┼─────────────────────────────────────────────────┤
│&quot;ENT3&quot;     │[&quot;dataSources.ds1.count&quot;]                        │
└───────────┴─────────────────────────────────────────────────┘
````

How can I use the properties names to get the values and sum them? 

I was thinking of something similar to this where I could use `apoc.sum` but am unsure of how to iterate over the property names to get their values.

````
RETURN n.name, apoc.coll.sum([COALESCE(toInteger(n.`dataSources.ds1.count`), 0), etc]) as count
ORDER by count DESC
````

Any help would be much appreciated.


  [1]: https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#reference:annotating-entities:node-entity:dynamic-properties",1589489883,https://stackoverflow.com/q/61807255,Swordfish,"['spring-data-neo4j', 'neo4j', 'cypher']"
61805603,How to improve performance of LOAD CSV in NEO4J,"I am using community edition of neo4j.I am trying to create 50000 nodes and 93400 relationships using CSV file.But the load csv command in neo4j is taking around 40 mins to create the nodes and relationships.
Using py2neo package in python to connect and run cypher queries.Load csv command looks similar to one below:
```
USING PERIODIC COMMIT LOAD CSV WITH HEADERS FROM &quot;file:///Sample.csv&quot; AS row WITH row 
MERGE(animal:Animal { name:row.`ANIMAL_NAME`})
ON CREATE SET animal{name:row.`ANIMAL_NAME`,type:row.`TYPE`, status:row.`Status`, birth_date:row.`DATE`}
ON MATCH SET animal +={name:row.`ANIMAL_NAME`,type:row.`TYPE`,status:row.`Status`,birth_date:row.`DATE`}
MERGE (person:Person { name:row.`PERSON_NAME`})
ON CREATE SET person ={name:row.`PERSON_NAME` age:row.`AGE`, address:row.`Address`, birth_date:row.`PERSON_DATE`}
ON MATCH SET person += { name:row.`PERSON_NAME`, age:row.`AGE`, address:row.`Address`, birth_date:row.`PERSON_DATE`}
MERGE (person)-[:OWNS]-&gt;(animal);
```
`
Infrastructure Details:
`
dbms.memory.heap.max_size=16384M

dbms.memory.heap.initial_size=2048M

dbms.memory.pagecache.size=512M

neo4j_version:3.3.9

How would I get it to work faster.Thanks in advance",1589483655,https://stackoverflow.com/q/61805603,ck22,"['neo4j', 'cypher', 'load-csv']"
61804397,Neo4j Cypher: Unable to define relationships with duplicate records,"So, I have some user event data and would like to create a graph of the same. A snapshot of the data

[![enter image description here][1]][1]


Now, the `_id` col has duplicate records but they are actually the same person, however there are multiple `sessionField` records for the same `_id`

What I&#39;d want is something like this:

    Node A -&gt; sessionNode a1 -&gt; Action Node a11 (with event type as properties, 4 in this case)
           -&gt; sessionNode a2 -&gt; Action Node a21 (with event type as properties, 2 in this case)
    Node B -&gt; sessionNode b1 -&gt; Action Node b11 (with event type as properties, 3 in this case)

I&#39;ve tried the following code, but being new to graphs I&#39;m not able to replicate the same:

`session_streams_y` has same data like `_id`

    LOAD CSV WITH HEADERS FROM &#39;file:///df_temp.csv&#39; AS users
    CREATE (p:Person {nodeId: users._id, sessionId: users.session_streams_y})
    CREATE (sn:Session {sessId: users.sessionField, sessionId: users.session_streams_y})
    
    MATCH (p:Person) 
    with p as ppl
    MATCH (sn:Session) 
    WITH ppl, sn as ss
    WHERE ppl.sessionId=ss.sessionId
    MERGE (ppl)-[:Sessions {sess: &#39;Has Sessions&#39;}]-(ss)
    WITH [ppl,ss] as ns
    CALL apoc.refactor.mergeNodes(ns) YIELD node
    RETURN node

This gives something different

[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/2wGmd.png
  [2]: https://i.stack.imgur.com/nA19z.png",1589479849,https://stackoverflow.com/q/61804397,Jaskaran Singh Puri,"['cypher', 'neo4j']"
61799180,How do I find the maximum value between several specific nodes in neo4j?,"EXAMPLE:  
A unidirectional graph of the following type is given:

    CREATE 
    (b0:Bar {id:1, value: 1}),
    (b1:Bar {id:2, value: 4}),
    (b2:Bar {id:3, value: 3}),
    (b3:Bar {id:4, value: 5}),
    (b4:Bar {id:5, value: 9}),
    (b5:Bar {id:6, value: 7}),
    (b0)-[:NEXT_BAR]-&gt;(b1),
    (b1)-[:NEXT_BAR]-&gt;(b2),
    (b2)-[:NEXT_BAR]-&gt;(b3),
    (b3)-[:NEXT_BAR]-&gt;(b4),
    (b4)-[:NEXT_BAR]-&gt;(b5);

    MATCH (b1)-&gt;[*1..5]-&gt;(b2)-&gt;(b3)-&gt;[*1..5]-&gt;(b4)
    WHERE // here you need to write a condition that the maximum value between the value of nodes b3 and b4 is greater than the maximum value of nodes b1 and b2
    RETURN //b1_b2_max, b3_b4_max

In other words, the result should be as follows:

    b1_b2_max | b3_b4_max
    4         | 9
Can you tell me how I can find aggregated information between certain nodes (including these nodes)?   
What should my request look like?",1589464590,https://stackoverflow.com/q/61799180,Николай,"['neo4j', 'cypher']"
61796464,Multiple match statements in neo4j in a single query which are related to each other,"I have a list of match statement which are related to each other 

    Match(pst:Post) where a.status=&quot;ACTIVE&quot;  
    WITH PST
    MATCH(g: Group {id:pst.parentId}) &lt;-[m:MEMBER]-(u:User {userId:&#39;abc@gmail.com}) ,(b:Business {id:pst.parentId}) 
    where (b.status =&quot;ACTIVE&quot; OR g.status=&quot;ACTIVE&quot;) 
    return n;



There are 3 types of Post , the actual Post, GroupPost (member relationship - who has created post in the group and also a member of that group) and businessPost(HAS-A relationship with business node)
Basically I want to get Post from actual Post node AND Post from group node of which user is member of that group AND  post from the business node. I am clueless what query to form? ",1589456420,https://stackoverflow.com/q/61796464,AJINKYA JAIN,"['cypher', 'neo4j']"
61790675,Facing Syntax Issue in Cypher Query of Neo4j,"I am new to Neo4j Cypher query. So basically i have written a query to fetch the relation count of a sourceType to a Destination type for one of my requirement.
Query looks something like below.

        &quot;MATCH (x:%s) &lt;-[r]- (m:%s) &quot;
        + &quot;WHERE ((NOT (x)&lt;-[:PREDECESSOR]-()) &quot;
        + &quot;AND (NOT (x)-[:PREDECESSOR {action:&#39;DEL&#39;}]-&gt;())) &quot;
        + &quot;AND (NOT (m)-[:PREDECESSOR {action:&#39;DEL&#39;}]-&gt;())) &quot;
        + &quot;RETURN COUNT(m) AS c&quot;;

where the first %s is sourceType and the second one is the destination where i am finding the reference.
But i am getting some weird syntax issue with the below stacktrace.

&gt; ajp-nio-8009-exec-9: ERROR ExceptionHandlerAspect:57 - Un-managed Exception:JobExecution com.cisco.ngfw.onbox.backend.services.DefaultJobExecutionService.create(Class,JobExecution,ServiceParam)
NGUI: 05-14 01:43:40 org.neo4j.ogm.exception.CypherException: Error executing Cypher; Code: Neo.ClientError.Statement.SyntaxError; Description: Invalid input &#39;)&#39;: expected whitespace, &#39;.&#39;, node labels, &#39;[&#39;, &quot;=~&quot;, IN, STARTS, ENDS, CONTAINS, IS, &#39;^&#39;, &#39;*&#39;, &#39;/&#39;, &#39;%&#39;, &#39;+&#39;, &#39;-&#39;, &#39;=&#39;, &quot;&lt;&gt;&quot;, &quot;!=&quot;, &#39;&lt;&#39;, &#39;&gt;&#39;, &quot;&lt;=&quot;, &quot;&gt;=&quot;, AND, XOR, OR, LOAD CSV, START, MATCH, UNWIND, MERGE, CREATE, SET, DELETE, REMOVE, FOREACH, WITH, CALL, RETURN, UNION, &#39;;&#39; or end of input (line 1, column 210 (offset: 209))
NGUI: 05-14 01:43:40 &quot;MATCH (x:Entity:TimeRangeObject:IdEntity:ConfigEntity) &lt;-[r]- (m:AccessRule) WHERE ((NOT (x)&lt;-[:PREDECESSOR]-()) AND (NOT (x)-[:PREDECESSOR {action:&#39;DEL&#39;}]-&gt;())) AND (NOT (m)-[:PREDECESSOR {action:&#39;DEL&#39;}]-&gt;())) RETURN COUNT(m) AS c&quot;

Could anyone please help me to find the syntax issue in the above query.",1589437598,https://stackoverflow.com/q/61790675,Sam,"['neo4j', 'cypher']"
61790623,SCOPE OF VARIABLE IN NEO4J - CYPHER after loading csv file. / alternate code for this pls,"So, IAM A COMPLETE NOOB and ive been struggling wiht this code, i know its a simple thing but nevertheless.

i understand that the scope of the variable changes from WITH to WITH statements, but does it also change with the where statement.? i need to return a node with the respective latitude and longitude.
i cant call the &quot;live&quot; variable as it isnt in scope - or so neo4j desktop says

this is my code

    load csv with headers from &quot;file:///latlong1.csv&quot; as home
    load csv with headers from &quot;file:///latlong2.csv&quot; as live
    WITH point({ latitude:toFloat(home.lath), longitude:toFloat(home.longh)}) AS p1, 
     point({ latitude:toFloat(live.latl), longitude:toFloat(live.longl)}) AS p2
    with toInteger(distance(p1,p2)/1000) AS km
    where km &gt; 5 
    merge (redalert{dist:km, Latitude:live.latl, Longitude:live.longl})
    return redalert

if someone could help me with an alternate modified code, it would be a blessing !

thanks in advance",1589437347,https://stackoverflow.com/q/61790623,Akku Zack,"['neo4j', 'cypher']"
61776420,How to add multiple labels using Neo4jClient,"What&#39;s the best way of setting multiple labels in this CYPHER command?

Setting properties works with substitution but i can&#39;t work out how to set labels (either with or without substitution.)


```
var cypherQuery = _graphClient.Cypher
    .Merge(&quot;(n:Node { Token: {token} })&quot;)
    .OnCreate().Set(&quot;n = {properties}&quot;)
    .OnMatch().Set(&quot;n = {properties}&quot;)
    .WithParams(new
    {
        token = principalMetaNode.Token,
        properties = parameterMap
});
```

(principalMetaNode.Token is a Guid.)",1589377772,https://stackoverflow.com/q/61776420,Richard Urwin,"['.net-core', 'neo4jclient', 'cypher', 'neo4j', 'c#']"
61774749,Delete duplicate relationships with the same value of property saving other relationships with Cypher,"I need to delete duplicate relationships with the same value of property (year) with Cypher where multiple relationships exist between the nodes. With the example, given:

    n1-[r{year:&quot;2019&quot;]-&gt;n2
    n1-[r{year:&quot;2019&quot;]-&gt;n2
    n1-[r{year:&quot;2020&quot;]-&gt;n2

I expect:

    n1-[r{year:&quot;2019&quot;]-&gt;n2
    n1-[r{year:&quot;2020&quot;]-&gt;n2

I don&#39;t need to combine properties to &quot;2019,2020&quot;, want to save multiple relationships with different property (year).

Tried to change these working codes for nodes and relationships for my task:

    MATCH (n1),(n2)
    WHERE n1.name = n2.name and id(n1) &lt; id(n2)
    WITH [n1,n2] as ns
    CALL apoc.refactor.mergeNodes(ns) 
    YIELD node
    RETURN node


    MATCH (n1) -[r]-&gt; (n2) 
    WITH n1,n2, collect(r) as rels 
    CALL apoc.refactor.mergeRelationships(rels) 
    YIELD rel 
    RETURN rel

But I can&#39;t normally write part after WITH

    MATCH (n1) -[r1]-&gt; (n2), (n1) -[r2]-&gt; (n2) 
    WHERE r1.year = r2.year and id(r1) &lt; id(r2)
    WITH #??? collect(?) as rels   
    CALL apoc.refactor.mergeRelationships(rels) 
    YIELD rel 
    RETURN rel",1589373137,https://stackoverflow.com/q/61774749,Nika,"['neo4j', 'cypher']"
61766226,NEO4j: Help manipulating list in RETURN,"I am confused about how collect works when I unwind it. 

I am collecting node properties from various optional matches and ending up with list that has duplicates:

    list=[
      [ID: 1, value: 0],
      [ID: 1, value: 4],
      [ID: 1, value: 90],
      [ID: 2, value: 40],
      [ID: 2, value: 0],
      ...,
    ]

I can&#39;t collect just the nodes - it has to be a list because the values are computed as I collect them.

    UNWIND list AS node
    WITH distinct node

Unwind above does not bring it down to just one row for ID: 1, which I understand because at this point the list items are different and not related to the ID: 1 node anymore.

I&#39;d like to only keep the row with the highest value for each ID. Can this be done on the RETURN?
   Expected result: `[[ID: 1, value: 90], [ID: 2, value: 40]]`

I looked at apoc list and map functions but nothing seems to address this. Is there a reduce or coalesce type thing that would work? 

TIA!",1589342631,https://stackoverflow.com/q/61766226,Stephanie,"['neo4j', 'cypher']"
61757860,How can I sum the properties along the edges in a deep traversal,"I have a part vertex and a used_by edge which a property called quantity. 

I am currently starting with something like the following

```
MATCH (a:part {part_num: &#39;123&#39;)-[u:used_by*]-&gt;(b:part {part_num: &#39;456&#39;)
RETURN [x IN u::jsonb | x.properties.quantity] AS quantities
```

the array comprehension returns an array of quantities. there is one path from a-[*]-&gt;b but there are multiple hops. the u edges returned from the match are for each of the various hop paths and not just the one that connects a to b (longest path).

Once i have the array I need to sum the values in it.

I am not sure if this is possible in agensgraph",1589303734,https://stackoverflow.com/q/61757860,Chad,"['agens-graph', 'cypher']"
61754335,session.run(LOAD CSV) issues,"When using **LOAD CSV** function with ***session.run()*** to execute cypher statements into Neo4J it doesn&#39;t return anything. Have tried removing **LOAD CSV** and it works perfectly fine in creating nodes.

This is the code: 

``` 
import { neo4jgraphql } from &quot;neo4j-graphql-js&quot;;
import fs from &quot;fs&quot;;
import path from &quot;path&quot;;
const {createWriteStream} = require(&quot;fs&quot;);
const {GraphQLUpload} = require(&quot;apollo-server&quot;);
import {session} from &quot;./index.js&quot;

/*
 * Check for GRAPHQL_SCHEMA environment variable to specify schema file
 * fallback to schema.graphql if GRAPHQL_SCHEMA environment variable is not set
 */
const files = [];
export const typeDefs = fs
  .readFileSync(
    process.env.GRAPHQL_SCHEMA || path.join(__dirname, &quot;schema.graphql&quot;)
  )
  .toString(&quot;utf-8&quot;);

export const resolvers = {
//  Upload: GraphQLUpload,
  Query: {
    files: () =&gt; files
  },
  Mutation: {
    uploadFile: async (_, {file}) =&gt; {
      const {createReadStream, filename } = await file;

      await new Promise(res =&gt;
        createReadStream()
          .pipe(createWriteStream(path.join(__dirname, &quot;./uploads&quot;, filename)))
          .on(&quot;close&quot;, res)
        );
        session.run(&quot;LOAD CSV WITH HEADERS FROM &#39;file:///Connections.csv&#39; AS csvLine CREATE(n)&quot;); // This does not work with the LOAD CSV (Works with only CREATE(n))
        return true;
    }
  }
};
",1589293724,https://stackoverflow.com/q/61754335,MrKnudz,"['cypher', 'graphql', 'neo4j', 'load-csv']"
61752569,How to create relationship between two existing nodes by using node id?,"I am trying to create a relationship between two existing nodes. I am reading the node ID&#39;s from a CSV and creating the relationship with the following query:

    LOAD CSV WITH HEADERS FROM &quot;file:///8245.csv&quot; AS f
    MATCH (Ev:Event) where id(Ev) =f.first 
    MATCH (Ev_sec:Event) where id(Ev_sec) = f.second
    WITH Ev, Ev_sec
    MERGE  (Ev) - [:DF_mat] - &gt; (Ev_sec)
However, it is not changing anything the database. How can I solve this problem?

Thanks!",1589288966,https://stackoverflow.com/q/61752569,user13267766,"['cypher', 'neo4j']"
61751321,How to create a merge only if the key exists in json using Cypher in Neo4j,"I am trying to create a node only if the key exists in my json file. However, it is only able to create some nodes but not all

```
call apoc.load.json($url) yield value 
unwind value as q 
merge (report:Report {filename:q.filename})
ON CREATE SET report.title = q.title,
			  report.published_date = q.published_date
             
// HASHES
with report, value
unwind value.hashes as hashes_obj
with report, value, hashes_obj
where hashes_obj.sha1 is not null
merge (hash_sha1: Hash_sha1 {sha1: hashes_obj.sha1}) // I am able to create this node
merge (report)-[:contains]-&gt;(hash_sha1)

// I can&#39;t create this node
with report, value, hashes_obj, hash_sha1
where hashes_obj.md5 is not null
merge (hash_md5: Hash_md5 {md5: hashes_obj.md5})
```

Below is my json file
```
{
...
  &quot;hashes&quot;: [
    {
      &quot;sha1&quot;: &quot;c61b53b85c538dc46254c4f1da7717a29a3b27f3&quot;,
      &quot;file_name&quot;: &quot;jsunpack.je&quot;,
      &quot;is_ssl&quot;: false
    },
  ],
...
}

{
...
&quot;hashes&quot;: [
    {
      &quot;md5&quot;: &quot;a90a329335fa0af64d8394b28e0f86c1&quot;,
      &quot;is_ssl&quot;: false
    },
    {
      &quot;md5&quot;: &quot;07f4b663cc3bcb5899edba9eaf9cf4b5&quot;,
      &quot;is_ssl&quot;: false
    },
    {
      &quot;md5&quot;: &quot;b751323586c5e36d1d644ab42888a100&quot;,
      &quot;is_ssl&quot;: false
    },
    {
      &quot;md5&quot;: &quot;8ad9cb6b948bcf7f9211887e0cf6f02a&quot;,
      &quot;file_name&quot;: &quot;lsass.exe&quot;,
      &quot;is_ssl&quot;: false
    },
    {
      &quot;md5&quot;: &quot;be0cc8411c066eac246097045b73c282&quot;,
      &quot;file_name&quot;: &quot;mshtml.dll&quot;,
      &quot;is_ssl&quot;: false
    }
]
...
}
```

For some reason, I can only create the sha1 node but not the md5 node and I&#39;m not sure why. Please help me out?



",1589285249,https://stackoverflow.com/q/61751321,Lee Sai Mun,"['cypher', 'neo4j']"
61743815,How do I display and execute PHP statements when using Neo4J PHP Client?,"I am trying read/write data in PHP to show Neo4J Graph Databases information. I have followed the steps as shown on (https://github.com/graphaware/neo4j-php-client) and after installing Composer, I have tried to configure the settings but all I see is a blank page when running the PHP file using XAMPP server. 

I need to basically be able to input and send Cypher queries on PHP that will enter into Neo4J Client.
 
What is the solution for this? 
",1589257492,https://stackoverflow.com/q/61743815,Haizam,"['php', 'xampp', 'neo4j', 'cypher', 'configuration']"
61738934,Neo4j - Return a Pseudo relationship from a cypher,"In Neo4j you can return a pseudo node (e.g. `return {Name:&#39;dummy node&#39;}` return a node with property Name) pretty easily. I use this extensively to check the number of nodes created with `Load CSV`.

How do you return a pseudo relationship? I want to see the number of relationship that will be created as a result of my merge query without actually changing the underlying the data. 

I tried multiple ways and all are failing:

 ```
return {Name:&#39;dummy node&#39;}--&gt;{Name:&#39;dummy node2&#39;}`;
Neo.ClientError.Statement.SyntaxError
Invalid input &#39;&gt;&#39;: expected 0..9, &#39;.&#39;, UnsignedHexInteger, UnsignedOctalInteger or UnsignedDecimalInteger (line 1, column 29 (offset: 28))
&quot;return {Name:&#39;dummy node&#39;}--&gt;{Name:&#39;dummy node2&#39;}&quot;
```

```
return ({Name:&#39;dummy node&#39;}--&gt;{Name:&#39;dummy node2&#39;});
Neo.ClientError.Statement.SyntaxError
Invalid input &#39;&gt;&#39;: expected 0..9, &#39;.&#39;, UnsignedHexInteger, UnsignedOctalInteger or UnsignedDecimalInteger (line 1, column 30 (offset: 29))
&quot;return ({Name:&#39;dummy node&#39;}--&gt;{Name:&#39;dummy node2&#39;})&quot;
```

```
return {{Name:&#39;dummy node&#39;}--&gt;{Name:&#39;dummy node2&#39;}};
Neo.ClientError.Statement.SyntaxError
Invalid input &#39;{&#39;: expected whitespace, an identifier, UnsignedDecimalInteger, a property key name or &#39;}&#39; (line 1, column 9 (offset: 8))
&quot;return {{Name:&#39;dummy node&#39;}--&gt;{Name:&#39;dummy node2&#39;}}&quot;
```
",1589229768,https://stackoverflow.com/q/61738934,Adarsha,"['neo4j-browser', 'cypher', 'neo4j']"
61735904,How to write a more efficient import query in Neo4j using APOC,"I have a large DB and when I try to execute my query:

https://textuploader.com/1cduz

It takes more than 4 days to finish.

Can you help me to build a new one that may be using APOC?


",1589219117,https://stackoverflow.com/q/61735904,Alex D.,"['neo4j-apoc', 'cypher', 'neo4j', 'load-csv']"
61708179,Cypher query to match multiple Destination nodes,"I have a requirement where i want to include multiple destination nodes in my path.



[![Sample Graph][1]][1]


My requirement:

I want to find all the suppliers and the RISK associated with the Suppliers for a particular product.

Query to return all suppliers for a Product.

    match path =(p:Product{name:&quot;Product2&quot;}) &lt;-[*..10] -(:Supplier)
    return path

This query returns me all the suppliers for a particular product

[![enter image description here][2]][2]


Query to return suppliers affected by RISK for a product

    match path =(p:Product{name:&quot;Product2&quot;}) &lt;-[*..10] -(:Supplier)-[:AFFECTEDBY]-(:RISK)
    return path

[![enter image description here][3]][3]


  [1]: https://i.stack.imgur.com/R3j2w.png
  [2]: https://i.stack.imgur.com/KlHaL.png
  [3]: https://i.stack.imgur.com/dpkSC.png


As you can see the 2 suppliers (name:&quot;SupplierN+1&quot;) were not retrieved in the above graph

Can you please help me with the query to retrieve BOTH Suppliers (3 suppliers) and RISK associated with for a particular product.

Thanks",1589093130,https://stackoverflow.com/q/61708179,Vicky,"['cypher', 'neo4j']"
61707827,Storing multiple independent trees in Neo4j,"I want to store multiple independent trees(there is no relation between those trees). I think to generate and assign a unique label to every independent tree. Then every query will have a filter using those labels. So if there are 10,000 trees, I would have to generate 10,000 different labels. Is there a better solution like a multi-graph or something else available?",1589090339,https://stackoverflow.com/q/61707827,Sahil Chimnani,"['cypher', 'tree', 'neo4j']"
61697420,Can we use more than 1 row in LOAD CSV(neo4j)?,"LOAD CSV reads row by row and one can do any kind of operation on that row. Is it possible to use more than one row at a time, for example, say I want to assign a relationship where every i&#39;th row is a friend of (i-1)&#39;th row? Or is it possible to store values of previous rows in some local variables while the LOAD CSV is running?",1589030580,https://stackoverflow.com/q/61697420,Sahil Chimnani,"['neo4j', 'load-csv', 'graph', 'cypher', 'csv']"
61694849,Neo4j find path between nodes with multiple hops and same pattern,"i have a neo4j graph that pictures a transportation system.

My nodes are:

 - Stop (like a bus stop)
 - Connection (connection node between 2 stops)

Relationships:

 - `(Stop)-[:HAS]-&gt;(Connection)-[:TO]-&gt;(Stop)`

My problem is that this pattern might repeat multiple times like this:

 - `(Stop)-[:HAS]-&gt;(Connection)-[:TO]-&gt;(Stop)-[:HAS]-&gt;(Connection)-[:TO]-&gt;(Stop)-[:HAS]-&gt;(Connection)-[:TO]-&gt;(Stop)`

I would like to have a cypher query with that i can find a connection between 2 stops even if there are multiple `-[:HAS]-&gt;(Connection)-[:TO]-&gt;` steps between them.

I tried

    MATCH (:Stop)-[:HAS]-&gt;(:Connection)-[:TO]-&gt;(:Stop)
but with this i only get results with only 1 hop. I hope my question is understandable.
Kind regards",1589018194,https://stackoverflow.com/q/61694849,Bennet L.,"['neo4j', 'path', 'cypher']"
61693260,Neo4j cypher - &quot;where edge.property = false&quot; brings also true,"In the picture below, both of the marked edges has a property: verified = **true** the rest of the edges are false.  
In the following query, I&#39;m asking only for verified = **false**.  
n the picture, you can see that true **and** false returned.
  
```
match (a:GraphTarget)-[o:owner_of]-&gt;(b:Account) 
match (b)-[e:friend_of]-&gt;(m:Account)  
where e.verified = false 
return a,o,b,m,e;
```


[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/VMKZk.png

What am I missing?

Thanks",1589009526,https://stackoverflow.com/q/61693260,fatnjazzy,"['cypher', 'neo4j']"
61687455,neo4j Javascript API : create parameter,"I am trying to create a parameter from a Javascript application

But the following code doesn&#39;t work :
```
var input=json_table_definition.replace(/[\n\r]+/g, &#39;&#39;);	
  var session = driver.session();
  let results;
   
  return  session
    .run(&#39;:param jsonTable=&gt;$json_table_definition&#39;,
		{json_table_definition:input}
    )
    .then(result =&gt; {
      session.close();
		
	  
    })
    .catch(error =&gt; {
      session.close();
	  results=[];
      throw error;
    });
```

I get the following error in the browser:
```
XXXXX Uncaught (in promise) Neo4jError: Invalid input &#39;:&#39;: expected &lt;init&gt; (line 1, column 1 (offset: 0))
&quot;:param jsonTable=&gt;$json_table_definition&quot;
 ^ 
```

I double checked the value in the json_table_definition parameter and it&#39;s fine
The same command from the neo4j ",1588969149,https://stackoverflow.com/q/61687455,Bruno C,"['neo4j-driver', 'javascript', 'cypher', 'neo4j']"
61677763,How to get children of a node in redisgraph?,"[This is a directed unweighted graph][1]


  [1]: https://i.stack.imgur.com/qifvX.png

I created this directed unweighted graph in redisgraph but at the time of traversing I am not able to fetch the children of A. Is there any command in redisgraph to get the children of A? Since the graph is fully dynamic, I don&#39;t know the exact nature of children of A. After getting the list of children I can match their property and fetch perfect node.",1588936110,https://stackoverflow.com/q/61677763,Debaditya Mandal,"['cypher', 'directed-graph', 'redisgraph']"
61676214,Search all relationships/Nodes in the path and Filter by a property list Neo4j,"I have 2 questions.

1) How to search all the relationships and filter on property list for PID (ProductID).

2) How to search all the nodes in the Path and filter on property list for PID (ProductID)


[Here is what the graph look like][1]


  [1]: https://i.stack.imgur.com/vs6kY.png




Below query filter the path successfully but I have hard coded the List index to 0

   

     match path= (n1) -[rel*..10] -&gt;(n2) 
    where all(rel in relationships(path)where rel.PID[0]=2)
    return path

1) How to search the all the relationships and filter on list for a PID (ProductID) 

I tried the below query replaced the hard coded index value PID[0] with the loop but it returns me nothing. Please help me understand whats wrong with the query.

    match path= (n1) -[rel*..10] -&gt;(n2) 
    where all(rel in relationships(path)where [x in rel.PID  where x=2])
    return rel


2) How to search the all the nodes in the Path and filter on list for PID (ProductID)

Similarly what will be the query for the nodes. 

Below query runs successfully, but I have hard coded the List index to 0

    match path= (n1:Product) -[rel*..10] -&gt;(n2) 
    where all(r in nodes(path)where  r.PID[0]=1)
    return path

Replaced the hard coded index value PID[0] &amp; it returns me nothing.

    match path= (n1:Product) -[rel*..10] -&gt;(n2) 
    where all(r in nodes(path)where [x in  r.PID where x=1])
    return nodes(path)


Any help will be appreciated.

Thanks



Cypher code for the Graph

        CREATE 
      (`0` :Supplier {name:&quot;Supplier1&quot;}) ,
      (`3` :Airport {name:&quot;Johannesburg&quot;,city:&quot;Johannesburg&quot;,country:&quot;South Africa&quot;,PID:&#39;[1,2]&#39;}) ,
      (`5` :Warehouse {name:&quot;WareHouse1&quot;,PID:&#39;[1,2]&#39;}) ,
      (`8` :Airport {name:&quot;Dusseldorf&quot;,city:&quot;Dusseldorf&quot;,PID:&#39;[1]&#39;}) ,
      (`9` :Airport {name:&quot;Brisbane&quot;,city:&quot;Brisbane&quot;,country:&quot;Australia&quot;,PID:&#39;[1]&#39;}) ,
      (`10` :Airport {name:&quot;Perth&quot;,city:&quot;Perth&quot;,country:&quot;Australia&quot;,PID:&#39;[1,2]&#39;}) ,
      (`11` :Product {name:&quot;Product1&quot;,PID:&#39;[2]&#39;}) ,
      (`12` :Product {name:&quot;Product 2&quot;,PID:&#39;[2]&#39;}) ,
      (`20` :Airport {name:&quot;Frankfurt&quot;,city:&quot;Germany&quot;,country:&quot;Germany&quot;,PID:&#39;[2]&#39;}) ,
      (`9`)-[:`TRANSPORT` {PID:&#39;[1]&#39;}]-&gt;(`10`),
      (`20`)-[:`TRANSPORT` {PID:&#39;[2]&#39;}]-&gt;(`3`),
      (`3`)-[:`TRANSPORT` {PID:&#39;[2]&#39;}]-&gt;(`10`),
      (`5`)-[:`RECEIVES` ]-&gt;(`10`),
      (`12`)-[:`TRANSPORT` {PID:&#39;[2]&#39;}]-&gt;(`20`),
      (`0`)-[:`TRANSPORT` ]-&gt;(`12`),
      (`0`)-[:`TRANSPORT` ]-&gt;(`11`),
      (`11`)-[:`TRANSPORT` {PID:&#39;[2]&#39;}]-&gt;(`8`),
      (`8`)-[:`TRANSPORT` {PID:&#39;[1]&#39;}]-&gt;(`3`),
      (`3`)-[:`TRANSPORT` {PID:&#39;[1]&#39;}]-&gt;(`9`)",1588930768,https://stackoverflow.com/q/61676214,Vicky,"['cypher', 'neo4j']"
61673749,"In what unit does the distance() function return ? i.e meters/feet/inches/kms/miles,etc and, is there inaccuracy in using geoCode in Neo4j","[In what unit does the distance() function return ? i.e meters/feet/inches/kms/miles,etc and, is there inaccuracy in using geoCode in Neo4j][1]


  [1]: https://i.stack.imgur.com/7Omqc.jpg",1588921222,https://stackoverflow.com/q/61673749,manuja,"['cypher', 'geocoding', 'neo4j']"
61664521,Cypher Query: Set Property on relationship based off the aggregate of other Property Relationship,"Still getting my feet wet with cyber.

I have the following situation.
Each `BM_RU` relationship has a `FinCYTD` value.
`n` has multiple `BM_RU` relationships to `ru`. 
I am trying to add or set a `bm` property that is the sum of the `FinCYTD` values on those relationships.

```
match (n:BrickMrtr)-[b:BM_RU]-&gt;(ru:RU)&lt;-[bm:BM_RU_F]-(n)
where n.Id = &#39;1000829&#39;
with n.Id as bm, sum(toInteger(b.FinCYTD)) as sum_f, ru.RuName as nm, bm.Amt as bm_amt
set bm_amt = sum_f
```

i thought the above would work but i get the following error:
```
Type mismatch: expected Map, Node or Relationship but was Integer (line 5, column 14 (offset: 239))
&quot;set bm_amt = sum_f&quot;
              ^
```",1588874138,https://stackoverflow.com/q/61664521,ad281,"['cypher', 'neo4j']"
61663702,neo4j finding all the connections very slow,"I have modeled the following information in neo4j. I have a 100 vertices A1,A2,...A100. Each vertex sends data to 5 other random vertices. 10 different kinds of data is being sent and each is tracked with a link between the vertices. So, for the scenario here, there are A1 has 50 outbound edges with the label `sends-to`. Each of those 5 send all 8 kinds of data to 4 more. These 4 send 8 kind of data to to 3 more. these 3 send 6 kind of data to 2 more. In all there are about 100 vertices and 30000 edges with the label `sends_to` with a difference in properties. When I write the following query to identify if there is a connection between A1 and A94, the query takes forever and eventually failing asking to increase the `dbms.memory.heap.max_size` property.

`MATCH p=(a:Entity{name: &#39;A 0&#39;})-[r:SENDS_TO*..]-&gt;(d:Entity{name: &#39;A 94&#39;})
 RETURN p;`

 I increased it from 1G to 4G but still facing the same problem. I have an index on the name property of the `Entity` node. There may be a cycle in the graph that is causing this.
",1588871444,https://stackoverflow.com/q/61663702,Michael Scott,"['neo4j', 'cypher']"
61663220,Cypher - unlimited path length and large path length queries hang,"I am using Neo4j Community 4.0.4.&lt;br&gt;
I have encountered this issue using the offical Bolt driver for Python, but it is also completely reproducible in the Neo4j browser (version 4.0.7).

I have a very simple graph for now, consisting of the following node and relationship types:

    (:Document)-[:contains]-&gt;(:Block)
    (:Block)&lt;-[:prev]-(:Block)-[:next]-&gt;(:Block)

*There are only 75 nodes in my entire test database for now - 1 Document node and 74 Block nodes.*

Running the following Cypher statement brings the CPU to 100% and the memory utilization rises indefinitely, after which I have to kill the session:

    match (d:Doc{name: &#39;doc name&#39;}) 
    optional match (d)-[*]-(n) 
    return d,n

I also got the Java heap size error at some point.
It only starts to work if I set a strict upper bound on the relationship or specify the direction, e.g.:

    optional match (d)-[*..5]-&gt;(n)

For example, this already does not work (the answer takes forever so I have to kill the session):

    optional match (d)-[*..5]-(n)

Considering that (a) I am doing a strictly local graph traversal that graph databases are supposed to be exceptionally good at, (b) clusters associated with different starting nodes are NOT connected and (c) my test data set is tiny, how can this be happening?&lt;br&gt;

From the symptoms it appears that the engine simply does not keep track of which nodes and relationships were already visited when preparing the results ... or am I missing something?

**UPDATE:**

This was just answered via the Neo4j community forum by a Neo4j staff member:
https://community.neo4j.com/t/getting-paths-of-any-length-or-long-paths-does-not-work/18298

I wrongly assumed that Cypher would just dynamically switch from the path uniqueness traversal to the node uniqueness traversal just because the operation following the match dealt only with nodes and not with relationships.&lt;br&gt;
Poor assumption on my part - not only Cypher doesn&#39;t do it automatically, there is no way AT ALL in core Cypher to drop a path during traversal if all the nodes in the path were aleady visited.

The APOC-based solution was suggested:

    match (d:Doc{name: &#39;doc name&#39;}) 
    CALL apoc.path.subgraphNodes(d, {}) YIELD node as n
    return d, n

In my case I have disconnected sub-graphs that are tens of thousands of nodes each and are relatively dense. This came up when trying to delete a (:Doc) node and everything that&#39;s connected to it before re-loading a new version of the sub-graph into Neo4j:

    disconnect delete d, n

**I see this task of &quot;removing the old version before re-loading&quot; as a very common operational task for sub-graphs that many people may have in their use cases... Installing and managing additional libraries (like APOC or the Graph Data Science library) seems like an overkill for something this simple... But it&#39;s either that or making the deletions more targeted.**",1588869897,https://stackoverflow.com/q/61663220,Gene M,"['neo4j', 'cypher']"
61647772,how to use entity to recive the type of neo4j relationship?,"```
cql1:MATCH(A:SYSTEM{NAME:&#39;HR&#39;})-[R]-(B:SYSTEM{NAME:&#39;ERP&#39;})RETURN  type(R)

cql2:MATCH(A:SYSTEM{NAME:&#39;HR&#39;})-[R]-(B:SYSTEM{NAME:&#39;ERP&#39;})RETURN startNode(R),endNode(R),R

cql3:MATCH(A:SYSTEM{NAME:&#39;HR&#39;})-[R]-(B:SYSTEM{NAME:&#39;ERP&#39;})RETURN startNode(R),endNode(R),R,type(R)
```
cql1：I can package it in List&lt;String&gt; ,and the cq2,I can use a RelationshipEntity to pack;
but cql3,I try to get the type of relationship ,it fail;and said:Unable to find property: type(R);
my entity like that
```
    @Relationship(type = &quot;T_OUT&quot;)
    private OUTBasis outBasis ;//pack  startNode(R),endNode(R),R
    @Property
    private String relationType ;//pack type(R)
```

so，how can i recive the cql3 result by the entity ?",1588811186,https://stackoverflow.com/q/61647772,郭泽强,"['cypher', 'neo4j']"
61642780,How to merge and then sort two lists in Cypher?,"I want to print the books of two authors in order of year published.

**Desired output:**
```
[
  {
     name: &#39;Player Piano&#39;,
     published: 1952,
     author: &#39;Kurt Vonnegut&#39;
  },
  {
     name: &#39;Lolita&#39;,
     published: 1955,
     author: &#39;Vladimir Nobokov&#39;
  },
  {
     name: &#39;Cat&#39;s Cradle&#39;,
     published: 1963,
     author: &#39;Kurt Vonnegut&#39;
  }
]
```

My query looks like this:

```
MATCH(kbook:Book)&lt;-[:WROTE]-(author:Author { name: &#39;Kurt Vonnegut&#39; })

MATCH(nbook:Book)&lt;-[:WROTE]-(author:Author { name: &#39;Vladimir Nobokov&#39; })
WITH kbook, nbook

ORDER BY kbook.published, nbook.published
RETURN collect(kbook) + collect(nbook)
```

**My problem**: if amount of Nobokov&#39;s books is less than that of Kurt&#39;s books, Nobokov&#39;s books will repeat until their amounts are equal (and vice versa)",1588790279,https://stackoverflow.com/q/61642780,Dan,"['neo4j', 'cypher']"
61641296,How do i convert this SQL Query into Neo4j Cypher Query?,"&gt; The SQL Query is as follows :

    SELECT * FROM database.tablename WHERE concat(id, code) IN (&#39;1234PQR&#39;, &#39;4567ABC&#39;)


----------


&gt; The Neo4j Cypher Query which i wanted to Convert is as follows :

    MATCH (n:tablename)
    WITH n.id+n.code AS p
    WHERE p IN [&quot;1234PQR&quot;,&quot;4567ABC&quot;]
    RETURN n

This Returns me an error

    Neo.ClientError.Statement.SyntaxError
    Variable `n` not defined (line 4, column 10 (offset: 160))

***So where am i doing it wrong?*** As per the SQL Query I&#39;m concatenating two columns to get desired values to compare.


----------


Kindly Correct my Cypher Query and if it&#39;s totally wrong give me the right solution. ",1588785684,https://stackoverflow.com/q/61641296,Mohseen Mulla,"['concat', 'sql', 'neo4j', 'cypher', 'syntax-error']"
61638316,Neo4j: Filter by time range + group by + return relevant paths,"I have a database with nodes Persons, Cars and Accidents. I&#39;d like to display the accidents
of the last 3 cars involved in accidents (it must be at least the 2nd accident of the car).

I quite managed to do that but it&#39;s not exactly working as intended, cf questions in the code.

Here is the code to reproduce the example:

    CREATE
      (p1:Person {name: &#39;Paul&#39;})-[:DRIVES]-&gt;(c1:Car {name: &#39;Car A&#39;}),
      (p2:Person {name: &#39;John&#39;})-[:DRIVES]-&gt;(c2:Car {name: &#39;Car B&#39;}),
      (p3:Person {name: &#39;Mike&#39;})-[:DRIVES]-&gt;(c3:Car {name: &#39;Car C&#39;}),
      (p4:Person {name: &#39;Mark&#39;})-[:DRIVES]-&gt;(c4:Car {name: &#39;Car D&#39;}),
      (p5:Person {name: &#39;Eric&#39;})-[:DRIVES]-&gt;(c5:Car {name: &#39;Car E&#39;}),
      (p6:Person {name: &#39;Ross&#39;})-[:DRIVES]-&gt;(c6:Car {name: &#39;Car F&#39;}),
      (p7:Person {name: &#39;Kobe&#39;})-[:DRIVES]-&gt;(c7:Car {name: &#39;Car G&#39;}),
      (c1)-[:IS_DOER]-&gt;(a1: Accident {acc_time: time(&#39;23:15&#39;), acc_date: date(&#39;2020-05-01&#39;)})&lt;-[:IS_VICTIM]-(c2),
      (c1)-[:IS_DOER]-&gt;(a2: Accident {acc_time: time(&#39;02:25&#39;), acc_date: date(&#39;2020-03-18&#39;)})&lt;-[:IS_VICTIM]-(c3),
      (c1)-[:IS_DOER]-&gt;(a3: Accident {acc_time: time(&#39;13:40&#39;), acc_date: date(&#39;2020-04-12&#39;)})&lt;-[:IS_VICTIM]-(c4),
      (c1)-[:IS_DOER]-&gt;(a4: Accident {acc_time: time(&#39;04:00&#39;), acc_date: date(&#39;2020-04-21&#39;)})&lt;-[:IS_VICTIM]-(c5),
      (c2)-[:IS_DOER]-&gt;(a6: Accident {acc_time: time(&#39;04:40&#39;), acc_date: date(&#39;2020-04-12&#39;)})&lt;-[:IS_VICTIM]-(c3),
      (c2)-[:IS_DOER]-&gt;(a7: Accident {acc_time: time(&#39;01:50&#39;), acc_date: date(&#39;2020-05-03&#39;)})&lt;-[:IS_VICTIM]-(c4),
      (c3)-[:IS_DOER]-&gt;(a8: Accident {acc_time: time(&#39;01:20&#39;), acc_date: date(&#39;2020-04-29&#39;)})&lt;-[:IS_VICTIM]-(c5),
      (c6)-[:IS_DOER]-&gt;(a9: Accident {acc_time: time(&#39;01:20&#39;), acc_date: date(&#39;2020-05-04&#39;)})&lt;-[:IS_VICTIM]-(c7),
      (c4)-[:IS_DOER]-&gt;(a10: Accident {acc_time: time(&#39;03:10&#39;), acc_date: date(&#39;2020-05-05&#39;)})&lt;-[:IS_VICTIM]-(c7)
    ;

And my query:

    // What is the query about:
    // condition 1: Count number of accidents that happened during night (range time 23:00-05:00) per car
    // condition 2: Keep cars with at least 2 night accidents
    // condition 3: Among these, return only 3 last cars involved in the accidents, with all 
    //              their accident paths (Person - Car - Accident) 
    WITH [time(&#39;23:00&#39;), time(&#39;05:00&#39;)] as time_range
    UNWIND time_range AS time_val 
    MATCH path = (c:Car)-[]-(a:Accident)
    WHERE CASE WHEN time_range[0] &lt;= time_range[1] THEN time_range[0] &lt;= a.acc_time &lt;= time_range[0]
    		   ELSE a.acc_time &gt;= time_range[0] OR a.acc_time &lt;= time_range[1] END // condition 1 OK
    WITH c, count(distinct a) as cnt_accidents, MAX(a.acc_date) as latest_acc_date_for_car, 
         collect(a) as coll_accidents // how can I use collect in the next match pattern?
    ORDER BY cnt_accidents desc
    LIMIT 3 // condition 3 OK
    WHERE cnt_accidents &gt;= 2 // condition 2 OK. Why the WHERE clause cannot be set before ORDER BY ? Is it optimal?
    MATCH path = (p:Person)-[]-(c:Car)-[]-(a:Accident)
    WHERE a.acc_time &gt;= time(&#39;23:00&#39;) OR a.acc_time &lt;= time(&#39;05:00&#39;) // set condition 1 hardcoded
    // because cannot access time_range at this step. Shouldn&#39;t it be better to use results 
    // from collect to display relevant accidents?
    RETURN path ;

As I would like to store this query in a procedure, I&#39;d like to keep the time_range parameter.

I already saw on SO that it could be possible to use collect in a way similar to what I want, but couldn&#39;t manage : https://stackoverflow.com/questions/33018818/neo4j-match-nodes-related-to-all-nodes-in-collection

Thank you for your help.
",1588776746,https://stackoverflow.com/q/61638316,mbh86,"['neo4j', 'cypher']"
61636782,Neo4j Cypher Commands for Parent -Child Relationship,Parent and Child records are in the same csv file with each child record having a parent id. I have loaded all nodes in Neo4j using Cypher. I am looking for Chyper commands to create parent child relationship. ,1588772678,https://stackoverflow.com/q/61636782,Anil ,"['neo4j', 'cypher']"
61635183,Neo4j: Usage of parameters of type list,"List parameters cannot be indexed in neo4j 4. Whenever you try to take an element from a parameter of type list, this error is thrown:

    Neo.DatabaseError.General.UnknownError
    Did not find any type information for expression ContainerIndex(Parameter(r,Any),SignedDecimalIntegerLiteral(0))

Neo4j Version: 4.0.3

Operating System: Ubuntu 18.04.3 LTS

DB Mode: Causal Cluster

An example query to reproduce the issue is:

    MATCH (user:User)
    WHERE ($range[0] &gt; user.id OR user.id &gt; $range[1])
    return user
    limit 1

`$range` is the parameter in question with an example value `[100, 200]`

This error does not happen in the previous neo4j version 3.5, as we are currently migrating to neo4j 4. It happens in the neo4j browser, and through drivers. I currently use python driver 1.7.6",1588767921,https://stackoverflow.com/q/61635183,Oday Fraiwan,"['cypher', 'neo4j']"
61625904,How can I limit to only one relationship between two nodes in Neo4j?,"I have the following graph:

[![THe Graph][1]][1]



  [1]: https://i.stack.imgur.com/OTTGF.jpg

Currently I am using this QUERY to add a relationship between two nodes:

    MATCH (a:Service),(b:Service)
    WHERE a.service_id = &#39;cs2322&#39; and b.service_id = &#39;ab3232&#39;
    CREATE (a)-[r:DEPENDENT_ON]-&gt;(b)
    RETURN type(r)

However I dont want to have more than one relationship between any two nodes, because I want to visualise my services and the dependency between them, so I cannot have a service being two times dependent on the other.

Is there any way I can limit this to force neo4j server to throw an error if I try to create a relationship between two nodes which already have a relationship per direction with one-another?",1588729177,https://stackoverflow.com/q/61625904,Sero Daniel,"['cypher', 'neo4j']"
61622667,Neo4j Out of Memory Error while deleting duplicate relationships,"I have over 12 million relationship records in my neo4j database. while importing the data by mistake some duplicate relationships were created which I want to delete now. Whenever I executed the following query

```
MATCH (a:person)-[r:IS_A_FRIEND]-&gt;(b:person)
WITH a, b, COLLECT(r) AS rr
WHERE SIZE(rr) &gt; 1
WITH rr
LIMIT 1000
FOREACH (r IN TAIL(rr) | DELETE r)
```

Neo.TransientError.General.OutOfMemoryError error occurs.
I have following neo4j conf 
```
dbms.memory.heap.initial_size=8G
dbms.memory.heap.max_size=16G
```
How can I get rid of this error and delete duplicate relationships",1588711211,https://stackoverflow.com/q/61622667,K.M.J,"['neo4j', 'cypher']"
61620683,Neo4j Group result based on property,"I have some data looks like this:
```
{Name: Peter
Gender: Male
Like: movie, game}
{Name:Ame
Gender: Female
Like:dog, movie, hiking}
{Name: Greg
Gender: Male
Like: hiking}
```
I want to group them by what they like and generate a table like:
```
Like: movie //Peter, Ame
count: 2

like: game //Peter
count: 1

like: dog //Ame
count: 1

like: hiking //Ame, Greg
count: 2
```

How can I query to get this result? Or should I redo the schema?
Something like 
```
MATCH (person:Person) RETURN DISTINCT person.like AS Like, count(person.like) AS Count 
```
This gives me 
```
Like: movie, game
Count: 1

Like: dog, movie, hiking
Count: 1

Like: hiking
Count: 1
```

Thank you for helping. ",1588704401,https://stackoverflow.com/q/61620683,shawn wang,"['neo4j', 'neo4j-apoc', 'cypher']"
61615633,How to auto-import csv content into Neo4j,"We are trying to receive a CSV file from frontend and create nodes from the CSV content. How do we get the neo4J to load the CSV code from javascript automatically when we receive a new CSV-file?

Currently we are thinking something like this to receive the file in frontend:
```
import fileUpload from &quot;express-fileupload&quot;;
app.use(fileUpload());

//Upload endpoint
app.post(&#39;/upload&#39;, (req, res) =&gt; {
  if(req.files === null){
    return res.status(400).json({ msg: &#39;No file uploaded&#39;});
  }
  const file = req.files.file;
  file.mv(${__dirname}/client/public/uploads/${file.name}, err =&gt; {
    if(err){
      console.error();
      return res.status(500).send(err);
    }
    res.json({ fileName: file.name, filePath: `/uploads/${file.name}`});
  })
})
```",1588689315,https://stackoverflow.com/q/61615633,MrKnudz,"['neo4j', 'cypher', 'graphql']"
61615482,Neo4j 4.0 Define APOC custom procedure,"I&#39;m using Neo4j 4.0.3 Community (with Docker), apoc-4.0.0.7-all.jar and have a problem when calling APOC custom procedure.
Here is the code, which works with Neo4j 3.5.17.

Am I missing something in the new version?

    // Create Nodes and relationship
    CREATE (p1:Person {name: &#39;Paul&#39;})-[:DRIVES]-&gt;(c1:Car {name: &#39;Car A&#39;}) ;

    // Define procedure
    CALL apoc.custom.asProcedure(&#39;Test&#39;,
    &quot;WITH { CarName: $CarName } as params
    MATCH (c:Car)
    WHERE c.name = params.CarName
    RETURN c
    ;&quot;, &#39;read&#39;,
    [[&#39;c&#39;,&#39;Node&#39;]], [[&#39;CarName&#39;,&#39;STRING&#39;]],  &#39;Display car node&#39;) ;

    // Call procedure
    CALL custom.Test(&#39;Car A&#39;) ;

The error is the following when calling the procedure:

    Neo.DatabaseError.General.UnknownError
    [Node[1]:org.neo4j.kernel.impl.core.NodeEntity] is not a supported property value

Thank you for your help.",1588688900,https://stackoverflow.com/q/61615482,mbh86,"['neo4j', 'cypher', 'neo4j-apoc']"
61612391,neo4j recursive count of nodes,"In my project I need to count my node size. Node size is amount of connections with other nodes until depth of 2.
Currently I&#39;m able to do so with two queries:
1. Get ids of all nodes with certain labels:

    MATCH (n:Target) RETURN n.Key WHERE &lt;some_where_logic_here&gt;
2. Use returned list of Keys for count

    MATCH (n)-[r *0..2]-(b) WHERE n.Key in {keyList} RETURN n.Key as targetId, count(r) as cnt

This works however I wonder if I can get same results with only one query? (like sub select in SQL)

Thanks",1588679261,https://stackoverflow.com/q/61612391,Evgeny Makarov,"['cypher', 'neo4j']"
61604228,Neo4j Matching Variable number of relationships from previous query,"The code on the [Neo4j docs](https://neo4j.com/docs/cypher-manual/current/clauses/match/#varlength-rels) shows the following for matching against a variable number of relationships.

```
MATCH (charlie { name: &#39;Charlie Sheen&#39; })-[:ACTED_IN*1..3]-(movie:Movie)
RETURN movie.title
```

I am trying to do this based on a previous query using a `WITH` statement but cannot find the right syntax. Everything I try yields an error. I am aiming for something of the form:

```
MATCH p = ...
...
WITH length(p) AS len_p
MATCH (charlie { name: &#39;Charlie Sheen&#39; })-[:ACTED_IN*len_p..len_p]-(movie:Movie)
RETURN movie.title
```

However, this syntax yields `Neo.ClientError.Statement.SyntaxError`.

What is the recommended way to do this?",1588641499,https://stackoverflow.com/q/61604228,themaxgoldman,"['cypher', 'neo4j']"
61598474,Cypher to lookup and order by multiple values,"I have a JSON document with history based entity counts and relationship counts. I want to use this lookup data for entity and relationships in Neo4j. Lookup data has around 3000 rows. For the entity counts I want to display the counts for two entities based on UUID. For relationships, I want to order by two relationship counts (related entities and related mutual entities).

For entities, I have started with the following: 

````
// get JSON doc
with value.aggregations.ent.terms.buckets as data

unwind data as lookup1
unwind data as lookup2

MATCH (e1:Entity)-[r1:RELATED_TO]-(e2)
WHERE e1.uuid = &#39;$entityId&#39;
AND e1.uuid = lookup1.key
AND e2.uuid = lookup2.key
RETURN e1.uuid, lookup1.doc_count, r1.uuid, e2.uuid, lookup2.doc_count
ORDER BY lookup2.doc_count DESC  // just to demonstrate
LIMIT 50
````

I&#39;m noticing that query is taking about 10 seconds. What am I doing wrong and how can I correct it?

Attaching explain plan:

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/FRYDX.png",1588614514,https://stackoverflow.com/q/61598474,Swordfish,"['neo4j', 'cypher']"
61585329,Neo4j cypher query is not working as expected,"I use the default Movie database `movie-graph` and run a simple query like:
```
MATCH
(:Person{name: &#39;Tom Hanks&#39;})-[DIRECTED]-&gt;(m:Movie)
RETURN m
```
The result should be all movies which Tom Hanks directed which is one `That thing you do`, but it returns 12 movies in which Tom Hanks acted too. why is that?  ",1588567441,https://stackoverflow.com/q/61585329,PaleBlossom,"['neo4j', 'graph-databases', 'cypher']"
61576425,Cypher query - only one direction result,"I have the graph at the bottom.  
I want to bring all the connections between `GraphTarget` that the `FriendOf` is **not** b-directional.  
Everything inside the red zone, (max 5 levels of `FriendOf`)  

http://console.neo4j.org/r/pb9mp - a place to play with the query


[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/eySFO.png",1588517330,https://stackoverflow.com/q/61576425,fatnjazzy,['cypher']
61575975,How do I create a link between nodes based on a subnode link in Neo4j,"I have a database with two clusters. There is a hard link between the nodes near the bottom. But when you select just the top nodes, I would like to see that the root nodes are connected somehere.  

[![Extracted picture - Explicit exists, need to generate &quot;generated&quot;][1]][1]




So the links at the bottom are connected but when you select only the top nodes, I would like to show that at some point  (any point) these are connected. 

1) I can find the link to between groups by matching a child connection where the target has different groupid (group id is on every node)
2) I think I then have to run up the tree and find the root node. I can&#39;t seem to make that work. I can see it, but can&#39;t come up with the cypher to do it. It would be a node with no parents. 
3) then link (with a different link ID :peerLink)) from group a to group b. Thats easy enough to do once I have 2

I am having a beast putting them together. I did create a separate field for a list of peerLinks so they didnt confuse my parent logic. So again, the goal is to produce the dashed line based on subnode connection. 

I DON&#39;T Need to show it at the sublevels. They will appear in the UI as an offpage connector 

Anyone done this before ?   


  [1]: https://i.stack.imgur.com/HVslw.png",1588515543,https://stackoverflow.com/q/61575975,billDickens,"['neo4j', 'cypher', 'nodes']"
61570782,Adding a relationship in Cypher if no existing relation regardless the relationship properties,"I&#39;m trying to add a new relationship between two nodes if the relation doesn&#39;t exist.

    Match (p:Partner)-[:HAS_COMMISSIONS]-&gt;(cc:CommissionConfig),
      (gc:GroupConfig)
       where gc.server=&quot;3&quot;
        Merge(cc)-[:BELONGS_TO_ADA_GROUP{aa:100,bb:200}]-&gt;(gc)
this query works and adds a relationship if it&#39;s not existing but if i re-run the same query and changed these values `BELONGS_TO_ADA_GROUP{aa:300,bb:300}` a new relationship will be added because of a new properties to the relationship.
Can we force MERGE to ignore properties? I need to add a relation only if no relation, regardless of relation values.",1588489430,https://stackoverflow.com/q/61570782,Mhd Wael Jazmati,"['neo4j', 'cypher']"
61565247,Neo4j server connect while PC off?,"I&#39;m kinda new on neo4j 
I created a local database and wanted my teammates to connect to it remotely
so we downloaded Hamamchi VPN and connected to local network and all of them now can connect to the database using blot://localhost:port ,however the problem is that they can&#39;t connect to the server when my pc is sleeping since it&#39;s created on my PC.

is there another way to let them connect to my database even when my pc is on sleep mode?",1588448284,https://stackoverflow.com/q/61565247,Malik Zeyad,"['neo4j', 'cypher', 'database', 'graph']"
61555693,"Find the actors who DID NOT act with Hugo Weaving but acted with his co-stars, and SET a property act with value as didnot on those actors","I want to find the actors who DID NOT act with Hugo Weaving but acted with his co-stars, and SET a property act with value as didnot on those actors.

What I have done so far is this:

    Match (p: Person), (other: Person), (m: Movie)
    where (NOT (:Person {name:&#39;Hugo Weaving&#39;})-[:ACTED_IN]-&gt;(m)&lt;-[:ACTED_IN]-(p)) 
    AND  (p)- [:ACTED_IN]-&gt;(m)&lt;-[:ACTED_IN]-(other)
    set other.act = &#39;didnot&#39;
    return distinct other

This gives me the result (top 5 rows).:

    ╒══════════════════════════════╕
    │&quot;other&quot;                       │
    ╞══════════════════════════════╡
    │{&quot;act&quot;:&quot;didnot&quot;,&quot;born&quot;:1964,&quot;n│
    │ame&quot;:&quot;Keanu Reeves&quot;}          │
    ├──────────────────────────────┤
    │{&quot;act&quot;:&quot;didnot&quot;,&quot;born&quot;:1967,&quot;n│
    │ame&quot;:&quot;Carrie-Anne Moss&quot;}      │
    ├──────────────────────────────┤
    │{&quot;act&quot;:&quot;didnot&quot;,&quot;born&quot;:1961,&quot;n│
    │ame&quot;:&quot;Laurence Fishburne&quot;}    │
    ├──────────────────────────────┤
    │{&quot;act&quot;:&quot;didnot&quot;,&quot;born&quot;:1978,&quot;n│
    │ame&quot;:&quot;Emil Eifrem&quot;}           │
    ├──────────────────────────────┤
    │{&quot;act&quot;:&quot;didnot&quot;,&quot;born&quot;:1975,&quot;n│
    │ame&quot;:&quot;Charlize Theron&quot;}       │

The result is incorrect and also the query looks inefficient. What am I doing wrong?
Any insight in right direction is highly appreciated. Thank you.",1588403444,https://stackoverflow.com/q/61555693,Codographer,"['neo4j', 'cypher']"
61531479,"Cypher query to count the number of relationships of specific type that each node has, including same type relationships in their sub-nodes","I have a node hierarchy like following, where nodes c1..c6 are of type :Category, and their sub-nodes i1..i7 are of type :Item. 

[![enter image description here][1]][1]

  [1]: https://i.stack.imgur.com/8bZmB.jpg

What I need to obtain is the number of Items in each Category, including their sub-categories. The output should look like this:

    category	childCount	itemCount
       c1           5	        7
       c2           2	        4
       c3           1	        3
       c4           0	        2
       c5           0	        1
       c6           0	        2

Currently I have a query that returns the correct amount of child nodes, but the number of items is only displayed for each node, not summed up in total. Not sure if I&#39;m missing anything here, or if this is not the right approach? 

It&#39;s important to note that I can&#39;t rely on specifying the starting node myself, as it can change over time inside the db, therefore the query should start with the Category node that does not have a parent.

    MATCH p = (c:Category)-[:IS_PARENT_OF *0..]-&gt;(c)
    WITH c, apoc.text.join(&quot;1&quot; + [rel in relationships(p) | rel.index], &#39;.&#39;) as path, size((:Category)&lt;-[:IS_PARENT_OF*]-(c)) as childCount, size((:Item)-[:IS_CATEGORIZED_AS]-&gt;(c)) as itemCount, c.name AS name
    ORDER BY path
    RETURN name, childCount, itemCount

Output as it is now:

    category	childCount	itemCount
       c1           5	        0
       c2           2	        1
       c3           1	        1
       c4           0	        2
       c5           0	        1
       c6           0	        2",1588275851,https://stackoverflow.com/q/61531479,RollerMobster,"['match', 'cypher', 'count', 'neo4j', 'neo4j-apoc']"
61530419,query with regex in neo4j doesn&#39;t return the correct result,"I&#39;m tring to execute this query without succes

```
MATCH (t:Tweet)
WHERE  
    t.full_text =~ &#39;(?i).*sciacalli.*&#39;  AND
    t.created_at&gt;&#39;2018/01/01&#39; AND t.created_at&lt;&#39;2020/04/25&#39;
RETURN t
```
The output shuld be this one

```
&quot;full_text&quot;: &quot;RT @catlatorre: Sciacalli.\n
                  Comunque vada sempre sciacalli 
                  siete #KobeBryant https://t.co/*********&quot;,
&quot;created_at&quot;: &quot;2020/01/26 22:49:51&quot;,
```
I don&#39;t understand way the regex not match 

But if modify the query as follow

```
MATCH (t:Tweet)
WHERE  
    t.full_text CONTAINS &#39;sciacalli&#39;  AND
    t.created_at&gt;&#39;2018/01/01&#39; AND t.created_at&lt;&#39;2020/04/25&#39;
RETURN t
```
I get the correct result. What&#39;s wrong ?",1588271683,https://stackoverflow.com/q/61530419,Lx2pwn,"['neo4j', 'cypher']"
61526770,Percentage categorization in Neo4j,"
I wrote code that shows the percentage of customer costs. I would like to divide buyers into categories depending on this percentage. For example, if the percentage is &lt;50, then the client belongs to category A (I need a column in which this would be written). How can i implement this?  

      MATCH  (c:Customer)-[b:BUY]-&gt;(p:Product)
          WITH SUM(b.count*p.unit_price) As total
          MATCH (c:Customer)-[b:BUY]-&gt;(p:Product)
        RETURN c.name AS Customer, 
               100.0 * SUM(b.count*p.unit_price) / total AS percent 
        ORDER BY percent DESC

[Neo4j][1]


  [1]: https://i.stack.imgur.com/xQ8nc.png",1588259588,https://stackoverflow.com/q/61526770,Ana7,"['neo4j', 'cypher']"
61524271,Import csv into Neo4j where multiple columns have empty cells,"I am looking to import a csv where records in columns have null values (empty). There is a chance that any column could have an empty record, so ultimately the query should be able to handle any column. Here is an example of my table with and example of the expected graph output:


    Group       Capability      Functionality   Status        Dev    Input         Output  
    Pipeline    DataIngest      Read CSV        Complete      Ben    source.csv    masterTable
    Pipeline    DataQuality     Quality score   Complete             masterTable
    Analytics   Summary         Minimum score   In progress   Jill   masterTable   dataSummary  
    Analytics   Summary         Maximum score   In progress          masterTable   dataSummary 
    Analytics   Prediction      Future score                  
    Output      Report          Bar chart       Not started   Ben    dataSummary
    Output      Report          Line chart      Not started   Fred

[![Expected graph][1]][1]


The following is what I have tried, which does not produce that I was expecting. The query produces the following issues:

 1. Functionality is not its own labelled node (it is part of capability)
 2. Properties are not stored within Functionality (this may be because of issue 1)

    

&gt;     CREATE CONSTRAINT ON (g:Group) ASSERT g.name is UNIQUE;
&gt;     CREATE CONSTRAINT ON (c:Capability) ASSERT c.name is UNIQUE;
&gt;     CREATE CONSTRAINT ON (f:Functionality) ASSERT f.name is UNIQUE;
&gt;     LOAD CSV WITH HEADERS FROM &#39;file:///MasterSheet.csv&#39; AS line
&gt; 
&gt;     WITH line
&gt;     MERGE (g:Group {name: line.Group})
&gt;     MERGE (c:Capability {name: line.Capability})
&gt;     FOREACH(x IN CASE WHEN line.DevStage IS NULL THEN [] ELSE [1] END |
&gt; 	    MERGE (f:Functionality {name: line.Functionality, status: line.Status, developer: line.Dev}))
&gt;     MERGE (i:Data {name: line.Input})
&gt;     MERGE (o:Data {name: line.Output})
&gt; 
&gt;     CREATE UNIQUE (g)-[:PART_OF]-&gt;(c)
&gt;     CREATE UNIQUE (c)-[:HAS]-&gt;(f)
&gt;     CREATE UNIQUE (f)-[:INPUT]-&gt;(i)
&gt;     CREATE UNIQUE (f)-[:OUTPUT]-&gt;(o)


  [1]: https://i.stack.imgur.com/7LhoJ.png",1588252465,https://stackoverflow.com/q/61524271,Ryan Garnett,"['cypher', 'neo4j', 'csv']"
61519481,Cypher query for list pattern,"I have a schema which looks like below:

1. A `customer` is linked to another `customer` with a relationship `SIMILAR` having `similarity score`.

   Example: `(c1:Customer)--&gt;(c2:Customer)`

2. An `Email` node is connected to each `customer` with relationship `MAIL_AT` with the following node properties:
 ```
  {
      &quot;active_email_address&quot;: &quot;a@mail.com&quot;,
      &quot;cibil_email_addresses&quot;: [
          &quot;b@mail.com&quot;, &quot;c@mail.com&quot;
      ]
  }
 ```
 Example: `(e1:Email)&lt;-[:MAIL_AT]-(c1:Customer)-[:SIMILAR]-&gt;(c2:Customer)-[:MAIL_AT]-&gt;(e2:Email)`

3. A `Risk` node with some risk-related properties (below) and is related to `customer` with relationship `HAS_RISK`:
 ```
   {
     &quot;f0_score&quot;: 870.0,
     &quot;pta_score&quot;: 430.0
   }
 ```
4. A `Fraud` node with some fraud-related properties (below) and is related to `customer` with relationship `IS_FRAUD`:
 ```
   {
     &quot;has_commited_fraud&quot;: true
   }
 ```

**My Objectives**:

1. To find the customers with common email addresses (irrespective of active and secondary)?

**My tentative solution:**
```
MATCH (email:Email)
WITH email.cibil_email_addresses + email.active_email_address AS emailAddress, email
UNWIND emailAddress AS eaddr
WITH DISTINCT eaddr AS deaddr, email
UNWIND deaddr AS eaddress
MATCH (customer:Customer)-[]-&gt;(someEmail:Email)
WHERE eaddress IN someEmail.cibil_email_addresses + someEmail.active_email_address
WITH eaddress, COLLECT(customer.customer_id) AS customers
RETURN eaddress, customers
```
**Problem:** It is taking forever to execute this. Working with lists will take time I understand, however, I&#39;m flexible to change the schema (If suggested). Should I break the email address into separate nodes? If yes, then how do I break `cibil_email_addresses` into different nodes as they can vary - *Should I create two nodes with different `cibil email addresses` and connect both of them to customer with relationship `HAS_CIBIL_EMAIL`? (Is this a valid schema design)*. Also, it is possible, a customer&#39;s `active_email_address` is present in other customer&#39;s `cibil_email_address`. I&#39;m trying to find a synthetic identity attack. PS: If there exists some `APOC` that can help achieve this and below, do suggest with example.

 2. In production, for a given customer with `email addresses`, `risk values`, `similarity score`, and also given other customers may or may not be tagged with `fraud_status`, I want to check whether this new person will fall in a fraud ring or not. PS: If I need to use any `gds` to solve this, please suggest with examples.

 3. If I were to do this same exercise with some other node such as `Address` which may be partially matching and will be having same list of historical addresses in a list, what should be my ideal approach? 


I know, I&#39;m tagging someone in my question, but that person only seems to be active with respect to Cypher on StackOverflow. **@cybersam** any help?
Thanks.",1588236746,https://stackoverflow.com/q/61519481,Asif Ali,"['cypher', 'neo4j-apoc', 'neo4j']"
61511797,Return nodes with and without a relation,"Hi I&#39;m very new to Cypher Syntax and need some help!

I want to write a query that return all &quot;a&quot; with relation to &quot;b&quot; and all &quot;a&quot; that doesn&#39;t have a relation with &quot;b&quot; so I can return every &quot;a&quot; and only &quot;b&quot; with relation to &quot;a&quot;.

What I want to do 

     match (a:TypeA)-[r]-&gt;(b:TypeB) 
     match (a:TypeA) 
     return a, b

What I don&#39;t want to do 

     match (a1:TypeA)-[r]-&gt;(b:TypeB) 
     match (a2:TypeA)
     return a1, a2, b
 
Is there a way to do this or is my only option to go for the second query?
",1588194745,https://stackoverflow.com/q/61511797,WLUB,"['neo4j', 'cypher']"
61487737,Neo4j query combining data from Elasticsearch for time based graph,"Neo4j and Cypher gurus, 

I am using Neo4j, Elasticsearch and Spring Data Neo4j. I have entity nodes which are related to each other. On the relationship there is a count field which is the total number of relationships between two entities. I am using the following Cypher to bring back the top 50 relationships for a entity:

````
MATCH (e1:Entity)-[r1:RELATED_TO]-(e2:Entity)
WHERE e1.uuid = &#39;&lt;ENTITY_ID&gt;&#39;
RETURN e1,r1,e2
ORDER BY r1.count DESC
LIMIT 50
````

Now what I would like to do is visualise a time based graph for the entity by bringing back the top 50 relationships for the last week (last month etc). I am not storing time series data in Neo4j, only the total count for the relationship. The time series data is stored in an Elasticsearch index with the following format.

````Date, entityOrRelationshipId, startId, endId, type````
 
Each time a relationship is updated, a row is inserted into the index with the datetime, relationshipId and entityId.

The relationship count can be searched and aggregated using the following Elasticsearch query:

````
GET localhost:9200/trends/_search

{
    &quot;size&quot;: 0,
    &quot;query&quot;: {
        &quot;bool&quot;: {
            &quot;must&quot;: [
                {
                    &quot;term&quot;: {
                        &quot;type&quot;: &quot;RELATIONSHIP&quot;
                    }
                },
                {
                    &quot;range&quot;: {
                        &quot;date&quot;: {
                            &quot;gte&quot;: &quot;2020-04-01T00:00:00.000+00:00&quot;,
                            &quot;lt&quot;: &quot;2020-04-28T00:00:00.000+00:00&quot;
                        }
                    }
                },
                {
                    &quot;bool&quot;: {
                        &quot;should&quot;: [
                            { &quot;term&quot;: { &quot;startId&quot;: &quot;&lt;ENTITY_ID&gt;&quot;} },
                            { &quot;term&quot;: { &quot;endId&quot;: &quot;&lt;ENTITY_ID&gt;&quot; } }
                        ]
                    }
                }
            ]
        }
    },
    &quot;aggs&quot;: {
        &quot;my_rels&quot;: {
            &quot;terms&quot;: {
                &quot;field&quot;: &quot;entityOrRelationshipId&quot;,
                &quot;size&quot;: 50
            }
        }
    }
} 
````

This produces the following results with counts (doc_count) for each relationship id for a certain date range:

````
{
    &quot;took&quot;: 5,
    &quot;timed_out&quot;: false,
    &quot;_shards&quot;: {
        &quot;total&quot;: 5,
        &quot;successful&quot;: 5,
        &quot;skipped&quot;: 0,
        &quot;failed&quot;: 0
    },
    &quot;hits&quot;: {
        &quot;total&quot;: 2273,
        &quot;max_score&quot;: 0.0,
        &quot;hits&quot;: []
    },
    &quot;aggregations&quot;: {
        &quot;my_rels&quot;: {
            &quot;doc_count_error_upper_bound&quot;: 0,
            &quot;sum_other_doc_count&quot;: 145,
            &quot;buckets&quot;: [
                {
                    &quot;key&quot;: &quot;2fa94be4-828b-4a20-b5f8-4965d5516149&quot;,
                    &quot;doc_count&quot;: 303
                },
                {
                    &quot;key&quot;: &quot;74fb5f46-a6e8-41a8-bd11-cb374324b285&quot;,
                    &quot;doc_count&quot;: 197
                },
                {
                    &quot;key&quot;: &quot;dc57fdcf-ea88-4808-9310-4e09d368e743&quot;,
                    &quot;doc_count&quot;: 178
                },
                {
                    &quot;key&quot;: &quot;c4fbda1f-717e-4422-bc10-66ca6a6f39d7&quot;,
                    &quot;doc_count&quot;: 79
                },
                etc.
              
            ]
        }
    }
}
````

Using the Neo4J APOC library, how would I combine the Elasticsearch count results into my Cypher query without having to store the count values in Neo4J?

Any help would be much appreciated.",1588099781,https://stackoverflow.com/q/61487737,Swordfish,"['neo4j-apoc', 'cypher', 'neo4j']"
61485313,Cypher sorting by number of related nodes?,"I&#39;m learning Cypher and I created a &quot;Criminal investigation&quot; project on `Neo4j`.

I&#39;m trying to run a query that outputs each `Person` that has **two** children (`Person`) and both of the children must have committed a crime. To achieve this, I was testing some queries with a `Person` (`p`) called `p.name = &quot;Lillian&quot;` so I know this person has two children but just one of them has committed a crime.

In order to make this I execute this query (return something if Lillian has two sons that committed crimes or return nothing contrarily:

    match (p:Person)-[r:FAMILY_REL]-&gt;(s:Person)
    where p.name = &quot;Lillian&quot; 
    and size((p)-[:FAMILY_REL]-&gt;()-[:PARTY_TO]-&gt;(:Crime))=2 and size((p)-[:FAMILY_REL]-&gt;()) = 2
    return p, s

As I already knew Lillian has only one son who committed a crime, the query should have not returned anything but it returned both of their children.

I&#39;m guessing the wrong part of the query is here:

    where /*...*/ and size((p)-[:FAMILY_REL]-&gt;()-[:PARTY_TO]-&gt;(:Crime))=2

I think this is counting just the number of children instead the number of children who have committed crimes.

What would be the correct way to do this?",1588091815,https://stackoverflow.com/q/61485313,user157629,"['cypher', 'neo4j']"
61467163,What is missing in this Cypher query?,"I&#39;m learning Cypher and I created a &#39;Crime investigation&#39; project on `Neo4j`.

I&#39;m trying to return as an output the parent that only has **two** sons/daughters in total and each member of the family must have committed a crime.
So, in order to get this in the graph, I executed this query:

    match(:Crime)&lt;-[:PARTY_TO]-(p:Person)-[:FAMILY_REL]-&gt;(s:Person)-[:PARTY_TO]-&gt;(:Crime)
    where size((p)-[:FAMILY_REL]-&gt;())=2
    return p, s

`FAMILY_REL` relation shows the sons the `Person` (`p`) and `PARTY_TO` relation shows the `Crime` nodes a `Person` have committed.

The previous query it&#39;s not working as it should. It shows parents with more than two sons and also sons that have just one son.

What is wrong with the logic of the query?",1588016616,https://stackoverflow.com/q/61467163,user157629,"['cypher', 'neo4j']"
61461603,Best practice to match nodes,"I&#39;m doing some tests on redisgraph and I&#39;m wondering what is the best practice to match nodes if I have a hierarchy like this: &lt;br&gt; 
category =&gt; post =&gt; comment =&gt; reply &lt;br&gt; 
I have index on each label _id field and I match according to the _id&lt;br&gt; 
First approach: by matching all the way to the target node:  

    GRAPH.QUERY test &quot;MATCH (:category {_id:1})-[:post]-&gt;(:post {_id:1})-[comment_rel_1:comment]-&gt;(c1:comment {_id:1}) SET c1.comment = &#39;changed&#39;&quot;
Second approach: matching the node directly

    GRAPH.QUERY test &quot;MATCH (c1:comment {_id:1}) SET c1.comment = &#39;changed&#39;&quot;
In case of a huge database with a lot of nodes and edges what approach considered to be time efficient?
&lt;br&gt;Thanks ",1587998925,https://stackoverflow.com/q/61461603,Rawhi ,"['matching', 'cypher', 'redisgraph', 'performance']"
61453494,Cypher sort by amount of same relationship?,"How can I `match` using Cypher by any relation amount? For example, in a database there are `Person`. If this person has any son, they will be related by the relation `[:SON]`.

This query will return each `Person` that has a son:

    match (p:Person)-[:SON]-&gt;(:Person)
    return p

Knowing this, how can I `match` the number of `Person` that **only has 2 sons**?

",1587971789,https://stackoverflow.com/q/61453494,user157629,"['neo4j', 'cypher']"
61449487,I am using NEO4J apoc.refactor.setType to change the rel type of a relationship with no luck,"    I am trying to change the rel type of a relationship as outlined below and getting the following error:
    Neo.ClientError.Statement.SyntaxError: Procedure call inside a query does not support naming results implicitly (name explicitly using `YIELD` instead) (line 4, column 22 (offset: 224))
    &quot;                     call apoc.refactor.setType(r, &#39;OWNED&#39;)&quot;

If adding YIELD is the answer I am not sure what to YIELD ?? 

    MATCH (user:Owner {email: &quot;xyz@mymail.com&quot;})-[r:OWNS]-&gt;(v:Vehicles {name:&quot;Chevy&quot;})
                             WHERE r.model = &quot;Silverado&quot; OR NOT EXISTS(r.model)
                             WITH r,user,v
                             call apoc.refactor.setType(r, &#39;OWNED&#39;)
                             YIELD ?????
                            RETURN user,r,v",1587943842,https://stackoverflow.com/q/61449487,MichaelE,"['neo4j-apoc', 'cypher', 'neo4j']"
61448459,How to send out a collection of nodes via neo4j-stream to kafka,"We want to use Neo4J to build a hierarchy (tree-structure) of (product) categories. Our data enters from a Kafka (Sink Connector). We plan to use Neo4J Streams Source to live stream the updates on our category-tree back onto Kafka, using neo4j-4.0.3.

Normally, the - Streams Source - way to go is to specify a pattern and link it to a Kafka topic, as explained here: https://neo4j.com/docs/labs/neo4j-streams/current/#neo4j_streams_source 

In order to leverage the power of Neo4J we&#39;d like to send a collection of nodes *each time at once*. This collection consists of all the nodes on a - query that returns a - path: `nodes(path)`. More specifically, such a collection of nodes represents a path from leaf to root.

Two non-working alternatives we could think of:

 1. **Use a pattern definition.** From what I understand a pattern seems to be limited to match a single node only (possibly a node with multiple Labels) - https://neo4j.com/docs/labs/neo4j-streams/current/#source-patterns - and hence we can only stream out *one node at a time*.
 2. **Stream the collection of nodes** (on the path) back **into a node** with a different label, and use that output node label to pattern match {*}. Neo4J being a property oriented graph database, it does not allow me to write &#39;a collection of nodes&#39; into one node.

To summarize, what we want is to stream out a collection of nodes into each Kafka record.
**Any suggestions on how we can achieve this?**
",1587937104,https://stackoverflow.com/q/61448459,LeonardoBonacci,"['neo4j', 'cypher', 'apache-kafka', 'stream']"
61446845,Neo4j Filter function is no longer supported,"I want to compare two lists in order to find the values in the first list which are not in the second and return them. thanks in advance guys 
the code returns:  Filter is no longer supported 
is there any alternative way to do this 

```
MATCH (cu:Customer{name: &quot;myCustomer&quot;})-[pu:PURCHASED]-&gt;(o:Order)-[*]-&gt;(cat:Category)
MATCH (b:Book)-[:IS_a]-&gt;(cat)
WITH COLLECT(DISTINCT pu.ISBN) AS purchasedbooks,COLLECT(DISTINCT b.ISBN) AS booksFromTheSameCategory
RETURN FILTER( n IN booksFromTheSameCategory WHERE NOT n IN purchasedbooks ) as listC
```


",1587929429,https://stackoverflow.com/q/61446845,Fadi,"['cypher', 'filter', 'neo4j']"
61438851,Neo4j - Neo4jClient - Deserialize from Cypher Results,"I have a basic Neo4j DB and I&#39;m getting my head around getting data from it into C# under .Net Core. I am using the bolt connection on a 4.03 DB. Windows 10. I may have not grasped Graph Databases yet, but I am trying to build a Person object containing Positions which contain Skill and then Ranks

This code returns 6 instances of Person (A slight concern that I have 6 but thats a minor problem)

 ```C#
var cv = client.Cypher.Match(&quot;(person:Person {UserNumber:5})-[:HAS]-&gt;(position:Position)&lt;-[:WITHIN]-(skill:Skill)&lt;-[:ON]-(rank:Rank)&quot;)
            .Return(person =&gt; person.As&lt;Person&gt;());
```
The Person class
```C#
	public class Person
    {
        public Person() {
            RankingProfile = new List&lt;decimal&gt;();
            EmailConfirmed = false;
        }
		…lots of variables (dates, string decimals, boolean)
		public List&lt;decimal&gt; RankingProfile { get; set; }
    }
```
Changing the result format to try and build the composite object but starting with just Person (Have added .Results to get the exception) I get a  Type initializer was not callable. Exception.

```C#
var cv = client.Cypher.Match(&quot;(person:Person {UserNumber:5})-[:HAS]-&gt;(position:Position)&lt;-[:WITHIN]-(skill:Skill)&lt;-[:ON]-(rank:Rank)&quot;)
            .Return(person =&gt; new {
                Person = person.As&lt;Person&gt;()
            }).Results;
```
Gives me the exception below. Diggining into the exception implied I needed a parameterless constructor which I added.  Bit lost now. 
```C#
  System.Reflection.TargetInvocationException
  HResult=0x80131604
  Message=Exception has been thrown by the target of an invocation.
  Source=Neo4jClient
  StackTrace:
   at Neo4jClient.BoltGraphClient.Neo4jClient.IRawGraphClient.ExecuteGetCypherResults[TResult](CypherQuery query)
   at Neo4jClient.Cypher.CypherFluentQuery`1.get_Results()
   at SonOFMatrix.Controllers.CVController.Get() in C:\Users\Controllers\CVController.cs:line 29
   at Microsoft.Extensions.Internal.ObjectMethodExecutor.Execute(Object target, Object[] parameters)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()

  This exception was originally thrown at this call stack:
    [External Code]

	Inner Exception 1:
	MemberAccessException: Type initializer was not callable.
		StackTrace	&quot;   
		at System.Reflection.RuntimeConstructorInfo.ThrowNoInvokeException()
		at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
		at System.Reflection.ConstructorInfo.Invoke(Object[] parameters) 
		at Neo4jClient.StatementResultHelper.ConstructNew[T]()  
at Neo4jClient.StatementResultHelper.Parse[T](IRecord record, String identifier, IGraphClient graphClient)&quot;	string
```
",1587895065,https://stackoverflow.com/q/61438851,TimH,"['c#', 'cypher', 'neo4jclient']"
61413985,How to use algorithms in neo4j 4.x.x,I need to use a specific new feature in 4.x.x. However most of the algorithm plugins are not supported. What&#39;s the alternative when using this version for a database? Currently I&#39;m interested in the ability to find the shortest path between two nodes in 4.x.x,1587749082,https://stackoverflow.com/q/61413985,Deeswoc,"['cypher', 'neo4j']"
61413144,Why this neo4j cypher query fails to rewrite?,"I&#39;m trying to submit this query to my neo4j-community database:

    MATCH (n1:Hashtag{name:&#39;animal&#39;})
    CALL apoc.path.subgraphNodes(n1,{}) YIELD node
    WHERE node.postsCount &gt; 1000 AND node.postsCount &lt; 200000
    RETURN node LIMIT 50

Neo4j Browser returns this error message:

**ERROR Neo.DatabaseError.General.UnknownError**

        Failed rewriting AndedPropertyInequalities(Variable(node),CachedProperty(node,Variable(node),PropertyKeyName(postsCount),NODE_TYPE),LessThan(CachedProperty(node,Variable(node),PropertyKeyName(postsCount),NODE_TYPE),ParameterFromSlot(0,  AUTOINT2,Integer)), GreaterThan(CachedProperty(node,Variable(node),PropertyKeyName(postsCount),NODE_TYPE),ParameterFromSlot(1,  AUTOINT1,Integer)))
    Tried using children: ReferenceFromSlot(0,node),NullCheckReference(0,SlottedCachedPropertyWithPropertyToken(node,PropertyKeyName(postsCount),0,false,1,1,NODE_TYPE,true)),LessThan(NullCheckReference(0,SlottedCachedPropertyWithPropertyToken(node,PropertyKeyName(postsCount),0,false,1,1,NODE_TYPE,true)),ParameterFromSlot(0,  AUTOINT2,Integer)), GreaterThan(NullCheckReference(0,SlottedCachedPropertyWithPropertyToken(node,PropertyKeyName(postsCount),0,false,1,1,NODE_TYPE,true)),ParameterFromSlot(1,  AUTOINT1,Integer))

I&#39;ve tryied another similar query:

    MATCH (n1:Hashtag{name:&#39;animal&#39;})
    CALL apoc.path.subgraphNodes(n1,{}) YIELD node
    WHERE node.postsCount &gt; 1000
    WITH node
    WHERE node.postsCount &lt; 200000
    RETURN node LIMIT 50

With the same result. 
Could someone help me? Thank you!",1587746198,https://stackoverflow.com/q/61413144,Simone Trombiero,"['cypher', 'neo4j', 'neo4j-apoc']"
69273945,How to take a subgraph of a certain depth starting from a certain vertex in Neo4j,"I need to take subgraph of given depth stating from some vertex using bfs. I&#39;ve tried code similar to following 
```cypher
MATCH (p:Node {id: &#39;1&#39;}) CALL apoc.path.subgraphAll(p, {minLevel: 0, maxLevel: 1}) YIELD nodes, relationships RETURN nodes, relationships;
```
but it seems to be extremely slow comparing to cypher queries (neo4j 4.3.3) What is the best way to take subgraphs with bfs in neo4j?",1632249176,https://stackoverflow.com/q/69273945,schernichkin,"['subgraph', 'neo4j']"
69272255,Return &#39;biggest fan of a tag&#39; neo4j,"I want to match blogs that have most like interaction with certain tags (in the example I used dog) but posted in it less than 10 times.

How can I achieve that?

Currently, I get this error message

```
Invalid use of aggregating function count(...) in this context (line 6, column 7 (offset: 210))
&quot;WHERE COUNT(posted) &lt; 10&quot;
``` 
# Query
```
MATCH (b:Blog)-[r:liked]-(p:Post)-[:tagged]-(t:Tag)
WHERE t.content = &quot;dog&quot;
WITH b, COUNT(r) as interaction_count

MATCH (b:Blog)-[posted:posted_by]-(:Post)-[:tagged]-(t:Tag)
WHERE COUNT(posted) &lt; 10

RETURN b, interaction_count
ORDER BY interaction_count DESC
LIMIT 10
```",1632241098,https://stackoverflow.com/q/69272255,Damian Grzanka,"['cypher', 'neo4j-apoc', 'graph-databases', 'graph', 'neo4j']"
69266827,How to simplify neo4j query with multiple CASE&#39;s,"We use the following cypher query in our project (just the relevant part, there&#39;s a bunch of MATCH and WHERE before this):

    &quot;RETURN entry.id AS id,\n&quot; +
        ...
        &quot;       CASE WHEN ljCase1 IS NOT NULL THEN {id: ljCase1.id, guide: false} \n&quot; +
        &quot;           ELSE CASE WHEN ljCase2 IS NOT NULL THEN {id: ljCase2.id, guide: true}\n&quot; +
        &quot;              ELSE CASE WHEN ljCase3 IS NOT NULL THEN {id: ljCase3.id, guide: true} END\n&quot; +
        &quot;         END\n&quot; +
        &quot;       END AS learningJourney\n&quot; +
    ...

It works properly but I feel like this isn&#39;t done as clean as it could be.
Is there a way to simplify this part of the query?",1632217856,https://stackoverflow.com/q/69266827,sandrooco,"['neo4j', 'database', 'cypher']"
69265281,Neo4J + GraphQL + React (Grandstack) vs NEO4J + Spring Boot + React,"I need to create a search application (searching for recipes by ingredients) that uses the neo4j database. My main question is what is easier or what I can learn faster. 

I have some experience with Spring MVC. When I was looking for some tutorials, I found them on the grandstack option, but what do you think is better for me and what are the main differences, please? 

Thank you very much.",1632210873,https://stackoverflow.com/q/69265281,Bobis,"['grandstack', 'spring-boot', 'neo4j']"
69263259,Returning same path after &quot;count&quot; operation in Neo4J,"I have a Neo4j database of people, the banks they&#39;ve visited, the transactions they&#39;ve made and the businesses they&#39;ve paid through the bank. The path goes generally like this:

```
(:person)-[:VISITED]-&gt;(:bank)-[:MADE]-&gt;(:payment)-[:TO]-&gt;(:business)
```

I want to find all paths where the same person made payments to the same business via different banks. I don&#39;t care how many different payments they make at each bank, nor am I looking at any fixed person or business in particular. The cypher syntax that I&#39;ve used for this is as follows:

```
MATCH (pe:person)-[:VISITED]-&gt;(ba:bank)-[:MADE]-&gt;(pa:payment)-[:TO]-&gt;(bu:business)
WHERE condition1
AND condition2
AND condition3
WITH pe, bu, COUNT(DISTINCT ba) as banks
WHERE banks &gt; 1
MATCH p=(pe)-[:VISITED]-&gt;(:bank)-[:MADE]-&gt;(:payment)-[:TO]-&gt;(bu)
WHERE condition1
AND condition2
AND condition3
RETURN p
```
Now, you may realise that I&#39;m actually running the same query twice here. That&#39;s because in order to do my COUNT(DISTINCT ba) properly, I had to do it &quot;WITH pe, bu&quot;, thus throwing away the query that I&#39;d made beforehand. As such, this makes my query twice as slow and inefficient.

Is there a more elegant alternative to my syntax to achieve the same outcome?",1632197246,https://stackoverflow.com/q/69263259,wanderingcatto,"['cypher', 'neo4j']"
69260795,Neo4j - Get the relationship that have the latest timestamp,"When there is multiple relationships with different timestamps, I want to filter and get the latest timestamp. How do I do that?

    (n:Node)-[r:REL{&#39;timestamp&#39;: 12345678}]-&gt;(m:Node)",1632171883,https://stackoverflow.com/q/69260795,bguegan,"['neo4j', 'cypher']"
69260392,Neo4j modeling relationship query,"I have a query regarding modeling a relationship in Neo4j:

Here is a graph that I am creating:

[![enter image description here][1]][1]

 - Company1 has products - A, B, C
 - Company2 has products - A, B, D
 - Company2 competes with Company1

If I wanted to specify which products company2 is competing with company1 e.g. just product A. Would I have to put a list of products on the COMPETES relationship? or is there another way?

  [1]: https://i.stack.imgur.com/GhWh2.png",1632169434,https://stackoverflow.com/q/69260392,Swordfish,['neo4j']
69250614,How to add additional stop words to a Neo4j Full-text analyzer,"I&#39;m doing full-text search and need to add to the list of stop words.

Something exactly like this in ElasticSearch: https://stackoverflow.com/questions/44998259/how-to-add-stopwords-to-the-default-list-in-elasticsearch 

Is this posible without writing a custom analyzer as a plugin?
My index looks like this:

    CREATE FULLTEXT INDEX productNameIndex FOR (n:Product) ON EACH [n.name] 
        OPTIONS {indexConfig: {`fulltext.analyzer`: &#39;danish&#39; }}

Is it possible to do something like: `fulltext.stopwords: [&#39;word1&#39;, &#39;word2&#39;]` or maybe `fulltext.stopwords: ./stopwords.txt`?

I havn&#39;t tried writing a custom plugin for Neo4j before, but that seems quite intimidating.
",1632123368,https://stackoverflow.com/q/69250614,Chris Wohlert,"['search', 'neo4j', 'full-text-search']"
69247556,Neo4j query using only one core of my machine,"I am novice to Graph Databases and struggling to process 1M relationships using the below query. I have observed that the below query is using only 1 core and is taking too long. Is it possible to run the query in parallel using all cores available? I came across AOPC function apoc.cypher.parallel2 and not sure if it can do the trick. I am using the community version but open to upgrade to Enterprise version if I can get it to run in parallel.

    MATCH p=(a:address)-[r*]-&gt;(b:address)
    WHERE NOT (b)-[]-&gt;(:address)
    WITH a,b, LAST(nodes(p)) as c,length(p) as depth
    RETURN a.add_id, c.add_id,max(depth)
    ORDER BY a.add_id
    ;

Thanks in advance.",1632090832,https://stackoverflow.com/q/69247556,zulfi123786,"['parallel-processing', 'neo4j', 'cypher']"
69246746,Substitute for @additionalLabels in Neo4j GraphQL 2.0,"We run a project that uses the @additionalLabels directive to create multi-tenancy like it is suggested by the older version of the GRANDstack documentation.

Now we run into the problem when migration to the new version that this directive is &quot;Not supported at this time&quot; as it is stated here https://neo4j.com/docs/graphql-manual/current/guides/migration-guide/type-definitions/#_additionallabels

Does anyone know
1) a workaround to get it done as elegant as in the former version
2) when this directive will be available again

Thanks for your help!",1632082214,https://stackoverflow.com/q/69246746,Florian Bauer,"['graphql', 'neo4j', 'grandstack']"
69235642,Graphileon Proxy Feature issue,"We are trying to use the Graphileon proxy feature, but everytime we are getting error as:

```
{&quot;request&quot;:{&quot;url&quot;:&quot;http://127.0.0.1:8080/score/api&quot;,&quot;method&quot;:&quot;POST&quot;,&quot;body&quot;:{&quot;state&quot;:&quot;*&quot;,&quot;bucket&quot;:[{&quot;name&quot;:&quot;Ram&quot;,&quot;tr1&quot;:&quot;TR1&quot;,&quot;TC1&quot;:1}]}},&quot;error&quot;:{&quot;message&quot;:&quot;Request `body` must be string or plain object(when `json`: true)&quot;,&quot;code&quot;:400},&quot;code&quot;:400} with Status code 400
```

Here is the code we are using:

```
var schemaUrl =  &quot;http://localhost:8080/score/api&quot;;
var body = JSON.stringify({
					url: schemaUrl,
					method: &#39;POST&#39;,
					body: {
							state : &quot;*&quot;,
							bucket:
							[
								{name: &quot;Ram&quot;, tr1: &quot;TR1&quot;, TC1: 1}
							]
						}
				});
				
console.log(&quot;body == &quot; + body);

$.ajax({
 url: &quot;/proxy&quot;,  
          method: &quot;POST&quot;,
		  data: body
})
```

Can you please help what is missing?",1631976093,https://stackoverflow.com/q/69235642,Paras Bansal,"['ajax', 'neo4j', 'graphileon', 'jquery']"
69229825,Neo4j Procedure and Transactions,"I am writing a procedure in Java for a Neo4j plugin.  The plug in is complex and I would like to separate the plugin into a series of classes.  Class 1 is the procedure itself.  Class 2 contains some helper methods, and works.  Class 3, however, is a different type of helper methods but they require me to invoke the GraphDatabaseService.Transaction class to create nodes. From debugging, it appears that this line is the problematic line:
```
Node newNode = tx.createNode(Label.label(&quot;Mylabel&quot;));
```
After running a couple of experiments, it appears that perhaps one cannot execute a Transaction outside of the class that is decorated as a @Procedure.  Is that true?  I have not seen that in the documentation.  Is there any workaround?",1631915307,https://stackoverflow.com/q/69229825,Rasputin,"['java', 'plugins', 'neo4j']"
69214441,Kubernetes pod FileLockException: Lock file has been locked by another process - neo4j 4.2,"As per part of our Kubernetes deployment of neo4j 4.2, we are getting this exception. We got only 1 pod running and now its going into CrashloopBackoff. The backend is Google filestore, but as of now no one is accessing that. Need help - 

```
2021-09-16 17:43:00.981+0000 INFO  Starting...
2021-09-16 17:43:02.873+0000 INFO  ======== Neo4j 4.2.9 ========
2021-09-16 17:43:08.511+0000 ERROR Failed to start Neo4j on dbms.connector.http.listen_address, a socket address. If missing port or hostname it is acquired from dbms.default_listen_address.
java.lang.RuntimeException: Error starting Neo4j database server at /data/databases
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:207) ~[neo4j-4.2.9.jar:4.2.9]
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.build(DatabaseManagementServiceFactory.java:163) ~[neo4j-4.2.9.jar:4.2.9]
        at org.neo4j.server.CommunityBootstrapper.createNeo(CommunityBootstrapper.java:36) ~[neo4j-4.2.9.jar:4.2.9]
        at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:134) [neo4j-4.2.9.jar:4.2.9]
        at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:90) [neo4j-4.2.9.jar:4.2.9]
        at org.neo4j.server.CommunityEntryPoint.main(CommunityEntryPoint.java:35) [neo4j-4.2.9.jar:4.2.9]
Caused by: org.neo4j.kernel.lifecycle.LifecycleException: Component &#39;org.neo4j.kernel.internal.locker.LockerLifecycleAdapter@a8a8b75&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;Lock file has been locked by another process: /data/databases/store_lock. Please ensure no other process is using this database, and that the directory is writable (required even for read-only access)&quot;.
        at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:463) ~[neo4j-common-4.2.9.jar:4.2.9]
        at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:110) ~[neo4j-common-4.2.9.jar:4.2.9]
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:198) ~[neo4j-4.2.9.jar:4.2.9]
        ... 5 more
Caused by: org.neo4j.kernel.internal.locker.FileLockException: Lock file has been locked by another process: /data/databases/store_lock. Please ensure no other process is using this database, and that the directory is writable (required even for read-only access)
        at org.neo4j.kernel.internal.locker.Locker.storeLockException(Locker.java:175) ~[neo4j-kernel-4.2.9.jar:4.2.9]
        at org.neo4j.kernel.internal.locker.Locker.checkLock(Locker.java:95) ~[neo4j-kernel-4.2.9.jar:4.2.9]
        at org.neo4j.kernel.internal.locker.GlobalFileLocker.checkLock(GlobalFileLocker.java:58) ~[neo4j-kernel-4.2.9.jar:4.2.9]
        at org.neo4j.kernel.internal.locker.GlobalLocker.checkLock(GlobalLocker.java:28) ~[neo4j-kernel-4.2.9.jar:4.2.9]
        at org.neo4j.kernel.internal.locker.LockerLifecycleAdapter.start(LockerLifecycleAdapter.java:36) ~[neo4j-kernel-4.2.9.jar:4.2.9]
        at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:442) ~[neo4j-common-4.2.9.jar:4.2.9]
        at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:110) ~[neo4j-common-4.2.9.jar:4.2.9]
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:198) ~[neo4j-4.2.9.jar:4.2.9]
        ... 5 more
2021-09-16 17:43:08.515+0000 INFO  Neo4j Server shutdown initiated by request
2021-09-16 17:43:08.515+0000 INFO  Stopped.
```",1631822153,https://stackoverflow.com/q/69214441,Paras Bansal,"['neo4j', 'kubernetes', 'java', 'docker']"
69212806,In Cypher can I check if a property is a list before updating its value,"We are updating data in a database and for some nodes, because of legacy data, we might find a property as a string or as a list. I would like to convert strings into an empty list and keep lists as is. 
I have tried something like this :

&gt; MATCH (a:part) WHERE NOT EXISTS((a.serials)[0]) SET a.serials=[] return a

but it just throws an error.

any idea?
",1631813442,https://stackoverflow.com/q/69212806,Yoann Maingon,"['cypher', 'neo4j']"
69212355,How to Exclude nodes from Path in Cypher?,"I&#39;m stuck writing a Cypher query that would allow me to find all nodes which their code are NOT included in a given list. I&#39;ve tried searching for pattern negation, node negation, exclude in path with no success.

**Let&#39;s assume I have a list of codes (even though this list one has 1 element): [&quot;1V2ZG&quot;]**

I&#39;d like to build a Cypher query that would return every child of ARNOG node which is NOT in the above list.

This is the starting graph:

 [![enter image description here][1]][1]


The graph response I want:

[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/oOuMQ.png
  [2]: https://i.stack.imgur.com/iZY7T.png

The query I&#39;m using is returning all nodes which is not what I want:

    MATCH 
    (excl:Client)&lt;-[:PARENT_OF*]-(n:Client:Group),
    path=(b:BaseHierarchy)-[:INCLUDES]-&gt;(n)-[:PARENT_OF*]-&gt;(inc:Client) 
    
    WHERE excl.code IN [&#39;1V2ZG&#39;]  AND n.code = &#39;ARNOG&#39; 
    WITH b,
    nodes(path) as nodes, relationships(path) as relationships 
    RETURN b,
    apoc.coll.toSet(apoc.coll.flatten(collect(relationships))) as relationships,
    apoc.coll.toSet(apoc.coll.flatten(collect(nodes))) as nodes;",1631811317,https://stackoverflow.com/q/69212355,Marcos,"['neo4j', 'graph', 'cypher', 'java']"
69208813,Configuring and connect to Neo4j,"Dears, 

When I&#39;m trying to execute my python code I encountered the following error **&quot;No module named Neo4j&quot;**. 
I then installed the neo4j. Then I found that I have to configure and to connect to Neo4j. When I run the `cypher-sehll` in the terminal command I found this error **&quot;The server does not support any of the protocol versions supported by this driver. Ensure that you are using driver and server that are compatible with one another&quot;.** 

Any idea Please 

Thanks ",1631796818,https://stackoverflow.com/q/69208813,Ahlem rhayem,"['neo4j', 'graph', 'ubuntu', 'python']"
69208362,Is there any way to find out maximum value from property in Neo4j?,"I have a nodes where property maximum value is 772 but when I try with maximum value it doesn&#39;t show.

[![Maximum value][1]][1]


I have been try with Max cyper query is output is different also not showing in graph form.

    MATCH (n:citation) RETURN max(n.Name)

[![output result][2]][2]

Is there any way I have also try with DESC option but not working.

    MATCH (n:citation) RETURN n.Name order by n.Name DESC

[![order by Descending][3]][3]


  [1]: https://i.stack.imgur.com/mlNJt.png
  [2]: https://i.stack.imgur.com/AbFUp.png
  [3]: https://i.stack.imgur.com/puH5f.png

It&#39;s showing maximum number like 
1
10
100
2
20
3
35

so it will not take normal maximum value 100 but showing 35 is maximum..............",1631794955,https://stackoverflow.com/q/69208362,MASTANELAL ABDULGAFAR KURESHI,"['cypher', 'neo4j', 'max']"
69200606,MERGE with UNWIND Issue Neo4j,"I have a list of dictionaries I have created in python. It looks like this:
```
[{name: &#39;Bob&#39;}, {name: &#39;Teresa&#39;}, {name: &#39;Bob&#39;}, {name: &#39;Teresa&#39;}]
```

Here&#39;s my cypher query to take this list and merge into Neo4j that I&#39;m expecting only 2 new nodes are created, Bob and Teresa nodes.

```
WITH $batch AS batch
UNWIND batch as ind
MERGE (n:Friend)
SET n += ind
```

What I&#39;m seeing is that I only see 1 node that&#39;s written to Neo4j and it seems like it&#39;s whatever the last item in the list. In this example, Teresa node is the only one that got created.

How should I fix my query so that I see Bob AND Teresa nodes created once it finishes running? Is it better practice to make the list unique `[{name: &#39;Bob&#39;}, {name: &#39;Teresa&#39;}]` and use `CREATE` instead of `MERGE` instead?",1631746686,https://stackoverflow.com/q/69200606,sprint_6,"['neo4j', 'cypher', 'python']"
69199782,NEO4J: RETURN n{.*} to columns with distinct keys(n) as headers,"```
MATCH (n:Nodes)
RETURN n {.*}
```

Returns array for each row.

I&#39;d like to split the arrays into columns. Is there a way to do this?

```
MATCH (n:Nodes)
WITH keys(n) as headers
UNWIND headers as rows
RETURN DISTINCT rows
```
Returns all the existing keys.

I&#39;d like to turn these rows into column headers to return values for, so there would be null for any Nodes missing that property.

I tried:

```
MATCH (n:Nodes)
WITH keys(n) as headers
UNWIND headers as rows
WITH DISTINCT rows as headers
MATCH (n:Nodes)
RETURN n.[headers]
```
Yields &#39;Neo.ClientError.Statement.SyntaxError: Invalid input &#39;[&#39;: expected an identifier, whitespace, a function name or a property key name (line 6, column 10 (offset: 119))&#39;

```
MATCH (n:Nodes)
WITH keys(n) as headers
UNWIND headers as rows
WITH DISTINCT rows as headers
MATCH (n:Nodes)
RETURN headers, n[headers]
```

RETURNS each property value in its own row (not column).

Seems like there should be a way to do this. Most greatful for any pointers!",1631739913,https://stackoverflow.com/q/69199782,Stephanie,['neo4j']
69186183,Using Selenium to Input Cypher Commands into Neo4j,"So I am trying to automate query input into Neo4j browser. Since the area where the text is written into is not an input field, rather in `&lt;span&gt;` tags as below:
[![enter image description here][1]][1]

  [1]: https://i.stack.imgur.com/7kyc1.png

I would add in the the cypher command `MATCH (n) RETURN n LIMIT 10` through python like this:
```
driver.execute_script(&#39;return document.getElementsByClassName(&quot;view-line&quot;)[0].outerHTML=\&#39;&lt;div style=&quot;top:0px;height:23px;&quot; class=&quot;view-line&quot;&gt;&lt;span&gt;&lt;span class=&quot;mtk4&quot;&gt;MATCH&lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;mtk3&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;RETURN&lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;&amp;nbsp;n&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;mtk4&quot;&gt;LIMIT&lt;/span&gt;&lt;span class=&quot;mtk15&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;mtk13&quot;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;\&#39;&#39;)
```
After I edit the outer HTML using python and click the run button, the text would just disappear. I cannot figure out what could be wrong with this. I&#39;m new to using selenium as well. So not sure if it is something that I am doing wrong. ",1631670341,https://stackoverflow.com/q/69186183,Nayeer Mahiuddin,"['python', 'selenium', 'neo4j']"
69178462,Cypher - get all associated relationships for a node,"I have the following setup:

A doctor can have multiple patients, and every patient can have multiple diagnosis. 
I need to return for Doctor X, all his associated patients and their associated diagnosis.
How can I write a nested relationship query as follows? 
I have the following query for now:

   

     MATCH
    (p: Patient)-[:PATIENT_AT]-&gt;(d:Doctor),
    (di:Diagnosis)-[:DIAGNOSIS_BY]-&gt;(d:Doctor),
    (p:Patient)-[:HAS_DIAGNOSIS]-&gt;(di:Diagnosis)
    WHERE
     d.id=1000000
     RETURN p,di
  But this is returning me two separate queries. Can I get the same result in one query like:

       patient 1--&gt; all diagnosis
       patient 2 --&gt; all diagnosis

Or do I need two separate loops?

",1631625151,https://stackoverflow.com/q/69178462,NoahH,"['neo4j', 'cypher']"
69177409,How to store Knowledge Graph?,"I am working on generating knowledge graphs from a website. Till now I have done web crawling and web scraping using Scrapy to extract the data from the web pages. After extracting the data, my next step was to generate knowledge graph by using python libraries like Spacy and Matplotlib. I have been able to generate the knowledge graphs as shown below. Now my issue is I want to save the knowledge graphs as I have some further work to do with the data. I do not know how to proceed with this. I saw that I can use Neo4j but I am not really sure how to do it.
[![KG generated by using Spacy and Matplotlib][1]][1]
Could someone please guide me or share a good tutorial? 
Thanks a lot in advance.


  [1]: https://i.stack.imgur.com/nIHOj.png",1631620956,https://stackoverflow.com/q/69177409,NShini,"['knowledge-graph', 'neo4j', 'web-scraping', 'python']"
69177090,How to save multiple labels of a node in neo4j in a specified order?,"I use py2neo to create a node, which has three labels (&#39;photograph&#39;, &#39;creativework&#39;, &#39;thing&#39;), and stores them in neo4j in the order of those labels. 
In the follow-up work, I will use the first label, which is&#39;photograph&#39;.

But the order in which the label of the node is displayed in neo4j is as follows:

[![enter image description here][1]][1]

And the order of the nodes retrieved by py2neo is also wrong, the first label becomes &#39;creativework&#39;, which is not to my liking.
So how to save multiple labels of a node in neo4j in a specified order?


  [1]: https://i.stack.imgur.com/PXT0k.png",1631619637,https://stackoverflow.com/q/69177090,user15715772,"['cypher', 'neo4j']"
69173456,Spark-neo4j connector auto convert timezone when write from spark to neo4j,"I use **spark-neo4j connector** to write  data from dataframe spark to neo4j db. But after completed, i checked data on neo4j then i see datetime attribute of node auto converted timezone. I did like that

- Set time zone on server setup spark to Asia/Ho_Chi_Minh (check with date command)
- Set time zone on spark sql to Asia/Ho_Chi_Minh (check with spark.conf.get(&quot;spark.sql.session.timeZone&quot;))
- Set time zone on server setup neo4j to Asia/Ho_Chi_Minh (check with date command)
- Set time zone of neo4j to Asia/Ho_Chi_Minh (check with query return Datetime())
- Convert datetime col in dataframe to Asia/Ho_Chi_Minh

When i write to neo4j, time zone auto convert to  GMT or UTC **(2021-08-19T03:02:28.569000000Z)**.
I find out on github this issue 

    https://github.com/neo4j-contrib/neo4j-spark-connector/issues/295

And

    https://github.com/neo4j-contrib/neo4j-spark-connector/issues/358

I use **neo4j server version 4.1.6** and **neo4j browser 4.2.1** and **neo4j-connector-apache-spark_2.12-4.0.2_for_spark_3.jar**. In above issue, from **version 4.0.1 fixed** this error. But i still encountered it

",1631604017,https://stackoverflow.com/q/69173456,qxk71551,"['timezone', 'pyspark', 'apache-spark', 'neo4j']"
69173384,Adding relationships between an array of array of objects in Neo4j Cypher,"I have three arrays of objects as shown below:

```
const org = [
  { 
     id: &quot;orgId1&quot;,
     name: &quot;first organization&quot;
  },
  { 
     id: &quot;orgId2&quot;,
     name: &quot;second organization&quot;
  }
]

const location = [
  { 
     id: &quot;loc1&quot;,
     name: &quot;Texas&quot;
  },
  { 
     id: &quot;loc2&quot;,
     name: &quot;New York&quot;
  }
]

const contacts = [
  { 
     id: &quot;contact1&quot;,
     name: &quot;James&quot;
  },
  { 
     id: &quot;contact2&quot;,
     name: &quot;John&quot;
  }
]
```
What is the optimal way to add relationships between them? Note that the arrays are of the same length. 

I need a Cypher query that can loop through a range from 0 to orgs.length, and add corresponding relationships between each element at i. e.g org[i], contacts[i], location[i]

I tried the following, but it gives me an explosive combination where the first org maps to all the entries in location array and contact array, when I want is a one-to-one mapping. 

```
UNWIND $orgs as orgs
UNWIND $locations as locs
UNWIND $contacts as contacts

    FOREACH (i IN range(0, size(orgs) - 1) 
        | MERGE (:Organization { id: orgs[i].id })-[r:LOCATED_AT]-&gt;(:Location {id: locs[i].id})
       | MERGE (:Organization { id: orgs[i].id })-[r:CONTACT_AT]-&gt;(:Contact {id: contacts[i].id})
    )
```

Any help would be appreciated. Thanks in advance.",1631603726,https://stackoverflow.com/q/69173384,Rising Odegua,"['cypher', 'neo4j']"
69163956,neo4j bloom - blank perspective on valid data,"I have created a small graph in networkx for import into neo4j.  The graph imports and renders in neo4j browser but neo4j Bloom only produces a blank perspective.  I have followed the (excellent) recommendations made at this [slack question][1] to ensure that labelling is correct. What is preventing neo4j Bloom from generating the perspective?

Code to reproduce data.  Using networkx 6.2.2 and latest neo4j Version 1.4.7 (1.4.7.63).

    import random
    import networkx as nx
    
    # start with a small complete graph
    graphml_G = nx.complete_graph(5, nx.DiGraph())
    
    for node in graphml_G.nodes():
        attrs = {&quot;labels&quot;:&#39;:&#39;+str(node), &quot;random&quot;: random.randrange(10)}
        graphml_G.nodes[node].update(attrs)
    
    for edge in graphml_G.edges():
        attrs = {&quot;weight&quot;: random.randrange(10),&quot;label&quot;:&quot;:WEIGHT&quot;}
        graphml_G.edges[edge].update(attrs)
    
    # Drop some edges randomly to make it a more interesting graph
    droplist = []
    for edge in graphml_G.edges():
        if random.randrange(10) &lt;= 1:
            droplist.append(edge)
            
    graphml_G.remove_edges_from(droplist)
    
    nx.write_graphml(graphml_G, &#39;small_test_graph.graphml&#39;, named_key_ids=True)


Code to import in neo4j:

    CALL apoc.import.graphml(&quot;&lt;path to small_test_graph.graphml&gt;&quot;, {readLabels: true, storeNodeIds:true})

View in neo4j Browser after import:
[![enter image description here][2]][2]


  [1]: https://stackoverflow.com/questions/65973902/which-elements-from-networkx-graph-might-become-labels-at-neo4j-graph
  [2]: https://i.stack.imgur.com/2slAE.png",1631541447,https://stackoverflow.com/q/69163956,MikeB2019x,"['networkx', 'neo4j']"
69163777,&quot;Connection closed&quot; accessing neo4j in Docker from node.js in Docker on Mac,"I&#39;m running a neo4j database as well as an node.js api in a Docker container. On startup, the api tries to import a lot of data into neo4j, accessing it through neo4-driver. I can also run those imports manually from inside the Docker container or outside (locally).

This used to work fine. It works fine on Windows, it works fine for other people using a Macbook, and *sometimes* it also works for me, but then the connection mysteriously drops and I only get `ECONNREFUSED` errors anymore, until I restart the container. Neither neo4j nor Docker give any indication that anything is wrong. Nothing in the logs, they don&#39;t seem to have crashed, they&#39;re just inaccessible. The neo4j browser interface on port 7474 is also gone, though it used to be there.

The fact that this sometimes works is the baffling part. But it never works for long, before I get the errors again. When it drops, I often (not always) first get an `EPIPE` error.

I used to run Docker/docker desktop 3.1 and 10.20.2, now upgraded to 3.6.0 and 10.20.8. Neo4j version 3. The api runs on Alpine.

I use `docker-compose -p 7687:7687 -f ./docker-compose.yml up` to start Docker, and my docker-compose.yml file looks like this:

    version: &#39;3&#39;

    services:
      neo4j:
        build:
          context: ./db/
        ports:
          - &quot;7474:7474&quot;
          - &quot;7687:7687&quot;

      api:
        build:
          context: ./api/
        volumes:
          - ./api/:/code/
        depends_on:
          - neo4j
        ports:
          - &quot;3000:3000&quot;

I execute queries to neo4j with:

    const session = driver.session();
    session.writeTransaction((tx) =&gt; tx.run(query, params))

where `driver` was previously initialized with

    const driver = neo4j.driver(neo4jUrl, neo4j.auth.basic(user, passwd), {});

The most common error is this:

    Neo4jError: connect ECONNREFUSED 172.20.0.2:7687

      at captureStacktrace (/code/node_modules/neo4j-driver/lib/v1/result.js:199:15)
      at new Result (/code/node_modules/neo4j-driver/lib/v1/result.js:65:19)
      at _newRunResult (/code/node_modules/neo4j-driver/lib/v1/transaction.js:354:10)
      at Object.run (/code/node_modules/neo4j-driver/lib/v1/transaction.js:238:14)
      at Transaction.run (/code/node_modules/neo4j-driver/lib/v1/transaction.js:104:26)
      ...
      at TransactionExecutor._safeExecuteTransactionWork (/code/node_modules/neo4j-driver/lib/v1/internal/transaction-executor.js:134:22)
      at TransactionExecutor._executeTransactionInsidePromise (/code/node_modules/neo4j-driver/lib/v1/internal/transaction-executor.js:122:32)
      at Timeout._onTimeout (/code/node_modules/neo4j-driver/lib/v1/internal/transaction-executor.js:98:18)
      at listOnTimeout (internal/timers.js:557:17) {
    code: &#39;ServiceUnavailable&#39;


I suspect it might have something to do with Docker differences between Windows and Mac, but I&#39;m not sure. It has also worked fine with other Mac users, and occasionally does work for me, just not for long. So what could cause this connection to suddenly drop?",1631540634,https://stackoverflow.com/q/69163777,mcv,"['docker', 'macos', 'docker-compose', 'neo4j']"
69162730,Neo4j-4.1 Relationship property match queries are running slow even after creating indexes on it,"We have millions of relationship property match queries to run on neo4j. For that we are using:

    CALL db.index.fulltext.createRelationshipIndex(&quot;index_name&quot;, [&quot;RELATIONSHIP_NAME&quot;], [&quot;PROPERTY_NAME&quot;]);

for creating an index on relationship property.

But when we are writing a query to match a relationship property, neo4j is doing **filter** instead of index-seek-scan.

Is there any good way to create indexes on neo4j-4.1.0 such that every query uses the index to filter relationship property.",1631536294,https://stackoverflow.com/q/69162730,Shubham Garg,"['cypher', 'graph-databases', 'neo4j']"
69158730,Neo4j - APOC procedure do not import all of my data,"I have a problem using apoc procedure apoc.import.json.
It does not import all of the data of my json file.
The report of the procedure shows around 60 000 nodes and 400 000 relationships.

[![Result of the import procedure][1]][1]

[![Number of nodes insde the database][2]][2]

The number of nodes is correct, but when I count the number of relationships, there are only 17 410...

[![Number of relations inside the database][3]][3]


Does anyone encounter this problem ?

My neo4j database is a 4.2.2 version.

Thanks


  [1]: https://i.stack.imgur.com/ljPpC.png
  [2]: https://i.stack.imgur.com/aTBPi.png
  [3]: https://i.stack.imgur.com/0hKVx.png",1631517526,https://stackoverflow.com/q/69158730,Niko,"['neo4j', 'neo4j-apoc']"
69147992,Not able to create graph with native projection,"&gt; I downloaded community edition Neo4j 4.3.3 I installed gds library
&gt; 1.6.4 which is compatible with Neo4j 4.3.3 edition.
&gt; 
&gt; I am trying to run example to find shortest distance given in
&gt; https://neo4j.com/docs/graph-data-science/current/algorithms/dijkstra-source-target/
&gt; 
&gt; 
&gt; &gt; CREATE (a: Location {name: &quot;A&quot; }), (b: Location {name: &quot;B&quot; }), (c:
&gt; &gt; Location {name: &quot;C&quot; }), (d: Location {name: &quot;D&quot; }), (e: Location
&gt; &gt; {name: &quot;E&quot; }), (f:Location{name: &quot;F&quot; }), (a)-[:Road {cost:50}]-&gt;(b),
&gt; &gt; (a)-[:Road {cost:50}]-&gt;(c), (a)-[:Road {cost:100}]-&gt;(d), (b)-[:Road
&gt; &gt; {cost:40}]-&gt;(d), (c)-[:Road {cost:40}]-&gt;(d), (c)-[:Road
&gt; &gt; {cost:80}]-&gt;(e), (d)-[:Road {cost:30}]-&gt;(e), (d)-[:Road
&gt; &gt; {cost:80}]-&gt;(f), (e)-[:Road {cost:40}]-&gt;(f) WITH a, b,c,d,e,f
&gt; 
&gt; 
&gt; CALL gds.graph.create( &#39;myGraph&#39;, &#39;Location&#39;, &#39;ROAD&#39;, {
&gt; relationshipProperties: &#39;cost&#39; } )
&gt; 
&gt; 
&gt; 
&gt; MATCH (start:Location{name:&quot;A&quot;}), (end:Location{name:&quot;F&quot;})
&gt; 
&gt; CALL gds.shortestPath.dijkstra.write.estimate(&#39;myGraph&#39;, { startNode:
&gt; start, endNode: end, relationshipWeightProperty: &#39;cost&#39;,
&gt; writeRelationshipType: &#39;PATH&#39; }) YIELD nodeCount, relationshipCount,
&gt; bytesMin, bytesMax, requiredMemory RETURN nodeCount,
&gt; relationshipCount, bytesMin, bytesMax, requiredMemory
&gt; 
&gt; But I am getting error 
&gt; 
&gt; *Procedure call inside a query does not support naming results implicitly (name explicitly using `YIELD` instead) (line 22, column 1
&gt; (offset: 504)) &quot;CALL gds.graph.create(&#39;myGraph&#39;,&#39;Location&#39;,&#39;ROAD&#39;,&quot;*
&gt; 
&gt; Please anyone explain how to resolve this issue.",1631413412,https://stackoverflow.com/q/69147992,Madhumita Tripathy,['neo4j']
69146715,Neo4j: Sequence of Events as Nodes Not working,"I am new to cypher query syntax and tried different types of syntax/relationship to build sequence graph. My data contains group_id and within each group_id a code occurs based on the &#39;number&#39;. Lowest number is the first sequence and highest number is the last sequence per group id. I am able to load the data from csv and create nodes with properties, however it is not letting me convert to numerical sequence for &#39;code&#39; nodes. I am reading/referencing this article : [this tutorial](https://snowplowanalytics.com/blog/2017/07/17/loading-and-analysing-snowplow-event-data-in-neo4j/). Is there special cypher syntax to use to achieve this result?

Sample Data:

    group_id,code,date,number
    123,abc,2/18/21,4
    123,def,11/11/20,3
    123,ghi,11/10/20,2
    123,jkl,10/1/20,1
    456,gtg,11/28/20,5
    456,abc,10/30/20,4
    456,def,10/5/20,3
    456,jkl,10/1/20,2
    456,uuu,10/1/20,1


My Code to load data: 

    LOAD CSV WITH HEADERS FROM &quot;file:///sample2.csv&quot; AS row
    WITH row
    WHERE row.group_id IS NOT NULL
    MERGE (g:group_id {group_id: row.group_id});
    
    
    LOAD CSV WITH HEADERS FROM &quot;file:///sample2.csv&quot; AS row
    WITH row
    WHERE row.code IS NOT NULL
    MERGE (c:code {code: row.code})
    ON CREATE SET c.number = row.number,
                c.date = row.date;


Here is what I have tried: 

    // Building relationship
    LOAD CSV WITH HEADERS FROM &quot;file:///sample2.csv&quot; AS row
    WITH row
    MATCH (g:group_id {group_id: row.group_id})
    MATCH (c:code {code: row.code})
    MERGE (g)-[:GROUPS]-&gt;(c) // Connects ALL codes to group id, but how to connect to &#39;code&#39; and &#39;number&#39; sequentially?
    MERGE (c:{code: row.number})-[:NEXT]-&gt;(c) // Neo.ClientError.Statement.SyntaxError

I have gotten result: 

[![enter image description here][1]][1]


I am trying to get this. 
[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/BiIGL.png
  [2]: https://i.stack.imgur.com/pnlEw.png",1631394388,https://stackoverflow.com/q/69146715,sharp,"['neo4j', 'cypher']"
69142618,Highlight specific node in Neo4J Bloom,"So I followed the guide in this video: https://www.youtube.com/watch?v=fOJqHcTpQxs to get started with Neo4J Bloom

What I&#39;d like to do is highlight a specific node in the result.
Specific example: &quot;Hops from $person&quot; (the one shown also in the video).
So if you search for &quot;Hops from Tom Hanks&quot;, I&#39;d like to have the Tom Hanks node to be different from the other nodes.
My idea is to use rule-based styling and dynamically add a property &quot;mvp&quot; to the &quot;main&quot; node.

Here is a query I tried, but it doesn&#39;t show the mvp field in the graph:
```
MATCH path=(p:Person {name:$person})-[*1..4]-()
RETURN  p{.*, mvp:1},  path
```
In the table view I can see it though",1631360302,https://stackoverflow.com/q/69142618,Thomas J,"['neo4j', 'cypher']"
69139054,"Self referential many-to-many using relationship classes with Grails, GORM and neo4j","I have a Grails domain class with a self referential many-to-many:
```
class ModelElement {

	String name
	String elementType
	String modelType
	String description
	String toolIdentifier
	
	
	static hasMany = [
		relatedFrom: ModelElement,
		relatedTo: ModelElement
	]
	
	static mappedBy = [
		relatedFrom: &#39;relatedTo&#39;,
		relatedTo: &#39;relatedFrom&#39;
	]
	
	
	static mapping = {
		id generator: &#39;assigned&#39;,
		name: &#39;toolIdentifier&#39;
	}
	
    static constraints = {
		description nullable:true
    }
}
```
I want to map the relationship in neo4j using a relationship class like the following:
```
    import grails.neo4j.Relationship

class ModelRelationship implements Relationship&lt;ModelElement, ModelElement&gt; {

	String name
	String relationshipType
	String modelType
	String description
	String toolIdentifier

	static constraints = {
		name nullable:true
		description nullable:true
    }
}
```
When I try this code:
```
			def element1 = new ModelElement(
				name: &#39;Test Name 1&#39;,
				modelType: &quot;Archimate&quot;,
				elementType: &quot;Assessment&quot;,
				toolIdentifier: &#39;A123&#39;).save()
			def element2 = new ModelElement(
				name: &#39;Test Name 2&#39;,
				modelType: &quot;Archimate&quot;,
				elementType: &quot;Assessment&quot;,
				toolIdentifier: &#39;Z456&#39;).save()
			def relationship = new ModelRelationship(
				modelType: &quot;Archimate&quot;,
				relationshipType: &quot;Association&quot;,
				toolIdentifier: &#39;Z456&#39;,
				from: element1,
				to: element2).save()
``` 
I get the exception shown below. I have also tried changing the relatedFrom and relatedTo properties to type ModelRelationship however that creates a mapping error for mappedBy because those properties don&#39;t exist on ModelRelationship. 

Any ideas?
```
org.codehaus.groovy.runtime.typehandling.GroovyCastException: Cannot cast object &#39;me.yellek.adtf.model.ModelRelationship&#39; with class &#39;org.grails.datastore.mapping.keyvalue.mapping.config.KeyValuePersistentEntity&#39; to class &#39;org.grails.datastore.gorm.neo4j.RelationshipPersistentEntity&#39;
	at grails.neo4j.Relationship$Trait$Helper.type(Relationship.groovy:44)
	at grails.neo4j.Relationship$Trait$Helper.getType(Relationship.groovy:53)
	at grails.neo4j.Relationship$Trait$Helper.hashCode(Relationship.groovy:84)
	at java.base/java.util.HashMap.hash(HashMap.java:340)
	at java.base/java.util.HashMap.put(HashMap.java:612)
	at java.base/java.util.HashSet.add(HashSet.java:221)
	at grails.gorm.validation.PersistentEntityValidator.validate(PersistentEntityValidator.groovy:68)
	at org.grails.datastore.gorm.GormValidationApi.doValidate(GormValidationApi.groovy:124)
	at org.grails.datastore.gorm.GormValidationApi.validate(GormValidationApi.groovy:153)
	at org.grails.datastore.gorm.GormValidateable$Trait$Helper.validate(GormValidateable.groovy:71)
	at org.grails.datastore.gorm.GormInstanceApi.doSave(GormInstanceApi.groovy:333)
	at org.grails.datastore.gorm.GormInstanceApi.save_closure5(GormInstanceApi.groovy:180)
	at groovy.lang.Closure.call(Closure.java:412)
	at org.grails.datastore.mapping.core.DatastoreUtils.execute(DatastoreUtils.java:319)
	at org.grails.datastore.gorm.AbstractDatastoreApi.execute(AbstractDatastoreApi.groovy:40)
	at org.grails.datastore.gorm.GormInstanceApi.save(GormInstanceApi.groovy:179)
	at org.grails.datastore.gorm.GormInstanceApi.save(GormInstanceApi.groovy:119)
	at org.grails.datastore.gorm.GormEntity$Trait$Helper.save(GormEntity.groovy:100)
	at me.yellek.adtf.model.ModelRelationshipSpec.test basic relationship mapping(ModelRelationshipSpec.groovy:30)
```",1631318998,https://stackoverflow.com/q/69139054,Peter Kelley,"['groovy', 'grails-orm', 'neo4j', 'grails']"
69134234,Neo4j database character set,"In [tag:mysql] it&#39;s possible to specify character set like:

    CREATE DATABASE db_name CHARACTER SET latin1 COLLATE latin1_swedish_ci;

and check it with:

    SHOW CREATE DATABASE db_name;

Is it possible to do same in [tag:neo4j]?
&lt;br&gt;How to specify character set and how to check which one was used during DB creation?",1631286119,https://stackoverflow.com/q/69134234,cn007b,['neo4j']
69133087,An error occurred! Unable to start in just one database on server,"I am running neo 4.2.9-enterprise with multiple databases.
All except one of the databases is starting up.
I get this message when I restarted the server where prod_db is the name of the database.

&gt; An error occurred! Unable to start `DatabaseId{983937d7[prod_db]}`

THis is what I see when I run 

    show databases

This is a valuable database. 
I don&#39;t want to lose all that data.

What is the process of debugging the issue and how do I recover the most I can ?



",1631281152,https://stackoverflow.com/q/69133087,fodon,"['cypher', 'neo4j']"
69131894,"new Neo4jGraphQL({ typeDefs, driver }) causes Unknown directive error","I am trying to create a new GRANDstack application. The database already exists, so I&#39;ve used the &quot;infer-schema.js&quot; script, to generate the gql schema. When I run the api server, I get the following error: 


    Error: Unknown directive &quot;@relation&quot;.
    13:42:38 api | Unknown directive &quot;@relation&quot;.

This is on a fresh GRANDstack project - with the following untouched index.js:

    const driver = neo4j.driver(
      process.env.NEO4J_URI || &#39;bolt://localhost:7687&#39;,
      neo4j.auth.basic(
        process.env.NEO4J_USER || &#39;neo4j&#39;,
        process.env.NEO4J_PASSWORD || &#39;neo4j&#39;
      )
    )
    
    /*
     * Create an executable GraphQL schema object from GraphQL type definitions
     * including autogenerated queries and mutations.
     * Read more in the docs:
     * https://neo4j.com/docs/graphql-manual/current/
     */
    
    const neoSchema = new Neo4jGraphQL({ typeDefs, driver })

With the schema:

    type Incredient {
       _id: ID!
       name: String!
       recipes: [Recipe] @relation(name: &quot;HAS&quot;, direction: IN)
    }
    
    type Product {
       _id: ID!
       name: String!
       has_offer: [Offer] @relation(name: &quot;HAS_OFFER&quot;, direction: OUT)
       HAS_OFFER_rel: [HAS_OFFER]
       has_quantity: [Quantity] @relation(name: &quot;HAS_QUANTITY&quot;, direction: OUT)
       HAS_QUANTITY_rel: [HAS_QUANTITY]
    }
    
    type Offer {
       _id: ID!
       newPrice: Float!
       normalPrice: Float!
       products: [Product] @relation(name: &quot;HAS_OFFER&quot;, direction: IN)
    }
    
    type Quantity {
       _id: ID!
       name: String!
       products: [Product] @relation(name: &quot;HAS_QUANTITY&quot;, direction: IN)
    }
    
    type Recipe {
       _id: ID!
       name: String!
       has: [Incredient] @relation(name: &quot;HAS&quot;, direction: OUT)
       HAS_rel: [HAS]
    }
    
    type HAS @relation(name: &quot;HAS&quot;) {
      from: Recipe!
      to: Incredient!
      amount: Float!
      unit: String!
    }
    
    type HAS_OFFER @relation(name: &quot;HAS_OFFER&quot;) {
      from: Product!
      to: Offer!
      discount: Float!
    }
    
    type HAS_QUANTITY @relation(name: &quot;HAS_QUANTITY&quot;) {
      from: Product!
      to: Quantity!
      quantity: Float!
    }



",1631275271,https://stackoverflow.com/q/69131894,Chris Wohlert,"['graphql', 'neo4j', 'grandstack']"
69130680,Cannot merge the following node because of null property value for &#39;name&#39;:,"My code:
```
LOAD CSV WITH HEADERS FROM &quot;file:///C:/test1.csv&quot; AS line
MERGE (n:SiteA {name: line.SiteA})
MERGE (m:SiteB {name: line.SiteB})
MERGE (n) -[:has_device_function]-&gt; (m);
```
my error:

Cannot merge the following node because of null property value for &#39;name&#39;: (:SiteA {name: null})

Could you please help me ?",1631268783,https://stackoverflow.com/q/69130680,Nicolas Hovette,"['cypher', 'neo4j']"
69129161,Dump a Graph from Neo4j with pickle in python,"I&#39;ve got a rather large graph in Neo4j and need to do some computational stuff with it. This is why I need to do it on a HPC cluster. So far so good. But my programm accesses the neo4j graph several times which I can not do on the cluster. This is why I wanted to dump the graph object with pickle.dump(). Unfortunately I get an error:

&gt;File &quot;...myFile.py&quot;, line 9, in &lt;module&gt;
    pickle.dump(Graph(&quot;bolt:///localhost:7474/&quot;, auth=(&quot;neo4j&quot;, &quot;0000&quot;)), f)
AttributeError: Can&#39;t pickle local object &#39;ConnectionPool.connect.&lt;locals&gt;.&lt;lambda&gt;&#39;

My (simplified) code:

```
import pickle
from py2neo import Graph

graph2 = Graph(&quot;bolt:///localhost:7474/&quot;, auth=(&quot;neo4j&quot;, &quot;0000&quot;))

with open(&#39;graph.pkl&#39;, &#39;wb&#39;) as f:
    pickle.dump(Graph(&quot;bolt:///localhost:7474/&quot;, auth=(&quot;neo4j&quot;, &quot;0000&quot;)), f)

with open(&#39;graph.pkl&#39;, &#39;rb&#39;) as f:
    graph = pickle.load(f)

print(&quot;Hello&quot;)
```

Can someone tell me, why I get this error (and possibly how to get rid of it)? Thank you very much in advance.",1631261383,https://stackoverflow.com/q/69129161,T-Man,"['attributeerror', 'dump', 'neo4j', 'python', 'pickle']"
69127987,throws NoRootNodeMappingException while projecting/mapping neo4j query result to an interface or DTO class,"my query is very simple and the projection I am doing is following guidelines given in [https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#projections.interfaces](Spring Data Neo4J Projection) documentation.
My Code: 
```
@Query(&quot;MATCH (User {mobile:$mobile})-[:CONTACT]-(n:User)-[:STEPTAKER]-(s:Step) RETURN n.name AS name, s.count AS count&quot;)
    public List&lt;StepList&gt; findAllStepByMobile(String mobile);
    

interface StepList{
    String getName();
    int getCount();
}
```
The error:
2021-09-10 10:36:25.180 ERROR 18088 --- [nio-8080-exec-7] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.springframework.data.neo4j.core.mapping.NoRootNodeMappingException: Could not find mappable nodes or relationships inside Record&lt;{s.count: 400}&gt; for org.springframework.data.neo4j.core.mapping.DefaultNeo4jPersistentEntity@305b43ca] with root cause

*org.springframework.data.neo4j.core.mapping.NoRootNodeMappingException: Could not find mappable nodes or relationships inside Record&lt;{s.count: 400}&gt; for org.springframework.data.neo4j.core.mapping.DefaultNeo4jPersistentEntity@305b43ca*",1631254376,https://stackoverflow.com/q/69127987,Noor Khan,"['spring', 'java', 'neo4j', 'cypher']"
69126369,Error with spring data neo4j java.lang.NoSuchMethodError: org.springframework.web.util.ServletRequestPathUtils.setParsedRequestPath,"I got this error when I call get with URL localhost:8080/api/user&quot; to fetching data in user controller, does anyone can help me solve this issue, below is code in my project, I have try to switch another version of neo4j but that do not help to solve

** I got this error**
```
    org.springframework.web.util.NestedServletException: Request processing failed; nested exception is java.lang.NoSuchMethodError: org.springframework.web.util.ServletRequestPathUtils.setParsedRequestPath(Lorg/springframework/http/server/RequestPath;Ljavax/servlet/ServletRequest;)V
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-5.3.6.jar:5.3.6]
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898) ~[spring-webmvc-5.3.6.jar:5.3.6]
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:626) ~[tomcat-embed-core-9.0.45.jar:4.0.FR]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883) ~[spring-webmvc-5.3.6.jar:5.3.6]
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:733) ~[tomcat-embed-core-9.0.45.jar:4.0.FR]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:227) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-5.3.2.jar:5.3.2]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.3.2.jar:5.3.2]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:103) ~[spring-web-5.3.2.jar:5.3.2]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:103) ~[spring-web-5.3.2.jar:5.3.2]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:710) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:459) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:384) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:312) ~[tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.StandardHostValve.custom(StandardHostValve.java:398) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.StandardHostValve.status(StandardHostValve.java:257) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.StandardHostValve.throwable(StandardHostValve.java:352) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:177) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:78) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:357) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:374) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:893) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1707) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [na:1.8.0_251]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [na:1.8.0_251]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) [tomcat-embed-core-9.0.45.jar:9.0.45]
	at java.lang.Thread.run(Thread.java:748) [na:1.8.0_251]
Caused by: java.lang.NoSuchMethodError: org.springframework.web.util.ServletRequestPathUtils.setParsedRequestPath(Lorg/springframework/http/server/RequestPath;Ljavax/servlet/ServletRequest;)V
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:971) ~[spring-webmvc-5.3.6.jar:5.3.6]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006) ~[spring-webmvc-5.3.6.jar:5.3.6]
	... 36 common frames omitted

```
my dependency

```
&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-data-neo4j&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
	&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
			&lt;scope&gt;runtime&lt;/scope&gt;
			&lt;optional&gt;true&lt;/optional&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework&lt;/groupId&gt;
			&lt;artifactId&gt;spring-web&lt;/artifactId&gt;
			&lt;version&gt;5.3.2&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
			&lt;artifactId&gt;reactor-core&lt;/artifactId&gt;
		&lt;/dependency&gt;
```

**Model**

```
@Node
public class User {

    @Id
    private Long id;
    @Version
    private Long version;
    private String name;
    private String dob;
    private String gender;
    private String mobile;
    private String email;
    private String address;
    private String picture;
    private String registrationDate;
    @Relationship
    List&lt;User&gt; contacts = new ArrayList&lt;&gt;();

}
```

**Repository**
```
@Repository
public interface UserRepository extends ReactiveNeo4jRepository&lt;User, Long&gt; {

}
```

**Controller**

```
@RestController
@RequestMapping(&quot;/api/user&quot;)
public class UserController {

    private final UserRepository userRepository;

    public UserController(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    @GetMapping(&quot;/&quot;)
    public Flux&lt;User&gt; getAllUser(){

        return userRepository.findAll();
    }

}
```

",1631238785,https://stackoverflow.com/q/69126369,Nguyen Minh Thanh,"['neo4j', 'spring-boot', 'java']"
69118790,Neo4j Create Nodes without Creating Duplicates Nodes,"I am very new to this. So sorry if it seems dumb. I have a file with user log records which has two columns, &quot;User ID&quot; and &quot;User Name&quot;, basically it&#39;s a record of when people log in and out. I need to create nodes using the &quot;User Name&quot; and &quot;User ID&quot;, how do go about this? I read somewhere to use `OPTIONAL MATCH` but it didn&#39;t work. Here&#39;s what I wrote:

```
LOAD CSV WITH HEADERS FROM &#39;&#39; as row
OPTIONAL MATCH (n:User) AS nd 
WHERE nd is NULL
CREATE (n:User{user_name:row.User_Name}),(r:UserId{user_id:row.User_ID})
```
It still created the same amount of nodes. I&#39;d appreciate if anyone could help me with this. I can use `apoc.mergeNode` to delete the duplicates after creating the nodes, but it will be much more convenient if I could just do it all in one statement",1631192801,https://stackoverflow.com/q/69118790,Nayeer Mahiuddin,['neo4j']
69118543,Spring Data Neo4j field annotation validation,"This is how my `Node` looks like:

```
@Node
@Getter
@AllArgsConstructor
@Builder(toBuilder = true)
public class Company {
    @Id
    @ConvertWith(converter = UuidAttributeConverter.class)
    @GeneratedValue(generatorClass = UUIDGenerator.class)
    private UUID id;

    private final String name;
    private final Long value;

    @Builder.Default
    @Relationship(type = &quot;COLLECTS_FROM&quot;)
    private Set&lt;Company&gt; children = Set.of();
}
```
And this is what I would like to achieve:


```
@Node
@Getter
@AllArgsConstructor
@Builder(toBuilder = true)
public class Company {
    @Id
    @ConvertWith(converter = UuidAttributeConverter.class)
    @GeneratedValue(generatorClass = UUIDGenerator.class)
    private UUID id;

    @NotBlank
    private final String name;
    @NotNull
    private final Long value;

    @Builder.Default
    @Relationship(type = &quot;COLLECTS_FROM&quot;)
    private Set&lt;Company&gt; children = Set.of();
}
```

But it looks like the `@NotBlank`, or `@NotNull` annotations are ignored.


Of course, I could write my own validation methods and do something like this:

```
@Node
@Getter
@AllArgsConstructor
public class Company {
    @Id
    @ConvertWith(converter = UuidAttributeConverter.class)
    @GeneratedValue(generatorClass = UUIDGenerator.class)
    private UUID id;

    @NotBlank
    private final String name;
    @NotNull
    private final Long value;

    @Builder.Default
    @Relationship(type = &quot;COMPITE&quot;)
    private Set&lt;Company&gt; competitors = Set.of();

    @Builder(toBuilder = true)
    private Company(UUID id,
                    String name,
                    Long value,
                    Set&lt;Company&gt; competitors) {
        this.id = id == null ? UUID.randomUUID() : id;
        this.name = requireNonBlank(name, &quot;Name has to be specified.&quot;);
        this.value = requireNotNull(value, &quot;Require not null.);
        this.competitors = competitors;
    }
}
```

but I would prefer to use already created annotations from `javax.validation`.
Any ideas if it&#39;s even possible?



`spring-boot-starter-data-neo4j` with `6.1.1` version of `spring-data-neo4j`",1631191860,https://stackoverflow.com/q/69118543,degath,"['javax.validation', 'spring-data-neo4j', 'neo4j', 'spring', 'java']"
69115924,How to map nodes dynamically to corresponding section?,"This is my second post. I have 5 authors and 2 organization. I want to create a relationship between them. I want to connect [Author,Affliation]--&gt;[org,university] to matching organization. so output will be like [abc,organization 1]---&gt;[organization 1,a university] and [bcd,organization 2]---&gt;[organization 2,b university],[xyz]---&gt;[organization 2, b university],[abcd]---&gt;[organization 2, b university]. please have look on sample json file below...

 [
&quot;Authors&quot;:
{
Author:&quot;abc&quot;,
Affliation:&quot;organization1&quot;
},
{
Author:&quot;bcd&quot;,
Affliation:&quot;organization2&quot;
},
{
Author:&quot;xyz&quot;,
Affliation:&quot;organization2&quot;
},
{
Author:&quot;abcd&quot;,
Affliation:&quot;organization2&quot;
}
],

&quot;organization&quot;:[
{
org:&quot;organization1&quot;
university:&quot;a university&quot;
}
{
org:&quot;organization2&quot;
university:&quot;b university&quot;
}
]



I&#39;m new to neo4j just exploring. Any hint to this problem will be great help.

Thank you




   


",1631180869,https://stackoverflow.com/q/69115924,antonyj453,"['cypher', 'neo4j']"
69107479,Neo4j Bloom slows down with increased number of labels,"I have a Neo4j 4.1 DB with 200 nodes (just for demo purposes). The nodes can either be grouped by 5 distinct groups or 50. When I use 5 labels almost equally distributed over the 200 nodes Neo4j Bloom runs smoothly. When I use 50 labels mostly equally distributed Bloom is slowing down dramatically. E.g. the fetching of the label patterns in the search field of Bloom takes almost 100x longer. 

In both scenarios there is only one label set at each node. No indexes set in both cases. 

I’m curious if the amount of labels used in the DB (in total not at a node - this question is already answered) can have these dramatic effects? As said it is only a demo DB with just 200 nodes and 1500 relations and one label at each node. The only difference is the amount of labels in total in the DB. This amount shouldn&#39;t restrict the query time in Bloom this dramatically.

Local installation on standard development hardware. No customizations for memory, heap etc… all standard as it comes out of the box.

Any idea that could explain this difference in performance highly appreciated. ",1631122628,https://stackoverflow.com/q/69107479,Krid,"['neo4j', 'bloom']"
69107137,cypher equivalent of repeat and until in gremlin,"```
 g.V().
  hasLabel(&#39;Entity1&#39;).
  has(&#39;id&#39;, id).
  out(&#39;Entity2&#39;).until(hasLabel(&#39;RelLabel&#39;)).
  repeat(
    out(&#39;Entity3&#39;).
    in(&#39;Entity4&#39;).
    simplePath()).
```
Repeat traversal from Entity3&lt;-Entity4 until matches Relationship type(name) &#39;RelLabel&#39; and also it should not go into infiniteloop (simplePath()).

Looking for equivalent cypher query .",1631120733,https://stackoverflow.com/q/69107137,HashDhi,"['neo4j', 'cypher']"
69107105,Python neo4j return relationship properties,"I&#39;m running a pretty simple cypher query to get a mutual directed relation: `MATCH (this {name: &quot;me&quot;})-[r1]-&gt;(channel)&lt;-[r2]-(target) RETURN *`. The thing is that the python driver won&#39;t give me any of the attributes on relations, but if I specify them in the RETURN it works fine, e.g. `RETURN r1.bananas`. How can I get return * to include relation attributes so I can keep the nicely nested return value?",1631120557,https://stackoverflow.com/q/69107105,jstaab,"['python', 'neo4j']"
69104919,Py2neo IndexError: index out of range on Graph.run with gds.alpha.allShortestPaths.stream,"I&#39;m try to run `gds.alpha.allShortestPaths.stream` in a `py2neo.Graph` instance

That is my code:

~~~python
cypherCode = &quot;&quot;&quot;CALL gds.alpha.allShortestPaths.stream({
nodeQuery: &#39;MATCH (n:AUTHOR) RETURN id(n) AS id&#39;,
relationshipQuery: &#39;MATCH (n:AUTHOR)-[r:COAUTHORS]-(p:AUTHOR) RETURN id(n) AS source, id(p) AS target&#39;
})
YIELD sourceNodeId, targetNodeId, distance
return sourceNodeId, targetNodeId, distance
&quot;&quot;&quot;
r = graph.run(cypherCode)
~~~
I&#39;m using `relationshipQuery: &#39;MATCH (n:AUTHOR)-[r:COAUTHORS]-(p:AUTHOR) RETURN id(n) AS source, id(p) AS target&#39;` becouse I need undirected paths.

After 60sec I get this error:
~~~
IndexError: index out of range
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
&lt;timed exec&gt; in &lt;module&gt;

~/.local/lib/python3.8/site-packages/py2neo/database.py in run(self, cypher, parameters, **kwparameters)
    403         :return:
    404         &quot;&quot;&quot;
--&gt; 405         return self.auto().run(cypher, parameters, **kwparameters)
    406 
    407     def evaluate(self, cypher, parameters=None, **kwparameters):

~/.local/lib/python3.8/site-packages/py2neo/database.py in run(self, cypher, parameters, **kwparameters)
    976                 result = self._connector.run(self.ref, cypher, parameters)
    977             else:
--&gt; 978                 result = self._connector.auto_run(cypher, parameters,
    979                                                   graph_name=self.graph.name,
    980                                                   readonly=self.readonly)

~/.local/lib/python3.8/site-packages/py2neo/client/__init__.py in auto_run(self, cypher, parameters, pull, graph_name, readonly)
   1341             if pull != 0:
   1342                 try:
-&gt; 1343                     cx.pull(result, n=pull)
   1344                 except TypeError:
   1345                     # If the RUN fails, so will the PULL, due to

~/.local/lib/python3.8/site-packages/py2neo/client/bolt.py in pull(self, result, n, capacity)
    941         result.append(response, final=(n == -1))
    942         try:
--&gt; 943             self._sync(response)
    944         except BrokenWireError as error:
    945             result.transaction.mark_broken()

~/.local/lib/python3.8/site-packages/py2neo/client/bolt.py in _sync(self, *responses)
    745         self.send()
    746         for response in responses:
--&gt; 747             self._wait(response)
    748 
    749     def _audit(self, task):

~/.local/lib/python3.8/site-packages/py2neo/client/bolt.py in _wait(self, response)
    740         &quot;&quot;&quot;
    741         while not response.full() and not response.done():
--&gt; 742             self._fetch()
    743 
    744     def _sync(self, *responses):

~/.local/lib/python3.8/site-packages/py2neo/client/bolt.py in _fetch(self)
    715         failed state into an exception.
    716         &quot;&quot;&quot;
--&gt; 717         tag, fields = self.read_message()
    718         if tag == 0x70:
    719             self._responses.popleft().set_success(**fields[0])

~/.local/lib/python3.8/site-packages/py2neo/client/bolt.py in read_message(self)
    642 
    643     def read_message(self):
--&gt; 644         tag, fields = self._reader.read_message()
    645         if tag == 0x71:
    646             # If a RECORD is received, check for more records

~/.local/lib/python3.8/site-packages/py2neo/client/bolt.py in read_message(self)
     94                 chunks.append(self.wire.read(size))
     95         message = b&quot;&quot;.join(chunks)
---&gt; 96         _, n = divmod(message[0], 0x10)
     97         try:
     98             unpacker = UnpackStream(message, offset=2)

IndexError: index out of range
~~~

When I try to change the `relationshipQuery` with oriented path or with an small graph it&#39;s works fine.

Running this cypher code directly on neo4j browser it&#39;s works and  takes about 80sec to run.

My graph have 10k nodes and 20k relations.

",1631111186,https://stackoverflow.com/q/69104919,Leonardo Stefan,"['py2neo', 'python-3.x', 'graph-data-science', 'neo4j']"
69100450,Get all nodes with a specific type of relationship to a root node,"I have a rather large and complex graph in Neo4j (millions of nodes and relationships in various types), I want to get all child nodes (in all depths) of a specific root node, but only with a specific type of relationship

I have tried: `Match (n:NODE_TYPE)-[*:REL_TYPE]-&gt;(r:NODE_TYPE {id:SPECIFIC_ID}) return n`
But I get a syntax error for specifying a label on the relationship

Querying the whole graph takes a really long time without specifying the relationship type, and nodes could go through paths that will eventually lead to the root node but will use other types of relationships (which is not good for my use case)",1631093378,https://stackoverflow.com/q/69100450,Nadav Porat,"['cypher', 'neo4j-browser', 'neo4j']"
69098868,Shortest Path between node a and first occurance of node b,"I&#39;ve got a a graph like this:  A-&gt;B-&gt;C-&gt;D-&gt;E-&gt;A-&gt;B-&gt;D

The nodes are all different to another...So no A is like another A.

How can I find the shortest Path between first A and first D and second A and second D? I don&#39;t want to find the length between first A and second D.

It&#39;s for a kind of clickstreaming. So for an example, this creates a simple graph for this problem:

```cypher
create (:SysEvent{name:&quot;Start&quot;, date:datetime(&quot;2021-09-08T11:30:00&quot;)})-[:next]-&gt;(:action{name:&quot;Aktion1&quot;})-[:next]-&gt;(:action{name:&quot;Aktion2&quot;})-[:action]-&gt;(:SysEvent{name:&quot;End&quot;, date:datetime(&quot;2021-09-08T11:32:00&quot;)})-[:next]-&gt;(:action{name:&quot;Aktion3&quot;})-[:next]-&gt;(:SysEvent{name:&quot;Start&quot;, date:datetime(&quot;2021-08-09T11:40:00&quot;)})-[:next]-&gt;(:SysEvent{name:&quot;End&quot;, date:datetime(&quot;2021-09-08T11:40:30&quot;)})
```

And I want to know the number of actions or relationships between a &quot;Start and the next &quot;End&quot;

Thank you :)",1631086845,https://stackoverflow.com/q/69098868,Patrick Poppe,"['cypher', 'neo4j']"
69092539,"In Neo4j, is there anyway to create a graph projection if your graph is too big to fit in memory? The estimate is 152GB for my very large graph",I have a graph with 18 billion relationships and roughly 2 million nodes.   I need to perform an embedding using FASTRP and the memory estimate for the graph projection is 152 GB.   Is there anyway around creating the graph projection?  I only have 64GB of RAM on my desktop.   ,1631036610,https://stackoverflow.com/q/69092539,tlmoon,['neo4j']
69084096,Inheritance of parent ontology attributes in neo4j,"When constructing ontology, there will be parent and child classes. The attributes of the parent ontology created in neo4j are generally only related to the parent ontology. How to make the child ontology inherit the attributes of the parent ontology?",1631000087,https://stackoverflow.com/q/69084096,colinyuan,"['neo4j', 'protege']"
69073622,Neo4j / Cypher - find path but middle nodes of this path can&#39;t be of type X,"I have this code for finding the shortest path:

    p=shortestPath((startNode)-[*..10]-(endNode))

Now I would like to add a condition that none of middle nodes can be of X type. Only the first node has an X type.",1630926874,https://stackoverflow.com/q/69073622,ablaszkiewicz1,"['neo4j', 'cypher']"
69072236,Neo4j - Fine Grained Control - Where UserID == Node.UserID,"I am working through building a platform, and am at a point where I want to add security in to the build.

Ignoring anything to do with the rest of the stack, and focussing just on user roles within Neo4j, is it possible to use fine grained control to grant access to a user only for their node, and specific traversals of that node.

I have looked through on:
https://neo4j.com/docs/operations-manual/current/authentication-authorization/access-control/

and the role that would most closely match what I am trying to describe, is what a &#39;Patient&#39; would see in the sample provided.

Coming from firebase, the equivalent statement in firestore rules would be 
```
    match /customers/{uid} {
      allow read: if request.auth.uid == uid;
}
```

Can this be done exclusively within neo4j, or would it require support from the serverside solution?",1630920448,https://stackoverflow.com/q/69072236,Tristram Tolliday,"['neo4j-apoc', 'cypher', 'neo4j', 'authentication']"
69068921,Changing a Neo4j grass file from java code,"I am writing a Neo4j Genealogy Plugin to encourage adoption of Neo4j within the genealogy community. I&#39;ve been using *.grass files to enhance visualizations. I want to incorporate these into the plugin so that the grass file can be changed on the fly when a user invokes a function. Optimizing the visualization varies for each output.

Is there a Neo4j java function that will let you change the grass file?",1630899968,https://stackoverflow.com/q/69068921,David A Stumpf,"['java', 'neo4j', 'user-defined-functions']"
69064410,Return top % of results in Neo4J,"I&#39;ve a graph of students and the various books that they&#39;ve read. I want to find out the top 10% of students who&#39;ve read the most books. How can I do that? I&#39;ve tried the following cypher syntax:

```
MATCH (s:Student)-[:READ]-&gt;(b:Book)
WITH s, COUNT(b) AS no_of_books
WHERE no_of_books &gt; percentileCont(no_of_books, 0.9)
RETURN s.Name, no_of_books
```

The error &#39;invalid use of aggregating function&#39; is returned. It seems that trying to use two aggregating functions on top of each other is an issue here. How can I tweak my syntax to make it work?

I&#39;ll be happy to use the LIMIT function instead if it can work with percentages as well.",1630853071,https://stackoverflow.com/q/69064410,wanderingcatto,"['cypher', 'neo4j']"
69061604,Neo4j - Is it possible to select a shortest path where nodes with a certain label have a particular value?,"If I have two graphs

1.  a:Test -&gt; b:Foo({type = &#39;car&#39;}) -&gt; c:Test -&gt; d:Foo({type = &#39;car&#39;}) -&gt; e:Test
2.  a:Test -&gt; b:Foo({type = &#39;car&#39;}) -&gt; c:Test -&gt; d:Foo({type = &#39;bike&#39;}) -&gt; e:Test

I want to write a shortest path query that will match the first path predicated on intermediate nodes of type Foo with type = car, but then fails to find the second a path in the second graph.

    MATCH (a:Test {id: &#39;1&#39;} ),
      (e:Test {id: &#39;5&#39;}),
      p = shortestPath((a)-[:REL*]-(e))
    WHERE all(r IN nodes(p) WHERE r.type = &#39;car&#39;)
    RETURN p 

But this obviously doesn&#39;t work, maybe with a subquery?",1630829161,https://stackoverflow.com/q/69061604,Patrick White,"['cypher', 'neo4j']"
69044126,How do i follow a specific pattern of multiple nodes/relationships any number of times through a graph?,"I have the following neo4j graph where a node beginning with &quot;I&quot; is of label &quot;Information&quot; and a node beginning with &quot;F&quot; is of label &quot;Function&quot;:

```
(I0)&lt;-[:requires]-(F1)-[:provides]-&gt;(I1)&lt;-[:requires]-(F2)-[:provides]-&gt;(I2)&lt;-[:requires]-(F3)-[:provides]-&gt;(I3)
```

I want to cypher query this graph to find all the data that is downstream (following the provides-requires relations) of node (F1). What cypher query would i need to find this?",1630668177,https://stackoverflow.com/q/69044126,ABCDEF,"['neo4j', 'cypher']"
69044045,"Neo4j | Cypher - given node A, show me path to node B of C type which has more than X children of D type","First part of query is to find nodes of type **C** which have more than **X** children of **D** type and I have this working:

    MATCH (Parent:$C)
    WITH Parent, [(Child:$D)-[]-(Parent) | Child] as children
    WITH Parent, children, size(children) as ChildCount
    WHERE ChildCount &gt; $X

    RETURN Parent

Now I&#39;d like to take node **A** and find a Path to some of nodes returned from first query.
My query looks like this:

    //Part A - this one is already working
    MATCH (Parent:FullAddress)
    WITH Parent, [(Child:Company)-[]-(Parent) | Child] as children
    WITH Parent, children, size(children) as ChildCount
    WHERE ChildCount &gt; 10
    WITH Parent as Target

    //Part B - this part doesn&#39;t work
    MATCH Path = (S:Ship)-[*2]-(Target)
    WHERE ID(S)=164758
    RETURN nodes(Path)
    LIMIT 100

The expected result is to show me path between `Ship` with `ID=164758` and one of nodes from **query A**. I am sure that this path exists as I checked it manually before choosing query parameters.

Current result is neo4j loadig to infinity.",1630667745,https://stackoverflow.com/q/69044045,ablaszkiewicz1,"['cypher', 'neo4j']"
69041593,Can&#39;t query created nodes from apoc.load.xml,"I successfully loaded a XML file with apoc.load.xml and created nodes &amp; relationships with Neo4j 4.0.3, below some parts of the load XML:

    call apoc.load.xml(&quot;file:/import.xml&quot;,&#39;/doc/obj&#39;,{}, false) yield value as II
    unwind II._children as RA
    unwind RA._children as RA2
    unwind RA2._children as RA3
    with II.type as Type,
    …
    merge(e:Element{name:NAME, guid:GUID})
    merge(t:Type{name:Type})
    merge(e)-[:of]-&gt;(t)
    return e,t

The nodes, relations and properties are visible, but I can&#39;t query the nodes based on any property value.

    match(n:Element) where n.name = &quot;element1&quot; return n

    (no changes, no records)

whereas searching for id(n) is working fine  //match(n:Element) where id(n) &gt; 10 return n

Any ideas why I can&#39;t query for property values for the newly created elements?",1630656751,https://stackoverflow.com/q/69041593,RR_514,"['neo4j-apoc', 'cypher', 'neo4j']"
69040046,Which Version of neo4j Does the Grails Plugin Support?,"Running the sample provided by [Puneet Behl](https://stackoverflow.com/users/2618779/puneet-behl) at https://github.com/puneetbehl/neo4j-example against a new neo4j 4.3.1 database started via neo4j desktop. 

config in application.yml changed to:
```
grails:
    neo4j:
        url: bolt://grails:grails@localhost:7687
        username: &quot;grails&quot;
        password: &quot;grails&quot;
        # type: embedded
        # location: build/data/neo4j
```
The application does connect to the db because when I omit the userid and password grails complains on startup.

I get the exception shown below when trying to load the pet controller.

The code it is referencing is the following:
```
    @Transactional
    def index(Integer max) {
        params.max = Math.min(max ?: 10, 100)
        respond petService.list(params), model:[petCount: petService.count()]
    }
```
Am I using a too new version of neo4j?

```
| Running application...
Grails application running at http://localhost:8080 in environment: development
2021-09-03 15:20:45.186 ERROR --- [nio-8080-exec-1] o.g.web.errors.GrailsExceptionResolver   : ClientException occurred when processing request: [GET] /pet/index
Invalid input &#39;{&#39;: expected &quot;+&quot; or &quot;-&quot; (line 2, column 8 (offset: 38))
&quot; LIMIT {1}&quot;
        ^. Stacktrace follows:

java.lang.reflect.InvocationTargetException: null
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at org.grails.core.DefaultGrailsControllerClass$ReflectionInvoker.invoke(DefaultGrailsControllerClass.java:211)
        at org.grails.core.DefaultGrailsControllerClass.invoke(DefaultGrailsControllerClass.java:188)
        at org.grails.web.mapping.mvc.UrlMappingsInfoHandlerAdapter.handle(UrlMappingsInfoHandlerAdapter.groovy:90)
        at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1064)
        at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:963)
        at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)
        at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898)
        at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)
        at org.grails.web.servlet.mvc.GrailsWebRequestFilter.doFilterInternal(GrailsWebRequestFilter.java:77)
        at org.grails.web.filters.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:67)
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)
        at java.base/java.lang.Thread.run(Thread.java:832)
Caused by: org.neo4j.driver.exceptions.ClientException: Invalid input &#39;{&#39;: expected &quot;+&quot; or &quot;-&quot; (line 2, column 8 (offset: 38))
&quot; LIMIT {1}&quot;
        ^
        at org.neo4j.driver.internal.util.Futures.blockingGet(Futures.java:143)
        at org.neo4j.driver.internal.InternalResult.blockingGet(InternalResult.java:128)
        at org.neo4j.driver.internal.InternalResult.hasNext(InternalResult.java:64)
        at org.grails.datastore.gorm.query.AbstractResultList.&lt;init&gt;(AbstractResultList.java:46)
        at org.grails.datastore.gorm.query.AbstractResultList.&lt;init&gt;(AbstractResultList.java:36)
        at org.grails.datastore.gorm.neo4j.collection.Neo4jResultList.&lt;init&gt;(Neo4jResultList.groovy:57)
        at org.grails.datastore.gorm.neo4j.engine.Neo4jQuery.executeQuery(Neo4jQuery.groovy:517)
        at org.grails.datastore.mapping.query.Query.doList(Query.java:589)
        at org.grails.datastore.mapping.query.Query.list(Query.java:568)
        at grails.gorm.PagedResultList.&lt;init&gt;(PagedResultList.java:43)
        at grails.gorm.DetachedCriteria$_list_closure2.doCall(DetachedCriteria.groovy:137)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at grails.gorm.DetachedCriteria$_withPopulatedQuery_closure8.doCall(DetachedCriteria.groovy:771)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at org.grails.datastore.gorm.GormStaticApi$_withDatastoreSession_closure24.doCall(GormStaticApi.groovy:862)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at org.grails.datastore.mapping.core.DatastoreUtils.execute(DatastoreUtils.java:319)
        at org.grails.datastore.gorm.AbstractDatastoreApi.execute(AbstractDatastoreApi.groovy:40)
        at org.grails.datastore.gorm.GormStaticApi.withDatastoreSession(GormStaticApi.groovy:861)
        at grails.gorm.DetachedCriteria.withPopulatedQuery(DetachedCriteria.groovy:742)
        at grails.gorm.DetachedCriteria.list(DetachedCriteria.groovy:135)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at grails.gorm.transactions.GrailsTransactionTemplate$2.doInTransaction(GrailsTransactionTemplate.groovy:94)
        at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
        at grails.gorm.transactions.GrailsTransactionTemplate.execute(GrailsTransactionTemplate.groovy:91)
        at yellek.PetController.$tt__index(PetController.groovy:16)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at grails.gorm.transactions.GrailsTransactionTemplate$2.doInTransaction(GrailsTransactionTemplate.groovy:94)
        at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
        at grails.gorm.transactions.GrailsTransactionTemplate.execute(GrailsTransactionTemplate.groovy:91)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at grails.gorm.transactions.GrailsTransactionTemplate$2.doInTransaction(GrailsTransactionTemplate.groovy:94)
        at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
        at grails.gorm.transactions.GrailsTransactionTemplate.execute(GrailsTransactionTemplate.groovy:91)
        ... 15 common frames omitted
        Suppressed: org.neo4j.driver.internal.util.ErrorUtil$InternalExceptionCause: null
                at org.neo4j.driver.internal.util.ErrorUtil.newNeo4jError(ErrorUtil.java:80)
                at org.neo4j.driver.internal.async.inbound.InboundMessageDispatcher.handleFailureMessage(InboundMessageDispatcher.java:107)
                at org.neo4j.driver.internal.messaging.common.CommonMessageReader.unpackFailureMessage(CommonMessageReader.java:83)
                at org.neo4j.driver.internal.messaging.common.CommonMessageReader.read(CommonMessageReader.java:59)
                at org.neo4j.driver.internal.async.inbound.InboundMessageHandler.channelRead0(InboundMessageHandler.java:83)
                at org.neo4j.driver.internal.async.inbound.InboundMessageHandler.channelRead0(InboundMessageHandler.java:35)
                at org.neo4j.driver.internal.shaded.io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:99)
                at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
                at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
                at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
                at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324)
                at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:296)
                at org.neo4j.driver.internal.async.inbound.MessageDecoder.channelRead(MessageDecoder.java:47)
                at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
                at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
                at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
                at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324)
                at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:311)
                at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:432)
                at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276)
                at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
                at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
                at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
                at org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
                at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
                at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
                at org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
                at org.neo4j.driver.internal.shaded.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
                at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719)
                at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655)
                at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581)
                at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)
                at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)
                at org.neo4j.driver.internal.shaded.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
                at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
                ... 1 common frames omitted

&lt;===========--&gt; 85% EXECUTING [20m 51s]
&gt; :bootRun
```",1630647910,https://stackoverflow.com/q/69040046,Peter Kelley,"['neo4j', 'grails']"
69037472,Return destination nodes available to Node B that can&#39;t be accessed from Node A,"I have relationships between Users and Repositories in my database.

They look like this:

```
(User{name:&quot;A&quot;})-[:HAS_ACCESS_TO]-&gt;(Repository{name:&quot;1&quot;})
(User{name:&quot;A&quot;})-[:HAS_ACCESS_TO]-&gt;(Repository{name:&quot;2&quot;})

(User{name:&quot;B&quot;})-[:HAS_ACCESS_TO]-&gt;(Repository{name:&quot;1&quot;})
(User{name:&quot;B&quot;})-[:HAS_ACCESS_TO]-&gt;(Repository{name:&quot;3&quot;})
(User{name:&quot;B&quot;})-[:HAS_ACCESS_TO]-&gt;(Repository{name:&quot;4&quot;})
```

I&#39;m trying to find the Repositories that User B has access to that User A _does not_ have access to.

In the example above, the answer would be Repositories 3 and 4 only.

I&#39;ve tried something like this:

```
MATCH (u:User{name:&quot;A&quot;})-[]-&gt;(r:Repository)
WITH r.name AS userARepositories

MATCH (u:User{name:&quot;B&quot;})-[]-&gt;(r:Repository)
WHERE NOT r.name in userARepositories

RETURN r.name
```

The above doesn&#39;t work as I expected (and to be frank I&#39;m not sure how to interpret the results returned by the above query to understand what it is doing instead).

**How can I find the repositories that User B has access to that User A _does not_ have access to?**",1630620141,https://stackoverflow.com/q/69037472,Juicy,"['neo4j', 'cypher']"
69034619,Find by dynamic labels using SpringDataNeo4j,"I&#39;m using Spring Data Neo4j 6.1.2 and would like to find nodes using a name and dynamic labels.

Here is my attributes on the node class:

```
 private String name;

 @DynamicLabels
 private List&lt;String&gt; labels = new ArrayList&lt;&gt;();
```

Here is the finder method that I have defined in the repository:

```
 List&lt;Entity&gt; findByNameAndLabels(String name, List&lt;String&gt; labels);
```

But when I run the method with the correct name and labels, the returned array is always empty. If I search just by name, the nodes are returned correctly.

What am I doing wrong?
",1630602872,https://stackoverflow.com/q/69034619,Swordfish,"['neo4j', 'spring-data-neo4j']"
69028253,Neo4j - find nodes of type A which have more than X children of type B,"I would like to find all nodes of A type which have more than X children of B type.

By child I mean that this node is connected to other node by any relationship in any direction.

My query returns results, but It&#39;s not what I expected:

    MATCH (Parent:typeA)-[R]-(Child:typeB)
    WITH Parent, Child, count(R) as ChildCount
    WHERE ChildCount &gt; 3
    RETURN Parent, Child, ChildCount

It usually returns things with `ChildCount=1` where I can manually query those things and check that they have more children of this type.",1630577456,https://stackoverflow.com/q/69028253,ablaszkiewicz1,"['neo4j', 'cypher']"
69016546,What is the difference between those two match requests that excluding a relationship type?,"Assume we have node labeled `:User` that is linked to node `:Test1:Test2` (the node labeled `Test1` can also be labeled `Test2`)

```
MATCH (u:User)--&gt;(t:Test1) WHERE NOT t:Test2 return count(distinct u); // result 10
MATCH (u:User)--&gt;(t:Test1) WHERE NOT (u)--&gt;(:Test2) return count(distinct u); // result 5
```

What is the difference between these two requests (except syntaxically) ?",1630509606,https://stackoverflow.com/q/69016546,Lounis,"['neo4j', 'cypher']"
69016244,Neo4j: Cypher query to parallelize a row of the result from a previous query,"I have a database where sentences are related to each other. I have to perform a big update on the whole database, thus I&#39;m trying to parallelize the update.

The relevant cypher query looks like this:
```
match (s:Sentence)-[r:RELATED]-(t:Sentence)
return s as sentence, collect(t.embedding) as neighbours_embeddings
```
`embedding` is a list of numbers.

This returns a result like this:
```
---------------------------------------
| sentence   |  neighbours_embeddings |
---------------------------------------
| sentence1  | [[1, 2, 3], [4, 5, 6]] | 
---------------------------------------
| sentence2  | [[2, 3, 5]]            |
---------------------------------------
```
Now I wanna perform some operations on the neighbours_embeddings and set a property in the corresponding Sentence node.

I&#39;ve looked at different parallelization techniques in Neo4j and as far as I understood, all of them need a list as input. But my input would be a tuple like (sentence, neighbours_embeddings). How do I achieve this?

Full query for interested folks:
```
match (s:Sentence)-[r:RELATED]-(t:Sentence)
with s as sentence, collect(t.embedding) as neighbours
with sentence, [
    w in reduce(s=[], neighbour IN neighbours | 
    case when size(s) = 0 then
    neighbour else [
        i in range(0, size(s)-1) |
        s[i] + neighbour[i]] end) |
        w / tofloat(size(neighbours))
    ] as average
 
 with sentence, [
     i in range(0, size(sentence.embedding)-1) |
     (0.8 * sentence.embedding[i]) + (0.2 *average[i])
 ] as unnormalized
 
 with sentence, unnormalized, sqrt(reduce(sum = 0.0, element in unnormalized | sum + element^2)) as divideby
 set sentence.normalized = [
     i in range(0, size(unnormalized)-1) | (unnormalized[i] / divideby)
 ]

```",1630508400,https://stackoverflow.com/q/69016244,slayer,"['neo4j', 'parallel-processing', 'cypher', 'neo4j-apoc']"
69015425,LOAD CSV: mulitple MERGE and Eager operator,"I have a large CSV file that contains mulitple nodes per line. I would like to use `LOAD CSV` to `MERGE` the nodes and set some properties. However, I always get the &quot;Eager operator&quot; warning for this query:

```
USING PERIODIC COMMIT
LOAD CSV FROM &#39;file:///MRCONSO.RRF&#39; AS line FIELDTERMINATOR &#39;|&#39;
MERGE (c:Concept {cui: line[0]})
ON CREATE SET c.language = line[1]
MERGE (l:LexicalForm {lui: line[3]})
ON CREATE SET l.status = line[2];
```

When I remove the `ON CREATE` part it works but I want to merge on a specific ID, not on the combination of the ID and the other properties.

Is it possible to rephrase this somehow to avoid the Eager operator? I would like to create 6 different nodes from a single line and the alternative would be to iterate the file 6 times.",1630505528,https://stackoverflow.com/q/69015425,Martin Preusse,"['neo4j', 'csv']"
69014745,"Pentaho SSH communication to Neo4j suddenly fails with `IOException: Cannot negotiate, proposals do not match.`","I suddenly got weird error in ETL pipeline for migration from Oracle do Neo4j.

The ETL is implemented as docker-compose of 3 images:
* Pentaho PDI
* source Oracle image
* target Neo4j image

The main pipeline in PDI loads data from Oracle, converts them into CSV and stores into Neo4j where these files are further processed. Since some moment, the sftp transfer of zip containing CSV files failed with following error:

```
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - Started FTP job to ${remote_server}
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - ERROR (version 8.3.0.0-371, build 8.3.0.0-371 from 2019-06-11 11.09.08 by buildguy) : Error getting files from FTP : There was a problem while connecting to neo4j:22
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - ERROR (version 8.3.0.0-371, build 8.3.0.0-371 from 2019-06-11 11.09.08 by buildguy) : java.io.IOException: There was a problem while connecting to neo4j:22
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at com.trilead.ssh2.Connection.connect(Connection.java:791)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at com.trilead.ssh2.Connection.connect(Connection.java:563)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.entries.ftpdelete.JobEntryFTPDelete.SSHConnect(JobEntryFTPDelete.java:966)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.entries.ftpdelete.JobEntryFTPDelete.execute(JobEntryFTPDelete.java:746)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.Job.execute(Job.java:686)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.Job.execute(Job.java:827)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.Job.execute(Job.java:827)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.Job.execute(Job.java:827)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.Job.execute(Job.java:827)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.Job.execute(Job.java:827)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.Job.execute(Job.java:827)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.Job.execute(Job.java:827)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.Job.execute(Job.java:565)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at org.pentaho.di.job.entries.job.JobEntryJobRunner.run(JobEntryJobRunner.java:69)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at java.lang.Thread.run(Thread.java:748)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - Caused by: java.io.IOException: Key exchange was not finished, connection is closed.
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at com.trilead.ssh2.transport.KexManager.getOrWaitForConnectionInfo(KexManager.java:92)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at com.trilead.ssh2.transport.TransportManager.getConnectionInfo(TransportManager.java:230)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at com.trilead.ssh2.Connection.connect(Connection.java:743)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	... 14 more
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - Caused by: java.io.IOException: Cannot negotiate, proposals do not match.
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at com.trilead.ssh2.transport.KexManager.handleMessage(KexManager.java:413)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at com.trilead.ssh2.transport.TransportManager.receiveLoop(TransportManager.java:754)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	at com.trilead.ssh2.transport.TransportManager$1.run(TransportManager.java:469)
2021/08/30 12:21:51 - Cleanup remote deko-etl-import.zip - 	... 1 more
```

The error is difficult to google - there is couple of similar problems ([1][1], [2][2], [3][3], [4][4], [5][5]) yet it hardly explains the cause of sudden malfunction.

I felt it is something around ssh key exchange but I don&#39;t know ssh deep enough to understand what happened.

  [1]: https://stackoverflow.com/q/54778037/653539
  [2]: https://stackoverflow.com/q/50136080/653539
  [3]: https://youtrack.jetbrains.com/issue/IDEA-140196
  [4]: https://www.edureka.co/community/70621/connection-ioexception-exchange-finished-connection-retrying
  [5]: https://github.com/connectbot/connectbot/issues/352",1630503118,https://stackoverflow.com/q/69014745,Tom&#225;š Z&#225;lusk&#253;,"['neo4j', 'trilead-ssh', 'pentaho', 'ssh']"
69012266,Neo4J checking if a user follows me back,"I am building a `follower` model with neo4j. User A [:Follows] -&gt; user B and user B can do the same.

A is follower of B. Getting this information is straight forward. However I also want to get information at the same time if B [:Follows] -&gt; A or not.

Is there a way to pull out this information?",1630493048,https://stackoverflow.com/q/69012266,Pradeep,"['cypher', 'neo4j']"
69012220,Cypher - order by rarity of type of child node,"I have this Cypher query:

    MATCH (Parent)-[R]-(Child) WHERE ID(Parent)=$parentId
    CALL {
        WITH Child
        RETURN apoc.node.degree(Child) as ChildDegree
    }
    WITH Parent, Child, R, ChildDegree
    RETURN Parent, Child, type(R), ChildDegree
    ORDER BY R
    LIMIT 35
Which returns **limited** data (limit is 35). This limit is something which bothers me. Imagine that **Parent** has this **Children**:
 - 40 x **A**
 - 3 x **B**
 - 2 x **C**

In this situation my query sometimes returns **(35 x A)**. What I&#39;d like to achieve is to make this query order by the rarest type of child for this parent and for this example return this data:
 - 2 x **C**
 - 3 x **B**
 - 30 x **A**",1630492838,https://stackoverflow.com/q/69012220,ablaszkiewicz1,"['neo4j', 'cypher']"
69011250,Neo4j Cypher- With clause query,"I&#39;m doing some codes on the Neo4j&#39;s movies dataset the question was

&gt;Retrieve the actors who have acted in exactly five movies, returning the name of the actor, and the list of movies for that actor.


I wrote this following query and im not getting the result and it shows &quot;no changes no result&quot;

``` 
MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie)
WITH  a,m, count(m) AS numMovies
WHERE numMovies = 5
RETURN a.name,collect(m.title) AS movies
 ```
where as when I wrote this query for the same satement this time I just write the &quot;collect(m.title) AS movies &quot; in the WITH clause and I got the desired result.
```
MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie)
WITH  a, count(m) AS numMovies, collect(m.title) AS movies
WHERE numMovies = 5
RETURN a.name, movies
```
My doubt is that why result varies when I wrote the &quot;collect(m.title) AS movies&quot; in the RETURN clause. ",1630488950,https://stackoverflow.com/q/69011250,Riya Bisht,"['neo4j', 'graph-databases', 'cypher']"
69007233,neo4j cypher query equivalent for gremlin filter and comparing its properties,"```
g.V().hasLabel(&#39;Entity1&#39;).has(&#39;refSpecName&#39;,&#39;XYZ&#39;).where(__.in(&#39;Entity2&#39;).filter{it.get().value(&#39;prop1&#39;).getAt(&#39;AccessTechnology&#39;)==&#39;ABC&#39; &amp;&amp; it.get().value(&#39;prop1&#39;).getAt(&#39;TargetSVLANProductType&#39;)==&#39;Enhanced SLA&#39;})

g.V().hasLabel(&#39;Entity1&#39;).has(&#39;deviceId&#39;,within(deviceIds)).filter{it.get().value(&#39;name&#39;).contains(name)}.as(&#39;entity1&#39;).out(&#39;Entity2&#39;).as(&#39;entity2&#39;).select(&#39;entity1&#39;,&#39;entity2&#39;)
```
1.iterates , get the object and get property of prop1 from object which is of map, using key get the value of map and compare against the provided string

2. iterates , get the object and get property of name from object which is of string and compare",1630464277,https://stackoverflow.com/q/69007233,HashDhi,"['neo4j', 'cypher']"
69003387,Query a whole graph from starting node,"In my neo4j-DB I have several independent graphs which are not connected. 
There is a Node inside one of these graphs with the label XY_Object having an:

    &lt;id&gt;: 115

Which is connected to several other Nodes with different labels, creating one of these graphs.

Is it possible to fetch this very graph only by that information? I keep trying some similar Queries from SO but apparently I keep applying and modifying them wrong. (I&#39;m only a beginner with Neo4j)
",1630432812,https://stackoverflow.com/q/69003387,Qohelet,"['neo4j', 'cypher']"
69002213,How to get the output of the neo4j query in currency format (With $ symbol)?,"For the following query (pseudo query)

```sql
MATCH (data:DATA { id: 123 })
WITH data
RETURN
  apoc.temporal.format(data.last_seen, &quot;MM/dd/YYYY HH:mm:ss&quot;) AS last_seen,
  data.amount As amount
ORDER BY last_seen DESC;
```

I want output like:

```
last_seen: &#39;08/31/2021 12:03:26&#39;
amount: $12.00
```

`last_seen` is fine. But I didn&#39;t get a method to format the `amount` column.

Gone through https://neo4j.com/labs/apoc/4.1/mathematical/number-conversions/

But I didn&#39;t find a way to ad `$` symbol at the beginning.",1630426952,https://stackoverflow.com/q/69002213,upadhyas,['neo4j']
68998262,Get nodes having more than X relationships and it&#39;s children in specific format,"I have this Cypher query:

    MATCH (Parent)-[R1]-(Child)
    MATCH (Child)-[R2]-(Grandchild)
    WHERE ID(Parent)=238777 
    RETURN Parent, Child, type(R1) as R, count(R2) as Degree
Which returns data in this format:

    Parent | Child | Relationship name | Degree of child (how many relationship child has)
What I&#39;d like to do now is to find all nodes which have more than X relationships and display results in the same format.

What I currently have is this query:

    MATCH (Parent:FullAddress)-[r]-(Child)
    MATCH (Child)-[R2]-(Grandchild)
    WITH Parent, count(r) as childrenCount, collect(Child) as ChildrenList, r
    WHERE childrenCount &gt; 10
    UNWIND ChildrenList as ChildrenSeparate
    RETURN Parent, ChildrenSeparate, type(r)

Which returns data in this format:

    Parent | Child | Relationship name

Any suggestions on how to add `degree` functionality?",1630411024,https://stackoverflow.com/q/68998262,ablaszkiewicz1,"['cypher', 'neo4j']"
68996990,Can&#39;t open Neo4j browser after loading the newest db dump,"Button which used to be blue and clickable is not clickable now:

[![enter image description here][1]][1]


In addition I can&#39;t launch the browser from context menu on the left (nothing happens):[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/SUtQk.png
  [2]: https://i.stack.imgur.com/o0r6Z.png",1630405441,https://stackoverflow.com/q/68996990,ablaszkiewicz1,"['neo4j', 'cypher']"
68989342,Neo4j vector operations on arrays,"I have a graph database where each `Sentence` node has an `embeddings` property which is an array of length 768. What I want to do is create a property in each of these node which is an aggregation of average of all the neighboring nodes&#39; `embeddings`.

Basically,
```
for each node in the graph:
    sum = [0] * 768
    count = 0
    for neighbour in node.neighbours:
        sum = vector_sum(sum, neighbour.embeddings)
        count += 1
    avg = sum / count
    node.neighbours_average = avg
```

Currently, I&#39;m using neomodel to read in the nodes, perform this in python and then ingest it into the graph. Understandably, it is pretty slow.

What would be the most efficient way to do this?

I&#39;ve looked at Data Science Library, APOC, etc, but none of these have vector operations.",1630351318,https://stackoverflow.com/q/68989342,slayer,"['sum', 'neo4j', 'vector', 'aggregation']"
68988103,Cypher: return a string if no match using fulltext search,"I have a Cypher query 

```
CALL db.index.fulltext.queryNodes(&#39;myIndex&#39;, &#39;coding&#39;)
YIELD node
RETURN node
```
which returns the `coding` node if the index actually matches with any existing nodes, and return null if there is no match.

Instead of returning a null value if there is no match, I want to return a string or a message like `No match found`.

I was thinking I can combine `apoc.when()` like 
```
CALL db.index.fulltext.queryNodes(&#39;myIndex&#39;, &#39;coding&#39;)
YIELD node

WITH node
CALL apoc.when(node is not null, &#39;RETURN node&#39;, &#39;RETURN &quot;No match found&quot;&#39;, {node:node})
```
but I get an error 
```
Query cannot conclude with CALL (must be RETURN or an update clause) (line 5, column 1 (offset: 77))
&quot;CALL apoc.when(node is not null, &#39;RETURN node&#39;, &#39;RETURN &quot;No match found&quot;&#39;, {node:node})&quot;
```

I tried adding 
```
YIELD value
RETURN value
```

at the end of the statement, but it does not return the message when there is no match and works as if the `apoc.when()` is not used.",1630344368,https://stackoverflow.com/q/68988103,igeass,"['cypher', 'neo4j']"
68982122,Using Djisktra Shortest Path on anonyous graph NEO4j,"I&#39;ve been using the Dijkstra Source-Target algorithm of the GDSL plugin to get the shortest path between two nodes. That works exactly as it should be, however I always have to rerun the cypher query :

    CALL gds.graph.create( &#39;graphname, &#39;node&#39;, &#39;rel&#39;, { relationshipProperties: &#39;prop&#39; } )

or else the Djikstra call gives an &quot; Graph not exist in database&quot;.

Anyone has any idea why this keeps happening? or if I can run the djikstra algortihm anonymously ? I searched on the official website however I didn&#39;t find a detailed example.
Thank you.",1630317254,https://stackoverflow.com/q/68982122,confusedstudent,"['shortest-path', 'neo4j', 'cypher']"
68979927,jQAssistant: Can&#39;t reset external Neo4J store - why?,"I&#39;m running jQAssistant with an external Neo4J database. I want to collect the data of our projects and keep them externally for queries.

To do that, I reset the store just before scanning the projects.

However, since a couple of days, I&#39;m getting this error:

    [INFO] --- jqassistant-maven-plugin:1.10.0:reset (reset-store) @ foobar ---
    [INFO] Scanning for jQAssistant plugins...
    [INFO] [Asciidoc Report, CDI, Common, Core Analysis, Core Report, EJB3, GraphML, GraphQL, JAX-RS, JSON,
    JUnit, Java, Java EE 6, Maven 2 Repository, Maven 3, OSGi, RDBMS, Spring, TestNG, Tycho, XML, YAML,
    jQAssistant JPA 2 Plugin].
    [INFO] Connecting to store at &#39;bolt://myserver:7687&#39; (username=neo4j)
    Aug 29, 2021 5:45:11 PM org.neo4j.driver.internal.logging.JULogger info
    INFORMATION: Direct driver instance 1436136891 created for server address myserver:7687
    [INFO] Resetting store.
    [INFO] Resetting store.
    [INFO] ------------------------------------------------------------------------
    [INFO] BUILD FAILURE
    [INFO] ------------------------------------------------------------------------
    [INFO] Total time:  54:07 min
    [INFO] Finished at: 2021-08-29T18:39:13+02:00
    [INFO] ------------------------------------------------------------------------
    [ERROR] Failed to execute goal com.buschmais.jqassistant:jqassistant-maven-plugin:1.10.0:reset (reset-store)
    on project foobar: Execution reset-store of goal
    com.buschmais.jqassistant:jqassistant-maven-plugin:1.10.0:reset failed:
    Cannot delete node&lt;11994142&gt;, because it still has relationships.
    To delete this node, you must first delete its relationships. -&gt; [Help 1]

Is there anything I can do about that? Or should I just reinstall Neo4J?",1630306003,https://stackoverflow.com/q/68979927,eerriicc,"['neo4j', 'jqassistant']"
68971283,Do you know of an example of Grails and neo4j configuration?,"There is a Grails and neo4j plugin that says that GORM is supported however the docs are somewhat old and I can&#39;t get it working. 

Running the grails3-gorm sample from the distribution under Grails 5.0.0 RC1 yields the exception below:
```
C:\Users\User\eclipse-workspace\gorm-neo4j\examples\grails3-neo4j&gt;grails -version
| Grails Version: 5.0.0.RC1
| JVM Version: 15
| Resolving Dependencies. Please wait...

&gt; Configure project :
GORM VERSION = 7.1.0.RC2

Deprecated Gradle features were used in this build, making it incompatible with Gradle 7.0.
Use &#39;--warning-mode all&#39; to show the individual deprecation warnings.
See https://docs.gradle.org/6.9.1/userguide/command_line_interface.html#sec:command_line_warnings

| Running application...
GORM VERSION = 7.1.0.RC2
ERROR org.springframework.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;healthContributorRegistry&#39; defined in class path resource [org/springframework/boot/actuate/autoconfigure/health/HealthEndpointConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.boot.actuate.health.HealthContributorRegistry]: Factory method &#39;healthContributorRegistry&#39; threw exception; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#39;neo4jHealthContributor&#39; defined in class path resource [org/springframework/boot/actuate/autoconfigure/neo4j/Neo4jHealthContributorConfigurations$Neo4jConfiguration.class]: Unsatisfied dependency expressed through method &#39;neo4jHealthContributor&#39; parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;neo4jDatastore&#39;: Bean instantiation via constructor failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.grails.datastore.gorm.neo4j.Neo4jDatastore]: Constructor threw exception; nested exception is org.grails.datastore.mapping.model.DatastoreConfigurationException: Embedded Neo4j server was configured but &#39;neo4j-harness&#39; classes not found on classpath.
        at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:658)
        at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:638)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1334)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1177)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:564)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:944)
        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:918)
        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:583)
        at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:145)
        at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
        at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:434)
        at org.springframework.boot.SpringApplication.run(SpringApplication.java:338)
        at grails.boot.GrailsApp.run(GrailsApp.groovy:99)
        at grails.boot.GrailsApp.run(GrailsApp.groovy:485)
        at grails.boot.GrailsApp.run(GrailsApp.groovy:472)
        at grails.boot.GrailsApp$run.call(Unknown Source)
        at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:47)
        at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:125)
        at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:148)
        at functional.tests.Application.main(Application.groovy:8)
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.boot.actuate.health.HealthContributorRegistry]: Factory method &#39;healthContributorRegistry&#39; threw exception; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#39;neo4jHealthContributor&#39; defined in class path resource [org/springframework/boot/actuate/autoconfigure/neo4j/Neo4jHealthContributorConfigurations$Neo4jConfiguration.class]: Unsatisfied dependency expressed through method &#39;neo4jHealthContributor&#39; parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;neo4jDatastore&#39;: Bean instantiation via constructor failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.grails.datastore.gorm.neo4j.Neo4jDatastore]: Constructor threw exception; nested exception is org.grails.datastore.mapping.model.DatastoreConfigurationException: Embedded Neo4j server was configured but &#39;neo4j-harness&#39; classes not found on classpath.
        at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:185)
        at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653)
        ... 24 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#39;neo4jHealthContributor&#39; defined in class path resource [org/springframework/boot/actuate/autoconfigure/neo4j/Neo4jHealthContributorConfigurations$Neo4jConfiguration.class]: Unsatisfied dependency expressed through method &#39;neo4jHealthContributor&#39; parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;neo4jDatastore&#39;: Bean instantiation via constructor failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.grails.datastore.gorm.neo4j.Neo4jDatastore]: Constructor threw exception; nested exception is org.grails.datastore.mapping.model.DatastoreConfigurationException: Embedded Neo4j server was configured but &#39;neo4j-harness&#39; classes not found on classpath.
        at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:800)
        at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:541)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1334)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1177)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:564)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeansOfType(DefaultListableBeanFactory.java:671)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeansOfType(DefaultListableBeanFactory.java:659)
        at org.springframework.context.support.AbstractApplicationContext.getBeansOfType(AbstractApplicationContext.java:1300)
        at org.springframework.boot.actuate.autoconfigure.health.HealthEndpointConfiguration.healthContributorRegistry(HealthEndpointConfiguration.java:82)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:564)
        at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:154)
        ... 25 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;neo4jDatastore&#39;: Bean instantiation via constructor failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.grails.datastore.gorm.neo4j.Neo4jDatastore]: Constructor threw exception; nested exception is org.grails.datastore.mapping.model.DatastoreConfigurationException: Embedded Neo4j server was configured but &#39;neo4j-harness&#39; classes not found on classpath.
        at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:315)
        at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:296)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1354)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1204)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:564)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
        at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:410)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1334)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1177)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:564)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524)
        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
        at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.addCandidateEntry(DefaultListableBeanFactory.java:1598)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:1562)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveMultipleBeans(DefaultListableBeanFactory.java:1481)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1338)
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1300)
        at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:887)
        at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791)
        ... 43 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.grails.datastore.gorm.neo4j.Neo4jDatastore]: Constructor threw exception; nested exception is org.grails.datastore.mapping.model.DatastoreConfigurationException: Embedded Neo4j server was configured but &#39;neo4j-harness&#39; classes not found on classpath.
        at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:221)
        at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:117)
        at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:311)
        ... 69 common frames omitted
Caused by: org.grails.datastore.mapping.model.DatastoreConfigurationException: Embedded Neo4j server was configured but &#39;neo4j-harness&#39; classes not found on classpath.
        at org.grails.datastore.gorm.neo4j.connections.Neo4jConnectionSourceFactory.create(Neo4jConnectionSourceFactory.java:85)
        at org.grails.datastore.gorm.neo4j.connections.Neo4jConnectionSourceFactory.create(Neo4jConnectionSourceFactory.java:30)
        at org.grails.datastore.mapping.core.connections.AbstractConnectionSourceFactory.create(AbstractConnectionSourceFactory.java:64)
        at org.grails.datastore.mapping.core.connections.AbstractConnectionSourceFactory.create(AbstractConnectionSourceFactory.java:52)
        at org.grails.datastore.mapping.core.connections.ConnectionSourcesInitializer.create(ConnectionSourcesInitializer.groovy:24)
        at org.grails.datastore.gorm.neo4j.Neo4jDatastore.&lt;init&gt;(Neo4jDatastore.java:228)
        at jdk.internal.reflect.GeneratedConstructorAccessor35.newInstance(Unknown Source)
        at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
        at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
        at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
        at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:208)
        ... 71 common frames omitted
&lt;=============&gt; 100% EXECUTING [1m 12s]
&gt; IDLE
&gt; IDLE
&gt; IDLE
&gt; IDLE
Note: C:\Users\User\eclipse-workspace\gorm-neo4j\grails-datastore-gorm-neo4j\build\tmp\compileGroovy\groovy-java-stubs\org\grails\datastore\gorm\neo4j\GraphPersistentEntity.java uses or overrides a deprecated API.
Note: Recompile with -Xlint:deprecation for details.
Note: Some input files use unchecked or unsafe operations.
Note: Recompile with -Xlint:unchecked for details.

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task &#39;:examples-grails3-neo4j:bootRun&#39;.
&gt; Process &#39;command &#39;C:\Tools\java\jdk-15\bin\java.exe&#39;&#39; finished with non-zero exit value 1

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with | Error Failed to start server (Use --stacktrace to see the full trace)
```",1630226768,https://stackoverflow.com/q/68971283,Peter Kelley,"['neo4j', 'grails']"
68965011,cypher filter relationship based on where not in,"```
g.V().
  hasLabel(&#39;Entity1&#39;).
  has(&#39;name&#39;, within(&#39;BB&#39;, &#39;CC&#39;)).
  in(&#39;Entity2&#39;).
  where(
      not(
__.out(&#39;Entity3&#39;).
      __.out(&#39;Entity4&#39;).
      has(&#39;name&#39;, within(&#39;ABC&#39;, &#39;XYZ&#39;)).
      in(&#39;Entity5&#39;))).
  in(&#39;Entity6&#39;)
```

Filter node where entity3 not connected with entity4 of name in [&#39;ABC&#39;,&#39;XYZ&#39;]

Below cypher query has syntax error 
```
MATCH(e1:Entity1{name:$name})&lt;-[:Entity2]-()-[:Entity3]-&gt;(oEntity3)
where Not (oEntity3)-[:Entity4]-&gt;(oEntity4)
AND oEntity4 in [&#39;ABC&#39;,&#39;XYZ&#39;]
```",1630158814,https://stackoverflow.com/q/68965011,HashDhi,"['gremlin', 'neo4j', 'cypher']"
68963521,Neo4j - Find triplets with most similar attributes (nodes and relationships)?,"I have a lot of triplets with different attributes for each user node (it can contain user_id, location, role for some nodes and others can be without location but with their marital status, use_car etc.) and data node.
Data node can contain location, size, origin and sometimes it will contain only the location.
I have a relation between these nodes - that has some attributes like folder_name, approved/rejected etc.

Given a new triplet, how can I find the most similar triplets by their attributes (user node + relation + data node)

Is there any functionality to do this? I will be happy to get a direction to check or minimal example.",1630147066,https://stackoverflow.com/q/68963521,SteveS,"['neo4j', 'graph-databases']"
68959082,How to access the browser interface to install APOC in Neo4J?,"Not knowing how to verify if APOC is installed with my Neo4J database – which is however very unlikely – I started it and opened the browser at http://localhost:7474/browser/ 
But the interface only displays 6 icons for information in the left bar&#160;: Database, Favorites, Help...This does not correspond to the interface that would be necessary to install APOC&#160;: https://github.com/neo4j-contrib/neo4j-apoc-procedures 
How can I access this one&#160;?	",1630096204,https://stackoverflow.com/q/68959082,novicious,"['neo4j-apoc', 'browser', 'neo4j', 'interface']"
68956342,Neo4j LOAD CSV a gzip file from FTP,"You can use `LOAD CSV` to load gzipped csv files. This works when I load the file from the local disc.

However, it does not properly decode the file when I try to load a gzipped CSV file from FTP.

Here is an example with a public FTP server:

```
LOAD CSV FROM &#39;ftp://ftp.ensembl.org/pub/release-104/tsv/homo_sapiens/Homo_sapiens.GRCh38.104.canonical.tsv.gz&#39; AS row
RETURN row LIMIT 10
```

Loading the same file from local disc with `file:///Homo_sapiens.GRCh38.104.canonical.tsv.gz ` works.

Is there a way to load gzipped CSV files from FTP? I found a blog post saying that you have to set proper content types to make this work for HTTP, but this is not applicable for FTP: https://www.markhneedham.com/blog/2018/09/05/neo4j-load-csv-gz-s3/
",1630079894,https://stackoverflow.com/q/68956342,Martin Preusse,"['ftp', 'neo4j']"
68955662,neo4j order by optional property in descdending order with nulls being at the bottom,"I need to sort nodes by `createdAt` timestamp in descending order. It is an optional parameter. There are old nodes that don&#39;t have this parameter. When I try sorting as suggested in [neo4j doc](https://neo4j.com/docs/cypher-manual/current/clauses/order-by/#order-null):
```
MATCH (node:MyTag)
WHERE ...
RETURN node
ORDER BY node.createdAt DESC
```

I get nodes where `createAt` does not exist before the ones where it exists. How can I get nodes that have createdAt in descending order first and then have the nodes that don&#39;t have createAt field?

Cheers",1630076763,https://stackoverflow.com/q/68955662,almeynman,"['neo4j', 'cypher']"
68951239,Is there an option or a workaround to collapse a node in Neo4j GraphXR view?,"I&#39;ve been working on GraphXR visualizing a graph database built using Neo4j - Cypher. There is an expand option which you can use to display neighbour nodes upto a preferred depth. However, I couldn&#39;t find a collapse/contract option.

The undo button works if I want to collapse a node right after opening it. But if I want to expand two nodes and then collapse the one which I opened first keeping the second node open, the undo option doesn&#39;t work.

Please let me know if there&#39;s any solution to this.",1630057158,https://stackoverflow.com/q/68951239,Hithesh Kk,"['graph-databases', 'graph', 'neo4j']"
68942881,Need to Add new property to all the labels expect the label name not starts like &#39;IA_&#39; in neo4j cypher,"I want to add new property for all lables except the lable name starts with &#39;x&#39;

I have tried the below cyper query but it&#39;s failing.

```
MATCH (n)
WITH DISTINCT labels(n) AS label
UNWIND label AS names
WITH names AS candidate
WHERE candidate =~ &#39;^(.?$|[^I].+|I[^A].*)*&#39;
CALL apoc.create.setProperty(labels(candidate),&#39;link&#39;,&#39;&#39;)
    YIELD node
    return node
```",1629998346,https://stackoverflow.com/q/68942881,Mahesh Jayachandran,"['neo4j', 'cypher']"
68938823,SDN6 - Projection interfaces with Property Mapping,"I am using spring data neo4j 6.1.3 and following is my use case code snippets

Domain Entity

        @Data
        @Node(&quot;DATspace&quot;)
        public class DatSpace {
    
          @Id @GeneratedValue
          private Long neoId;

          @Property(&quot;SUPtitle&quot;)
          private String title;

          private String SUPid;
        }

Test class

    @SpringBootTest
    @EnableNeo4jRepositories(basePackages = &quot;com.rahal.marvel&quot;)
    public class ProjectionTest {
    
       @Autowired
       private Neo4jTemplate neo4jTemplate;
    
       interface DATspaceProjection {
          String getTitle();
          String getSUPid();
       }
    
       @Test
       public void test_projection(){
          DatSpace d = neo4jTemplate.findOne(&quot;MATCH (s:DATspace {SUPid: $id}) RETURN s&quot;, Collections.singletonMap(&quot;id&quot;, &quot;SPC_ML7&quot;), DatSpace.class).get();
    
          d.setTitle(&quot;title modified&quot;);
          d.setSUPid(&quot;SUPid modified&quot;);
    
          DATspaceProjection   p = neo4jTemplate.saveAs(d, DATspaceProjection.class);
       }
    }

Ideally above saveAs function should modify both DATspace.SUPtitle and DATspace.SUPid. However it only modify SUPid but not SUPtitle. I presume it is due to property mapping (@Property) . Is this a bug or are there any workaround?",1629982167,https://stackoverflow.com/q/68938823,Prabudda Sri Rahal,"['neo4j', 'spring-data-neo4j', 'java']"
68930781,Neo4j Install on ubuntu password not working,"I have neo4j enterprise version installed on ubuntu but the password and user isn&#39;t working

![but the password and user isn&#39;t working][1]

I tried 
 - default neo4j password
 - neo4j-admin set-initial-password to set password 
 - setting dbms.security.auth_enabled=false 
 - deleting the auth file from dbms folder 
 
**nothing worked**

also, The DBMS directory is empty

![The dbms directory is empty][2]

so I am assuming I have created an instance yet. I couldn&#39;t find any article on how to create an enterprise neo4j instance in ubuntu


  [1]: https://i.stack.imgur.com/U1nec.png
  [2]: https://i.stack.imgur.com/PaEan.png",1629932841,https://stackoverflow.com/q/68930781,Flora Angel,"['ubuntu', 'neo4jclient', 'neo4j']"
68924990,How to search comma separated greater than or less than values in neo4j,"Can we search greater than comma separated value in Cypher 
Example:
```
MATCH (n:Field)
Where n.name = &quot;square:&quot; AND n.value &gt; &quot;12,196&quot;
RETURN n
``` 
12,196 it means 12 thousand 1 hundred and 96 and i want to search greater than that value
can anyone help me",1629902453,https://stackoverflow.com/q/68924990,nik12,"['c#', 'neo4j', 'cypher']"
68924428,Why does jQAssistent scanning fail?,"I&#39;m scanning our software every night with the jQAssistant Maven plugin. If the Neo4J database is empty, everything is ok. But later, I get a lot of errors:

    00:00:44.150 [WARNING] [0x14d108ce][myneo4jserver:7687][bolt-127303] Fatal error occurred in the pipeline
    00:00:44.150 org.neo4j.driver.exceptions.DatabaseException: The shortest path algorithm does not work when the start and end nodes are the same. This can happen if you
    00:00:44.150 perform a shortestPath search after a cartesian product that might have the same start and end nodes for some
    00:00:44.150 of the rows passed to shortestPath. If you would rather not experience this exception, and can accept the
    00:00:44.150 possibility of missing results for those rows, disable this in the Neo4j configuration by setting
    00:00:44.150 `cypher.forbid_shortestpath_common_nodes` to false. If you cannot accept missing results, and really want the
    00:00:44.150 shortestPath between two common nodes, then re-write the query using a standard Cypher variable length pattern
    00:00:44.150 expression followed by ordering by path length and limiting to one result.
    00:00:44.150 	at org.neo4j.driver.internal.util.ErrorUtil.newNeo4jError(ErrorUtil.java:85)
    ....
    00:00:44.151 [WARNING] [0x14d108ce][myneo4jserver:7687][bolt-127303] Message ignored because of the previous fatal error. Channel will be closed. Message:
    00:00:44.151 b07e
    00:00:44.156 [WARNING] Cannot scan class &#39;/foo/bar/adresse/api/validation/post/web/package-info.class&#39;.
    00:00:44.156 org.neo4j.driver.exceptions.DatabaseException: The shortest path algorithm does not work when the start and end nodes are the same. This can happen if you
    00:00:44.156 perform a shortestPath search after a cartesian product that might have the same start and end nodes for some
    00:00:44.156 of the rows passed to shortestPath. If you would rather not experience this exception, and can accept the
    00:00:44.156 possibility of missing results for those rows, disable this in the Neo4j configuration by setting
    00:00:44.156 `cypher.forbid_shortestpath_common_nodes` to false. If you cannot accept missing results, and really want the
    00:00:44.156 shortestPath between two common nodes, then re-write the query using a standard Cypher variable length pattern
    00:00:44.156 expression followed by ordering by path length and limiting to one result.
    00:00:44.156     at org.neo4j.driver.internal.util.Futures.blockingGet (Futures.java:143)
    ...
    00:00:44.162 [WARNING] Cannot scan class &#39;/foo/bar/adresse/api/validation/post/web/AddressValidationWebServiceClient.class&#39;.
    00:00:44.162 com.buschmais.xo.api.XOException: Cannot execute statement &#39;UNWIND $batch as entry MATCH (n) WHERE id(n)=entry[&#39;id&#39;] SET n+=entry[&#39;n&#39;] RETURN collect(id(n))&#39;, {batch=[{n={valid=false}, id=27127557}]}
    00:00:44.162     at com.buschmais.xo.neo4j.remote.impl.datastore.StatementExecutor.execute (StatementExecutor.java:51)
    ...
    00:00:44.166 Caused by: org.neo4j.driver.exceptions.ClientException: Cannot run more queries in this transaction, it has either experienced an fatal error or was explicitly terminated
    00:00:44.166     at org.neo4j.driver.internal.async.UnmanagedTransaction.ensureCanRunQueries (UnmanagedTransaction.java:240)
    ...

Can someone give me a hint what is going wrong?",1629900360,https://stackoverflow.com/q/68924428,eerriicc,"['neo4j', 'jqassistant']"
68922039,Cypher - conditional where clause,"I am trying to update a users subject name either by id or by name.
Currently the query I have is this:

     MATCH (s:Subject)-[:REGISTERED-BY]-&gt;(u:User{id: 1})
     WHERE s.name=&quot;Math&quot; or s.id=&quot;&quot;
     SET s.name = &quot;Maths&quot;
     RETURN s

If I only use the name without `OR`, it works.
If I only use ID and leave name as an empty string it works.
But if I use the name and leave id empty in the OR clause. The update doesn&#39;t happen
I need to conditionally update the names, depending on whether the name is available or the id. The id field is a UUID.
Is there a way to write that logic in the query itself?
",1629890828,https://stackoverflow.com/q/68922039,DaveM,"['cypher', 'neo4j']"
68921787,Preventing duplicates with multiple collects in cypher query - which is the more canonical approach?,"I was initially caught off guard by `cypher` returning a cross product of multiple `collect` statements for a query.

To remove duplicates in the returned values; which is the more canonical (or otherwise preferred) approach out of the two examples below:

Option A:
```
MATCH (a)
MATCH (a)--&gt;(b)
WITH a, collect(b) as bs
MATCH (a)--&gt;(c)
RETURN a, bs, collect(c) as cs
```

Option B:
```
MATCH (a)
MATCH
    (a)--&gt;(b),
    (a)--&gt;(c)
RETURN
    a,
    collect(DISTINCT b) as bs,
    collect(DISTINCT c) as cs
```
I&#39;m assuming option A has better performance.",1629889810,https://stackoverflow.com/q/68921787,songololo,"['neo4j', 'cypher']"
68919623,neo4j 4.3.3 apoc.periodic.iterate uses only one core : How does param concurrency work?,"&gt; tl;tr:
&gt; 
&gt; `concurrency` works as intended and gives us real parallelism, but watchout for your JVM config in a docker environment

When looking at the [docs of apoc.periodic.iterate][1] there is the param `concurrency` 

The docs explain the param as following:

&gt; number of concurrent tasks are generated when using parallel:true

So when running following Code (on a machine with 64 idle cores):

```cypher
CALL apoc.periodic.iterate(
    &quot;UNWIND range(1, 10) AS x RETURN x&quot;,
    &quot;CALL apoc.util.sleep(1000) RETURN 0&quot;,
    {
      batchSize: 1,
      parallel: true,
      concurrency: 10
    }
 )
```

I would **expect a runtime of ~1 second. But i got 10 seconds**

My expectation is: We have 10 &quot;batches&quot;. Each batch should sleep 1 seconds. All 10 batches should run parallel.

Is my expectation wrong or is Neo4j/apoc buggy?

I know there is a difference between &quot;concurrency&quot; and &quot;parallelism&quot;. The neo4j docs are not really clear what is happening here and mixing the two terms in one function. So maybe we dont really have real parallelism with `apoc.periodic.iterate`? If we dont, is there an alternative to real parallelism (via cypher only)? 

Thanks for any hints!


**UPDATE No1** Added logs:

This is what the logs show (level: debug)

```
2021-08-25 09:32:28.282+0000 INFO  [o.n.k.a.p.GlobalProcedures] starting batching from `UNWIND range(1, 10) AS x RETURN x` operation using iteration `CALL apoc.util.sleep(1000) RETURN 0` in separate thread
2021-08-25 09:32:28.282+0000 DEBUG [o.n.k.a.p.GlobalProcedures] execute in batch no 1 batch size 
2021-08-25 09:32:28.283+0000 DEBUG [o.n.k.a.p.GlobalProcedures] execute in batch no 1 batch size 
2021-08-25 09:32:28.283+0000 DEBUG [o.n.k.a.p.GlobalProcedures] execute in batch no 1 batch size 
2021-08-25 09:32:28.283+0000 DEBUG [o.n.k.a.p.GlobalProcedures] execute in batch no 1 batch size 
2021-08-25 09:32:28.283+0000 DEBUG [o.n.k.a.p.GlobalProcedures] execute in batch no 1 batch size 
2021-08-25 09:32:28.283+0000 DEBUG [o.n.k.a.p.GlobalProcedures] execute in batch no 1 batch size 
2021-08-25 09:32:28.283+0000 DEBUG [o.n.k.a.p.GlobalProcedures] execute in batch no 1 batch size 
2021-08-25 09:32:28.283+0000 DEBUG [o.n.k.a.p.GlobalProcedures] execute in batch no 1 batch size 
2021-08-25 09:32:28.283+0000 DEBUG [o.n.k.a.p.GlobalProcedures] execute in batch no 1 batch size 
2021-08-25 09:32:28.283+0000 DEBUG [o.n.k.a.p.GlobalProcedures] execute in batch no 1 batch size 
```

Result is 

```
╒═════════╤═══════╤═══════════╤═════════════════════╤══════════════════╤═══════════════╤═════════╤═══════════════╤══════════════════════════════════════════════════╤══════════════════════════════════════════════════╤═══════════════╤══════════════╤══════════════════════════════════════════════════════════════════════╕
│&quot;batches&quot;│&quot;total&quot;│&quot;timeTaken&quot;│&quot;committedOperations&quot;│&quot;failedOperations&quot;│&quot;failedBatches&quot;│&quot;retries&quot;│&quot;errorMessages&quot;│&quot;batch&quot;                                           │&quot;operations&quot;                                      │&quot;wasTerminated&quot;│&quot;failedParams&quot;│&quot;updateStatistics&quot;                                                    │
╞═════════╪═══════╪═══════════╪═════════════════════╪══════════════════╪═══════════════╪═════════╪═══════════════╪══════════════════════════════════════════════════╪══════════════════════════════════════════════════╪═══════════════╪══════════════╪══════════════════════════════════════════════════════════════════════╡
│10       │10     │10         │10                   │0                 │0              │0        │{}             │{&quot;total&quot;:10,&quot;committed&quot;:10,&quot;failed&quot;:0,&quot;errors&quot;:{}}│{&quot;total&quot;:10,&quot;committed&quot;:10,&quot;failed&quot;:0,&quot;errors&quot;:{}}│false          │{}            │{&quot;nodesDeleted&quot;:0,&quot;labelsAdded&quot;:0,&quot;relationshipsCreated&quot;:0,&quot;nodesCreat│
│         │       │           │                     │                  │               │         │               │                                                  │                                                  │               │              │ed&quot;:0,&quot;propertiesSet&quot;:0,&quot;relationshipsDeleted&quot;:0,&quot;labelsRemoved&quot;:0}   │
└─────────┴───────┴───────────┴─────────────────────┴──────────────────┴───────────────┴─────────┴───────────────┴──────────────────────────────────────────────────┴──────────────────────────────────────────────────┴───────────────┴──────────────┴────────────────
```

**UPDATE No2** Found the reason and a hotfix:

I guess the issue comes from a weird behavior of the Java VM in combination with my k8s.

I created a java script inside my Neo4j Container:

```java
public class Main {
    public static void main(String[] args) {
        System.out.println(&quot;Runtime.getRuntime().availableProcessors() = &quot; +
                Runtime.getRuntime().availableProcessors());
    }
}
```

This script returned, that Java only sees 1 core:

```
root@neo4j02-prod-5476cd65ff-2wdgk:/tmp# java -cp . main.java
Runtime.getRuntime().availableProcessors() = 1
```

I could hotfix that with the jvm option `-XX:ActiveProcessorCount=60`

```
root@neo4j02-prod-5476cd65ff-2wdgk:/tmp# java -XX:ActiveProcessorCount=60 -cp . main.java
Runtime.getRuntime().availableProcessors() = 60
```

This was the prove for me that the JVM in the default Neo4j docker image, can not provide the correct core count in certain cases.

For now i can hotfix this by passing a `NEO4J_dbms_jvm_additional=-XX:ActiveProcessorCount=60` as ENVvar to my neo4j container. 

**The question now is there a non hardcoded solution to this?**

 


  [1]: https://neo4j.com/labs/apoc/4.1/overview/apoc.periodic/apoc.periodic.iterate/

",1629880976,https://stackoverflow.com/q/68919623,Tim B,"['parallel-processing', 'neo4j-apoc', 'neo4j']"
68912858,Neo4j computed relations,"Assume we have &quot;marriage&quot; objects with relations &quot;spouse1&quot; and &quot;spouse2&quot; to class &quot;Person&quot;.
Is is possible in Neo4J to compute/derive a relation like (p1 -marriedTo -&gt; p2) from the fact that there is a marriage object m with spouse1=p1 and spouse2=p2?

I did not find such a construct in Neo4J. ",1629832066,https://stackoverflow.com/q/68912858,user3065671,"['relation', 'derived', 'neo4j']"
68904827,Query doesn&#39;t work if I move hardcoded quotation marks,"# Brief history #
I have a JavaScript object which stores query templates with `$nameParam` so that it can be replaced with `string.replace()`. Issue is that until now I needed `$nameParam` to be in quotation marks and now I need to get rid of them. Depending on when they are added, the query either works or not. I have observed some interesting behaviour:

# Method which replaces string #
This method basically calls database and gets records. You can see the longest line - it&#39;s responsible for replacing `$nameParam` with the provided parameter.
```
function setupEndpoint(app) {
  app.get(&#39;/neo4jdb/:queryType&#39;,
    async (req, res) =&gt; {
      const session = driver.session();
      res.on(&#39;finish&#39;, () =&gt; session.close());
      try {
        const response = await session.run(queryTemplates[req.params.queryType],
          { nameParam: req.query.name });
        let statement = response.summary.query.text.replace(&#39;$nameParam&#39;, `&quot;${response.summary.query.parameters.nameParam}&quot;`);
        statement = statement.replace(&#39;RETURN&#39;, &#39;\nRETURN&#39;);
        console.info(`Neo4j statement: ${statement}`);
        res.send({ rawItems: response.records, statement });
      } catch (err) {
        console.error(&#39;Error connecting Neo4j&#39;, configs);
        console.error(err);
        res.send({ error: &#39;Error connecting Neo4j&#39; });
      }
    });
}
```


# Working example #
Query template
```
const queryTemplates = {
  getShipsForCompany: `MATCH (A:Company) -[RELATIONSHIP]-&gt; (B:Ship) MATCH (B:Ship)-[RD]-()
  WHERE A.name=$nameParam RETURN B as Ship, A as Company, type(RELATIONSHIP) as R, count(RD) as degree limit 50`
};
```
Replacement
```
response.summary.query.text.replace(&#39;$nameParam&#39;, `&quot;${response.summary.query.parameters.nameParam}&quot;`);
```
Produced output
```
Neo4j statement: MATCH (A:Company) -[RELATIONSHIP]-&gt; (B:Ship) MATCH (B:Ship)-[RD]-() WHERE A.name=&quot;TRINITY HOUSE&quot;
RETURN B as Ship, A as Company, type(RELATIONSHIP) as R, count(RD) as degree limit 50
```

# Not-working example #
Query template
```
const queryTemplates = {
  getShipsForCompany: `MATCH (A:Company) -[RELATIONSHIP]-&gt; (B:Ship) MATCH (B:Ship)-[RD]-()
  WHERE A.name=&quot;$nameParam&quot; RETURN B as Ship, A as Company, type(RELATIONSHIP) as R, count(RD) as degree limit 50`
};
```
Replacement
```
response.summary.query.text.replace(&#39;$nameParam&#39;, `${response.summary.query.parameters.nameParam}`);
```
Produced output
```
Neo4j statement: MATCH (A:Company) -[RELATIONSHIP]-&gt; (B:Ship) MATCH (B:Ship)-[RD]-() WHERE A.name=&quot;TRINITY HOUSE&quot;
RETURN B as Ship, A as Company, type(RELATIONSHIP) as R, count(RD) as degree limit 50
```

# Summary #
Both produced output queries are the same. Why first one returns results and second one is empty? (2nd one copied to DB engine works fine)",1629796444,https://stackoverflow.com/q/68904827,ablaszkiewicz1,"['neo4j', 'javascript', 'cypher']"
68904573,Datetime comparison query doesn&#39;t return any results,"I&#39;m trying to get a simple date-time comparison to work, but the query doesn&#39;t return any results.

The query is
```
MATCH (n:Event) WHERE n.start_datetime &gt; datetime(&quot;2019-06-01T18:40:32.142+0100&quot;)  RETURN n.start_datetime
```
According to [this documentation page][1], this type of comparisons should work. I&#39;ve also tried creating the datetime object explicitly, for instance with `datetime({year: 2019, month: 7})`.

I&#39;ve checked that the `start_datetime` is in fact well formatted, by checking if the values `start_datetime.year` for example was correct, and couldn&#39;t find any error.
Given that all the records in the database are from 2021, the above query should return every event, yet is returning nothing.

Doing the query using only the year comparison instead of doing full datetime comparison works:
```
MATCH (n:Event) WHERE n.start_datetime.year &gt; datetime(&quot;2019-06-01T18:40:32.142+0100&quot;).year  RETURN n.start_datetime
```



  [1]: https://neo4j.com/developer/cypher/dates-datetimes-durations/",1629795370,https://stackoverflow.com/q/68904573,Dominus,['neo4j']
68898380,Getting the top 10 values of a property in Neo4j cypher,"I have a node N1 on my graph. This node has multiple properties. I am interested in properties P1 and P2. For each property P1, there can be multiple &quot;rows&quot; of P2. I want to pull out the top 10 P2&#39;s for each P1 in node N1. 
I have tried the following approach:
```
match (m:N1)
where m.P1 is not null

with m
match(n:N1{P1:m.P1})
where n.P2 is not null
return 
m.P1 as P1_test, n.P2 as P2_test, count(*) as testCount
order by testCount desc
limit 10
```
The above does not give me the right values. 
I have also tried the following:
```
match (n:N1) where n.P1 is not null
with n.P1 as P1_test
match (m:N1{P1:P1_test})
where m.P2 is not null
return
m.P1,
collect (m.P2) as P2_test
```
This doesn&#39;t work and I am not able to add the count in here to limit to the top 10 results of the query.
I&#39;m not sure if I am missing something basic here. Any help in the right direction would be very much appreciated.",1629748814,https://stackoverflow.com/q/68898380,PPSATO,"['neo4j', 'group-by', 'cypher']"
68897676,spring-data-neo4j v6: No converter found capable of converting from type [MyDTO] to type [org.neo4j.driver.Value],"**Situation**

I&#39;m migrating a kotlin spring data neo4j application from `spring-data-neo4j` version `5.2.0.RELEASE` to version `6.0.11`.

The original application has several Repository interfaces with custom queries which take some DTO as a parameter, and use the various DTO fields to construct the query. All those types of queries currently fail with 

    org.springframework.core.convert.ConverterNotFoundException: No converter found capable of converting from type [MyDTO] to type [org.neo4j.driver.Value]

The [reference documentation for spring-data-neo4j v6][1] only provides examples where parameters passed to custom query methods of a `@Repository` interface are of the same type as the `@Node` class associated with that repository. The documentation does not explicitly state that only parameters of the Node class are allowed.

**Question**

Is there any way to pass an arbitrary DTO (not being a `@Node` class) to a custom query method in a `@Repository` interface in spring-data-neo4j **v6** like it was possible in v5?



Code samples
============

**Example node entity**

    @Node
    data class MyEntity(
        @Id
        val attr1: String,
        val attr2: String,
        val attr3: String
    )

**Example DTO**

    data class MyDTO(
        val field1: String,
        val field2: String
    )

**Example Repository interface**

    @Repository
    interface MyRepository : PagingAndSortingRepository&lt;MyEntity, String&gt; {
    
        // ConverterNotFoundException is thrown when this method is called
        @Query(&quot;MATCH (e:MyEntity {attr1: {0}.field1}) &quot; +
               &quot;CREATE (e)-[l:LINK]-&gt;(n:OtherEntity {attr2: {0}.field2))&quot;)
        fun doSomethingWithDto(dto: MyDTO)
    }

Solutions tried so far
======================

**Annotate DTO as if it were a Node entity**

Based on the following found in the reference docs https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#custom-queries.parameters

&gt; Mapped entities (everything with a @Node) passed as parameter to a
&gt; function that is annotated with a custom query will be turned into a
&gt; nested map.

    @Node
    data class MyDTO(
        @Id
        val field1: String,
        val field2: String
    )
 
**Replace `{0}` with `$0` in custom query**

Based on the following found in the reference docs https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#custom-queries.parameters

&gt; You do this exactly the same way as in a standard Cypher query issued
&gt; in the Neo4j Browser or the Cypher-Shell, with the $ syntax (from
&gt; Neo4j 4.0 on upwards, the old {foo} syntax for Cypher parameters has
&gt; been removed from the database). 

... 

&gt; [In the given listing] we are referring to the parameter by its name. 
&gt; You can also use $0 etc. instead.

    @Repository
    interface MyRepository : PagingAndSortingRepository&lt;MyEntity, String&gt; {
        
        // ConverterNotFoundException is thrown when this method is called
        @Query(&quot;MATCH (e:MyEntity {attr1: $0.field1}) &quot; +
               &quot;CREATE (e)-[l:LINK]-&gt;(n:OtherEntity {attr2: $0.field2))&quot;)
        fun doSomethingWithDto(dto: MyDTO)
    }

Details
=======

 - `spring-boot-starter`: `v2.4.10` 
 - `spring-data-neo4j`: `v6.0.12`
 - `neo4j-java-driver`: `v4.1.4` 
 - `Neo4j server version`: `v3.5.29`


  [1]: https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#custom-queries",1629744807,https://stackoverflow.com/q/68897676,Kristel,"['spring', 'neo4j', 'spring-data-neo4j', 'kotlin']"
68895694,Cypher: Avoid cycle in multiple relationship paths,"My website has pages dedicated to some events, represented by nodes in neo4j. Those events possess sub-events which are relationships under neo4j, and which correspond to links on the source page to the target page. I currently have a search engine that highlights the links to the searched events, but it is flawed by cycles in the data model. Indeed it is highlighting all the links that contain cyclic references to the current page if this page contains any link to the searched event.

The aim is therefore to have a query that is able to flag the nodes and relationships which are related to the searched events, without flagging a path only because of cyclic relationships.

I&#39;ve created a small dataset representative of the issue that you can build using this query:
```cypher
CREATE 
    (r:Event:Searched {name:&#39;R&#39;, tag:1}), 
    (d:Event:Searched {name:&#39;D&#39;, tag:1}), 
    (o:Event {name:&#39;O&#39;}), 
    (a:Event {name:&#39;A&#39;}), 
    (b:Event {name:&#39;B&#39;}),
    (c:Event {name:&#39;C&#39;}),
    (e:Event {name:&#39;E&#39;}),
    (o)-[:hasEvent]-&gt;(a),
    (o)-[:hasEvent]-&gt;(e),
    (o)-[:hasEvent]-&gt;(r),
    (o)-[:hasEvent]-&gt;(c),
    (a)-[:hasEvent]-&gt;(b),
    (b)-[:hasEvent]-&gt;(o),
    (c)-[:hasEvent]-&gt;(d)
```
Which produces the following graph:

[![Representative dataset][1]][1]

My aim is to have a query that only fetches nodes C and O, but not A or B, as the only reason they are flagged is that O is already flagged:   

[![Expected query results][2]][2]. 

My current query that I need to fix is the following:
```cypher
MATCH path=(upper:Event)-[:hasEvent*]-&gt;(source:Event:Searched)
RETURN upper
```

I hope you can help me, I couldn&#39;t manage to make similar questions&#39; answers work on my specific case. 
Ideally, the solution shouldn&#39;t be too computing-intensive, as my real model is quite big (2.300.000 nodes and 9.500.000 relationships), and the current indexing in the search engine is already quite slow.  
Thank you in advance for your help


  [1]: https://i.stack.imgur.com/P6utP.png
  [2]: https://i.stack.imgur.com/asZQ6.png",1629734300,https://stackoverflow.com/q/68895694,Eliot Ragueneau,"['neo4j', 'cypher', 'cycle']"
68890871,Arrows are not shown if Limit is above 20,"We retrieve data from a neo4j database and want to display the graphs on a webpage using also streamlit. However if we do not limit the query, the arrows and also the relationships are not shown anymore. If i limit the query to 20 the arrows with the accodring relations are shown. 

this is the code: 
```
components.html(&quot;&quot;&quot;\
                &lt;html&gt;
                &lt;head&gt;
                    &lt;style type=&quot;text/css&quot;&gt;
                    #viz {{
                        width: 1800px;
                        height: 900px;
                    }}
                    &lt;/style&gt;
                    &lt;script src=&quot;https://cdn.neo4jlabs.com/neovis.js/v1.5.0/neovis.js&quot;&gt;&lt;/script&gt;
                &lt;/head&gt;  
                &lt;script type=&quot;text/javascript&quot;&gt;
                    function draw() {{
                        var config = {{
                            container_id: &quot;viz&quot;,
                            server_url: &quot;{uri_neo4j}&quot;,
                            server_user: &quot;{user_neo4j}&quot;,
                            server_password: &quot;{pwd_neo4j}&quot;,
                            labels: {{
                                &quot;FMEA&quot;:{{
                                    &quot;caption&quot;:&quot;clean_text&quot;,
                                    &quot;size&quot;:1.0,
                                    &quot;community&quot;:&quot;community&quot;,
                                    &quot;title_properties&quot;: [
                                        &quot;nickname&quot;,
                                        &quot;clean_text&quot;,
                                        &quot;PID&quot;,
                                        &quot;technology&quot;,
                                        &quot;cell&quot;,
                                        &quot;text&quot;                                       
                                    ]
                                }},  
                                &quot;FA&quot;:{{
                                    &quot;caption&quot;:&quot;clean_text&quot;, 
                                    &quot;size&quot;:1.0,
                                    &quot;community&quot;:&quot;nickname&quot;
                                }}, 
                                &quot;Level1&quot;:{{
                                    &quot;caption&quot;:&quot;clean_text&quot;, 
                                    &quot;size&quot;:1.0,
                                    &quot;community&quot;:&quot;nickname&quot;
                                }},
                                &quot;Level2&quot;:{{
                                    &quot;caption&quot;:&quot;clean_text&quot;,
                                    &quot;size&quot;:1.0,
                                    &quot;community&quot;:&quot;nickname&quot;
                                }}              
                            }},
                            relationships: {{
                                &quot;CAUSES&quot;:{{
                                    &quot;thickness&quot;: &quot;PID&quot;,
                                    &quot;caption&quot;: false
                                    
                                }},
                                &quot;INCLUDES&quot;:{{ 
                                    &quot;thickness&quot;: &quot;PID&quot;,
                                    &quot;caption&quot;: false
                                }}
                            }},
                            &quot;arrows&quot;:true,
                            hierarchical_layout:true,
                            hierarchical_sort_method:&quot;directed&quot;,
                            initial_cypher: &quot;{query}&quot;
                            
                        }};
                        var viz = new NeoVis.default(config);
                        viz.render();
                        }}
                &lt;/script&gt;
                &lt;body onload=&quot;draw()&quot;&gt;
                    &lt;div id=&quot;viz&quot;&gt;&lt;/div&gt;
                &lt;/body&gt; 
                &lt;/html&gt;
            &quot;&quot;&quot;.format(uri_neo4j=uri_neo4j, user_neo4j=user_neo4j, pwd_neo4j=pwd_neo4j, query=query_final),height=1000,width=1500,scrolling=True)
```

Thanks in advance for your hints. ",1629713845,https://stackoverflow.com/q/68890871,fipse,"['neovis', 'neo4j']"
68886871,Return nodes that were deleted successfully,"I am using the following query to delete nodes and the relationships: 

    MATCH (p:Post), (u:User)
    WHERE
     p.name IN [&quot;Latest Post&quot;]
     AND u.id = 1
     AND (p)-[:POST_OWNED_BY]-&gt;(u)
     DETACH DELETE p


If I pass multiple post names, I would like to be able to return the names of the nodes that were successfully deleted.
I use neo4j manager usingExistingOrNewTransaction(session, tx, query) to commit the query.
Any reference or guide on how to return the successfully deleted nodes?
",1629688015,https://stackoverflow.com/q/68886871,StephM,"['cypher', 'neo4j']"
68882713,Neo4j Cypher complex query optimization,"Now I have a graph with millions of nodes and millions of edge relationships. There is a directed relationship between nodes.

Now suppose the node has two states A and B. I want to find all state A nodes on the path that do not have state B. 

As shown in the figure below, there are nodes A--K, and then three of them, E, G and J, are of type B, and the others are of type A.
picture link is https://i.stack.imgur.com/a0yOV.jpg


For node E, its upstream and downstream traversal is shown below, so nodes B, H, K do not meet the requirements.

For node G, its upstream and downstream traversal is shown below, so nodes B, D, K do not meet the requirements.

For node J, its upstream and downstream traversal is shown below, so nodes A, B, C, D, F do not meet the requirements.

So finally only node &quot;I&quot; is the node that meets the requirements.
picture link is https://i.stack.imgur.com/A2eqv.jpg


The case of the above example is a DAG, but the actual situation is that there may be cycle in the graph, including spin cycle (case 1), AB cycle (case 2), large loops (case 3), and complex cycle (case 4)
picture link is https://i.stack.imgur.com/NDpED.jpg
The Cypher query statement I can write

```cypher
MATCH (n:A) 
WHERE NOT exists((n)-[*]-&gt;(:B)) 
  AND NOT exists((n)&lt;-[*]-(:B))
RETURN n;
```

But this query statement is stuck in the case of millions of nodes and millions of edges with a `limit 35`，But in the end there are more than 30,000 nodes that meet the requirements.

Obviously my statement is taking up too much memory, querying out 30+ nodes has taken up almost all the available memory, how can I write a more efficient query?


Here is a example
```cypher
CREATE (a:A{id:&#39;a&#39;}) 
CREATE (b:A{id:&#39;b&#39;})
CREATE (c:A{id:&#39;c&#39;}) 
CREATE (d:A{id:&#39;d&#39;})
CREATE (e:B{id:&#39;e&#39;}) 
CREATE (f:A{id:&#39;f&#39;})
CREATE (g:B{id:&#39;g&#39;}) 
CREATE (h:A{id:&#39;h&#39;})
CREATE (i:A{id:&#39;i&#39;}) 
CREATE (j:B{id:&#39;j&#39;})
CREATE (k:A{id:&#39;k&#39;})
MERGE (a)-[:REF]-&gt;(c)  
MERGE (b)-[:REF]-&gt;(c)  
MERGE (b)-[:REF]-&gt;(d)  
MERGE (b)-[:REF]-&gt;(e)
MERGE (c)-[:REF]-&gt;(f)  
MERGE (d)-[:REF]-&gt;(g)  
MERGE (e)-[:REF]-&gt;(g)  
MERGE (e)-[:REF]-&gt;(h)
MERGE (f)-[:REF]-&gt;(i)  
MERGE (f)-[:REF]-&gt;(j)  
MERGE (f)-[:REF]-&gt;(k)  
MERGE (g)-[:REF]-&gt;(k)
MERGE (g)-[:REF]-&gt;(j)
```
use this code will get the result &#39;i&#39;
```cypher
MATCH (n:A) 
WHERE NOT exists((n)-[*]-&gt;(:B)) 
  AND NOT exists((n)&lt;-[*]-(:B))
RETURN n;
```
But when there are 800,000 nodes (400,000 type A, 400,000 type B) and over 1.4 million edges in the graph, this code cannot run the result


",1629645942,https://stackoverflow.com/q/68882713,郭孟然,"['cypher', 'neo4j']"
68882616,Performant neighbour navigation,"I&#39;ve been using neo4j for a little while now, and come across an issue with performance.

I&#39;ve got a situation where I&#39;m (essentially) modelling a cellular automata in a graph database. It isn&#39;t as simple as GoL and requires a lot of data which is why I opted for a graph database. But similar to a cellular automata nodes are connected to their neighbours and calculate their state based on the state of their neighbours.

As such I want a system like this:

```
TriggerNode --&gt; CalculatesValue --&gt; TriggersEventToNeighbours
ListeningNeighbour --&gt; CalculatesValue --&gt; TriggersEventToTheirNeighbours
ListeningNeighbour --&gt; CalculatesValue --&gt; TriggersEventToTheirNeighbours
ListeningNeighbour --&gt; CalculatesValue --&gt; TriggersEventToTheirNeighbours
...
```

In Neo4j however, using the various drivers, I can see that there will be huge amount of communication overhead between my programming environment and the database via the socket protocol.

I&#39;m looking to eliminate this overhead.

Is there a Neo4j driver which has no performance overhead while going from `node--&gt;relationship--&gt;node`? If not, is there another graph database out there which can be used in this fashion?",1629645175,https://stackoverflow.com/q/68882616,Sancarn,"['graph-databases', 'neo4j']"
68876280,Neo4j Python Driver Syntax Error on MERGE statement,"I wrote a python script to interact with a neo4j db. 

```
result_a = tx.run(&quot;MERGE (n:Word$tag_a { name: $name_a}) ON CREATE SET n.corpus = 1 ON MATCH SET n.corpus = n.corpus + 1 RETURN id(n) AS node_id&quot;, tag_a=tag_a, name_a=name_a)
```

where $tag_a contains a String staring with : and $name_a contains a String 

when I execute my code I get this exception:

```
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: Invalid input &#39;{&#39;: expected &quot;)&quot; (line 1, column 21 (offset: 20))
&quot;MERGE (n:Word$tag_a { name: $name_a}) ON CREATE SET n.corpus = 1 ON MATCH SET n.corpus = n.corpus + 1 RETURN id(n) AS node_id&quot;
                     ^}
```

when I excecute a similar statement in neo4j console I get no error:

```
neo4j@neo4j&gt; MERGE (n:Word:G { name: &#39;test&#39;}) ON CREATE SET n.corpus = 1 ON MATCH SET n.corpus = n.corpus + 1 RETURN id(n) AS node_id
             ;
+---------+
| node_id |
+---------+
| 0       |
+---------+

1 row
ready to start consuming query after 843 ms, results consumed after another 528 ms
Added 1 nodes, Set 2 properties, Added 2 labels
```

It seems that it is not possible to use $tag_a the way I do. Is there a way to solve this without crafting the Query in an possible insecure way?

neo4j version neo4j 4.3.2

python version 3.8.10
",1629575243,https://stackoverflow.com/q/68876280,kevko,"['python-3.8', 'neo4j']"
68869027,org.neo4j.ogm.context.GraphEntityMapper throwing IllegalArgumentException: Can not set Double field to java.math.BigDecimal,"Upgraded existing API to use Neo4j 4.3.3 and `neo4j-ogm-http-driver` to 3.2.25. `spring-boot-starter-data-neo4j` is `2.3.4.Release`. Now if I try to create/fetch a relationship with one of the attribute as Double  using `org.springframework.data.repository` `CrudRepository.save()` and `org.springframework.data.neo4j.repository` `Neo4jRepository.findById()`, it throws below error:

&gt; Found relationship type: OWNS to map to RelationshipEntity: RelationshipEntityName
2021-08-21 00:25:14.780 ERROR 3556 --- [nio-8303-exec-1] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.springframework.dao.InvalidDataAccessApiUsageException: Error mapping GraphModel; nested exception is org.neo4j.ogm.exception.core.MappingException: Error mapping GraphModel] with root cause
````
java.lang.IllegalArgumentException: Can not set java.lang.Double field RelationshipEntityName.percentage to java.math.BigDecimal
	at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:167)
	at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:171)
	at sun.reflect.UnsafeObjectFieldAccessorImpl.set(UnsafeObjectFieldAccessorImpl.java:81)
	at java.lang.reflect.Field.set(Field.java:764)
	at org.neo4j.ogm.metadata.FieldInfo.lambda$write$0(FieldInfo.java:352)
	at java.security.AccessController.doPrivileged(Native Method)
	at org.neo4j.ogm.metadata.FieldInfo.write(FieldInfo.java:349)
	at org.neo4j.ogm.metadata.FieldInfo.write(FieldInfo.java:383)
	at org.neo4j.ogm.context.GraphEntityMapper.writeProperty(GraphEntityMapper.java:305)
	at org.neo4j.ogm.context.GraphEntityMapper.setProperties(GraphEntityMapper.java:268)
	at org.neo4j.ogm.context.GraphEntityMapper.createRelationshipEntity(GraphEntityMapper.java:409)
	at org.neo4j.ogm.context.GraphEntityMapper.mapRelationshipEntity(GraphEntityMapper.java:354)
	at org.neo4j.ogm.context.GraphEntityMapper.mapRelationships(GraphEntityMapper.java:330)
	at org.neo4j.ogm.context.GraphEntityMapper.mapContentOf(GraphEntityMapper.java:158)
	at org.neo4j.ogm.context.GraphEntityMapper.lambda$map$2(GraphEntityMapper.java:115)
	at java.util.ArrayList.forEach(ArrayList.java:1257)
	at org.neo4j.ogm.context.GraphEntityMapper.map(GraphEntityMapper.java:117)
	at org.neo4j.ogm.context.GraphRowModelMapper.map(GraphRowModelMapper.java:60)
	at org.neo4j.ogm.session.delegates.ExecuteQueriesDelegate.lambda$executeAndMap$1(ExecuteQueriesDelegate.java:165)
	at org.neo4j.ogm.session.Neo4jSession.doInTransaction(Neo4jSession.java:590)
	at org.neo4j.ogm.session.Neo4jSession.doInTransaction(Neo4jSession.java:564)
	at org.neo4j.ogm.session.delegates.ExecuteQueriesDelegate.executeAndMap(ExecuteQueriesDelegate.java:150)
	at org.neo4j.ogm.session.delegates.ExecuteQueriesDelegate.query(ExecuteQueriesDelegate.java:117)
	at org.neo4j.ogm.session.Neo4jSession.query(Neo4jSession.java:425)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:282)
	at org.springframework.data.neo4j.transaction.SharedSessionCreator$SharedSessionInvocationHandler.lambda$invoke$1(SharedSessionCreator.java:121)
	at org.springframework.data.neo4j.transaction.SharedSessionCreator$SharedSessionInvocationHandler.invokeInTransaction(SharedSessionCreator.java:159)
	at org.springframework.data.neo4j.transaction.SharedSessionCreator$SharedSessionInvocationHandler.invoke(SharedSessionCreator.java:123)
	at com.sun.proxy.$Proxy88.query(Unknown Source)
	at org.springframework.data.neo4j.repository.query.GraphQueryExecution$SingleEntityExecution.execute(GraphQueryExecution.java:64)
	at org.springframework.data.neo4j.repository.query.GraphRepositoryQuery.doExecute(GraphRepositoryQuery.java:76)
	at org.springframework.data.neo4j.repository.query.AbstractGraphRepositoryQuery.execute(AbstractGraphRepositoryQuery.java:57)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor$QueryMethodInvoker.invoke(QueryExecutorMethodInterceptor.java:195)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:152)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:130)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:367)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:118)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:139)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:95)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:212)
	at com.sun.proxy.$Proxy111.findByResource(Unknown Source)
 ````

I tried changing the attribute percentage to Number, that does not throw the exception but percentage doesn&#39;t get saved.
I do not want to upgrade `spring-boot-starter-data-neo4j` to any major version at this point. 
Upgrading to `Spring-Data-Neo4j` 6.x will again be big migration effort.
I am stuck now.",1629502835,https://stackoverflow.com/q/68869027,np10,"['spring-data-neo4j', 'neo4j']"
68866815,communicating between docker instances of neo4j and express on local machine,"ISSUE: I have a docker image running for neo4j and one for express.js. I cant get the docker images to communicate between eachother.

I can run neo4j desktop, start a nodemon server and they will communicate. 

SETUP:
NEO4J official docker image

 - NEO4J_AUTH none
 - PORTS localhost:7474 localhost:7687
 - Version neo4j-community-4.3.3-unix.tar.gz

NODEJS Image 
 
 - PORTS 0.0.0.0:3000 :::3000
 - Version 14.17.5

Express conf

DEV_DB_USER_NAME=&quot;neo4j&quot;
DEV_DB_PASSWORD=&quot;test&quot;
DEV_DB_URI=&quot;neo4j://localhost&quot; //for image purpose for local its bolt://localhost:7687
DEV_DB_SECRET_KEY=&quot;&quot;

```
 let driver = neo4j.driver(
        envConf.dbUri,  
        neo4j.auth.basic(envConf.dbUserName, envConf.dbUserName)
        );
```

package.json
&quot;@babel/node&quot;: &quot;^7.13.10&quot;,
&quot;neo4j-driver&quot;: &quot;^4.2.3&quot;,


I can remote into the neo4j image through http://localhost:7474/browser/ so its running.

I cannot use the server image to call a local neo4j instance.

when i call the apis in the server image i get these errors

If i use neo4j protocal:

Neo4jError: Could not perform discovery. No routing servers available. Known routing table: RoutingTable[database=default database, expirationTime=0, currentTime=1629484043610, routers=[], readers=[], writers=[]]

If i use bolt protocal:

Neo4jError: Failed to connect to server. Please ensure that your database is listening on the correct host and port and that you have compatible encryption settings both on Neo4j server and driver. Note that the default encryption setting has changed in Neo4j 4.0. Caused by: connect ECONNREFUSED 127.0.0.1:7687


Ive been scouring the documentation for a while any ideas would be most welcome!


",1629485057,https://stackoverflow.com/q/68866815,Cameron Davis,"['express', 'neo4j', 'rest', 'docker', 'node.js']"
68865498,Get Nodes attached to all items in a path including the top element,"I have the following cypher query 
```cypher
MATCH p=(pInit:part{_id:&#39;XXXXXXXXXX&#39;})-[cons:consumes*]-&gt;(items:part) 
OPTIONAL MATCH (items)-[relmop:isMaintainedWithOp]-&gt;(mop:maintenanceOps)   
RETURN p,pInit,relmop,mop 
ORDER BY items._sequence
```

I would like to also get the &#39;mop&#39; (maintenanceOps) attached to &#39;pInit&#39; without having to copy the &quot;optional match&quot; line.
In my actual example I can have up to 6 or 7 lines like the optional Match line. If I have to copy It adds a lot of lines. 

In the previous example the result I would like to avoid is the optional match line which would result in the following query: 

```cypher
MATCH p=(pInit:part{_id:&#39;XXXXXXXXXX&#39;})-[cons:consumes*]-&gt;(items:part) 
OPTIONAL MATCH (items)-[relmop:isMaintainedWithOp]-&gt;(mop:maintenanceOps)   
OPTIONAL MATCH (pInit)-[relmop2:isMaintainedWithOp]-&gt;(mop2:maintenanceOps)  
RETURN p,pInit,relmop,mop,relmop2,mop2
ORDER BY items._sequence
```

Any idea?",1629477693,https://stackoverflow.com/q/68865498,Yoann Maingon,"['neo4j', 'cypher']"
68860277,Adding a python list parameter in a neo4j query,"I&#39;m about to run a query in neo4j with a parameter, but it always returns me an error.

    &gt; query= (&quot;MATCH (p1:Item),(p2:Item) where p1.value=$name
    &gt; RETURN  p1.value AS from, p2.value AS to,
    &gt; gds.alpha.similarity.euclideanDistance((p1.embeddingNode2vec),
    &gt; (p2.embeddingNode2vec)) AS similarity order by similarity desc limit
    &gt; 40&quot;, name=references[2])

the p1.value the first element in the references list. This returns me a                                                                                              

&gt; SyntaxError: invalid syntax

error. Could you please tell me how to run it?
my research so far: https://community.neo4j.com/t/how-to-use-dictionary-parameters-in-python-neo4j/18626",1629453096,https://stackoverflow.com/q/68860277,user12678036,"['python', 'cypher', 'neo4j', 'py2neo']"
68850174,Mounting directory in Neo4j Docker container is resulting in empty directory on MacOS,"I&#39;ve been trying to figure out how to mount data into the neo4j import directory on MacOS. Here is my ```docker-compose.yml```:

```
services:
  neo4j:
    image: docker.io/neo4j:4.3.2
    container_name: neo4j
    ports:
      - 7474:7474
      - 7687:7687
    volumes:
      - $HOME/neo4j/logs:/logs
      - $HOME/neo4j/dummydata:/import
```

As you can see I am trying to mount the dummydata directory, which contains some csv files into the import directory of the neo4j docker container. But when I take a look at the container by running ```docker exec -ti neo4j``` I can see that the import directory is totally empty in the container. I did the same thing for another docker container based on the python:3.8-slim image. Here the csv files were mounted into the container. So that&#39;s why in the end it must come done to some neo4j specific stuff that I don&#39;t get. Does somebody know what I&#39;ve been doing wrong? 

It&#39;s interesting though that the neo4j container was able to write a log file into the logs directory on my local machine. So he is definitely working with the mounted directories.",1629384994,https://stackoverflow.com/q/68850174,mike,"['neo4j', 'docker', 'docker-compose']"
68849216,Neo4j: bad result using the WITH statement,"To import a json into Neo4J, I use these two requests:

Request 1:

    CALL apoc.load.json(&quot;file:///files.json&quot;) yield value
    unwind value.nodes as node
    merge (file:File {id:node.path}) ON CREATE SET file.name = node.name
Request 2:

    CALL apoc.load.json(&quot;file:///files.json&quot;) yield value
    unwind value.edges as edge
    MATCH
        (source:File {id: edge.sourceId}),
        (target:File {id: edge.targetId})
    CREATE (source)-[:`R`]-&gt;(target)

The result is the correct one (254 nodes and 3578 relationships).

Now I will like to merge these two queries into one, so I am using the WITH statement as follows:

    CALL apoc.load.json(&quot;file:///files.json&quot;) yield value
    unwind value.nodes as node
    merge (file:File {id:node.path}) ON CREATE SET file.name = node.name
    WITH value
    unwind value.edges as edge
    MATCH
        (source:File {id: edge.sourceId}),
        (target:File {id: edge.targetId})
    CREATE (source)-[:`R`]-&gt;(target)

I get the right number of nodes but not the right number of edges (254 nodes and 908812 relationships).
Any idea what&#39;s going on here?",1629381373,https://stackoverflow.com/q/68849216,Silta,"['neo4j', 'neo4j-apoc']"
68843899,Construct queries with a condition,"I am using Spring Data [Neo4j][1] and I have a repository like this:

```lang-java
public interface MyNeo4jRepository extends Neo4jRepository&lt;Object, Long&gt; {

    @Query(&quot;with [&#39;X&#39;, &#39;Y&#39;,&#39;Z&#39;] as list_labels, &quot;
            + &quot;$appsFilter as appsList\n &quot;
            + &quot;MATCH (apps:) where apps.n IN appsList &quot;
            + &quot;MATCH (a)&lt;-[:event]-(nodes) &quot;
            + &quot;WHERE any(x IN labels(nodes) WHERE x IN list_labels) &quot;
            + &quot;CALL apoc.path.expandConfig(nodes, { &quot;
            + &quot;relationshipFilter: &#39;R1|R2&gt;&#39;,&quot;
            + &quot;labelFilter: &#39;-l1|&gt;l2&#39;,&quot;
            + &quot;maxLevel: 6,&quot;
            + &quot;endNodes: [apps],&quot;
            + &quot;uniqueness: &#39;NODE_PATH&#39;}) YIELD path &quot;
            + &quot;unwind nodes(path) as n  &quot;
           ...
}
```

I want to create this query using conditions like this:

```lang-java
@Query(&quot;with [&#39;X&#39;, &#39;Y&#39;,&#39;Z&#39;] as list_labels, &quot;
            + &quot;$appsFilter as appsList\n &quot;
            + &quot;MATCH (apps:) where apps.n IN appsList &quot;
            + &quot;MATCH (a)&lt;-[:event]-(nodes) &quot;
            + &quot;WHERE any(x IN labels(nodes) WHERE x IN list_labels) &quot;
           if (condition) + &quot;WHERE  ....&quot; else + &quot;&quot;
            + &quot;CALL apoc.path.expandConfig(nodes, { &quot;
  ...
```

Is there a way to do it in the Neo4j query or do I have to do it with Spring composable repositories?

  [1]: https://en.wikipedia.org/wiki/Neo4j
",1629359257,https://stackoverflow.com/q/68843899,madiskou,"['spring-data-neo4j', 'cypher', 'neo4j', 'neo4j-apoc']"
68840934,Neo4j yield statement within an APOC iterate call?,"I&#39;m currently trying to invert all relationships of a specific type using apoc.refactor.invert. Since there&#39;s millions of these relationships I have to use an iterate statement. Something like:
```
CALL apoc.periodic.iterate(&quot;MATCH ()-[rel:RELATED]-&gt;() RETURN rel&quot;, 
&quot;CALL apoc.refactor.invert(rel) YIELD input, output RETURN input, output&quot;,
{batchSize:1000, parallel: true})
YIELD batches, total RETURN batches, total
```
Except this doesn&#39;t work because you can&#39;t yield return in apoc.iterate. How do I get around this?",1629336086,https://stackoverflow.com/q/68840934,FTRJ,"['neo4j', 'neo4j-apoc', 'cypher']"
68840380,How to extract result from a Cypher query that returns one result?,"I&#39;ve had good luck extracting Cypher query results when the query returns more than one result. However, I recently tried to extract the result from the following Cypher query which returns one and only one result. (I&#39;m running v4.1 of the Community Edition and v4.3.4 of the Java API).
```
Result queryReturnResult = tx.run(&quot;MATCH (sink:Message) WHERE sink.messageID = $sourceParentMessageID RETURN sink.authorID AS sinkAuthorID, sink.experimentID AS sinkExperimentID&quot;, parameters(&quot;sourceParentMessageID&quot;, sourceParentMessageID));

while (queryReturnResult.hasNext())
{
     Record queryRecord = queryReturnResult.next();
     queryResults[0] = queryRecord.get(&quot;sinkAuthorID&quot;).toString();
     queryResults[1] = queryRecord.get(&quot;sinkExperimentID&quot;).toString();
}
```
The code never enters the ```while``` loop because there is no next record. I&#39;ve tried ```single()``` and ```peek()``` against the ```Record``` variable, to no avail. When I execute the same query directly against the database via a browser interface, I get the correct answer.

Is there a trick to extracting a single result from a Cypher query using the Java API?

Thanks so much for your help!",1629329405,https://stackoverflow.com/q/68840380,Ciro Pinto-Coelho,"['cypher', 'neo4j', 'java']"
68833984,Correct way to bulk insert / merge nodes and edges,"I&#39;ve been using `neo4j` with `py2neo` for a couple of weeks now, and up to now it was fine to just do single node transactions, so I would have different node types
```python
class NodeA(GraphObject):
  ...

class NodeB(GraphObject):
  ...

# create some nodes from data and simply save them one by one
for data in dataset:
  node_a = NodeA(data)
  node_b = NodeB(data)

  if x:
    node_a.related_to_b.add(node_b)

  g.merge(node_b)
  g.merge(node_a)
```
Nothing fancy. However, I&#39;m starting to get more nodes and connections, and single transactions don&#39;t really work anymore, as expected. I&#39;ve been looking for ways to do bulk inserts, but can&#39;t find any good ressources. The best I&#39;ve managed to accomplish is using `unwind_merge_nodes_query`, which has two issues:
1. isn&#39;t that fast (~5 seconds for 700 very basic nodes on my laptop)
2. edges need to be handled separately
3. it requires keeping track of all the node ids to be able to handle edge connections

I&#39;ve been writing functions to handle the above mentioned points, but I feel like I&#39;m missing something and that there&#39;s a simpler way to handle batches of data
",1629295648,https://stackoverflow.com/q/68833984,Dominus,"['neo4j', 'py2neo', 'python']"
68833525,To get nodes and relationships between two specified nodes for review,"I have a database containing millions of nodes and edge data and I want to get all the nodes and relationships data between two specified nodes.
Below is the sample data for the graph which has 7 nodes and 7 relationships.
 
To traverse from 1st node to 7th node I can use the variable length relationship approach and can get the nodes and relationships in between the first and 7th nodes (but in this approach we need to know the number of relationships and nodes between 1st and 7th node). 
For using variable length relationship approach we have to specify the number where we will get the end node and it traverses in one direction. 
But in my case I know the start and end node and don&#39;t know how many relationships and nodes are in between them. Please suggest how I can write a Cypher query for this case.

I have used the APOC spanning tree procedure where it returns ‘path’ from the 1st and 7th element, but it does not return the nodes and relationships. Can I get nodes and relationships data in return using the spanning tree procedure and how?

Is there any other way to get all nodes and relations between two nodes without using the APOC procedure?

Here is query with apoc procedure:

    MATCH (start:temp {Name:&quot;Joel&quot;}), (end:temp {Name:&quot;Jack&quot;}) CALL apoc.path.spanningTree(start,{terminatorNodes:[end]}) YIELD path return path

Note: In our graph database nodes can have multi direction relations.

[Sample nodes and relationships snapshot]
: https://i.stack.imgur.com/nN9hk.png",1629293945,https://stackoverflow.com/q/68833525,SOMESH NANDKISHOR PANDE,"['neo4j-apoc', 'cypher', 'neo4j', 'relationship']"
68831773,How to increase performance when creating lots relations in neo4j,"I am working on a crawler to analyze the internal link structure of websites using a [neo4j graph database](https://neo4j.com/) in combination with [spatie crawler](https://github.com/spatie/crawler). 

The idea goes like this:

Whenever a URL is crawled, all Links will be extracted from the DOM. For all links, a node will be created and a relation `foundOn-&gt;target` is added.

```php
// UrlCrawledListener.php

public function handle($event) 
{
//...
    // Extract all links on the page
    $linksOnPage = collect((new DomCrawlerService())-&gt;extractLinksFromHtml($event-&gt;getResponse()-&gt;getBody(), $event-&gt;getUrl()));
    // For all links, create nodes and add relation
    $linksOnPage-&gt;each(fn(Link $link) =&gt; $neo4jService-&gt;link($link, $event-&gt;getUrl()));
//...
}

```


```php
// Neo4JService.php

public function link(Link $link, UriInterface $foundOnUrl): void
{
    $targetUrl = new Uri($link-&gt;getUri());

    if (!$this-&gt;doesNodeExist($targetUrl)) {
        $this-&gt;createNode($targetUrl);
    }

    if (!$this-&gt;doesNodeExist($foundOnUrl)) {
        $this-&gt;createNode($foundOnUrl);
    }

    // When this method call is disabled, the crawler is A LOT faster
    $this-&gt;createRelation($foundOnUrl, $targetUrl);
}

// ...

protected function createNode(UriInterface $uri): void
{
    // Todo: Add atttributes
    $this-&gt;runStatement(
        &#39;USE &#39; . $this-&gt;getDB() . &#39; CREATE (n:URL {url: $url, url_hash: $hash})&#39;,
        [
            &#39;url&#39;  =&gt; $uri-&gt;__toString(),
            &#39;hash&#39; =&gt; CrawlUrl::getUrlHash($uri),
        ]
    );
}

// ...

protected function createRelation(UriInterface $from, UriInterface $to): void
{
    $this-&gt;runStatement(
        &#39;
             USE &#39; . $this-&gt;getDB() . &#39;
             MATCH (a:URL), (b:URL)
             WHERE a.url_hash = $fromURL AND b.url_hash = $toURL
             CREATE (a)-[rel:Link]-&gt;(b)
             &#39;,
        [
            &#39;fromURL&#39; =&gt; CrawlUrl::getUrlHash($from),
            &#39;toURL&#39;   =&gt; CrawlUrl::getUrlHash($to),
        ]
    );
}

``` 

----


## What I tried:

I tried adding an index to the nodes to improve performance on the `MATCH` query, but that did not have a noticeable impact: 
```php
$this-&gt;runStatement(&#39;USE &#39; . $this-&gt;getDB() . &#39; CREATE INDEX url_hash_index FOR (n:URL) ON (n.url_hash)&#39;);
```

I thought about creating them in a single query and not looping all found links, but I only find a documentation on how to [create multiple nodes](https://neo4j.com/docs/cypher-manual/current/clauses/create/#create-create-multiple-nodes-with-a-parameter-for-their-properties) - but nothing on how to create multiple relations. 

I also considered storing everything in another store first and then bulk import this store into neo4j. However, the [documentation on csv imports](https://neo4j.com/developer/guide-import-csv/#_optimizing_load_csv_for_performance) uses exactly the same logic to create the relations, so that would not help neither:

```
// create relationships
LOAD CSV WITH HEADERS FROM &#39;file:///people.csv&#39; AS row
MATCH (e:Employee {employeeId: row.employeeId})
MATCH (c:Company {companyId: row.Company})
MERGE (e)-[:WORKS_FOR]-&gt;(c)
```

----

I already shifted the `-&gt;doesNodeExist()` logic to SQL as this caused the same problem. The `MATCH` cypher seems to be very slow overall. But I can&#39;t imagine that matching against a few hundred nodes can be that slow compared to a SQL database.

Do you have any suggestions on how to either improve the algorithm itself or the neo4j database structure or cypher query to improve performance?",1629287314,https://stackoverflow.com/q/68831773,marks,"['neo4j', 'cypher', 'php', 'neo4jclient']"
68820740,Neo4j - what metrics to alert on?,"I have a nice set of metrics exposed via Prometheus, however I have no clue which neo4j-specific metrics are useful for alerting purposes. Does anyone have any idea? 

I have the following so far:
- leader changing frequently
- cache page faults total rate high

Would appreciate any pointers",1629216671,https://stackoverflow.com/q/68820740,qwerty,['neo4j']
68820602,neo4j: fulltext index on external documents and attachments,"[![simple architecture overview][1]][1]


  [1]: https://i.stack.imgur.com/JapsA.png

This is the situation. Don&#39;t ask why, it is the way it is.
I created a simple fulltext-index over the document-contents by grabbing the content from the document-server and adding the simple unformatted content as a new property (raw_content) to each Document-Object in the neo4jdb.
Then i created a fulltext-index like:
CALL db.index.fulltext.createNodeIndex(&#39;content&#39;, [&#39;Document&#39;], [&#39;title&#39;, &#39;teaser&#39;, &#39;raw_content&#39;])

So far so good. Search works very well.

Now I want to index the attachments. I&#39;ve got Attachment-URLs for each document, which I can call by the docid.
So, before I slide into any antipatterns, I&#39;d like to ask the community, about how to do this. I&#39;ve got two ways on my mind:
1. similar to the way I index the raw_content - is there a way to make Lucene get and parse the URLs, that I give to it?
2. the batch does all the parsing and adds the content to new fields like &quot;attachment01_content&quot; ...

Solution 1 would be appreciated, but i did not find any documentation on this.
Solution 2 is ugly, especially because Lucene can handle with pdf, doc ... 

any ideas on how to solve this?",1629216054,https://stackoverflow.com/q/68820602,Robert Fornesdale,"['full-text-search', 'neo4j', 'indexing', 'search', 'lucene']"
68820402,Modeling SDN network Topology as a Graph in Neo4j,"I developed a Python script to model a SDN (Software Defined Network) topology as a graph in Neo4j. In addition, the Python script can retrieve traffic statistics from the SDN controller to be stored as node &amp;/or relationship properties.

I want to take benefits from this modelling process; I tried to execute shortest path algorithms. Varying the network size has some difficulties. I tried to generate random graphs but it seems not a very good idea.

Do you have suggestions on how to benefit from the different capabilities of Neo4j such as the available GDS algorithms? Any suggestions will be a great help for me. Many thanks in advance.",1629215138,https://stackoverflow.com/q/68820402,Sama,"['sdn', 'neo4j', 'modeling', 'network-traffic']"
68820063,WHERE condition in neo4j | Filtering by relationship property,"How does the `where` condition in neo4j works ? 
I have simple data set with following relationship =&gt; 

```
Client -[CONTAINS {created:&quot;yesterday or today&quot;}]-&gt; Transaction -[INCLUDES]-&gt; Item

```
I would like to filter above to get the items for a transaction which were created yesterday, and I use the following query - 

```{cypher}
Match
 (c:Client) -[r:CONTAINS]-&gt;  (t:Transaction), 
 (t) -[:INCLUDES]-&gt; (i:Item)
 where r.created=&quot;yesterday&quot;
return c,t,i
```

But it still returns the dataset without filtering. What is wrong ? And how does the filtering works in neo4j for multiple `MATCH` statements say when I want to run my query on filetered dataset from previous steps? 

Thank you very much in advance.
  ",1629213974,https://stackoverflow.com/q/68820063,alex,"['cypher', 'neo4j', 'cypher-3.1']"
68819318,Neo4j: Exclude certain nodes in variable path relationship,"I&#39;ve a graph database consisting of two types of nodes - persons and businesses, and one type of relationship - payment. 

A person may pay either another person, or another business. Likewise, a business may pay a person or a business. That is, all these four types of paths are possible

```
(person)-[:PAYS]-&gt;(person)
(person)-[:PAYS]-&gt;(business)
(business)-[:PAYS]-&gt;(person)
(business)-[:PAYS]-&gt;(business)
```

In a use case of detecting possible money laundering, I would like to extract cases where payment made by a person went through several businesses before reaching another person. That is (omitting the relationship for convenience):

```
(person)-(business)-(business)-(business)-(person)
```

My cypher query should therefore look something like this:

```
(person)-[:PAYS*0..3]-(person)
```

However, this will also return me the following relationship, which isn&#39;t what I want:

```
(person)-(business)-(person)-(business)-(person)
```

What can I do to exclude (person) from the variable length relationship [:PAYS*0..3]?

I&#39;ve followed the solution given [here][1] and tried this:

```
MATCH path((person)-[:PAYS*0..3]-(person))
WHERE NONE(n IN nodes(path) WHERE n:person)
RETURN path
```

However, this query ran for a long time before giving an output of zero results (which isn&#39;t correct). Another obvious solution is to change my relationship to make a distinction between [:PAYS_BUSINESS] and [:PAYS_PERSON], but I would find out if a solution is possible without changing my graph schema.


  [1]: https://stackoverflow.com/questions/36439749/neo4j-match-path-exclude-node-with-certain-label",1629211020,https://stackoverflow.com/q/68819318,wanderingcatto,"['neo4j', 'cypher']"
68818336,How to get a node and relations as a list property of a node object in Spring Data neo4j?,"I have a Customer node class like this:
    
    @Node
    public class Customer extends BaseGraphEntity {
        private int customerId;
        private String name;
        private double size;
    
        @Relationship(type = &quot;TRAN&quot;,direction = Relationship.Direction.OUTGOING)
        public Set&lt;Transaction&gt; transactions;
    
        public void inTran(Customer target, int year, double amount) {
            if (transactions == null) {
                transactions = new HashSet&lt;&gt;();
            }
            transactions.add(new Transaction().withAmount(amount).withTarget(target).withYear(year));
        }
    }

And a relationship entity Transaction as:

    @RelationshipProperties
    public class Transaction extends BaseGraphEntity {
        private double amount;
        private int year;
        @TargetNode
        private Customer target;
    }

 This is my repository method:

    public interface GraphRepository extends Neo4jRepository&lt;Customer, Long&gt;{
        @Query(&quot;MATCH (o:Customer{customerId: $customerId})-[t:TRAN]-&gt;(c) where t.year = $year return o,t,c&quot;)
        Customer getRelationsOfACustomer(int customerId, int year);
    }

I checked the query using neo4j client and it returns what I want as shown in image(C1 is main customer):

[![client image][1]][1]


  [1]: https://i.stack.imgur.com/8Vs7I.png

However, I want to cast this result in a singe Customer node with 2 elements in its &quot;transactions&quot; set and I want to keep all properties of Transaction class in the elements of set. But when I run it asks me to convert result into list of customers and when I do I lost transaction properties.

Is it possible to store result in single Customer instance with transactions? If so, how can I do this? I am open for all suggestions. Thanks for any help.",1629207289,https://stackoverflow.com/q/68818336,Harun Acar,"['neo4j', 'spring-data', 'spring-data-jpa']"
68804560,Accessing a remote neo4j database from an Android app,"I&#39;ve created a web crawler that fetches some data that I need for a project, then the program connects to the local database to insert the data.

Everything works fine but now I need to access those data from an Android app, I&#39;ve tried everything I&#39;ve found online but nothing is working.

I&#39;ve tried to edit the `.conf` file adding

```
dbms.default_listen_address=0.0.0.0

dbms.connector.bolt.address=0.0.0.0:7687
```

(even with my PC&#39;s IP address)

No combination seems to work and I don&#39;t know why.

This message shows up when I try to run a query:

    &gt; W/NetUtilInitializations: Failed to find the loopback interface
    &gt; W/Neo4jDriverIO-2: type=1400 audit(0.0:7406337): avc: denied { read }
    &gt; for pid=1323 name=&quot;somaxconn&quot; dev=&quot;proc&quot; ino=17289481
    &gt; scontext=u:r:untrusted_app:s0:c49,c257,c512,c768
    &gt; tcontext=u:object_r:proc_net:s0 tclass=file permissive=0
    &gt; W/MacAddressUtil: Failed to find a usable hardware address from the
    &gt; network interfaces; using random bytes: 44:0c:8c:fd:f7:08:21:b8
    &gt; W/DefaultPromise: An exception was thrown by
    &gt; org.neo4j.driver.internal.async.connection.ChannelConnectedListener.operationComplete()
    &gt;     java.lang.IllegalStateException: channel not registered to an event loop

I wondered if it is possible to access a remote database in this way and if so, can anyone help me solve this problem, please?

Thanks,
Davide",1629124129,https://stackoverflow.com/q/68804560,Davide Moletta,"['android', 'database', 'neo4j', 'java']"
68799008,Neo4j，How to return nodes and relations where pathes between two nodes more than one,"Create sample data, Actually data has 50 thousand Persons, 10 thousand Company.
```
CREATE(p1:Person{name:&quot;p1&quot;})
CREATE(p2:Person{name:&quot;p2&quot;})
CREATE(p3:Person{name:&quot;p3&quot;})
CREATE(c1:Company{name:&quot;c1&quot;})
CREATE(c2:Company{name:&quot;c2&quot;})
CREATE (p1)-[:STAFF]-&gt;(c1)
CREATE (p1)-[:STAFF]-&gt;(c2)
CREATE (p2)-[:STAFF]-&gt;(c1)
CREATE (p2)-[:STAFF]-&gt;(c2)
CREATE (p3)-[:STAFF]-&gt;(c1)
```

 I want to find nodes and relations where paths between two person nodes more than one, in this example(p1,p2).  
I try to query with [example][1], but it is very slowly.


  [1]: https://stackoverflow.com/questions/68650383/return-paths-to-nodes-with-more-than-n-relationships",1629099348,https://stackoverflow.com/q/68799008,distinct,"['cypher', 'neo4j', 'graph']"
68798799,Neo4j 4.3.1: Integration with elog,"I know that in neo4j 4.3.1, we use the date format based on the basic ISO 8601, but for integration with elog, I need only the ISO 8601 format, since at the moment, because of this, I do not have the ability to filter by a time field.

This format is required at the level of the entire database, and not on individual records . It is necessary that the date is in debug.the json was in ISO 8601 format

How i can do it?


Thanks!",1629098345,https://stackoverflow.com/q/68798799,Юлия Жулай,['neo4j']
68797439,Having dynamic Node Type in Neo4j Sink connector,"Im trying to use sink connector to sync data from mongodb.

I receive relationship event as,

    &quot;fullDocument&quot;: {
        &quot;_id&quot;: {
          &quot;$oid&quot;: &quot;6112376c9ade02082f500711&quot;
        },
        &quot;_relatedFromId&quot;: &quot;6112376b9ade02082f5006f6&quot;,
        &quot;_relatedFromType&quot;: &quot;PERSON&quot;,
        &quot;_relatedToIds&quot;: [
          &quot;6112376c9ade02082f500700&quot;,
          &quot;5312475c8ade04052e300919&quot;
        ],
        &quot;_relationshipType&quot;: &quot;AUTHORED&quot;,
        &quot;_relatedToType&quot;: &quot;BOOK&quot;
      }

Here, I have few problems using it.

**CYPHER_TEMPLATE strategy:**

 - I couldn&#39;t specify the node type dynamically. Is there way to specify
   node type dynamically ? 
 - I couldn&#39;t handle all the operations. Is
   there any switch case kind of logic?

**CUD strategy:**
Looks like I can handle multiple operations. But,

 - I need to transform the original mongo document.

 - It doesn&#39;t do node create/merge and relationship with just one event.
   I need to create three events two of them for creating nodes and
   another one for creating relationship. Is there a way to achive this
   just one event?

 - It accepts one relationship at time. ids just accepts one. My use
   case is that I will have a node will have more than a relationship in
   mongo document. How can I handle with one event to create a many
   relationships for a FROM node?",1629088429,https://stackoverflow.com/q/68797439,Selvakumar Ponnusamy,"['neo4j', 'apache-kafka-connect', 'mongodb']"
68794325,"Correct order of operations in neo4j - LOAD, MERGE, MATCH, WITH, SET","I am loading simple csv data into neo4j. The data is simple as follows :- 

```
uniqueId	  compound	   value	category
ACT12_M_609	  mesulfen	    21	    carbon
ACT12_M_609	  MNAF	        23	    carbon
ACT12_M_609	  nifluridide	20	    suphate
ACT12_M_609	  sulfur	    23	    carbon

```
I am loading the data from the URL using the following query - 

```
LOAD CSV WITH HEADERS
FROM &quot;url&quot;
AS row
MERGE( t: Transaction { transactionId: row.uniqueId })
MERGE(c:Compound {name: row.compound})
MERGE (t)-[r:CONTAINS]-&gt;(c) 
ON CREATE SET c.category= row.category
ON CREATE SET r.price =row.value

```
Next I do the aggregation to count total orders for a compound and create property for a node in the following way - 
```
MATCH (c:Compound) &lt;-[:CONTAINS]- (t:Transaction)
with c.name as name, count( distinct t.transactionId) as ord
set c.orders = ord
``` 
So far so good. I can accomplish what I want but I have the following 2 questions - 

 1. How can I create the `orders` property for `compound` node in the first step itself? .i.e. when I am loading the data I would like to perform the aggregation straight away.
 2. For a compound node I am also setting the property for category. Theoretically, it can also be modelled as `category -contains-&gt; compound` by creating `Category`node. But what advantage will I have if I do it? Because I can execute the queries and get the expected output without creating this additional node. 

Thank you for your answer. ",1629052099,https://stackoverflow.com/q/68794325,newbie,"['cypher', 'nosql', 'neo4j']"
68794217,How to use a Stored Graph in Graph Catalog in Dijkstra Source-Target Algorithm in Neo4j,"I created a graph using graph generator algorithm as follow:

    CALL gds.beta.graph.generate(&#39;test&#39;, 3, 2, { relationshipDistribution : &#39;random&#39;,
    relationshipProperty: { name:&#39;,cost&#39;, type: &#39;RANDOM&#39;, min : 40.0, max : 80.0 } }) 
    YIELD 
    name, 
    nodes, relationships, generateMillis, relationshipSeed, averageDegree, 
    relationshipDistribution, 
    relationshipProperty


Here a graph named test is created and stored in the graph catalog. As depicted in Link_1, the generated graph can be used as input for any algorithm in the library.
Now to use the generated graph in Dijkstra Source-Target Algorithm, I run the following cypher:

    MATCH (source:host {name: &#39;node_1&#39;}), (target:host {name: &#39;node_2&#39;}) 
    CALL gds.shortestPath.dijkstra.stream(&#39;myGraph&#39;, { sourceNode: source, targetNode: target,
    relationshipWeightProperty: &#39;cost&#39; }) YIELD index, sourceNode, targetNode, totalCost, nodeIds, 
    costs, path RETURN index, gds.util.asNode(sourceNode).name AS sourceNodeName, 
    gds.util.asNode(targetNode).name AS targetNodeName, totalCost, [nodeId IN nodeIds | 
    gds.util.asNode(nodeId).name] AS nodeNames, costs, nodes(path) as path ORDER BY index

How can I set the node names in the generated graph to be used as Source-Target in the Dijkstra Algorithm?


",1629051153,https://stackoverflow.com/q/68794217,Sama,"['dijkstra', 'catalog', 'neo4j']"
68792306,Neo4j - Create subgraph - java.lang.ArrayIndexOutOfBoundsException,"All,

I am getting an error when trying to create a subgraph using gds.beta.graph.create.subgraph

I am using Neo4j community edition version 4.2.7
gds version 1.6.4
machine memory 64G

First, I run gds.graph.create.cypher to create a graph filtered by date, returning a set of edge integer properties.

    CALL gds.graph.create.cypher(&#39;date_20200519&#39;,
    &#39;MATCH (p)-[{data: date(&quot;2020-05-19&quot;)}]-()
    RETURN DISTINCT id(p) as id&#39;,
    &#39;MATCH (p1)-[r {data: date(&quot;2020-05-19&quot;)}]-&gt;(p2)
    RETURN id(p1) as source, id(p2) as target, r.atrib_resp as atrib_resp, r.conflito as conflito, r.moralidade as moralidade, r.conseq_pandemia as conseq_pandemia, r.med_contencao as med_contencao, r.met_tratamento as met_tratamento&#39;)
    YIELD graphName, nodeCount, relationshipCount, createMillis;

graphName - &quot;date_20200519&quot;
nodeCount - 222.244
relationshipCount - 444.246
createMillis - 795277

This is ok. I can run a pageRank over this graph without problems. When I try to create a subgraph, filtering by one of the properties I get an error:

    CALL gds.beta.graph.create.subgraph(&#39;date_20200519_atrib_resp_subgraph&#39;, &#39;date_20200519&#39;, &#39;*&#39;, &#39;r.atrib_resp = 1&#39;)
    YIELD graphName, fromGraphName, nodeCount, relationshipCount

ERROR Neo.ClientError.Procedure.ProcedureCallFailed
Failed to invoke procedure gds.beta.graph.create.subgraph: Caused by: java.lang.ArrayIndexOutOfBoundsException: Index 45647 out of bounds for length 3473

Please, could someone help me?

Thank you in advance, Laufer",1629036585,https://stackoverflow.com/q/68792306,Laufer,['neo4j']
68789753,Neo4j: It possible to set nodes color programmatically?,"As mentioned, I wonder whether there is a command to assign a random color to nodes? I am using the free community version of neo4j.",1629014836,https://stackoverflow.com/q/68789753,Volatil3,['neo4j']
68789652,how to replace a property in a neo4j relationship,"I&#39;m new to NEO4j and Keetle etl.

Now I am trying to replace property value &quot;costPerTon&quot; in a relationship :COMPANY_COST_FOR_PRODUCT_{period}_{company}

I have the value calculated in Kettle and try to import them using Neo4j Cypher, but I don&#39;t know how to write this cypher...

should I use Merge or Set?",1629013834,https://stackoverflow.com/q/68789652,Momoe,"['cypher', 'neo4j']"
68789085,"Filter a list with multiple conditions using WITH in Cypher,Neo4j","I&#39;m new to Neo4j. I&#39;m kind of got stuck for loading a JSON file into Neo4j database.
I have a list of tags for many transactions. Each transaction tag can have one or two tags: third-party and category. 

Here is an example JSON.
```
{
    &quot;tags&quot;: [
        [
            {
                &quot;thirdParty&quot;: &quot;Supermarkets&quot;
            },
            {
                &quot;category&quot;: &quot;Groceries&quot;
            }
        ],
        [
            {
                &quot;category&quot;: &quot;Rent&quot;
            }
        ],
        [
            {
                &quot;thirdParty&quot;: &quot;Education&quot;
            },
            {
                &quot;category&quot;: &quot;Education&quot;
            }
        ]
        .....
    ]
}
```

I only want to find objects that have both category and thirdParty(some objects only have one tag).

And here is my code, the list is just a list of categories I want.

```
CALL apoc.load.json(&quot;file:///full.json&quot;)
YIELD value
with [&#39;Gambling&#39;,&#39;Subscription TV&#39;,&#39;Telecommunications&#39;] as list
UNWIND value.tags as tags
WITH [tag in tags where tag.category IN list AND tag.thirdParty IS NOT NULL] AS temp
RETURN temp
```

The weird thing is this always return me a list null. But with only one condition then it will work, like only find objects in the list or only thirdParty is not null.
But combine the 2 conditions together, it will always return a list of null.

Does anyone know how to fix this?

Thanks ",1629007290,https://stackoverflow.com/q/68789085,ZXwwww,"['cypher', 'neo4j', 'json', 'graph-databases', 'neo4j-apoc']"
68785613,Neo4j 4.3 - Deprecation of size function and pattern comprehension,"In Neo4j 4.3, I get a deprecation warning for the function `size` with the following text: 

```
A pattern expression should only be used in order to test the existence of a pattern. It should therefore only be used in contexts that evaluate to a boolean, e.g. inside the function exists() or in a WHERE-clause. All other uses are deprecated and should be replaced by a pattern comprehension.
```

and I have this query: 

```
MATCH (user:User {id: &quot;ffca99b2-0842-491d-b51f-b7c76109e355&quot;})
RETURN user, 
       size((user)-[:FOLLOWS]-&gt;(:User)) as numberOfFollowing // This is deprecated
```

I found a way to make it work without the deprecation that I find quite uglier than the previous one.

```
MATCH (user:User {id: &quot;ffca99b2-0842-491d-b51f-b7c76109e355&quot;})
RETURN user, 
       size([(user)-[:FOLLOWS]-&gt;(other:User) | user]) as numberOfFollowing // No more deprecation
```

My question is: Is that the only way to get the size of a pattern anymore, or is there a better way? I haven&#39;t found any documentation about it, and the official documentation does not say that `size` is deprecated: https://neo4j.com/docs/cypher-manual/current/functions/scalar/#functions-size-of-pattern-expression
",1628962417,https://stackoverflow.com/q/68785613,Sunny Pelletier,"['cypher', 'neo4j']"
68784224,GraphQL: Stop Neo4jGraphQL translate my models during generation,"I&#39;m an experienced developer, but rather new to GraphQL.
I use [this Neo4j-Tutorial as a basis][1] for orientation and am developing in typescript (backend and frontend).

Can anyone tell me how to **somehow rename the generated Endpoints** from `@neo4j/graphql`? The [corresponding docs][2] don&#39;t help with that.

I use the following GraphQL-Schema for demonstration (it&#39;s german: &quot;Person&quot; means &quot;person&quot; and &quot;Tier&quot; means &quot;animal&quot;):

```graphql
type Person {
  name: String
}

type Tier {
  name: String
}
```

I process the schema using the `gql`-Function (from `apollo-server`) first, the result of that does look OK.

Afterwards, when I call `const neoSchema = new Neo4jGraphQL({ typeDefs, driver: drv })` (with drv being my Neo4j-Driver) the resulting `neoSchema.schema` shows up some unexpected naming in the generated endpoints, e.g.:

```
    CreatePeopleMutationResponse: CreatePeopleMutationResponse,
    UpdatePeopleMutationResponse: UpdatePeopleMutationResponse,
```

Somehow the german &quot;Person&quot; (plural being *&quot;Personen&quot;*) got implicitly translated to *&quot;people&quot;*. I can also think of some &quot;false friends&quot; where this effect is even worse.

Well, the API should be in my own language (following DDD), so that&#39;s a smell I want to rename also having the api-users and generated clients in mind. How is that possible?

Thank you!

  [1]: https://neo4j.com/docs/graphql-manual/current/getting-started/
  [2]: https://neo4j.com/docs/graphql-manual/2.0/",1628951384,https://stackoverflow.com/q/68784224,SimplyComple0x78,"['neo4j', 'graphql-schema', 'graphql']"
68783594,neo4j cyper to delete and upsert relationship in single query using UNWIND,"I&#39;m trying to DELETE and UPSERT relationship in a single query by using UNWIND

    UNWIND [{id:54,read:true,is_delete:true,language:{name:&#39;english&#39;}},
    {read:true,is_delete:false,language:{name:&#39;german&#39;}}] AS obj
    MATCH (m:PERSON {name: &#39;Max&#39;})
    MATCH (l:LANGUAGE)
    RETURN obj,
        CASE WHEN (obj.is_delete = true)
            THEN
                //delete query 
                // (m) working
                // MATCH (m)-[r:KNOWS]-&gt;(l) delete r
            ELSE 
                //upsert query (MERGE)
            END as result

which throws below error, when i use MATCH query in THEN condition

&gt; Invalid input &#39;&gt;&#39;: expected &quot;+&quot; or &quot;-&quot; (line 8, column 33 (offset:
&gt; 275)) &quot;            MATCH (m)-[r:KNOWS]-&gt;(l)&quot;

If the CASE statement after RETURN only intended for filtering or manipulating values after result is obtained, please do suggest an appropriate query.",1628946676,https://stackoverflow.com/q/68783594,CdVr,"['cypher', 'neo4j']"
68782011,Cypher: implement EXISTS sub query functionality with a CALL sub query,"suppose I have a match: `MATCH (from: FromLabel)-[:REL_LABEL]-(to: ToLabel)`

I want to be able to filter out `some` nodes based on whether a path to a specific `OtherLabel` nodes exists AND based on some additional aggregational calculation. Something like that:
```
MATCH (from: FromLabel)-[:REL_LABEL]-(to: ToLabel)
WHERE EXISTS {
MATCH (from: FromLabel)-[:OTHER_REL_LABEL]-(other: OtherLabel)
with other
// ** here goes some more possible match where based on other
}
``` 
But I simply can&#39;t since, EXISTS{...} would only take a single `match(...) where(...)` clause

**Question** how can I implement a richer Exists functionality with  CALL sub query?",1628933267,https://stackoverflow.com/q/68782011,Asher Yartsev,"['cypher', 'neo4j']"
68781515,Can&#39;t run the node2vec algorithm with two weighted relationships,"I&#39;m trying to run node two vec with two weighted relationships. First of all I&#39;m creating the graph like this:
   

    CALL gds.graph.create(&#39;test23&#39;,&#39;*&#39;,
     {hasprop:{type:&#39;HAS_PROPERTIES&#39;, orientation:&#39;UNDIRECTED&#39;, properties:&#39;weight2&#39;},   
     locin:{type:&#39;LOCATES_IN&#39;, orientation:&#39;UNDIRECTED&#39;, properties:&#39;weight&#39;} })

Node2vec Run

    CALL gds.beta.node2vec.write(&#39;test23&#39;, 
    {embeddingDimension: 10, writeProperty: &quot;embeddingNode2vec&quot;,
     relationshipTypes:[&#39;locin&#39;,&#39;hasprop&#39;] 
    ,relationshipWeightProperty:&#39;weight, weight2&#39; } )

It returns me the following error:

&gt; Relationship weight property `weight, weight2` not found in
&gt; relationship types [&#39;hasprop&#39;, &#39;locin&#39;]. Properties existing on all
&gt; relationship types: []

But when I&#39;m running the cypher query with a single relationship type e.g. &#39;hasprop&#39; everything works fine. Can you please tell me what to do?",1628928630,https://stackoverflow.com/q/68781515,user12678036,"['graph-algorithm', 'neo4j']"
68774632,Is there a SQL query or procedure in Oracle 11g doing the same as Neo4j Cypher query in order to filter shortestpath?,"I got an old sever with oracle 11g.
There is a relationship/edge table like:
```
CREATE TABLE Graph (
   PA VARCHAR (5), 
   PB VARCHAR (5), 
   Distance INT,
   Type VARCHAR (5) ,
   ) 
 
INSERT INTO Graph VALUES 
(&#39;A&#39;, &#39;B&#39;, 1,&#39;ordered&#39;), 
(&#39;B&#39;, &#39;C&#39;, 1,&#39;promised&#39;), 
(&#39;C&#39;, &#39;A&#39;, 1,&#39;helped&#39;), 
(&#39;A&#39;, &#39;E&#39;, 1,&#39;hired&#39;), 
(&#39;E&#39;, &#39;A&#39;, 1,&#39;ordered&#39;), 
(&#39;D&#39;, &#39;B&#39;, 1,&#39;hired&#39;)
```
[![][1]][1]

In neo4j the query like
```
MATCH p=shortestpath((a)-[r*1..3]-(p)) where a&lt;&gt;p and a.name=&quot;A&quot; RETURN p,p.length
```
The result might be like
```
Path(varchar)                  Length(int)
A&lt;-ordered-E                   1
A-ordered-&gt;B                   1
A-ordered-&gt;B&lt;-hired-D          2
A&lt;-helped-C                    1
```
i.e.

1.It&#39;s different from ```shortestpath((a)-[r*1..3]-&gt;(p))```.

2.Limit the max length of path ```between 1 and 3```.

3.Show the route with relationship type using string and shortest path length using int.

Is there any elegant and efficient way in oracle to do this?
Maybe `SYS_CONNECT_BY_PATH` but how to generate the path string with relationship type?




  [1]: https://i.stack.imgur.com/228iq.png",1628867241,https://stackoverflow.com/q/68774632,WilsonF,"['shortest-path', 'oracle', 'neo4j']"
68770454,py2neo recursive matching,"I&#39;m playing with py2neo and now the I&#39;m looking for the most convenient manner to find all children of a specific node using recursion. 

What I&#39;m looking for is the following idea:

```lang-cypher
MATCH (:LabelA {id:&quot;C&quot;})-[:to*]-&gt;(m:LabelA) RETURN n;
```

This is what it would look like in cypher. I know this query can be run with graph.run() and by passing this query. But I was wondering if somebody knows if it is possible using the graph.match() code?

Finding the first node is possible with:
```lang-python
sNode = graph.nodes.match(id=&quot;C&quot;).first()
firstNode = graph.match((sNode, ), r_type=&quot;to&quot;)
```

and I&#39;m hoping there is a construct such as (I tried this and this does not work :) ):
```lang-python
sNode = graph.nodes.match(id=&quot;C&quot;).first()
nodesFound = graph.match((sNode, ), r_type=&quot;to*&quot;)
#do something with nodesFound
```
that would return all recursively found nodes in a list or so.

Does anyone have experience with this?
",1628849462,https://stackoverflow.com/q/68770454,Erik,"['neo4j-driver', 'py2neo', 'neo4j', 'python']"
68767374,how we can set Pipeline for postgres database to neo4j database?,"I am planning to use Neo4j Graph database for website to show feed similar to linked in. I have tried the Neo4j in my local system it works but I am bit confuse in how I can migrate my PostgreSQL data to Neo4j and how to set pipeline so it can load data to neo4j regularly.

Can anyone suggest me good way to handle this?  ",1628833731,https://stackoverflow.com/q/68767374,Prashant Suthar,"['postgresql', 'neo4j', 'graph-databases', 'migrate']"
68761260,Neo4J crashes after installing APOC plugin,"I&#39;m trying to install the APOC Full jar file (4.2.0.6) to my Neo4J instance that&#39;s running in a Google Compute VM. To do so, I&#39;ve installed the JAR file from GitHub releases to the `/plugins` folder. Each time I restart or run the environment it crashes with the following output to logs:
```
&quot;Some jar procedure files (apoc-4.2.0.6-all.jar) are invalid, see log for details.&quot;
```
There&#39;s really no additional details provided...

If I copy the default APOC Core library found withing `/labs`, it works. I&#39;ve tried to download this same file from Github and it fails. I&#39;ve verified that the same user/group permissions are applied to the downloaded file as well.

Any ideas?",1628786323,https://stackoverflow.com/q/68761260,David Beaudway,"['spring-data-neo4j', 'neo4j']"
68754469,Cypher - Gantt chart from variable length relationships,"I&#39;m new to Cypher, self taught so far. I&#39;ve managed to get creative with basic queries but am now hitting something I have no idea how to achieve....

Given a list of job ID dependencies:

    │&quot;A&quot;│&quot;Rel&quot;        │&quot;B&quot;│
    │29 │&quot;DependantOn&quot; │8 │
    │21 │&quot;DependantOn&quot; │8 │
    │20 │&quot;DependantOn&quot; │8 │
    │22 │&quot;DependantOn&quot; │8 │
    │24 │&quot;DependantOn&quot; │9 │
    │25 │&quot;DependantOn&quot;│9 │
    │23 │&quot;DependantOn&quot;│9 │
    │26 │&quot;DependantOn&quot;│11│
    │20 │&quot;DependantOn&quot;│11│
    │22 │&quot;DependantOn&quot;│11│
    │31 │&quot;DependantOn&quot;│23│
    │8  │&quot;DependantOn&quot;│1│
    │11 │&quot;DependantOn&quot;│1│
    │29 │&quot;DependantOn&quot;│1│
    │20 │&quot;DependantOn&quot;│1│
    │20 │&quot;DependantOn&quot;│10│
    │30 │&quot;DependantOn&quot;│10│
    │30 │&quot;DependantOn&quot;│20│
    │16 │&quot;DependantOn&quot;│5│
    │16 │&quot;DependantOn&quot;│5│
    │17 │&quot;DependantOn&quot;│5│
    │12 │&quot;DependantOn&quot;│5│
    │9  │&quot;DependantOn&quot;│2│
    │28 │&quot;DependantOn&quot;│2│
    │13 │&quot;DependantOn&quot;│2│
    │27 │&quot;DependantOn&quot;│13│
    │28 │&quot;DependantOn&quot;│13│
    │29 │&quot;DependantOn&quot;│15│
    │30 │&quot;DependantOn&quot;│15│
    │25 │&quot;DependantOn&quot;│14│
    │31 │&quot;DependantOn&quot;│14│
    │9  │&quot;DependantOn&quot;│3│
    │25 │&quot;DependantOn&quot;│3│
    │23 │&quot;DependantOn&quot;│3│
    │27 │&quot;DependantOn&quot;│3│
    │23 │&quot;DependantOn&quot;│12│
    │31 │&quot;DependantOn&quot;│12│
    │25 │&quot;DependantOn&quot;│6│
    │14 │&quot;DependantOn&quot;│6│
    │31 │&quot;DependantOn&quot;│6│
    │29 │&quot;DependantOn&quot;│7│
    │30 │&quot;DependantOn&quot;│7│
    │15│&quot;DependantOn&quot;│7│
    │10│&quot;DependantOn&quot;│4│
    │18│&quot;DependantOn&quot;│4│
    │19│&quot;DependantOn&quot;│4│

I&#39;d like to create a table to show the job&#39;s run Level based on the longest path and to show that longest path, like a Gnatt chart:


    &gt; L1 &gt;&gt;&gt;  L2 &gt;&gt;&gt; L3 &gt;&gt;&gt; L4
    &gt; 1  &gt;&gt;&gt;   8 &gt;&gt;&gt;  20
    &gt;          8 &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 29
    &gt;          8 &gt;&gt;&gt;  21
    &gt;          8 &gt;&gt;&gt;  22
    &gt; 2  &gt;&gt;&gt;   9 &gt;&gt;&gt;  23
    &gt; 3  &gt;&gt;&gt;   9
    &gt;          9 &gt;&gt;&gt;  24
    &gt;          9 &gt;&gt;&gt;  25
    &gt; 4  &gt;&gt;&gt;  10 &gt;&gt;&gt;  20
    &gt;         11 &gt;&gt;&gt;  20
    &gt; 1  &gt;&gt;&gt;  11 &gt;&gt;&gt;  26
    &gt; 1  &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt;  20 &gt;&gt;&gt; 30
    &gt; 5  &gt;&gt;&gt;  12 &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 31
    &gt; 2  &gt;&gt;&gt;  13 &gt;&gt;&gt;  27
    &gt; 3  &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt;  23 &gt;&gt;&gt; 31
    &gt;         12 &gt;&gt;&gt;  23
    &gt; 6  &gt;&gt;&gt;  14 &gt;&gt;&gt;  25
    &gt; 7  &gt;&gt;&gt;  15 &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 29
    &gt;         11 &gt;&gt;&gt;  22
    &gt; 1  &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 29
    &gt;         10 &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 30
    &gt; 5  &gt;&gt;&gt;  16
    &gt; 5  &gt;&gt;&gt;  17
    &gt; 2  &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt;  28
    &gt;         13 &gt;&gt;&gt;  28
    &gt;         15 &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 30
    &gt;         14 &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 31
    &gt; 3  &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt;  25
    &gt; 3  &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt;  27
    &gt; 6  &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt;  25
    &gt; 6  &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 31
    &gt; 7  &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 29
    &gt; 7  &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; &gt;&gt;&gt; 30
    &gt; 4  &gt;&gt;&gt;  18
    &gt; 4  &gt;&gt;&gt;  19

	
I tried using `(:File)-[:DependantOn*3]-&gt;(:File)` and `collect with` the same for `*2, *1, *0` and then sort, but this didn&#39;t work. I need some way to identify what&#39;s a L1, L2, L3, L4 AND what the longest path is, allocate them to the correct level with the &quot;nulls&quot; becoming &quot;&gt;&gt;&gt;&quot; where applicable.

I can&#39;t use [*] or (*) as there are many other nodes and relationships off these nodes (such as file content, data types etc.)

Any pointer would be helpful.
",1628759027,https://stackoverflow.com/q/68754469,bazza,"['cypher', 'neo4j', 'gantt-chart', 'variable-length', 'relationship']"
68754103,There is no procedure with the name apoc.refactor.cloneSubgraphfrompaths register for this database instance,"There is no procedure with the name apoc.refactor.cloneSubgraphfrompaths register for this database instance. Please ensure you have spelled the procedure name correctly  and that procedure is properly deployed

Even i have added all apoc related libs in plugin directory of Neo4j Database.",1628757355,https://stackoverflow.com/q/68754103,Mahesh Jayachandran,['neo4j']
68751260,Neo4j Cypher Query ERROR: NoLock[Pipeline[2]] is already locked,"I am new to use neo4j. 

I wrote a python client to do cypher query via bolt to neo4j. The neo4j version is 4.2.9.

The cypher is designed to do 3-hop queries as showed below
```
match (n1:MyNode)-[:MyEdge*0..3]-&gt;(n2:MyNode) where id(n1)=123123 return count(distinct n2)
```

The problems is queries via bolt failed sometimes. And the neo4j server got errors in neo4j.log as showed below.

```
2021-08-12 03:12:19.517+0000 ERROR id:3721 - 312165 ms: 32990552712 B - bolt-session    bolt    neo4j-python/4.2.0 Python/3.6.9-final-0 (linux)         client/127.0.0.1:43524  server/127.0.0.1:7687&gt;  twitter - neo4j - match (n1:MyNode)-[:MyEdge*0..3]-&gt;(n2:MyNode) where id(n1)=$root return count(distinct n2) - {root: 21250581} - runtime=pipelined - {} - NoLock[Pipeline[2]] is already locked
```


The code fragment:
```
class Neo4jQueryRunner():
    def __init__(self):
        url = os.environ.get(&quot;NEO4J_BOLT&quot;, &quot;bolt://127.0.0.1:7687&quot;)
        self.driver = GraphDatabase.driver(url, auth=basic_auth(&quot;neo4j&quot;, &quot;benchmark&quot;))
        self.session = self.driver.session()

    def khop(self, root, depth, api=&quot;cypher&quot;):
        try:
            if api == &quot;cypher&quot;:
                result = self.session.run(&quot;match (n1:MyNode)-[:MyEdge*0..&quot; + str(
                    depth) + &quot;]-&gt;(n2:MyNode) where id(n1)=$root return count(distinct n2)&quot;, {&quot;root&quot;: int(root)})
                record = result.peek()
            # elif api == &quot;apoc&quot;:
            #     # TODO
            #     result = self.session.run(&quot;match (n1:MyNode)-[:MyEdge*0..&quot; + str(
            #         depth) + &quot;]-&gt;(n2:MyNode) where n1.id={root} return count(distinct n2)&quot;, {&quot;root&quot;: root})
            #     record = result.peek()
            else:
                self.session.close()
                self.session = self.driver.session()
                return -1  # timeout, we return -1, reset session
        except Exception as e:
            print(&quot;Khop query got exception: {}&quot;.format(str(e)))
            self.session.close()
            self.session = self.driver.session()
            return -1  # timeout, we return -1, reset session
        else:
            return record[&quot;count(distinct n2)&quot;]
```



Could you plz somebody help me out what is going on?",1628739206,https://stackoverflow.com/q/68751260,ShepherdQi,"['neo4j', 'cypher']"
68748783,Return all paths and cost between two nodes in neo4j,"I already find all paths between two nodes, but I need their cost(weight).

    CREATE (a:Location {name: &#39;A&#39;}),
    (b:Location {name: &#39;B&#39;}),
    (c:Location {name: &#39;C&#39;}),
    (h:Location {name: &#39;H&#39;}),
     (j:Location {name: &#39;J&#39;}),
    (a)-[:ROAD {cost: 50}]-&gt;(b),
    (a)-[:ROAD {cost: 50}]-&gt;(c),
    (c)-[:ROAD {cost: 40}]-&gt;(j),
    (j)-[:ROAD {cost: 30}]-&gt;(h),
    (h)-[:ROAD {cost: 50}]-&gt;(b); 

    MATCH p=(o{name:&quot;A&quot;})-[r*]-&gt;(x{name:&quot;B&quot;})
    RETURN [x in nodes(p) | id(x)]

output

    ╒═════════════════════╕
    │&quot;list_path&quot;          │
    ╞═════════════════════╡
    │[&quot;A&quot;,&quot;C&quot;,&quot;J&quot;,&quot;H&quot;,&quot;B&quot;]│
    ├─────────────────────┤
    │[&quot;A&quot;,&quot;B&quot;]            │
    └─────────────────────┘

expected output

    path                                  cost
    1. [A,C,J,H,B]               [0,50,90,130,180]
    2. [A,B]                        [0,50]

Here is my query. I use node names for start and end. actually, I need to use nodeID 

query I tried

    MATCH p=(o)-[r*]-&gt;(x)
    WHERE ID(o) =13 AND ID(x) = 14
    RETURN [x in nodes(p) | id(x)] as list_path, [y in r | y.cost] as cost

output

    ╒════════════════╤═════════════╕
    │&quot;list_path&quot;     │&quot;cost&quot;       │
    ╞════════════════╪═════════════╡
    │[13,15,22,20,14]│[50,40,30,50]│
    ├────────────────┼─────────────┤
    │[13,14]         │[50]         │
    └────────────────┴─────────────┘

**I need cost start with zero  like([0,50,90,130,180])**",1628714977,https://stackoverflow.com/q/68748783,Karippery,"['neo4j', 'cypher', 'graph-databases']"
68741649,How to create dynamic node relation in neo4j for dynamic data?,"I was able to create author nodes directly from the json file . But the challenge is on what basis or how we have to link the data. Linking &quot;Author&quot; to &quot;organization&quot;. since the data is dynamic we cannot generalize it. I have tried with using csv file but, it fails the conditions when dynamic data is coming. For example one json record contain 2 organization and 3 authors, next record will be different. Different json record have different author and organization to link.  organization/1 represent organization1 and organization/2 represents organization 2.  Any help or hint will be great. Thank you. Please find the json file below. 

    &quot;Author&quot;: [
    {
      &quot;seq&quot;: &quot;3&quot;,
      &quot;type&quot;: &quot;abc&quot;,
      &quot;identifier&quot;: [
        {
          &quot;idtype:auid&quot;: &quot;10000000&quot;
        }
      ],
      &quot;familyName&quot;: &quot;xyz&quot;,
      &quot;indexedName&quot;: &quot;MI&quot;,
      &quot;givenName&quot;: &quot;T&quot;,
        &quot;preferredName&quot;: {
        &quot;familyName&quot;: &quot;xyz1&quot;,
        &quot;givenName&quot;: &quot;a&quot;,
        &quot;initials&quot;: &quot;T.&quot;,
        &quot;indexedName&quot;: &quot;bT.&quot;
      },
      &quot;emailAddressList&quot;: [],
      &quot;degrees&quot;: [],
      &quot;@id&quot;: &quot;https:abc/2009127993/author/person/3&quot;,
      &quot;hasAffiliation&quot;: [
        &quot;https:abc/author/organization/1&quot;
      ],
	  &quot;organization&quot;: [
    [
      {
        &quot;identifier&quot;: [
          {
            &quot;@type&quot;: &quot;idtype:uuid&quot;,
            &quot;@subtype&quot;: &quot;idsubtype:affiliationInstanceId&quot;,
            &quot;@value&quot;: &quot;aff2&quot;
          },
          {
            &quot;@type&quot;: &quot;idtype:OrgDB&quot;,
            &quot;@subtype&quot;: &quot;idsubtype:afid&quot;,
            &quot;@value&quot;: &quot;12345&quot;
          },
          {
            &quot;@type&quot;: &quot;idtype:OrgDB&quot;,
            &quot;@subtype&quot;: &quot;idsubtype:dptid&quot;
          }
        ],
        &quot;organizations&quot;: [],
        &quot;addressParts&quot;: [],
        &quot;sourceText&quot;: &quot;&quot;,
        &quot;text&quot;: &quot; Medical University School of Medicine&quot;,
        &quot;@id&quot;: &quot;https:abc/author/organization/1&quot;
      }
	  ],
	  
	  [
      {
        &quot;identifier&quot;: [
          {
            &quot;@type&quot;: &quot;idtype:uuid&quot;,
            &quot;@subtype&quot;: &quot;idsubtype:affiliationInstanceId&quot;,
            &quot;@value&quot;: &quot;aff1&quot;
          },
          {
            &quot;@type&quot;: &quot;idtype:OrgDB&quot;,
            &quot;@subtype&quot;: &quot;idsubtype:afid&quot;,
            &quot;@value&quot;: &quot;7890&quot;
          },
          {
            &quot;@type&quot;: &quot;idtype:OrgDB&quot;,
            &quot;@subtype&quot;: &quot;idsubtype:dptid&quot;
          }
        ],
        &quot;organizations&quot;: [],
        &quot;addressParts&quot;: [],
        &quot;sourceText&quot;: &quot;&quot;,
        &quot;text&quot;: &quot;K  University&quot;,
        &quot;@id&quot;: &quot;https:efg/author/organization/2&quot;
      }
    ]
	  
	  ",1628683392,https://stackoverflow.com/q/68741649,antonyj453,['neo4j']
68740608,Neo4J Cypher Query on 5M nodes,"This is the basic query I am trying:
```
MATCH (b1:Business),(b2:Business) WHERE ID(b1)&lt;&gt;ID(b2) AND b1.name[0]=b2.name[0]
WITH b1,b2,apoc.create.uuid() as uuid
MERGE (b1)-[d:MCC_NAME]-&gt;(b2) 
ON CREATE 
SET d.m_score = 100 
SET d.m_event = uuid 
SET d.m_dt = datetime() 
RETURN count (d)
```
I have also tried to separate the query and run through apoc.periodic.iterate() but in either case the query runs forever and never yields results.  The name property is an array but at present there are only single entries in it, so I tried to simplify by using simple comparison of name[0], but it didn&#39;t help.  The database is fairly large, about 5 million nodes.  Any advice appreciated.",1628679067,https://stackoverflow.com/q/68740608,Warwick Matthews,"['cypher', 'neo4j']"
68739047,How to get Only Unique node in Neo4j Query,"I scanned a small java application  and now I&#39;m trying to run this query on neo4J 
`````
MATCH (n:Class)-[rel]-(cls:Class) RETURN n,cls,rel
`````
the result is giving multiple nodes with the same id is there any way to get all these relations but each unique node should come once only. I did manage to get only unique through the loop but is there any way through this query itself will give unique node",1628672692,https://stackoverflow.com/q/68739047,Rahul_Mandhane,['neo4j']
68737733,How to switch between databases in neo4j using java,"So I&#39;m using **neo4j-enterprise** edition loaded with docker.

    version: &#39;3&#39;
    services:
      neo4j:
        image: neo4j:4.3.2-enterprise
        hostname: neo4j
        container_name: neo4j
        ports:
          - &quot;7474:7474&quot;
          - &quot;7687:7687&quot;
        environment:
          - NEO4J_ACCEPT_LICENSE_AGREEMENT=yes
          - NEO4J_dbms_memory_heap_maxSize=1G
          - NEO4JLABS_PLUGINS=[&quot;apoc&quot;]
          - NEO4J_AUTH=neo4j/test
          - NEO4J_apoc_import_file_enabled=true
          - NEO4J_dbms_security_procedures_whitelist= apoc.*
          - NEO4J_dbms_security_procedures_unrestricted= apoc.*

I&#39;m using bolt driver to connect with the neo4j.

    public Neo4jSessionFactory(@ConfigProperty(name = &quot;quarkus.neo4j.uri&quot;)String databaseUri,
                                   @ConfigProperty(name = &quot;quarkus.neo4j.authentication.username&quot;)String username,
                                   @ConfigProperty(name = &quot;quarkus.neo4j.authentication.password&quot;)String password) {
            Configuration neoConfig = new Configuration.Builder().uri(databaseUri**{bolt://localhost:7687}**).credentials(username, password)
                    .useNativeTypes().build();
            sessionFactory = new SessionFactory(neoConfig, PACKAGES);
            LOGGER.info(&quot;Connection with Neo4j is successful&quot;);
        }

Im able to create a seperate database using `&quot;CREATE DATABASE &lt;name&gt;&quot;` cmd.

However I want to run my queries across the newly created Database.
I can simply call `&quot;session.query(&quot;cypher_query_to_insert&quot;)&quot;` the data will get loaded to default database neo4j.
We can switch between databases in the browser using `:use &lt;database name&gt;`.
However when the cmd is run inside `session.query(&quot;:use &lt;database_name&gt;&quot;)` 
Im getting the following error:

&gt; Data Insertion failed. Cause: org.neo4j.driver.exceptions.ClientException: Invalid input &#39;:&#39;: expected &lt;init&gt; (line 1, column 1 (offset: 0))
&quot;:use neo4j&quot;

If anyone knows a solution let me know.",1628666852,https://stackoverflow.com/q/68737733,Nirmal Mahen,"['neo4jclient', 'spring-data-neo4j', 'neo4j', 'neo4j-ogm']"
68730650,Neo4j cypher return node when any one string in it&#39;s property array is matched,"Hi I am new to Neo4j and cypher, and I am trying to perform a probably straightforward match on property array. I am working in the desktop browser

I can create a node with a property array like so:
**CREATE (n:Example {names: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]})**

I then try to match the names property for any one string like this:
**MATCH (n:Example {names: &#39;a&#39;}) RETURN n**
But it returns no records

If I match the full array like this:
**MATCH (n:Example {names: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]}) RETURN n**
Then it returns the node like I want

I know how to match a node&#39;s one-string property to an array of strings, but mine is the other way around.
How can I get the node from just matching one string of the node property&#39;s array of strings? 

Thanks",1628613850,https://stackoverflow.com/q/68730650,penstrep,"['cypher', 'neo4j', 'arrays']"
68729757,Express Router doesn&#39;t route as expected,"Running NodeJS on Ubuntu 20.04.2, using VSApp with the debugger

I have the following file named /src/routes/regions.js:
```
const router = require(&#39;express&#39;).Router()
const { int } = require(&#39;neo4j-driver&#39;)
const { required, optional } = require(&#39;../middleware/auth&#39;)
const { check } = require(&#39;express-validator&#39;)
const validate = require(&#39;../middleware/validate&#39;)
const neo4j = require(&#39;../neo4j&#39;)

const Joi = require(&#39;joi&#39;);

const Region = require(&#39;../entities/Region&#39;)

router.get(&#39;/1&#39;, (req, res, next) =&gt; {

    return req.neo4j.read(`
        MATCH (regions:Region) 
        return regions order by regions.name ASC
    `, params)
        .then(regions =&gt; res.send(regions))
        .catch(e =&gt; next(e))

})

router.get(&#39;/&#39;, (req, res, next) =&gt; {

    return req.neo4j.read(`
        MATCH (regions:Region) 
        return regions order by regions.name DESC
    `, params)
        .then(regions =&gt; res.send(regions))
        .catch(e =&gt; next(e))

})

router.get(&#39;/:name&#39;, (req, res, next) =&gt; {

    const params = {
        name: req.params ? req.params.name : null
    }

    return req.neo4j.read(`
        MATCH (region:Region { name: $name }) return region 
    `, params)
    .then(regions =&gt; res.send(regions))
    .catch(e =&gt; next(e))

})

module.exports = router;
```
From a browser, if I enter `localhost:3000/regions` I receive the list of all the Regions in Descending order.

But if I try to enter `localhost:3000/regions/1` I receive nothing. The only difference between the two calls should be the order of the received data. The same for `localhost:3000/regions/Lazio`

It looks like it is not able to recognize patterns in the provided URL

The other really strange behavior is that if I set a breakpoint on any line of the file, the debugger doesn&#39;t stop. It looks like it is running another program ....

Can someone help?",1628609891,https://stackoverflow.com/q/68729757,Paolo Di Pietro,"['routes', 'express', 'javascript', 'neo4j', 'node.js']"
68718622,Neo4j - Load CSV with headers containing dots?,"If my CSV file consists of headers with dots:
`column1.name, column2.age, column3.city` ... 

How can I read them? Should I avoid dots?

    LOAD CSV FROM &quot;URL...&quot; AS row RETURN row.`column1.name`, toInteger(row.`column2.age`)

",1628543760,https://stackoverflow.com/q/68718622,SteveS,"['cypher', 'neo4j']"
68717863,Remove a property keys from all node in neo4j,"I  download a dataset from the internet. But dataset has some unwanted properties. Because of that my dataset is huge. basically, I want to filter the database.
   
I would like to remove a property key from all node


          &quot;start&quot;: {
    &quot;identity&quot;: 0,
    &quot;labels&quot;: [
              &quot;Node&quot;
            ],
    &quot;properties&quot;: {
    &quot;x&quot;: &quot;10.6056248&quot;,
    &quot;y&quot;: &quot;47.1732157&quot;,
    &quot;street_count&quot;: &quot;3&quot;
            }
          },
          &quot;relationship&quot;: {
    &quot;identity&quot;: 0,
    &quot;start&quot;: 0,
    &quot;end&quot;: 20,
    &quot;type&quot;: &quot;RELATED&quot;,
    &quot;properties&quot;: {
    &quot;ref&quot;: &quot;A12&quot;,
    &quot;osmid&quot;: &quot;[103276220, 103271459, 453545145, 10110984, 204103464, 29034282, 204103467, 204016338, 23966515, 103276217, 59757436, 204016351]&quot;,
    &quot;length&quot;: 3685.591999999999,
    &quot;name&quot;: &quot;Inntal Autobahn&quot;,
    &quot;maxspeed&quot;: &quot;130&quot;,
    &quot;lanes&quot;: &quot;[&#39;3&#39;, &#39;2&#39;]&quot;,
    &quot;geometry&quot;: &quot;LINESTRING (10.6056248 47.1732157, 10.6077387 47.1734722, 10.6082515 47.1735344, 10.6085156 47.1735707, 10.6088688 47.1736191, 10.6094483 47.1737172, 10.6099849 47.1738187, 10.6107471 47.1740115, 10.6114325 47.1742194, 10.6120899 47.174459, 10.6127578 47.1747469, 10.6133762 47.1750513, 10.6141991 47.1755512, 10.614311 47.1756329, 10.6148323 47.1760134, 10.615342 47.1764467, 10.6157925 47.1769004, 10.6165099 47.1778069, 10.6171836 47.1787272, 10.6175571 47.1791516, 10.6178384 47.1794141, 10.6181845 47.179737, 10.6186197 47.1800941, 10.6191062 47.1804327, 10.6195835 47.1807353, 10.6201042 47.1810176, 10.6206844 47.1812917, 10.621312 47.181545, 10.6219279 47.1817632, 10.6225722 47.1819513, 10.6229524 47.1820501, 10.623216 47.1821156, 10.6237939 47.18225, 10.6252743 47.182581, 10.6264776 47.1828521, 10.6275371 47.1830966, 10.6291987 47.1834975, 10.6297891 47.1836426, 10.6321448 47.1842436, 10.6352364 47.1850876, 10.6353627 47.1851255, 10.6366729 47.1855098, 10.6380716 47.1859653, 10.6392968 47.1864251, 10.6400879 47.1867654, 10.6409802 47.1872101, 10.6411455 47.1873033, 10.641467 47.1874799, 10.6420809 47.1878655, 10.6425598 47.1882012, 10.6430794 47.1886174, 10.6435366 47.1890316, 10.6439666 47.189484, 10.6443888 47.190006, 10.644528 47.1901931, 10.6446988 47.1904546, 10.6448142 47.1906353)&quot;,
    &quot;bridge&quot;: &quot;yes&quot;,
    &quot;highway&quot;: &quot;motorway&quot;,
    &quot;oneway&quot;: &quot;True&quot;
            }
          },
          &quot;end&quot;: {
    &quot;identity&quot;: 20,
    &quot;labels&quot;: [
              &quot;Node&quot;
            ],
    &quot;properties&quot;: {
    &quot;x&quot;: &quot;10.6448142&quot;,
    &quot;y&quot;: &quot;47.1906353&quot;,
    &quot;ref&quot;: &quot;140&quot;,
    &quot;street_count&quot;: &quot;3&quot;,
    &quot;highway&quot;: &quot;motorway_junction&quot;
            }
          }
        }
      ],
      &quot;length&quot;: 1.0
    }
    {

[![enter image description here][1]][1]
I try this but not working

    MATCH (n) REMOVE n.osmid


  [1]: https://i.stack.imgur.com/4fdB9.png",1628538880,https://stackoverflow.com/q/68717863,Karippery,"['neo4j', 'graph-databases', 'cypher']"
68717799,Can&#39;t load CSV from Drive to Neo4j,"I am using the following cypher code:

    LOAD CSV FROM &quot;https://drive.google.com/file/d/12DiEwM8XatMZBXA6TdekxWl8qrsgVj3l/view?usp=sharing&quot; AS requests RETURN requests

and getting the following error:

    At https://drive.google.com/file/d/12DiEwM8XatMZBXA6TdekxWl8qrsgVj3l/view?usp=sharing @ position 1691 -  there&#39;s a field starting with a quote and whereas it ends that quote there seems to be characters in that field after that ending quote. That isn&#39;t supported. This is what I read: &#39;docs-fwds&quot;:&#39;

Please advise how to fix it, I want to be able to load a simple CSV file from Drive to Neo4j.",1628538542,https://stackoverflow.com/q/68717799,SteveS,"['cypher', 'neo4j']"
68716327,Neo4j Cypher Query - Memory usage dependent on order by and limit clause,"My cypher query has an order by and limit clause. Profiling the query with limit as 10 gives memory usage of 9MB but when I increase the limit to 20, the memory usage doubles to 18MB
Query:

    PROFILE MATCH (u:User{ID: xyz})-[:VIEWED]-&gt;(viewedPost:Post)
    WITH collect(viewedPost.ID) as viewedPosts
    MATCH (p:Post{Type: 0})
    WHERE NOT p.ID in viewedPosts RETURN p.ID as post_id, p.Score ORDER BY p.Score Desc LIMIT 10;
Execution details for limit 10:
```
+----------------------------------------------------------------------------------------------------------+
| Plan      | Statement   | Version      | Planner | Runtime       | Time | DbHits | Rows | Memory (Bytes) |
+----------------------------------------------------------------------------------------------------------+
| &quot;PROFILE&quot; | &quot;READ_ONLY&quot; | &quot;CYPHER 4.1&quot; | &quot;COST&quot;  | &quot;INTERPRETED&quot; | 166  | 178594 | 10   | 9026424        |
+----------------------------------------------------------------------------------------------------------+
```

Execution details for limit 20:
```
+----------------------------------------------------------------------------------------------------------+
| Plan      | Statement   | Version      | Planner | Runtime       | Time | DbHits | Rows | Memory (Bytes) |
+----------------------------------------------------------------------------------------------------------+
| &quot;PROFILE&quot; | &quot;READ_ONLY&quot; | &quot;CYPHER 4.1&quot; | &quot;COST&quot;  | &quot;INTERPRETED&quot; | 176  | 178594 | 20   | 18052784       |
+----------------------------------------------------------------------------------------------------------+
```

If I remove the order by clause, the memory usage is equal for any limit. Why is order by clause regulating the memory usage?",1628530620,https://stackoverflow.com/q/68716327,Aayush Sharda,"['cypher', 'profiling', 'neo4j']"
68711931,Longest path through graph,"I have a graph with 80k nodes and 180k vertices for which I want to compute the top-5 longest paths (based on a property) from start to finish. I&#39;m using Neo4j 4.3 community edition.

I have the following Cypher query but it is excruciatingly slow:

    MATCH p = (a:Start)-[:FLOWS_TO*]-&gt;(b:Finish)
    RETURN
      length(p)                                       AS steps
    , reduce(sum=0, n in nodes(p) | sum + n.cost)     AS total_cost
    ORDER BY
      total_cost DESC
    LIMIT 5

All intermediate nodes have the same label. If I run `EXPLAIN` for the query, i see an intermediate step with 425 billion rows, which is why it&#39;s so slow. Unfortunately, I have no idea how long the most expensive path is, so I cannot limit `FLOWS_TO:1..X` with X some integer.

There are no cycles in the graph.

Is there a way to speed up the query or solve the problem in a better way?",1628511471,https://stackoverflow.com/q/68711931,Max Power,"['neo4j', 'cypher']"
68698141,Cypher: the usage of apoc.cypher.runFirstColumnMany Inside a WHERE clause,"The scenario is based on Movies db in neo4j sandbox:

Down below I have a query that uses `apoc.cypher.runFirstColumnMany` function inside a where clause for filtering out nodes with paths to particular nodes, at the same manner, by removing the `NOT` condition it filters in those nodes only. 

**Questions**: 

 1. Does the neo4j engine executes `runFirstColumnMany` for every row match just as it does for any other constraint in a `WHERE` clause? 
 2. If so, does it actually run the `runFirstColumnMany` on this single match using my parameter `curr_person`, or does it just matches everything again?

```
MATCH (persons:Person)-[a:ACTED_IN]-&gt;(m:Movie) 
WHERE  NOT (
         SIZE ( apoc.cypher.runFirstColumnMany(&quot;MATCH (curr_person)-[a:ACTED_IN]-&gt;(m:Movie) WHERE ((m.title in [$Unwanted])) RETURN properties(curr_person)&quot;, {`Unwanted`: &quot;Speed Racer&quot;, `curr_person`: persons})
         ) &gt;= 1 
      )
return count(distinct persons)

```
It appears to work, but slower than just collect the unwanted movie node and then match again and filter on this movie. The reason I want to try to stick with the above query is that it is convenient to erase or add this `NOT` condition at my willing instead of rewriting the whole query

",1628402109,https://stackoverflow.com/q/68698141,Asher Yartsev,"['neo4j-apoc', 'cypher', 'neo4j']"
68696681,Custom queries not working with Class-based Projections,"I want to get work [Class-based Projections][1] in my project. Following code snippet is simplified version of my use case

spring boot version **2.5.3**

spring data neo4j version **6.1.3**

Repository

    @Repository
    public interface DriverRepository extends Neo4jRepository&lt;Neo4jDriver, Long&gt; {
    
       Neo4jDriver save(Neo4jDriver driver);
    
       @Query(&quot;MATCH (d: Neo4jDriver{id: $id}) RETURN d.id as supId&quot;)
       Neo4jDriverMapper getByIdx(String id);
    }

POJO class

    public class Neo4jDriverMapper {
    
       String supId;
       
       public String getSupId() {
          return supId;
       }
    
       public void setSupId(String supId) {
          this.supId = supId;
       }
    }

Test class

      @Test
       public void get_a_driver2(){
          Neo4jDriverMapper d = driverRepository.getByIdx(&quot;driver1&quot;);
          assert(d.getSupId().equals(&quot;driver1&quot;));
       }

When I run this test following exception thrown

&gt; org.springframework.data.neo4j.core.mapping.NoRootNodeMappingException:
&gt; Could not find mappable nodes or relationships inside Record&lt;{supId:
&gt; &quot;HTTP&quot;}&gt; for
&gt; org.springframework.data.neo4j.core.mapping.DefaultNeo4jPersistentEntity@12f9f896
&gt; 
&gt; 	at
&gt; org.springframework.data.neo4j.core.mapping.DefaultNeo4jEntityConverter.read(DefaultNeo4jEntityConverter.java:106)
&gt; 	at
&gt; org.springframework.data.neo4j.core.mapping.DefaultNeo4jEntityConverter.read(DefaultNeo4jEntityConverter.java:67)
&gt; 	at
&gt; org.springframework.data.neo4j.core.mapping.Schema.lambda$getRequiredMappingFunctionFor$0(Schema.java:96)
&gt; 	at
&gt; org.springframework.data.neo4j.repository.query.Neo4jQuerySupport.lambda$getMappingFunction$0(Neo4jQuerySupport.java:105)
&gt; 	at
&gt; org.springframework.data.neo4j.core.PreparedQuery$AggregatingMappingFunction.apply(PreparedQuery.java:218)
&gt; 	at
&gt; org.springframework.data.neo4j.core.PreparedQuery$AggregatingMappingFunction.apply(PreparedQuery.java:154)
&gt; 	at
&gt; org.springframework.data.neo4j.core.DelegatingMappingFunctionWithNullCheck.apply(DelegatingMappingFunctionWithNullCheck.java:45)
&gt; 	at
&gt; org.springframework.data.neo4j.core.DelegatingMappingFunctionWithNullCheck.apply(DelegatingMappingFunctionWithNullCheck.java:35)
&gt; 	at
&gt; org.springframework.data.neo4j.core.DefaultNeo4jClient$DefaultRecordFetchSpec.lambda$partialMappingFunction$0(DefaultNeo4jClient.java:325)
&gt; 	at
&gt; java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
&gt; 	at java.util.Iterator.forEachRemaining(Iterator.java:116) 	at
&gt; java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)
&gt; 	at
&gt; java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
&gt; 	at
&gt; java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
&gt; 	at
&gt; java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
&gt; 	at
&gt; java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
&gt; 	at
&gt; java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
&gt; 	at
&gt; org.springframework.data.neo4j.core.DefaultNeo4jClient$DefaultRecordFetchSpec.all(DefaultNeo4jClient.java:312)

I can verify neo4j query is working and return results. Am I missing any configurations?

  [1]: https://docs.spring.io/spring-data/neo4j/docs/6.1.1/reference/html/#projections.dtos",1628377523,https://stackoverflow.com/q/68696681,Prabudda Sri Rahal,"['java', 'neo4j', 'spring-boot', 'spring-data-neo4j']"
68696311,Find all pair shortestpath from no label nodes and loading for ever,"I got the dataset from my boss but nodes don&#39;t have labels. I want to find all pairs shortest path.
the dataset has about 10000 nodes. when I run code my system keeps loading I didn&#39;t get any output and error. my CPU runs 100%  more than 30 min

Please check my code is right?

    CALL gds.alpha.allShortestPaths.stream({
      nodeProjection: &#39;*&#39;,
      relationshipProjection: {
        ROAD: {
          type: &#39;RELATED&#39;,
          properties: &#39;length&#39;
        }
      },
      relationshipWeightProperty: &#39;length&#39;
    })
    YIELD sourceNodeId, targetNodeId, distance
    WITH sourceNodeId, targetNodeId, distance
    WHERE gds.util.isFinite(distance) = true
    
    MATCH (source) WHERE id(source) = sourceNodeId
    MATCH (target) WHERE id(target) = targetNodeId
    WITH source, target, distance WHERE source &lt;&gt; target
    
    RETURN source.name AS source, target.name AS target, distance
    ORDER BY distance DESC, source ASC, target ASC
    LIMIT 10

And call db.visualisation() is empty I don&#39;t why.

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/ePSbA.png",1628372181,https://stackoverflow.com/q/68696311,Karippery,"['neo4j', 'graph-databases', 'neo4j-apoc']"
68688358,Python &amp; Neo4j &amp; JSON - For each user create NODE,"I want to develop a python script which perform the following:
1. Load json UsersFile
2. for User in UsersFile, create a node

```
## example of User
{&#39;UserName&#39;: &#39;lolipop&#39;, &#39;UserId&#39;: &#39;544&#39;, &#39;groups&#39;: [&#39;winners&#39;, &#39;losers&#39;]}

```

3. I tired something like, (but I getting errors):
```
import json
from neo4j import GraphDatabase

uri = &quot;neo4j://localhost:7687&quot;
driver = GraphDatabase.driver(uri, auth=(&quot;neo4j&quot;, &quot;123&quot;))

UsersFile = json.loads(open(&quot;users.json&quot;, &quot;r&quot;).read())

def create_user_node(tx, User):
    tx.run(&quot;CREATE (n:User $Usercxt);&quot;, Usercxt=json.dumps(User))

for User in UsersFile [&#39;Users&#39;]:
    with driver.session() as session:
        session.write_transaction(create_user_node, User)

```
Error:
```
neo4j.exceptions.CypherSyntaxError: {code: Neo.ClientError.Statement.SyntaxError} {message: Type mismatch for parameter &#39;Usercxt&#39;: expected Map, Node or Relationship but was String (line 1, column 16 (offset: 15))
&quot;CREATE (n:User $Usercxt);&quot;
                ^}
```


What do you recommend to do at this point?
Thanks,",1628292785,https://stackoverflow.com/q/68688358,ALevy,"['neo4j', 'python', 'json']"
68681666,"compilation issues for neo4j-graph-api, neo4j-logging, neo4j-procedure-api with neo4j 4.3.2","I have upgraded to neo4j 4.3.2 community version. This brings in other neo4J packages like neo4j-graph-api, neo4j-logging, neo4j-procedure-api,neo4j-resource all 4.3.2. However it throw compilation error for neo4j-garph-api related classes. Error thrown is:

\org.neo4j\neo4j-graphdb-api\4.3.2\5c61e5a720893ca4a114c92aa7f256375e87edf5\neo4j-graphdb-api-
4.3.2.jar(org/neo4j/graphdb/Label.class)
    class file has wrong version 55.0, should be 52.0
    Please remove or make sure it appears in the correct subdirectory of the classpath.


Similar error are thrown for classes from neo4j-logging 4.3.2 and neo4j-procedure-api 4.3.2, neo4j-resource 4.3.2 etc

Downgrading these packages individually works. I would assume as all these sub-packages also have their own 4.3.2 version, that should make it compatible with the latest neo4j version. 
What is going wrong? Have I missed something here?


Partial Dependency tree
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/op72d.png",1628253274,https://stackoverflow.com/q/68681666,np10,"['neo4j', 'java', 'compilation']"
68681123,Neo4j Community Server: Cannot select my database in the remote interface,"I&#39;m still relativly neew to Neo4j and especially new to the neo4j community server 4. So please forgive me if I am just dumb here.

I am using the neo4j-community-4.3.2 server and imported my data via the neo4j-admin import:
```
bin/neo4j-admin import --database=dicom --skip-duplicate-nodes --skip-bad-relationships --nodes=... 
```
(so I named the database &quot;dicom&quot;)

So far so good. Everything until here works fine:
```
IMPORT DONE in 42s 16ms. 
Imported:
  81656 nodes
  694772 relationships
  2252244 properties
```
When I wanted to start the database with ```./bin/neo4j console``` it worked as well:

```
Directories in use:
home:         /Users/tobias/Library/Mobile Documents/com~apple~CloudDocs/Documents/Uni/Masterarbeit/Neo4j/neo4j-community-4.3.2
config:       /Users/tobias/Library/Mobile Documents/com~apple~CloudDocs/Documents/Uni/Masterarbeit/Neo4j/neo4j-community-4.3.2/conf
logs:         /Users/tobias/Library/Mobile Documents/com~apple~CloudDocs/Documents/Uni/Masterarbeit/Neo4j/neo4j-community-4.3.2/logs
plugins:      /Users/tobias/Library/Mobile Documents/com~apple~CloudDocs/Documents/Uni/Masterarbeit/Neo4j/neo4j-community-4.3.2/plugins
import:       /Users/tobias/Library/Mobile Documents/com~apple~CloudDocs/Documents/Uni/Masterarbeit/Neo4j/neo4j-community-4.3.2/import
data:         /Users/tobias/Library/Mobile Documents/com~apple~CloudDocs/Documents/Uni/Masterarbeit/Neo4j/neo4j-community-4.3.2/data
certificates: /Users/tobias/Library/Mobile Documents/com~apple~CloudDocs/Documents/Uni/Masterarbeit/Neo4j/neo4j-community-4.3.2/certificates
licenses:     /Users/tobias/Library/Mobile Documents/com~apple~CloudDocs/Documents/Uni/Masterarbeit/Neo4j/neo4j-community-4.3.2/licenses
run:          /Users/tobias/Library/Mobile Documents/com~apple~CloudDocs/Documents/Uni/Masterarbeit/Neo4j/neo4j-community-4.3.2/run
Starting Neo4j.
2021-08-06 10:53:47.901+0000 INFO  Starting...
2021-08-06 10:53:49.310+0000 INFO  ======== Neo4j 4.3.2 ========
2021-08-06 10:53:53.761+0000 INFO  org.neo4j.internal.kernel.api.security.AbstractSecurityLog$SecurityLogLine@3da61af2
2021-08-06 10:53:53.765+0000 INFO  org.neo4j.internal.kernel.api.security.AbstractSecurityLog$SecurityLogLine@54530644
2021-08-06 10:53:53.765+0000 INFO  org.neo4j.internal.kernel.api.security.AbstractSecurityLog$SecurityLogLine@42734b71
2021-08-06 10:53:53.846+0000 INFO  org.neo4j.internal.kernel.api.security.AbstractSecurityLog$SecurityLogLine@726d8fa0
2021-08-06 10:53:53.866+0000 INFO  org.neo4j.internal.kernel.api.security.AbstractSecurityLog$SecurityLogLine@666b1244
2021-08-06 10:53:53.888+0000 INFO  org.neo4j.internal.kernel.api.security.AbstractSecurityLog$SecurityLogLine@789d8fd6
2021-08-06 10:53:56.919+0000 INFO  Bolt enabled on localhost:7687.
2021-08-06 10:53:57.446+0000 INFO  Remote interface available at http://localhost:7474/
2021-08-06 10:53:57.447+0000 INFO  Started.
```
So I thought it had worked. I opened http://localhost:7474/ in my browser to work with the database but apparently since neo4j community 4 there are multiple databases. In the dropdown menu I&#39;ve got one named &quot;neo4j&quot; and one named &quot;system&quot; but unfortunately none named &quot;dicom&quot;. What did I do wrong? Why can&#39;t I see my dicom database there? in the Neo4j directory NEO4J_HOME/data/databases there is a folder called &quot;dicom&quot; which seems to have the same files as the folders &quot;neo4j&quot; and &quot;system&quot;.

Does anyone have any ideas? I&#39;d be very grateful! Sorry for the very long post, I just wanted to be thorough. ",1628250612,https://stackoverflow.com/q/68681123,T-Man,['neo4j']
68680466,Create relationships in batches in the neo4j database using py2neo bulk API (with multiple relation types),"I am trying to create relationships in batches in the neo4j database using py2neo bulk api `create_relationship()`. 
I have multiple relation types (like knows ,follows etc) in the list and also I want to create a large number of relationships (more than 30 million) into the graph database. 
Currently I am using Neo4j Desktop 1.4.7 and python version 3.9.


   I have created nodes in batches using `create_nodes()` py2neo.bulk api.  
Below is the sample code for the same:
    
	from py2neo import Graph
	from py2neo.bulk import create_nodes,create_relationships
	from py2neo.data import Node
	
	graph = Graph(auth=(&#39;neo4j&#39;, &#39;abc123&#39;))
	one_node=Node(&quot;Person&quot;, name=&quot;Alice&quot;, nid=&quot;01&quot;)
	two_node=Node(&quot;Person&quot;, name=&quot;ACME&quot;, nid=&quot;02&quot;)
	t_node=Node(&quot;Person&quot;, name=&quot;Mahi&quot;, nid=&quot;03&quot;)
	f_node=Node(&quot;Person&quot;, name=&quot;Ali&quot;, nid=&quot;04&quot;)
	data = []
	data.append(one_node)
	data.append(two_node)
	data.append(t_node)
	data.append(f_node)
	
	try:
	    create_nodes(graph.auto(), data, labels={&quot;Person&quot;})
	except Exception as error:
	    print(error)
	
	try:
	    graph.run(&quot;CREATE INDEX ON :Person(nid)&quot;)
	except Exception as error:
	    print(error)
	
	#I have created a relationship using create_relationship() api of 
    #py2neo.bulk. Below is the sample code for the same.
	
	rel_data= [
	    (&quot;01&quot;, {}, &quot;02&quot;),
	    (&quot;03&quot;, {}, &quot;04&quot;),
	]
	
	try:
	    create_relationships(graph.auto(), rel_data, &quot;WORKS_FOR&quot;, \
	        start_node_key=(&quot;Person&quot;, &quot;nid&quot;), end_node_key=(&quot;Person&quot;, &quot;nid&quot;))
	except Exception as error:
	    print(error)
    
	
I am facing following queries problems:

1. In the above code if I provide a single relation type to all 30 Millions nodes then the data gets inserted in only 74 seconds. But the data I want to insert in Neo4j have multiple relation types (like the file I have referring to has 79 relation types each having its own dataset). So I have called `create_relationship()` API 79 times with its own data and it took 9 minutes to complete. So conclusion is single relation type gives better performance, can we give multiple relation type in one go to `create_relationship()` API.

2. In the above code if I don&#39;t provide start key and end key to `create_relationship()` API then performance for creating edges becomes fast but some edges are missing, But If I provide start key and end key (as shown in above code) then performance gets slow. So is there any better way to create a large number of relationships? Just FYI in our case we don&#39;t want to use the `Load csv` query, please suggest some other solution, if possible.

3. While investigating I found some samples of `WriteBatch` from py2neo library for creating our own batch, but I was not able to import the neo4j module in py2neo which has `WriteBatch()` API as I am using py2neo version 2021.1. So is there any way to fix this issue or is there any alternative way to create own batches using py2neo.

Thank you in advance.",1628247505,https://stackoverflow.com/q/68680466,SOMESH NANDKISHOR PANDE,"['python', 'performance', 'relationship', 'neo4j', 'py2neo']"
68674397,Does neo4j MERGE ON MATCH ON CREATE have a property maximum limit?,"consider a query of form 

```
MERGE (x:SomeType{a:&quot;val1&quot;,b:&quot;val&quot;2,c:&quot;val3&quot;})
ON MATCH SET x.d = &quot;val7&quot;, x.e = &quot;val8&quot;, ... , x.z = &quot;val9&quot;
ON CREATE SET x.d = &quot;val4&quot;, x.e = &quot;val5&quot;, ... , x.z = &quot;val6&quot;
```

My question is whether there is a limit to how many properties can be set? (I appreciate the database design issue regarding a model setting many properties - that&#39;s not my question).

I ask this because I seem to be hitting a limit of 12 properties set before subsequent queries for nodes results in a binary format decoding error, all using the Haskell hasbolt library. Less than this and all works fine, but I&#39;d like to have it confirmed that I&#39;m not falling foul of a known neo4jdb issue before investigating further.

A typical failing query would be:

```
MATCH (x:SomeType{a:&quot;val1&quot;,b:&quot;val&quot;2,c:&quot;val3&quot;}) RETURN x
```

thanks,
S.",1628204827,https://stackoverflow.com/q/68674397,esjmb,"['neo4j', 'haskell']"
68672684,Cypher: filter out nodes with certain paths,"Suppose:

 1. I have in my Neo4j database, nodes with `SpecialFromLabel` in them. 
 2. These nodes are connected to `SpecialToLabel` nodes with `SPECIAL_REL` relationship
 3. The following paths, therefor, exist: `p = (from: SpecialFromLabel)-[r:SPECIAL_REL]-&gt;(to: SpecialToLabel)`
 4. Nodes with ` SpecialToLabel` have a property `to_prop` that can have different string values

How can I construct a query that gives me all `from` nodes that have a path: `p=(from: SpecialFromLabel)-[:SPECIAL_REL]-&gt;(to: SpecialToLabel)` - **but** those `from` nodes do not have a path to `to` nodes, where `to.to_prop` is in an unwanted values-set?

in pseudocode (not runnable) I want something like this:
```
MATCH (unwanted_from: SpecialFromLabel)-[r:SPECIAL_REL]-&gt;(to: SpecialToLabel)
WHERE (to.`to_prop` in $UnwantedValues)
with unwanted_from
MATCH (from: SpecialFromLabel)-[r:SPECIAL_REL]-&gt;(to: SpecialToLabel)
WHERE from not in unwanted_from
RETURN from
```


",1628192730,https://stackoverflow.com/q/68672684,Asher Yartsev,"['neo4j', 'cypher']"
68671937,Regex on the SET statement in CYPHER,"I have a CSV file that I am loading using a CYPHER query as follows:

```
load csv from &#39;file:///Test_20210801.csv&#39; as row 
WITH row[0] as col1, row[1] as col2, 
row[2] as col3, row[3] as col4, row[4] as col5
MERGE (a:TEST_SESSION {col1: col1})
SET a.col1 = col1
SET a.col2 = col2
SET a.col3 = col3
SET a.col4 = col4
SET a.col5 = col5
SET a.Date = file()
RETURN count(a);
```
The value of the &quot;Date&quot; property needs to be the date from the filename. When I run the above query, the file() gives me the entire path and I want to extract only the date from that path. Is there a way to use Regex in the SET statement in CYPHER? 
",1628188809,https://stackoverflow.com/q/68671937,PPSATO,"['graphql', 'cypher', 'neo4j']"
68669704,Unhandled non specific Error in Neo4j enterprise 4.2.9,"All it says in the docker logs is :

    2021-08-04 22:47:53.351+0000 ERROR Unexpected error [Neo.DatabaseError.General.UnknownError]: Unhandled error.

How do I learn more about this error ?",1628178293,https://stackoverflow.com/q/68669704,fodon,['neo4j']
68663948,How to create edge in neo4j of a football match passes,"I want to map a graph that represents all players of both teams as nodes and all passes among them as edges.


Even after many trials, I am not able to make the correct mapping.

",1628155551,https://stackoverflow.com/q/68663948,Deepak pal,"['graph-databases', 'pattern-matching', 'orientdb', 'neo4j']"
68662494,How can I Limit nodes on each level of children in tree with cypher query,"I&#39;m using cypher and neo4j
I have a big dataset of parent and child relations as
```
(:Person)-[:PARENT_OF*]-(:Person)
```
**I need to get the family tree with only 5 children(nodes) on each level of the tree**

I&#39;ve tried:

```
MATCH path = (jon:Person )-[:PARENT_OF*]-(:Person)
WITH collect(path) as paths
CALL apoc.convert.toTree(paths) yield value
RETURN value;
```

its returning me the whole tree structure, I&#39;ve tried limiting the nodes with limit but it isn&#39;t working properly


",1628149402,https://stackoverflow.com/q/68662494,Motesh C Deshpande,"['neo4j', 'graph-theory', 'cypher']"
68655431,Neo4J Cypher: Set property only if it is null but still return the node,"I am quite new to Neo4J and struggling with the following:

I want to set property only if it does not exist yet (if it&#39;s null) and do not want to set property if it exists. 
How can I modify the query below to achieve that

```
  MATCH (u:User)
  WHERE u.uuid=$userId
  SET u.unsubscribedAt = timestamp()
  RETURN u
```

Thanks in advance

UPDATE 1:
One thing I forgot to mention: I still want to return the node regardless, so cannot add `AND u.unsubscribedAt is null` in where clause
",1628097054,https://stackoverflow.com/q/68655431,almeynman,"['neo4j', 'cypher']"
68655364,Neo4j transaction with array of queries with js-neo4j-driver,"I want to pass an n-number of cypher-queries to a neo4j-transaction and I am thinking about a good approach. 

At the moment I have a working approach that takes the array-item or if it is not available a dummy-query. (Code below)

I believe this is not best-practice. Does anybody know or have an idea how this can be done better?

    	function Neo4jTransaction(QueryArray) {
			const session = driverWrite.session();
			const tx = session.beginTransaction();
			tx.run(QueryArray[0] || &quot;RETURN 0&quot;)
			tx.run(QueryArray[1] || &quot;RETURN 0&quot;)
			tx.run(QueryArray[2] || &quot;RETURN 0&quot;)
			tx.run(QueryArray[3] || &quot;RETURN 0&quot;)
			.then(result =&gt; {
				return tx.commit()
			}).then(() =&gt; {
				session.close()
				driverWrite.close()
			}).catch(exception =&gt; {
				console.log(exception)
				session.close()
				driverWrite.close()
			})
		}",1628096660,https://stackoverflow.com/q/68655364,Peter,"['neo4j-driver', 'cypher', 'neo4j']"
68654289,Regex match items in property list,"I have nodes that have a property that is a list of strings.

I would like to do some regex matching on the strings in the list, for example to match all strings that are like `JVM_.*`.

I know I can do an exact match like this:

```
match (f:File)
where &quot;JVM_OPTS&quot; in f.env
return f.id,f.path,f.env
```

but I don&#39;t see anything in the docs that would allow me to do something like in

```
match (f:File)
where &quot;JVM_.*&quot; ~ f.env
return f.id,f.path,f.env
```",1628091888,https://stackoverflow.com/q/68654289,dbzuk,['neo4j']
68653831,Automatically retrieve password for Neo4j from AWS Secret manager using terraform,Is there a way that I can automatically retrieve secrets from AWS Secrets Manager which is provisioned using terraform that is the password for Neo4j database?,1628090202,https://stackoverflow.com/q/68653831,merilstack,"['aws-secrets-manager', 'neo4j', 'terraform']"
68650383,Return paths to nodes with more than N relationships,"I have User and Repository nodes in my database, and there are relationships between them.

I want to get back the paths between Users and &quot;Repositories that have more than 100 Users pointing to them&quot; (with a variable number of nodes in between them).

This query works but only returns the Repositories:

```
match p=(u:User)-[*..2]-&gt;(r:Repository)
with *, relationships(p) as rel
with r, count(rel) as rel_count
where rel_count &gt; 100
return r
```

I also want the Users and paths returned, so I tried this:

```
match p=(u:User)-[*..2]-&gt;(r:Repository)
with *, relationships(p) as rel
with p,r, count(rel) as rel_count
where rel_count &gt; 100
return p
```

which returns 0 records (versus ~200 for the above query), for reasons I&#39;m uncertain of.

**How can I return all the *paths* to nodes that have more than N relations?**",1628076281,https://stackoverflow.com/q/68650383,dbzuk,['neo4j']
68648561,How to handle Deadlocks using the javascript neo4j driver?,"I&#39;m using the javascript neo4j-driver and sometimes I&#39;m facing this error : 

    Neo4jError: ForsetiClient[3] can&#39;t acquire ExclusiveLock{owner=ForsetiClient[0]} on INDEX_ENTRY(5454851920060587002), because holders of that lock are waiting for ForsetiClient[3].\n Wait list:ExclusiveLock[\nClient[0] waits for [3]]

how can i handle that using javascript and thank you !",1628068308,https://stackoverflow.com/q/68648561,Yacine,"['node.js', 'neo4j-driver', 'neo4j']"
68646794,Rest api with spring boot is not giving the required json output from neo4j relationships,"I am new to java and trying to fetch the data from neo4j Graph DB.

I have tried to fetch the data in the but some of the data is missing in the json output while applying the relationships. Not sure what i am doing wrong. 


My Controller code:
```
    @RestController
    @RequestMapping(&quot;/rest/neo4j/user&quot;)
    public class NetworkAdequacyController {
       @Autowired 
    	private StateRepository stateRepository;
    	@GetMapping(&quot;/countysinstate&quot;)
    	public Collection&lt;State&gt; getAllCountys(){
    		return service.getAllCountys();
    	}
}
```

service class: 

```
@Service
public class MovieService {
	@Autowired
	private CountyRepository countyRepository;
	
	@Autowired
	private StateRepository stateRepository;

  public Collection&lt;State&gt; getAllCountys() {
		// TODO Auto-generated method stub
		return (Collection&lt;State&gt;) countyRepository.getCountys();
	}
}
```

Repository class:
```
public interface CountyRepository extends Neo4jRepository&lt;State, Long&gt;{

	@Query(&quot;MATCH p=()-[r:COUNTY_IN_STATE]-&gt;() RETURN p&quot;)
	Collection&lt;State&gt; getCountys();
}
```

County POJO:
```
@NodeEntity
@Data
@AllArgsConstructor
@EqualsAndHashCode(exclude=&quot;entityId&quot;)
public class County {
	
	@Id
	@GeneratedValue
    private Long entityId;
	
	private String name;
	
	
	@Override
	public String toString() {
		return &quot;Organization [entityId=&quot; + entityId + &quot;, name=&quot; + name + &quot;]&quot;;
	}
	

	public Long getEntityId() {
		return entityId;
	}
	public void setEntityId(Long entityId) {
		this.entityId = entityId;
	}
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	

}
```
State POJO:
```
@NodeEntity
@Data
@AllArgsConstructor
@EqualsAndHashCode(exclude=&quot;entityId&quot;)
public class State {
	
	@Id
	@GeneratedValue
    private Long entityId;
	private String name;
	
	@Relationship(type = &quot;COUNTY_IN_STATE&quot;,direction = Relationship.INCOMING)
	private List&lt;County&gt; countys;
	public  List&lt;County&gt; getCountys() {
		return countys;
		}
	

	public Long getEntityId() {
		return entityId;
	}
	public void setEntityId(Long entityId) {
		this.entityId = entityId;
	}
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	
}
```
Expected output 
```
[
   {
      &quot;entityId&quot;:207624,
      &quot;name&quot;:&quot;AK&quot;,
      &quot;countys&quot;:[
         {
            &quot;entityId&quot;:207367,
            &quot;name&quot;:&quot;Anchorage&quot;
         },
         {
            &quot;entityId&quot;:207452,
            &quot;name&quot;:&quot;Kodiak Island&quot;
         }
      ]
   },
   {
      &quot;entityId&quot;:211899,
      &quot;name&quot;:&quot;WI&quot;,
      &quot;countys&quot;:[
         {
            &quot;entityId&quot;:207367,
            &quot;name&quot;:&quot;Shelby&quot;
         },
         {
            &quot;entityId&quot;:207452,
            &quot;name&quot;:&quot;Chilton&quot;
         }
      ]
   }
]
```
Actual output
```
[
    {
        &quot;entityId&quot;: 207624,
        &quot;name&quot;: &quot;AK&quot;,
        &quot;countys&quot;: []
    },
    {
        &quot;entityId&quot;: 211899,
        &quot;name&quot;: &quot;WI&quot;,
        &quot;countys&quot;: []
    }
]
```
Neo4j query
```
MATCH p=()-[r:COUNTY_IN_STATE]-&gt;() RETURN p

{
   &quot;start&quot;:{
      &quot;identity&quot;:207623,
      &quot;labels&quot;:[
         &quot;County&quot;
      ],
      &quot;properties&quot;:{
         &quot;name&quot;:&quot;Anchorage&quot;
      }
   },
   &quot;end&quot;:{
      &quot;identity&quot;:207624,
      &quot;labels&quot;:[
         &quot;State&quot;
      ],
      &quot;properties&quot;:{
         &quot;name&quot;:&quot;AK&quot;
      }
   },
   &quot;segments&quot;:[
      {
         &quot;start&quot;:{
            &quot;identity&quot;:207623,
            &quot;labels&quot;:[
               &quot;County&quot;
            ],
            &quot;properties&quot;:{
               &quot;name&quot;:&quot;Anchorage&quot;
            }
         },
         &quot;relationship&quot;:{
            &quot;identity&quot;:1120645,
            &quot;start&quot;:207623,
            &quot;end&quot;:207624,
            &quot;type&quot;:&quot;COUNTY_IN_STATE&quot;,
            &quot;properties&quot;:{
               
            }
         },
         &quot;end&quot;:{
            &quot;identity&quot;:207624,
            &quot;labels&quot;:[
               &quot;State&quot;
            ],
            &quot;properties&quot;:{
               &quot;name&quot;:&quot;AK&quot;
            }
         }
      }
   ],
   &quot;length&quot;:1.0
}

{
   &quot;start&quot;:{
      &quot;identity&quot;:207628,
      &quot;labels&quot;:[
         &quot;County&quot;
      ],
      &quot;properties&quot;:{
         &quot;name&quot;:&quot;Kodiak Island&quot;
      }
   },
   &quot;end&quot;:{
      &quot;identity&quot;:207624,
      &quot;labels&quot;:[
         &quot;State&quot;
      ],
      &quot;properties&quot;:{
         &quot;name&quot;:&quot;AK&quot;
      }
   },
   &quot;segments&quot;:[
      {
         &quot;start&quot;:{
            &quot;identity&quot;:207628,
            &quot;labels&quot;:[
               &quot;County&quot;
            ],
            &quot;properties&quot;:{
               &quot;name&quot;:&quot;Kodiak Island&quot;
            }
         },
         &quot;relationship&quot;:{
            &quot;identity&quot;:1120646,
            &quot;start&quot;:207628,
            &quot;end&quot;:207624,
            &quot;type&quot;:&quot;COUNTY_IN_STATE&quot;,
            &quot;properties&quot;:{
               
            }
         },
         &quot;end&quot;:{
            &quot;identity&quot;:207624,
            &quot;labels&quot;:[
               &quot;State&quot;
            ],
            &quot;properties&quot;:{
               &quot;name&quot;:&quot;AK&quot;
            }
         }
      }
   ],
   &quot;length&quot;:1.0
}
```",1628060678,https://stackoverflow.com/q/68646794,routh mahesh,"['spring-boot', 'java', 'neo4j', 'api', 'json']"
68643516,Display intermediary nodes and relationships when finding path between two nodes,"I&#39;m trying to return the relationships between nodes where there could be one or two hops between them.

More precisely, below, I&#39;m trying to find links between User `userA` and a Repository that has a relationship with a Status.

```
match (u:User{login: &quot;userA&quot;})-[*..2]-&gt;(r:Repository)-[HAS_STATUS]-&gt;(s:Status) 
return *
```

The above query works and returns all the results, but does not display the relationship between the User and the Repository if there is an intermediate node.

Here&#39;s a screenshot of the results and what I mean visually:

[![enter image description here][1]][1]

Note that for some reason, where there is a *single* hop between the User and a Repository, the relationship is shown. It&#39;s the two hop relationships that are not displayed.


  [1]: https://i.stack.imgur.com/rwpKQ.png",1628030466,https://stackoverflow.com/q/68643516,dbzuk,['neo4j']
68642724,How do I fetch all the data or just the size of it in Neo4j?,The [current documentation](https://neo4j.com/docs/cypher-manual/current/databases/) only shows how to list databases but not to fetch all rows and the size of it. How do I fetch databases&#39; size and count?,1628024244,https://stackoverflow.com/q/68642724,Aviral Srivastava,"['cypher', 'neo4j']"
68638317,Retrieve custom properties with Neo4j/Spring boot,"I&#39;d like to be able to retrieve some custom properties in my java &#39;node&#39; from neo4j.
I would like if possible to use the latest version of spring boot/neo4j.

I would need to have both the name of the custom properties and the value.

From my research I think I&#39;ve found something that is capable of doing what I want but I can&#39;t make it works.
Using SDN 6 it is possible to tag a collections with &#39;@DynamicLabels&#39;. But no matter how I try to query the database, the collections is always empty.

My node/entity:

```
@Node(&quot;asset&quot;)
public class Asset {

    @Id
    @GeneratedValue
    private Long id;

    private String owner;

    @DynamicLabels
    private List&lt;String&gt; properties = new ArrayList&lt;&gt;();
}
```

My repository:
```
@Repository
public interface AssetRepository extends Neo4jRepository&lt;Asset, Long&gt; {

    @Query(&quot;MATCH (pa: primary_assets) WHERE id(pa) = 14 RETURN pa&quot;)
    Asset test ();
}
```

I don&#39;t know if I&#39;m heading the right way or if I totaly missed something.

Thx in advance",1628002412,https://stackoverflow.com/q/68638317,J.Azur,"['spring-boot', 'spring-data-neo4j', 'spring-data', 'neo4j']"
68636308,NEO4J 4.3.1 json log format not working for http.log,"In version 4.3.1 of the common edition, when setting the value dbms. lob. default_format=JSON, the http log is set.json is written as before in the PLAIN format and not in JSON. On debug.the json parameter is distributed.

Why does this occur?",1627994739,https://stackoverflow.com/q/68636308,Юлия Жулай,['neo4j']
68632062,Neo4J pruning transaction log from java,"We are creating a Neo4J database from code, but transaction log parameters seem to not be working when passing them through Java. We want to aggressively prune the log files, as we won&#39;t be using them (it&#39;s a read only database so transactions are not that useful and make exchanging the database harder). In past versions was fine to just remove the transaction logs, but now they seem mandatory.

I&#39;ve [found a website][1] that explain which parameters should be used for this aggressive pruning, however, specifying them in the connection doesn&#39;t seem to be working properly

    managementService = new DatabaseManagementServiceBuilder(new File(dbPath))
				.setConfig(GraphDatabaseSettings.default_database, &quot;mydb&quot;)
				.setConfig(GraphDatabaseSettings.max_concurrent_transactions, 0)
				.setConfig(GraphDatabaseSettings.check_point_interval_time, Duration.ofSeconds(30))
				.setConfig(GraphDatabaseSettings.check_point_interval_tx, 1)
				.setConfig(GraphDatabaseSettings.keep_logical_logs, &quot;false&quot;)
				.setConfig(GraphDatabaseSettings.logical_log_rotation_threshold, 1048576L)
				.build();

Any ideas on how to make that work from Java?

  [1]: https://www.markhneedham.com/blog/2018/12/24/neo4j-prune-transaction-logs-more-aggressively/",1627976239,https://stackoverflow.com/q/68632062,Yampeku,"['neo4j', 'java']"
68630110,Query Neptune nodes with Cypher not working in Node.js,"I&#39;m using Neptune version 1.0.5.0 with the bolt+s protocol.  
I&#39;ve run the following query: MATCH (n) return n limit 1  
with Node.js neo4j latest driver (4.3) and getting the following error:  

    Neo4jError: &quot;Unexpected server exception &#39;Data type unsupported in Bolt in current release  
    http://www.w3.org/2001/XMLSchema#dateTime&#39;&quot;  
    :  
    at captureStacktrace (result.js:239:17)  
    at new Result (result.js:59:23)  
    at Session._run (session.js:165:16)  
    at Session.run (session.js:131:21)  

code:  

    const session = db.getSession();
    try {
        const result = await session.run(query);
        ...

While the same code works with a local Neo4j server.  
In addition, running: &quot;MATCH (n) return n.myprop limit 1&quot; works with Neptune.  
Any help will be appreciated.",1627962270,https://stackoverflow.com/q/68630110,Avner Levy,"['neo4j', 'amazon-neptune', 'node.js', 'cypher', 'bolt']"
68628353,Liquigraph schema files missing?,"We have a service in our site that uses neo4j for the database. Today when I tried to load up the service for development the project bombs out. I&#39;m getting errors like this:

    org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;liquigraph&#39; defined in class path resource [org/liquigraph/spring/starter/LiquigraphAutoConfiguration$LiquigraphConfiguration.class]: Invocation of init method failed; nested exception is java.lang.IllegalArgumentException: 
	cvc-elt.1: Cannot find the declaration of element &#39;changelog&#39;.

and this:

    2021-08-02 14:43:41.516  WARN 9650 --- [  restartedMain] o.l.core.io.xml.ChangelogParser          : XSD validation warning : schema_reference.4: Failed to read schema document &#39;http://www.liquigraph.org/schema/1.0/liquigraph.xsd&#39;, because 1) could not find the document; 2) the document could not be read; 3) the root element of the document is not &lt;xsd:schema&gt;.

in my terminal.

I went to the [site listed in the error][1] and it doesn&#39;t work. There is also [this one][2] which is pretty similar but gives a 404.

our pom.xml file lists this for liquigraph:

    &lt;!-- https://mvnrepository.com/artifact/org.liquigraph/liquigraph-spring-boot-starter --&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;org.liquigraph&lt;/groupId&gt;
		&lt;artifactId&gt;liquigraph-spring-boot-starter&lt;/artifactId&gt;
		&lt;version&gt;3.0.3&lt;/version&gt;
	&lt;/dependency&gt;

In researching the project I saw something about running it &quot;offline&quot; or something. How can I get the project to load with the XSD files missing?


  [1]: http://www.liquigraph.org/schema/1.0/liquigraph.xsd
  [2]: https://liquigraph.github.io/schema/1.0/liquigraph.xsd",1627941595,https://stackoverflow.com/q/68628353,William,"['xsd', 'liquigraph', 'neo4j']"
68623325,Neo4j 4.3 Cluster Creation always fail,"while creating cluster for neo4j4.3.2 follow the steps given in doc
https://neo4j.com/docs/operations-manual/current/tutorial/local-causal-cluster/",1627914381,https://stackoverflow.com/q/68623325,Shivakant,"['cluster-computing', 'neo4j']"
68623017,Neo4j list NOT IN another list query,"The `Person` and `Restaurant` nodes have `(:Person)-[:LIKED]-&gt;(:Restaurant)` type of relationship. A person may like many restaurants.

The `Restaurant` and `City` nodes have `(:Restaurant)-[:LOCATED_IN]-&gt;(:City)` type of relationship. A restaurant may be located in more than one city.

The `Person` and `City` nodes have `(:Person)-[:LIVES_IN]-&gt;(:City)` type of relationship. A person may live in more that one city.

I want the `person_name` who likes a `restaurant` that is located in a `city` that is different from where they live right now and the list of such restaurants and here is my attempt:
```
MATCH (c:City)&lt;-[LIVES_IN]-(p:Person)-[:LIKED]-&gt;(r:Restaurant)-[:LOCATED_IN]-&gt;(rc:City)
WHERE NOT c.city_name IN rc.city_name
RETURN p.person_name, collect(r.restaurant_name);
```

It does not work.",1627913212,https://stackoverflow.com/q/68623017,user173729,['neo4j']
68619241,Neo4J : How to Order results by attributes value,"How do I order my results using Node properties value using Cypher Queries?

For Example :
I have the below results :

| Person   | City |
| -------- | -------------- |
| Kasper   | London         |
| Sean     | Chicago        |
| Tom      | London         |
| Kate     | New York       |
| John     | London         |
| Sarah    | Chicago        |

I want to sort the above result on basis of &quot;London&quot; i.e people from London should be on top. The sorted results can look something like this :

| Person   | City |
| -------- | -------------- |
| Kasper   | London         |
| John     | London         |
| Tom      | London         |
| Kate     | New York       |
| Sean     | Chicago        |
| Sarah    | Chicago        |

I know Order By clause can be used to sort in ascending or descending order but can we use it to sort on the basis of Value? If not, please suggest some other way to do it. Thanks in advance.

",1627896516,https://stackoverflow.com/q/68619241,Natwar,"['cypher', 'sorting', 'neo4j']"
68615940,NOT operator fails to filter as expected in cypher query,"I&#39;m having trouble getting the `NOT` operator to work in my cypher query.

The following query works and returns a result:

```
MATCH p=(a)&lt;-[*]-(b:WorkOrderNode)
WHERE ID(a)=107
AND b.action_code=&#39;INS&#39;
AND NONE(x in nodes(p) WHERE exists(x.action_code) AND x.action_code=&#39;PULL&#39;)
RETURN b
```

However, this query is not that effective for my business logic because there can be an arbitrary number of actions, so what I really want is to exclude any paths where there may be a node with a work action **other than** &#39;MV&#39; or &#39;SPT&#39; (work action is not &#39;MV&#39; or &#39;SPT&#39;).

Hence, I update my code to:

```
MATCH p=(a)&lt;-[*]-(b:WorkOrderNode)
WHERE ID(a)=107
AND b.action_code=&#39;INS&#39;
AND NONE(x in nodes(p) WHERE exists(x.action_code) AND NOT x.action_code IN [&#39;MV&#39;, &#39;SPT&#39;])
RETURN b
```

But the problem is that there are no results returned for this query.

These two statements should be logically equivalent? `x.action_code=&#39;PULL&#39;` ==(?) `NOT x.action_code IN [&#39;MV&#39;, &#39;SPT&#39;]`

I also tried the following but it also doesn&#39;t work. There&#39;s something I&#39;m obviously missing:

```
MATCH p=(a)&lt;-[*]-(b:WorkOrderNode)
WHERE ID(a)=107
AND b.action_code=&#39;INS&#39;
AND NONE(x in nodes(p) WHERE exists(x.action_code) AND (x.action_code &lt;&gt; &#39;MV&#39; OR x.action_code &lt;&gt; &#39;SPT&#39;))
RETURN b
```",1627873599,https://stackoverflow.com/q/68615940,Scratch&#39;N&#39;Purr,"['neo4j', 'cypher']"
68615598,Neo4j: How to bring database back online,"I was running a large delete query and got an out of memory error, so the DB shutdown automatically.  I restarted it, but it is still showing as &#39;offline&#39; in Neo4j desktop.

Here are the log entries from the restart:

    2021-08-01 23:47:03.506+0000 INFO  Starting...
    2021-08-01 23:47:06.804+0000 INFO  ======== Neo4j 4.2.1 ========
    Exception in thread &quot;neo4j.Scheduler-1&quot; java.lang.OutOfMemoryError: Java heap space
    WARNING: sun.reflect.Reflection.getCallerClass is not supported. This will impact performance.
    2021-08-01 23:47:22.505+0000 INFO  Sending metrics to CSV file at /Users/my_user/Library/Application Support/Neo4j Desktop/Application/relate-data/dbmss/dbms-########-####-####-####-##########/metrics
    2021-08-01 23:47:22.524+0000 INFO  Bolt enabled on localhost:7687.
    2021-08-01 23:47:23.836+0000 INFO  Remote interface available at http://localhost:7474/
    2021-08-01 23:47:23.837+0000 INFO  Started.

Similarly, when I attempt to connect from a browser it tells me that the Neo4j database is unavailable.

In the log I can see that there is a Java out of memory error.  Why would this appear?  Does Neo4j queue/cache incomplete queries?  And how do I go about clearing it if I can&#39;t access the server?

The data is only test data, so I don&#39;t need to save it.  I do need to understand if I can fix it, and how, since I am putting the product through its paces for a new project.",1627868443,https://stackoverflow.com/q/68615598,DatsunBing,['neo4j']
68612299,Neo4j index query runs slowly,"I&#39;m using Neo4j 4.0.6 enterprise edition trying to do an indexed query to find max.

I&#39;ve 5 million user nodes in this DB.

I&#39;ve an index on tsScan:

    CREATE INDEX user_scan for (u:User) on (u.tsScan)

Then I tried this:

    match (u:User)
                return u.id as id
                order by u.tsScan
                limit 100

It is taking a very long time time. About 3 minutes.

Since its a btree index, I expect that it should just pick the first 100 pointers in the pre sorted index.

Why does this take so long?

What do I have to do to be able to leverage the native-btree-1.0 index on u.tsScan ?

PS: This is running on a Mac with 16GB memory in the neo4j:4.0.6-enterprise docker container.

",1627834864,https://stackoverflow.com/q/68612299,fodon,"['neo4j', 'cypher']"
68608916,Set relationship property in a range in Neo4j,"I follow this [Link][1] to use a graph generator  to create a graph scaling to +10000 nodes and to execute the shortest path algorithm between two nodes.  

How can I set the relationship property for all the nodes to be in a specific range?   


This [Link][2] provides more options, but I don&#39;t know how to use it. Any help?

Update: I do the as follow: 

    CALL gds.beta.graph.generate(&#39;test&#39;, 10, 3, 
    {
      relationshipDistribution: &#39;random&#39;,
      relationshipProperty: {
                            name:&#39;myProperty&#39;,
                            type: &#39;RANDOM&#39;,
                            min : 40.0,
                            max : 80.0
                            }
    })
    YIELD name, nodes, relationships, generateMillis, relationshipSeed, averageDegree, relationshipDistribution, relationshipProperty
 The following error occurs:

    Neo.ClientError.Procedure.ProcedureCallFailed
    Failed to invoke procedure `gds.beta.graph.generate`: Caused by: java.lang.NullPointerException 
    
[1]: https://neo4j.com/labs/apoc/4.1/graph-updates/graph-generators/
[2]: https://neo4j.com/docs/graph-data-science/current/alpha-algorithms/graph-generation/#graph-generation-distribution",1627808568,https://stackoverflow.com/q/68608916,Sama,"['neo4j', 'relationship', 'graph', 'shortest-path']"
68607272,convert gremlin queries to cypher query,"
 our system is using a graph database( not neo4j )and it&#39;s in live .
 Wanted to migrate it to Neo4j.
 
we have used gremlin for graph traversal and approximately 10000 gremlin traversal queries(read intensive system) and impossible to translate each and every query to cypher .
It will lead to a very big change in the system , testing etc .

Hence we are looking for a gremlin to cypher translator which is something similar to open cypher library which converts cypher to gremlin.
Input is cypher query string and output is gremlin.

Similarly if we have any such library for taking gremlin query string as input and converting it to cypher query string so that we can seamlessly migrate our system.

We have tried a gremlin bolt driver [it relied on a lot of roundtrips.] but it didn&#39;t work as expected and it is not taking gremlin query as string and also big queries are not working .",1627787826,https://stackoverflow.com/q/68607272,HashDhi,['neo4j']
68599340,What is the correct way to represent dates in a graph database (Neo4j)?,"CREATE(:People{name: &quot;Sally&quot;, date_of_birth:&quot;12-04-1991&quot;})
I&#39;m confused as to how to find her current age. Is my way of representing a date wrong?",1627708792,https://stackoverflow.com/q/68599340,Rochak Bhusal,['neo4j']
68594263,Neo4j Update List of Maps with a map,"I am trying to merge a node that has a JSON string property as below.
And I am trying to merge it with the below logic:
1) convert JSON string into list of maps using `apoc.convert.fromJsonList` 
2) check if the given key: value exists in the list
3) if exists update the map and convert updated list of map to string and SET the value
4) if not exists add new map to list and convert updated list of map to string and SET the value

Code I am trying:

    CREATE (n:SomeNode {nid: 1, jsn: &quot;[{&#39;a&#39;:&#39;1&#39;, &#39;b&#39;: &#39;val1&#39;}, {&#39;a&#39;: &#39;2&#39;, &#39;b&#39;: &#39;val2&#39;}]&quot; })
    MERGE (n:SomeNode {nid: 1})
    ON MATCH SET n.jsn = &#39;logic to update&#39;
I tried many different way with `apoc.map` functions but I could not found any combination with them, also tried with `reduce` function but no luck.

I have a csv file like:

    &quot;a&quot;, &quot;b&quot;
    &quot;2&quot;, &quot;val3&quot;
    &quot;3&quot;, &quot;val4&quot;

  and when I merge the node from CSV, I am expecting the below result after the merge.

    jsn: &quot;[{&#39;a&#39;:&#39;1&#39;, &#39;b&#39;: &#39;val1&#39;}, {&#39;a&#39;: &#39;2&#39;, &#39;b&#39;: &#39;val3&#39;}, {&#39;a&#39;: &#39;3&#39;, &#39;b&#39;: &#39;val4&#39;}]&quot;
Is there any suggestion on how can I achieve this?",1627662523,https://stackoverflow.com/q/68594263,Deniz,"['cypher', 'neo4j']"
68594075,How to get data with relationship in neo4j?,"I&#39;m new to Neo4j and come from PostgreSQL. So, I&#39;m facing a problem with retrieving a set of data in a relationship. For more detail, I have Category and Product Nodes. So, I would like to retrieve data like the following:

    [{
       name: category_1,
       products: [],
     },
     {  name: category_2,
       products: []
    }]

It&#39;s easy for me if I do it in PostgreSQL, but in Neo4j I don&#39;t know how to do that. 
The relationship between category and product is one-to-many.
Thanks for any supports.",1627661557,https://stackoverflow.com/q/68594075,stevenH,"['relationship', 'neo4j']"
68588525,Cypher: Getting n neighboring Nodes for each Node of certain type,"I&#39;m using Neo4j Sever 4.2.5.

The Pattern on which I want to run my query looks as follows:

```(Artist)-[similar_to {score: &lt;float&gt;}]-&gt;(Artist)```

Now what I want to do is get the 5 ```[similar_to]``` relations with the highest scores for each artist. 

I&#39;ve tried using Neo4j&#39;s ```collect()``` function to collect all the artists into a list and then using ```UNWIND``` to iterate over that. Sadly the ```LIMIT``` clause seems to limit the total number of returned records and not the returned records per iteration. 

Any help would be appreciated.

Thanks in advance",1627636981,https://stackoverflow.com/q/68588525,NoobD0gg,"['cypher', 'graph', 'neo4j']"
68588484,Count the number of different types of edges of a node,"For the same node, I want to count the number of outgoing edges of his three types, the result of the subquery seems to be incorrect. Like this, note the fourth line and after
```
MATCH path=(account:Account{id:15393163051738})-[:transfer*1..3]-&gt;(otherAccount:Account)
WHERE ALL (edge IN relationships(path) WHERE edge.transferDate &gt; 1276657248987  AND edge.transferDate &lt; 1330135293550 )
WITH COLLECT(DISTINCT otherAccount.id) AS disOtherAccount
MATCH (oAccount:Account)-[edge4:signUp]-&gt;(phone:Phone)
WHERE oAccount.id IN disOtherAccount AND edge4.signUpDate&gt;1276657248987 AND edge4.signUpDate&lt;1330135293550 AND phone.isBlocked=true
WITH COUNT(DISTINCT phone) AS phoneCount, disOtherAccount
MATCH (oAccount:Account)-[edge5:signIn]-&gt;(ip:IP)
WHERE oAccount.id IN disOtherAccount AND ip.signInDate&gt;12766572489870 AND ip.signInDate&lt;1330135293550 AND ip.isBlocked = TRUE
WITH COUNT(DISTINCT ip) AS ipCount, disOtherAccount, phoneCount
MATCH (oAccount:Account)-[edge6:signIn]-&gt;(mac:MAC)
WHERE oAccount.id IN disOtherAccount AND mac.signInDate&gt;127665724898700 AND mac.signInDate&lt;1330135293550 AND mac.isBlocked = TRUE
RETURN phoneCount, ipCount, COUNT(DISTINCT mac) AS macCount
```",1627636788,https://stackoverflow.com/q/68588484,lpp,"['neo4j', 'cypher']"
68586258,Cypher variable path condition filtering,"The cypher does not support conditional filtering of variable paths. It can only be searched by sub-queries, but the efficiency of sub-queries is particularly low. How should it be optimized?
```
MATCH (account:Account{id:15393163051738})-[edge1:transfer]-&gt;(otherAccounts1:Account)
  WHERE edge1.transferDate&gt;1276657248987 AND edge1.transferDate&lt;1330135293550
WITH DISTINCT otherAccounts1 AS otherAccounts1
MATCH (account:Account{id:15393163051738})-[edge1:transfer]-&gt;()-[edge2:transfer]-&gt;(otherAccounts2:Account)
  WHERE edge1.transferDate&gt;1276657248987 AND edge1.transferDate&lt;1330135293550 AND edge2.transferDate&gt;1276657248987 AND edge2.transferDate&lt;1330135293550
WITH DISTINCT otherAccounts2 AS otherAccounts2, otherAccounts1
MATCH (account:Account{id:15393163051738})-[edge1:transfer]-&gt;()-[edge2:transfer]-&gt;()-[edge3:transfer]-&gt;(otherAccounts3:Account)
  WHERE edge1.transferDate&gt;1276657248987 AND edge1.transferDate&lt;1330135293550 AND edge2.transferDate&gt;1276657248987 AND edge2.transferDate&lt;1330135293550 AND edge3.transferDate&gt;1276657248987 AND edge3.transferDate&lt;1330135293550
WITH COLLECT(DISTINCT otherAccounts1.id) + COLLECT(DISTINCT otherAccounts2.id) + COLLECT(otherAccounts3.id) as otherAccounts
RETURN otherAccounts
```",1627625851,https://stackoverflow.com/q/68586258,lpp,"['cypher', 'neo4j']"
68585129,How can I define a Neo4j node property from 2 possible paths with a cypher query?,"Quite new to neo4j/cypher. Im trying to return a property that is accessed by 2 different paths, depending on the Label, in this case, the Label of (n). 

    MATCH (k:KeyNode)&lt;-[:BASED_ON]-(n)-[:CONTROLS|:MODIFIES]-&gt;()
        WHERE id(k)=123456
        //if label(n) = LabelA
        OPTIONAL MATCH (n)&lt;-[:LABEL_A_REL]-(c:Controller)-[:CONTROLS]-&gt;(r:Resource)-[:TYPE_OF]-&gt;(rt:ResourceType) 
        //if label(n) = NotLabelA
        OPTIONAL MATCH (n)-[:LABEL_NOT_A_REL]-&gt;(r:Resource)-[:TYPE_OF]-&gt;(rt:ResourceType) 
        OPTIONAL MATCH (r)-[:PARENT*]-&gt;(ro:Room) 
        RETURN ID(r) as resourceId, ID(ro) as siteId, ID(rt) as rt:ResourceType

As is, the path defined 1st optional match and its defined nodes take precedence, leaving the 2nd opt match/path node redefinitions untouched, i assume because cypher won&#39;t redefine a variable. The goal is to get (r) and (rt) found on 2 possible paths.

I considered using CASE WHEN structure, but from the documentation I see only the option to return single properties, and not multiple (though i could be wrong)",1627615842,https://stackoverflow.com/q/68585129,m4ng0o,"['neo4j', 'cypher']"
68575717,"Many-to-Many Relationship , both the entities are not associated if direction is marked in the @Relationship annotation","Env details :   
Java version : 1.8  
neo4j.ogm.version = 3.2.24  
neo4j server version = 4.3.2  

model details :   
Person has many address   
address has many person  

steps to reproduce   
1. created two person and one address
2. related same address to both the person
3. saved both the person

direction is person-&gt; out address&lt;-in 

Expected : both the person should relate to same address entity.   
Actual : last saved person is related . other person is not related (dangling) 
if just annotate the field with @Relationship then both the person is related .
however need to provide direction in the @Relationship.  
object model
```
    @NodeEntity
    public class Person {
	@Id
	@GeneratedValue
	public Long nativeId;
	private String name;

	@Relationship(type = &quot;addresses&quot;, direction = Relationship.OUTGOING)
	private Set&lt;Address&gt; addresses;

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public Set&lt;Address&gt; getAddresses() {
		return addresses;
	}

	public void setAddresses(Set&lt;Address&gt; addresses) {
		this.addresses = addresses;
	}

	public void addAddress(Address address) {
		this.addresses = this.addresses == null ? new HashSet&lt;Address&gt;() : this.addresses;
		this.addresses.add(address);
	}

}

import java.util.Set;

import org.neo4j.ogm.annotation.GeneratedValue;
import org.neo4j.ogm.annotation.Id;
import org.neo4j.ogm.annotation.NodeEntity;
import org.neo4j.ogm.annotation.Relationship;

@NodeEntity
public class Address {

	@Id
	@GeneratedValue
	public Long nativeId;
	private String zipCode;

	@Relationship(type = &quot;addresses&quot;, direction = Relationship.INCOMING)
	private Set&lt;Person&gt; persons;

	public String getZipCode() {
		return zipCode;
	}

	public void setZipCode(String zipCode) {
		this.zipCode = zipCode;
	}

	public Set&lt;Person&gt; getPersons() {
		return persons;
	}

	public void setPersons(Set&lt;Person&gt; persons) {
		this.persons = persons;
	}

}

public class ManytoManyTest {

	public static void main(String[] args) {
		Configuration configuration = new Configuration.Builder().uri(&quot;bolt://localhost&quot;).credentials(&quot;neo4j&quot;, &quot;test&quot;)
				.useNativeTypes().verifyConnection(true).build();
		SessionFactory sessionFactory = new SessionFactory(configuration, &quot;com.domain.model&quot;);
		Session session = sessionFactory.openSession();
		session.beginTransaction();
		
		Person hash = new Person();
		hash.setName(&quot;hash&quot;);

		Person dhi = new Person();
		dhi.setName(&quot;dhi&quot;);

		Address address = new Address();
		address.setZipCode(&quot;560001&quot;);

		hash.addAddress(address);
		dhi.addAddress(address);

		session.save(hash);
		session.save(dhi);

		session.getTransaction().commit();
		sessionFactory.close();
	}

}
```
Sample ouput in the graph 
[dandling person node in graph][1]


  [1]: https://i.stack.imgur.com/OrSMN.png",1627560765,https://stackoverflow.com/q/68575717,HashDhi,"['neo4j', 'neo4j-ogm']"
68572760,Search unspecific term with specific answer,"I am building a database in Neo4J. I am trying to build a match query within the fulltext search. The search query has to be quite robust as it will take queries from users which are not familiar with the search term and return the node which best matches the term. I am aware of a few ways of doing this, but all require that the search term is fuzzied and not the return term. My current rules rely on contains / does not contain and loops, without building a new database, is there a way to fuzzy the search term so that essentially the nodes will search through the term provided and not the other way round? 

I am aware that this may not make sense. It is only my 3rd day on Neo4J. Please let me know if you need any more clarification. 

Edit: I figure that I can combine the does/does not contain search terms and fuzzy the search term, by increasing the does contain score and decreasing the does not contain score.",1627548065,https://stackoverflow.com/q/68572760,ryan,"['full-text-search', 'neo4j', 'search']"
68569816,Find closest node that matches criteria but cannot have intermediary nodes that have certain properties,"I have the following criteria:

1. From a starting node with an internal ID of X, I want to grab the closest `WorkOrderNode` that has an `action_code` of &quot;INS&quot;.
2. However, between those two nodes, there can be an arbitrary number of nodes, and I need to make sure these intermediary nodes are not `WorkOrderNode`s that have `action_code`s other than &quot;MV&quot; or &quot;SPT&quot;.

Here is my latest attempt:

```
MATCH p=(a)&lt;-[*]-(b:WorkOrderNode {action_code: &#39;INS&#39;})
WHERE ID(a)=105
RETURN b, size(relationships(p)) as distance
ORDER BY distance
LIMIT 1
```

This fulfills the 1st criteria but I&#39;m having problems implementing the 2nd criteria. I tried using `AND NOT EXISTS((b)-[*]-&gt;(c:WorkOrderNode) WHERE c.action_code NOT IN [&#39;MV&#39;, &#39;SPT&#39;]` in the parent `WHERE` clause but neo4j throws an error because I can&#39;t have a `WHERE` clause in an `EXISTS` clause.",1627530536,https://stackoverflow.com/q/68569816,Scratch&#39;N&#39;Purr,"['neo4j', 'cypher']"
68568327,Field-level cypher statements do not work when accepting parameters in Apollo-server,"The cypher directive on a field-level does not work as [expected][1].

Minimal example:
```graphql
type Question {
  id: ID! @id
  required: Boolean
  testing(someId: ID!): Boolean
    @cypher(statement: &quot;&quot;&quot;
      MATCH (q:Question {id:$someId}) RETURN q.required
    &quot;&quot;&quot;)
}
```

When running the below query, I&#39;m getting an error.

    {
      Question {
        testing(someId: &quot;12345678-1234-1234-1234-0123456789ab&quot;)
      }
    }



This is the error log as seen in the Apollo Playground:

&gt; {   &quot;errors&quot;: [
&gt;     {
&gt;       &quot;message&quot;: &quot;Invalid input &#39;_someId&#39;: expected\n  \&quot;!=\&quot;\n  \&quot;%\&quot;\n  \&quot;*\&quot;\n  \&quot;+\&quot;\n  \&quot;,\&quot;\n  \&quot;-\&quot;\n  \&quot;.\&quot;\n  \&quot;/\&quot;\n  \&quot;:\&quot;\n
&gt; \&quot;&lt;\&quot;\n  \&quot;&lt;=\&quot;\n  \&quot;&lt;&gt;\&quot;\n  \&quot;=\&quot;\n  \&quot;=~\&quot;\n  \&quot;&gt;\&quot;\n  \&quot;&gt;=\&quot;\n 
&gt; \&quot;AND\&quot;\n  \&quot;CONTAINS\&quot;\n  \&quot;ENDS\&quot;\n  \&quot;IN\&quot;\n  \&quot;IS\&quot;\n  \&quot;OR\&quot;\n 
&gt; \&quot;STARTS\&quot;\n  \&quot;XOR\&quot;\n  \&quot;[\&quot;\n  \&quot;^\&quot;\n  \&quot;}\&quot; (line 1, column 195
&gt; (offset: 194))\n\&quot;MATCH (`question`:`Question`) RETURN `question`
&gt; {testing: apoc.cypher.runFirstColumn(\&quot;MATCH (q:Question {id:$someId})
&gt; RETURN q.required\&quot;, {this: question, cypherParams: $cypherParams,
&gt; someId: $1_someId}, false)} AS `question`\&quot;\n                         
&gt; ^&quot;,
&gt;       &quot;locations&quot;: [
&gt;         {
&gt;           &quot;line&quot;: 2,
&gt;           &quot;column&quot;: 3
&gt;         }
&gt;       ],
&gt;       &quot;path&quot;: [
&gt;         &quot;Question&quot;
&gt;       ],
&gt;       &quot;extensions&quot;: {
&gt;         &quot;code&quot;: &quot;INTERNAL_SERVER_ERROR&quot;,
&gt;         &quot;exception&quot;: {
&gt;           &quot;code&quot;: &quot;Neo.ClientError.Statement.SyntaxError&quot;,
&gt;           &quot;name&quot;: &quot;Neo4jError&quot;,
&gt;           &quot;stacktrace&quot;: [
&gt;             &quot;Neo4jError: Invalid input &#39;_someId&#39;: expected&quot;,
&gt;             &quot;  \&quot;!=\&quot;&quot;,
&gt;             &quot;  \&quot;%\&quot;&quot;,
&gt;             &quot;  \&quot;*\&quot;&quot;,
&gt;             &quot;  \&quot;+\&quot;&quot;,
&gt;             &quot;  \&quot;,\&quot;&quot;,
&gt;             &quot;  \&quot;-\&quot;&quot;,
&gt;             &quot;  \&quot;.\&quot;&quot;,
&gt;             &quot;  \&quot;/\&quot;&quot;,
&gt;             &quot;  \&quot;:\&quot;&quot;,
&gt;             &quot;  \&quot;&lt;\&quot;&quot;,
&gt;             &quot;  \&quot;&lt;=\&quot;&quot;,
&gt;             &quot;  \&quot;&lt;&gt;\&quot;&quot;,
&gt;             &quot;  \&quot;=\&quot;&quot;,
&gt;             &quot;  \&quot;=~\&quot;&quot;,
&gt;             &quot;  \&quot;&gt;\&quot;&quot;,
&gt;             &quot;  \&quot;&gt;=\&quot;&quot;,
&gt;             &quot;  \&quot;AND\&quot;&quot;,
&gt;             &quot;  \&quot;CONTAINS\&quot;&quot;,
&gt;             &quot;  \&quot;ENDS\&quot;&quot;,
&gt;             &quot;  \&quot;IN\&quot;&quot;,
&gt;             &quot;  \&quot;IS\&quot;&quot;,
&gt;             &quot;  \&quot;OR\&quot;&quot;,
&gt;             &quot;  \&quot;STARTS\&quot;&quot;,
&gt;             &quot;  \&quot;XOR\&quot;&quot;,
&gt;             &quot;  \&quot;[\&quot;&quot;,
&gt;             &quot;  \&quot;^\&quot;&quot;,
&gt;             &quot;  \&quot;}\&quot; (line 1, column 195 (offset: 194))&quot;,
&gt;             &quot;\&quot;MATCH (`question`:`Question`) RETURN `question` {testing: apoc.cypher.runFirstColumn(\&quot;MATCH (q:Question {id:$someId})
&gt; RETURN q.required\&quot;, {this: question, cypherParams: $cypherParams,
&gt; someId: $1_someId}, false)} AS `question`\&quot;&quot;,
&gt;             &quot;                                                                                                                                                                                                   ^&quot;,
&gt;             &quot;: &quot;,
&gt;             &quot;    at captureStacktrace (/home/m1/citizentric/grand-housing/node_modules/neo4j-driver-core/lib/result.js:239:17)&quot;,
&gt;             &quot;    at new Result (/home/m1/citizentric/grand-housing/node_modules/neo4j-driver-core/lib/result.js:59:23)&quot;,
&gt;             &quot;    at newCompletedResult (/home/m1/citizentric/grand-housing/node_modules/neo4j-driver-core/lib/transaction.js:372:12)&quot;,
&gt;             &quot;    at Object.run (/home/m1/citizentric/grand-housing/node_modules/neo4j-driver-core/lib/transaction.js:226:20)&quot;,
&gt;             &quot;    at Transaction.run (/home/m1/citizentric/grand-housing/node_modules/neo4j-driver-core/lib/transaction.js:98:34)&quot;,
&gt;             &quot;    at _callee3$ (/home/m1/citizentric/grand-housing/node_modules/neo4j-graphql-js/dist/index.js:226:35)&quot;,
&gt;             &quot;    at tryCatch (/home/m1/citizentric/grand-housing/node_modules/regenerator-runtime/runtime.js:63:40)&quot;,
&gt;             &quot;    at Generator.invoke [as _invoke] (/home/m1/citizentric/grand-housing/node_modules/regenerator-runtime/runtime.js:293:22)&quot;,
&gt;             &quot;    at Generator.next (/home/m1/citizentric/grand-housing/node_modules/regenerator-runtime/runtime.js:118:21)&quot;,
&gt;             &quot;    at asyncGeneratorStep (/home/m1/citizentric/grand-housing/node_modules/@babel/runtime-corejs2/helpers/asyncToGenerator/index.js:5:24)&quot;,
&gt;             &quot;    at _next (/home/m1/citizentric/grand-housing/node_modules/@babel/runtime-corejs2/helpers/asyncToGenerator/index.js:27:9)&quot;,
&gt;             &quot;    at /home/m1/citizentric/grand-housing/node_modules/@babel/runtime-corejs2/helpers/asyncToGenerator/index.js:34:7&quot;,
&gt;             &quot;    at new Promise (&lt;anonymous&gt;)&quot;,
&gt;             &quot;    at new F (/home/m1/citizentric/grand-housing/node_modules/@babel/runtime-corejs2/node_modules/core-js/library/modules/_export.js:36:28)&quot;,
&gt;             &quot;    at /home/m1/citizentric/grand-housing/node_modules/@babel/runtime-corejs2/helpers/asyncToGenerator/index.js:23:12&quot;,
&gt;             &quot;    at /home/m1/citizentric/grand-housing/node_modules/neo4j-graphql-js/dist/index.js:241:30&quot;
&gt;           ]
&gt;         }
&gt;       }
&gt;     }   ],   &quot;data&quot;: {
&gt;     &quot;Question&quot;: null   } }

My package.json includes these versions:

    &quot;apollo-server&quot;: &quot;^2.25.0&quot;,
    &quot;apollo-server-core&quot;: &quot;^2.25.0&quot;,
    &quot;graphql-tag&quot;: &quot;^2.12.5&quot;,
    &quot;neo4j-driver&quot;: &quot;^4.3.1&quot;,
    &quot;neo4j-graphql-js&quot;: &quot;^2.19.2&quot;,

Top-level queries (with arguments) and field-level queries with the cypher decorator work fine as long as these do not accept parameters.
I was under the impression that this has worked earlier.

  [1]: https://grandstack.io/docs/guide-graphql-schema-design/
",1627514160,https://stackoverflow.com/q/68568327,manonthemat,"['grandstack', 'neo4j', 'graphql', 'cypher', 'apollo-server']"
68568135,How to remove NEO4J from CE edition,"I am using Neo4j CE .. there are system and neo4j databases.

-bash-4.2$ neo4j --version
neo4j 4.3.2


I am facing startup the NEO4J database..

neo4j@system&gt; show databases;
| name     | address                           | role         | requestedStatus | currentStatus | error                                                               | default | home  |
| &quot;neo4j&quot;  | &quot;awsneodevldb01.est1933.com:7687&quot; | &quot;standalone&quot; | &quot;online&quot;        | &quot;offline&quot;     | &quot;An error occurred! Unable to start `DatabaseId{483e7f9b[neo4j]}`.&quot; | TRUE    | TRUE  |


1. how can I find out why unable to start NEO4J
2. how to remove it and create an empty ENO4J

",1627512174,https://stackoverflow.com/q/68568135,Nam Kim,"['neo4j', 'cypher']"
68568040,How do I restore a Neo4j database after redeploying it on K8s but without deleting the persistent volumes?,"I have redeployed Neo4j on Kubernetes without deleting the persistent volumes. On the UI, the database Neo4j is not available to use because of the error: `database is unavailable as its status is offline`.

There was nothing in the debug logs, and in the container logs, every time the container for neo4j starts, there is an error:
```
2021-07-28 22:22:18.985+0000 ERROR [neo4j/36e26b7f] Error upgrading database. Database left intact and will likely not be able to start: org.neo4j.storageengine.migration.UpgradeNotAllowedException: Neo4j cannot be started because the database files require upgrading and upgrades are disabled in the configuration. Please set &#39;dbms.allow_upgrade&#39; to &#39;true&#39; in your configuration file and try again.
```

I read about this config from the [official documentation](https://neo4j.com/docs/operations-manual/current/reference/configuration-settings/#config_dbms.allow_upgrade) but could not understand what the term `store upgrade` means. Please note that I have upgraded Neo4j from 4.2 to 4.3.2

## Update 1
I checked the disk, the database and its files are available, way older files are present so, there is no data loss for sure, it is just &quot;offline&quot; and so &quot;unavailable&quot; in Neo4j.
",1627511444,https://stackoverflow.com/q/68568040,Aviral Srivastava,"['kubernetes', 'neo4j']"
68567280,Relationship weighting neo4j,I am attempting to create a data set of a group of people with different relationships such as friends and co-workers etc. and then use the Adamic-Agar algorithm and preferential treatment algorithm available through the Graph Data Science plugin to test their prediction accuracy. I was wondering if it is possible to give the relationships different weighting so that a friend is more important than a co-worker when the algorithm runs.,1627505921,https://stackoverflow.com/q/68567280,David Onafuwa,['neo4j']
68564059,Python Py2neo create relationship takes too long for only 150k relationship,"I have my data stocked in a list of triples and the nodes are already inserted into neo4j. However , creating relationships between these nodes takes too long (6 hours for only 150k relationship). I&#39;m using Py2neo library in python with bulk operations but it&#39;s too slow.

Here&#39;s my data:

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/pASdG.png

here&#39;s what I&#39;ve tried so far:
```create_relationships(graph.auto(),full_db,&quot;HOP_TO&quot;,start_node_key(&quot;Technology&quot;,&quot;name&quot;,&quot;level&quot;),end_node_key(&quot;Technology&quot;,&quot;name&quot;,&quot;level&quot;),keys=[&quot;cost&quot;])```

 but this takes way too long. I&#39;ve tried this too :
```
//inserting relationships into graph
tx = graph.begin()
//between techs
for index, row in full_db.iterrows():
    node1 = graph.nodes.match(&quot;Technology&quot;, name=row[&#39;skill_from&#39;], title=row[&#39;level&#39;]).first()
    node2= graph.nodes.match(&quot;Technology&quot;, name=row[&#39;skill_to&#39;], title=row[&#39;level_to&#39;]).first() 
    try:
        tx.create(Relationship(node1, &quot;HOP&quot;, node2,cost=row[&#39;cost&#39;]))
    except:
        continue
tx.commit() 
```

but it&#39;s still running after 10 hours.
Any tips on how to get it faster? without using csv loader?",1627489386,https://stackoverflow.com/q/68564059,confusedstudent,"['py2neo', 'python', 'neo4j']"
68563846,Neo4j: how to filter query,"I&#39;m having trouble getting this query to work:

    MATCH (pb:PRO{code: $pb, letter:$L})-[customerof:CUSTOMER_OF]-&gt;(c:CUSTOMER)-[:HAS_CONTRACT]-&gt;(con:CONTRACT)-[:HAS_POSITION]-&gt;(pos:POSITION)-[:HAS_PRODUCTS]-&gt;(prod:PRODUCT) WHERE
        (
            &#39;ALL&#39; in $filter
            or
            (
                &#39;FIRST&#39; in $filter
                and (prod.famprod in [&#39;AC&#39;,&#39;DT&#39;] and not prod.contractType in [&#39;95|FUNDS&#39;]))
            or
            (
                &#39;SECOND&#39; in $filter
                and not prod.famprod in [&#39;AC&#39;] OR(prod.famprod IN [&#39;AC&#39;,&#39;DT&#39;] and prod.contractType  in [&#39;95|FUNDS&#39;])
            )
        )
        and
        (
            $customerType=&#39;ALL&#39;
            or
            (
                $customerType=&#39;SINGLE&#39;
                and
                customerof.flagSingle=&#39;1&#39;
            )
            or
            (
                $customerType=&#39;NOTSINGLE&#39;
                and
                customerof.flagSingle=&#39;0&#39;
            )
        )

The problem arises when I run &#39;FIRST&#39; OR &#39;SECOND&#39;: running &#39;FIRST&#39; the **query, despite the &quot;not&quot; returns also prod.contractType in [&#39;95|FUNDS&#39;]**; running &#39;SECOND&#39; the return is right.

I&#39;m not so good with neo4j (first experience) and i can&#39;t solve the problem: i tried almost 20 different combinations but it doesn&#39;t work.

It looks like they are mirrored: when i try to modify &#39;FIRST&#39;, sometimes it changes the return of &#39;SECOND&#39;.

&#39;ALL&#39; works fine.

Can you help me to get the right return?

Thanks
",1627488484,https://stackoverflow.com/q/68563846,User992,"['nosql', 'notin', 'neo4j', 'cypher', 'sql']"
68561141,Giving conditions to Neo4j Nodes,"When I query `MATCH (n:label {Name_1: &#39;A&#39;})
MATCH (n)--(p)--(q)--(r)
RETURN n, p, q, r`

[![enter image description here][1]][1]


But B receives connection from other nodes aswell, like

[![enter image description here][2]][2]

Here I want B to be given only when I query every node connected to B with a query like

```
MATCH (n:label {Name_1: &#39;A&#39;}), (m:label {Name_1: &#39;F&#39;}), (o:label {Name_1: &#39;E&#39;})
MATCH (n)--(p)--(q)--(r)
RETURN n, m, o, p, q, r
```

Can we attain it?

  [1]: https://i.stack.imgur.com/clq5a.png
  [2]: https://i.stack.imgur.com/twE03.png",1627478177,https://stackoverflow.com/q/68561141,Gram,"['knowledge-graph', 'neo4j', 'cypher', 'nodes']"
68554432,Connection with the server breaks due to IOException: Unable to read data from the transport connection:,"Stack:
.NET Core 3.1 ,
Causal Cluster Neo4j (3.5.14) ,
Neo4j Driver (1.7.0)

We are working on the social application where video feeds are loading from the neo4j Database and its working for some of the pagination and throw the connection error on random page. I have observed when I continually use the application it&#39;s working fine but if I remain idle for 2-3 mins and scroll the feeds then api throw the error. See below the exception

&quot;One or more errors occurred. (Server at bolt+routing://IP:Port/ is no longer available due to error: Connection with the server breaks due to IOException: Unable to read data from the transport connection: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond&quot;

&gt; Below mentioned is the Neo4j context class

    public class Neo4jContext
     {
       private IDriver _driver;
       private ConnectionString _connectionString;

       public Neo4jContext(IOptions&lt;ConnectionString&gt; connectionString)
       {
           _connectionString = connectionString.Value;
           if (_driver == null)
           {
               CreateDriver();
           }
       }

       public void CreateDriver()
       {
           _driver = GraphDatabase.Driver(_connectionString.Server, 
            AuthTokens.Basic(_connectionString.UserName, _connectionString.Password));
       }

       public ISession GetSession()
       {
           return _driver.Session();
       }}


&gt;  Below is the code where I get the data after making the connection   

        using (var session = _context.GetSession())
               {
                    var query = GetQuery(obj, ref parameters);
                    var response = session.Run(query, parameters);
                    result.Data = response.ToList();
                    result.Success = true;
                    return result;
                 }
Please note one more thing we are using Singleton scope.",1627446711,https://stackoverflow.com/q/68554432,irfan shahzad,"['neo4j', '.net-core']"
68548466,org.springframework.data.neo4j.core.mapping.NoRootNodeMappingException: Could not find mappable nodes or relationships inside Record&lt;&gt;,"I&#39;m getting this error when I&#39;m trying to map return values of the `query` to the `DTO`:



&gt; org.springframework.data.neo4j.core.mapping.NoRootNodeMappingException:
&gt; Could not find mappable nodes or relationships inside
&gt; Record&lt;{subjectId: 3649, subjectName: &quot;Environmental Science&quot;,
&gt; chapterId: 4574, chapterName: &quot;Growing Up&quot;}&gt; for
&gt; org.springframework.data.neo4j.core.mapping.DefaultNeo4jPersistentEntity@51543926


This is my `DTO` class:
```
@Value
public class LearnBySubjectIdResponse implements Serializable {
  
   private Long subjectId;
   private String subjectName;
   private Long  chapterId;
   private String chapterName;
   
}

  @Query(&quot;MATCH (subjectName:ContainerName)&lt;-[subject_has_name:has_name]-(subject:Container)-[subject_has_child:has_child]-(chapter:Container{cb_rack_id:1579245})-[chapter_has_name:has_name]-(chapterContainerName:ContainerName)\n&quot; +
            &quot;match (chapter)-[chapter_has_content:has_content]-&gt;(content:Content)\n&quot; +
            &quot;RETURN subjectName.rack_name_id as subjectId, subjectName.rack_name as subjectName,chapterContainerName.rack_name_id as chapterId, chapterContainerName.name as chapterName;&quot;)
    List&lt;LearnBySubjectIdResponse&gt; getChapterContent(@Param(&quot;cbRackId&quot;) long cbRackId);

```",1627402699,https://stackoverflow.com/q/68548466,Nidhi Verma,"['neo4j', 'spring-boot', 'spring', 'java', 'graph-databases']"
68547709,Neo4j - Mass edit node properties - i.e. mass edit all keys(n),"I&#39;m trying to perform some data clean up and I was looking for a means to mass edit all my property keys on a set of nodes. In my case, I want to make all the keys(n) upper case and replace blanks with &quot;_&quot; regardless of the column name.  

The following sets does this but assumes you know the specific name of the key.

```
MATCH (c:Category)
UNWIND keys = collKeys
SET c.COMPANY = c.Company   
REMOVE c.Company
return c limit 1000
```
The following builds out a list of current keys and then what I want the labels to be.   I&#39;m just not sure how to adjust the SET correctly. 
I&#39;m trying to find a way to perform  something like the following to UPPER CASE all my keys(c)

*//SET c.REPLACE(toUPPER(c.Company),&quot; &quot;, &quot;_&quot;)  = REPLACE(toUPPER(c.Company),&quot; &quot;, &quot;_&quot;)* 

```
MATCH (c:Category)
UNWIND keys(c) as collKeys
WITH DISTINCT collKeys
WITH collKeys, REPLACE(toUPPER(collKeys),&quot; &quot;, &quot;_&quot;) as collUPPERKeys
WHERE collKeys &lt;&gt; &#39;source&#39;
SET c.collUPPERKeys = REPLACE(toUPPER(c.collKeys),&quot; &quot;, &quot;_&quot;)    //&lt;-- this is where I&#39;m struggling as c.collUPPERKeys doesn&#39;t make sense
REMOVE c.collKeys
return  c
```
I realize best practice would be to do this at import but I don&#39;t have access to that code as of yet though I intend to perform this upon data load. 

Many thanks in advance

EDIT-Is there an apoc function that might do this?",1627399728,https://stackoverflow.com/q/68547709,Jason_L,"['neo4j', 'cypher']"
68535041,Connecting one node to multiple Neo4j,"I want to connect the multiple nodes together for one sample. For example: 

```
:auto USING PERIODIC COMMIT 
LOAD CSV WITH HEADERS FROM &#39;file:///LabSample.csv&#39; AS row
CREATE (i:ID)
SET i += row 

MATCH (i:ID) 
CREATE (l:laboratory {name:&quot;New York&quot;})
MERGE (i)-[:MADE]-&gt;(l)
```

What this does is connects each ID to their own personal New York lab node, instead of all of them connecting to one singular node. To put it another way, I want to have it radiated out from one singular node, rather than connected to their own disjointed nodes. 

Thanks!",1627325287,https://stackoverflow.com/q/68535041,Joe.Shepard12,['neo4j']
68532243,Cypher query times out before the specified timeout,"I have come across instances where a Cypher query times out faster than the specified query timeout when using the `neo4j` python package.  Below I have a query that I run with a specified timeout of 2 minutes, but it fails in 1 minute 39 seconds.  What might be causing the query to timeout in less time than the specified query timeout?


```
from neo4j import GraphDatabase, Query
import datetime

driver = GraphDatabase.driver(URI, auth=(USER, PASS), database=DATABASE)

with driver.session() as session:
    q_text = &quot;&quot;&quot;QUERY HERE&quot;&quot;&quot;
    q = Query(q_text, timeout=120)

    print(&quot;Starting query&quot;)
    begin = datetime.datetime.now()
    result = session.run(q)
    end = datetime.datetime.now()
    print(&quot;Finished query&quot;)

    runtime = end - begin

    print(runtime)
    print(result.data())
```

Result:
```
Starting query
Finished query
0:01:39.754447
Traceback (most recent call last):
  File &quot;/opt/project/neo4j/debug_timeout.py&quot;, line 50, in &lt;module&gt;
    print(result.data())
  File &quot;/usr/local/lib/python3.8/dist-packages/neo4j/work/result.py&quot;, line 380, in data
    return [record.data(*keys) for record in self]
  File &quot;/usr/local/lib/python3.8/dist-packages/neo4j/work/result.py&quot;, line 380, in &lt;listcomp&gt;
    return [record.data(*keys) for record in self]
  File &quot;/usr/local/lib/python3.8/dist-packages/neo4j/work/result.py&quot;, line 215, in __iter__
    self._connection.fetch_message()
  File &quot;/usr/local/lib/python3.8/dist-packages/neo4j/work/result.py&quot;, line 62, in inner
    func(*args, **kwargs)
  File &quot;/usr/local/lib/python3.8/dist-packages/neo4j/io/_bolt4.py&quot;, line 271, in fetch_message
    response.on_failure(summary_metadata or {})
  File &quot;/usr/local/lib/python3.8/dist-packages/neo4j/io/_common.py&quot;, line 183, in on_failure
    raise Neo4jError.hydrate(**metadata)
neo4j.exceptions.ClientError: {code: Neo.ClientError.Transaction.TransactionTimedOut} {message: The transaction has been terminated. Retry your operation in a new transaction, and you should see a successful result. The transaction has not completed within the specified timeout (dbms.transaction.timeout). You may want to retry with a longer timeout. }

```",1627311874,https://stackoverflow.com/q/68532243,andrew,"['python', 'cypher', 'neo4j']"
68529849,Get node label name from csv file,"I am importing csv file from import directory by cypher and I would like to create nodes with labels from csv file. Which would look something like this

    LOAD CSV WITH HEADERS FROM &quot;file:///B.csv&quot; AS csv
    CREATE (c:csv.Type {name:csv.Name})
    return c 
I know that this is wrong, but hope you can show me the right way to do it. I couldn&#39;t find any answer in both neo4j community and in stackoverflow. 
",1627302541,https://stackoverflow.com/q/68529849,Armen Sanoyan,"['cypher', 'neo4j']"
68528620,Exporting cypher-shell output to csv not working,"I had a MATCH query which did not run in Neo4j Browser as the output was too large. 

I followed suggestions online and was able to ssh into cypher-shell using Terminal.

I was able to run the query but the output is not useful: 

Looks like this

&quot;data&quot; | &quot;data&quot; | data |

I&#39;ve looked at all similar posts for this and found two solutions for exporting to data:

1. import-export from https://github.com/jexp/neo4j-shell-tools

&gt; Invalid input &#39;i&#39;: expected &lt;init&gt; (line 2, column 1 (offset: 1))
&quot;import-cypher -d,  -o test.csv MATCH (o:Organisation) RETURN o LIMIT 1;&quot;
 ^

2. CALL apoc.export.csv.query(&quot;MATCH (o:Organisation) RETURN o LIMIT 1&quot;, &quot;result.csv&quot;, null)

I&#39;ve tried all suggestions online including 

i. adding at bottom of neo4j.conf

```
apoc.export.file.enabled=true

dbms.security.procedures.unrestricted=apoc.trigger.*,apoc.*,algo.*
```


ii. adding a apoc.conf file with
 
```
dbms.security.procedures.unrestricted=apoc.export.*,apoc.import.*

apoc.export.file.enabled=true
```

I still get the following error: 
&gt;Neo.ClientError.Procedure.ProcedureCallFailed
Failed to invoke procedure `apoc.export.csv.query`: Caused by: java.lang.RuntimeException: Export to files not enabled, please set apoc.export.file.enabled=true in your apoc.conf

I located conf directory by opening the Neo4j example project in Finder. 

Is it possible I am not editing the correct conf files? 
Or perhaps it is an authorisation issue as the database in question is on an EC2 instance?

Neo4j Browser version: 4.3.1

Neo4j Server version: 4.1.3 (community)",1627296960,https://stackoverflow.com/q/68528620,dswysb,"['cypher-shell', 'neo4j-apoc', 'neo4j']"
68526769,How to implement datetime data in Neo4J,"I want to implement Dynamic timeline tree in Neo4j.

I have Accounts with transactions. Sample Data below

|AC#|Year|Month|Day|Debit|Credit|
|:--|:----:|:-----:|:---:|:-----:|:------:|
|123456|2019|Mar|01-03-2019|1000|1000|
|123456|2020|Apr|01-04-2020|2000|2000|
|123456|2020|May|01-05-2020|2000|2000|
|123457|2018|Jan|01-01-2018|2000|2000|
|123457|2021|Mar|01-03-2021|1000|1000|
|123458|2017|Jan|01-01-2017|2000|2000|
|123458|2021|Mar|01-03-2021|1000|1000|

If the users clicks on any account number, `Year` node should open and on clicking `Year` node, `Month` nodes should open and so on.

`Year` and `Month` nodes should be dynamic. This means if some year is not available for an account number it should not be displayed.

Please help",1627288480,https://stackoverflow.com/q/68526769,Raj,['neo4j']
68524857,neo4j - Exporting data to SQL/MS Access via apoc.load.jdbcUpdate,"I am struggling to dynamically build a CREATE or ALTER statement from a list of keys(n) results to be employed using the apoc.load.jdbcUpdate function. I have this function working very well for CREATE and INSERT statements for simple CREATE and INSERT statements. 

The challenge I have is the need to export numerous lists of keys(n) in order to build a table in SQL/MS Access. Is there a way to &quot;loop&quot; through this list or collection to dynamically build this statement?  This would be followed by a similar dynamically built INSERT statement to insert the records themselves.

My actual data consists of several neo4j queries to get keys(n) of various nodes and combines them into a long list. I&#39;ll likely have 50-200 columns for each export and every column will be unique or different with only about 10 columns common to every export. At present, I can make every column TEXT 12 but next steps will be getting the associated Type(n) for each Keys(n).

Aother option I tried was trying to ALTER an existing &quot;template&quot; table however the same issue with &quot;looping through columns persists. 

Many thanks in advance! 


```
:param exportUrl =&gt; &#39;jdbc:ucanaccess:///artifacts/export/sample.accdb&#39;

WITH [&#39;colA&#39;, &#39;colB&#39;, &#39;colC&#39;, &#39;colD&#39;, &#39;colE&#39;, &#39;colF&#39;, &#39;colG&#39;, &#39;colH&#39;, &#39;colI&#39;, &#39;colJ&#39;] AS listCOLS
UNWIND listCOLS as columnNAMES
WITH columnNAMES,
 &#39;CREATE Table TBL_ATTR ([colA] TEXT(12), [colB] Double, [colC] TEXT(36), [colD] TEXT(38), [colE] Integer, [colF] TEXT(24), &#39; +
     &#39;[colG] TEXT(20), [colH] TEXT(2), [colI] TEXT(4), [colJ] TEXT(50))&#39; as statement
CALL apoc.load.jdbcUpdate($exportUrl, statement) YIELD row
return COUNT(row);         
```
The code above seems to correctly run and CREATE the table however I do receive the following exception 
```
Failed to invoke procedure `apoc.load.jdbcUpdate`: Caused by: org.hsqldb.HsqlException: object name already exists: TBL_NEW```
",1627277159,https://stackoverflow.com/q/68524857,Jason_L,"['neo4j', 'neo4j-apoc']"
68511875,Should I use neo4j when want to save d3 force graph for next time rendering?,"It seems that if I want to render d3 force-directed graph with nodes and links, links pass to the simulation must be in a list of 2-tuple.

This means I need to export the neo4j &quot;connection&quot; back to a list of 2-tuple if I want to render it again next time.

Then, in this case, I couldn&#39;t get any benefit from the &quot;native&quot; graph database(quick).

Should I then just probably store the  2-tuple list in MongoDB instead? then I could save time &quot;export the neo4j connection to a list of 2-tuple&quot;.

",1627144170,https://stackoverflow.com/q/68511875,Luk Aron,"['mongodb', 'graph', 'd3-force-directed', 'neo4j']"
68495608,Neo4j: Unsupported administration command: CREATE DATABASE demo,"I want create new database &#39;demo&#39; in neo4j, but I see a bug: 

[![enter image description here][1]][1]

I was search but can&#39;t find result, can you help me? Thank all!

  [1]: https://i.stack.imgur.com/ktpbX.png

",1627025805,https://stackoverflow.com/q/68495608,trannguyenhan,"['bigdata', 'neo4j']"
68490471,Adding a relationship leads to an error in Graph Data Science Library,"I have imported 500k Nodes and 1M relationships in the DB (
Version	4.2.1) of Neo4j (1.4.7) without any problems.

Furthermore I have installed the plugins APOC (4.2.0.0) and Graph Data Science Library (1.4.1) without any errors.

I&#39;m able to inspect all nodes and relationships in the Neo4j Browser, but when I try to use the GDSL an error occurs and I have to add following line into my neo4j.conf:

    dbms.security.procedures.unrestricted=,jwt.security.*,gds.*,apoc.*

I added the line into the config, but error still occurring.

So I tried to figure out, when the error occurs.

- When I add all nodes into my DB the GDSL is working fine.
- When I add my relationships step by step then the error only appears, after I added a specific relationship. 

When I skip this relationship then it is working in Neo4j Browser and GDSL. But when I add this relationship its only working in Neo4j Browser.

The relationships looks like this:

    match(p:packages)
    with p
    match(c:commits)
    where p.projectid = c.projectid
    create(p)-[:commits]-&gt;(c)

Nothing special.

My Commit Nodes:

    Data columns (total 3 columns):
     #   Column     Non-Null Count  Dtype
    ---  ------     --------------  -----
     0   projectid  25622 non-null  int64
     1   counts     25622 non-null  int64
     2   counts2    25622 non-null  int64
    dtypes: int64(3)

My Packages nodes looking like this: 

         #   Column       Non-Null Count  Dtype 
    ---  ------       --------------  ----- 
     0   packagename  26023 non-null  object
     1   versions     26023 non-null  int64 
     2   projectid    26023 non-null  int64 
     3   ownerid      26023 non-null  int64 
     4   projectname  26023 non-null  object
     5   language     26023 non-null  object

 
Im not looking for specifics solution, but I have no Ideas anymore what could be the error.

Already tried different versions. Different imports and so on ...

Any one else have a idea why a specific relationship is only working in Neo4j Browser and not in GDSL?

Thanks",1626981745,https://stackoverflow.com/q/68490471,inputslider,"['neo4j-apoc', 'neo4j', 'graph-data-science', 'python', 'neo4j-browser']"
68489179,Connecting two nodes based on identical properties in Neo4j,"New to Neo4j. My goal is to make a database with various csv sources. I have created node labels of &quot;geochemistry&quot; and &quot;geospatial&quot; to be linked with the &quot;LABID&quot; node via a common property. I have loaded in one dataset easily, and made the necessary connections with the &quot;:LOCATED&quot; relationship being defined as between the geospatial and LABID nodes. 

However, moving on to the second csv source, I am a little confused. I have tried matching the new geospatial data (which have no current relationships) to another set of Lab IDs. Below is my current code: 

```
MATCH (g:geospatial) WHERE NOT (g)-[:LOCATED]-&gt;(:LABID)
MATCH (l:LABID)
WHERE l.labid = g.Sample_ID
MERGE (g)-[r:LOCATED]-&gt;(l)
RETURN r
```
labid is a current property in LABID, and so is Sample_ID to the geospatial nodes. 

After completing the above query, the output is &quot;(no changes, no records)&quot;

Thanks for the help in advance! ",1626974875,https://stackoverflow.com/q/68489179,Joe.Shepard12,['neo4j']
68484384,How to fetch nodes and all their children in Spring Data Neo4j,"I have this Neo4j Node class:

    @Node
    @Data
    @AllArgsConstructor
    public class Person {
    
    	@Id
    	@GeneratedValue
    	private Long id;
    	
    	private Long parentId;
    		
    	@Relationship(type = &quot;PARENT_OF&quot;, direction = Relationship.Direction.OUTGOING)
    	private List&lt;Person&gt; children;
    	
    	public Person addChild(Person person) {
            person.setParentId(this.id);
            this.children.add(person);
            return this;
        }
    	
    }

I would like to build a query to use with the Spring Data @Query annotation, in order to fetch a list of genealogical trees, where the roots have null parentId. For each root I also would like to fetch their children, for each child their own children, etc.

The best I could come up with, so far, is the following:

    public interface PersonRepository extends Neo4jRepository&lt;Person, Long&gt; {
    	
    	@Query(&quot;&quot;&quot;
    		MATCH (person:Person) 
    		WHERE person.parentId IS NULL
    		OPTIONAL MATCH (person)-[parentOf:PARENT_OF]-&gt;(children) 
    		RETURN person, collect(parentOf), collect(children) 
    		SKIP 0 
    		LIMIT 10
    	&quot;&quot;&quot;)
    	List&lt;Person&gt; findAllGenealogicalTrees();
    }

but it doesn&#39;t seem to do what I&#39;m looking for, as it seems to only fetch the children of the roots, but not the children of the children.

Is something wrong with my query?

EDIT:

Tried the suggested query:

    MATCH path=(person)-[parentOf:PARENT_OF*]-&gt;(child)
    WHERE person.parentId IS NULL
          AND NOT (child)-[:PARENT_OF]-&gt;()
    RETURN path

but the resulting list seems to be the following:

    Person(id=0, parentId=null, children=[Person(id=1, parentId=0, children=[Person(id=3, parentId=1, children=[])])])
    Person(id=1, parentId=0, children=[Person(id=3, parentId=1, children=[])])
    Person(id=3, parentId=1, children=[])

I was expecting the first record only, since parentId should be null. How come is it returning two other records that have a not null parentId?",1626954853,https://stackoverflow.com/q/68484384,damsen,"['spring-data-neo4j', 'cypher', 'neo4j', 'java']"
68463324,GRAND Stack queries always returns NULL,"I am trying to setup a GRAND STACK project with a remote neo4j database, the following is the code for the very basic connection:

```
const { Neo4jGraphQL } = require(&quot;@neo4j/graphql&quot;);
const neo4j = require(&quot;neo4j-driver&quot;);
const { ApolloServer } = require(&quot;apollo-server&quot;);

const typeDefs = `
    type Feature {
        id: Int
        name: String @cypher(statement: &quot;MATCH (n:feature) RETURN n LIMIT 25&quot;)
    }

    type Symptom {
        id: Int
        name: String @cypher(statement: &quot;MATCH (n:symptom) RETURN n LIMIT 25&quot;)
    }
    type Query {
        features: [Feature],
        symptoms: [Symptom]
    }
`;

const driver = neo4j.driver(
    &quot;bolt://serverip:7687&quot;,
    neo4j.auth.basic(&quot;neo4j&quot;, &quot;hello-hello-hello&quot;)
);

const neoSchema = new Neo4jGraphQL({ typeDefs, driver });

// const resolvers = {
//   Query: {
//     feature: () =&gt; feature,
//   },
// };

const server = new ApolloServer({
    schema: neoSchema.schema,
    context: ({ req }) =&gt; ({ req }),
    // resolvers
});

server.listen(4000).then(() =&gt; console.log(&quot;Online&quot;));
```

And I&#39;m making the following query:

```
query Query {
  symptoms {
    name
  }
}
```

The query always returns null. Any help would be greatly appreciated. Thanks.
",1626834651,https://stackoverflow.com/q/68463324,Ishant Dahiya,"['neo4j', 'apollo', 'javascript', 'graphql']"
68461324,"Cypher Conditional `ORDER BY` clause (same property, differ ASC/DESC)","I have two queries:
```
MATCH (n:Node) 
RETURN n.value
ORDER BY n.value DESC
LIMIT 5
```
```
MATCH (n:Node) 
RETURN n.value
ORDER BY n.value ASC
LIMIT 5
```

I would like to combine them both by adding an additional parameter. I tried different approaches with `CASE` statement, but it looks like the `CASE` statement allows me to change the property of the sort, not the type of the sort...

This is a pseudo-code that does what I&#39;m trying to achieve (But this one obviously doesn&#39;t work):

```
WITH &quot;ASC&quot; AS sortType
MATCH (n:Node) 
RETURN n.value
ORDER BY n.value (CASE WHEN sortType = &quot;ASC&quot; THEN ASC ELSE DESC END)
LIMIT 5
```

So the final question is:
- How can I perform a conditional `OrderBy` clause on the same property (DESC/ASC difference)?

",1626815075,https://stackoverflow.com/q/68461324,degath,"['cypher', 'neo4j', 'graph-databases']"
68457316,Memoization in cypher,"I solved a [problem][1] from Leetcode named &quot;Loud and Rich&quot;. After doing that I started thinking about how would I solve this problem in Cypher and now I don&#39;t have a solution. 
Here is the definition of the problem:

&gt; In a group of N people (labelled 0, 1, 2, ..., N-1), each person has different amounts of money, and different levels of quietness.
&gt; 
&gt; For convenience, we&#39;ll call the person with label x, simply &quot;person
&gt; x&quot;.
&gt; 
&gt; We&#39;ll say that richer[i] = [x, y] if person x definitely has more
&gt; money than person y.  Note that richer may only be a subset of valid
&gt; observations.
&gt; 
&gt; Also, we&#39;ll say quiet[x] = q if person x has quietness q.
&gt; 
&gt; Now, return an answer, where answer[x] = y if y is the least quiet person
&gt; (that is, the person y with the smallest value of quiet[y]), among all
&gt; people who definitely have equal to or more money than person x.
&gt; 
My solution in java uses DFS and memoization to find a min value in quiet array.

        public DFS(final Map&lt;Integer, List&lt;Integer&gt;&gt; graph, final int[] quiet) {
            this.graph = graph;
            this.quiet = quiet;
        }
        public int dfs(int i){
            if (memoization.containsKey(i))
                return memoization.get(i);
            if (!graph.containsKey(i) || graph.get(i).size() == 0)
                return i;
            int result = graph.get(i).stream()
                    .map(this::dfs)
                    .reduce(i, (num1, num2 )-&gt; quiet[num1] &lt; quiet[num2] ? num1 : num2);
            memoization.put(i, result);
            return result;
        }

In Neo4j I created nodes and relations:

    create
      (n0:RichPerson {num:0, quiet:3}),
      (n1:RichPerson {num:1, quiet:2}),
      (n2:RichPerson {num:2, quiet:5}),
      (n3:RichPerson {num:3, quiet:4}),
      (n4:RichPerson {num:4, quiet:6}),
      (n5:RichPerson {num:5, quiet:1}),
      (n6:RichPerson {num:6, quiet:7}),
      (n7:RichPerson {num:7, quiet:0}),
    
      (n0) -[:Richer]-&gt; (n1),
      (n1) -[:Richer]-&gt; (n2),
      (n1) -[:Richer]-&gt; (n3),
      (n7) -[:Richer]-&gt; (n3),
      (n3) -[:Richer]-&gt; (n4),
      (n3) -[:Richer]-&gt; (n5),
      (n3) -[:Richer]-&gt; (n6)
    
    return n0, n1, n2, n3, n4, n5, n6, n7;

And the only solution that occurs to me is the following:

    MATCH path=(  (n1:RichPerson) -[:Richer*0..]-&gt; (n2)  )
    WITH
      n1,
      reduce(
        min_quiet=n1.quiet,
        n IN nodes(path) |
          CASE
            WHEN n.quite &lt; min_quiet THEN n.quite
            ELSE min_quiet
          END
      ) AS min_quiet
    RETURN distinct n1, min_quiet
    order by n1.num

Of course, it is very slow on big data, because there is no memoization here. Is it possible to speed up the query? Or shall I need to write a user defined function to solve the problem for data in Neo4j?


  [1]: https://leetcode.com/problems/loud-and-rich/",1626793954,https://stackoverflow.com/q/68457316,Alexandr Zyurkalov,"['neo4j', 'memoization', 'depth-first-search', 'cypher']"
68454875,Neo4j (cypher-shell) Create relationship too slow for existing nodes,"I&#39;m struggling to create relationships among existing nodes in Neo4j (v.4.1.1). I&#39;m creating nodes and edges via cypher-shell and a text file containing cypher commands. First I created around 20K nodes. Cypher-shell ran without issues. But then when trying to connect nodes with another script, cypher-shell freezes or hangs without giving any information about its progress. The script to create (bi-directional) connections consists of 2 parts: one in which I match nodes, and another in which I create the corresponding connections. I also created an index on a node property called &quot;image_id&quot; beforehand.

An example of a command to create a node in the first script looks like this:

`-- create_nodes.txt:`

`CREATE (i_20040:Image {image_id: &#39;MDteiLH1CZY&#39;, image_name: &#39;SetA_MDteiLH1CZY.jpg&#39;, cluster: 99})`

whereas an example to create connections looks like this:

`-- create_edges.txt:`

(from the matching section)
`MATCH (node_0: Image {image_id: &#39;-kBXeZqJtMY&#39;})`

(and then from the connecting section)
`MERGE (node_0)-[:IS_SIMILAR]-&gt;(node_1) MERGE (node_1)-[:IS_SIMILAR]-&gt;(node_0)`

There are around 40K connections to create. I&#39;m running cypher-shell from the terminal in Neo4j desktop (Windows 10) like this: 

`&gt; cypher-shell -f create_edges.txt`

I would appreciate any hints on what I am missing or doing wrong. Thank you!",1626783959,https://stackoverflow.com/q/68454875,Victor,"['cypher', 'cypher-shell', 'graph-databases', 'neo4j']"
68452972,How to build dependency graphs effectively in neo4j with python？," 1. The data is in **npm public registry**[][1]. Given a JavaScript Package `name`, go to https://registry.npmjs.org/name and I can get its information, including its dependency.
 2. Now I want to import this information into the neo4j database, building the package&#39;s dependency graph. Given a package name `express` added to the queue, there are my steps:

     - Get the JSON file of the front package in the queue return by  https://registry.npmjs.org/pkg_name
     - Parse the file and store basic information and relationships between `express` and its dependencies in neo4j with [Neo4j Python Driver][2]. 
     - For each dependency，check whether it has been added to the queue using a `set`. If not, then check whether its dependency graph has been built in neo4j. If also not, add it to the queue.
     - Repeat until the `queue` is empty. Then the dependency graph of `express` is built.

 3. The result is like this:[the dependency graph os JavaScript package of **express**][3]. The thing is the whole process of a single package takes about 50 seconds on my machine, which is too long, not to mention all packages on [npm][4], about 1 million.

 4. Some reasons I can think of:

    - Using a `set` to search all pkgs costs O(nlogn).
    - Time consumption of querying nodes (check whether a package&#39;s dependency graph is in the neo4j). 
    - Time consumption of creating nodes and relationships (Since I don’t seem to use batch insertion).

Can anyone give me some advice to speed up the dependency graph construction? 

Sincere thanks!

  [1]: https://registry.npmjs.org
  [2]: https://neo4j.com/docs/api/python-driver/4.2/#other-information
  [3]: https://i.stack.imgur.com/dVgi3.png
  [4]: https://replicate.npmjs.com/_all_docs",1626775212,https://stackoverflow.com/q/68452972,cpl,"['duplicates', 'dependency-graph', 'neo4j', 'python']"
68451067,Neo4j create node with conditions,"[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/dpA5K.jpg

As you see in image, A is connected to B,C,F,G. When I query A like &quot;Match (n:Label{Name:&#39;Name&#39;})&quot;, it&#39;s returning me B,C,F,G which is right, but I want &quot;B&quot; to be returned only if I query &quot;A&quot;,&quot;D&quot;,&quot;E&quot;, like if the values of A,D,E are true.

Here D, E could be connected to something else, but only when the values of A,D and E are true B should be given. Can I achieve that?",1626765982,https://stackoverflow.com/q/68451067,Gram,"['neo4j', 'nodes', 'knowledge-graph', 'cypher']"
68449341,Neo4j not returning nested records consistently,"[![Example][1]][1]

I have these nested nodes that I wanted to extract out. A one to many to many relationships of nodes. I used the following cypher to do it.

    WITH (o:order)
    WHERE ID(o) = &lt;some id&gt;
    OPTIONAL MATCH (o) -[:ORDER_INCLUDES]-&gt; (p:pizza)
    WITH o, p
    OPTIONAL MATCH (p) -[:WITH_TOPPING]-&gt; (t:topping)
    WITH o, {
      pizza: p,
      toppings: COLLECT(DISTINCT t)
    } AS pi
    RETURN o, COLLECT(DISTINCT pi) AS pizzas

When theres none of the pizza with toppings, I get the result I wanted which is 1 record or order with the pizzas. Note that the toppings are always optional.

    1. Order     [
                   Tomato Pizza,
                   Tomato Pizza
                 ]

However when theres toppings involved, it returns the pizza in separate records

    1. Order     [                  [
                   Tomato Pizza       Pineapple Topping,
                 ]                    Chicken Topping
                                    ]
    2. Order     [
                   Tomato Pizza
                 ]

Which isn&#39;t what I want since the 2 pizzas belong to the same orders. I must be doing something wrong, please help.

Edited:--

Sorry, I missed out a huge detail that causes this problem. I collected the time for when the pizza is created at the beginning.

    WITH (o:order)
    WHERE ID(o) = &lt;some id&gt;
    OPTIONAL MATCH (o) -[:ORDER_INCLUDES]-&gt; (p:pizza)
    OPTIONAL MATCH (e:event) WHERE (e) -[:FOR]-&gt; (o) OR (e) -[:FOR]-&gt; (pizza)
    WITH o, MAX(e.time) AS time, p
    OPTIONAL MATCH (p) -[:WITH_TOPPING]-&gt; (t:topping)
    OPTIONAL MATCH (p) &lt;-[:FOR]- (e:event)
    WITH o, {
      pizza: p,
      time: MAX(e.time),
      toppings: COLLECT(DISTINCT t)
    } AS pi
    RETURN o, time, COLLECT(DISTINCT pi) AS pizzas

That time was the culprit, this problem is resolved when I remove the time.

[1]: https://i.stack.imgur.com/E0426.png",1626752969,https://stackoverflow.com/q/68449341,Ching Yaw Hao,"['neo4j', 'node.js']"
68442753,"Neo4j Cypher , how to query collected neighbours with pagination support on collected neighbours along with node on which group by is perfromed","Neo4j Version: 3.5

For sample graph
```
create (n1:people{id: 1, name: &#39;foo1&#39;, place: &quot;x&quot;}), (n2:people{id: 2, name: &#39;foo2&#39;, place: &quot;x&quot;}), (n3:people{id: 3, name: &#39;foo3&#39;, place: &quot;y&quot;}), (n20:people{id: 20, name: &#39;foo20&#39;, place: &quot;x&quot;});

create (n4:tag{id: 4, key: &quot;a&quot;}),(n5:tag{id: 5, key: &quot;b&quot;}),(n6:tag{id: 6, key: &quot;c&quot;}),(n7:tag{id: 7, key: &quot;d&quot;}),(n8:tag{id: 8, key: &quot;e&quot;}),(n9:tag{id: 9, key: &quot;f&quot;});

create (n10:meta{id: 10, val: 1}),(n11:meta{id: 11, val: 2}),(n12:meta{id: 12, val: 3}),(n13:meta{id: 13, val: 4}),(n14:meta{id: 14, val: 5}),(n15:meta{id: 15, val: 6}),(n16:meta{id: 16, val: 7}),(n17:meta{id: 17, val: 8}),(n18:meta{id: 18, val: 9}),(n19:meta{id: 19, val: 10});

MATCH (a:people{id: 1}),(b:tag{id: 4}) CREATE (a)-[r:people_tag]-&gt;(b);
MATCH (a:people{id: 1}),(b:tag{id: 5}) CREATE (a)-[r:people_tag]-&gt;(b);
MATCH (a:people{id: 2}),(b:tag{id: 6}) CREATE (a)-[r:people_tag]-&gt;(b);
MATCH (a:people{id: 3}),(b:tag{id: 7}) CREATE (a)-[r:people_tag]-&gt;(b);
MATCH (a:people{id: 20}),(b:tag{id: 8}) CREATE (a)-[r:people_tag]-&gt;(b);
MATCH (a:people{id: 20}),(b:tag{id: 9}) CREATE (a)-[r:people_tag]-&gt;(b);

MATCH (a:people{id: 1}),(b:meta{id: 10}) CREATE (a)-[r:people_meta]-&gt;(b);
MATCH (a:people{id: 1}),(b:meta{id: 12}) CREATE (a)-[r:people_meta]-&gt;(b);
MATCH (a:people{id: 1}),(b:meta{id: 13}) CREATE (a)-[r:people_meta]-&gt;(b);
MATCH (a:people{id: 1}),(b:meta{id: 14}) CREATE (a)-[r:people_meta]-&gt;(b);
MATCH (a:people{id: 2}),(b:meta{id: 15}) CREATE (a)-[r:people_meta]-&gt;(b);
MATCH (a:people{id: 2}),(b:meta{id: 16}) CREATE (a)-[r:people_meta]-&gt;(b);
MATCH (a:people{id: 3}),(b:meta{id: 17}) CREATE (a)-[r:people_meta]-&gt;(b);
MATCH (a:people{id: 3}),(b:meta{id: 18}) CREATE (a)-[r:people_meta]-&gt;(b);
MATCH (a:people{id: 4}),(b:meta{id: 19}) CREATE (a)-[r:people_meta]-&gt;(b);
```

A people node can be connected to 0 or more tag/,meta nodes.
There will be no duplicate edges between any two nodes. Tag and Meta nodes can be interconnected with each other.

I want to select a paginated view of the tag and meta groupped by people.
To paginate on neighbors (tag/meta) i change `[x..y]`
To paginate on people I change `SKIP` and `LIMIT`.
the order of the query should be by attribute `id` and will always be unique.

For ex: to query for the first two tags, meta of the first two people, I would be using the below query.

```
MATCH(n:people) WHERE n.place=&quot;x&quot;
OPTIONAL MATCH (n)-[x]-(t:Tag) WITH n,t
ORDER BY t.id
WITH n,collect(distinct (t))[0..2] as ct
OPTIONAL MATCH (n)-[y]-(m:meta) WITH n,m,ct
ORDER BY m.id
WITH n,ct,collect(distinct(m))[0..2] as mt
RETURN n,ct,mt
ORDER BY n.id
SKIP 0
LIMIT 2
```
For ex: to query for the second and third tags, meta of the first two people, I would be using the below query.

```
MATCH(n:people) WHERE n.place=&quot;x&quot;
OPTIONAL MATCH (n)-[x]-(t:Tag) WITH n,t
ORDER BY t.id
WITH n,collect(distinct (t))[1..3] as ct
OPTIONAL MATCH (n)-[y]-(m:meta) WITH n,m,ct
ORDER BY m.id
WITH n,ct,collect(distinct(m))[1..3] as mt
RETURN n,ct,mt
ORDER BY n.id
SKIP 0
LIMIT 2
```
For ex: to query for the second and third tags, meta of the second and third people, I would be using the below query.

```
MATCH(n:people) WHERE n.place=&quot;x&quot;
OPTIONAL MATCH (n)-[x]-(t:Tag) WITH n,t
ORDER BY t.id
WITH n,collect(distinct (t))[1..3] as ct
OPTIONAL MATCH (n)-[y]-(m:meta) WITH n,m,ct
ORDER BY m.id
WITH n,ct,collect(distinct(m))[1..3] as mt
RETURN n,ct,mt
ORDER BY n.id
SKIP 1
LIMIT 2
```
is below query more optiomized than above if i dont care ordering in each page, but the pagination will be correct
```
MATCH(n:people) WHERE n.place=&quot;x&quot;
ORDER BY n.id
SKIP 1
LIMIT 2
OPTIONAL MATCH (n)-[x]-(t:Tag) WITH n,t
WITH n,collect(distinct (t))[1..3] as ct
OPTIONAL MATCH (n)-[y]-(m:meta) WITH n,m,ct
ORDER BY m.id
WITH n,ct,collect(distinct(m))[1..3] as mt
RETURN n,ct,mt

```
**Is there a chance that my pagination is incorrect for either neighbours/people?**

**Is there a way to achieve similar results in a more optimized way apart from using subquery(only available in version &gt; 4.0) or apoc procedures(requires installation of a plugin)?**",1626706999,https://stackoverflow.com/q/68442753,Nischal Kumar,"['neo4j', 'cypher']"
68437769,neo4j 4.x not accesible through Domain via https,"I installed neo4j 4.1.10 in my ec2 instance and I have a DNS name attached to that instance which should be ablre to access the neo4j databse on port 7473 (https). I did configure the neo4j with letsencrypt certificate as mentioned in the [tutorial  here][1]. I did open all the ports for the security group as shown below:
[![ec2 sg][2]][2]

The neo4j.conf, I have modified the article and looks like this:
```
dbms.default_listen_address=0.0.0.0
dbms.default_advertised_address=mydns.org

# Bolt connector
#dbms.connector.bolt.enabled=true
dbms.connector.bolt.tls_level=REQUIRED
dbms.ssl.policy.bolt.private_key=/var/lib/neo4j/certificates/bolt/neo4j.key
dbms.ssl.policy.bolt.public_certificate=/var/lib/neo4j/certificates/bolt/neo4j.cert
dbms.ssl.policy.bolt.client_auth=NONE
#dbms.connector.bolt.listen_address=mydns.org:7687
#dbms.connector.bolt.advertised_address=mydns.org:7687

# HTTP Connector. There can be zero or one HTTP connectors.
#dbms.connector.http.enabled=false
#dbms.connector.http.listen_address=0.0.0.0:7474
#dbms.connector.http.advertised_address=0.0.0.0:7474

# HTTPS Connector. There can be zero or one HTTPS connectors.
dbms.connector.https.enabled=true
dbms.ssl.policy.https.enabled=true
dbms.ssl.policy.https.client_auth=NONE
dbms.ssl.policy.https.private_key=/var/lib/neo4j/certificates/https/neo4j.key
dbms.ssl.policy.https.public_certificate=/var/lib/neo4j/certificates/https/neo4j.cert
#dbms.connector.https.listen_address=mydns.org:7473
#dbms.connector.https.advertised_address=mydns.org:7473

# Directories
dbms.ssl.policy.bolt.base_directory=/var/lib/neo4j/certificates/bolt
dbms.ssl.policy.https.base_directory=/var/lib/neo4j/certificates/https

```

When I restart the neo4j service its erroring out and shows me the following at the logs and I am not able to see the graph database at https://mydns.org:7473.

```
021-07-19 08:36:27.643+0000 INFO  Starting...
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]: 2021-07-19 08:36:29.351+0000 INFO  ======== Neo4j 4.1.10 ========
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]: 2021-07-19 08:36:29.425+0000 ERROR Failed to start Neo4j on dbms.connector.http.listen_address, a socket address. If missing port or hostname it is acquired from dbms.default_listen_address. Error starting Neo4j database server at /var/lib/neo4j/data/databases
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]: java.lang.RuntimeException: Error starting Neo4j database server at /var/lib/neo4j/data/databases
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]:         at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:198)
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]:         at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.build(DatabaseManagementServiceFactory.java:158)
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]:         at org.neo4j.server.CommunityBootstrapper.createNeo(CommunityBootstrapper.java:36)
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]:         at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:117)
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]:         at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:87)
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]:         at org.neo4j.server.CommunityEntryPoint.main(CommunityEntryPoint.java:35)
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]: Caused by: java.lang.NoClassDefFoundError: Could not initialize class org.neo4j.internal.helpers.Exceptions
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]:         at org.neo4j.kernel.lifecycle.LifeSupport.shutdown(LifeSupport.java:188)
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]:         at org.neo4j.kernel.lifecycle.LifeSupport.init(LifeSupport.java:73)
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]:         at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:101)
Jul 19 08:36:29 ip-172-31-25-124 neo4j[30037]:         at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:189)

```
  [1]: https://medium.com/neo4j/getting-certificates-for-neo4j-with-letsencrypt-a8d05c415bbd
  [2]: https://i.stack.imgur.com/xTbTZ.png",1626685197,https://stackoverflow.com/q/68437769,merilstack,"['amazon-web-services', 'ssl', 'java', 'cypher', 'neo4j']"
68436553,Is it OK to have millions of directed relationships between two nodes in Neo4j? Will it add to latency in fetching the data?,"We have millions of users of can make millions of transactions between them.

Lets say there is a user_A who pays money to user_B on the daily basis. We have a relationship SEND_MONEY_TO between A and B nodes.

A ---SENDS_MONEY_TO---&gt; B

What will be the better design to accommodate this data in Neo4j.

**Option A**: We will create a new relationship edge every time a transaction happens.

**Option B**: We will keep a list of transactions as property of a same relationship edge and append the transaction details to existing list whenever a new transaction happens.

Our queries will look like:

a.) Find number of transaction between user_A and user_B in month of April 2021 where HDFC credit card is used.

b.) Find the total amount of transactions which involves user_A

We are open to any new approach as well.",1626679197,https://stackoverflow.com/q/68436553,Shubham Garg,"['graph-databases', 'neo4j']"
68430901,Is it possible to implement schema modeling with Neo4j?,"I understand that Neo4j as a graph database is schema-less, but I&#39;d to ask, is there any option (like using ORM / ODM) / js-driver) or something, which allows me to benefit from the typization of my nodes&#39; data.

I am having a NestJS project (on Typescript) and I&#39;d like to create my database nodes or relations something like:

```ts
myModel.createNode(&#39;Person&#39;, {
 name: &#39;Andy&#39;,
 title: &#39;Developer&#39;
})
```

instead of executing pure cypher queries like:
```cypher
CREATE (n:Person {name: &#39;Andy&#39;, title: &#39;Developer&#39;})
```",1626624588,https://stackoverflow.com/q/68430901,AlexZeDim,"['typescript', 'javascript', 'neo4j', 'graph-databases']"
68427470,py2neo (Neo4j) bulk operation,"I have created a nice graph using Neo4j Desktop, using a local CSV file that I added to the project. now I&#39;m trying to use python to do that automatically for that I&#39;m trying to use methods from here https://py2neo.org/2021.1/bulk/index.html like create/merge nodes/relatioships.
I have 2 questions,
1) Do I need to use create method (create node for exmaple) and after that to use merge method (merge nodes for this example) or can use merge nodes from the begining?
I have tried to use merge only and I got some wierd things when I&#39;m using large sample size.

2)After creation of nodes and relationships how can I change the visualization of the nodes (put some value in the node)?

*If there is an other way to use python to create graph from a big CSV file I would like to hear, Thanks!",1626598047,https://stackoverflow.com/q/68427470,Avishay Shapira,"['knowledge-graph', 'py2neo', 'neo4j']"
68422161,Neo4J Plug In Won&#39;t Compile Due to Version Mismatch,"I have seen variants of this question asked, but I have not seen an answer that was accepted.  I am using IntelliJ IDEA to simply compile the TraversDemo sample plug in that Neo4J posted on GitHub.  When I run mvn clean package I get no errors.  But when I actually tried putting the .jar file into my plug ins folder on Neo4J Desktop . . . neo4j didn&#39;t recognize the plug in.  So, I assumed something was wrong with my .jar file and I just tried to &#39;build&#39; the java file in IntelliJ.  When I did, I get this error: 

Module &#39;TraversalPlugIn&#39; production: java.lang.UnsupportedClassVersionError: org/neo4j/annotations/api/PublicApiAnnotationProcessor has been compiled by a more recent version of the Java Runtime (class file version 55.0), this version of the Java Runtime only recognizes class file versions up to 54.0

I have checked and rechecked my Java (for Windows 10) is Java 8.  I checked the Java Configuration GUI and asked for updates.  It said I had the most recent version.  Does anyone have any idea how to solve this?  I already tried screwing around with various options in Build,Execution,Deployment Java compiler. No combination seemed to work. ",1626537715,https://stackoverflow.com/q/68422161,Rasputin,"['neo4j', 'intellij-idea', 'runtime']"
68418818,jqassistant-maven-plugin: cannot connect browser to embedded Neo4j,"Note: There are already similar questions, but the solutions do not work for the jqassistant-maven-plugin.

I am facing an issue on a new client site, where I would like to view the Neo4j contents which have been scanned by JQAssistant, by using the jqassistant-maven-plugin (1.10.0).

Running `mvn jqassistant:scan jqassistant:analyze jqassistant:server` will spin up and embedded Neo4j, scan the contents of my Maven project, and keep the embedded instance open so I can access it via http://localhost:7474/

When trying to login in the browser (using the bolt protocol) I am facing a connection issue.

    ServiceUnavailable: WebSocket connection failure. Due to security constraints in your web browser, the reason for the failure is not available to this Neo4j Driver. 
    Please use your browsers development console to determine the root cause of the failure. 
    Common reasons include the database being unavailable, using the wrong connection URL or temporary network problems. If you have enabled encryption, ensure your browser is configured to trust the certificate Neo4j is configured to use. 
    WebSocket `readyState` is: 3

I&#39;ve never seen anything like this before with this tool. The only ressource I&#39;ve found was [this documentation][1] saying that the listenAddress should be changed.

Basically JQAssistant is configured as always, with the exception of the `embeddedListenAddress`:

```
&lt;plugin&gt;
  &lt;groupId&gt;com.buschmais.jqassistant&lt;/groupId&gt;
  &lt;artifactId&gt;jqassistant-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;${jqassistant.version}&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;default-cli&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;scan&lt;/goal&gt;
        &lt;goal&gt;analyze&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;warnOnSeverity&gt;INFO&lt;/warnOnSeverity&gt;
        &lt;failOnSeverity&gt;MAJOR&lt;/failOnSeverity&gt;
        &lt;embeddedListenAddress&gt;0.0.0.0&lt;/embeddedListenAddress&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;
```

Does anyone had a similar experience? It seems to me that some corporate setting in the browsers (all which are available) are blocking websockets. Is there a way around this. My only workaround in the moment is using an dedicated Neo4j instance, which complicates the dev-setup and I would like to avoid this.

Further analysis:

Checking the browser-port, shows that it is listening

    netstat -a | findstr 7474
      TCP    0.0.0.0:7474    
      TCP    [::]:7474

The bolt-port on the other hand is not available

    netstat -a | findstr 7687

  [1]: https://neo4j.com/developer/kb/explanation-of-error-websocket-connection-failure/#:~:text=WebSocket%20connection%20failure.%20Due%20to%20security%20constraints%20in,the%20wrong%20connection%20URL%20or%20temporary%20network%20problems.",1626510900,https://stackoverflow.com/q/68418818,lostiniceland,"['neo4j', 'jqassistant']"
68414313,Trying to create a new node that must have all nodes with their labels and properties,"![enter image description here][1]



```
MATCH (el)&lt;-[]-(t:ns1__Terminal)-[]-&gt;(cn:ns1__ConnectivityNode)
MERGE (e:pp__Element{label:el1})
RETURN e1
```

&gt; &quot;Property values can only be of primitive types or arrays thereof&quot;


  [1]: https://i.stack.imgur.com/WeWyb.png",1626463283,https://stackoverflow.com/q/68414313,Adam,"['cypher', 'neo4j']"
68410594,Cannot configure neo4j on ec2 with classic load baancer,"I am trying to configure Neo4j on an Ec2 server. I did open the ports in the /etc/neo4j/neo4j.conf file which are as follows
```
# Bolt connector
dbms.connector.bolt.enabled=true
#dbms.connector.bolt.tls_level=DISABLED
dbms.connector.bolt.listen_address=0.0.0.0:7687
#dbms.connector.bolt.advertised_address=:7687

# HTTP Connector. There can be zero or one HTTP connectors.
dbms.connector.http.enabled=true
dbms.connector.http.listen_address=0.0.0.0:7474
#dbms.connector.http.advertised_address=:7474

# HTTPS Connector. There can be zero or one HTTPS connectors.
dbms.connector.https.enabled=false
dbms.connector.https.listen_address=0.0.0.0:7473
#dbms.connector.https.advertised_address=:7473

```
My EC2 open ports are as follows:
[![EC2 open ports][1]][1]

I can only access the neo4j by going to &lt;my server IP&gt;:7474, even when I enable 7473 port at the neo4j.conf file, I cannot access it over https by going to https://&lt;/*my server IP*/&gt;: 7473. May I please know what am I doing wrong?

I also created a classic load balancer and added the EC2 instance in which the neo4j is configured and added the following listeners to the ELB.
 [![ELB listeners][2]][2]

I cannot even access the neo4j server using the load balancer DNS name or &lt;/*load balancer DNS name*/&gt;:74774 and it shows me `refused to connect` error. Any help?

  [1]: https://i.stack.imgur.com/2i2Z1.png
  [2]: https://i.stack.imgur.com/Bl5A3.png",1626444987,https://stackoverflow.com/q/68410594,merilstack,"['amazon-elb', 'neo4j', 'amazon-ec2', 'amazon-web-services']"
68404649,(Neo4j 3.5) Executing query with two parts and the second one consists on a group of matches where at least one needs to be fulfilled,"we are trying to run a cypher query but we are not able to get the results we want. 

It is important to note that we cannot make this work with subqueries because we are using Neo4j 3.5 and in this version, they are still not available.

The problem is that we have two parts for a query, the first one will fix the variables for the second part, and the second part consists of multiple matches, and it has to get the results of the previous query and if at least one of the matches return a result for a row, this row is not filtered out, else if none return result it is discarded.

More specifically, the query we are trying to run is similar to the following one:

```
//First part of the query where we want to fix variables with the match and where
MATCH (u:User)-[:ASSIGNED_TO]-&gt;(t:Task)-[:PENDING]-&gt;(ob:Object)&lt;-[:HAS_OPEN_OBJECT]-(do:DataObject)&lt;-[:ASOCIATED]-(:Module)-[:CAN_LIST]-&gt;(view:WidgetObject)
                        WHERE u.uid = &#39;user_uid&#39; 
                        AND view.uid = &#39;view_uid&#39; 
                        AND view.object_name = do.object_type
                        with do, t, ob

// In this second part of the query we want to maintain the variables of the previous part and if at least one matches the value should be returned
// we have tried with UNION but we will need pagination, but even with union it&#39;s not working 
MATCH (ac:Action)&lt;-[:ASOCIATED]-(t)-[rel:COMPLETED|PENDING]-&gt;(ob)&lt;-[:HAS_OPEN_OBJECT|HAS_CLOSED_OBJECT]-(do)
                WHERE ac.name CONTAINS &#39;body&#39;
                WITH COLLECT({data_object_uid: do.uid}) as act_filter
MATCH (c:Comment)&lt;-[:COMMENTED]-(t)-[rel:COMPLETED|PENDING]-&gt;(ob)&lt;-[:HAS_OPEN_OBJECT|HAS_CLOSED_OBJECT]-(do)
                WHERE c.body CONTAINS &#39;body&#39;
                WITH act_filter  + COLLECT({data_object_uid: do.uid}) as comment_filter
MATCH (at:Attachment)&lt;-[:HAS_ATTACHMENT]-(t)-[rel:COMPLETED|PENDING]-&gt;(ob)&lt;-[:HAS_OPEN_OBJECT|HAS_CLOSED_OBJECT]-(do)
                WHERE at.name CONTAINS &#39;body&#39;
                WITH comment_filter + COLLECT({data_object_uid: do.uid}) as attachment_filter
                UNWIND attachment_filter as row
                return row.data_object_uid
```                
                
We are not sure if in the second part, the second and third matches are maintaining the same subset of results coming from the first part of the query. 

A funny behavior we have found is that if we remove the last match we are getting results but if we add it, we are not getting any results. We do not understand this behavior because if the second match is returning results and they are stored in a variable after a collect, appending this to the next collected results should return something. 

For example, if the second match returns as comment_filter `[{data_object_uid: &quot;343dienmd3-dasd&quot;}]` and the third match is not returning anything, after the concatenation in the `WITH` clause it should return the same thing, but the result is empty.

We need some light here, we don&#39;t know if we are close and we are making a stupid mistake or we are getting all wrong and we need to change the approach completely.",1626418246,https://stackoverflow.com/q/68404649,ainsausti,"['cypher', 'neo4j']"
68404421,Less than operator issue in neo4j,"`&gt;,=` is working but less than operator is not working in cypher neo4j.

What may be the reason ?
",1626417061,https://stackoverflow.com/q/68404421,nik12,"['neo4j', 'cypher-shell', 'c#']"
68398031,R code using GraphQL does not print nested data,"I am creating a Shiny application using neo4j-graphql-js and an Apollo server. I can access the GraphQL API playground and my query will work there but is not translating to my application currently. Since I am using a template, I can&#39;t find the documentation of the code to fix it. 

The code and query in question is this: 

    execute_query = function(query) {
        result &lt;- conn$exec(Query$new()$query(&#39;link&#39;, query)$link)
        flat_result &lt;- result %&gt;% fromJSON(flatten = F)
        print(flat_result)
        result.df &lt;- as.data.frame(flat_result[[1]])
        print(result.df)
        output$table &lt;- DT::renderDataTable({result.df}, rownames = TRUE, filter = &#39;top&#39;, selection = &#39;multiple&#39;, extensions = &#39;Buttons&#39;)
    }
    
    # Run a query
    execute_query(&#39;

    query SampleQuery {
    Skill{
        name
        projects_in_need_of{
        name
        }
      }
    }
    &#39;)

When my application run, it will print out skill.name in one column and then skill.projects_in_need_of in the other, when it should be returning a Project. It is returning [object Object] instead of the project node. 

projects_in_need_of is a relationship, it looks like this in the schema:

   

     type Skill {
       _id: Long!
       name: String!
       projects_in_need_of: [Project] @relation(name: &quot;IN_NEED_OF&quot;, direction: IN)
      
    }

I believe my program is messing up when the data table is created because printing the flat_result and result.df gives the correct information.",1626368692,https://stackoverflow.com/q/68398031,Savanah Marisa Barnes,"['graphql', 'shiny', 'neo4j-graphql-js', 'neo4j', 'r']"
68392592,Can we match subgraphs in cypher?,"I know that in cypher it is possible to match paths like this :

```
MATCH p=(n)-[r]-(m)
RETURN p
```

But is there a way to do something similar but for subgraphs, i.e groups of nodes and relationships which are not expressible in the form of a path ?

I have something like this in my mind :

```
MATCH subgraph=[(n)-[r]-(m)-[s]-(p), (m)-[j]-(u)]
RETURN subgraph
```




",1626346809,https://stackoverflow.com/q/68392592,Alexis Pister,"['cypher', 'neo4j']"
68391201,How to render neo4j collection with pug using nodejs and express,"I&#39;m using neo4j 4.3.2 community edition on top of Ubuntu 20.04.2

I need to display the result of a neo4j cypher query using pug in a nodejs/express application.

Using the neo4j sample, it&#39;s easy to have a raw list of the result using the following code:

```
router.get(&#39;/&#39;, (req, res, next) =&gt; {
    const skip = int( parseInt(req.query.offset) || 0 )
    const limit = int( parseInt(req.query.limit) || 25 )

    const params = {
        skip, limit
    }

    return req.neo4j.read(`
        MATCH (regions:Region) 
        return regions 
        SKIP $skip LIMIT $limit
    `, params)
        .then(res =&gt; {
         const regions = res.records.map(row =&gt; {
                return new Region(
                    row.get(&#39;regions&#39;)
                )
            })
            return {
                regions: regions.map(n =&gt; n.toJson()),
            }
       })

//        .then(res.render(&#39;region/regions&#39;, { &quot;regions&quot;: res }))
        .then(json =&gt; res.send(json))
        .catch(e =&gt; next(e))

})
```
The result is straightforward:
```
{&quot;regions&quot;:[{&quot;name&quot;:&quot;Lazio&quot;,&quot;uuid&quot;:&quot;ca1c1021-92f4-412b-aa3d-6c997cba248e&quot;},{&quot;name&quot;:&quot;Umbria&quot;,&quot;uuid&quot;:&quot;4fd434a4-1eb7-4177-9a0d-d1f5aa5efdaf&quot;},
....
{&quot;name&quot;:&quot;Liguria&quot;,&quot;uuid&quot;:&quot;7612bf03-a5aa-4bda-b823-9fe361c63667&quot;}]}
```

Now, I want to show the same results using the following `.pug` template:

```
extends ../layout

block content
  h1 Listing regions 
  table
    thead
      tr
        th uuid
        th Name

    tbody
      each region in regions
        tr
          td= region.name
          td= region.uuid
```

so, in my route file, I changed the row 
```
        .then(json =&gt; res.send(json))
```
with the row 
```
        .then(res.render(&#39;region/regions&#39;, { &quot;regions&quot;: res }))
```

which results in the following error:
```
TypeError: /node/kebranode/src/views/region/regions.pug:15
    13| 
    14|     tbody
  &gt; 15|       each region in regions
    16|         tr
    17|           td= region.name
    18|           td= region.uuid

Cannot read property &#39;length&#39; of undefined
```
Any idea of how to get rid of it?

",1626341071,https://stackoverflow.com/q/68391201,Paolo Di Pietro,"['node.js', 'neo4j', 'pug', 'express', 'cypher']"
68378356,How do I return properties of Relation structuredNode in Neomodel?,"I have 2 StructuredNode class:
```
class Job(StructuredNode):
    uid = UniqueIdProperty()
    options = JSONProperty()
    pipeline = RelationshipTo(
        &quot;Pipeline&quot;,
        &quot;RUN_PIPELINE&quot;,
        cardinality=cardinality.One
    )

class Pipeline(StructuredNode):
    uid = UniqueIdProperty()
    name = StringProperty(unique_index=True)
    jobs = RelationshipFrom(
        &quot;Job&quot;,
        &quot;RUN_PIPELINE&quot;,
        cardinality=cardinality.ZeroOrMore
    )
```

When I query in python using the query below:
```
MATCH (job:`Job`)-[:`RUN_PIPELINE`]-&gt;(pipeline:`Pipeline`)
WITH count(DISTINCT job) AS total, job
SKIP 0 LIMIT 20
 RETURN total, job
```

I&#39;m able to retrieve the data from the job, but I gets empty for pipeline, How am I suppose to retrieve the Pipeline data as well?

```
        for row in results:
            total, instance_data = row
            instance = self.model.inflate(instance_data)
            instances.append(instance)
            total = int(total)
```",1626266690,https://stackoverflow.com/q/68378356,xion,"['python', 'neomodel', 'neo4j', 'cypher']"
68377355,Neo4j loading CSV with missing cells,"[![enter image description here][1]][1]
Can someone please provide me cypher query for the above cell. It&#39;s a representation of the data I have. Here questions are nodes and Answers are properties and recommendation is also a node. The problem I am facing is, there could be possibilities of Question2 or 3 missing along with it&#39;s answer. Like question 2 and 3 are follow up of previous question, like question 3 is based on the response to the Question 2. When I load it, there are so many missing Nan, so I had to use &quot;COALESCE&quot; to read the line, but the nodes are breaking, like question1 should be connected to question 2 and question 2 should be connected to question 3 and then the recommendations. If there are no question 2 or 3, question1 should be directly connected to recommendation.

Because there are multiple responses for a question, nodes are created with Question as &quot;NA&quot;(because i have used COALESCE).

Thanks in advance

  [1]: https://i.stack.imgur.com/IBVqn.png",1626262725,https://stackoverflow.com/q/68377355,Gram,"['cypher', 'knowledge-graph', 'graph-databases', 'neo4j']"
68373666,Nodes without names in Neo4j,"[![enter image description here][1]][1]

I have data like the above(toy example, let&#39;s take the top 3 lines.), for one question there could be multiple answers in the *.CSV file. Because I have the question in only one cell, the remaining cells are created as nodes without names. Is there a way to solve this?

I am expecting something like 1 node with Name as &quot;How are you&quot; and it&#39;s connecting nodes will be &quot;Great&quot;, &quot;Normal Day&quot;, &quot;Bad&quot; and for each of these will have relationship to the response column from csv.
Thanks in advance.


  [1]: https://i.stack.imgur.com/ideCd.png",1626247075,https://stackoverflow.com/q/68373666,Gram,"['neo4j', 'cypher', 'knowledge-graph', 'graph-databases']"
68367909,How to query a Neo4j relationship in R?,"I have a Project node connected to a Skill node by a relationship &quot;IN_NEED_OF&quot;. I am using an R-Shiny app with the Neo4j GraphQL library to pull the data I need. Currently, this code works:

    execute_query = function(query) {
        result &lt;- conn$exec(Query$new()$query(&#39;link&#39;, query)$link)
        flat_result &lt;- result %&gt;% fromJSON(flatten = F)
        # print(flat_result)
        result.df &lt;- as.data.frame(flat_result[[1]])
        # print(result.df)
        output$table &lt;- DT::renderDataTable({result.df}, rownames = TRUE, filter = &#39;top&#39;, selection = &#39;single&#39;, extensions = &#39;Buttons&#39;)
    }
    
    # Run a query
    execute_query(&#39;
    query SampleQuery {
    Project{
        name
        description
    }
    }
    &#39;)
    
However, I need the skills that are connected by &quot;IN_NEED_OF&quot;. I have tried these blocks and have received errors for each one:

    # Run a query
    execute_query(&#39;
    query SampleQuery {
    Project{
        name
        description
        challenges: [Skill]
        @cypher(
            statement: &quot;&quot;&quot;
            MATCH (p:Project)-[:IN_NEED_OF]-&gt;(s:Skill)
            RETURN s
            &quot;&quot;&quot;
    }
    }
    &#39;)

This fails because the challenges piece shouldn&#39;t be in the actual query but it the schema.

    execute_query(&#39;
    type Project{
        name: String!
        description: String!
        challenges(limit: Int = 10): [Skill]
        @relationship(type: &quot;IN_NEED_OF&quot;, direction: OUT)
    }
    type Skill{
        name
    }
    query SampleQuery {
    Project{
        name
        description
        challenges{
            name
        }
    
    }
    }
    &#39;)

This fails because 

    Error : 2.5-7.5: schema support disabled


I have tried several variations of these two code blocks but I can&#39;t figure out if my problem is in R, the execute_query and function, or in the way I am using GraphQL. 

(The server is an Apollo with a GraphQL API from the Neo4j GraphQL library.)",1626202078,https://stackoverflow.com/q/68367909,Savanah Marisa Barnes,"['graphql', 'apollo', 'neo4j', 'r']"
68363578,Neo4j foreach clause to loop through elements of string array,"I have some nodes which contain a string field. This string field is a list of pks each of which represents the pk of another node. I want to loop through this string list and convert all the pks to their respective name. For example:

```
MATCH (r:Recipe) RETURN r.ingredients_list AS ingredients_list LIMIT 1;
```

Might return this:

| ingredients_list |
| ---------------- |
| &quot;Ingredients: 8572629, 1049724, 0494828, 0598371, 6168492, 0986423&quot; |

And I want to convert it to this:

| ingredients_list |
| ---------------- |
| &quot;Ingredients: flour, milk, eggs, butter, baking soda, sugar&quot; |


I have so far managed to get the string list and split it into an array:

```
WITH &quot;Ingredients: &quot; AS s MATCH (r:Recipes) WHERE r.ingredients_list ~= &quot;Ingredients: .*&quot;
WITH SPLIT(SUBSTRING(r.ingredients_list, SIZE(s), SIZE(r.ingredients_list)), &quot;,&quot;)
AS string_arrays RETURN string_arrays;
```

| string_arrays |
| ------------- |
| [&quot;8572629&quot;, &quot;1049724&quot;, &quot;0494828&quot;, &quot;0598371&quot;, &quot;6168492&quot;, &quot;0986423&quot;] |


And I can individually match each pk to its corresponding ingredient node and extract the name:

```
MATCH (g:Ingredient) WHERE g.pk = &quot;0494828&quot; RETURN g.name;
```

But I am stumped as to how I can loop through these string arrays. I believe I want something like the ```reduce``` function to loop through the each subarray, query the :Ingredient nodes to find the correct name, and then do a string join to put everything into a string again. But the accumulator only seems to operate on nodes. The same goes for Neo&#39;s ```FOREACH```.

Is there a function which loops through elements of a string array? Or some other neo function to perform an operation on all the elements of an array of strings rather than an array of nodes?",1626183692,https://stackoverflow.com/q/68363578,asdf,"['string', 'arrays', 'loops', 'cypher', 'neo4j']"
68362728,NEO4J How to make graph with relationships,"I am completely new to NEO4j and using it for the first time ever now for my masters program. Ive read the documentation and watched tutorials online but can’t seem to figure out how I can represent my nodes in the way I want. 

I have a dataframe with 3 columns, the first represents a page name, the second also represents a page name, and the third represents a similarity score between those two pages. How can I create a graph in NEO4J where the nodes are my unique page names and the relationships between nodes are drawn if there is a similarity score between them (so if the sim-score is 0 they don’t draw a relationship)? I want to show the similarity score as the text of the relationship.

Furthermore, I want to know if there is an easy way to figure out which node had the most relationships to other nodes?

I’ve added a screenshot of the header of my DF for clarity https://imgur.com/a/pg0knh6. I hope anyone can help me, thanks in advance!

Edit: What I have tried

    LOAD CSV WITH HEADERS FROM &#39;file:///wiki-small.csv&#39; AS line
    MERGE (p:Page {name: line.First})
    MERGE (p2:Page {name: line.Second})
    
    MERGE (p)-[r:SIMILAR]-&gt;(p2)
    ON CREATE SET r.similarity = toFloat(line.Sim)

Next block to remove the similarities relationships which are 0

    MATCH ()-[r:SIMILAR]-&gt;() WHERE r.Sim=0 
    DELETE r

This works partially. As in it gives me the correct structure of the nodes but doesn&#39;t give me the similarity scores as relationship labels. I also still need to figure out how I can find the node with the most connections.",1626180525,https://stackoverflow.com/q/68362728,Ghislaine Boogerd,['neo4j']
68343954,jQAssistant: How does the store reset work?,"I want to use jQAssistant for our team. I installed it according to https://101.jqassistant.org/setting-up-a-team-server/index.html , so I have an external Neo4j store that is running independently of jQAssistant.

I would like to scan our software during the nightly build and to have the most recent information. So my idea was to use a reset before the nightly build:

    &lt;!-- Use this profile to reset the jQAssistant store (database) --&gt;
    &lt;profile&gt;
      &lt;id&gt;jqassistant-reset&lt;/id&gt;
      &lt;build&gt;
        &lt;plugins&gt;
          &lt;plugin&gt;
            &lt;groupId&gt;com.buschmais.jqassistant&lt;/groupId&gt;
            &lt;artifactId&gt;jqassistant-maven-plugin&lt;/artifactId&gt;
            &lt;executions&gt;
              &lt;execution&gt;
                &lt;id&gt;reset-store&lt;/id&gt;
                &lt;phase&gt;clean&lt;/phase&gt;
                &lt;goals&gt;
                  &lt;goal&gt;reset&lt;/goal&gt;
                &lt;/goals&gt;
              &lt;/execution&gt;
            &lt;/executions&gt;
          &lt;/plugin&gt;
        &lt;/plugins&gt;
      &lt;/build&gt;
    &lt;/profile&gt;

And then I would go through every Maven module and scan it:

      &lt;pluginManagement&gt;
        &lt;plugin&gt;
          &lt;groupId&gt;com.buschmais.jqassistant&lt;/groupId&gt;
          &lt;artifactId&gt;jqassistant-maven-plugin&lt;/artifactId&gt;
          &lt;version&gt;1.9.1&lt;/version&gt;
          &lt;configuration&gt;
            &lt;store&gt;
              &lt;uri&gt;bolt://my-neo4j-store.com:7687&lt;/uri&gt;
              &lt;username&gt;neo4j&lt;/username&gt;
              &lt;password&gt;reallysecret&lt;/password&gt;
              &lt;encryption&gt;false&lt;/encryption&gt;
            &lt;/store&gt;
            &lt;configuration&gt;
              &lt;resetStore&gt;false&lt;/resetStore&gt;
            &lt;/configuration&gt;
            &lt;continueOnError&gt;true&lt;/continueOnError&gt;
          &lt;/configuration&gt;
        &lt;/plugin&gt;
      &lt;/pluginManagement&gt;

    ...


    &lt;!-- Use this profile to gather information using jQAssistant --&gt;
    &lt;profile&gt;
      &lt;id&gt;jqassistant&lt;/id&gt;
      &lt;build&gt;
        &lt;plugins&gt;
          &lt;plugin&gt;
            &lt;groupId&gt;com.buschmais.jqassistant&lt;/groupId&gt;
            &lt;artifactId&gt;jqassistant-maven-plugin&lt;/artifactId&gt;
            &lt;executions&gt;
              &lt;execution&gt;
                &lt;id&gt;scan-software&lt;/id&gt;
                &lt;phase&gt;package&lt;/phase&gt;
                &lt;goals&gt;
                  &lt;goal&gt;scan&lt;/goal&gt;
                &lt;/goals&gt;
              &lt;/execution&gt;
            &lt;/executions&gt;
          &lt;/plugin&gt;
        &lt;/plugins&gt;
      &lt;/build&gt;
    &lt;/profile&gt;

However, I see confusing log messages:

    [INFO] --- jqassistant-maven-plugin:1.9.1:scan (scan-software) @ foobar ---
    [INFO] Scanning for jQAssistant plugins...
    [INFO] [Asciidoc Report, CDI, Common, Core Analysis, Core Report, EJB3, GraphML, GraphQL, JAX-RS, JPA 2, JSON, JUnit, Java, Java EE 6, Maven 2 Repository, Maven 3, OSGi, RDBMS, Spring, TestNG, Tycho, XML, YAML].
    [INFO] Connecting to store at &#39;bolt://my-neo4j-store.com:7687&#39; (username=neo4j)
    Jul 12, 2021 9:46:59 AM org.neo4j.driver.internal.logging.JULogger info
    INFORMATION: Direct driver instance 839477204 created for server address my-neo4j-store.com:7687
    [INFO] Resetting store.
    [INFO] Reset finished (removed 0 nodes, 0 relations).
    [INFO] Entering /foobar/target/classes
    [INFO] Leaving /foobar/target/classes (70 entries, 307558 ms)
    [INFO] Entering /foobar/target/test-classes
    [INFO] Leaving /foobar/target/test-classes (70 entries, 1422 ms)
    [INFO] Entering /foobar/target/surefire-reports
    [INFO] Leaving /foobar/target/surefire-reports (46 entries, 1127 ms)

I don&#39;t understand why I&#39;m seeing `Resetting store.` although I have switched this off in the configuration.

However, what&#39;s more confusing for me is that when starting the Maven build again, I see this:

    [INFO] Resetting store.
    [INFO] Reset finished (removed 0 nodes, 0 relations).

I just filled the store with the first build, and now in the second build, the plugin tells me that it resetted the store, but didn&#39;t remove any nodes or relations.

Could someone please explain how I could achieve what I&#39;m trying to do?",1626077222,https://stackoverflow.com/q/68343954,eerriicc,"['jqassistant', 'neo4j']"
68321879,How to Create and Use New Database for Neo4j Unit Test?,"For my Django REST project, I need to perform unit test on my neo4j database to ensure the data outputted is in the correct format. However, I must perform these unit test on a testing database that is different than the actual database. Currently the settings.py is arranged in such a way that the views.py will access the default database. How can I have the Unit test access the test database instead without changing the settings.py?",1625858838,https://stackoverflow.com/q/68321879,AARON SHAH,"['neo4j', 'django', 'python', 'cypher']"
68321790,Graph Data Science Error (APOC Metadata Procedure Unavailable),"I have imported my data into my dbms and installed the plugins APOC (4.2.0.0) and the Graf Data Science Library (1.4.1).

When I open the playground i get the following error:

[error-msg][1]


  [1]: https://i.stack.imgur.com/8YlKs.png

I added following lines into my neo4j config,

    dbms.security.procedures.unrestricted=jwt.security.*,apoc.*,gds.*
    dbms.security.procedures.allowlist=jwt.security.*,apoc.*,gds.*
but still getting the same error.

I have done a little research and found someone with the same error and he said:

&quot;It turned out to be a problem with the schema - I had a node with a label that had a space in it &quot;

Is that really an option it is not working for me?

I did my import with neo4j-admin like this:

    bin/neo4j-admin import --database=neo4j --id-type=INTEGER --multiline-fields=true --skip-duplicate-nodes --skip-bad-relationships=true --nodes=commits=import/nodes-commits.csv --nodes=packages=import/nodes-packages.csv --nodes=users=import/nodes-users.csv --relationships=commits=import/relationship-projects_commits.csv

with some further relationships.

I also tried then newest version of the dbms, apoc and GDS, but the same error came up.

Anybody have any idea if it can be the import or is it some other error.

Thanks a lot",1625858294,https://stackoverflow.com/q/68321790,inputslider,"['neo4j-apoc', 'neo4j', 'graph-data-science']"
68306891,"Building a product recommendation system, collaborative filtering and graph database","When I&#39;m reading about building recommendation systems with collaborative filtering and they generally don&#39;t talk about graph databases like neo4j. Are graph databases enough to implement the best recommendation systems?

It seems like they can implement realtime recommendations easier than the methods mentioned here: https://eugeneyan.com/writing/real-time-recommendations/

Any weaknesses I should be aware of or is something like neo4j perfectly suited to the task and nothing else is required?

",1625768520,https://stackoverflow.com/q/68306891,Harry,"['neo4j', 'recommendation-engine', 'graph-databases']"
68306241,neo4j combine multiple relationship and create a new one on the fly,"I am new to the neo4j world. I have a situation where i  have multiple relationship b/w nodes, these relationship has properties. Now i need to combine these relationship into 1 relationship and sum up there property.

For example NodeA----&gt;NodeB with R1(count=2),R2 (count=4),R2 (count=1),R4(count=10)

now i need to combine these into one relationship say newR
NodeA---&gt;NodeB with newR(count=17).

Would prefer if this is created as a temp relationship, so that its not persisted inthe databse.",1625765378,https://stackoverflow.com/q/68306241,Abhishek Maheshwari,['neo4j']
68306036,Cypher query to find users who are connected to at least two other user in given list,"I&#39;m an ultimate neo4j beginner. I have a cypher query similar to

    WITH [&quot;123&quot;, &quot;456&quot;, &quot;789&quot;] as ids
    MATCH (p:user)-[:follower]-&gt;(m:user)
    WHERE m.id in ids
    WITH p, 2 as inputCnt, count(DISTINCT p) as cnt
    WHERE cnt = inputCnt
    RETURN p

123, 456 and 789 are user ids. List length is dynamic, can be larger than 3.

What I&#39;m trying to find is 123, 456, 789, plus other nodes which are following at least 2 users in given list. If a node is following only 1 user, it&#39;s not needed.

I got the main idea from [here][1] but apparently the problem there is different so my query doesn&#39;t return any results. I&#39;m sure there&#39;s exactly 1 node in my graph which satisfies my condition, so I should see a result with 4 nodes.

Let me give some examples to clarify:

&gt; When there are no users following at least 2 of them return:

[![nn][2]][2]

When there are no users following at least 2 of them, but they are following among themselves, return:

[![enter image description here][3]][3]

&gt; When there&#39;s a single user, say (000), following 123 and 456 return:

[![enter image description here][4]][4]

&gt; When there are two users, say 000 and XXX, one following all 3 of
&gt; them, one following 2 of them, return:

[![enter image description here][5]][5]


  [1]: https://neo4j.com/developer/kb/performing-match-intersection/
  [2]: https://i.stack.imgur.com/lsO1n.png
  [3]: https://i.stack.imgur.com/O2gn9.png
  [4]: https://i.stack.imgur.com/kBnE9.png
  [5]: https://i.stack.imgur.com/HEufy.png",1625764359,https://stackoverflow.com/q/68306036,uylmz,"['cypher', 'neo4j']"
68299291,How to delete a relationship of a neo4j node in spring data,"I have User nodes and having contact relationships with each other. user1 has two contacts user2 and user3. Now I want to delete user2 from contacts. Following is a code snippet about contact relationships.

```
@Node
public class User{
...Id and different properties
@Relationship(type = &quot;CONTACT&quot;)
public Set&lt;User&gt; contacts = new HashSet&lt;&gt;();
}
```
Now when I delete a relationship and save back the node it shows the following message:
&gt;WARN 38461 --- [nio-8080-exec-2] o.s.d.n.c.m.DefaultNeo4jIsNewStrategy    : Instances of class com.talkkia.api.entity.User with an assigned id will always be treated as new without version property!

Code for deleting relationship is here:
```
@Transactional
@Override
 public String deleteContact(String mobile1, String mobile2) {
        Optional&lt;User&gt; user1 = userRepository.findOneByMobile(mobile1);
        Optional&lt;User&gt; user2 = userRepository.findOneByMobile(mobile2);
        if(user1.get().getContacts().contains(user2.get())){
            user1.get().getContacts().remove(user2.get());
            System.out.println(user1.get().getContacts());
            userRepository.save(user1.get());
            return user2.get().getName() + &quot; has been deleted from your contact.&quot;;
        }
        
        return user2.get().getName() + &quot; can&#39;t be deleted from contact.&quot;;
    }
```",1625737796,https://stackoverflow.com/q/68299291,Noor Khan,"['spring-data', 'spring-boot', 'spring-data-neo4j', 'neo4j', 'spring']"
68294615,How to calculate the price of Neo4j enterprise if i get data from S3,I need to estimate the price of enterprise Neo4j if get data from S3 (100GB) but i don&#39;t find any document to reference. Is there anyone know this?,1625708577,https://stackoverflow.com/q/68294615,Tien Vu,['neo4j']
68282079,How to read a simple graphml file in Neo4J,"I am using Neo4J desktop and its really hard to find any proper documentation. I have a simple graphml that I would to read into Neo4J. Does someone know a simple step-by-step guide for this?

I cant even run commands in the browser, because it wants me to connect to a database - I just want to read from a simple file?",1625644435,https://stackoverflow.com/q/68282079,smallbirds,['neo4j']
68281830,An unusual cypher query challenge: finding intersections with nodes grouped by label,"I am trying to find a general(ist) cypher query, without having to specify labels, that would achieve the following use case.

- A user can be linked to nodes, which represents user profile or activity. For example `(User)-&gt;[:HAS_CLICKED]-&gt;(Document)`, or `(User)-[:LIVES_IN]-&gt;(Country)`
- An advert can be linked to one or more of those nodes `Document-[:x]-&gt;Advert`

The catch is trying to find an efficient query verifying the following: **a user  must be related to at least one node of the same Label as the advert to see it**. The general schema would look like this:

[![enter image description here][1]][1]


[![enter image description here][2]][2]


[![enter image description here][2]][2]

I have looked through intersection and union techniques in cypher, including `apoc.intersection` procedure but it does exaclty work in the case. 

The database contains approximately 6M relationships and efficiency is of the essence. We always try to find a random ad for one user (query would always start with `MATCH (u:User{id:&quot;1&quot;})...`. I have written a ton of unsuccessful tests but I am not sure which efficient approach I could have for a problem like this. Any help would be appreciated !


  [1]: https://i.stack.imgur.com/dIqYj.png
  [2]: https://i.stack.imgur.com/0wCKt.png",1625643220,https://stackoverflow.com/q/68281830,Romain Bruckert,"['neo4j', 'cypher', 'graph-databases']"
68276475,How to query a limit of employees under all companies?,"Suppose I have a list of companies. Some companies employ employees. &lt;br&gt;
I want to query all companies together with a limit of 3 employees from each company, as well as a total number of employees employed by each company.&lt;br&gt;

Right now my query looks like this:

    MATCH (c:Company) 
        OPTIONAL MATCH (c)-[:EMPLOYS]-&gt;(p:Person)
        WITH c, p
        LIMIT 3
        RETURN c, p, count(p) as total
        ORDER by c.name;

But I am getting only 1 employee under each company.",1625599947,https://stackoverflow.com/q/68276475,Joshua Leung,"['cypher', 'neo4j']"
68276088,Unable to connect to Neo4j cluster using neo4j scheme via cypher shell,"I want to connect to my Neo4j server from my local machine. The neo4j server comprises of 3 instances, as it is a cluster. Using browser, I am able to connect to the cluster using the connection scheme: neo4j://localhost:7687 but using cypher-shell, I am only able to connect via bolt scheme.

It is a problem because I want the instance I am connecting to be aware of the cluster and if I understand correctly, bolt scheme does not allow that.

I connect to Neo4j by tunneling into the K8s node and port forwarding 7687.
And this is how I connect:
```
➜  cypher-shell -a neo4j://localhost:7687
username: neo4j
password: &lt;pw&gt;
Failed to connect to neo4j://localhost:7687, fallback to bolt://localhost:7687
Connected to Neo4j using Bolt protocol version 4.2 at bolt://localhost:7687 as user neo4j.
Type :help for a list of available commands or :exit to exit the shell.
Note that Cypher queries must end with a semicolon.
neo4j@neo4j&gt; :help
```
As you can see, the connection falls to bolt even though I connect via neo4j scheme.",1625597831,https://stackoverflow.com/q/68276088,Aviral Srivastava,"['neo4j', 'cypher-shell']"
68273674,Patch user Neo4j / NestJs,"i would like to update properties of my users, but when I do it it returns me only the new properties but didn&#39;t save the one that I haven&#39;t change. 

This is my request : &#39;MATCH (n:Organisation {uuid:$uuid}) SET n=$properties RETURN n.corporateName, n.createdAt, n.headcount, n.shareCapital, n.uuid, n.dateOfBirth, n.satuts, n.updatedAt&#39;, {uuid, properties})

Is any one already have this problem thaks for helping me 

",1625586506,https://stackoverflow.com/q/68273674,Gauthier Cornec,"['neo4j', 'nestjs']"
68273029,How to create queries using runtime managed labels using Neo4j-OGM?,"Simple question: I&#39;m using Neo4-OGM (with Quarkus) to interact with my Neo4J DB (latest version).

I have an entity &quot;Contact&quot; and I added the @Labels to be able to manage extra labels at runtime.

    @NodeEntity
    public class Contact {
    
        @Id
        @GeneratedValue(strategy = UuidStrategy.class)
        private String identifier;

        // some properties and relations...
    
        @Labels
        private List&lt;String&gt; labels;
    
    }

This will work fine.

But now, I would like to querying my DB using the methods loadAll with Filters instead of writing by myself a cypher query.

Unfortunately, I cannot see how I could get any equivalent of the following cypher query:

    MATCH (n:`Contact`:`Label_added_in_labels`) RETURN n

Is it supported? Or I will have to write the cypher by myself? (That&#39;s fine but I don&#39;t want to write them if it&#39;s not needed).",1625583989,https://stackoverflow.com/q/68273029,koD,"['neo4j', 'neo4j-ogm']"
68266524,how do I create unique constraints on two properties in neo4j?,"I&#39;m using nodes as intermediate path elements, but I want to make sure the start/end are unique. How do I create a constraint that requires TWO values to be checked?

I can set individual ones but can&#39;t see syntax for a two-part constraint.

```
        neolib.run_query(
            &quot;&quot;&quot;CREATE CONSTRAINT
                uSource
                if not exists
                ON (m:route) ASSERT m.source IS UNIQUE&quot;&quot;&quot;)
        neolib.run_query(
            &quot;&quot;&quot;CREATE CONSTRAINT
            uTarget
            if not exists
            ON (m:route) ASSERT m.target IS UNIQUE&quot;&quot;&quot;)
```


",1625557593,https://stackoverflow.com/q/68266524,dcsan,"['py2neo', 'neo4j']"
68261539,How to write ShortestPath cypher in neo4j for the Game of Thrones Dataset,"For each person, write a cypher query to list the person’s name together with the max and average of the lengths of all shortest paths from the person in question to any other person. List the result in the descending order of the average length.

I can write it for two singular characters such as 

    MATCH (tyrion:Person {name: &quot;Tyrion&quot;}), (drogo:Person {name: &quot;Drogo&quot;})
    MATCH p=shortestPath((tyrion)-[INTERACTS*]-(drogo))
    RETURN DISTINCT length(p), drogo.name as Name

But am having difficulty doing it for all and displaying. ",1625515134,https://stackoverflow.com/q/68261539,Fizzler,['neo4j']
68256897,Retry after OOME fail when Neo4j procedure called from Neo4j browser but not from cypher-shell,"I have Java method deployed into dockerized Neo4j as standard stored procedure in plugin. The method sets new property to all nodes of some label. It fails with OutOfMemoryError since the JVM heap is not appropriately sized for committing everything in single transaction.

```java
public class Foo {

	@Context
	public Transaction tx;

	@Procedure(value = &quot;foo&quot;, mode = Mode.WRITE)
	public void foo() {
		System.out.println(&quot;ENTER&quot;);
		for (Node node : (Iterable&lt;Node&gt;) () -&gt; tx.findNodes(Labels.label(&quot;Hoo&quot;))) {
			node.setProperty(&quot;SOME_PROPERTY&quot;, new long[] {100L,200L});
		}
		System.out.println(&quot;EXIT&quot;);
	}
}
```

Let&#39;s call the method:

```
CALL foo();
```

 - When the method is called from Neo4j Browser on localhost:7474, the method exits but then it is called again:

```
ENTER
EXIT

Exception: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread &quot;neo4j.StorageMaintenance-3&quot;

Exception: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread &quot;neo4j.StorageMaintenance-2&quot;

Exception: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread &quot;qtp1566104673-43&quot;
Exception in thread &quot;neo4j.VmPauseMonitor-1&quot; Exception in thread &quot;neo4j.Scheduler-1&quot; java.lang.OutOfMemoryError: Java heap space
java.lang.OutOfMemoryError: Java heap space
2021-07-03 09:42:16.438+0000 WARN  
java.lang.OutOfMemoryError: Java heap space
Exception in thread &quot;qtp1566104673-40&quot; java.lang.OutOfMemoryError: Java heap space
ENTER
EXIT
```

  - When I `docker exec` into Neo4j container and call the method from `cypher-shell`, the method fails with OOME too, but there is no repeated call.

*Why is the method called twice from Neo4j Browser?* Is there some documentation or link to source code to support reasoning of such behavior?

(Please note the question is not how to fix OOME, currently it is successfully fixed to bulk processing in similar manner to `apoc.periodic` package.)",1625491283,https://stackoverflow.com/q/68256897,Tom&#225;š Z&#225;lusk&#253;,"['cypher-shell', 'neo4j-browser', 'retry-logic', 'cypher', 'neo4j']"
68252567,simple example of working with neo4j python driver?,"Is there a simple example of working with the neo4j python driver?
How do I just pass cypher query to the driver to run and return a cursor?

If I&#39;m reading [for example this](https://neo4j.com/docs/api/python-driver/current/#quick-example) it seems the demo has a class wrapper, with a private member func I pass to the session.write, 

`session.write_transaction(self._create_and_return_greeting, ...`

That then gets called it with a transaction as a first parameter...

`def _create_and_return_greeting(tx, message):`

that in turn runs the cypher 

`        result = tx.run(&quot;CREATE (a:Greeting) &quot;`

This seems 10X more complicated than it needs to be.

I did just try a simpler:

```
def raw_query(query, **kwargs):
    neodriver = neo_connect()  # cached dbconn
    with neodriver.session() as session:
        try:
            result = session.run(query, **kwargs)
            return result.data()
```

But this results in a socket error on the query, probably because the session goes out of scope?

```
[dfcx/__init__] ERROR | Underlying socket connection gone (_ssl.c:2396)

[dfcx/__init__] ERROR | Failed to write data to connection IPv4Address((&#39;neo4j-core-8afc8558-3.production-orch-0042.neo4j.io&#39;, 7687)) (IPv4Address((&#39;34.82.120.138&#39;, 7687)))
```

Also I can&#39;t return a cursor/iterator, just the `data()` 
When the session goes out of scope, the query result seems to die with it. 

If I manually open and close a session, then I&#39;d have the same problems?

Python must be the most popular language this DB is used with, does everyone use a different driver? 
Py2neo seems cute, but completely lacking in ORM wrapper function for most of the cypher language features, so you have to drop down to raw cypher anyway. And I&#39;m not sure it supports `**kwargs` argument interpolation in the same way.

I guess that big raise should help iron out some kinks :D

Slightly longer version trying to get a working DB wrapper:

```
def neo_connect() -&gt; Union[neo4j.BoltDriver, neo4j.Neo4jDriver]:

    global raw_driver
    if raw_driver:
        # print(&#39;reuse driver&#39;)
        return raw_driver

    neoconfig = NEOCONFIG
    raw_driver = neo4j.GraphDatabase.driver(
        neoconfig[&#39;url&#39;], auth=(
            neoconfig[&#39;user&#39;], neoconfig[&#39;pass&#39;]))
    if raw_driver is None:
        raise BaseException(&quot;cannot connect to neo4j&quot;)
    else:
        return raw_driver


def raw_query(query, **kwargs):
    # just get data, no cursor
    neodriver = neo_connect()
    session = neodriver.session()
    # logging.info(&#39;neoquery %s&#39;, query)
    # with neodriver.session() as session:
    try:
        result = session.run(query, **kwargs)
        data = result.data()
        return data

    except neo4j.exceptions.CypherSyntaxError as err:
        logging.error(&#39;neo error %s&#39;, err)
        logging.error(&#39;failed query: %s&#39;, query)
        raise err
    # finally:
    #     logging.info(&#39;close session&#39;)
    #     session.close()
```

update: someone pointed me to this example which is another way to use the tx wrapper.

https://github.com/neo4j-graph-examples/northwind/blob/main/code/python/example.py#L16-L21
",1625472000,https://stackoverflow.com/q/68252567,dcsan,"['py2neo', 'neo4j', 'python']"
68250794,Neo4j: How to pass a variable to a neo4j query,"My config.j2 file looks like this:

    App_name = abc
    
    cypher: &quot;&quot;&quot;
    	        MATCH (n:Node) WHERE (n.APPLICATION=&#39;{{App_name}}&#39;) AND RETURN n.DESCR
    &quot;&quot;&quot;



The above works perfectly fine when i pass App_name as a command line parameter, but doesnt work if I pass it as a variable.

",1625459843,https://stackoverflow.com/q/68250794,Ranjana Jha,['neo4j']
68235716,Returning Neo4j map projection with WebFlux,"I have the nodes  *user* and *game* with some relationships between them.

My REST API should return all relationships between the games and 1 user.

[![enter image description here][1]][1]

The cypher query i use is:

    MATCH  (u:User {id: &#39;1234&#39;} ) -[rel]- (game:Game) return game{.*, relationships: collect(DISTINCT rel)}

In my Neo4j Browser, everything works as expected and i see all properties i need.
But the GetMapping retuns everything except the relationship properties.





**Neo4j Browser**

 

       {
          &quot;relationships&quot;: [
           {
                &quot;identity&quot;: 54,
                &quot;start&quot;: 9,
                &quot;end&quot;: 8,
                &quot;type&quot;: &quot;OWNED&quot;,
                &quot;properties&quot;: {
                   &quot;ownedDate&quot;: &quot;2021-07-03&quot;
                 }
            },
            {
                &quot;identity&quot;: 45,
                &quot;start&quot;: 9,
                &quot;end&quot;: 8,
                &quot;type&quot;: &quot;PLAYED&quot;,
                &quot;properties&quot;: {
                   &quot;times&quot;: 5
                 }
            }
          ],
          &quot;name&quot;: &quot;Blood Rage&quot;,
          &quot;state&quot;: &quot;ACTIVE&quot;,
          &quot;id&quot;: &quot;1c152c91-4044-41f0-9208-0c436d6f6480&quot;,
          &quot;gameUrl&quot;: &quot;https://asmodee.de/blood-rage&quot;
        }


**GetMapping result** (As you can see, the relationships are empty, but i have more empty JsonObjects, when there are more Relationships
    
         {
            &quot;game&quot;: {
                &quot;relationships&quot;: [
                    {},
                    {}
                ],
                
                &quot;name&quot;: &quot;Blood Rage&quot;,
                &quot;gameUrl&quot;: &quot;https://asmodee.de/blood-rage&quot;,
                &quot;state&quot;: &quot;ACTIVE&quot;,
                &quot;id&quot;: &quot;1c152c91-4044-41f0-9208-0c436d6f6480&quot;
            }
        }


**The GetMapping is:**

        ...
    final ReactiveNeo4jClient client;
        ...
        ...
        ...
        
        @GetMapping(value = { &quot;/{id}/games&quot;})
        @RolesAllowed({&quot;user&quot;, &quot;admin&quot;})
        Flux&lt;Map&lt;String, Object&gt;&gt; findGamesByUser(@PathVariable String id){
            String query = &quot;MATCH  (uuser:User {id: &#39;&quot; + id + &quot;&#39;} ) -[rel]- (game:Game) return game{.*, relationships: collect(DISTINCT rel)}&quot;;
            return client.query(query).fetch().all();
        }


**A RelationshipProperty-Example**

    @RelationshipProperties
    @Data
    @Builder
    public class PlayedGame {
        @Id
        @GeneratedValue
        private Long relationshipId;
    
    
        @Property
        int times = 0;
    
        @TargetNode private GameEntity game;
    
        public int addPlay(){
            this.times = this.times + 1;
            return this.times;
        }
    }


What do i have to change in my GetMapping to show the relationship-properties?

Thank you,
Kevin


  [1]: https://i.stack.imgur.com/AvETs.png",1625310741,https://stackoverflow.com/q/68235716,Kevin Busch,"['spring-data-neo4j', 'spring-webflux', 'cypher', 'neo4j']"
68231726,Failed to establish connection to Neo4j usign bolt scheme even after successfully enabling Bolt,"I want to connect to Neo4j database using my creds. I am tunneling into a machine and once that is done, I open my broswer at the port: `localhost:7474`. 
I tried with both neo4j and bolt scheme to connect at the url:
`bolt://&lt;node_ip&gt;:7687` and `neo4j://&lt;node_ip&gt;:7687` but the connection times out.

I tried checking the logs but only found that bolt scheme is enabled:
```
bash-4.2$ tail -f /logs/debug.log
2021-07-02 21:26:03.323+0000 WARN  [o.n.k.a.p.GlobalProcedures] Failed to load `org.apache.commons.logging.impl.LogKitLogger` from plugin jar `/home/sandbox/neo/plugins/apoc-4.2.0.2-all.jar`: org/apache/log/Logger
2021-07-02 21:26:03.946+0000 INFO  [c.n.m.g.GlobalMetricsExtension] Sending metrics to CSV file at /home/sandbox/neo/metrics
2021-07-02 21:26:03.973+0000 INFO  [o.n.b.BoltServer] Bolt enabled on 0.0.0.0:7687.
2021-07-02 21:26:03.974+0000 INFO  [o.n.b.BoltServer] Bolt (Routing) enabled on 0.0.0.0:7688.
2021-07-02 21:26:03.974+0000 INFO  [o.n.s.AbstractNeoWebServer$ServerComponentsLifecycleAdapter] Starting web server
2021-07-02 21:26:04.001+0000 INFO  [o.n.s.m.ThirdPartyJAXRSModule] Mounted unmanaged extension [n10s.endpoint] at [/rdf]
2021-07-02 21:26:05.341+0000 INFO  [c.n.s.e.EnterpriseNeoWebServer] Remote interface available at http://&lt;node_ip&gt;:7474/
2021-07-02 21:26:05.341+0000 INFO  [o.n.s.AbstractNeoWebServer$ServerComponentsLifecycleAdapter] Web server started.
2021-07-02 21:35:34.565+0000 INFO  [c.n.c.c.c.l.s.Segments] [system/00000000] Pruning SegmentFile{path=raft.log.0, header=SegmentHeader{formatVersion=2, recordOffset=56, prevFileLastIndex=-1, segmentNumber=0, prevIndex=-1, prevTerm=-1}}
2021-07-02 21:35:46.079+0000 INFO  [c.n.c.c.c.l.s.Segments] [neo4j/32f6599b] Pruning SegmentFile{path=raft.log.0, header=SegmentHeader{formatVersion=2, recordOffset=56, prevFileLastIndex=-1, segmentNumber=0, prevIndex=-1, prevTerm=-1}}

```

The query log is empty, as I could not execute any query:
```
bash-4.2$ tail -f query.log
2021-07-02 21:25:52.510+0000 INFO  Query started: id:1 - 1009 ms: 0 B - embedded-session		neo4j -  - call db.clearQueryCaches() - {} - runtime=pipelined - {}
2021-07-02 21:25:52.580+0000 INFO  id:1 - 1080 ms: 112 B - embedded-session		neo4j -  - call db.clearQueryCaches() - {} - runtime=pipelined - {}
```

The other articles or answers that I read were mostly about misconfiguration: wrong ports but I don&#39;t think that is the case with me since I checked from `debug.log` file that my ports are alright.

FWIW, I am using 3 replicas for my Neo4j and right now, connecting to just one pod.

I am tunnelling both the ports:
```
ssh -L 7687:$IP:7687 -L 7474:$IP:7474 domain_name.com -N```",1625264078,https://stackoverflow.com/q/68231726,Aviral Srivastava,"['neo4j', 'kubernetes']"
68230736,How to get portion of variable-length pattern path where relationship attribute &gt;= some value?,"
How do I return just the portion of a variable length pattern path that meets some criteria?  

In the example below, the following cypher query will return both blue &amp; red nodes.

```
MATCH p=(a:Person)-[:KNOWS*1..10]-&gt;(b:Person)-[:KNOWS]-&gt;(j:Person { name: &#39;Jane&#39;})
RETURN p
```
[![enter image description here][1]][1]

However, I want to return the blue nodes that have an incoming relationship confidence_factor &gt;= 0.75.  The issue is that everything I&#39;ve tried either

 1. Eliminates the entire upper mixed blue/red path b/c it&#39;s got one rel that fails test
 2. Eliminates just the Jim-&gt;Erin rel b/c it fails the test.

Effectively, I want all sequential nodes going backwards from Jane where relationship confidence_factor &gt;= 0.75 but a given path should stop as soon as it encounters a rel that fails that test, and NOT CONTINUE, even if other relationships between nodes in that path might pass (e.g. Tom-[:KNOWS]-&gt;Jim)

```
CREATE (one:Person { name: &#39;Tom&#39;})
,(two:Person { name: &#39;Jim&#39;})
,(three:Person { name: &#39;Erin&#39;})
,(four:Person { name: &#39;Kevin&#39;})
,(five:Person { name: &#39;Skylar&#39;})
,(six:Person { name: &#39;Jane&#39;})

,(one)-[:KNOWS {confidence_factor:0.80}]-&gt;(two)
,(two)-[:KNOWS {confidence_factor:0.05}]-&gt;(three)
,(three)-[:KNOWS {confidence_factor:0.85}]-&gt;(six)
,(four)-[:KNOWS {confidence_factor:0.90}]-&gt;(five)
,(five)-[:KNOWS {confidence_factor:0.95}]-&gt;(six)
;
```

  [1]: https://i.stack.imgur.com/fNK2b.jpg",1625256266,https://stackoverflow.com/q/68230736,NumericOverflow,"['cypher', 'neo4j', 'graph']"
68228233,Can&#39;t create fulltext index in neo4j 4.2.X,"According to [this documentation][1], in `neo4j` 4.2.X one can create freetext indexes as follows:

```
CREATE FULLTEXT INDEX my_index
FOR (n:MYNODETYPE) ON EACH (n.label)
```

Yet when I run this query, I get the following error message:


&gt; Invalid input &#39;I&#39;: expected whitespace, comment, &#39;=&#39;, node labels, MapLiteral, a parameter, a parameter (old syntax), a relationship pattern, &#39;,&#39;, FROM GRAPH, USE GRAPH, CONSTRUCT, LOAD CSV, START, MATCH, UNWIND, MERGE, CREATE UNIQUE, CREATE, SET, DELETE, REMOVE, FOREACH, WITH, CALL, RETURN, UNION, &#39;;&#39; or end of input (line 1, column 17 (offset: 16))
&quot;CREATE FULLTEXT INDEX my_index&quot;

I&#39;ve seen [this related post][2] which had a similar error, but the accepted answer says that the syntax I&#39;m using should be valid in `neo4j` 4.X. I&#39;m running neo4j 4.2.7, community edition (confirmed by calling `dbms.components()`). 

What am I doing wrong?


  [1]: https://neo4j.com/docs/cypher-manual/4.2/administration/indexes-for-search-performance/
  [2]: https://stackoverflow.com/questions/62412504/cypher-indexing-returninvalid-input-i-expected-whitespace-comment-on",1625241473,https://stackoverflow.com/q/68228233,A. Debugne,"['cypher', 'neo4j', 'indexing']"
68227702,Neo4j: How to get mutual nodes for list of nodes,"I have this cypher code: 
```
MATCH path = (me:Person {uuid: &#39;{my_id}&#39;})-[:friendship*2]-&gt;(p:Person)-[:courses]-&gt;(c:Course)
WHERE p.uuid&lt;&gt;&#39;{my_id}&#39;
RETURN distinct(c) as courses
```

This code return all courses of every person in a *2 relationship. But how can I get only similar courses for these Persons?

Fox example:
Person1 have: Course1, Course2, Course3.

Person2 have: Course2, Course3, Course4

My code will return `[Course1, Course2, Course3, Course4]`, but I need `[Course2, Course3]` (only mutual)

Thanks for answers.

Update 1:
Here is my version:
```
MATCH (me:Person {uuid: &#39;{my_id}&#39;})-[:friendship*2]-&gt;(p:Person)-[cr:courses]-&gt;(c:Course)
WITH collect(p) as persons, collect(cr) as courses_rel, g, collect(c) as courses
WHERE p.uuid&lt;&gt;&#39;{my_id}&#39; and all(rel in courses_rel WHERE all(person in persons WHERE startNode(rel) = person ))
RETURN courses
```

this code work, but return wrong data without filtering

Update 2:
[![Here is sccreenshot][1]][1]

  [1]: https://i.stack.imgur.com/AiLrM.jpg

I need to get 3 courses: `Ackerman, 27 Pines Golf Course, 18 Mile Creek Golf`",1625239260,https://stackoverflow.com/q/68227702,Alex Sukachov,"['cypher', 'neo4j']"
68221666,Spring Boot: Neo4j - Resolving incoming and outgoing relationships,"I&#39;m trying to model a quite straightforward Node-relationship in Neo4j using Spring. I have orders including optional complaints and want to gather the data in both directions (when gathering an order --&gt; get list of complaints, when gathering a complaint --&gt; get connected order).

My model looks like that:

    @Node(&quot;Complaint&quot;)
    @Getter
    @Setter
    public class Complaint {
    ...
        @Relationship(type = &quot;COMPLAINED_BY&quot;, direction = Direction.OUTGOING)
    	private Order order;
    }
    
    @Node(&quot;Order&quot;)
    @Getter
    @Setter
    public class Order {
    ...
        @Relationship(type = &quot;COMPLAINED_BY&quot;, direction = Direction.INCOMING)
	    private List&lt;Complaint&gt; complaints; 
    }

I modeled them at both sides as I want them both being resolved as requested. Unfortunately saving a complaint which is linked to an order doesn&#39;t save the relationship. I guess that the problem is, that I am not allowed to specify the relationship on both sides and that I have somehow to query for linked orders when requesting complaints and placing the relationship annotation in the Order-node.

Is there a simpler way to achieve this? Or are there any other tricks where I can model such a straightforward relationship where the relations are resolved on both sides?",1625212995,https://stackoverflow.com/q/68221666,Christian Mayr,"['neo4j', 'spring']"
68210812,NestJs / Neo4j : methode neo4jService.write(),"i try to set a root @Post to create a new user in my DB. 

i would like to input many properties but only one can be write. 

this is my person.service.ts 

```
async createPerson(uuid:string, firstName: string, lastName: string, dateOfBirth: string, updatedAt:string, createdAt: string, email: string): Promise&lt;Person&gt;{
        const request = await this.neo4jService.write(&#39;CREATE (n:Person {uuid:$uuid, firstName:$firstName}) RETURN n&#39;, {firstName, uuid})
        const persons = request.records[0].get(&#39;n&#39;)
        const forE = request.records.forEach(_fields =&gt; {
            console.log(_fields[&quot;_fields&quot;])
        });
        return persons

    }
````

And this is the error : Expected parameter(s): firstName +3325ms.

Thanks for helping me :)    ",1625144889,https://stackoverflow.com/q/68210812,Gauthier Cornec,"['nestjs', 'neo4j']"
68208771,Visualize Neo4j graph with HTML and Python,"I just want to have a list of my Nodes, where I can hover over them and select one to display it with it&#39;s detail&#39;s. Later I want to add a feature to create and delete nodes, basically making it a simple API for N4j.

I&#39;m wondering, is there a simple way to do this or has anybody done something similar? All i find on Google is implementations of the whole graph, but I dont need to see the graph. As mentioned, I only need the Nodes displayed in a list, where I can select single Nodes to display their information.

BTW I&#39;m working with HTML, CSS and Python.

Cheers",1625136345,https://stackoverflow.com/q/68208771,mcklmo,"['graph-databases', 'css', 'neo4j', 'html', 'python']"
68207923,NetworkXError: Input is not a known data type for conversion,"I want to create a networkx graph using the Neo4j GraphDB in VM. I have tried a bunch of things online but I&#39;m getting the same error, when I&#39;m trying to use py2neo to do the same, the error pops up and also when straight loading via a neo4j BoltDriver.

The implementation:

    from neo4j import GraphDatabase
    import networkx as nx
    
    driver = GraphDatabase.driver(credentials[&#39;url&#39;], auth=(credentials[&#39;user&#39;], credentials[&#39;passwd&#39;]))
    
    G = nx.Graph(driver)

Anything I&#39;m missing? I have gone through the documentation of the networkx but sadly nothing relevant to the issue I&#39;m facing. ",1625132682,https://stackoverflow.com/q/68207923,Strayhorn,"['python', 'graph-databases', 'networkx', 'py2neo', 'neo4j']"
68200708,Neo4j Desktop error: Unable to establish remote connection,"The database is on the same Windows 10 computer as Neo4j. I want to connect Neo4j Desktop (1.4.6) to the database created by Neo4j Community and py2neo, so that I can run Bloom.  When I try to connect Desktop to the database, I get the error below, in brief: &quot;unable to establish remote connection.&quot;


Steps in Desktop:

1. In the default &quot;Neo4j Primer Project&quot;, select to Add-&gt;Remote Connection

2. Leave the Connect URL set to neo4j://localhost:7687 (this is the default that comes up)

3. Login uses same neo4j / password as used for Community.  I also tried the default neo4j/neo4j

4. The steps above create an item labeled &quot;Remote DBMS&quot; within the default &quot;Neo4j Primer Project&quot; on Desktop.  I click on Connect for the Remote DBMS and get this error:

Unable to establish remote connection : Neo4jError: WebSocket connection failure. Due to security constraints in your web browser, the reason for the failure is not available to this Neo4j Driver. Please use your browsers development console to determine the root cause of the failure. Common reasons include the database being unavailable, using the wrong connection URL or temporary network problems. If you have enabled encryption, ensure your browser is configured to trust the certificate Neo4j is configured to use. WebSocket `readyState` is: 3

5. After receiving the error, I have tried various updates to the conf file such as described at the link below and many other various updates to conf from other links, all to no avail.

https://neo4j.com/developer/kb/explanation-of-error-websocket-connection-failure/

",1625081750,https://stackoverflow.com/q/68200708,e25548,"['desktop', 'neo4jclient', 'neo4j']"
68197722,jQAssistant: org.neo4j.driver.exceptions.ClientException: Unable to convert [C to Neo4j Value - known error?,"I&#39;m starting with jQAssist scanning (version 1.9.1). Most of the Maven projects can be scanned without problem, but there is a problem with some tests.

I get this stack trace:

    [WARNING] Cannot scan class &#39;/foo/bar/util/validation/constraints/VerfahrensspracheTest$Geschaeft.class&#39;.
    org.neo4j.driver.exceptions.ClientException: Unable to convert [C to Neo4j Value.
        at org.neo4j.driver.Values.value (Values.java:134)
        at org.neo4j.driver.Values.value (Values.java:297)
        at org.neo4j.driver.Values.value (Values.java:119)
        at org.neo4j.driver.Values.parameters (Values.java:401)
        at com.buschmais.xo.neo4j.remote.impl.datastore.AbstractRemoteDatastorePropertyManager.flush (AbstractRemoteDatastorePropertyManager.java:68)
        at com.buschmais.xo.neo4j.remote.impl.datastore.RemoteDatastoreEntityManager.flush (RemoteDatastoreEntityManager.java:235)
        at com.buschmais.xo.impl.cache.CacheSynchronizationService.flush (CacheSynchronizationService.java:50)
        at com.buschmais.xo.impl.cache.CacheSynchronizationService.flush (CacheSynchronizationService.java:34)
        at com.buschmais.xo.impl.query.XOQueryImpl.flush (XOQueryImpl.java:158)
        at com.buschmais.xo.impl.query.XOQueryImpl.execute (XOQueryImpl.java:138)
  etc. etc.


The test in question contains an inner class:

    public class VerfahrensspracheTest extends BeanValidationTestBase&lt;VerfahrensspracheTest.Geschaeft&gt; {

      /**
       * Tests {@link Verfahrenssprache} with English.
       */
      @Test
      public void testEnglish() {
        // Some test
      }

      /**
       * Some bean for testing.
       */
      @SuppressWarnings(&quot;javadoc&quot;)
      static class Geschaeft extends PrettyPrintObject {

        /**
         * Creates this with valid values.
         */
        public Geschaeft() {
          this.sprache1 = foo.bar.util.type.language.Verfahrenssprache.DEUTSCH;
          this.sprache2 = foo.bar.util.type.language.Verfahrenssprache.ENGLISCH.getISOCode();

          this.sprache3 = Maps.newHashMap();
          this.sprache3.put(foo.bar.util.type.language.Verfahrenssprache.DEUTSCH, &quot;Deutsch&quot;);
          this.sprache3.put(foo.bar.util.type.language.Verfahrenssprache.FRANZOESISCH, &quot;Fran&#231;ais&quot;);
          this.sprache3.put(foo.bar.util.type.language.Verfahrenssprache.ITALIENISCH, &quot;Italiano&quot;);
        }

        @Verfahrenssprache
        public foo.bar.util.type.language.Verfahrenssprache sprache1;

        @Verfahrenssprache(englishAllowed = true)
        public String sprache2;

        @Verfahrenssprache
        public Map&lt;foo.bar.util.type.language.Verfahrenssprache, String&gt; sprache3;
      }
    }

Is there a problem with my inner class or is there a problem with jQAssistant?",1625067147,https://stackoverflow.com/q/68197722,eerriicc,"['jqassistant', 'neo4j']"
68192710,COLLECT() causes function to enter infinite loading loop,"In Neo4j I have a set of graphs comprising of seed terms and synonyms appended to those seed terms via relationship `[:SYNONYM_OF]`. I&#39;m writing a function where any node that contains a word matching a synonym of a certain seed term gets returned alongside any relevant synonym(s) listed. My current query is shown below:

```
MATCH (b)-[*]-&gt;(z)-[*]-&gt;(n),
      (syn)&lt;-[r]-&gt;(seed:Seed_Term {name: &quot;valuation&quot;})
WHERE (
  (
    n.name CONTAINS toLower(syn.name)
    OR n.content CONTAINS toLower(syn.name)
  )
  OR (
    n.name CONTAINS toUpper(syn.name)
    OR n.content CONTAINS toUpper(syn.name)
  )
)
AND (b:Label)
AND (n:Title OR n:Text OR n:Column OR n:RowName OR n:Cell)
AND (z:Pdf)
RETURN n.name AS node,
       syn.name AS synonym_found,
       seed.name AS seed_term,
       b.labelName AS company,
       z.year AS year,
       r AS rel_type
LIMIT 1000
```

The only issue with this is that if there are three different synonyms found, it returns the row containing the content (node) three times, with the synonym_found being different each time. I know that I should instead do `collect(syn.name)` rather than `syn.name`, however whenever I do this the code enters an infinite loop to the point that I just have to terminate the query. This occurs even if I write `LIMIT 1` at the end. Why is `collect()` causing this to occur?
",1625047650,https://stackoverflow.com/q/68192710,Tous Shahedian-Farid,"['neo4j', 'cypher', 'collect']"
68183454,Unable to connect to Neo4j with rusted_cypher,"I am trying to use Neo4j with Rust. Currently, there is no official driver. I&#39;ve been trying to connect with the rusted_cypher crate, to no avail. I&#39;ve used Neo4j extensively with Python but I am new to Rust.

Here is the minimal example:&lt;br&gt;
&lt;br&gt;
Cargo.toml
```
rusted_cypher = &quot;1.1.0&quot;
```

main.rs
```
use rusted_cypher::GraphClient;

fn main() {
    
    let graph = GraphClient::connect(
        &quot;http://&lt;username&gt;:&lt;password&gt;@localhost:7474/&lt;database_name&gt;/data&quot;).unwrap();

}
```

This returns:
```
thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Serde(Error(&quot;EOF while parsing a value&quot;, line: 1, column: 0))&#39;, src/main.rs:6:53
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```

When I try to remove the database name I get:
```
thread &#39;main&#39; panicked at &#39;called `Result::unwrap()` on an `Err` value: Serde(Error(&quot;missing field `extensions`&quot;, line: 0, column: 0))&#39;, src/main.rs:6:49
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```

",1624988899,https://stackoverflow.com/q/68183454,Neotenic Primate,"['serde', 'neo4j', 'rust']"
68183419,Neo4j get all parents and grand parents,"I have an unknown-level tree hierarchy stored in the Neo4j graph database. 
How can I retrieve all parents and grand parents for a given nodes. 
So in the following example, node &quot;a&quot; has parent and grand parent &quot;c&quot;, &quot;e&quot;, and &quot;b&quot;

```
CREATE (a {id:1})
CREATE (b {id:2})
CREATE (c {id:3})
CREATE (d {id:4})
CREATE (e {id:5})

MATCH (a), (c) WHERE a.id = 1 AND c.id = 3 CREATE (a) -[r:PARENT]-&gt; (c)
MATCH (c), (e) WHERE c.id = 3 AND e.id = 5 CREATE (c) -[r:PARENT]-&gt; (e)
MATCH (a), (b) WHERE a.id = 1 AND b.id = 2 CREATE (a) -[r:PARENT]-&gt; (b)
```


",1624988716,https://stackoverflow.com/q/68183419,user1187968,"['cypher', 'neo4j']"
68181849,Neo4J server is not stopping,"DBMS failed to stop: undefined 

The following logs and troubleshooting guide may help you diagnose the issue:
Desktop logs
Neo4j DBMS logs
Troubleshooting guide",1624981141,https://stackoverflow.com/q/68181849,Shankar Mamba,"['neo4j', 'database', 'server']"
68181710,Neo4jrb Query on relationship properties with QueryProxy and AssociationProxy,"I&#39;m wondering if it is possible to query a property of a relationship during an association chain. The following example can help you to understand:
```lang-ruby

  class AccountRel
    include ActiveGraph::Relationship

    from_class :Person
    to_class   :Social

    property :platform, type: [String] # Like [Instagram, Facebook]
  end


  class Person
    include ActiveGraph::Node
    self.mapped_label_name = &#39;Person&#39;
    property :name, type: String
    property :gender, type: Boolean
    has_many :out, :socials, rel_class: :AccountRel, unique: true
  end


  class Social
    include ActiveGraph::Node
    self.mapped_label_name = &#39;Social&#39;
    property :followers_count, type: Integer
    has_many :out, :friends, rel_class: :AccountRel, unique: true
  end
```
My goal is to do something like that:
```lang-ruby
Person.socials({query on platform property of AccountRel  relationship})
OR
Person.socials.where(node_var: {Social node properties}, rel_var: {AccountRel properties})
```
As far as I know, ```Person.socials``` return an *AssociationProxy* and with ```Person.socials.where(followers_count: 100)``` I can query the social nodes related to the Person with followers_count = 100, however I cannot query on the relationship that links Person to Social. 
In Cypher terms, I would like to do something like:
```lang-cypher
match (n:Person)-[r:AccountRel]-&gt;(s:Social)
where r.platform in [&quot;Instagram&quot;, &quot;Facebook&quot;]
return n
```
I want to specify that I&#39;m interested in **chaining** via QueryProxy and AssociationProxy, I don&#39;t need a Cypher query string (&#39;MATCH (n:Person) ..&#39;).
The following could be a good approach 
```lang-ruby
Person.socials(:s, :rel).where(&#39;rel.platform IN [&quot;Instagram&quot;, &quot;Facebook&quot;]&#39;)
```
but my query should be as much dynamic as possible, so I would like to avoid both:
- explicit variable naming like :s and :rel in the example
- string query in the *where clause*

",1624980648,https://stackoverflow.com/q/68181710,Sbunzini,"['neo4jrb', 'cypher', 'relationship', 'ruby', 'neo4j']"
68180153,What causes ArrayIndexOutOfBoundsException when importing csv in neo4j?,"I  want to import a csv table with tweets from twitter. But I get the error message: 
&gt;Failed to invoke procedure `apoc.load.csv`: Caused by: java.lang.ArrayIndexOutOfBoundsException: Index 4 out of bounds for length 4

My Code is:
```{Cypher}
CALL apoc.load.csv(&quot;conversations_until_2021_06_18.tsv&quot;, {
  sep: &quot;TAB&quot;,
  arraySep: &quot;,&quot;,
  skip: 100000,
  mapping: {
    hashtags: {array: true},
    mentions: {array: true},
    ref_id: {array: true},
    reply_count: {type: &quot;int&quot;},
    retweet_count: {type: &quot;int&quot;},
    quote_count: {type: &quot;int&quot;},
    like_count: {type: &quot;int&quot;}
    }
  }
)
YIELD map AS tweet
CREATE (t:Tweet)
SET t = tweet
```

Please provide the following information if you ran into a more serious issue:

I&#39;m using Neo4j v4.3.1, Desktop v1.4.5

An example:
```
comment_type	conversatoin_id	text	author_id	tweet_id	ref_type	ref_id	in_reply_to_user_id	created_at	mentions	url	hashtags	like_count	quote_count	reply_count	retweet_count	reply_settings
side	1234  @url https://t.co/...   345  5678  replied_to	564465   4566   2021-04-28T15:55:42.000Z	ABaerbock, ArminLaschet	https://twitter.com/... 	NaN	0	0	0	0	everyone
```
One of my files works fine, but the second produces this error. According to this [this](https://stackoverflow.com/questions/56563157/neo4js-client-error-apoc-load-csv-failed-procedure-caused-by-arrayindexoutofbou) question there my be a problem with a line in the file. But how to find that line? I have no idea where an array of length 4 could be.",1624974927,https://stackoverflow.com/q/68180153,Sandro Martens,"['neo4j-apoc', 'neo4j']"
68177842,Neo4j kafka stream event not getting passed as parameter to apoc.periodic.iterate(),"I am running Neo4j Community v4.2.4 on an AWS ec2 instance with apoc-4.2.0.4-all.jar and neo4j-streams-4.0.6.jar provided in the plugin directory.
When the system reads from the kafka topic I&#39;m attempting to pass the &#39;event&#39; as a parameter to apoc.periodic.iterate but as per the below debug.log entry the value is not getting passed correctly.

I have successfully tested this configuration locally via Neo4j Desktop and Kafka so I&#39;m not sure what I&#39;m doing wrong for the AWS approach

/etc/neo4j/neo4j.template

streams.sink.enabled=true

streams.sink.topic.cypher.cleanup: CALL apoc.periodic.iterate(&quot;MATCH (ad:AirportDay {iataCode: $event.airportCode}) WHERE datetime({epochMillis:apoc.date.parse(ad.date,&#39;ms&#39;, &#39;yyyy-MM-dd&#39;)}) &lt; datetime($event.scheduleDeparture) RETURN ad&quot;, &quot;RETURN ad&quot;, {batchSize:1000, parallel:false, params:{event:event}}) YIELD batches, total, errorMessages return 0

Message ingested from kafka: {&quot;airportCode&quot;:&quot;XYZ&quot;,&quot;scheduleDeparture&quot;:&quot;2021-06-14T00:00:00Z&quot;}

debug.log

ErrorData(originalTopic=flight-connections-cleanup, timestamp=1624547142793, partition=2, offset=10216, exception=org.neo4j.graphdb.QueryExecutionException: Failed to invoke procedure `apoc.periodic.iterate`: Caused by: org.neo4j.exceptions.SyntaxException: invalid literal number (line 1, column 41 (offset: 40))

&quot;EXPLAIN MATCH (ad:AirportDay {iataCode: .airportCode}) WHERE datetime({epochMillis:apoc.date.parse(ad.date,&#39;ms&#39;, &#39;yyyy-MM-dd&#39;)}) &lt; datetime(.scheduleDeparture) RETURN ad&quot;
                                         ^, key=null, value={&quot;airportCode&quot;:&quot;ALW&quot;,&quot;scheduleDeparture&quot;:&quot;2021-06-22T00:00:00Z&quot;}, executingClass=class streams.kafka.KafkaAutoCommitEventConsumer)
streams.service.errors.ProcessingError: Error processing 1 messages
ErrorData(originalTopic=flight-connections-cleanup, timestamp=1624547142793, partition=2, offset=10216, exception=org.neo4j.graphdb.QueryExecutionException: Failed to invoke procedure `apoc.periodic.iterate`: Caused by: org.neo4j.exceptions.SyntaxException: invalid literal number (line 1, column 41 (offset: 40))
&quot;EXPLAIN MATCH (ad:AirportDay {iataCode: .airportCode}) WHERE datetime({epochMillis:apoc.date.parse(ad.date,&#39;ms&#39;, &#39;yyyy-MM-dd&#39;)}) &lt; datetime(.scheduleDeparture) RETURN ad&quot;
                                         ^, key=null, value={&quot;airportCode&quot;:&quot;ALW&quot;,&quot;scheduleDeparture&quot;:&quot;2021-06-22T00:00:00Z&quot;}, executingClass=class streams.kafka.KafkaAutoCommitEventConsumer)",1624966242,https://stackoverflow.com/q/68177842,JMac,"['neo4j-apoc', 'apache-kafka-streams', 'neo4j']"
68177766,catch &#39;ClientError&#39; exception when using neo4j (and generally how to catch the first exception in an error),"I&#39;m trying to wrap some neo4j functions as simple as Graph constructor in order to catch some specific errors. But they are &#39;behind &#39; a cascade. 
consider a simple 

    import sys
    from py2neo.errors import * 
    #help(errors)
    print(ClientError)
    def get_graph(key, ip, user, database=&quot;somethinghidden&quot;):
     &quot;&quot;&quot;create a Graph object connecting to the database.
     The function is there to provide space to handle connection failure&quot;&quot;&quot;
     try:
          return Graph(&#39;bolt://&#39; + ip, auth=(user, key), name=database)
      except ClientError as e :
             print(e)
       except Exception as e:
            kut.display_message([&#39;can not connect to&#39; ,database, &#39;with user&#39;, user, &#39;on ip&#39;, ip])# &lt;&lt; this is just a refined print
             print(type(e),e)
             print(sys.exc_info())
           
            
then 

    get_graph(user=&quot;neo4j4&quot;,key=password,ip=ip)  #user is wrong on purpose , the other variable are hidden from you :)

would get the following output

&gt; **************************************************************************
&gt; * can not connect to somegraphname with user neo4j4 on ip x.x.x.x *
&gt; ************************************************************************** &lt;class &#39;py2neo.errors.ConnectionUnavailable&#39;&gt; Connection has been
&gt; closed (&lt;class &#39;py2neo.errors.ConnectionUnavailable&#39;&gt;,
&gt; ConnectionUnavailable(&#39;Connection has been closed&#39;), &lt;traceback object
&gt; at 0x7f4d0c2d2190&gt;)

While using 
   

    graph = Graph(&#39;bolt://&#39;+ip, auth=(&quot;neo4j4&quot;, password),name=&quot;some name&quot;)

I get more details because I can see the &#39;original sin&#39; namely :

&gt; ... ClientError: [Security.Unauthorized] The client is unauthorized
&gt; due to authentication failure.
&gt; 
&gt; During handling of the above exception, another exception occurred:
&gt; ...

Obviously I tried to catch it nonetheless, I&#39;m missing something on how to catch the original issue. 

",1624965955,https://stackoverflow.com/q/68177766,Cyll Aldahir,"['neo4j', 'python-3.x']"
68175776,How to import CSV files and create relationship between them with neo4j,"I have 3 csv files called: movies,  genres borrowed movies. It&#39;s like simulating a DVD club.
So the first file(**movies**) has the following columns: *title, director, year published, publisher, price.*
The **genre** file has the following columns : *title, genre.*
And the **borrowed movies** has : *title, user, date*
How could i import these and create the necessary relationships with one another like the movie with the genre and the movie with the people who borrowed it from the dvd club?
I am very new to neo4j
",1624957917,https://stackoverflow.com/q/68175776,Reacting Innocent,"['csv', 'cypher', 'neo4j']"
68174482,Map the id to its dateRange and return the result,"
    List&lt;String&gt; id = new ArrayList&lt;&gt;();
    String cypher = &quot;unwind $dateRanges as dateRange match(f:File)-[c:CHANGED]-(fo:Folder) where c.changedDate &lt; dateRange.endDate and c.changedDate &gt; dateRange.startDate return dateRange.startDate, dateRange.endDate, f, fo, $id as id&quot;
    neo4J.getResults(
		cypher,
        Values.parameters(
           &quot;dateRanges&quot;, dateRangeMapList,
           &quot;id&quot;, id.remove(0)
        ),
        results -&gt; null
    );


    dateRangeMapList =&gt; [{startDate=&quot;2021-01-09&quot;, endDate=&quot;2021-01-15&quot;},
    {startDate=&quot;2021-01-15&quot;, endDate=&quot;2021-01-21&quot;}]

    id =&gt; [&quot;123&quot;, &quot;234&quot;]

I need to point the &quot;123&quot; for the first dateRange in the dateRangeMapList and &quot;234&quot; to the second one. id.remove(0) always sets only the first id &quot;123&quot; to both the dateRanges. How to approach this ?
    ",1624952529,https://stackoverflow.com/q/68174482,Madhan Kumar,"['neo4j', 'cypher', 'java']"
68172957,Convert Scala neo4j write code to Pyspark in databrick,"I want to convert the below **scala code to pyspark** in databrick.

    `enter code here`%scala
    import org.apache.spark.sql.{SaveMode, SparkSession}
    
    val spark = SparkSession.builder().getOrCreate()
    
    dfnew
    .write.format(&quot;org.neo4j.spark.DataSource&quot;)
    .option(&quot;url&quot;, &quot;bolt:url/&quot;)
    .option(&quot;authentication.type&quot;, &quot;basic&quot;)
    .option(&quot;authentication.basic.username&quot;, &quot;neo4j&quot;)
    .option(&quot;authentication.basic.password&quot;, password)
    .mode(SaveMode.Overwrite)
    .option(&quot;relationship&quot;, &quot;HAS_DEPT&quot;)
    .option(&quot;relationship.save.strategy&quot;, &quot;keys&quot;)
    .option(&quot;relationship.source.labels&quot;, &quot;:Employee&quot;)
    .option(&quot;relationship.source.node.keys&quot;, &quot;employeeCode&quot;)
    .option(&quot;relationship.source.save.mode&quot;, &quot;Match&quot;)
    .option(&quot;relationship.target.labels&quot;, &quot;:Department&quot;)
    .option(&quot;relationship.target.node.keys&quot;, &quot;DeptCode&quot;)
    .option(&quot;relationship.target.save.mode&quot;, &quot;Match&quot;)
    .save()


 I have changed it to bellow python code

  

   

     %python
        import pyspark`
        
        from pyspark.sql import SparkSession`
        
        
        df.select(&quot;employeeCode&quot;,&quot;Name&quot;).write.format(&quot;org.neo4j.spark.DataSource&quot;)\
        .option(&quot;url&quot;, &quot;bolt://url:7687/&quot;)\
        .option(&quot;authentication.type&quot;, &quot;basic&quot;)\
        .option(&quot;authentication.basic.username&quot;, &quot;neo4j&quot;)\
        .option(&quot;authentication.basic.password&quot;, &quot;password&quot;)\
        .mode(&quot;OverWrite&quot;)\
        .option(&quot;relationship&quot;, &quot;HAS_DEPT&quot;)\
        .option(&quot;relationship.save.strategy&quot;, &quot;keys&quot;)\
        .option(&quot;relationship.source.labels&quot;, &quot;:Employee&quot;)\
        .option(&quot;relationship.source.node.keys&quot;, &quot;employeeCode&quot;)\
        .option(&quot;relationship.source.save.mode&quot;, &quot;Match&quot;)\
        .option(&quot;relationship.target.labels&quot;, &quot;:Department&quot;)\
        .option(&quot;relationship.target.node.keys&quot;, &quot;DeptCode&quot;)\
        .option(&quot;relationship.target.save.mode&quot;, &quot;Match&quot;)\
        .save()


but getting the error
org.apache.spark.SparkException: Writing job aborted.
    Py4JJavaError                             Traceback (most recent call last)
    &lt;command-3099912738516896&gt; in &lt;module&gt;
         17 .option(&quot;relationship.target.labels&quot;, &quot;:Department&quot;)\
         18 .option(&quot;relationship.target.node.keys&quot;, &quot;DeptCode&quot;)\
    ---&gt; 19 .option(&quot;relationship.target.save.mode&quot;, &quot;Match&quot;)\
         20 .save()

  



Please help me in converting 



",1624943646,https://stackoverflow.com/q/68172957,rosalini,"['python', 'databricks', 'neo4j', 'pyspark']"
68171225,Forced to use wss:// when behind proxy from https to http,"I have setup a nginx proxy to pass https url to internal http neo4j web. I can reach the neo4j login page without any issue, but I am forced to use the **neo4j+s/bolt+s** interface.

Just wondering how I can configure nginx to remove any ssl related info via proxypass module, in order to login in neo4j with ws, no wss?

Thanks,

Chance
",1624925908,https://stackoverflow.com/q/68171225,Chance,"['neo4j', 'nginx']"
68170198,Neo4j Transaction Management (setting up CPU and memory limit),"I have a Neo4j Enterprise cluster with 20 users simultaneously using the database. Is there a way to limit the resources used for transactions overall &#39;i-e each user can get 1 vCPU and 1GB of RAM, or maybe per user transaction quota? 

Even if there is a way to enforce transaction resources from python drivers, I will be more than happy.

Thanks in ADVANCE&gt;",1624915699,https://stackoverflow.com/q/68170198,rgevil,"['neo4j', 'neo4j-python-driver']"
68168131,"Spring + Neo4J, TransientException brokes connection for the thread","I have Spring-boot application which updates Neo4J database using several threads created by ExecutorService. Because of multithreading, I have locks sometimes which are not problem by theirselves. But each lock generates ```TransientException``` and when I handle this exception and the thread receives new data to process, any subsequent write operation produces org.neo4j.driver.v1.exceptions.ClientException which says what *Cannot run more statements in this transaction because it&#39;s already commited*. Spring transaction is definitely new so it looks like Neo4J JDBC driver broke connection associated with the thread. And calling ```transactionManager.getTransaction(trxDefinition)``` doesn&#39;t start Neo4J transaction actually. How is it possible to handle this? Version of neo4j-jdbc-bolt is ```3.4.0```, **autocommit** is disabled by setting *spring.datasource.hikari.auto-commit=false*. Piece of my code is below:
```
public Node convert(TraversalHandler&lt;ConvertTraversalAttributes&gt; converter, ConvertTraversalAttributes attributes) {
        TransactionTemplate transactionTemplate = new TransactionTemplate(transactionManager);
        transactionTemplate.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRES_NEW);

        return transactionTemplate.execute((trxStatus) -&gt; converter.handle(attributes));
    }
```

The error what I have:
```
com.blueplanet.inventory.neo4j.api.api.ApiException: PreparedStatementCallback; uncategorized SQLException for SQL [

            	with ? as input
				call com.company.inventory.createActivity(input.copyFromId, input.properties) yield node
				return node

        ]; SQL state [null]; error code [0]; org.neo4j.driver.v1.exceptions.ClientException: Cannot run more statements in this transaction, it has been committed; nested exception is java.sql.SQLException: org.neo4j.driver.v1.exceptions.ClientException: Cannot run more statements in this transaction, it has been committed
```

`createActivity` call is the first DB modification call inside the `converter.handle` invocation.",1624903419,https://stackoverflow.com/q/68168131,user641652,"['spring-jdbc', 'spring', 'neo4j', 'locking', 'multithreading']"
68165018,NestJS / Neo4j Read all info from only one table of my DB,"I try to load all information from my db (neo4j). 

this is my person.service.ts 

```
import { Injectable } from &#39;@nestjs/common&#39;;
import { Person } from &#39;./person.entity&#39;;
import { Neo4jService } from &#39;nest-neo4j/dist&#39;;




@Injectable()
export class PersonService {
   constructor( private readonly neo4jService : Neo4jService){}


    getPerson(): Promise &lt;Person[]&gt;{
        const read = this.neo4jService.read(&quot;MATCH (n:Person) RETURN n &quot;)
        return read

    }
    
}

````

This is my person.controller.ts 

```
import { Controller, Get } from &#39;@nestjs/common&#39;;
import { Person } from &#39;./person.entity&#39;;
import { PersonService } from &#39;./person.service&#39;;

@Controller(&#39;person&#39;)
export class PersonController {
    constructor (private  readonly personService: PersonService){}

    @Get()
    async getAllPerson() {
        console.log(&quot;voici les persons de la db&quot;)
        return await this.personService.getPerson();
    }
}
```

The problem is, I don&#39;t really understand what i&#39;m supposed to write inside the .read(). 

Thanks for helping me. ",1624889980,https://stackoverflow.com/q/68165018,Gauthier Cornec,"['neo4j', 'nestjs']"
68149226,Neo4j - Java heap space java.lang.OutOfMemoryError: Java heap space,"I think I need help on Neo4j (Graph database)

I have medium size data (~300 json objects) in JSON file (~250MB). I have to create graph database by using this file.

But I got this an exception:

&gt; Exception in thread &quot;qtp2007561282-66&quot; Exception in thread
&gt; &quot;neo4j.TransactionTimeoutMonitor-29&quot; Exception in thread
&gt; &quot;neo4j.FileIOHelper-12&quot; Exception in thread &quot;neo4j.IndexSampling-17&quot;
&gt; Exception in thread &quot;neo4j.FileIOHelper-20&quot; 2021-06-27
&gt; 03:44:06.265+0000 WARN   Java heap space java.lang.OutOfMemoryError:
&gt; Java heap space Exception in thread &quot;neo4j.StorageMaintenance-28&quot;
&gt; Exception in thread &quot;pool-1-thread-1&quot; Exception in thread
&gt; &quot;neo4j.FileIOHelper-4&quot; Exception in thread &quot;qtp2007561282-65&quot;
&gt; 2021-06-27 03:44:06.280+0000 WARN   Java heap space
&gt; java.lang.OutOfMemoryError: Java heap space Exception in thread
&gt; &quot;neo4j.FileIOHelper-18&quot; 2021-06-27 03:44:06.293+0000 WARN   Java heap
&gt; space java.lang.OutOfMemoryError: Java heap space
&gt; java.lang.OutOfMemoryError: Java heap space
&gt; java.lang.OutOfMemoryError: Java heap space
&gt; java.lang.OutOfMemoryError: Java heap space
&gt; java.lang.OutOfMemoryError: Java heap space
&gt; java.lang.OutOfMemoryError: Java heap space
&gt; java.lang.OutOfMemoryError: Java heap space
&gt; java.lang.OutOfMemoryError: Java heap space
&gt; java.lang.OutOfMemoryError: Java heap space
&gt; java.lang.OutOfMemoryError: Java heap space
&gt; java.lang.OutOfMemoryError: Java heap space 2021-06-27
&gt; 03:44:06.416+0000 ERROR Unexpected error detected in bolt session
&gt; &#39;bolt-16&#39;. Could not initialize class
&gt; org.apache.commons.lang3.exception.ExceptionUtils
&gt; java.lang.NoClassDefFoundError: Could not initialize class
&gt; org.apache.commons.lang3.exception.ExceptionUtils

My Cipher SQL query is something like that:

    with &quot;file:///data.json&quot; as url
    call apoc.load.json(url)
    yield value
    merge (c:Company {register: value.info.register_number})
    on create set c.name = value.info.company_name,
    c.form = value.info.company_form,
    c.register_date = value.info.register_date,
    c.type = value.info.company_type,
    c.number_of_owners = value.info.number_of_owner,
    c.location = value.info.company_location
    foreach (holder in value.stakeHolders | 
    merge (p:Person {person_id : holder.firstname + &quot;.&quot; + holder.lastname})
    on create set p.firstname = holder.lastname,
    p.lastname = holder.firstname,
    p.country = holder.country
    create (holder1:RegisterDate {date: holder.date})
    merge (p)-[:has]-&gt;(holder1)-[:holder_of]-&gt;(c)
    )
    foreach (manager in value.ceo | 
    merge (m:Person {person_id: manager.lastname + &quot;.&quot; + manager.firstname})
    on create set m.firstname = manager.firstname,
    m.lastname = manager.lastname,
    m.country = manager.country
    create (manager1:RegisterDate {
    position: manager.position,
    date: manager.date
    })
    merge (m)-[:has]-&gt;(manager1)-[:has_position]-&gt;(c)
    )
    foreach (area in value.area |
    merge (a:ActivityArea {code: area.code})
    on create set a.title = area.title
    create (area1:RegisterDate {
    date: area.date
    })
    merge (c)-[:has]-&gt;(area1)-[:operation]-&gt;(a))


What should I do? please help me!",1624781715,https://stackoverflow.com/q/68149226,Nyamkhuu Buyanjargal,"['database', 'graph', 'neo4j', 'graph-databases']"
68145389,Neo4j import where field has multiple values,"I&#39;m importing NER tag, where each tag field for a particular document, has multiple values, e.g.

Doc_id
LOC: mo, ny, nj
PERSON: bill, mary

I want to link docs on the LOC amd PERSON fields.

What is the correct way to do this?
Thanks",1624733436,https://stackoverflow.com/q/68145389,Steph van Schalkwyk,"['neo4j', 'ner']"
68138214,"Sending Ionic push notifications, neo4j","I am developing an Ionic application, which has a NestJS backend. I want to send push notifications to the user, when he receives a friend request, or something similar, but my main problem is I am not using firebase (which seems to handle them well), I am using Neo4j. Is there a simple way I could handle push notifications in my case? 

Also, I am not an expert in push notifications, so I was thinking, is there a way to send a push notification from my NestJS backend, when a certain endpoint/method is executed?",1624666900,https://stackoverflow.com/q/68138214,qlabfgerkaSmurf,"['push-notification', 'ionic-framework', 'neo4j', 'nestjs']"
68133209,Create nodes if optional match returns null,"All the nodes I&#39;ll be using have unique constraints associated to them. 

I tried to create new nodes like this (I thought about MERGE so it would not create the node if it already exists):

    MERGE (n:url{url_addr:&#39;test.com&#39;})-[:FROM_DEVICE]-&gt;(o:device{mode:&#39;iphone&#39;})

And the node already exists it returns this error:

    Node(21) already exists with label `url` and property `url_addr` = &#39;test.com&#39;

It was obvious, since I didn&#39;t match them beforehand, so I did it in order to just pass the results properties:

    MATCH (n:url{url_addr:&#39;test.com&#39;}), (o:device{mode:&#39;iphone&#39;})
    MERGE (n)-[:FROM_DEVICE]-&gt;(o)

But in case any of this records do not exist new nodes will not be created.

So I thought about using OPTIONAL MATCH, since it would replace any non-existent value with null, but this means it would also replace the properties I passed with null values.

    OPTIONAL MATCH (n:url{url_addr:&#39;test.com&#39;}) RETURN n
    MERGE n-[:FROM_DEVICE]-&gt;(o:device{mode:&#39;iphone&#39;})

It returned this error:

    Failed to create relationship `  REL87(d65d30eb-65f5-4460-b166-15996622cf1b)`, node `n` is missing. If you prefer to simply ignore rows where a relationship node is missing, set &#39;cypher.lenient_create_relationship = true&#39; in neo4j.conf

So I thought about using CASE statements in order to first verify if the match would return null and then create the node to define the relationship, but things didn&#39;t work well:

    OPTIONAL MATCH (n:url{url_addr:&#39;test.com&#39;})
    WITH n as test
    RETURN CASE
        WHEN test IS NULL THEN CREATE (:url{url_addr:&#39;test.com&#39;})
    END

This happens:

```
Invalid input &#39;{&#39;: expected
  &quot;!=&quot;
  &quot;%&quot;
  &quot;)&quot;
  &quot;*&quot;
  &quot;+&quot;
  &quot;,&quot;
  &quot;-&quot;
  &quot;.&quot;
  &quot;/&quot;
  &quot;:&quot;
  &quot;&lt;&quot;
  &quot;&lt;=&quot;
  &quot;&lt;&gt;&quot;
  &quot;=&quot;
  &quot;=~&quot;
  &quot;&gt;&quot;
  &quot;&gt;=&quot;
  &quot;AND&quot;
  &quot;CONTAINS&quot;
  &quot;ENDS&quot;
  &quot;IN&quot;
  &quot;IS&quot;
  &quot;OR&quot;
  &quot;STARTS&quot;
  &quot;XOR&quot;
  &quot;[&quot;
  &quot;^&quot; (line 4, column 51 (offset: 135))
&quot;        WHEN CASE IS NULL THEN CREATE (a:cookie_id{url:&#39;test.com&#39;})&quot;
                                                   ^
```

Removing the properties of the node does not help.",1624633669,https://stackoverflow.com/q/68133209,pzvkn,"['database', 'neo4j', 'graph-databases', 'cypher']"
68131505,java.lang.NoSuchMethodError: org.springframework.data.neo4j.repository.config.Neo4jRepositoryConfigurationExtension," 

    springBootVersion = &#39;2.3.4.RELEASE&#39;
    dependency(&quot;org.springframework.data:spring-data-neo4j:5.2.0.RELEASE&quot;)
    dependency(&quot;org.neo4j:neo4j-ogm-core:3.2.24&quot;)
    dependency(&quot;org.neo4j:neo4j-ogm-bolt-driver:3.2.24&quot;)
    dependency group: &#39;org.neo4j.driver&#39;, name: &#39;neo4j-java-driver&#39;, version: &#39;4.1.1&#39;
         

*java.lang.NoSuchMethodError: org.springframework.data.neo4j.repository.config.Neo4jRepositoryConfigurationExtension.registerWithSourceAndGeneratedBeanName(Lorg/springframework/beans/factory/support/AbstractBeanDefinition;Lorg/springframework/beans/factory/support/BeanDefinitionRegistry;Ljava/lang/Object;)Ljava/lang/String;
	at org.springframework.data.neo4j.repository.config.Neo4jRepositoryConfigurationExtension.registerWithGeneratedNameOrUseConfigured(Neo4jRepositoryConfigurationExtension.java:239)
	at org.springframework.data.neo4j.repository.config.Neo4jRepositoryConfigurationExtension.registerBeansForRoot(Neo4jRepositoryConfigurationExtension.java:198)
	at org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn(RepositoryConfigurationDelegate.java:114)
	at org.springframework.data.repository.config.RepositoryBeanDefinitionRegistrarSupport.registerBeanDefinitions(RepositoryBeanDefinitionRegistrarSupport.java:85)
	at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.lambda$loadBeanDefinitionsFromRegistrars$1(ConfigurationClassBeanDefinitionReader.java:358)
	at java.base/java.util.LinkedHashMap.forEach(LinkedHashMap.java:684)
	at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.loadBeanDefinitionsFromRegistrars(ConfigurationClassBeanDefinitionReader.java:357)
	at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.loadBeanDefinitionsForConfigurationClass(ConfigurationClassBeanDefinitionReader.java:145)
	at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.loadBeanDefinitions(ConfigurationClassBeanDefinitionReader.java:117)
	at org.springframework.context.annotation.ConfigurationClassPostProcessor.processConfigBeanDefinitions(ConfigurationClassPostProcessor.java:328)
	at org.springframework.context.annotation.ConfigurationClassPostProcessor.postProcessBeanDefinitionRegistry(ConfigurationClassPostProcessor.java:233)
	at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanDefinitionRegistryPostProcessors(PostProcessorRegistrationDelegate.java:273)
	at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:93)
	at org.springframework.context.support.AbstractApplicationContext.invokeBeanFactoryPostProcessors(AbstractApplicationContext.java:694)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:532)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:140)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:759)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:395)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:327)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1255)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1243)*
",1624626531,https://stackoverflow.com/q/68131505,Apeksha Barve,"['spring', 'java', 'neo4j']"
68129764,For the given multiple nodes find a node,"Without reading all the given User nodes, is there a way to find it by using the given Exam nodes?

Example:

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/jQmQa.png

For the given Exam nodes `mtech` and `mca`, how would I find the User node?",1624618232,https://stackoverflow.com/q/68129764,Karan Dhir,"['neo4j-apoc', 'neo4j', 'cypher']"
68124416,How can I configure Rails with Neo4j in an existing repo?,"I&#39;m currently trying to re-configure my database to use Neo4j as opposed to Postgres and I&#39;m having issues with configuration. 

I&#39;ve adding the ```neo4j``` gem into my gemfile as well as ```neo4j-core```, 
 ```neo4j-ruby-driver```, and ```neo4j-rake_tasks```. 
I&#39;ve tried running ```rake neo4j:install[community-latest]``` to generate the Neo4j instance but it throws me this – ```zsh: no matches found: neo4j:install[community-latest]``` After listing all rake tasks this rake task does not appear to be present despite every online resource demonstrating this as the way to generate the DB. 
I&#39;m currently running on rails version ```6.1.3.2``` and ruby version ```2.6.6```

These are some of the resources I have been using. 
1. https://neo4jrb.readthedocs.io/en/v10.0.1/Setup.html
2. https://diatomenterprises.com/using-neo4j-with-ruby-on-rails/

Many thanks in advance &#128591;",1624585157,https://stackoverflow.com/q/68124416,Yehuda Bortz,"['ruby-on-rails', 'ruby', 'neo4j', 'neo4j.rb']"
68122998,Is apoc.rel.startNode removed from apoc 4.2.0.0?,"I have neo4j 4.2.1 &amp; apoc 4.2.0.0 installed on my mac. When I run the example on https://neo4j.com/labs/apoc/4.2/overview/apoc.rel/apoc.rel.startNode/ in neo4j desktop, I get the following error:
Unknown function &#39;apoc.rel.startNode&#39; (line 4, column 8 (offset: 204))
&quot;RETURN apoc.rel.startNode(rel) AS startNode&quot;

I am able to successfully run the example on https://neo4j.com/labs/apoc/4.2/overview/apoc.rel/apoc.rel.type/

Does anyone know what is wrong? Thanks!",1624570666,https://stackoverflow.com/q/68122998,kemaru,"['neo4j-apoc', 'neo4j']"
68121539,Use the same database for Neo4j Community and Neo4j Desktop,"I am an inexperienced user of Neo4j Community.  I load data from csv files using Python and py2neo.  I would like to use Bloom and so installed Neo4j Desktop.  How can I tell Desktop to use the database made in Community?

Community draws from the default location C:\neo4j\neo4j-community-4.2.7\data\databases

Desktop appears to draw from C:\Users\myname\.Neo4jDesktop\relate-data\dbmss\dbms-20xxxxxx-d6e8-xxxx-ace2-334866xxxxx\data\databases

The Desktop neo4j.conf file appears to be here

C:\Users\myname\.Neo4jDesktop\relate-data\dbmss\dbms-20xxxxxx-d6e8-xxxx-ace2-334866xxxxx\conf

I changed this line in the Desktop conf file to
dbms.directories.data=C:/neo4j/neo4j-community-4.2.7/data/databases

That did something because it made me log in when I restarted Desktop.

When I click on Settings in Desktop, it still shows: 

C:\Users\myname\.Neo4jDesktop under the &quot;Datapath&quot; box

How do I make Desktop use the same database as the Community edition?",1624561814,https://stackoverflow.com/q/68121539,e25548,"['graph', 'neo4j']"
68120964,Issues using UNWIND to load data to Neo4j using python,"I am trying to load neo4j db using CSV file from python. I am able to connect and load the data without using UNWIND operation. But I want to use it for a faster load. I am getting the following error upon trying to use it.

&gt; {code: Neo.ClientError.Statement.SyntaxError} {message: Invalid input &#39;&#39;: expected whitespace, &#39;.&#39;, node labels, &#39;[&#39;, &#39;^&#39;, &#39;*&#39;, &#39;/&#39;, &#39;%&#39;, &#39;+&#39;, &#39;-&#39;, &quot;=~&quot;, IN, STARTS, ENDS, CONTAINS, IS, &#39;=&#39;, &#39;~&#39;, &quot;&lt;&gt;&quot;, &quot;!=&quot;, &#39;&lt;&#39;, &#39;&gt;&#39;, &quot;&lt;=&quot;, &quot;&gt;=&quot;, AND, XOR, OR or AS (line 1, column 16 (offset: 15))
&quot; UNWIND {data1} as node&quot;
                ^}
I have the following code where I am using UNWIND. This is just a small sample I am trying to test out with.
```
cq1=&quot;&quot;&quot; UNWIND {data1}​ as node
                        MERGE (n:Person {id : node.ID}​)
                            SET
                               n.gender = node.GENDER&quot;&quot;&quot;

list_dicts_data1 = [{&quot;ID&quot;: &#39;1&#39;,&quot;GENDER&quot;: &#39;Male&#39;}]
graph.run(cq1, data1 = list_dicts_data1)
```

Any suggestions what is causing this error and how do I fix it?",1624559037,https://stackoverflow.com/q/68120964,RB17,"['python-3.x', 'syntax-error', 'neo4j', 'py2neo']"
68117332,Deciding whether or not to pass an argument to a method in a using statement,"I use the Neo4J .NET driver to get some data from a Neo4J database. I need to create a session in a `using` block, however, if I am working on a specific version of database, I need to also pass one argument to a method in the `using` block. Here is code without argument:

    using (var conn = GraphDatabase.Driver(connectionString, AuthTokens.Basic(user, pass)).Session())
    {
        // ...some logic...
    }

And with argument:

    using (var conn = GraphDatabase.Driver(connectionString, AuthTokens.Basic(user, pass)).Session(SessionConfigBuilder.ForDatabase(db)))
    {
        // ...some logic...
    }

I need to call one of mentioned `using` blocks in a method depending on the version passed as an argument. I am wondering how I can solve this problem? Create a custom object which returns a session, put the logic in a private method and create two ifs with either of `using` in each of them?
",1624543595,https://stackoverflow.com/q/68117332,SzK,"['.net', 'c#', 'neo4j']"
68112829,Neo4j constraint - value limits and limitations,"## Environment Info ##

Currently using;
- v4.2.3 Community
- Attempting the following via the browser interface
- No use of add-ins

## What I am trying to achieve ##
Looking to create a constraint for a unique value, using the following code
CREATE CONSTRAINT constraint_urivalue IF NOT EXISTS ON (u:uri) ASSERT u.value IS UNIQUE

## The Error ##
&gt;Property value is too large to index , please see index documentation for limitations. Index: Index( id=9, name=&#39;constraint_urivalue&#39;, type=&#39;UNIQUE BTREE&#39;, schema=(:uri {value}), indexProvider=&#39;native-btree-1.0&#39; ), entity id: 1752159, property size: 8349, value: [String(&quot;https://app.example.com/r?target=5fdb4af6c9e87c0045712071&amp;t=AFwhZf1jxnSLg3hAmBOGQE4BcG....

After searching through the knowledgebase, I found [this article][1] which explains that the size limit is 8167 bytes (and instructions how to work out the size of any particular value).
However this article has left me with the following questions about proceeding.

## The Question(s) ##

 1. Is this node the only size limitation causing this error, or does neo4j simply stop after the first problem and return that error without checking the remaining conflictions?
 2. If I delete this particular node, and then create the index (assuming there is no other confliction as per Q1). Then later on I tried to add this node or a similar sized node, into the database, what would happen (e.g. truncate my value, break the index, error and not create the node, etc.) ?
 3. Any workarounds or solutions you may have thought of - all thoughts appreciated!


  [1]: https://neo4j.com/developer/kb/index-limitations-and-workaround/",1624525830,https://stackoverflow.com/q/68112829,Simon,"['neo4j', 'unique-constraint']"
68100990,Neo4J Cypher - Find integer attributes,"## Background ##

I have nodes which have been recording a specific attribute as LONG and I want them to be recorded as INT - I have amended my system&#39;s input code to now record them as INT, however I am looking to check Neo4J for anomalies.

## The Data ##

I now have a mix of data, where some have been created as &quot;int&quot; some as STR and some are even null (which is ok in my data-structure)

    CREATE (n:logs{value: &quot;example&quot;, records: &quot;30&quot;})
        , (n:logs{value: &quot;example&quot;, records: 30})
        , (n:logs{value: &quot;example&quot;, records: null})
    RETURN n

## The Problem ##

I tried to verify if the system is now writing the &quot;records&quot; attribute as INT rather than string, so I tried the following query;

    WITH datetime(&quot;2021-06-18T06:00:00&quot;).epochMillis AS threshold
    MATCH(n:logs)
    WHERE n.records &lt;&gt; tointeger(n.records)
    COUNT(n)

This returns 1 - my *NULL* record, for some reason. But NOT the STR, as I would have expected.

I then try the following (18th June being the date of the update to my input system); 

    WITH datetime(&quot;2021-06-18T06:00:00&quot;).epochMillis AS threshold
    MATCH(n:logs)
    WHERE n.records = tointeger(n.records)
    COUNT(n)

And this returns 0 - which again, I am not sure why.

So my question is, what am I doing wrong and how can I get to where I need to go. Which is ultimately to;
1) Check the system is saving as INT going forwards
2) Change all the pre-existing records from STR to INT.

I assume for #2 is will be something like

    MATCH(n:logs)
    WHERE n.records &lt;&gt; tointeger(n.records)
    SET n.records = tointeger(n.records)



## Additional Info ##
- Community edition
- Version X.x.x
- No addins",1624455673,https://stackoverflow.com/q/68100990,Simon,"['neo4j', 'cypher']"
68098134,How to run batch transactions in neo4j,"We are working on a recommendation engine use case at the production level.

We had a use case to fetch products sorted based on geography(nearest first), we thought to make use of spatial functions like distance and point to sort them.
For that, we need latitude and longitude properties in Product nodes, which we don’t have yet, but we have a postal address, so we figured, we’ll make use of call apoc.spatial.geocodeOnce, fetch, and set latitude and longitude properties in all the Product nodes. 

Well, a bit of problem is it’s becoming an expensive operation, we have around 5000 product nodes, it’s taking an average 1000 ms to update each node, by that calculation, on a single core, it’d take around 90 min to update all the nodes. We are really curious to know if there’s a smarter way to handle the transaction in chunks(maybe, updating 500 products in one tx then, next 500…  and so on). We thought, apoc.periodic.iterate is a way to go but we are looking for suggestions on how do we solve this problem efficiently?

P.S - When we tried out a few apoc.spatial.geocodeOnce calls to a couple of products with the postal address we have in our db, we saw a couple of calls returned no result, what could be the possible reasons for this? (maybe, we don’t have standardized postal addresses for such products? if so how shall we address the problem, shall we make use of google geocode API for those products or there are other smarter ways embedded in neo4j)

Our query below for reference:

CALL apoc.periodic.iterate(
  &quot;MATCH (p:Product) return p&quot;, 
  &quot;CALL apoc.spatial.geocodeOnce(p.postal_address) YIELD location SET p.latitude=location.latitude, p.longitude=location.longitude&quot;,
  {batchSize:500, iterateList:true, parallel:true}
)",1624444510,https://stackoverflow.com/q/68098134,Vikas Pandey,"['neo4j', 'node.js', 'batch-processing']"
68096739,Full text seach with endless wildcard,"I&#39;m trying to get a full text match with wild cards

    CALL db.index.fulltext.queryNodes(&#39;index_name&#39;, &#39;&quot;The Blues&quot;&#39;)
    YIELD node
    WITH node AS node
    MATCH (node)&lt;-[:LAST]-(blue:Blues)
    RETURN blue

This is the current query, this returns only the nodes which have the exact match of &quot;The Blues&quot; somewhere within the index.
I&#39;d like to add an endless wildcard to the query.

    CALL db.index.fulltext.queryNodes(&#39;index_name&#39;, &#39;&quot;The Blu*&quot;&#39;)
        YIELD node
        WITH node AS node
        MATCH (node)&lt;-[:LAST]-(blue:Blues)
        RETURN blue

This should ensure that when I&#39;m searching and I only pass &quot;The Blu&quot; I&#39;d still get everything with &quot;The blues&quot; in the index.
I&#39;ve not been able to find how to directly combine these two functionalities.
When the wildcard is added it doesn&#39;t return the node with &quot;The Blues&quot;.",1624438876,https://stackoverflow.com/q/68096739,Stef van Stipdonk,"['full-text-search', 'neo4j', 'wildcard']"
68091098,Count the number of neighbors for each node in Cypher,"I want to create a new property for each node that is the number of nodes they are connected to with a relationship. Like, for each actor in the example graph have the count of movies they are in.",1624398629,https://stackoverflow.com/q/68091098,Daniel Darabos,"['neo4j', 'cypher']"
68088117,Clarification on order and size of network,"In social graphs is it common to have the number of nodes to be way less than the number of edges?

In my analysis of a twitter network I got results like this

 **nodes = 20,000**
## edges = 335,000

How can I interpret this **huge gap** between the numbers?
",1624382303,https://stackoverflow.com/q/68088117,paulowe,"['twitter', 'data-science', 'bigdata', 'neo4j', 'graph-data-science']"
68086639,NestJS / TypeOrm / Neo4j : Nest can&#39;t resolve dependencies of the NEO4J_DRIVER,"I try to run my NestJs/TypeOrm with Neo4j db but i&#39;ve got an error : 

Nest can&#39;t resolve dependencies of the NEO4J_DRIVER (?). Please make sure that the argument NEO4J_OPTIONS at index [0] is available in the Neo4jModule context.

I don&#39;t understand where it come from. 

This is my app.module 
```typescript
import { Module } from &#39;@nestjs/common&#39;;
import { AppController } from &#39;./app.controller&#39;;
import { AppService } from &#39;./app.service&#39;;
import { Neo4jModule } from &#39;nest-neo4j&#39;
import { PersonModule } from &#39;./person/person.module&#39;;


@Module({
  imports: [
    Neo4jModule.forRootAsync({
      scheme: &quot;neo4j+s&quot;,
      host: &quot;db-sp8xxaunnz13icv892y5.graphenedb.com&quot;,
      port: 24786,
      username: &#39;neo4j&#39;,
      password: &#39;ingrid-ticket-capital-spirit-reform-6035&#39;
    }),
    PersonModule,

  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```

This is my person.module.ts

```typescript
import { Module } from &#39;@nestjs/common&#39;;
import { PersonService } from &#39;./person.service&#39;;
import { PersonController } from &#39;./person.controller&#39;;
import { TypeOrmModule } from &#39;@nestjs/typeorm&#39;;
import { Person } from &#39;./person.entity&#39;;
import { Neo4jModule } from &#39;nest-neo4j/dist&#39;;
import { PersonRepository } from &#39;./person.entityrepository&#39;;

@Module({
  imports: [
    TypeOrmModule.forFeature([PersonRepository]),
    
      ,
  ],

  providers: [
    PersonService
  ],

  controllers: [
    PersonController
  ]
})
export class PersonModule {}
```

Thanks for helping me !",1624376259,https://stackoverflow.com/q/68086639,Gauthier Cornec,"['nestjs', 'typeorm', 'neo4j']"
68086237,"Ne04j Graph Nodes, Expand a spanning tree but stop at specific node (but don&#39;t stop for other nodes)","I have the following setup

1. Person is part of an organisation
2. Person attends meeting
3. Meeting is held in a location

- More than one person can attend a meeting
- More than one person can be part of same organisation
- Persons from different organisation can attend same meeting
- Multiple meeting can be held at same location

Of all the locations, there is a very oft-used one (the home base).

Meaning that when I &quot;Expand a spanning Tree&quot;, and when I hit that location, my graph &quot;explodes&quot;

Example code I use:

    MATCH (p:Person {pcode: 123456})
    MATCH (terminator:Location) WHERE terminator.LocCode = 1
    
    CALL apoc.path.spanningTree(p, {
    minLevel: 1,
    maxLevel: 3,
    terminatorNodes: terminator
    })
    YIELD path
    RETURN path
    ;

My hope when using terminatorNodes is that the path would stop at that particular node and ignore everything that&#39;s &quot;beyond&quot; .. but that&#39;s not what happens, in actual fact I see all the nodes &quot;beyond&quot;

I have tried using endNodes too, but there it looks like the code bombs out as soon as it bumps into that particular node and stops spanning trees everywhere else too!

I would like to obtain the same effect for a particular organisation too (mine!) but one step at a time!

What I am really trying to achieve is to retrieve all Persons connected to a starting person via meetings.
I.e. &quot;Start Person&quot; A attends a meeting with another 3 people from different organisations, then I want to see those Persons returned, and their organisation, and then all the people linked to their organisation.
The above is just a start, in the sense that I have other Node labels to deal with but with the same aim.










",1624374856,https://stackoverflow.com/q/68086237,Bertrand Leroy,"['cypher', 'graph-databases', 'spanning-tree', 'neo4j']"
68084680,What is IndexError returned by Py2neo?,"When I run a cypher query using Py2neo, I got the following error message. I don&#39;t really understand what it means. I am guessing that a connection to the database is closed or broken for some reasons. Could you help me understand this message?
To be clear, this is a part of my code. ```neo4jDB``` is a graph object. ```cypher_query``` is a string of a cypher.  ```neo4jDB.run(cypher_query).data()``` returns a list of dictionaries. 

```cypher_query``` looks like this ```&#39;MATCH (n:node) &lt;-[:relationship]-(another:another node) WHERE n.id=&#39;12345&#39; AND another.id=&#39;12345&#39; RETURN  another.x, another.y, another.z, another.w limit 1&#39;```

A part of my code
```
if len(neo4jDB.run(cypher_query).data()) == 0:
        no_records.append(id)
```



Error Message 
```
IndexError                                Traceback (most recent call last)
~\anaconda3\lib\site-packages\py2neo\client\__init__.py in acquire(self, force_reset, can_overfill)
    791                 # Plan A: select a free connection from the pool
--&gt; 792                 cx = self._free_list.popleft()
    793             except IndexError:

IndexError: pop from an empty deque

During handling of the above exception, another exception occurred:

NotImplementedError                       Traceback (most recent call last)
&lt;ipython-input-439-a052dd2ba35c&gt; in &lt;module&gt;
----&gt; 7     if len(neo4jDB.run(cypher_query).data()) == 0:
      8         no_records.append(id)

~\anaconda3\lib\site-packages\py2neo\database.py in run(self, cypher, parameters, **kwparameters)
    403         :return:
    404         &quot;&quot;&quot;
--&gt; 405         return self.auto().run(cypher, parameters, **kwparameters)
    406 
    407     def evaluate(self, cypher, parameters=None, **kwparameters):

~\anaconda3\lib\site-packages\py2neo\database.py in run(self, cypher, parameters, **kwparameters)
    976                 result = self._connector.run(self.ref, cypher, parameters)
    977             else:
--&gt; 978                 result = self._connector.auto_run(cypher, parameters,
    979                                                   graph_name=self.graph.name,
    980                                                   readonly=self.readonly)

~\anaconda3\lib\site-packages\py2neo\client\__init__.py in auto_run(self, cypher, parameters, pull, graph_name, readonly)
   1336             cx = self._acquire_ro(graph_name)
   1337         else:
-&gt; 1338             cx = self._acquire_rw(graph_name)
   1339         try:
   1340             result = cx.auto_run(cypher, parameters, graph_name=graph_name, readonly=readonly)

~\anaconda3\lib\site-packages\py2neo\client\__init__.py in _acquire_rw(self, graph_name)
   1238                 log.debug(&quot;Using connection pool %r&quot;, pool)
   1239                 try:
-&gt; 1240                     cx = pool.acquire()
   1241                 except (ConnectionUnavailable, ConnectionBroken):
   1242                     self.prune(pool.profile)

~\anaconda3\lib\site-packages\py2neo\client\__init__.py in acquire(self, force_reset, can_overfill)
    797                     # ConnectionUnavailable exception, which
    798                     # should bubble up to the caller.
--&gt; 799                     cx = self.connect()
    800                     if cx.supports_multi():
    801                         self._supports_multi = True

~\anaconda3\lib\site-packages\py2neo\client\__init__.py in connect(self)
    743             cx = self._opened_list.popleft()
    744             if cx.closed or cx.broken:
--&gt; 745                 self._bytes_sent += cx.bytes_sent
    746                 self._bytes_received += cx.bytes_received
    747             else:

~\anaconda3\lib\site-packages\py2neo\client\__init__.py in bytes_sent(self)
    209     @property
    210     def bytes_sent(self):
--&gt; 211         raise NotImplementedError
    212 
    213     @property

NotImplementedError: 

```",1624369412,https://stackoverflow.com/q/68084680,Sherlock_Hound,"['python', 'py2neo', 'neo4j']"
68082683,When to use labels and relation types indexing from Neo4j 4.3?,"I&#39;ve [already asked it on the Neo4j forum][1], hoping for more success here.

[1]: https://community.neo4j.com/t/when-to-use-labels-and-relation-types-indexing-from-neo4j-4-3/40187

In NODES 2021, label and type indices, available from the 4.3 server, were presented. However, I haven&#39;t clear when I should or should not use this kind of indices.

Naively, I tend to think that in most cases, there will be searches like `MATCH ( n: ) - [r:] -&gt; (...)`. So, I&#39;d say it&#39;s good to have them in most cases.

But maybe I&#39;m wrong? Maybe they benefit more certain types of queries only?

Thanks in advance for your answer.",1624361064,https://stackoverflow.com/q/68082683,zakmck,"['indexing', 'neo4j']"
68082323,Return nodes together with relations,"I&#39;m playing with `Cypher` and `Neo4j` a bit and I created a simple graph:

    CREATE (j: person { name: &quot;james&quot; })
    CREATE (m: person { name: &quot;mary&quot; })
    CREATE (j)&lt;-[:friends_with]-(m)

If I return all the nodes:

    MATCH (m) RETURN m

in the graph view I get:

[![enter image description here][1]][1]

but the response JSON is:

    [
      {
        &quot;keys&quot;: [
          &quot;m&quot;
        ],
        &quot;length&quot;: 1,
        &quot;_fields&quot;: [
          {
            &quot;identity&quot;: {
              &quot;low&quot;: 3,
              &quot;high&quot;: 0
            },
            &quot;labels&quot;: [
              &quot;person&quot;
            ],
            &quot;properties&quot;: {
              &quot;name&quot;: &quot;james&quot;
            }
          }
        ],
        &quot;_fieldLookup&quot;: {
          &quot;m&quot;: 0
        }
      },
      {
        &quot;keys&quot;: [
          &quot;m&quot;
        ],
        &quot;length&quot;: 1,
        &quot;_fields&quot;: [
          {
            &quot;identity&quot;: {
              &quot;low&quot;: 4,
              &quot;high&quot;: 0
            },
            &quot;labels&quot;: [
              &quot;person&quot;
            ],
            &quot;properties&quot;: {
              &quot;name&quot;: &quot;mary&quot;
            }
          }
        ],
        &quot;_fieldLookup&quot;: {
          &quot;m&quot;: 0
        }
      }
    ]

which contains the list of nodes, but no information about the relationship between nodes.

Is it possible to also get the full graph/the relationship between nodes if certain returned nodes have relationships defined between one another?

  [1]: https://i.stack.imgur.com/yhdUw.png",1624359619,https://stackoverflow.com/q/68082323,Jacob Krieg,"['cypher', 'neo4j']"
68081119,Neo4jrb Inheritance and scope problem on calling relationships,"I&#39;m using Neo4jrb with Rails and I&#39;m trying to exploit as much as possible the QueryProxy chaining methods to build complex query but I&#39;m stuck when considering nodes with multiple labels due to inheritance. The following raw example can give you and idea:
```lang-rb
class Person
  include ActiveGraph::Node
  property :name, type: String
  property :gender, type: String

  has_many :out, :socials, type: :HAS_ACCOUNT, model_class: &#39;Social&#39;, unique: true
end

class Social
  include ActiveGraph::Node
  # nothing relevant
end

class Facebook &lt; Social
  # Inheriting from Social, the labels for Facebook nodes are [:Social, :Facebook]

  property :name, type: String
  # other properties
  
  has_many :out, :friends, type: :FRIENDS_WITH, model_class: &#39;Facebook&#39;, unique: true
end

class Instagram &lt; Social
    # Inheriting from Social, the labels for Instagram nodes are [:Social, :Instagram]

  # some property and relationship
end
```
A simple working query is to get/query the name of the Facebook account of a Person: 
```lang-rb
Person.as(:p).socials.where(name: &quot;Someone&quot;)
```
Which return the following cypher query:
```lang-cypher
Person#socials 
  MATCH (n:`Person`)
  MATCH (n)-[rel1:`HAS_ACCOUNT`]-&gt;(result_socials3:`Social`)
  WHERE (result_socials3.name = $result_socials3_name)
  RETURN result_socials3 | {:result_socials3_name=&gt;&quot;Someone&quot;}
```
So it seems to be no errors when query ***properties*** of a derived class (Facebook) of the model_class specified in the Person relationship.

However, when I try to query ***relationship*** defined in Facebook, activegraph doesn&#39;t find it and returns the following error:
```lang-rb
Person.as(:p).socials.friends
# OR
Person.as(:n).socials.branch { friends&#160;} 

# ERROR
`method_missing&#39;: undefined method `friends&#39; for #&lt;AssociationProxy Person#socials []&gt; (NoMethodError)
```
Questions:
- Why I can query on the *properties* of a derived class of the one specified on *model_class* in Person relationships, but I cannot query on its *relationships*
- Is there a way to query on the derived class relationships? Or maybe change temporarily the scope?
- Is there a way to specify the label of the ending node of an association? Like, when I query for *Person.socials*, can I defined ending labels other than &#39;Social&#39; for the AssociationProxy Person#social? 

I&#39;ve already tried some method like &quot;scoping&quot;, &quot;branch&quot; and &quot;as_models&quot; but as far as I know none of them works.

Note: The following cypher query works:
```lang-cypher
MATCH (p:Person)
MATCH (p)-[:HAS_ACCOUNT]-&gt;(s:Social)
MATCH (s)-[:FRIENDS_WITH]-&gt;(f)
RETURN p.name
```",1624354589,https://stackoverflow.com/q/68081119,Sbunzini,"['neo4jrb', 'cypher', 'neo4j', 'ruby-on-rails', 'ruby']"
68071259,Recommendations for a Graphical DBMS using Aerospike as backend?,"Right now what I&#39;m doing is:

- Write some data in 3 different tables

- Perform some reads to check if new values exists in this tables

- Depending which table it finds the data the application may write some relation to this data on the other tables.

It&#39;s not complicated, but the data volume will be big, probably 20mil+ values/day.

Initially I thought about using Neo4J as a Graphical DB, but I found the learning curve a bit too steep and to be fair the Graphical advantages of this DB would not be used right now, only in about 5-6 months.

Also I really need something **FAST**. After some research I decided to use Aerospike as the Backend Storage, but I found really difficult to find an appropriate DBMS that can create Graphic Relationships.

With Aerospike I can perform about 20,000 writes-per-second, and is really easy to set a expiration date for this data.

Do you know any Graphical DBMS to use with Aerospike?

If there&#39;s none, or the options are not really on a production-ready state, would anyone know a DB Backend/Graphical DBMS combo that can perform similarly? I&#39;m targeting 6,000 writes-per-second as a minimum right now.

Thanks",1624291610,https://stackoverflow.com/q/68071259,pzvkn,"['nosql', 'aerospike', 'database-design', 'neo4j', 'database']"
68069656,Create &quot;[FOLLOW]&quot; relation between multiple :Users who &quot;[:RATED]&quot; arbitrary :Movies,"Graph that I want create between already existing nodes

[![][1]][1]


  [1]: https://i.stack.imgur.com/BEFeJ.jpg

I want to create FOLLOW relationship between multiple users in my database who have rated any movie. I have no idea how to do this with a single and simple query. I tried the following query and it simply failed with some JAVA heap space error.

    MATCH (m1:Movie)&lt;-[r1:RATED]-(elisha:User), (m2:Movie)&lt;-[r2:RATED]-(garfield:User),(m3:Movie)&lt;-[r3:RATED]-(hermann:User),(m4:Movie)&lt;-[r4:RATED]-(lester:User),
    (m5:Movie)&lt;-[r5:RATED]-(casper:User),(m6:Movie)&lt;-[r6:RATED]-(lester:User),
    (m7:Movie)&lt;-[r7:RATED]-(alaa:User),(m8:Movie)&lt;-[r8:RATED]-(jake:User),
    (m9:Movie)&lt;-[r9:RATED]-(odie:User),(m10:Movie)&lt;-[r10:RATED]-(pink:User)
    CREATE (elisha)-[:FOLLOW]-&gt;(garfield),
    (garfield)-[:FOLLOW]-&gt;(hermann),
    (garfield)-[:FOLLOW]-&gt;(lester),
    (lester)-[:FOLLOW]-&gt;(elisha),
    (casper)-[:FOLLOW]-&gt;(pink),
    (alaa)-[:FOLLOW]-&gt;(jake),
    (jake)-[:FOLLOW]-&gt;(garfield),
    (jake)-[:FOLLOW]-&gt;(odie)


I am new to Neo4j and Cypher query language so kindly help me understand this.",1624285369,https://stackoverflow.com/q/68069656,Umair Ahmed,"['cypher', 'neo4j']"
68068382,Find all nodes where property does NOT match condition,"I&#39;m trying to find a way of returning nodes where the value or a property does not meet a certain condition. 

I tried to create a query that will check whether there are any nodes that don&#39;t match the nodes in my database (if one has been created on bloom on via the Neo4j browser). The query should delete any nodes that aren&#39;t in the DB. I want it to do this by checking whether the nodeId exists on a node in the database.
```
        try {
            const result = await neo4j.executeCypherWriteQuery(
                `
                        MATCH (node:Node)
                        WHERE NOT node.nodeId = $nodeId
                        DELETE node
                        `,
                { nodeId: node.nodeId }
            );
            const singleRecord = result.records[0];
            console.log(`Removed unwanted nodes`, singleRecord?.get(0));
        } catch (e) {
            console.error(`Error: ${e}`);
     }
}
```

This query attempts to delete all nodes and not the ones where $nodeId !== and existing nodeId. Is what I am trying to do possible with a cypher query? 
  
",1624280343,https://stackoverflow.com/q/68068382,Fuxi,"['neo4j', 'where-clause', 'cypher', 'graphql']"
68066681,NestJS Neo4j : Cannot find module &#39;neo4j-driver/types/integer&#39; or its corresponding type declarations,"I try to run my nestJS but I&#39;ve got a problem with my node_module :

node_modules/nest-neo4j/dist/neo4j.service.d.ts:10:32 - error TS2307: Cannot find module &#39;neo4j-driver/types/integer&#39; or its corresponding type declarations.

10     int(value: number): import(&quot;neo4j-driver/types/integer&quot;).default;
                                  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
node_modules/nest-neo4j/dist/neo4j.service.d.ts:12:47 - error TS2307: Cannot find module &#39;neo4j-driver/types/session&#39; or its corresponding type declarations.

12     getReadSession(database?: string): import(&quot;neo4j-driver/types/session&quot;).default;
                                                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
node_modules/nest-neo4j/dist/neo4j.service.d.ts:13:48 - error TS2307: Cannot find module &#39;neo4j-driver/types/session&#39; or its corresponding type declarations.

13     getWriteSession(database?: string): import(&quot;neo4j-driver/types/session&quot;).default;
                                                  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Found 3 error(s).

This is my app.module.ts 

```
import { Module } from &#39;@nestjs/common&#39;;
import { AppController } from &#39;./app.controller&#39;;
import { AppService } from &#39;./app.service&#39;;
import { Neo4jModule } from &#39;nest-neo4j&#39;

@Module({
  imports: [
    Neo4jModule.forRoot({
      scheme: &#39;neo4j&#39;,
      host: &#39;localhost&#39;,
      port: 7687,
      username: &#39;neo4j&#39;,
      password: &#39;ingrid-ticket-capital-spirit-reform-6035&#39;
    })
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```

Is any one got the same error ? 

Thanks for helping me !",1624272947,https://stackoverflow.com/q/68066681,Gauthier Cornec,"['neo4j', 'nestjs']"
68065573,Neo4j merge nodes by shared node property,"Can anyone help me on how can I do something similar to SQL&#39;s self-join in Neo4j?

     MATCH (z:Z {id: &quot;415a404a100ccccccccccccc&quot;})&lt;-[:INCLUDES]-(n)-[:BELONGS_TO]-&gt;(s:S)
     WHERE n:X OR n:Y
     RETURN ?? —&gt; Here I want to do self-join based on s id (S id) and merge properties from all nodes 


S is shop. 

Every shop can create two type of region X and Y. 

In both region I have the following node properties,

shopId
minBasketSize  Every region has a relation with city (z in this case).


With the query that I’ve shared, for example: I can get 3 nodes, including all regions. However, I only want to return 2 nodes, since two different type of region share the same shopId.


**Update:**

n -&gt; includes z =&gt; where n is two available label types x, y

x -&gt; belongs_to s =&gt; where x keeps s_id and some other properties such as minBasketSizeX

y -&gt; belong_to y =&gt; where y also keep s_id and some other properties such as minBasketSizeY

Now the question is, from given z, how can you return data like the following:

s1 =&gt; { minBasketSizeX: 30, minBasketSizeY: 20 }
s2 =&gt; { minBasketSizeX: null (if there&#39;s no y node for that given z, minBasketSizeY: 20 }
",1624267839,https://stackoverflow.com/q/68065573,esilik,['neo4j']
68061442,Neo4j graphsage model not training,"I have recently started trying out Neo4j&#39;s Graphsage algorithm.

I followed the example on [this page](https://neo4j.com/docs/graph-data-science/current/algorithms/graph-sage/)
```
CREATE
  // Persons
  (  dan:Person {name: &#39;Dan&#39;,   age: 20, heightAndWeight: [185, 75]}),
  (annie:Person {name: &#39;Annie&#39;, age: 12, heightAndWeight: [124, 42]}),
  ( matt:Person {name: &#39;Matt&#39;,  age: 67, heightAndWeight: [170, 80]}),
  ( jeff:Person {name: &#39;Jeff&#39;,  age: 45, heightAndWeight: [192, 85]}),
  ( brie:Person {name: &#39;Brie&#39;,  age: 27, heightAndWeight: [176, 57]}),
  ( elsa:Person {name: &#39;Elsa&#39;,  age: 32, heightAndWeight: [158, 55]}),
  ( john:Person {name: &#39;John&#39;,  age: 35, heightAndWeight: [172, 76]}),

  (dan)-[:KNOWS {relWeight: 1.0}]-&gt;(annie),
  (dan)-[:KNOWS {relWeight: 1.6}]-&gt;(matt),
  (annie)-[:KNOWS {relWeight: 0.1}]-&gt;(matt),
  (annie)-[:KNOWS {relWeight: 3.0}]-&gt;(jeff),
  (annie)-[:KNOWS {relWeight: 1.2}]-&gt;(brie),
  (matt)-[:KNOWS {relWeight: 10.0}]-&gt;(brie),
  (brie)-[:KNOWS {relWeight: 1.0}]-&gt;(elsa),
  (brie)-[:KNOWS {relWeight: 2.2}]-&gt;(jeff),
  (john)-[:KNOWS {relWeight: 5.0}]-&gt;(jeff)
```

After creating the graph I ran the following **Cypher Query**:
```
CALL gds.beta.graphSage.train(
  &#39;persons&#39;,
  {
    modelName: &#39;exampleTrainModel&#39;,
    featureProperties: [&#39;age&#39;, &#39;heightAndWeight&#39;],
    aggregator: &#39;mean&#39;,
    activationFunction: &#39;sigmoid&#39;,
    sampleSizes: [25, 10]
  }
) YIELD modelInfo as info
RETURN
  info.name as modelName,
  info.metrics.didConverge as didConverge,
  info.metrics.ranEpochs as ranEpochs,
  info.metrics.epochLosses as epochLosses
```
However, the `didConverge, ranEpochs, epochLosses` returned `null` values. The model itself returned the same embedding for all nodes. This shouldn&#39;t be the case as it is a working example on the site but I can&#39;t find the issue causing this to occur.

I am currently using **Neo4j** desktop on **Neo4j 4.2.5**. 

 ",1624240262,https://stackoverflow.com/q/68061442,Guai Zi Wei,"['neo4j', 'graph']"
68054948,Division operator in Neo4j,"When I execute the following cypher: 

    CREATE (n:Person {name: &#39;Andy&#39;,sal:600/3, title: &#39;Developer&#39;})
The salary value will equals 300.
But when execute the following: 

    CREATE (n:Person {name: &#39;Andy&#39;,sal:1/2, title: &#39;Developer&#39;})
The salary value will equals 0.
 What should I do to retrieve the correct answer?



",1624185448,https://stackoverflow.com/q/68054948,Sama,"['neo4j', 'division']"
68050520,Error: Type with name &quot;Long&quot; does not exists,"I am doing a code along project of GRAND stack real-estate-app &quot;https://www.youtube.com/watch?v=WB--CkjKJMQ&amp;list=PL9Hl4pk2FsvUjfSsxLolVToO5t1hwEIKK&amp;index=2&quot;

I have installed all the dependencies and configured the database `v3.5.18` and set the configurations in `.env` file.

After that I ran the `inferschema:write` script.

the schema.graphql file was updated with the following code
```
type Property {
   _id: Long!
   AddressL_1: String
   AddressLin: String
   Assessment: String
   COUNTYCD: Int!
   CareOfTaxp: String
   Certificat: String
   CityStateZ: String
   Continuous: Float!
   CountyAbbr: String!
   CountyName: String!
   DbaName: String
   FallowAcre: Float!
   FarmsiteAc: Float!
   ForestAcre: Float!
   GISAcres: Float!
   GrazingAcr: Float!
   IrrigatedA: Float!
   LegalDescr: String
   LevyDistri: String
   NonQualAcr: Float!
   OwnerAdd_1: String
   OwnerAdd_2: String
   OwnerAddre: String
   OwnerCity: String
   OwnerName: String
   OwnerState: String
   OwnerZipCo: String
   PropType: String
   PropertyID: Int!
   Range: String
   SHAPE_Area: Float!
   SHAPE_Leng: Float!
   Section: String
   Subdivisio: String
   TaxYear: Int!
   TotalAcres: Float!
   TotalBuild: Int!
   TotalLandV: Int!
   TotalValue: Int!
   Township: String
   WildHayAcr: Float!
   id: String!
}
```

Then when I run the server, it I gives me the following error

&gt;C:\Users\&lt;path-to-folder&gt;\practice-GRAND-&gt;STACK\realEstateApp\api\node_modules\graphql-compose\lib\TypeStorage.js:44

     throw new Error(`Type with name ${(0, _misc.inspect)(typeName)} does not exists`);
     Error: Type with name &quot;Long&quot; does not exists",1624134665,https://stackoverflow.com/q/68050520,Chinmay Dali,"['neo4j', 'graphql', 'apollo', 'neo4j-apoc', 'grandstack']"
68040772,Google colab to neo4j database connectivity error: service unavailable,"I am trying to connect my google colab notebook to neo4j server, using neo4j driver package that is officially supported by neo4j. BI am getting  the following error. 
ServiceUnavailable: Couldn&#39;t connect to 127.0.0.1:7687 (resolved to (&#39;127.0.0.1:7687&#39;,)):
Failed to establish connection to ResolvedIPv4Address((&#39;127.0.0.1&#39;, 7687)) (reason [Errno 111] Connection refused)
This is my full stack trace: 
```
ConnectionRefusedError                    Traceback (most recent call last)
/usr/local/lib/python3.7/dist-packages/neo4j/io/__init__.py in _connect(resolved_address, timeout, keep_alive)
   1175         log.debug(&quot;[#0000]  C: &lt;OPEN&gt; %s&quot;, resolved_address)
-&gt; 1176         s.connect(resolved_address)
   1177         s.settimeout(t)

ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

ServiceUnavailable                        Traceback (most recent call last)
9 frames
ServiceUnavailable: Failed to establish connection to ResolvedIPv4Address((&#39;127.0.0.1&#39;, 7687)) (reason [Errno 111] Connection refused)

The above exception was the direct cause of the following exception:

ServiceUnavailable                        Traceback (most recent call last)
/usr/local/lib/python3.7/dist-packages/neo4j/io/__init__.py in connect(address, timeout, custom_resolver, ssl_context, keep_alive)
   1316                 &quot;\n&quot;.join(map(str, errors))
   1317             )
-&gt; 1318         ) from errors[0]
   1319 
   1320 

ServiceUnavailable: Couldn&#39;t connect to 127.0.0.1:7687 (resolved to (&#39;127.0.0.1:7687&#39;,)):
Failed to establish connection to ResolvedIPv4Address((&#39;127.0.0.1&#39;, 7687)) (reason [Errno 111] Connection refused)
```",1624046042,https://stackoverflow.com/q/68040772,Anupurba Mitra,"['python', 'neo4j']"
68023417,Loading data slow in NEO4J when adding many node properties,"I&#39;m attempting to visualize firewall log data. To start, I am using the Windows application firewall logs.

I am using LOAD CSV WITH HEADERS. It works well when I have only a limited number of relationship properties, but as soon as I add just one more property to the relationship, it slows to a crawl, taking upwards of 30 minutes to process.

Example below loads quickly:
```        $queries = @{}
        $queries[&#39;statements&#39;] = @()

        $query = &quot;LOAD CSV WITH HEADERS FROM &#39;file:///data/go_output/$($uuid)_send_data.csv&#39; AS row
        MERGE (from:ipobj {ip: row.srcip, ipversion: row.srcipver, internal: row.srcipinternal})
        MERGE (to:ipobj {ip: row.dstip, ipversion: row.dstipver, internal: row.dstipinternal})
        MERGE (from)-[datatransfer:SENT {date: row.date, type: row.action, size: row.size}]-&gt;(to)&quot;
        $queries[&#39;statements&#39;] += [ordered]@{&#39;statement&#39;=&quot;$($query)&quot;}

        $retval = $queries| ConvertTo-Json

        $url = &quot;http://127.0.0.1:7474&quot;
        $credPair = &quot;neo4j:test&quot;
        $encodedCredentials = [System.Convert]::ToBase64String([System.Text.Encoding]::ASCII.GetBytes($credPair))
        $headers = @{&quot;Authorization&quot;=&quot;Basic $encodedCredentials&quot;; &quot;Accept&quot;=&quot;application/json; charset=UTF-8&quot;;&quot;Content-Type&quot;=&quot;application/json&quot;}

        $response = Invoke-WebRequest -Uri &quot;$($url)/db/data/transaction/commit&quot; -Method Post -Headers $headers -Body $($retval)
        $response.content
```

Example below takes 15 minutes to process:
```
        $queries = @{}
        $queries[&#39;statements&#39;] = @()

        $query = &quot;LOAD CSV WITH HEADERS FROM &#39;file:///data/go_output/$($uuid)_send_data.csv&#39; AS row
        MERGE (from:ipobj {ip: row.srcip, ipversion: row.srcipver, internal: row.srcipinternal})
        MERGE (to:ipobj {ip: row.dstip, ipversion: row.dstipver, internal: row.dstipinternal})
        MERGE (from)-[datatransfer:SENT {date: row.date, type: row.action, size: row.size, srcport: row.srcport, dstport: row.dstport}]-&gt;(to)&quot;
        $queries[&#39;statements&#39;] += [ordered]@{&#39;statement&#39;=&quot;$($query)&quot;}

        $retval = $queries| ConvertTo-Json

        $url = &quot;http://127.0.0.1:7474&quot;
        $credPair = &quot;neo4j:test&quot;
        $encodedCredentials = [System.Convert]::ToBase64String([System.Text.Encoding]::ASCII.GetBytes($credPair))
        $headers = @{&quot;Authorization&quot;=&quot;Basic $encodedCredentials&quot;; &quot;Accept&quot;=&quot;application/json; charset=UTF-8&quot;;&quot;Content-Type&quot;=&quot;application/json&quot;}

        $response = Invoke-WebRequest -Uri &quot;$($url)/db/data/transaction/commit&quot; -Method Post -Headers $headers -Body $($retval)
        $response.content
```

NEO4j complains about an eager operator, but loads just find with only the 3 properties.

Help? I don&#39;t know why this is happening. I&#39;ve checked the query plan and done a bunch of troubleshooting but have no idea why this is happening. To avoid this post being too long, I&#39;m not going to put the troubelshooting, but feel free to ask or just tell me what i&#39;m doing wrong!

**NOTE** the file that i&#39;m loading is, more or less, a standard issue windows firewall (pfirewall.log) file with the following modifications:
- space delim has been changed to comma
- comment rows have been removed and replaced with just the header
- header column names that contained a dash, the dash has been removed (src-port became srcport, etc)
- I did add an ipversion column (ipv4 vs ipv6) and an srcipinternal boolean column as seen in the :ipobj node merge/creation, but those are not explicitly needed. Those are just there for me to do some analytics stuff with later on.
- I actually did some preprocessing to split the files out into SEND/RECEIVED/FORWARD/UNKOWN action types to make processing easier below, which is why the file is called uuid_send_data.csv.",1623948217,https://stackoverflow.com/q/68023417,kevin,['neo4j']
68020939,Py2neo (Neo4j) insert / create Relationships in bulk,"Trying to insert many new Relationship on existing nodes.
Current code is taking too much time for millions of Relationship. Is there a way to optimise the same?

```
from py2neo import *

g = Graph()
nodes = NodeMatcher(g)

for persons in relation:
    person_a, person_b = persons

    a = nodes.match(&quot;person&quot;,name=person_a).first()
    b = nodes.match(&quot;person&quot;,name=person_b).first()

    ab = Relationship(a, &#39;KNOWS&#39; b)
    ab[&#39;date&#39;] = &#39;01-01-1980&#39;

    g.create(ab)

```
Now assume 2 things:
1. Relations are in millions
2. To process things faster, I have a pickle dump which consists of all the node details in `py2neo.data.Node` datatype so that we can skip the ```nodes.match(...)``` part.

Note: If there is any other way to create the complete graph faster in bulk mode (where I&#39;m willing to create the entire graph from scratch if time taken by adding Relationships &gt; time taken to create entire graph). Number of nodes are around 80K.",1623938499,https://stackoverflow.com/q/68020939,Kunal Ghosh Roy,"['py2neo', 'neo4j']"
68017598,Compare list in neo4j cypher query,"I need to compare each values of list of string(ids) with another node&quot;s property. Both nodes are in relation.

    A---&gt;b,A---&gt;c,A---&gt;d

    b,c,d has property called custom id. 

Need to check for null and empty also.

If list is empty find a node who doesn&#39;t have any relationship with particular node.
If list has some data then find a node who has relationship with provided node property in list call customid
",1623926018,https://stackoverflow.com/q/68017598,amit kumar gyandeep,"['cypher', 'neo4j']"
68015346,import csv file in Neo4j?,"I try to using Neo4j tool and import csv files.

and I have a problem.
my csv file is clear but, in neo4j browser.

LOAD CSV WITH HEADERS FROM &#39;file:///sample.csv&#39; AS row
return row.

row.name is return strange characters like ������.

yeah, the ������ is not English.
what is the problem. and how to fix it?
thank you.
",1623917254,https://stackoverflow.com/q/68015346,NoviceY,['neo4j']
68014663,Error in Neo4j Desktop when creating a Local DBMS,"Getting the following error:

```
DBMS failed to create: Error: Could not change password
```


I found this in log file
```
[2021-06-17 12:57:25.165] [info] Neo4j Download check
[2021-06-17 12:57:26.420] [info] Executing &#39;C:\Users\TYCOON\.Neo4jDesktop\relate-data\dbmss\dbms-34b7ff23-a23c-425b-aac3-5b6432db25f7\bin\neo4j-admin.bat&#39; [ &#39;set-initial-password&#39;, &#39;***&#39; ]
[2021-06-17 12:57:26.500] [error] Neo4jAdmin: &#39;Powershell&#39; is not recognized as an internal or external command,
operable program or batch file.

[2021-06-17 12:57:26.506] [info] Process [3156] exit with code &#39;9009&#39;, signal &#39;null&#39;
[2021-06-17 12:57:31.649] [info] Online check request: https://dist.neo4j.org/neo4j-desktop/win/latest.yml
[2021-06-17 12:57:31.945] [info] Online check response: 200 version: 1.4.5 files
```",1623914438,https://stackoverflow.com/q/68014663,AAkash Karmacharya,['neo4j']
68013843,spring data neo4j 6 @Query @Param can&#39;t access 2nd level children,"I&#39;ve a single object in the @Param to be used in @Query whereas the 1st level fields can be accessed without issues, but not the 2nd level. Unable to access fields from **Language** object

Consider:

    {
      &quot;id&quot;: 0,
      &quot;description&quot;: &quot;some text&quot;,
      &quot;language&quot;: {
        &quot;name&quot;: &quot;English&quot;
      }
    }

    @RelationshipProperties
    @Data
    public class KnowsEntity {

      @Id
      @GeneratedValue()
      private Long id;

      @Property
      private String description;

      @TargetNode
      private Language language;
    }
    
    @Query(&quot;MATCH (y:PERSON {nid: $from})-[r:KNOWS]-&gt;(e:LANGUAGE {name: $rel.__language__.__name__ }) \n&quot; +
            &quot;WHERE ID(r) = $rel. id  SET r.description = $rel.__description__  \n&quot; +
            &quot;return y, collect(r), collect(e)&quot;)
    UpdatedLanguageProjection updateRel(@Param(&quot;from&quot;) String from, @Param(&quot;rel&quot;) KnowsEntity relation);

form the above query i could access the first level field `$rel.__description__` and not the field inside first level object `$rel.__language__.__name__` (2nd level)

can someone please correct / suggest me an option to get this?

",1623910138,https://stackoverflow.com/q/68013843,CdVr,"['spring-data-neo4j', 'neo4j']"
68013763,Problem displaying custom output on in neo4j,"I want to show the relationship between several nodes through neo4j software as follows:

a = tom

b = david

c = jack

d = mary

How to communicate:

a-&gt; b

b-&gt; c

d-&gt; c

a-&gt; d

I want to show all connections a to at least two nodes after this code, but unfortunately only shows up to one node later, ie a-&gt; d

    MATCH r = (a: Person {name: &quot;tom&quot;}) - [: call * 2..4] - (d: Person) RETURN r

I try this code, but this code does not work either

    MATCH (a: Person {name: &quot;tom&quot;}) - [: call] -&gt; (d) - [: call] -&gt; (c: Person {name: &quot;jack&quot;})


![enter image description here][1]


  [1]: https://i.stack.imgur.com/2uJQD.png",1623909768,https://stackoverflow.com/q/68013763,Maryam Fardost,['neo4j']
68012586,Unable to locate a Java Runtime when neo4j-admin load,"when I try to load data to neo4j use

    sudo neo4j-admin load --from=/Users/pmzz/Downloads/MyProjects/neo4j-nosql-front/base/graph.db.dump --database=pragh.db --force
it says

    The operation couldn’t be completed. Unable to locate a Java Runtime.
    Please visit http://www.java.com for information on installing Java.

I&#39;ve checked my java environment：
```
(base) ➜  ~ java --version
openjdk 11.0.11 2021-04-20 LTS
OpenJDK Runtime Environment Zulu11.48+21-CA (build 11.0.11+9-LTS)
OpenJDK 64-Bit Server VM Zulu11.48+21-CA (build 11.0.11+9-LTS, mixed mode)
```
and neo4j works fine:
```
(base) ➜  ~ neo4j start
Active database: graph.db
Directories in use:
  home:         /usr/local/neo4j
  config:       /usr/local/neo4j/conf
  logs:         /usr/local/neo4j/logs
  plugins:      /usr/local/neo4j/plugins
  import:       /usr/local/neo4j/import
  data:         /usr/local/neo4j/data
  certificates: /usr/local/neo4j/certificates
  run:          /usr/local/neo4j/run
Starting Neo4j.
Started neo4j (pid 5249). It is available at http://localhost:7474/
There may be a short delay until the server is ready.
See /usr/local/neo4j/logs/neo4j.log for current status.
```
my enviroment:
- macOS  bigsur on M1 chip
- neo4j 3.5.28 community
- java 11.0.11

**any advice？**",1623901021,https://stackoverflow.com/q/68012586,pmzz,['neo4j']
68011362,How do I improve the performance of my count() query in Neo4j?,"Thanks in advance if anyone help me with this.


-- Status --

I have 1.5M Document nodes, 4.6M Keyword nodes, and 242M relations between them in Neo4j 4.1.9 Community Edition, and all properties are indexed.

Documents nodes have created date property between 2021-05-01 and 2021-05-31.

Neo4j database uses about 9G disk size, so I allocate 12G JVM heap for neo4j(the total memory size of vm is 16G).


-- Problems --

My query is to get 100 keywords of documents and its&#39; count.

    MATCH (d:Document)--&gt;(k:Keyword)
    WHERE DATE(&#39;2021-05-01&#39;) &lt;= d.created &lt;= DATE(&#39;2021-05-15&#39;)
    RETURN k.name, COUNT(k) AS c
    LIMIT 100

This query takes about 200 sec like below message in the Neo4j Browser.

&gt; Started streaming 100 records after 2 ms and completed after 201559 ms.

-- Qeustions --

Is it a problem of my Cypher query?

How to increase performance of Neo4j?


I apologize for my poor English and thank you in advance for any help.",1623888462,https://stackoverflow.com/q/68011362,Myungjin Lee,"['count', 'cypher', 'neo4j']"
68011149,A very hard Neo4j question to mimic the double for loop?,"I have three kinds of nodes: `me`(one node), `myFriend`, `friendOfFriend`, and I want to:

 1. Create relation between `me` and `myFriend` where we have two attributes the same value.
 2. Create relation between `friend` and `friendOfFriend` where they have two attributes the same value, but `friendOfFriend` should exclude `me`.
 3. Create relation between `me` and `friendOfFriend` where we have two attributes the same value, but `friendOfFriend` should exclude `friend`.

I&#39;m new to neo4j and I found the documentation very hard to read and provide very little info./example about how to use basic tools, instead it verbose on advertise &quot;Yes, we are good please funding us&quot;. Anyway, let&#39;s see the pseudocode version of my requirements:

    match (me) where me.a1=&quot;Rain&quot;

    for i in range(all_nodes):
        CONSTANT_ME = [me.a2, me.a3]  #  &lt;------- How to #1
        if i.a2 in CONSTANT_ME:
            # create friend relationship between me and i.
    
    for i in range(friend):
        CONSTANT_FRIEND = [friend.a2, friend.a3]
        for j in range(friend):
            if j.a2 in CONSTANT_FRIEND
            AND j.a3 in CONSTANT_FRIEND:
                # create FF relationship between node i and j

 I want to write the above in `Neo4j`&#39;s Cypher langauge, what I&#39;ve tried is:


    MATCH (me:Classmate), (c:Classmate)
    WHERE ID(me) &lt; ID(c)
    AND me.a1=&quot;Rain&quot; AND c.a1&lt;&gt;&quot;Rain&quot;
    AND ANY(x in [me.a2, me.a3] WHERE x in [c.a2, c.a3])
    CREATE (me)-[:friend]-&gt;(c);

    MATCH (c1:Classmate), (c2:Classmate)
    WHERE ID(c1) &lt; ID(c2)
    AND c1.a1&lt;&gt;&quot;Rain&quot; AND c2.a1&lt;&gt;&quot;Rain&quot;
    AND ANY(x in [c1.a2, c1.a3] WHERE x in [c2.a2, c2.a3])
    CREATE (c1)-[:friendOfFriend]-&gt;(c2);

    MATCH (me:Classmate), (c2:Classmate)
    WHERE ID(me) &lt; ID(c2)
    AND c1.a1=&quot;Rain&quot; AND c2.a1&lt;&gt;&quot;Rain&quot;
    AND ANY(x in [me.a2, me.a3] WHERE x in [c2.a2, c2.a3])
    CREATE (me)-[:meFF]-&gt;(c2);

As you can see this is very verbose and I cannot prevent that:

 - Repeat code is bad: `[me.a2, me.a3]` is declared twice.
 - I cannot prevent creating a `[:meFF]` to a node which already has been `[:friend]` with `me`.

Finally, does any one recommend some good tutorial on Neo4j which teaches the basic comprising how to solve problems like this one I encountered?",1623886246,https://stackoverflow.com/q/68011149,Rainning,"['cypher', 'neo4j']"
68005653,GraphQL Mutation Returns Null From Neo4j Database using neo4j-graphql-js,"I have a mutation which is meant to create a Car and assign the car with an Owner. I am using Neo4j as the underlying database, so I extend the `cypher` directive in my Graphql schema file like so

```
	CreateCar(data: CarInput!): Car!
		@cypher(
			statement: &quot;&quot;&quot;
			MERGE(s:Car {name: $data.name})
			   ON CREATE
			    SET s.id = apoc.create.uuid(), s.name = $data.name, s.description = $data.description, s.category = $data.category,
			     WITH s
			     MATCH(o:Owner {id: $cypherParams.currentUserId})
			     MERGE(o)-[:OWNS]-&gt;(s)
			RETURN s
			&quot;&quot;&quot;
		)
```
When I run the above mutation in my Graphql playground, the mutation runs successfully as the data is inserted into the database, but I get a response from my playground that says `&quot;message&quot;: &quot;Cannot return null for non-nullable field Mutation.CreateCar.&quot;` I also tried the same query using Neo4J Browser and it works, but running the mutation, data doesn&#39;t get returned back. Any help will be appreciated, thank you very much.",1623857041,https://stackoverflow.com/q/68005653,thatkingguy_,"['node.js', 'neo4j', 'graphql']"
68000851,Spring data neo4j - polymorphic children collection,"I have following classes:

    public interface Label {
      String getValue();
    }
    
    @Node
    @Data
    public class SimpleLabel implements Label {
      @Id
      @GeneratedValue
      private Long id;
      private String value;
    
      @Relationship(value = &quot;JE&quot;)
      private Set&lt;SimpleLabel&gt; labels = new HashSet&lt;&gt;();
    
      public void addLabel(SimpleLabel label){
        labels.add(label);
      }
    }
    
    @Node
    @Data
    public class HyperLabel implements Label {
      @Id
      @GeneratedValue
      private Long id;
    
      @Relationship(value = &quot;JE&quot;)
      private Set&lt;Label&gt; labels = new HashSet&lt;&gt;();
    
      public void addLabel(Label label){
        labels.add(label);
      }
    
      @Override
      public String getValue() {
        return labels.stream().map(Label::getValue).collect(Collectors.joining(&quot;; &quot;));
      }
    }

and this is the query I&#39;m using:

      @Query(&quot;MATCH (h:HyperLabel)-[r:JE]-(s:SimpleLabel) WHERE ID(h)=$id RETURN h,COLLECT(r),COLLECT(s)&quot;)
      Optional&lt;HyperLabel&gt; getById(Long id);

The problem, I&#39;m having is that `labels` collection that is returned by query is empty. But if I make a slight change in the code of `HyperLabel` class (change `Set&lt;Label&gt;` to `Set&lt;SimpleLabel&gt;`), then it works.

Is there any way to make it work with `Label` interface, since children of `HyperLabel` can be both `HyperLabel` and `SimpleLabel` instances?
",1623839003,https://stackoverflow.com/q/68000851,Bojan Vukasovic,"['neo4j', 'spring-data-neo4j', 'java', 'spring-data']"
67999417,@neo4j/graphql:auth JWT not configured,"I am trying to access dockerized neo4j from a simple dockerized nodejs app.

Following are my `docker-compose` configurations:

    version: &#39;2.1&#39;
    
    services:
      neo4j:
        image: neo4j:latest
        container_name: ltimdb_neo4j
        ports: 
          - &quot;7474:7474&quot;
          - &quot;7687:7687&quot;
        volumes: 
          - $HOME/data:/data
          - $HOME/neo4j/logs:/logs
          - $HOME/neo4j/import:/var/lib/neo4j/import
          - $HOME/plugins:/plugins
        environment:
          - NEO4J_apoc_export_file_enabled=true
          - NEO4J_apoc_import_file_enabled=true
          - NEO4J_apoc_import_file_use__neo4j__config=true
          - NEO4JLABS_PLUGINS=\[\&quot;apoc\&quot;\]
          - NEO4J_AUTH=neo4j/ltimdb
        networks:
          - default
        restart: always
          
      graphql:
        build: ./ltimdb-graphql-api-server
        container_name: ltimdb_graphql
        depends_on:
          - neo4j
        environment:
          - NEO4J_URI=bolt://neo4j:7687
          - NEO4J_USER=neo4j
          - NEO4J_PASSWORD=ltimdb
        ports:
          - &quot;4000:4000&quot;
        networks:
          - default
        restart: always

As you can see I am already changing the password while starting neo4j and passing appropriate credentials to the nodejs app container. But I am still not able to access the db via this setup. The same peice of code has been working without dockerization but fails to work afterwards.

I access neo4j in my app like so:

    const driver = neo4j.driver(
      process.env.NEO4J_URI,
      neo4j.auth.basic(process.env.NEO4J_USER, process.env.NEO4J_PASSWORD)
    );

I have already console logged `NEO4J_URI`, `NEO4J_USER` and `NEO4J_PASSWORD` from the app to see if they are reaching the app properly and its logged fine.

I get the following error on the console:

    graphql_1  | 2021-06-16T08:43:22.736Z @neo4j/graphql:auth JWT not configured
    graphql_1  | 2021-06-16T08:43:22.743Z @neo4j/graphql:execute About to execute Cypher:
    graphql_1  | Cypher:
    graphql_1  | MATCH (this:Movie)
    graphql_1  | RETURN this { .title } as this
    graphql_1  | Params:
    graphql_1  | {}
    neo4j_1    | 2021-06-16 08:43:22.950+0000 WARN  The client is unauthorized due to authentication failure.
    graphql_1  | 2021-06-16T08:43:23.003Z @neo4j/graphql:execute Neo4jError: The client is unauthorized due to authentication failure.
    graphql_1  | 
    graphql_1  |     at captureStacktrace (/usr/src/app/node_modules/neo4j-driver-core/lib/result.js:239:17)
    graphql_1  |     at new Result (/usr/src/app/node_modules/neo4j-driver-core/lib/result.js:59:23)
    graphql_1  |     at newCompletedResult (/usr/src/app/node_modules/neo4j-driver-core/lib/transaction.js:372:12)
    graphql_1  |     at Object.run (/usr/src/app/node_modules/neo4j-driver-core/lib/transaction.js:226:20)
    graphql_1  |     at Transaction.run (/usr/src/app/node_modules/neo4j-driver-core/lib/transaction.js:98:34)
    graphql_1  |     at /usr/src/app/node_modules/@neo4j/graphql/dist/utils/execute.js:63:108
    graphql_1  |     at TransactionExecutor._safeExecuteTransactionWork (/usr/src/app/node_modules/neo4j-driver-core/lib/internal/transaction-executor.js:92:26)
    graphql_1  |     at TransactionExecutor._executeTransactionInsidePromise (/usr/src/app/node_modules/neo4j-driver-core/lib/internal/transaction-executor.js:83:34)
    graphql_1  |     at /usr/src/app/node_modules/neo4j-driver-core/lib/internal/transaction-executor.js:40:19
    graphql_1  |     at new Promise (&lt;anonymous&gt;) {
    graphql_1  |   constructor: [Function: Neo4jError],
    graphql_1  |   code: &#39;Neo.ClientError.Security.Unauthorized&#39;


Also, I would like to point out that I am not using `@auth` annonations in my graphql type definitions which presumably requires JWT authentication, I guess.

Please suggest. TIA.",1623833727,https://stackoverflow.com/q/67999417,iamsmkr,"['javascript', 'node.js', 'apollo-server', 'neo4j', 'docker']"
67997430,How to remove 0xa0 in Neo4j csv data?,"I have tried

```
replace(row.field, &#39;0xa0&#39;, &#39;&#39;)
```

which didn&#39;t work, it still insert whatever presented in the .csv file.

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/7JOk2.png",1623824932,https://stackoverflow.com/q/67997430,Rainning,['neo4j']
67996086,Is there a way to include hyperlinks in nodes in neo4j?,"I am working on creating nodes and relationships. For a particular type of node, there is a hyperlink that I would like attach to it(perhaps as a property) so that users would be able to click and see more details on that node.

Does anyone know if that is possible? Happy to provide more details if needed. 

Thanks in advance.",1623815299,https://stackoverflow.com/q/67996086,Philson Manarcad,"['nodes', 'neo4j', 'bloom']"
67995198,How to update description of Neo4j from Greenplum data,"This is a big data beginner question.

I am using Amundsen to manage metadata information.
Amundsen&#39;s metadata will be managed using the Neo4j graph DB.
The actual data is stored in Greenplum.
I want to get specific column data from the greenplum table and update it in the Description part of Amundsen&#39;s neo4j.

I plan to implement it in Python. Please inquire about the procedure and method.",1623806204,https://stackoverflow.com/q/67995198,SangGi Lee,"['greenplum', 'database-metadata', 'neo4j', 'api']"
67994384,"Neo4j Spring Boot Actuator health and Unsupported authentication token, scheme &#39;none&#39; is only allowed when auth is disabled","Actuator health endpoint in my Spring boot application shows:

    &quot;org.neo4j.driver.exceptions.AuthenticationException: Unsupported authentication token, scheme &#39;none&#39; is only allowed when auth is disabled.&quot;

Neo4j is running, application is working properly. What may be wrong with Spring Boot Actuator?",1623797680,https://stackoverflow.com/q/67994384,alexanoid,"['neo4j', 'spring-boot', 'spring-boot-actuator', 'spring-data-neo4j']"
67992685,spring data neo4j 6 @Query passing list param throws ConverterNotFoundException on converting from List&lt;Pojo&gt; to type [org.neo4j.driver.Value],"I tried to update relationship properties using custom query with @Query where its working with java object but not with collection&lt;T&lt;T&gt;&gt; / List&lt;T&lt;T&gt;&gt; as seen below:

    @Query(&quot;UNWIND $relations \n&quot; +
            &quot;AS item \n&quot; +
            &quot;MATCH (f:PERSON {nid: $from})-[r:KNOWS]-&gt;(t:LANGUAGE {name: $to}) \n&quot; +
            &quot;WHERE ID(r) = item.id SET r.description = item.description \n&quot; +
            &quot;return f, collect(r), collect(t)&quot;)
    ResponseType updateRelation(@Param(&quot;from&quot;) String from, @Param(&quot;to&quot;) String to, @Param(&quot;relations&quot;) List&lt;KnowsEntity&gt; relEntites);

when i invoke this method it throws error as follows:

&gt; org.springframework.core.convert.ConverterNotFoundException: No converter found capable of converting from type [*.**KnowsEntity**] to type [**org.neo4j.driver.Value**]

Does this mean i need an custom converter to make this work?

also, when i hard-coded the json structure as below like we do in neo4j browser, it works fine.

Note: with subject to the keys should not be in quotes!

    @Query(&quot;UNWIND [{description:\&quot;defining value\&quot;,id:0},{description:\&quot;blah blah\&quot;,id:3}] \n&quot; +
            &quot;AS item \n&quot; +
            &quot;MATCH (f:PERSON {nid: $from})-[r:KNOWS]-&gt;(t:LANGUAGE {name: $to}) \n&quot; +
            &quot;WHERE ID(r) = item.id SET r.description = item.description \n&quot; +
            &quot;return f, collect(r), collect(t)&quot;)
    ResponseType updateRelation(@Param(&quot;from&quot;) String from, @Param(&quot;to&quot;) String to);

Please correct me whether am i missing something / any better way to get this updated using list of objects.

",1623786906,https://stackoverflow.com/q/67992685,CdVr,"['neo4j', 'spring-data-neo4j']"
67988563,dynamic import uneven data neo4j,"I have a small txt file (200-300 entries) of filePaths and fileNames on a given system:

```
~/a/aa/text.txt
~/a/ab/text.txt
~/b/x/y/text.txt
~/b/x/xx/y/yy/z/text.txt
```

I know that data can be imported into neo4j as a csv, so I could replace the slashes for commas in those strings to get columns and import the file.

The problem is that there is an uneven number of columns, so it would give the error `&quot;Cannot merge node using null property value for&quot;`, is there a way to import this kind of thing in Neo4j? Basically what I&#39;m trying to get is a tree from root to files.

The [documentation][1] doesn&#39;t mention something like this.


  [1]: https://neo4j.com/developer/guide-import-csv/",1623768533,https://stackoverflow.com/q/67988563,Onilol,['neo4j']
67987359,How to pass the whole map as a property when using apoc.load.csv while creating nodes?,"I am trying to create nodes by loading a csv file. Since I wanted to exclude some columns I decided to use `apoc.load.csv` instead of the simpler `LOAD CSV` command.

I wanted to have all the columns present as corresponding property value for the nodes. However I am not able to figure out how to do it. When the columns are less you can hardcode it, but in my real dataset I have more than 60 columns so I was hoping that there would be a programmatic way to achieve what I want to do.

Demo Dataset you can use `data.csv` -
```csv
name,age,beverage,country_from,fruit
Selma,9,Soda,RU,Apple
Rana,12,Tea,USA,Orange
Selina,19,Cola,CA,Guava
```
What I have tried so far that doesn&#39;t work yet -

```
CALL apoc.load.csv(&#39;data.csv&#39;, {header:true, ignore:[&#39;beverage&#39;], 
mapping:{
    age: {type:&#39;int&#39;},
    country_from: {name: &quot;country&quot;}
    }
})
YIELD map as row
CREATE (e:Entity $row)
CREATE (f:Fruit {name: row.fruit})
CREATE (c:Country {name: row.country_from})
MERGE (e:Entity)-[:EATS]-&gt;(f:Fruit)
MERGE (e:Entity)-[:IS_FROM]-&gt;(c:Country)
RETURN e,c,f
```
**Expected Output**:  
The graphdatabase has the Entity nodes with properties `name`,`age`,`country`,`fruit`

Initially I was using `{row}` but then I got the error as described [here](https://stackoverflow.com/questions/65246248/cyphersyntaxerrorthe-old-parameter-syntax-param-is-no-longer-supported-ple)
```
The old parameter syntax `{param}` is no longer supported. Please use `$param` instead
```
so I switched to using `$row` but then I get -
```
Expected parameter(s): row
```

I have followed the ideas from the following links -
1. https://neo4j-contrib.github.io/neo4j-apoc-procedures/3.4/export-import/load-csv/
2. https://neo4j.com/labs/apoc/4.1/import/load-csv/",1623764199,https://stackoverflow.com/q/67987359,jar,"['cypher', 'graph-databases', 'neo4j']"
67985760,How to create a relationship property in graphql type definitions using neo4j-graphql library,"Using neo4j-graphql library, from property graph models we could create a graphql type definitions.

For example, for the contrived imdb graph model below:

[![enter image description here][1]][1]

We could create graphql type definitions like so:

    type Movie {
        movieId: ID! 
        title: String!
        actors: [Person] @relationship(type: &quot;ACTOR_IN&quot;, direction: IN)
    }
    
    type Person {
        personId: ID!
        name: String!
        actorInMovies: [Movie] @relationship(type: &quot;ACTOR_IN&quot;, direction: OUT)
    }

Notice how `@relationship` annotations could be used to establish relationships between different types. 

However, neo4j also allows you to create relationship properties as well, as shown in the example below:
[![enter image description here][2]][2]

I can&#39;t seem to find any neo4j-graphql library document that explains how to achieve this. Please suggest. TIA.

  [1]: https://i.stack.imgur.com/1CSPe.png
  [2]: https://i.stack.imgur.com/WAJRo.png",1623758013,https://stackoverflow.com/q/67985760,iamsmkr,"['graphql', 'neo4j']"
67983117,Find the last page in a chronological line of web events,"I am struggling a bit to get the last page node from the last event.
Blue node: Session, Grey node: Events, Pink node: Page

[![enter image description here][1]][1]

[1]: https://i.stack.imgur.com/3AMWI.png

This would be the domain: I am trying to track all the user events in a web and each event belongs to one page. If an event does not have a page it means, it belongs to the last event that has a page. So if we get the last page and it is the same page url, we do not create the page but in other case yes.

So for example if a run this query I get all the pages but I want to return or collect the last one

```
MATCH (u:Admin {uuid: &quot;xxxx&quot;})-[:LAST]-&gt;(s:Session)-[:LAST]-&gt;(e:Event)
WITH e
MATCH (e)&lt;-[:NEXT*]-(pageEvent:Event)-[:FETCH]-&gt;(p:Page)
RETURN e, pageEvent, p
```",1623747434,https://stackoverflow.com/q/67983117,Ganbel,"['cypher', 'neo4j']"
67982757,Cypher Query returning more edge types than asked for,"Schema:
- Users create ChatItems  
- ChatItems are in response to other ChatItems  
- ChatItems can mentions Users.

The length of the longest chatItem reponse Chain is 9.  

I have the following query  
```
MATCH p=(i1:ChatItem)-[:ResponseTo*]-&gt;(i2:ChatItem) WHERE length(p) = 9 
WITH [i in nodes(p)] as items
MATCH path=(u:User)-[:CreateChat]-&gt;(i:ChatItem)
WHERE i IN items
RETURN DISTINCT path
```
This should basically return all the ```UserNodes-CreateChatEdge-&gt;ChatItemNodes``` such that those ChatItemNodes are from the longest chatItem chain right?

But what I actually get is a graph of the longest ChatItem chain(i.e with the ```ResponseTo``` edges which are not part of the final ```MATCH```) AND Which User created which ChatItem, but ALSO which Users are MentionedBy which ChatItem.  

This is surprising to me as the ```Mentioned``` edge is not mentioned anywhere in the query.  
Output Image:
[![enter image description here][1]][1]

I was expecting is the same graph but without the ```ResponseTo``` and the ```Mentioned``` edges.  
It is clear that I am a noob when it comes to CypherQueries, any help or explanations are appreciated.

  [1]: https://i.stack.imgur.com/IulQR.png",1623745929,https://stackoverflow.com/q/67982757,Varun Gawande,"['neo4j', 'cypher']"
67978454,What is the minimum disk space occupied by a neo4j node property?,"This article seems to imply a 41byte minimum on the disk space occupied by each property of a node, regardless of the property type.  For boolean and short node properties, this seems quite high.  Am I misunderstanding the article, or is this a correct and intended consequence of the fixed-size records in neo4j?  How can we minimize the disk space occupied by properties with small data types such as booleans or shorts? 

https://neo4j.com/developer/kb/understanding-data-on-disk/",1623715468,https://stackoverflow.com/q/67978454,andrew,['neo4j']
67976525,Neo4j How to query to all children nodes,"[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/Sf8Pr.png

In the picture, you may see an example of a graph.
If I do the query

    MATCH (u:UserNode)-[:PROMOTER_OF]-&gt;(c:UserNode)
    where u.promoterName=&quot;Antal&quot;
    RETURN u;

I only get as result MAIEREAN. But if I expand MAIEREAN, I can see SAMOILA who has MESTER, NICA and SOMOGYI as children and so on...

I would like to know: starting from Antal, how can I write my query in order to show also all children, grandchildre, greatgrandchildren, and so on from the first to the last one?
(FYI: I don&#39;t know in advance how long the hierarchy is).

I know something like OPTIONAL MATCH so I tried this

    Match (u:UserNode)
    WHERE u.promoterName=&quot;Antal&quot;
    OPTIONAL MATCH (u)-[:PROMOTER_OF]-&gt;(c:UserNode)
    RETURN c;
but it will return the same",1623700932,https://stackoverflow.com/q/67976525,Fabienne Lablatte,"['neo4j', 'cypher']"
67974073,Cypher query in a neo4j graph,"I have the following graph in Neo4j: &lt;br/&gt;
**Book**: book_id, isbn, language_code, title, image_url, small_image_url, avg_ratings, &lt;br/&gt;
**Author**: name, &lt;br/&gt;
**Reader**: id, &lt;br/&gt;
with 3 relationships: &lt;br/&gt;
**(Reader)-[:Rated]-&gt;(Book)** that has the property {rating: value}, &lt;br/&gt;
**(Reader)-[:Recommend]-&gt;(Book)**, &lt;br/&gt;
**(Author)-[:Write]-&gt;(Book)**. &lt;br/&gt;
&lt;br/&gt;
I want to find the book that has been most recommended with a query in Cypher. &lt;br/&gt;
I wrote a query but I&#39;m not too sure about it because I&#39;m not familiar using count() and max() operators.

Here is my attempt:
```
MATCH (r:Reader) - [rel:recommend] -&gt; (b:Book) 
RETURN count(rel), b 
ORDER BY count 
LIMIT 1
```",1623688639,https://stackoverflow.com/q/67974073,user14287399,"['property-graph', 'cypher', 'neo4j', 'graphdb']"
67968857,neo4j performance issue when filtering nodes,"What is the most efficient way to match all path that contains node with label a, b or c but which can contains other type of nodes.
It works for smaller graph but got performance issue on larger.

For example :
- a -&gt; b -&gt; c must be matched
- a -&gt; b -&gt; d -&gt; c must be matched
- a -&gt; b -&gt; d no match
- a -&gt; b no match

Any idea ?
I did it with with

```
MATCH (a)
WHERE exists((a)--&gt;(b)) and exists((a)--&gt;(c))
```",1623667548,https://stackoverflow.com/q/67968857,amerej,['neo4j']
67956964,Neo4j: how to compare elements in different lists so that each row has different elements from the previous rows,"I have a query that returns an id and the corresponding list of elements:

```
RETURN i.id, collect(distinct n.name)
```
Is there a way to filter the elements in each list so that each row has not the same elements of the previous ones? For example:

```
i.id | collect(distinct n.name)
------------------------------
1    | [A,B,C,D]
2    | [C,D,E]
3    | [F,G]
4    | [G,H]
```

how can I have: 
 
```
i.id | collect(distinct n.name)
------------------------------
1    | [A,B,C,D]
2    | [E]
3    | [F,G]
4    | [H]
```

The idea is that the second row has not the same elements of the first one, the third row has not the same elements of the second and the first ones and so on

I hope I was able to explain what I’m looking for, any help would be appreciated.
",1623578143,https://stackoverflow.com/q/67956964,Loren,"['cypher', 'compare', 'neo4j', 'graph', 'list']"
67953964,Cellular automata style search with cypher?,"A while ago a friend and I made an overland flow routing tool. [Demo](https://sancarn.github.io/OverlandFlow/build/) and [Runtime Example](https://www.youtube.com/watch?v=_AbW0gpJPac).

Ultimately 

    1. Check all cells which neighbour the current frontier
    2. Choose the lowest cell
    3. Add this cell to the frontier
    4. Repeat til hitting an end node.

Our use case means expanding these networks to hundreds of thousands of nodes, and at that point using javascript stops being doable. So instead I&#39;m looking to convert this to Neo4j.

I&#39;ve had a little experience with cyphers it appears that a `(:start)-[:path *]-(:end)` kind of relationship might do most of the internals automatically, however I&#39;m not sure if i can prioritise the path it takes correctly. Is this something that can be done in a cypher, or would it be cleaner to execute the search in java or one of the scripting languages?",1623544634,https://stackoverflow.com/q/67953964,Sancarn,"['neo4j', 'cypher']"
67952806,GraphQL Apollo types generation on React Native,"I&#39;m using
- Neo4J 4.2
- Apollo server
- GraphQL &amp; @neo4j/graphql (to generate Neo4J types from `schema.graphql`)
- Expo React Native + Apollo Client
- TypeScript

And I wanted to generate TS types for GraphQL queries by following [this tutorial][1].

[By default apollo-cli][2] will look in `./src` folder, but in React Native I don&#39;t have such a folder, it&#39;s all in root. So when I tried to change `includes` config for apollo client like so:

```
&lt;root&gt;/apollo.config.js

module.exports = {
  client: {
    includes: [&#39;**/*.{ts,tsx}&#39;],
  },
};
```

Running
```
&gt; apollo codegen:generate --endpoint=http://localhost:4001/ --target=typescript --tagName=gql
```

Resulted in:
```
Error: Error initializing Apollo GraphQL project &quot;Unnamed Project&quot;: Error: Error in &quot;Loading queries for Unnamed Project&quot;: Error: ️️There are multiple definitions for the `OpName` operation. Please rename or remove all operations with the duplicated name before continuing.
```


  [1]: https://www.apollographql.com/blog/tooling/apollo-codegen/typescript-graphql-code-generator-generate-graphql-types/
  [2]: https://www.apollographql.com/docs/devtools/apollo-config/#clientincludes",1623530198,https://stackoverflow.com/q/67952806,Alecu Marian Alexandru,"['graphql', 'neo4j', 'typescript', 'react-native', 'apollo']"
67948170,How to optimize and improve neo4j cypher query with multiple match and an increase number of where clauses,"in my neo4j graph database I have some Restaurants linked to Foods listed on the menu and also linked to the Cities where they are located. 

I’m trying to search for restaurants in London each offering different kind of foods one from the other, so I started looking for two different restaurants in this way: 

```
MATCH (f1:Food)--(r1:Restaurant)-[:LOCATED_IN]-(c1:City{name:&#39;London&#39;}) 
WHERE f1.name in [name1, name2, name3, name4] 
MATCH (f2:Food)--(r2:Restaurant)-[:LOCATED_IN]-(c2:City{name:&#39;London&#39;}) 
WHERE r1.id&lt;&gt;r2.id and f1.name&lt;&gt;f2.name 
RETURN, r1.name as Restaurant_A, collect(distinct f1.name) as Food_A,r2.name as Restaurant_B, collect(distinct f2.name) as Food_B 
LIMIT 1
```
but if I want to find a third Restaurant I need to add more where clauses and so on if I want a fourth restaurant, a fifth one…

This is the example for the third restaurant:

```
MATCH (f1:Food)--(r1:Restaurant)-[:LOCATED_IN]-(c1:City{name:&#39;London&#39;}) 
WHERE f1.name in [name1, name2, name3, name4] 
MATCH (f2:Food)--(r2:Restaurant)-[:LOCATED_IN]-(c2:City{name:&#39;London&#39;}) 
WHERE r1.id&lt;&gt;r2.id and f1.name&lt;&gt;f2.name  
MATCH (f3:Food)--(r3:Restaurant)-[:LOCATED_IN]-(c3:City{name:&#39;London&#39;}) 
WHERE r2.id&lt;&gt;r1.id and r3.id&lt;&gt;r2.id and f3.name&lt;&gt;f3.name  and f3.name&lt;&gt;f2.name  
RETURN r1.name as Restaurant_A, collect(distinct f1.name) as Food_A,r2.name as Restaurant_B, collect(distinct f2.name) as Food_B, r3.name as Restaurant_C, collect(distinct f3.name) as Food_C 
LIMIT 1
```
And I’d really like to know if there is an alternative way to do it, I’m new to neo4j and every suggestion is more than welcome.

",1623495524,https://stackoverflow.com/q/67948170,Loren,"['performance', 'cypher', 'neo4j', 'query-optimization', 'graph']"
67934767,apoc.custom.asProcedure() with UNWIND Neo4j,"How use UNWIND in a apoc.customs.asProcedure()? How call the parameter for the function?
I need to create a procedure for this

MATCH (pr:Home{home_id:&#39;6ef77b&#39;})
UNWIND [{domain:&quot;domain1.com&quot;, email: &quot;some@email.com&quot;}, {domain:&quot;domain3.com&quot;, email: &quot;some03@email.com&quot;}] AS arr
CREATE (i:Information)
SET i=arr
CREATE (i) -[:HAS] -&gt; (pr);

this works but I don&#39;t know how to create an apoc procedure for this and how to call the parameter",1623404784,https://stackoverflow.com/q/67934767,Simo400,"['neo4j-apoc', 'neo4j']"
67929415,Using GDS to make a neo4j undirected graph,"The neo4j Graph Data Science (GDS) &quot;Triangle Count&quot; algorithm only runs on an undirected graph. I can convert my existing directed graph to undirected for the calculation using:

CALL gds.graph.create(&#39;myGraph3&#39;, &#39;*&#39;, {BELONGS_TO: {orientation: &#39;UNDIRECTED&#39;}, FLOWS_TO: {orientation: &#39;UNDIRECTED&#39;}})

But I have to list every relationship, which is brittle and lengthy for the actual list of relationships.  Is there a way to make the &#39;*&#39; work with this?

Something like

CALL gds.graph.create(&#39;myGraph3&#39;, &#39;*&#39;, {&#39;*&#39;: {orientation: &#39;UNDIRECTED&#39;}})

which does not work, but I can&#39;t figure the correct pattern.",1623366252,https://stackoverflow.com/q/67929415,e25548,"['neo4j-apoc', 'undirected-graph', 'neo4j']"
67929335,Neo4j Aura and uuid issue,"Running this GraphQL mutation

      &quot;Convenience mutation to destructively update DataPoints for a specific SurveyResponse and question. Accepts answers and/or value. This mutation deletes existing relationships that represent answer data. Returns a DataPoint.&quot;
      AnswerQuestion(
        &quot;The id of the question&quot;
        id: ID!
        surveyResponse: ID!
        answers: [ID] = []
        value: String = null
      ): DataPoint
        @hasScope(scopes: [&quot;DataPoint: Update&quot;])
        @cypher(
          statement: &quot;&quot;&quot;
          MATCH (sr:SurveyResponse) WHERE sr.id = $surveyResponse
          MATCH (q:Question) WHERE q.id = $id
          OPTIONAL MATCH (sr)--(oldDp:DataPoint)--(q)
          DETACH DELETE oldDp
          MERGE (sr)-[:HAS_DATA_POINT]-&gt;(dp:DataPoint {id: coalesce(dp.id, apoc.create.uuid())})-[:FOR_QUESTION]-&gt;(q)
          WITH dp, q
          FOREACH (o IN CASE WHEN $value IS NOT NULL THEN [true] ELSE [] END | MERGE (dp)-[:ANSWERS {value: $value, propToWrite: q.propToWrite}]-&gt;(q))
          WITH dp, q
          OPTIONAL MATCH (a:Answer) WHERE a.id IN $answers
          FOREACH (o IN CASE WHEN a IS NOT NULL THEN [a] ELSE [] END | MERGE (dp)-[:SELECTED_ANSWER]-&gt;(a))
          RETURN dp
          &quot;&quot;&quot;
        )

results in this type of error message on aura (4.2.0. enterprise edition - no matter whether this is run against leader or follower nodes):

&gt; Failed to invoke procedure `apoc.cypher.doIt`: Caused by: IndexEntryConflictException{propertyValues=( String(&quot;always-the-same-id-that-has-nothing-to-do-with-the-queried-data&quot;) ), addedNodeId=-1, existingNodeId=n}``` where &quot;always-the-same-id-that-has-nothing-to-do-with-the-queried-data&quot; and &quot;n&quot; are unimportant values.

The same mutation works fine on localhost (4.2.7 community edition).

When I query on all nodes for the id (&quot;always-the-same-id-that-has-nothing-to-do-with-the-queried-data&quot;), I see one DataPoint and another node which are not connected. Deleting the DataPoint and just running the reduced query below in neo directly yields the same error message.

          MATCH (sr:SurveyResponse) WHERE sr.id = $surveyResponse
          MATCH (q:Question) WHERE q.id = $id
          OPTIONAL MATCH (sr)--(oldDp:DataPoint)--(q)
          DETACH DELETE oldDp
          MERGE (sr)-[:HAS_DATA_POINT]-&gt;(dp:DataPoint {id: coalesce(dp.id, apoc.create.uuid())})-[:FOR_QUESTION]-&gt;(q) RETURN dp

This let me to believe that the uuid creation on aura is flawed, but running `RETURN apoc.create.uuid()` multiple times creates different strings. Sneaking in a `WITH sr, q` between the DETACH DELETE and MERGE statements has no effect.",1623365524,https://stackoverflow.com/q/67929335,manonthemat,"['neo4j-apoc', 'uuid', 'neo4j', 'cypher', 'neo4j-aura']"
67924138,How to improve performance of a GraphQL request?,"I have a request that takes around 5 seconds to return all results.

I added this to config in Neo4j VM enterprise:

    dbms.memory.heap.initial_size=16G
    dbms.memory.heap.max_size=16G
    dbms.memory.pagecache.size=10g
    dbms.tx_state.memory_allocation=ON_HEAP

Here is my GraphQL request:

    query NewDefaultResults {
      ARTICLE (first: 5000){
        id
        score
        clstr {
          clstr_id
          node_id
          percent_articles_gt_ts
        }
        title
        date_published {
          formatted
        }
        hour_published {
          formatted
        }
        link
        img_url
        source {
          title
        }
        article_content
        favorite
        like
        read
        node_id
      }
    }
I saw the query.log file:
- the request starts by nodebylabelscan
- driver: neo4j-graphql-js/2.16.4
- pageHits: 55698
- cpu(ms) 260
- time(ms) 7214

What can I improve, is it in GraphQL, or also in Neo4j (config or anything else) ? The web app is very slow to display articles, is this request the reason ?

I would like to be able to return this big result faster",1623338643,https://stackoverflow.com/q/67924138,jos97,"['graphql', 'neo4j-graphql-js', 'neo4j']"
67921729,Sum values from relationships list in Neo4j,"I have a problem trying to capture the sum of a list from a captured path.

I have been successful in fetching data from the **path** and are getting a result like this:

    relationships(path)
Result:

    [{&quot;amount&quot;:1},{&quot;amount&quot;:2},{&quot;amount&quot;:3}]

I can also fetch the actual values by using this:

    [node in relationships(path) | coalesce(node.amount)] as nodes.
    
Result:

    [1,2,3]

    
What I would like was to be able to produce a simple sum of the values in this list. In the example above I would like the result &quot;6&quot;.

",1623330215,https://stackoverflow.com/q/67921729,Dan L,"['neo4j', 'sum', 'cypher', 'relationship']"
67920172,Connect Spring Boot 2.4.x to neo4j-3.4.x,"I&#39;m trying to connect a `Spring Boot 2.4.6` service to a `Neo4j 3.4.18-enterprise` server, but I get the following error:

    Caused by: org.neo4j.driver.exceptions.ClientException: The server does not support any of the protocol versions supported by this driver. Ensure that you are using driver and server versions that are compatible with one another.
	at org.neo4j.driver.internal.util.Futures.blockingGet(Futures.java:143)
	at org.neo4j.driver.internal.InternalSession.run(InternalSession.java:69)
	at org.neo4j.driver.internal.InternalSession.run(InternalSession.java:51)
	at org.neo4j.driver.internal.AbstractQueryRunner.run(AbstractQueryRunner.java:37)
	at org.neo4j.driver.internal.AbstractQueryRunner.run(AbstractQueryRunner.java:43)
	... 99 more

Reading this [compatibility matrix](https://github.com/neo4j/neo4j-ogm/wiki/Versions#all-supported-versions) I&#39;m assuming (or rather I&#39;m hoping) there should be a way to make `Spring Boot 2.4.x` work with `Neo4j 3.4.x`

Here&#39;s a docker command to start a neo4j server:

    docker run --publish=7474:7474 --publish=7687:7687 --volume=$HOME/neo4j/data:/data --env=NEO4J_ACCEPT_LICENSE_AGREEMENT=yes --env=NEO4J_AUTH=neo4j/test neo4j:3.4-enterprise

And here&#39;s a [github repository](https://github.com/flaviuratiu/spring-boot-neo4j-compatibility-test.git) with a simple test to reproduce the issue:
```
@SpringBootTest
class SpringBootNeo4jCompatibilityTestApplicationTests {

	@Autowired
	private Neo4jClient neo4jClient;

	@Test
	void testNeo4jConnection_whenQueryIsRun_thenNoExceptionShouldBeThrown() {
		neo4jClient.query(&quot;MATCH (n) RETURN n&quot;)
				.run();
	}

}
```

The test fails when ran against `neo4j 3.4.x`, but it passes when ran against `neo4j 3.5.6-enterprise`.

Could you please suggest a way to make this connection work?
Thank you.",1623324181,https://stackoverflow.com/q/67920172,flaviuratiu,"['neo4j', 'spring-boot']"
67918490,spring data neo4j 6.1.1 Repository Relationship primary_id not allowing to use UUID String where as for Node Primary_id UUID String is working,"I have the following relationship entity for neo4j Graph Model using **Spring data neo4j 6.1.1** to represent relationship like Person-**BookedFor**-&gt;Movie where i can use UUID string for node repositories (Person, Movie) but not for the following relationship Entity BookedFor.

Note: since the neo4j doc describes this [neo4j doc ref](https://neo4j.com/docs/cypher-manual/current/clauses/match/#match-node-by-id)



    public interface BookedForRepository extends Neo4jRepository&lt;BookedFor, String&gt; {}

    @RelationshipProperties
    public class BookedFor {

        @Id
        @GeneratedValue(UUIDStringGenerator.class)
        public String rid;
    
        @Property
        private Date bookedDate;
    
    }

which throws error as below:

&gt; The target class `*.entities.BookedFor` for the properties of the relationship `BookedFor` is missing a property for the generated, internal ID (`@Id @GeneratedValue Long id`) which is needed for safely updating properties

Note: If i use like following, it creates relationship with the internal id of neo4j

    public interface BookedForRepository extends Neo4jRepository&lt;BookedFor, Long&gt; {}

    @RelationshipProperties
    public class BookedFor {

        @Id
        @GeneratedValue
        public Long id;
    
        @Property
        private Date bookedDate;
    
    }

but this will create uncertainty on data migration / data mutation as we rely on internal id of neo4j relationship entity. Please correct me if i&#39;m wrong.

[spring data neo4j doc ref](https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#mapping.id-handling.external-id)

Could anyone please help to proceed with this in a better way? 

Also, please comment if more clarification / details required.

",1623317469,https://stackoverflow.com/q/67918490,CdVr,"['spring-data-neo4j', 'neo4j']"
67918138,How to convert a record or list into JSON format using python?,"I am trying to convert a list into JSON using Python. The result from a query looks something like this : 

**Output:**

    [&lt;Record r=&lt;Relationship id=106 nodes=(&lt;Node id=71 labels=frozenset({&#39;TBox&#39;}) properties={&#39;identifier&#39;: &#39;&#39;, &#39;ontology_level&#39;: &#39;lower&#39;, &#39;neo4jImportId&#39;: &#39;105&#39;, &#39;html_info&#39;: &#39;&#39;, &#39;namespace&#39;: &#39;car&#39;, &#39;admin&#39;: &#39;&#39;, &#39;description&#39;: &#39;remove&#39;, &#39;sing&#39;: &#39;&#39;, &#39;pl&#39;: &#39;&#39;, &#39;title&#39;: &#39;BMProcessor&#39;, &#39;version&#39;: &#39;v6.0&#39;}&gt;, &lt;Node id=59 labels=frozenset({&#39;TBox&#39;}) properties={&#39;identifier&#39;: &#39;&#39;, &#39;ontology_level&#39;: &#39;lower&#39;, &#39;neo4jImportId&#39;: &#39;93&#39;, &#39;html_info&#39;: &#39;&#39;, &#39;namespace&#39;: &#39;car&#39;, &#39;admin&#39;: &#39;&#39;, &#39;description&#39;: &#39;A DataProcessor which represents a ML algorithm&#39;, &#39;sing&#39;: &#39;&#39;, &#39;pl&#39;: &#39;&#39;, &#39;title&#39;: &#39;LearningProcessor&#39;, &#39;version&#39;: &#39;v6.0&#39;}&gt;) type=&#39;subclass_of&#39; properties={}&gt; b=&lt;Node id=59 labels=frozenset({&#39;TBox&#39;}) properties={&#39;identifier&#39;: &#39;&#39;, &#39;ontology_level&#39;: &#39;lower&#39;, &#39;neo4jImportId&#39;: &#39;93&#39;, &#39;html_info&#39;: &#39;&#39;, &#39;namespace&#39;: &#39;car&#39;, &#39;admin&#39;: &#39;&#39;, &#39;description&#39;: &#39;A DataProcessor which represents a ML algorithm&#39;, &#39;sing&#39;: &#39;&#39;, &#39;pl&#39;: &#39;&#39;, &#39;title&#39;: &#39;LearningProcessor&#39;, &#39;version&#39;: &#39;v6.0&#39;}&gt; n=&lt;Node id=71 labels=frozenset({&#39;TBox&#39;}) properties={&#39;identifier&#39;: &#39;&#39;, &#39;ontology_level&#39;: &#39;lower&#39;, &#39;neo4jImportId&#39;: &#39;105&#39;, &#39;html_info&#39;: &#39;&#39;, &#39;namespace&#39;: &#39;car&#39;, &#39;admin&#39;: &#39;&#39;, &#39;description&#39;: &#39;remove&#39;, &#39;sing&#39;: &#39;&#39;, &#39;pl&#39;: &#39;&#39;, &#39;title&#39;: &#39;BMProcessor&#39;, &#39;version&#39;: &#39;v6.0&#39;}&gt;&gt;]

**Function :**

    def runQuery(query):
      pprint.pprint(connection.execute(query))

When I perform a simple `json.dumps()` it return with `TypeError: Object of type is not JSON serializable`

I want to print a JSON format out of this. How can I do so? 

",1623316134,https://stackoverflow.com/q/67918138,Raj,"['python', 'neo4j', 'json']"
67916433,"Upgraded Neo4J database to 4.2, browser at 7474 still points to old Neo4j database 3.5, How do I fix this?","I upgraded Neo4J database to 4.2, the Neo4J browser at 7474 still points to old Neo4j database 3.5, 

I did start the new DB in the backend. 

I suspect it was because I did not set dbms upgrade to yes in the config file before I started the db upgrade in red hat.

What do I need to do to fix this (some config changes maybe ?)

Please advise. 

Appreciated

",1623309397,https://stackoverflow.com/q/67916433,Wim Dewet,"['upgrade', 'neo4j-browser', 'neo4j']"
67912270,Neo4j: Applying index and constraint changes query results,"I am encountering an issue with Neo4j where the results for the same query change after applying the below:
- an index on a property for nodes with a given label
- a constraint that asserts the existence of the same property for nodes with the same label as above

#### Environment
- Neo4j version: 4.2.1 Enterprise, default runtime (slotted)
- Neo4j Desktop 1.4.1
- Operating system: macOS Big Sur Version 11.4

#### Steps to reproduce:

Create one set of nodes and relationships by running the following:
```
CREATE (p1:Person { id: &#39;100&#39;, name: &#39;Hampton Fancher&#39; })&lt;-[:WRITTEN_BY]-(m:Movie { id: &#39;101&#39;, name: &#39;Blade Runner&#39; })-[:BASED_ON]-&gt;(n:Novel { id: &#39;102&#39;, name: &#39;Do Androids Dream of Electric Sheep?&#39; })-[:WRITTEN_BY]-&gt;(p2:Person { id: &#39;103&#39;, name: &#39;Philip K Dick&#39; })
```

Create a second set of nodes and relationships by running the following:
```
CREATE (p1:Person { id: &#39;200&#39;, name: &#39;Phil Alden Robinson&#39; })&lt;-[:WRITTEN_BY]-(m:Movie { id: &#39;201&#39;, name: &#39;Field of Dreams&#39; })-[:BASED_ON]-&gt;(n:Novel { id: &#39;202&#39;, name: &#39;Shoeless Joe&#39; })-[:WRITTEN_BY]-&gt;(p2:Person { id: &#39;203&#39;, name: &#39;W P Kinsella&#39; })
```

Run this query:
```
MATCH (movie:Movie { name: &#39;Blade Runner&#39; })

OPTIONAL MATCH (movie)-[:WRITTEN_BY|BASED_ON]-&gt;(entity)
	WHERE entity:Person OR entity:Novel

OPTIONAL MATCH (entity:Novel)-[:WRITTEN_BY]-&gt;(sourceNovelWriter:Person)

RETURN sourceNovelWriter
```

The results are as expected (i.e. they reflect Philip K Dick as the source novel writer of Blade Runner):
```
╒═══════════════════════════════════╕
│&quot;sourceNovelWriter&quot;                │
╞═══════════════════════════════════╡
│{&quot;name&quot;:&quot;Philip K Dick&quot;,&quot;id&quot;:&quot;103&quot;}│
├───────────────────────────────────┤
│null                               │
└───────────────────────────────────┘
```

Then create an index for the `name` property for nodes with the `Novel` label:
```
CREATE INDEX ON :Novel(name)
```

Then create a constraint on the existence of the `name` property for nodes with the `Novel` label:
```
CREATE CONSTRAINT ON (n:Novel) ASSERT EXISTS(n.name)
```

N.B. The following behaviour is only experienced when both the index and constraint are applied; if only one is applied then it does not occur.

Re-running the initial query shows that the results have changed to as shown below and which are not expected (i.e. they incorrectly state that W P Kinsella is a source novel writer of Blade Runner):
```
╒═══════════════════════════════════╕
│&quot;sourceNovelWriter&quot;                │
╞═══════════════════════════════════╡
│{&quot;name&quot;:&quot;Philip K Dick&quot;,&quot;id&quot;:&quot;103&quot;}│
├───────────────────────────────────┤
│{&quot;name&quot;:&quot;W P Kinsella&quot;,&quot;id&quot;:&quot;203&quot;} │
├───────────────────────────────────┤
│{&quot;name&quot;:&quot;Philip K Dick&quot;,&quot;id&quot;:&quot;103&quot;}│
├───────────────────────────────────┤
│{&quot;name&quot;:&quot;W P Kinsella&quot;,&quot;id&quot;:&quot;203&quot;} │
└───────────────────────────────────┘
```

The query can be fixed by removing the `Novel` label from the second `OPTIONAL MATCH` (but it would be preferred to have the added explicitness of expressing that the match is only required when the `entity` variable has a `Novel` label):
```
MATCH (movie:Movie { name: &#39;Blade Runner&#39; })

OPTIONAL MATCH (movie)-[:WRITTEN_BY|BASED_ON]-&gt;(entity)
	WHERE entity:Person OR entity:Novel

OPTIONAL MATCH (entity)-[:WRITTEN_BY]-&gt;(sourceNovelWriter:Person)

RETURN sourceNovelWriter
```

This returns:
```
╒═══════════════════════════════════╕
│&quot;sourceNovelWriter&quot;                │
╞═══════════════════════════════════╡
│{&quot;name&quot;:&quot;Philip K Dick&quot;,&quot;id&quot;:&quot;103&quot;}│
├───────────────────────────────────┤
│null                               │
└───────────────────────────────────┘
```

The `entity` variable can be examined by revising the query to make it the return value:
```
MATCH (movie:Movie { name: &#39;Blade Runner&#39; })

OPTIONAL MATCH (movie)-[:WRITTEN_BY|BASED_ON]-&gt;(entity)
	WHERE entity:Person OR entity:Novel

OPTIONAL MATCH (entity:Novel)-[:WRITTEN_BY]-&gt;(sourceNovelWriter:Person)

RETURN entity
```

This incorrectly includes `Shoeless Joe` in the results:
```
╒══════════════════════════════════════════════════════════╕
│&quot;entity&quot;                                                  │
╞══════════════════════════════════════════════════════════╡
│{&quot;name&quot;:&quot;Do Androids Dream of Electric Sheep?&quot;,&quot;id&quot;:&quot;102&quot;}│
├──────────────────────────────────────────────────────────┤
│{&quot;name&quot;:&quot;Shoeless Joe&quot;,&quot;id&quot;:&quot;202&quot;}                        │
├──────────────────────────────────────────────────────────┤
│{&quot;name&quot;:&quot;Do Androids Dream of Electric Sheep?&quot;,&quot;id&quot;:&quot;102&quot;}│
├──────────────────────────────────────────────────────────┤
│{&quot;name&quot;:&quot;Shoeless Joe&quot;,&quot;id&quot;:&quot;202&quot;}                        │
└──────────────────────────────────────────────────────────┘
```

If the second `OPTIONAL MATCH` is removed, i.e.
```
MATCH (movie:Movie { name: &#39;Blade Runner&#39; })

OPTIONAL MATCH (movie)-[:WRITTEN_BY|BASED_ON]-&gt;(entity)
	WHERE entity:Person OR entity:Novel

RETURN entity
```

Then the returned `entity` correctly relates to Blade Runner:
```
╒══════════════════════════════════════════════════════════╕
│&quot;entity&quot;                                                  │
╞══════════════════════════════════════════════════════════╡
│{&quot;name&quot;:&quot;Do Androids Dream of Electric Sheep?&quot;,&quot;id&quot;:&quot;102&quot;}│
├──────────────────────────────────────────────────────────┤
│{&quot;name&quot;:&quot;Hampton Fancher&quot;,&quot;id&quot;:&quot;100&quot;}                     │
└──────────────────────────────────────────────────────────┘
```

It seems that the `entity` variable is reset in the second `OPTIONAL MATCH` but only when both the index and constraint are set.

Is this expected and what accounts for this behaviour?

Thanks in advance.",1623276389,https://stackoverflow.com/q/67912270,Andy Gout,"['database-indexes', 'constraints', 'cypher', 'neo4j']"
67910112,Posting Relationship with properties to Neo4JRepository,"Spring Data Rest and Spring Data Neo4j describe the process of adding new relationship through an HTTP request using text/uri-list as Content-Type but how to add a rich relationship (relation with properties using HTTP request) this relationship is annotated with @RelationshipProperties.


&lt;!-- begin snippet: js hide: false console: true babel: false --&gt;

&lt;!-- language: lang-html --&gt;

    @Node(&quot;Person&quot;)
    public class Person {
    	
    	/** Attributes **/
    	
    	@Id
    	@GeneratedValue
    	private Long id;
    	
    	@Property(name = &quot;name&quot;)
    	private String name;
      
      @Relationship(type = &quot;HAVE&quot;)
    	protected Set&lt;RelationshipValue&gt; values;
    }

    @Node(&quot;Book&quot;)
    public class Book {
    	
    	/** Attributes **/
    	
    	@Id
    	@GeneratedValue
    	private Long id;
    	
    	@Property(name = &quot;title&quot;)
    	private String title;
    }

    @RelationshipProperties
    public class RelationshipValue {

    	/** Attributes **/

    	@Id
    	@GeneratedValue
    	private Long id;

    	@Property(name = &quot;quantity&quot;)
    	private int quantity;
      
      @TargetNode
    	private Book book;
      
    }

&lt;!-- end snippet --&gt;

if it was a simple relationship the query will be as bellow

curl POST &#39;http://server/person/1/books&#39; --h &#39;Content-Type: text/uri-list&#39;-d&#39;http://server/book/2&#39;

but how can we do to include quantity value?",1623264540,https://stackoverflow.com/q/67910112,Amine,"['rest', 'spring', 'neo4j', 'relationship']"
67903724,Data storage in Neo4j,"as a new user of  Neo4j, i&#39;m interested to learn more about the way that data are stored.  For example, when creating many relationships  of the same type (HAS_FRIEND), is it stored once  or it&#39;s duplicated at every creation? Same question, when creating nodes that have the same value of a property, thank you for answering",1623239997,https://stackoverflow.com/q/67903724,Thiziri,"['neo4j', 'spring-data-neo4j', 'neo4j-ogm']"
67897925,Related to duplicate nodes in neo4j,"I have two CSV files where one file contains a person&#39;s name, id, allergy. So for 1 person, there are repeated allergies and repeated nodes get to create in the graph. For the graph am using neo4j.


![image of graph](https://i.stack.imgur.com/08V3i.png)

I want a graph that will create a single node for repeated same cell data. 

I use this query

    LOAD CSV WITH HEADERS FROM &quot;file:///patients.csv&quot; as row 
    CREATE (a: allergy {name: row.ANAME}) 
    WITH row, a
    MERGE (p:Patient {name:row.NAME, id:row.Id})
    MERGE (p)- [:has_alleries] -&gt; (al:allergy{name:&quot;allergies&quot;}) 
    WITH row,a,al
    FOREACH (row IN CASE WHEN row.ANAME IS NULL THEN [] ELSE [1] END |
    MERGE (al) &lt;- [:allergy] - (a))

can anyone help?

",1623215204,https://stackoverflow.com/q/67897925,Kunika Kulkarni,"['cypher', 'neo4j']"
67891016,Neo4j DatabaseManagementServiceBuilder not working in Maven,"I am trying to create a user defined procedure (plugin) that involve querying Neo4j 4.x Enterprise. I&#39;m using Maven as suggested by Neo4j.

My pow.xml dependencies are:

        &lt;dependencies&gt;
      &lt;dependency&gt;
            &lt;groupId&gt;org.neo4j.test&lt;/groupId&gt;
            &lt;artifactId&gt;neo4j-harness&lt;/artifactId&gt;
            &lt;version&gt;${neo4j.version}&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.neo4j.driver&lt;/groupId&gt;
            &lt;artifactId&gt;neo4j-java-driver&lt;/artifactId&gt;
            &lt;version&gt;4.2.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.neo4j/neo4j-cypher --&gt;
       &lt;dependency&gt;
           &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
           &lt;artifactId&gt;neo4j-cypher&lt;/artifactId&gt;
           &lt;version&gt;4.2.7&lt;/version&gt;
       &lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.neo4j/neo4j-graphdb-api --&gt;
       &lt;dependency&gt;
           &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
           &lt;artifactId&gt;neo4j-graphdb-api&lt;/artifactId&gt;
           &lt;version&gt;4.2.7&lt;/version&gt;
       &lt;/dependency&gt;
       &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.12&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
            &lt;artifactId&gt;neo4j-bolt&lt;/artifactId&gt;
            &lt;version&gt;4.2.6&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- https://jar-download.com/maven-repository-class-search.php?search_box=org.neo4j.dbms.api.DatabaseManagementServiceBuilder;--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
            &lt;artifactId&gt;neo4j&lt;/artifactId&gt;
            &lt;version&gt;4.2.7&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
            &lt;artifactId&gt;neo4j-procedure-api&lt;/artifactId&gt;
            &lt;version&gt;4.2.7&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;


This java file gives me errors at the step where it tries to instantiate the data management service, e.g.: DatabaseManagementService managementService = new DatabaseManagementServiceBuilder( databaseDirectory ).build(). I have not yet added the query/result code.

    package org.neo4j.neo4j_genealogy;
    import java.io.IOException;
    import java.nio.file.Path;
    import java.util.Iterator;
    import java.util.List;
    import java.util.Map;
    import java.util.Map.Entry;

    import org.neo4j.dbms.api.DatabaseManagementService;
    import org.neo4j.dbms.api.DatabaseManagementServiceBuilder;
    import org.neo4j.graphdb.GraphDatabaseService;
    import org.neo4j.graphdb.Node;
    import org.neo4j.graphdb.Result;
    import org.neo4j.graphdb.Transaction;
    import org.neo4j.io.fs.FileUtils;

    import static org.neo4j.configuration.GraphDatabaseSettings.DEFAULT_DATABASE_NAME;


public class personQuery {
     
    public static void getPerson(int RN) {
        DatabaseManagementService managementService = new DatabaseManagementServiceBuilder( databaseDirectory ).build();
        GraphDatabaseService db = managementService.database( DEFAULT_DATABASE_NAME );


    }
    
    public static void main(String args[]) {
        getPerson(1);
    }
}


Somehow, the required dependency is not loading properly.

How do I fix this? 







",1623169861,https://stackoverflow.com/q/67891016,David A Stumpf,"['maven', 'neo4j', 'neo4j-plugin']"
67887727,Exception when writing transactions in Neo4j python driver: &quot;neo4j.exceptions.AuthError: {code: None} {message: None}&quot;,"I am trying to run the example mentioned in the documents - https://neo4j.com/developer/python/#_resources


    class HelloWorldExample:

        def __init__(self, uri, user, password):
            self.driver = GraphDatabase.driver(uri, auth=(user, password))

        def close(self):
            self.driver.close()

        def print_greeting(self, message):
            with self.driver.session() as session:
                 greeting = session.write_transaction(self._create_and_return_greeting, message)
                 print(greeting)

        @staticmethod
        def _create_and_return_greeting(tx, message):
            result = tx.run(&quot;CREATE (a:Greeting) &quot;
                        &quot;SET a.message = $message &quot;
                        &quot;RETURN a.message + &#39;, from node &#39; + id(a)&quot;, message=message)
            return result.single()[0]


    if __name__ == &quot;__main__&quot;:
        greeter = HelloWorldExample(&quot;bolt://localhost:7687&quot;, &quot;neo4j&quot;, &quot;password&quot;)
        greeter.print_greeting(&quot;hello, world&quot;)
        greeter.close()

Error is - 


    Traceback (most recent call last):
      File &quot;createneodb.py&quot;, line 26, in &lt;module&gt;
        greeter.print_greeting(&quot;hello, world&quot;)
      File &quot;createneodb.py&quot;, line 13, in print_greeting
        greeting = session.write_transaction(self._create_and_return_greeting, message)
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\work\simple.py&quot;, line 435, in write_transaction
        return self._run_transaction(WRITE_ACCESS, transaction_function, *args, **kwargs)
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\work\simple.py&quot;, line 336, in _run_transaction
        self._open_transaction(access_mode=access_mode, database=self._config.database, metadata=metadata, timeout=timeout)
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\work\simple.py&quot;, line 271, in _open_transaction
        self._connect(access_mode=access_mode, database=database)
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\work\simple.py&quot;, line 122, in _connect
        bookmarks=self._bookmarks
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\io\__init__.py&quot;, line 805, in acquire
        return self._acquire(self.address, timeout)
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\io\__init__.py&quot;, line 660, in _acquire
        connection = self.opener(address, timeout)
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\io\__init__.py&quot;, line 789, in opener
        **pool_config
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\io\__init__.py&quot;, line 340, in open
        connection.hello()
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\io\_bolt4.py&quot;, line 98, in hello
        self.fetch_all()
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\io\__init__.py&quot;, line 517, in fetch_all
        detail_delta, summary_delta = self.fetch_message()
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\io\_bolt4.py&quot;, line 271, in fetch_message
        response.on_failure(summary_metadata or {})
      File &quot;C:\Users\omras\AppData\Local\Programs\Python\Python37\lib\site-packages\neo4j\io\_common.py&quot;, line 202, in on_failure
        raise AuthError(message)
    neo4j.exceptions.AuthError: {code: None} {message: None}


Details: 

The driver object was successfully initialized as well as the session object. However the problem is when calling **write_transaction**. I am not able to understand the source of the problem. 


",1623158088,https://stackoverflow.com/q/67887727,Om Rastogi,"['neo4j-python-driver', 'neo4j']"
67884918,How to find all maximal cliques in Neo4J?,"I have a large graph (millions of nodes/edges, no parallel edges or loops)  in my neo4j database where nodes represent persons and edges represent friendship. I wish to find all maximal cliques (considering edges as undirected) with at least `k` nodes.

A maximal clique is a clique that cannot be extended by including one more adjacent vertex, meaning it is not a subset of a larger clique

I looked into neo4j&#39;s Graph Data Science library, but could only find an algorithm for triangle cliques. Also, there seems to be a procedure `apoc.algo.cliques` in apoc v3.5, but it was marked as a work in progress. I didn&#39;t find any clique algorithm in the recent versions of apoc.

Is there some cypher query or neo4j plugin that could help me? Any other way to approach this?",1623144256,https://stackoverflow.com/q/67884918,mrpandey,"['neo4j', 'cypher', 'graph-theory', 'graph-databases']"
67881316,How to prevent unnecessary encoding in Wikidata query from Neo4j?,"I am trying to run through the tutorial here: https://www.markhneedham.com/blog/2020/02/04/neo4j-enriching-existing-graph-wikidata-sparql-api/

However, when I get to the Cypher query that produces the Table 3 results:

```
MATCH (player:Player)
WHERE player.name = &quot;Nick Kyrgios&quot;
WITH &quot;SELECT *
WHERE { ?person wdt:P106 wd:Q10833314 ;
                rdfs:label \&quot;&quot; + player.name + &quot;\&quot;@en ;
                wdt:P569 ?dateOfBirth ;
                wdt:P27 [ rdfs:label ?countryName ] .
       filter(lang(?countryName) = \&quot;en\&quot;)
}&quot; AS sparql
CALL apoc.load.jsonParams(
  &quot;https://query.wikidata.org/sparql?query=&quot; + apoc.text.urlencode(sparql),
  { Accept: &quot;application/sparql-results+json&quot;},
  null
)
YIELD value
RETURN value
```

I get the following error: 

&gt;Failed to invoke procedure `apoc.load.jsonParams`: Caused by: java.lang.RuntimeException: Can&#39;t read url or key https://query.wikidata.org/sparql?query=SELECT+*%250AWHERE+%257B+%253Fperson+wdt%253AP106+wd%253AQ10833314+%253B%250A++++++++++++++++rdfs%253Alabel+%2522Nick+Kyrgios%2522%2540en+%253B%250A++++++++++++++++wdt%253AP569+%253FdateOfBirth+%253B%250A++++++++++++++++wdt%253AP27+%255B+rdfs%253Alabel+%253FcountryName+%255D+.%250A+++++++filter%2528lang%2528%253FcountryName%2529+%253D+%2522en%2522%2529%250A%257D as json: Server returned HTTP response code: 400 for URL: https://query.wikidata.org/sparql?query=SELECT+*%250AWHERE+%257B+%253Fperson+wdt%253AP106+wd%253AQ10833314+%253B%250A++++++++++++++++rdfs%253Alabel+%2522Nick+Kyrgios%2522%2540en+%253B%250A++++++++++++++++wdt%253AP569+%253FdateOfBirth+%253B%250A++++++++++++++++wdt%253AP27+%255B+rdfs%253Alabel+%253FcountryName+%255D+.%250A+++++++filter%2528lang%2528%253FcountryName%2529+%253D+%2522en%2522%2529%250A%257D

When I run the Sparql query by itself on Wikidata&#39;s sandbox, I get no errors. I think the issue is related to  encoding (the URL in the error message has additional &quot;25&quot;s, presumably because it is double-encoding all of the % signs). When I copy/paste the URL from the error message and manually remove all of the 25&#39;s, it connects to Wikidata and returns a JSON file just fine.

I have tried Cypher&#39;s REPLACE() function to eliminate the extra 25&#39;s but it doesn&#39;t get rid of them and I end up with the same error message.

Has anyone encountered this problem and found a way to fix it?

Ubuntu 20.04, Neo4j Desktop 1.4.5, I installed the APOC plugin",1623125591,https://stackoverflow.com/q/67881316,potato2049,"['neo4j', 'encoding', 'sparql']"
67880124,Neo4j Update node with aggregated count,"I&#39;m trying to take a count and set a property of a node with the value. e.g the following query:

    MATCH (n:node)-[]-&gt;() return n, count(*)

returns the node alongside each of the counts. I would expect to be able to do something like this:

    MATCH (n:node)-[]-&gt;() set n.relationCount = count(*)

However executing the above returns an error:

    Aggregations should not be used like this.",1623113044,https://stackoverflow.com/q/67880124,Sancarn,"['neo4j', 'cypher']"
67879015,Create 2 relationships with one match query?,"I wanted to turn:

    MATCH (a:link)
      MATCH (b:node {id:a.us_node_id})
        CREATE (a)-[r:ds_link]-&gt;(b)
    MATCH (a:link)
      MATCH (b:node {id:a.us_node_id})
        CREATE (b)-[r:us_node]-&gt;(a)

into something like:

    MATCH (a:link)
      MATCH (b:node {id:a.us_node_id})
        CREATE (a)-[r:ds_link]-&gt;(b),
        CREATE (b)-[r:us_node]-&gt;(a)

Is this doable? Because the 2nd looks a lot neater than the 1st.",1623102008,https://stackoverflow.com/q/67879015,Sancarn,"['cypher', 'neo4j']"
67865822,neo4j two fulltext searches in one subquery,"I am trying to find the highest scoring fulltext query from two nodes:

```
(node1)-[:ACTED_IN]-(node2)

Where node1 can be e.g., a search:
CALL db.index.fulltext.queryNodes(&#39;movie_search&#39;, &#39;Matrix&#39;)
YIELD score, node as node1 

And node2 is the analogous: 
CALL db.index.fulltext.queryNodes(&#39;actor search&#39;, &#39;Fish&#39;)
YIELD score as scoreC, node as nodeC 
```

This may be a subsearch (i.e., subsetting the graph after the first search). I am assuming this may be a subquery, but still trying to understand how this can be done using subqueries.

Ideally the top relationship will return a pair between the relation of Movie and Actor according to the fulltext search

```
#Movie, Actor,
&quot;The Matrix&quot;, &quot;Laurence Fishburne&quot;
&quot;The Matrix Reloaded&quot;, &quot;Laurence Fishburne&quot;
&quot;Matrix Revolutions&quot;, &quot;Laurence Fishburne&quot;
&quot;Apocalypse Now&quot;, &quot;Laurence Fishburne # this one would have a lower score, but probably also show up
...
```",1623038808,https://stackoverflow.com/q/67865822,robolivares,"['neo4j', 'cypher']"
67856885,neo4j 2.5.5 with spring boot application store node but relationship doesn&#39;t stored,"i&#39;m using neo4j in my spring boot application and i have this entity:
```
import java.util.ArrayList;
import java.util.List;

import javax.validation.constraints.Email;

import org.springframework.data.neo4j.core.schema.GeneratedValue;
import org.springframework.data.neo4j.core.schema.Id;
import org.springframework.data.neo4j.core.schema.Node;
import org.springframework.data.neo4j.core.schema.Relationship;
import org.springframework.data.neo4j.core.schema.Relationship.Direction;

import com.diaspotransfer.transferbackend.enums.State;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Node
@Data @NoArgsConstructor @AllArgsConstructor
public class Member {
	
	@Id
	@GeneratedValue
	private Long id;
	
	private String names;
	
	private int card;
	
	private int passportNumber;
	
	private int ssi;
	
	private String whatsapp;
	
	private String twitter;
	
	private String phoneNumber;
	
	@Email
	private String email;
	
	private String password;
	
	private String country;
	
	private String city;
	
	private boolean state;
	
	private State sponsoringState;

	@Relationship(type = &quot;SPONSORING&quot;, direction = Direction.INCOMING)
	private Member godfather;
	
	@Relationship(type = &quot;SPONSORING&quot;, direction = Direction.OUTGOING)
	private List&lt;Member&gt; godsons = new ArrayList&lt;Member&gt;();
	
}

```
With repository:
```
import java.util.List;
import java.util.Optional;

import org.springframework.data.neo4j.repository.Neo4jRepository;
import org.springframework.stereotype.Repository;

import com.diaspotransfer.transferbackend.entity.Member;
import com.diaspotransfer.transferbackend.enums.State;

@Repository
public interface MemberRepository extends Neo4jRepository&lt;Member, Long&gt;{

	public Optional&lt;Member&gt; findByCard(int idCard);
	
	public Optional&lt;Member&gt; findByEmail(String email);
	
	public Optional&lt;Member&gt; findByPhoneNumber(String phoneNumber);

}

```
Service:
```
	public Member saveMember(String names, String email, String phoneNumber, int idCard, int passportNumber, int ssi, String whatsapp, String twitter, String country,
			String city, String phoneSponsor) {

		Optional&lt;Member&gt; member = memberRepo.findByEmail(email);
		Optional&lt;Member&gt; sponsor = memberRepo.findByPhoneNumber(phoneSponsor);
		if(member.isEmpty()) {
			member = memberRepo.findByCard(idCard);
			if(member.isEmpty()) {
				member = memberRepo.findByPhoneNumber(phoneNumber);
				if(member.isEmpty()) {
					if(!sponsor.isEmpty()) {
						Member newMember = new Member();
						newMember.setCard(idCard);
						newMember.setPhoneNumber(phoneNumber);
						newMember.setEmail(email);
						newMember.setCity(city);
						newMember.setCountry(country);
						newMember.setNames(names);
						newMember.setState(true);
						newMember.setPassportNumber(passportNumber);
						newMember.setSsi(ssi);
						newMember.setWhatsapp(whatsapp);
						newMember.setTwitter(twitter);
						newMember.setSponsoringState(State.NO_RESPONSE);
						newMember.setGodfather(sponsor.get());
						return memberRepo.save(newMember);
					}else throw new RuntimeException(&quot;Sponsor not found&quot;);
				}else throw new RuntimeException(&quot;Phone already used&quot;);
			}else throw new RuntimeException(&quot;ID&#39;s Card already used&quot;);
		}else throw new RuntimeException(&quot;Email already used&quot;);
	}
```
And RestController:
```
	@PutMapping
	public Member save(@RequestBody FormMember form) {
		
		return memberService.saveMember(form.getNames(), form.getEmail(), form.getPhoneNumber(), form.getCard(), form.getPassportNumber(), form.getSsi(), form.getWhatsapp(), form.getTwitter(), form.getCountry(), form.getCity(), form.getSponsor());
	}
```
I tried with PostMapping and PutMapping but when i store a new member with ARC the member is stored but the relationship between him and his sponsor is not stored. the response conatains the relation as follow by the ARC:
```
{
&quot;id&quot;: 6,
&quot;names&quot;: &quot;OUAFO WILLY&quot;,
&quot;card&quot;: 7,
&quot;passportNumber&quot;: 2,
&quot;ssi&quot;: 3,
&quot;whatsapp&quot;: null,
&quot;twitter&quot;: null,
&quot;phoneNumber&quot;: &quot;+3456787654&quot;,
&quot;email&quot;: &quot;ouafo@gmail.com&quot;,
&quot;password&quot;: null,
&quot;country&quot;: &quot;Espagne&quot;,
&quot;city&quot;: &quot;Madrid&quot;,
&quot;state&quot;: true,
&quot;sponsoringState&quot;: &quot;NO_RESPONSE&quot;,
&quot;godfather&quot;: {
&quot;id&quot;: 0,
&quot;names&quot;: &quot;SIEMBE Junior&quot;,
&quot;card&quot;: 1,
&quot;passportNumber&quot;: 2,
&quot;ssi&quot;: 3,
&quot;whatsapp&quot;: null,
&quot;twitter&quot;: null,
&quot;phoneNumber&quot;: &quot;+237694140369&quot;,
&quot;email&quot;: &quot;siembejunior@gmail.com&quot;,
&quot;password&quot;: null,
&quot;country&quot;: &quot;Cameroun&quot;,
&quot;city&quot;: &quot;Bafoussam&quot;,
&quot;state&quot;: true,
&quot;sponsoringState&quot;: &quot;ACCEPTED&quot;,
&quot;godfather&quot;: null,
&quot;godsons&quot;: [],
&quot;inTransactions&quot;: [],
&quot;outTransactions&quot;: [],
},
&quot;godsons&quot;: [],
&quot;inTransactions&quot;: [],
&quot;outTransactions&quot;: [],
}
```
What can be the problem please?",1622965880,https://stackoverflow.com/q/67856885,junior siembe,"['spring-boot', 'cypher', 'neo4j', 'spring', 'java']"
67852143,How can I upload database data to Neo4j?,"Using an pan-genome building tool I&#39;ve ended with a database in an unfamiliar format to me which in theory should be explorable by the Neo4j browser.
Nevertheless I can&#39;t seem to find any way to achieve so and any mention on how to do it in any bibliography besides the instructions of the manual provided by the author of said tool.

I&#39;ve tried to do this using Neo4j community edition server (v. 3.5.3) with the example file same as the instructions suggest but it just doesn&#39;t seem to detect the database showing only the default one.

The mentioned part of the tutorial can be found here: https://www.bioinformatics.nl/pangenomics/manual/tutorial_part3/",1622913707,https://stackoverflow.com/q/67852143,vyaches,"['bioinformatics', 'neo4j']"
67844314,Linear regression model in neoj4.1,"I&#39;m trying to compute predictions for certain properties in group of nodes, it resembles the solution provided by Lauren Shin in https://towardsdatascience.com/graphs-and-ml-multiple-linear-regression-c6920a1f2e70
except that the model is built for a group of nodes. However, I tried installing this package in neo4j 4.1 but it gave some java errors. As a solution I tried first to look into GDS available functions provided by neo4j, but nothing worked well as this is neither a classification problem nor a link prediction problem. Therefore, I have decide to go for the apoc.math.regr () function and would continue the missing pieces of the output of this function as cyphers, so I have written the following cypher 

    MATCH (r:route)
    // for each route, order the routes by their score 
    WITH r ORDER BY r.Date_ID DESC 
    // for each route, group the Route_ID (now ordered by their dates) 
    WITH r, COLLECT(r.Route_ID) AS routes 
    // iterate over the sequence 0..number_of_routes 
    UNWIND range(0,size(routes)) AS i 
    MATCH (r:route)
    WHERE r.Route_ID=routes[i] 
    WITH r,i,routes 
    CALL apoc.math.regr(r.Route_ID, &#39;State_BandwidthUsed&#39;, &#39;Date_ID&#39;) YIELD r2
    RETURN r2

the problem of this cypher is that the regr function is expecting a label and not a subset of nodes. Can you help me either fixing the package to be compatible with neo4j 4.1 or correcting the cypher query. Or wether there is a function I&#39;m missing in the GDS library. I&#39;m willing to work on editing the package but would like some directions to start with. Appreciate any type of help as this is a problem I&#39;m trying to solve for couple of days now",1622843045,https://stackoverflow.com/q/67844314,Fighter,"['linear-regression', 'cypher', 'neo4j']"
67843656,Embedded Neo4j with Graph Data Science - BFS Procedure appears to be missing,"The documentation here https://neo4j.com/docs/graph-data-science/1.1/algorithms/bfs/#algorithms-bfs describes a callable &quot;gds.alpha.bfs.stream&quot;.

In order to call that, to the best of my knowledge, it needs to be registered with the embedded DB. Something along the lines of

    Procedures proceduresService = ((GraphDatabaseAPI) graphDb).getDependencyResolver().resolveDependency(Procedures.class);
    proceduresService.registerProcedure(AllShortestPathsProc.class, true);

Otherwise neo4j will throw an Exception, informing us of our misdeeds:
&gt;There is no procedure with the name `gds.alpha.bfs.stream` registered for this database instance. Please ensure you&#39;ve spelled the procedure name correctly and that the procedure is properly deployed.

However, I can&#39;t seem to find any *Proc.class to include for BFS or BreadthFirstSearch.

Is this documentation incorrect? 
Do i need a different jar to use the described bfs algorithm?


OT: I&#39;m linking to an older version of the documentation because it supports a maxCost condition for traversed relations. This is missing from newer versions (which also don&#39;t seem to actually *have* have BFSProc)",1622838903,https://stackoverflow.com/q/67843656,Stefan Schilling,"['java', 'neo4j-embedded', 'graph-data-science', 'neo4j']"
67839145,How can I load json and use it inside apoc.periodic.iterate,"I am trying add some test data to all of my nodes of type `A`. I want to use a json file which contains that dummy data: 
```
[
   {
      a: &quot;x&quot;,
      b: 1,
      c: 3
   },
   {
      a: &quot;y&quot;,
      b: 5,
      c: 4
   },
   ...
]
```

For every node of type `A`, all these objects should become one node of type `B`. They should also have a relationship.
So I tried it like this using `apoc.periodic.iterate` (because I have millions of nodes) and `apoc.load.json`:
```
CALL apoc.periodic.iterate(
    &#39;MATCH (n:A) RETURN n&#39;,
    &#39;CALL apoc.load.json(&quot;file:///values.json&quot;) YIELD value
     WITH value
     FOREACH (m in value |
         CREATE (v:B { a: m.a, b: m.b, c: m.c })
         MERGE (n)-[r:REL]-&gt;(v)&#39;,
     {batchSize:500})
YIELD batches, total
RETURN batches, total
```

However this did nothing at all.
I also tried to load the json outside of `iterate`, so I dont have to read it for each node, but I could not find a way to use it inside then.

How could I get this to work?

**Edit:**
This is another query I tried:
```
CALL apoc.load.json(&quot;file:///values.json&quot;) YIELD value
WITH value AS value
CALL apoc.periodic.iterate(&#39;MATCH (n:A) RETURN n&#39;, &#39;FOREACH(m in $value | CREATE (v:B {a:m.a, b: m.b, c: m.c}) MERGE (n)-[r:REL]-&gt;(v))&#39;, {batchSize:500}) YIELD batches, total
RETURN batches, total
```
While running I tried checking if something happens using `MATCH (n:A)-[]-(v:B) RETURN n, v LIMIT 100` but it seems that nothing is being updated. 

This is what it should look like (red node = type A):
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/bEwDN.png",1622817432,https://stackoverflow.com/q/67839145,cb420,"['neo4j-apoc', 'neo4j', 'cypher']"
67836894,I can not connect my SpringbootApplication with Neo4j,"

I&#39;m trying to run my spring boot web application with Neo4j. I&#39;m using this but can&#39;t seem to get things working.
I always get a error which begins with &quot;java.lang.IllegalStateException: Failed to execute CommandLineRunner&quot;

I am using Springboot version 2.2.2


Here is my pom.xml


```
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
	xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;2.2.2.RELEASE&lt;/version&gt;
		&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
	&lt;/parent&gt;
	&lt;groupId&gt;com.example&lt;/groupId&gt;
	&lt;artifactId&gt;accessing-data-neo4j&lt;/artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
	&lt;name&gt;accessing-data-neo4j&lt;/name&gt;
	&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;

	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;

	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-data-neo4j&lt;/artifactId&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
			&lt;exclusions&gt;
				&lt;exclusion&gt;
					&lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
					&lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
				&lt;/exclusion&gt;
			&lt;/exclusions&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;

&lt;/project&gt;

```
  

Here is my SpringApplicationClass:


```

@SpringBootApplication
@EnableNeo4jRepositories
public class AccessingDataNeo4jApplication {

  private final static Logger log = LoggerFactory.getLogger(AccessingDataNeo4jApplication.class);

  public static void main(String[] args) throws Exception {
    SpringApplication.run(AccessingDataNeo4jApplication.class, args);
  }

  @Bean
  CommandLineRunner demo(PersonRepository personRepository, PlaceRepository placeRepository) {
    return args -&gt; {

      // ===========================================================================================
      // == places
      // ===========================================================================================

      personRepository.deleteAll();
      placeRepository.deleteAll();

      Place goldbekmarkt = new Place(&quot;Goldbekmarkt&quot;);
      Place museum = new Place(&quot;Museum&quot;);
      Place stadtpark = new Place(&quot;Stadtpark&quot;);
      Place hagenbecksTierpark = new Place(&quot;HagenbecksTierpark&quot;);
      Place stMichaelis = new Place(&quot;St.Michaelis&quot;);

      List&lt;Place&gt; places = Arrays
          .asList(goldbekmarkt, museum, stadtpark, hagenbecksTierpark, stMichaelis);
      placeRepository.saveAll(places);

      // ===========================================================================================
      // == persons
      // ===========================================================================================

      Person orhan = new Person(&quot;Orhan&quot;);
      Person yusuf = new Person(&quot;Yusuf&quot;);
      Person steph = new Person(&quot;Steph&quot;);
      Person lebron = new Person(&quot;Lebron&quot;);
      Person kevin = new Person(&quot;Kevin&quot;);
      Person kim = new Person(&quot;Kim&quot;);
      Person tobias = new Person(&quot;Tobias&quot;);
      Person robin = new Person(&quot;Robin&quot;);
      Person niels = new Person(&quot;Niels&quot;);
      Person daniel = new Person(&quot;Daniel&quot;);
      Person michael = new Person(&quot;Michael&quot;);
      Person elia = new Person(&quot;Elia&quot;);

      List&lt;Person&gt; persons = Arrays
          .asList(orhan, yusuf, steph, lebron, kevin, kim, tobias, robin, niels, daniel, michael,
              elia);
      personRepository.saveAll(persons);

      // ===========================================================================================
      // == connect places with persons
      // ===========================================================================================

      //List&lt;WasInPlace&gt; wasInPlaces = new ArrayList();
      //wasInPlaces.add(new WasInPlace(new Date(), 20, orhan, winterhude));

      goldbekmarkt.addPlace(new WasInPlace(new Date(), 20, orhan, goldbekmarkt));
      goldbekmarkt.addPlace(new WasInPlace(new Date(), 20, robin, goldbekmarkt));
      hagenbecksTierpark.addPlace(new WasInPlace(new Date(), 20, steph, hagenbecksTierpark));
      hagenbecksTierpark.addPlace(new WasInPlace(new Date(), 20, lebron, hagenbecksTierpark));
      museum.addPlace(new WasInPlace(new Date(), 20, kevin, museum));
      museum.addPlace(new WasInPlace(new Date(), 20, yusuf, museum));
      museum.addPlace(new WasInPlace(new Date(), 20, tobias, museum));
      goldbekmarkt.addPlace(new WasInPlace(new Date(), 20, tobias, goldbekmarkt));
      stadtpark.addPlace(new WasInPlace(new Date(), 20, kim, stadtpark));
      stMichaelis.addPlace(new WasInPlace(new Date(), 20, niels, stMichaelis));
      stMichaelis.addPlace(new WasInPlace(new Date(), 20, daniel, stMichaelis));
      stMichaelis.addPlace(new WasInPlace(new Date(), 20, michael, stMichaelis));
      stMichaelis.addPlace(new WasInPlace(new Date(), 20, elia, stMichaelis));
      stadtpark.addPlace(new WasInPlace(new Date(), 20, yusuf, stadtpark));

      placeRepository.saveAll(places);

      // ===========================================================================================
      // == connect person with person
      // ===========================================================================================

      orhan.addContact(yusuf, new Date(), 10);
      orhan.addContact(steph, new Date(), 10);
      orhan.addContact(lebron, new Date(), 10);
      yusuf.addContact(kevin, new Date(), 20);
      yusuf.addContact(kim, new Date(), 20);
      steph.addContact(kim, new Date(), 10);

      personRepository.saveAll(persons);

      // ===========================================================================================
      // == tests
      // ===========================================================================================

      System.out.println();
      System.out.println(&quot;=======================================================================&quot;);
      System.out.println(&quot;== TEST&quot;);
      System.out.println(&quot;=======================================================================&quot;);
      System.out.print(yusuf.getName() + &quot;: &quot;);
      System.out
          .println(yusuf.contacts.stream().map(o -&gt;
              o.getEnd().getName()).collect(joining(&quot;,&quot;)));
    };
  }

}
```
Here is my Node:
```
@NodeEntity
public class Person {

  @Id
  @GeneratedValue
  private Long id;

  private String name;

  @Relationship(type = &quot;befand_sich_an_ort&quot;)
  private Set&lt;Place&gt; places;

  @Relationship(type = HadContactWith.TYPE, direction = Relationship.UNDIRECTED)
  public Set&lt;HadContactWith&gt; contacts = new HashSet&lt;&gt;();

  public Person(String name) {
    this.name = name;
  }

  public void addContact(Person target, Date date, int count) {
    this.contacts.add(new HadContactWith(this, target, date, count));
  }

  public Set&lt;Place&gt; getPlaces() {
    return places;
  }

  public void setPlaces(Set&lt;Place&gt; places) {
    this.places = places;
  }

  public String getName() {
    return name;
  }

  public void setName(String name) {
    this.name = name;
  }

  public Set&lt;HadContactWith&gt; getContacts() {
    return contacts;
  }

  public void setContacts(Set&lt;HadContactWith&gt; contacts) {
    this.contacts = contacts;
  }

  public Long getId() {
    return id;
  }

  public void setId(Long id) {
    this.id = id;
  }
}



```

Here is my Error:


```

Error starting ApplicationContext. To display the conditions report re-run your application with &#39;debug&#39; enabled.
2021-06-04 13:27:32.912 ERROR 6188 --- [           main] o.s.boot.SpringApplication               : Application run failed

java.lang.IllegalStateException: Failed to execute CommandLineRunner
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:787) [spring-boot-2.2.4.RELEASE.jar:2.2.4.RELEASE]
	at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:768) [spring-boot-2.2.4.RELEASE.jar:2.2.4.RELEASE]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:322) [spring-boot-2.2.4.RELEASE.jar:2.2.4.RELEASE]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1226) [spring-boot-2.2.4.RELEASE.jar:2.2.4.RELEASE]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1215) [spring-boot-2.2.4.RELEASE.jar:2.2.4.RELEASE]
	at com.example.accessingdataneo4j.AccessingDataNeo4jApplication.main(AccessingDataNeo4jApplication.java:26) [main/:na]
Caused by: org.springframework.transaction.CannotCreateTransactionException: Could not open Neo4j Session for transaction; nested exception is org.neo4j.ogm.exception.ConnectionException: Could not create driver instance
	at org.springframework.data.neo4j.transaction.Neo4jTransactionManager.doBegin(Neo4jTransactionManager.java:204) ~[spring-data-neo4j-5.2.4.RELEASE.jar:5.2.4.RELEASE]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:376) ~[spring-tx-5.2.3.RELEASE.jar:5.2.3.RELEASE]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:572) ~[spring-tx-5.2.3.RELEASE.jar:5.2.3.RELEASE]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:360) ~[spring-tx-5.2.3.RELEASE.jar:5.2.3.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:99) ~[spring-tx-5.2.3.RELEASE.jar:5.2.3.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.2.3.RELEASE.jar:5.2.3.RELEASE]
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:139) ~[spring-tx-5.2.3.RELEASE.jar:5.2.3.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.2.3.RELEASE.jar:5.2.3.RELEASE]
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:95) ~[spring-aop-5.2.3.RELEASE.jar:5.2.3.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.2.3.RELEASE.jar:5.2.3.RELEASE]
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:212) ~[spring-aop-5.2.3.RELEASE.jar:5.2.3.RELEASE]
	at com.sun.proxy.$Proxy83.deleteAll(Unknown Source) ~[na:na]
	at com.example.accessingdataneo4j.AccessingDataNeo4jApplication.lambda$demo$1(AccessingDataNeo4jApplication.java:37) [main/:na]
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:784) [spring-boot-2.2.4.RELEASE.jar:2.2.4.RELEASE]
	... 5 common frames omitted
Caused by: org.neo4j.ogm.exception.ConnectionException: Could not create driver instance
	at org.neo4j.ogm.drivers.bolt.driver.BoltDriver.initializeDriver(BoltDriver.java:168) ~[neo4j-ogm-bolt-driver-3.2.6.jar:3.2.6]
	at org.neo4j.ogm.drivers.bolt.driver.BoltDriver.checkDriverInitialized(BoltDriver.java:146) ~[neo4j-ogm-bolt-driver-3.2.6.jar:3.2.6]
	at org.neo4j.ogm.drivers.bolt.driver.BoltDriver.lambda$null$0(BoltDriver.java:132) ~[neo4j-ogm-bolt-driver-3.2.6.jar:3.2.6]
	at org.neo4j.ogm.session.transaction.DefaultTransactionManager.openTransaction(DefaultTransactionManager.java:75) ~[neo4j-ogm-core-3.2.6.jar:3.2.6]
	at org.neo4j.ogm.session.Neo4jSession.beginTransaction(Neo4jSession.java:541) ~[neo4j-ogm-core-3.2.6.jar:3.2.6]
	at org.springframework.data.neo4j.transaction.Neo4jTransactionManager.doBegin(Neo4jTransactionManager.java:182) ~[spring-data-neo4j-5.2.4.RELEASE.jar:5.2.4.RELEASE]
	... 18 common frames omitted
Caused by: org.neo4j.driver.exceptions.ServiceUnavailableException: Unable to connect to localhost:7687, ensure the database is running and that there is a working network connection to it.
	at org.neo4j.driver.internal.util.Futures.blockingGet(Futures.java:143) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at org.neo4j.driver.internal.util.Futures.blockingGet(Futures.java:113) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at org.neo4j.driver.internal.InternalDriver.verifyConnectivity(InternalDriver.java:159) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at org.neo4j.ogm.drivers.bolt.driver.BoltDriver.initializeDriver(BoltDriver.java:165) ~[neo4j-ogm-bolt-driver-3.2.6.jar:3.2.6]
	... 23 common frames omitted
	Suppressed: org.neo4j.driver.internal.util.ErrorUtil$InternalExceptionCause: null
		at org.neo4j.driver.internal.async.connection.ChannelConnectedListener.databaseUnavailableError(ChannelConnectedListener.java:76) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.async.connection.ChannelConnectedListener.operationComplete(ChannelConnectedListener.java:70) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.async.connection.ChannelConnectedListener.operationComplete(ChannelConnectedListener.java:37) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:577) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:570) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:549) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:490) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:615) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:608) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:117) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.fulfillConnectPromise(AbstractNioChannel.java:321) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:337) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:688) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:635) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:552) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:514) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.SingleThreadEventExecutor$6.run(SingleThreadEventExecutor.java:1044) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
		at java.lang.Thread.run(Thread.java:748) ~[na:1.8.0-262]
Caused by: org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: no further information: localhost/127.0.0.1:7687
Caused by: java.net.ConnectException: Connection refused: no further information
	at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[na:1.8.0-262]
	at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:714) ~[na:1.8.0-262]
	at org.neo4j.driver.internal.shaded.io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:327) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at org.neo4j.driver.internal.shaded.io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:334) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:688) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:635) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:552) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:514) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.SingleThreadEventExecutor$6.run(SingleThreadEventExecutor.java:1044) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at org.neo4j.driver.internal.shaded.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[neo4j-java-driver-4.0.0.jar:4.0.0-d03d93ede8ad65657eeb90ed890757203ecfaa7a]
	at java.lang.Thread.run(Thread.java:748) ~[na:1.8.0-262]

2021-06-04 13:27:32.918  INFO 6188 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Shutting down ExecutorService &#39;applicationTaskExecutor&#39;

```



Does anyone has a idea why it doesn&#39;t run?
",1622808208,https://stackoverflow.com/q/67836894,Nando94,"['java', 'neo4j', 'spring', 'gradle', 'spring-boot']"
67834810,Do not return set of nodes from a specific path in Cypher,"I am trying to return a set of a node from 2 sessions with a condition that returned node should not be present in another session (third session). I am using the following code but it is not working as intended.

```
MATCH (:Session {session_id: &#39;abc3&#39;})-[:HAS_PRODUCT]-&gt;(p:Product)        

UNWIND [&#39;abc1&#39;, &#39;abc2&#39;] as session_id
MATCH (target:Session {session_id: session_id})-[r:HAS_PRODUCT]-&gt;(product:Product)
where p&lt;&gt;product

WITH distinct product.products_id as products_id, r
RETURN products_id, count(r) as score
ORDER BY score desc
```

This query was supposed to return all nodes present in `abc1 &amp; abc2` but not in `abc3`. This query is not excluding all products present in `abc3`. Is there any way I can get it working?


**UPDATE 1:**
I tried to simplify it without `UNWIND` as this
```
match (:Session {session_id: &#39;abc3&#39;})-[:HAS_PRODUCT]-&gt;(p:Product)
MATCH (target:Session {session_id: &#39;abc1&#39;})-[r:HAS_PRODUCT]-&gt;(product:Product)
where product &lt;&gt; p
WITH distinct product.products_id as products_id
RETURN products_id
```
Even this is also not working. It is returning all items present in `abc1` without removing those which are already in `abc3`. Seems like `where product &lt;&gt; p` is not working correctly. ",1622798783,https://stackoverflow.com/q/67834810,Samual,"['neo4j', 'redisgraph', 'cypher']"
67832244,Failed after retried for 6 times in 30000 ms when accessing API with neo4j database,"Initially when I accessing the API with neo4j database it works properly but after some time when I try to access the API I got the error below:

```
Failed after retried for 6 times in 30000 ms. Make sure that your database is online and retry again.
```

I am using the code below for database connection in API:

```
var neo4jClient = new BoltGraphClient(new Uri(connectionUrl), Username, Password);
neo4jClient.ConnectAsync();
services.AddSingleton&lt;IBoltGraphClient&gt;(neo4jClient);
```",1622786946,https://stackoverflow.com/q/67832244,Prateek,"['graph-databases', 'neo4j', 'asp.net-core', 'neo4jclient']"
67827153,Correct use of UNWIND and COLLECT,"I am trying to COLLECT the list of ids for each iteration in UNWIND of Cypher in Neo4j. As usual, COLLECT is collecting all ids for UNWIND then returning everything as one vector. But I am looking to get vectors of the vector.

```
MATCH (property:Product)&lt;-[:HAS_PRODUCT]-(s1:Session)
WHERE property.products_id = 12345
with distinct s1.session_id as session_id
limit 2
with collect (session_id) as session_ids


unwind session_ids as session_id
MATCH (property:Product)&lt;-[contains:CONTAINS]-(target:Session {session_id: session_id})
with collect(distinct id(property)) as vector
return vector
```
OUT:
```
[22238, 33110, 25626, 51257]
```

`session_ids ` is a list of 2 session_ids. Each session_id should produce one vector so for 2 session_ids I am hoping to get vectors of the vector.

If I run these two sessions only by one (i.e. without `UNWIND`) I get the desired result like this
```
[22238, 51257]
[22238, 25626, 51257]
```
That&#39;s what I want by using `UNWIND`. Is there any workaround to collect ids only for each iteration of `UNWIND`.
",1622746040,https://stackoverflow.com/q/67827153,Samual,"['neo4j', 'cypher']"
67825644,SCP : Failed to download a file from a VM in Azure,"I have an Azure Virtual Machine containing a query.log file (this a VM containing Neo4j community edition). I would like to download this file on my local computer. I tried this:

    PS C:\Users\surname.name&gt; scp -vvv azureuser@ip_vm:/var/log/neo4j/query.log C:\surname.name\Downloads
    Executing: program ssh.exe host ip_vm, user azureuser, command scp -v -f /var/log/neo4j/query.log
    OpenSSH_for_Windows_8.1p1, LibreSSL 3.0.2
    debug3: Failed to open file:C:/Users/surname.name/.ssh/config error:2
    debug3: Failed to open file:C:/ProgramData/ssh/ssh_config error:2
    debug2: resolve_canonicalize: hostname ip_vm is address
    debug2: ssh_connect_direct
    debug1: Connecting to ip_vm [ip_vm] port 22.
    debug3: finish_connect - ERROR: async io completed with error: 10060, io:...
    debug1: connect to address ip_vm port 22: Connection timed out
    ssh: connect to host ip_vm port 22: Connection timed out

But I don&#39;t know where I&#39;m wrong. I have no problem to ssh the VM",1622739313,https://stackoverflow.com/q/67825644,jos97,"['ssh', 'neo4j', 'azure', 'scp']"
67824822,How can I create two node types from one csv in neo4j?,"I only have this csv:

nameaddress.csv 
----------------------------------------
[![enter image description here][1]][1]

and I want to create this network in neo4j = 
[![enter image description here][2]][2]


How I can do this easily ?


  [1]: https://i.stack.imgur.com/Fye6d.png
  [2]: https://i.stack.imgur.com/k3BYY.png",1622735760,https://stackoverflow.com/q/67824822,EREN,"['many-to-many', 'neo4j']"
67823408,Speed up Neo4j relationship creation,"I have a CSV file with 1 million rows and 3 columns (NODE_ID_1, PROPERTY_COLUMN, NODE_ID_2). \
I also have an already existing Neo4j database containing **Node** label. I should create the relationship **RELATED_TO** between nodes. I use the following cypher query to create the relationship between nodes but it is too cumbersome (it takes more than a day to complete the rel creation). Do you have some tips to quickly generate the relationship?
```

         CALL apoc.periodic.iterate(
        &quot;LOAD CSV WITH HEADERS FROM $url AS row 
         WITH row {.*, PROPERTY: toFloat(row.PROPERTY_COLUMN)}
         RETURN row&quot;,
        &quot;MATCH (src:Node {node_id : row[&#39;NODE_ID_1&#39;]}), (dst:Node {node_id : row[&#39;NODE_ID_2&#39;]}) 
         MERGE (src)-[r:RELATED_TO]-(dst)
         SET r += {property_column: row[&#39;PROPERTY_COLUMN&#39;]}
        &quot;,
        {batchSize: 1000, batchMode: &quot;BATCH&quot;, parallel:false, params: {url: &#39;file:///path_to_file&#39;} })
```",1622730718,https://stackoverflow.com/q/67823408,Nicolapo,"['database', 'cypher', 'graph', 'nodes', 'neo4j']"
67821653,spring data neo4j fail to update relationship entity,"Spring Data Neo4j Version: 4.2.23.RELEASE

NodeEntity:

```java
@NodeEntity(label = &quot;A&quot;)
public class A {
  @GraphId
  private Long id;
  private String name;
}
```

```java
@NodeEntity(label = &quot;B&quot;)
public class B{
  @GraphId
  private Long id;
  private String address;
}
```

RelationshipEntity:

```java
@RelationshipEntity(type = &quot;Relationship&quot;)
public class Relationship{
   @GraphId
    private Long id;

    @StartNode
    private A start;

    @EndNode
    private B end;
  	@Property
    private boolean deleted = false;
}
```

A----relationship----B，now, I want to update the relationship ```deleted``` tag。I&#39;ve tried many ways,but none of the methods work。

## sloution1

```java
// first get relation
Relationship relation = findRelationByxxx();
// relation start|end node is not null
relation.setDeleted(true); // the id of relation is not empty
repository.save(relationship); // not effective
```

repository extends the GraphRepository。after saving，the deleted tag is still false。

## sloution2

```java
 Map&lt;String, Long&gt; params = new HashMap&lt;&gt;();
        params.put(&quot;id&quot;, relation.getId());
        sessionFactory.openSession().query(&quot;MATCH(a:A)-[r:Relationship]-&gt;[b:B] &quot; +
                &quot;WHERE ID(r)=$id SET r.deleted = true&quot;, params);
```

Execute the cypher directly. not effecitve。who can help me to solve the problem !!!",1622724005,https://stackoverflow.com/q/67821653,jianming,"['neo4j', 'java']"
67821341,Retrieve the Relationship object in Neomodel,"I am using Neomodel and Python for my project. I have a number of nodes defined and am storing relevant information on the relationships between them. However I can&#39;t seem to find a mechanism for retrieving the relationship object itself to be able to use the attributes - I can only filter by the relationship attribute to return the Nodes.

```
class MyRelationship(StructuredRel):
    source = StringProperty()
    
class Person(StructuredNode):
    uid=UniqueIdProperty()
    first_name = StringProperty()
    last_name = StringProperty()
    
    people = RelationshipTo(&#39;Person&#39;, &quot;PERSON_RELATIONSHIP&quot;, model = MyRelationship) 
```

I have a number of relationships of the same type [PERSON_RELATIONSHIP] between the same two nodes, but they differ by attribute. I want to be able to iterate through them and print out the to node and the attribute.

Given an Object ``` person ``` of type ``` Person ```

``` for p in person.people: ```
gives me the Person objects

``` person.people.relationship(p).source ``` always gives me the value for the first relationship only

A ``` Traversal ``` also seems to give me the Person objects as well

The only way it seems to get a Relationship object is on ``` .connect ```.

Any clues? Thanks.


   ",1622722645,https://stackoverflow.com/q/67821341,John Kendall,"['python', 'neomodel', 'neo4j']"
67818270,Neo4j After Deployment access,"I am trying to deploy neo4j in k8, when i try and use port forward, i am able to access the cypher-shell along with neo4j browser in localhost but if I expose my service in k8 and try to access it via bolt(neo4j browser), i am getting an error

```ServiceUnavailable: WebSocket connection failure. Due to security constraints in your web browser...```

Any idea how can i access the bolt port via neo4j browser without forwarding port to localhost",1622709976,https://stackoverflow.com/q/67818270,Rahul Agarwal,"['neo4j', 'kubernetes', 'kubectl', 'cypher']"
67811767,cypher query using http/bolt into Neo4j hangs Java thread,"I&#39;m using Neo4j 3.5.14 Enterprise (cypher over http/bolt). I&#39;m seeing an issue where randomly a cypher query would be stuck never to be back again which takes out a worker thread. Eventually, if the service is not redeployed, all worker threads would be stuck and the service is no longer doing its job.

I tried using `apoc.cypher.runTimeboxed` but that appears to cause my queries to not return until the time limit is over (20000 ms in this case) even though in some cases it can return faster than that. I&#39;m actually not sure that `runTimeboxed` would work because I believe it is actually stuck forever which might not respond to time limit anyway depending on how that&#39;s implemented. 

My question is - how would you end a runaway query like that? Any tricks?
",1622663971,https://stackoverflow.com/q/67811767,breakingduck,"['neo4j', 'cypher', 'neo4j-apoc']"
67808579,How to make relationships between already created nodes of different columns from a single csv file?,"I have a **single** csv file whose contents are as follows -
```csv
id,name,country,level
1,jon,USA,international
2,don,USA,national
3,ron,USA,local
4,bon,IND,national
5,kon,IND,national
6,jen,IND,local
7,ken,IND,international
8,ben,GB,local
9,den,GB,international
10,lin,GB,national
11,min,AU,national
12,win,AU,local
13,kin,AU,international
14,bin,AU,international
15,nin,CN,national
16,con,CN,local
17,eon,CN,international
18,fon,CN,international
19,pon,SZN,national
20,zon,SZN,international
```
First of all I created a constraint on `id`
```
CREATE CONSTRAINT idConstraint ON (n:Name) ASSERT n.id IS UNIQUE
```
Then I created nodes for `name`, then for `country` and finally for `level` as follows -
```
LOAD CSV WITH HEADERS FROM &quot;file:///demo.csv&quot; AS row
MERGE (name:Name {name: row.name, id: row.id, country:row.country, level:row.level})
MERGE (country:Country {name: row.country})
MERGE (level:Level {type: row.level})
```
I can see the nodes fine. However, I want to be able to query for things like, for a given country how many names are there? For a given level, how many countries and then how many names for that country are there?
  
So for that I need to make Relationships between the nodes.  
For that I tried like this -  
```
LOAD CSV WITH HEADERS FROM &quot;file:///demo.csv&quot; AS row
MATCH (n:Name {name:row.name}), (c:Country {name:row.country}) 
CREATE (n)-[:LIVES_IN]-&gt;(c)
RETURN n,c
```
However this gives me a warning as follows -
```
This query builds a cartesian product between disconnected patterns.
If a part of a query contains multiple disconnected patterns, this will build a cartesian product between all those parts. This may produce a large amount of data and slow down query processing. While occasionally intended, it may often be possible to reformulate the query that avoids the use of this cross product, perhaps by adding a relationship between the different parts or by using OPTIONAL MATCH (identifier is: (c))
```
Moreover the resulting Graph looks slightly wrong - each Name node has 2 relations with a country whereas I would think there would be only one?
[![graph][1]][1]

I also have a nagging fear that I am not doing things in an optimized or correct way. This is just a demo. In my real dataset, I often cannot run multiple CREATE or MERGE statements together. I have to LOAD the same CSV file again and again to do pretty much everything from creating nodes. When creating relationships, because a cartesian product forms, the command basically gives Java Heap Memory error.  

PS. I just started with neo4j yesterday. I really don&#39;t know much about it. I have been struggling with this for a whole day, hence thought of asking here.


  [1]: https://i.stack.imgur.com/ww573.png",1622649417,https://stackoverflow.com/q/67808579,jar,"['neo4j', 'cypher', 'graph-databases']"
67805670,Is there a definite answer for the performance of 1st level depth query search in Neo4j (or any other graph db) vs. SQL/NoSQL?,"I am testing the use of Neo4j for social-like graph, but I also have many use-cases that require 1st level depth queries (e.g. get my likes / views). Consequently, I wish to decide whether I need another SQL/NoSQL to support (in terms of performance) this type of queries.
Up until now, I was only able to find benchmarks and quantitive data concerning &gt; 1st level searches (i.e. friends of my friends ...)
Is it common knowledge that SQL/NoSQL db will have better performance for such queries? are there any research/benchmarks about this?",1622639044,https://stackoverflow.com/q/67805670,Erez Firt,['neo4j']
67805422,How can I limit the number of changes that can be changed with a set in Cypher?,"Well, for example what I want is to limit the changes that are madein the **SET**, that is, I would like the property c.es_tenista to be changed for 5 people, I tried with the word LIMIT but it does not work. Any ideas?

    MATCH (c:Persona)
    WHERE NOT (c)-[:JUEGA_A]-&gt;(d:Deporte{name:&#39;tenis&#39;}) 
    SET c:Model_Data, c.es_tenista=0 LIMIT 5;",1622638192,https://stackoverflow.com/q/67805422,efejdlek,"['cypher', 'neo4j']"
67787900,Has anyone ever been able to get the @hasScope directive to work in a grandstack project with netlify deployment?,"Hi everyone I used the grandstack starter to create my project hosted [here](https://github.com/jaedag/fl-admin-portal/). The problem is that I haven&#39;t been able to get the authentication directives to  work. 

I&#39;ve not been able to use the @isAuthenticated or @hasScope directives at all. I keep getting an `Authorization Error: You are not authorized for this resource`

Has anyone here ever been able to get the auth directives to work successfully with a netlify deploy? Every thing works fine on my local machine, I only get this feedback when deploying through netlify. 
Could this be an issue with the neo4j-graphql-js library?

I&#39;m currently not ready to switch to the new `@neo4j/graphql` library as there are still some features I use that are not supported in the new library, but I&#39;m still hoping to launch my application soon.",1622546519,https://stackoverflow.com/q/67787900,jd_addy,"['netlify', 'lambda', 'graphql', 'neo4j']"
67786412,NEO4J Constraint error `ConstraintCreationFailed`,"### Background ###
I am attempting to set up a constraint on neo4j using the browser.

I have first of all ran the following, to ensure there is no duplicates;

&lt;!-- language-all: lang-cypher --&gt;
````
MATCH(m:uri), (b:uri)
WHERE m.value = b.value
AND id(m) &lt;&gt; id(b)
RETURN m, b
ORDER BY id(m)
````

For clarity, I also checked the following returned 0;

````
MATCH (b:uri)
WITH b.value AS value, COLLECT(b) AS branches
WHERE SIZE(branches) &gt; 1
RETURN branches
````


### What I tried ###
    CREATE CONSTRAINT constraint_urivalue IF NOT EXISTS ON (u:uri) ASSERT u.value IS UNIQUE

AND

    CREATE CONSTRAINT constraint_urivalue ON (u:uri) ASSERT u.value IS UNIQUE

### The Error ###


&gt;Neo.DatabaseError.Schema.ConstraintCreationFailed
&gt;
&gt;   ```` Unable to create Constraint( name=&#39;constraint_urivalue&#39;, type=&#39;UNIQUENESS&#39;, schema=(:uri {value}) ): ````


### What else ###

I have managed to create other node/attribute-constraints using the same code as used above.
Also, I have a development environment where this exact &quot;uri constraint&quot; has been implemented without any issue.

Both are running the exact same version of neo4j.

- Is there anyway to see more detail of the error?
- Any queries worth running to re-check my data?

Thanks!",1622540380,https://stackoverflow.com/q/67786412,Simon,"['database', 'unique-constraint', 'cypher', 'neo4j']"
67785889,create relationship between existing nodes in Py4neo,"I have a list of gene names `genes_list` and a list of genes that target other genes (list of tuples) `genes2`, I successfully connected to my local database and created the 20244 nodes labeled `GEN` with `name` property.
I am trying to generate a script that automates the creation of relationships for any pair of nodes(usin variables `tupla[0]and tupla[1]`) in a Neo4j graph but I can&#39;t get the for loop to work for a list of tuples, any advice? Im still learning how to use this library any advices would be great! regards!

    from py2neo import Node,Relationship,Graph, database,NodeMatcher  
    import time
    import pandas as pd
    
    genes_list=pd.read_csv(&quot;Gen_list.txt&quot;,delimiter=&quot;\t&quot;,header=None)
    genes_list=genes_list[0].tolist()
    for name in genes_list:
        graph.run(&quot;CREATE(:GEN{name:$name})&quot;,name=name)
    
    genes=pd.read_csv(r&quot;C:\Users\espin\OneDrive\Escritorio\MCI\SCRIPTS\dorothea_final.csv&quot;, delimiter=&quot;\t&quot;,header=None)
    genes2=list(genes.to_records(index=False))
    
    for tupla in genes2:
        existing_u1 = matcher.match(&quot;GEN&quot;).where(name=tupla[0]).first()
        existing_u2 = matcher.match(&quot;GEN&quot;).where(name=tupla[1).first()
        graph.merge(existing_u1,&quot;REGULATES&quot;, existing_u2)

",1622538309,https://stackoverflow.com/q/67785889,Iosanrriu,"['py2neo', 'neo4j']"
67785379,Get all Nodes and Relationships with Propperties outgoing from one StartNode,"I&#39;m completely new in the GraphDatabase world and also in writing Cypher Statements. 

I have a project, where I want to store wiring diagram information inside a graph database (Neo4J). There are different types of Nodes like f.e. WiringDiagram [WD] Node (will be my start node in many cases) and regarding this WD Node all components like fuseboxes, ICU&#39;s or sensors are linked via relationships. Plugs also can contain Pins, and Pins are connected via Connectionlines. 

The first version is already stored in the Neo4j Database, have a look at the following image.

[![Graphdatabase Schema][1]][1]
Now I have a question which way is best to post-process this data. I want the data extracted for one specific wiring Diagram. 
So if I would say I want all information about WiringDiagram with ID 123, I should get all components, Pins and Connectenlines which are there. How should the Cypher look like here? 
I want the data best in C# Data models (if possible). Because afterwards I want to try to generate an SVG out of the data.

As you can see in the image, the cypher statement looks currently like this. &quot;MATCH (w:WiringDiagram)&lt;-[r:partOf]-(n)-[*2..]-(l) RETURN * LIMIT 50&quot; But with this statement I get strange results in my C# Project...

I would be happy about any help. I&#39;m also open to go forward with another programming language if it fits better for this approach. Happy to hear any suggestions


  [1]: https://i.stack.imgur.com/rQhiD.png",1622536303,https://stackoverflow.com/q/67785379,TiMeJuMp,"['graph-databases', 'c#', 'neo4j']"
67780573,neo4j can&#39;t see database from terminal,"this might be a stupid question but I&#39;m new to neo4j.
I&#39;m using the desktop version and from there I created a new database from a new project. I also can see it from the browser and I can see data and stuff.

[![enter image description here][1]][1]
But if I go on my terminal and run 

    cypher-shell
and from there I type

    SHOW DATABASES;
I can only see the default dbs:
[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/4MJQc.png
  [2]: https://i.stack.imgur.com/n5TrN.png

Does anyone know what I am doing wrong?",1622497984,https://stackoverflow.com/q/67780573,Fabienne Lablatte,"['cypher-shell', 'neo4j']"
67776342,What is difference between ANY and IN clause in Neo4j?,"Neo4j has two different clauses to find value in an array, ANY and IN. Please explain, how they are different as both are used to filter the data by checking if, the specified value is present in the array or not.
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/W3iqB.png

Query#1 : MATCH (n) WHERE any(color IN n.liked_colors WHERE color = &#39;yellow&#39;) RETURN n

Result#1: Node with name Eskil

Query#2 : Match (n) where &#39;yellow&#39; in n.liked_colors return n

Result#2: Node with name Eskil

If both query return same results then where is the diffrence.

",1622473953,https://stackoverflow.com/q/67776342,Piyush Srivastava,"['cypher', 'graph-databases', 'neo4j']"
67772390,How to unit-test code depending on a complex graph database interaction,"I&#39;m developing a **Python** app based on [Neo4j](https://neo4j.com/), and I&#39;m facing a challenge to write unit-tests in isolation from the Neo4j database, so I can run my unit-tests without depending on starting a full-blown database.

The Neo4j **Java** SDK includes an [&quot;In-Memory / Impermanent database&quot;](http://javadox.com/com.github.jasoma/neo4j-memorydb/3.1.1/org/neo4j/test/TestGraphDatabaseFactory.html)

Unfortunately, the [Python driver](https://neo4j.com/developer/python/) doesn&#39;t have that.

# Ideas

## Mocks

I considered mocking the database, however you [shouldn&#39;t mock what you don&#39;t own](https://github.com/testdouble/contributing-tests/wiki/Don%27t-mock-what-you-don%27t-own).
Especially third-party libraries.

As I want my unit-test to be reliable and follow a good design, I don&#39;t want to follow this path.

## Ports and Adapters

From a software architecture standpoint, integrating a third-party library like Neo4j should be done following the Ports and Adapters pattern.
This will give me the following benefits

- decouple my business logic from the graph logic
- have a clearly defined contract (port) that adapters have to implement
- having a Fake Neo4j adapter implementation, to be passed to my business logic for unit tests

This is promising, but I&#39;m overwhelmed by the amount of code to write.

Example code with the official Neo4j driver
~~~Python
driver = GraphDatabase.driver(&quot;bolt://localhost:7687&quot;)
with driver.session() as session:
    query = &quot;&quot;&quot;MATCH (u:USER)
             WHERE u.name = $name
             RETURN u&quot;&quot;&quot;
    cursor = session.run(query, parameters={&#39;name&#39;, &#39;Alfred&#39;})
    for result in cursor:
        acc_type = result[&#39;u&#39;][&#39;account_type&#39;]
        return acc_type
~~~

Example &quot;Ports and Adapters&quot; implementation

Defining the API (Port)
~~~Python
from abc import ABC, abstractmethod

class AbstractGraphService(ABC):
    def __init__(url: str):
        pass

    @abstractmethod
    def __enter__():
        &quot;&quot;&quot;returns a session&quot;&quot;&quot;
        pass

    @abstractmethod
    def __exit__(*args):
        &quot;&quot;&quot;close session object&quot;&quot;&quot;
        pass


class AbstractSession(ABC):

    @abstractmethod
    def run(self, query, parameters):
        &quot;&quot;&quot;execute a cypher query&quot;&quot;&quot;
        pass
~~~

➡️ how can I write a fake, in-memory implementation ? Am I supposed to write a Fake Cypher-execution engine as well ?

➡️ with the API demonstrated above, I haven&#39;t decoupled my Cypher queries from my business logic code

➡️ Is there a better road to follow to unit-test my code ?

Thank you for your suggestions",1622458483,https://stackoverflow.com/q/67772390,Wenzel,"['neo4j', 'unit-testing', 'architecture', 'cypher', 'python']"
67771862,Embedded Neo4j APOC procedure apoc.load.json not working,"I went through a couple of similar threads but none save my problem. I am running an embedded Neo4j instance (version 3.5, enterprise edition). When configuring DB I override plugin dir to location where I have my APOC jar (also 3.5 version). 

Here is neo4j.conf file:

    dbms.logs.debug.level=DEBUG
    dbms.security.procedures.unrestricted=apoc.*
    dbms.security.procedures.whitelist=apoc.*
    apoc.export.file.enabled=true
    apoc.import.file.enabled=true

I can confirm that configuration is correctly read upon database setup since on listing of configs (using `dbms.listConfig()`) I can confirm custom settings are present.


Issue occur upon running APOC procedure apoc.load.json:

    Failed to invoke procedure `apoc.load.json`: Caused by: java.lang.RuntimeException: Import from files not enabled, please set apoc.import.file.enabled=true in your neo4j.conf

Also other APOC procedure (fore example `apoc.util.validate` works without issues). ",1622456094,https://stackoverflow.com/q/67771862,jernejP,"['neo4j', 'neo4j-apoc']"
67770474,Neo4j query without specifying relation type,"I have a graph representation of data with multiple nodes with random relationships

I&#39;m using Neo4j to represent this and using query
Using query 
```
MATCH (a)-[r]-&gt;(b)-[r2]-&gt;(c)
```
I&#39;m getting an output where ever A is related with B and B is related with C
[![enter image description here][1]][1]


But I need to query nodes A and B with any relationship (call as RelationA) and all C following B (with RelationA) with the Same relation as A and B like the following image


[![enter image description here][2]][2]


if A is connected with more than one B then the expected graph will be like this

[![enter image description here][3]][3]


  [1]: https://i.stack.imgur.com/g4g6M.jpg
  [2]: https://i.stack.imgur.com/zpEpm.jpg
  [3]: https://i.stack.imgur.com/kSVc3.jpg",1622450534,https://stackoverflow.com/q/67770474,ASHMIL HUSSAIN K,"['graph', 'neo4j', 'database']"
67768889,Neo4j Cypher Return custom JSON structure,"I am trying to convert the graph structure to json. 

I have the following structure

```
CREATE (ui)-[:CONTAINS]-&gt;(graphStyle:SchemaType {id: randomUUID(), name:&#39;graphStyle&#39;, type:&#39;array&#39;, shape:&#39;star&#39;})
CREATE (graphStyle)-[:CONTAINS]-&gt;(graphStyleNode:Field {id: randomUUID(), name:&#39;node&#39;, type:&#39;object&#39;, shape:&#39;star&#39;})
CREATE (graphStyleNode)-[:CONTAINS]-&gt;(graphStyleNodeSelector:Field {id: randomUUID(), name:&#39;selector&#39;, type:&#39;string&#39;, value: &quot;node&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNode)-[:CONTAINS]-&gt;(graphStyleNodeStyle:Field {id: randomUUID(), name:&#39;style&#39;, type:&#39;object&#39;, value: &quot;node&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleFontFamily:Field {id: randomUUID(), name:&quot;&#39;font-family&#39;&quot;, type:&#39;string&#39;, value: &quot;-apple-system, Oxygen-Sans, Ubuntu, Cantarell, Helvetica Neue, sans-serif&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleFontSize:Field {id: randomUUID(), name:&quot;&#39;font-size&#39;&quot;, type:&#39;string&#39;, value: &quot;8px&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleWidth:Field {id: randomUUID(), name:&#39;width&#39;, type:&#39;function&#39;, value: &#39;(ele:any) =&gt; {if (ele.data().shape !== &quot;round-rectangle&quot;) return 60; else return 100}&#39;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleHeight:Field {id: randomUUID(), name:&#39;height&#39;, type:&#39;function&#39;, value: &#39;(ele:any) =&gt; {if (ele.data().shape !== &quot;round-rectangle&quot;) return 60; else return 40}&#39;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleBackgroundColor:Field {id: randomUUID(), name:&quot;&#39;background-color&#39;&quot;, type:&#39;string&#39;, value: &quot;#5E6366&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleLabel:Field {id: randomUUID(), name:&#39;label&#39;, type:&#39;string&#39;, value: &quot;&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleTextHAlign:Field {id: randomUUID(), name:&quot;&#39;text-halign&#39;&quot;, type:&#39;string&#39;, value: &quot;center&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleTextVAlign:Field {id: randomUUID(), name:&quot;&#39;text-valign&#39;&quot;, type:&#39;string&#39;, value: &quot;center&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleTextMarginY:Field {id: randomUUID(), name:&quot;&#39;text-margin-y&#39;&quot;, type:&#39;string&#39;, value: &quot;5px&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleTextWrap:Field {id: randomUUID(), name:&quot;&#39;text-wrap&#39;&quot;, type:&#39;string&#39;, value: &quot;ellipsis&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleTextMaxWidth:Field {id: randomUUID(), name:&quot;&#39;text-max-width&#39;&quot;, type:&#39;string&#39;, value: &quot;50px&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleColor:Field {id: randomUUID(), name:&#39;color&#39;, type:&#39;string&#39;, value: &quot;#FFFFFF&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleOverlayOpacity:Field {id: randomUUID(), name:&quot;&#39;overlay-opacity&#39;&quot;, type:&#39;number&#39;, value: 0, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleTextBackgroundOpacity:Field {id: randomUUID(), name:&quot;&#39;text-background-opacity&#39;&quot;, type:&#39;number&#39;, value: 1, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleBackgroundPositionY:Field {id: randomUUID(), name:&quot;&#39;background-position-y&#39;&quot;, type:&#39;string&#39;, value: &quot;30%&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleBorderWidth:Field {id: randomUUID(), name:&quot;&#39;border-width&#39;&quot;, type:&#39;string&#39;, value: &quot;2px&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleShape:Field {id: randomUUID(), name:&quot;&#39;shape&#39;&quot;, type:&#39;string&#39;, value: &quot;data(shape)&quot;, shape:&#39;star&#39;})
CREATE (graphStyleNodeStyle)-[:CONTAINS]-&gt;(graphStyleNodeStyleShape:Field {id: randomUUID(), name:&quot;&#39;shape&#39;&quot;, type:&#39;string&#39;, value: &quot;data(shape)&quot;, shape:&#39;star&#39;})
```

And I would like to return: 
```
{
  style: [{
    selector: &quot;node&quot;,
    style: {
      &quot;font-family&quot;:
        &quot;-apple-system, Oxygen-Sans, Ubuntu, Cantarell, Helvetica Neue, sans-serif&quot;,
      &quot;font-size&quot;: &quot;8px&quot;,
      width: (ele:any) =&gt; {if (ele.data().shape !== &quot;round-rectangle&quot;) return 60; else return 100},
      height: (ele:any) =&gt; {if (ele.data().shape !== &quot;round-rectangle&quot;) return 60; else return 40},
      &quot;background-color&quot;: &quot;#5E6366&quot;,
      label: &quot;&quot;,
      &quot;text-halign&quot;: &quot;center&quot;,
      &quot;text-valign&quot;: &quot;center&quot;,
      &quot;text-margin-y&quot;: &quot;5px&quot;,
      &quot;text-wrap&quot;: &quot;ellipsis&quot;,
      &quot;text-max-width&quot;: &quot;50px&quot;,
      color: &quot;#ffffff&quot;,
      &quot;overlay-opacity&quot;: 0,
      &quot;text-background-opacity&quot;: 1,
      &quot;background-position-y&quot;: &quot;30%&quot;,
      &quot;border-width&quot;: &quot;2px&quot;,
      &quot;shape&quot;: &quot;data(shape)&quot;
    }]
},
```
The problem becomes when using apoc.convert.toJson that I cannot set the json key to be the node name and value to be the node value. The json is a cytoscape js style so that&#39;s why it has suck a weird structure.

",1622442590,https://stackoverflow.com/q/67768889,benjieos,"['json', 'cypher', 'graphql', 'neo4j', 'cytoscape.js']"
67761388,@Transactional in Spring Data Neo4j 6,"I have a simple Spring Boot project with Neo4j SDN (v6.1.1). The problem is that when I mark a method with @Transactional, it seems that it does not consider that (as opposed to when I used Neo4j-OGM and a previous version of SDN). When I checked the database after &quot;template.save&quot;, the update was visible in the database, even before the whole method is run. What should I do?

The method:

    @Transactional
    void method() {
            template.deleteAll(Person.class);
            template.deleteAll(Club.class);
            // save by Neo4jTemplate
            Person person_1 = template.save(new Person(&quot;Reza&quot;, &quot;Mahdavi&quot;, 22, new Member(new Club(&quot;Iran&quot;), &quot;2021&quot;)));
            // Save by Repository
            Person person_2 = repository.save(new Person(&quot;Ali&quot; + new Random(System.currentTimeMillis()).nextInt(), &quot;Alavi&quot;, 20, new Member(new Club(&quot;Iran&quot;), &quot;2020&quot;)));
            // Query by Repository
            Person ali = repository.findByName(&quot;Ali&quot;);
            // Query by Neo4jTemplate
            Optional&lt;Person&gt; reza = template.findById(person_1.getId(), Person.class);
            // Custom query
            Result result = driver.session().run(&quot;Match(n) return count(n) as count&quot;, TransactionConfig.builder().build());
            System.out.println(&quot;Entity Count: &quot; + result.single().values().get(0));
    }

Also, I have such sentences in logs: 

&gt; No need to create transaction for [org.springframework.data.neo4j.repository.support.SimpleNeo4jRepository.toString]: This method is not transactional.

Code [here][1]


  [1]: https://github.com/shayantabrizi/sample-code-1",1622379331,https://stackoverflow.com/q/67761388,Shayan,"['neo4j', 'spring-boot', 'spring-data-neo4j']"
67760628,"Spring Boot PostgreSQL, Neo4j and Atomikos XA transaction manager","In Spring Boot application I have configured 2 different transaction managers:


    @Bean(&quot;jpaTransactionManager&quot;)
    public PlatformTransactionManager transactionManager(EntityManagerFactory entityManagerFactory) {
        JpaTransactionManager transactionManager = new JpaTransactionManager();
        transactionManager.setEntityManagerFactory(entityManagerFactory);
        return transactionManager;
    }

    @Bean(&quot;neo4jTransactionManager&quot;)
    public Neo4jTransactionManager transactionManager() {
        return new Neo4jTransactionManager(sessionFactory());
    }

Also, I have a separate services for PostgreSQL and Neo4j databases:

    @Service(&quot;postgreSQLUserService&quot;)
    @Transactional(&quot;jpaTransactionManager&quot;)
    public class UserServiceImpl implements UserService {
    
        @Autowired
        private UserRepository userRepository;
    
        @Override
        public User create() {
            return userRepository.save(new User());
        }
    
    .....
    
    @Service(&quot;neo4jUserService&quot;)
    @Transactional(&quot;neo4jTransactionManager&quot;)
    public class UserServiceImpl implements UserService {
    
        @Autowired
        private UserRepository userRepository;
    
    
        @Override
        public User create() {
            return userRepository.save(new User());
        }

Separately such services work like expected and correctly communicate with PostgreSQl and Neo4j database. Right now I need to configure something like XA transactions. I need to be able in scope of one method to atomically create users in PostgreSQL and Neo4j database. In case one of the operation fail, I need also to rollback changes from another database, something like that: 

    @Transactional
    public void createUser() {
        postgreSQLUserService.create();
        neo4jUserService.create();
    }

I think, I may use Atomikos transaction manager in order to achieve it but don&#39;t know is it a right way. Could you please show an example how to configure XA transaction manager for such case?

**UPDATED**

Based on the following answer https://stackoverflow.com/a/57885706/1219755 looks like XA support was dropped from Neo4j... So the only way to implement such functionality is to implement Saga microservice pattern? Saga is huge overhead for my current setup.",1622374149,https://stackoverflow.com/q/67760628,alexanoid,"['neo4j', 'spring-boot', 'jta', 'transactions', 'atomikos']"
67756755,How to use node_modules in Deno as typescript imports?,"**Project**: REST API for serving information stored in a **neo4j** graph database. 
**Backend**: Deno

I am farely new to deno, but I&#39;m not new to typescript, having used it in Angular frequently. 

**Problem**: I want to use a driver to connect my neo4j database to my backend, but there is no neo4j driver made for Deno. I have scoured the internet and documentation for solutions, and have been trying to import the javascript library using the node modules import tool that has been suggested from similar answers and is supported by the deno team. 

Essentially, I do `npm install neo4j-driver`, and then add the following code to my deno project. 

**Failed Solution: the javascript node modules wrapper**

I implement call this function as a test for my deno server in a server.ts file. 

The command I use for deno is: `deno run --allow-all --unstable server.ts`

**neo4j_conn.ts file:** (called by server.ts)

```
import { createRequire } from &quot;https://deno.land/std/node/module.ts&quot;;
const require = createRequire(import.meta.url);

export async function testconnection(uri: string, user: string, password: string) {

  //This is the line that fails. 
  var neo4j = require(&#39;neo4j-driver&#39;).v1;  //this fails whether or not I include the .v1 or not. 

  var driver = neo4j.driver(uri, neo4j.auth.basic(user, password))
  const session = driver.session()
  const personName = &#39;Alice&#39;

  try {
    const result = await session.run(
      &#39;CREATE (a:Person {name: $name}) RETURN a&#39;,
      { name: personName }
    )

    const singleRecord = result.records[0]
    const node = singleRecord.get(0)

    console.log(node.properties.name)
  } finally {
    await session.close()
  }

  await driver.close()

}

```

This returns the following error: 

```
error: Uncaught (in promise) Error: Cannot find module &#39;net&#39;
Require stack:
- /mnt/c/Users/xxxxx/source/private_logic/deno-try/node_modules/neo4j-driver-bolt-connection/lib/channel/node/node-channel.js
- /mnt/c/Users/xxxxx/source/private_logic/deno-try/node_modules/neo4j-driver-bolt-connection/lib/channel/node/index.js       
- /mnt/c/Users/xxxxx/source/private_logic/deno-try/node_modules/neo4j-driver-bolt-connection/lib/channel/index.js
- /mnt/c/Users/xxxxx/source/private_logic/deno-try/node_modules/neo4j-driver-bolt-connection/lib/bolt/handshake.js
- /mnt/c/Users/xxxxx/source/private_logic/deno-try/node_modules/neo4j-driver-bolt-connection/lib/bolt/index.js
- /mnt/c/Users/xxxxx/source/private_logic/deno-try/node_modules/neo4j-driver-bolt-connection/lib/index.js
- /mnt/c/Users/xxxxx/source/private_logic/deno-try/node_modules/neo4j-driver/lib/index.js
- /mnt/c/Users/xxxxx/source/private_logic/deno-try/neo4jconn.ts
    at Function._resolveFilename (https://deno.land/std@0.97.0/node/module.ts:273:19)
    at Function._load (https://deno.land/std@0.97.0/node/module.ts:380:29)
    at Module.require (https://deno.land/std@0.97.0/node/module.ts:133:21)
    at require (https://deno.land/std@0.97.0/node/module.ts:1158:16)
    at Object.&lt;anonymous&gt; (file:///mnt/c/Users/xxxxx/source/private_logic/deno-try/node_modules/neo4j-driver-bolt-connection/lib/channel/node/node-channel.js:24:29)    
    at Module._compile (https://deno.land/std@0.97.0/node/module.ts:168:36)
    at Object.Module._extensions..js (https://deno.land/std@0.97.0/node/module.ts:1109:10)
    at Module.load (https://deno.land/std@0.97.0/node/module.ts:147:34)
    at Function._load (https://deno.land/std@0.97.0/node/module.ts:413:14)
    at Module.require (https://deno.land/std@0.97.0/node/module.ts:133:21)
```

As far as I could tell, I had done everything right, but I am a little in over my head when it comes to the typescript/js module translation. 

My file structure is as follows: 

```
package.json
package-lock.json
server.ts
neo4j_conn.ts
node_modules -|
              |
              :
```

Neo4j developer js docs: https://neo4j.com/developer/javascript/ 

Deno node modules &quot;require&quot;: https://doc.deno.land/https/deno.land/std@0.97.0/node/module.ts
",1622335397,https://stackoverflow.com/q/67756755,Squarerootofpi,"['deno', 'javascript', 'typescript', 'neo4j']"
67750111,Neo4j Liquigraph datasource - expected single matching bean but found 2,"In SpringBoot Maven application I have configured two datasources - one Neo4j for Liquigraph

	@Bean
	@LiquigraphDataSource
	public DataSource neo4jDataSource() {
		final HikariConfig config = new HikariConfig();
		config.setJdbcUrl(jdbcServerDatabaseUri);
		config.setUsername(username);
		config.setPassword(password);
		return new HikariDataSource(config);
	}

and one PostgreSQL for Liquibase

    @Bean
    @LiquibaseDataSource
    public DataSource postgreSQLDataSource() {
        DataSource dataSource = DataSourceBuilder.create()
                .username(username)
                .password(password)
                .url(databaseUrl)
                .build();
        return dataSource;
    }

but during the application start up it fails with the following exception:

    Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#39;matrixServiceImpl&#39;: Unsatisfied dependency expressed through field &#39;session&#39;; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;org.springframework.data.neo4j.repository.config.Neo4jOgmEntityInstantiatorConfigurationBean#0&#39;: Cannot resolve reference to bean &#39;sessionFactory&#39; while setting constructor argument; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;sessionFactory&#39; defined in class path resource [com/decisionwanted/domain/configuration/Neo4jConfig.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.neo4j.ogm.session.SessionFactory]: Factory method &#39;sessionFactory&#39; threw exception; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;org.liquigraph.spring.starter.LiquigraphAutoConfiguration$LiquigraphConfiguration&#39;: Bean instantiation via constructor failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.liquigraph.spring.starter.LiquigraphAutoConfiguration$LiquigraphConfiguration$$EnhancerBySpringCGLIB$$cb17993a]: Constructor threw exception; nested exception is org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type &#39;javax.sql.DataSource&#39; available: expected single matching bean but found 2: postgreSQLDataSource,neo4jDataSource
    	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:660)
    	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:640)

What am I doing wrong and how to fix it?",1622282946,https://stackoverflow.com/q/67750111,alexanoid,"['spring-boot', 'neo4j', 'liquigraph']"
67749165,Use NestJS framework and Neo4j,"I am developing a typescript API, and i would like to use Neo4j as my database. I have tried using [this][1] package, but i get the following errors (i have followed the quick start guide):
[![enter image description here][2]][2]

I have also found the [tutorial][3], where the creator creates this package step by step, which i have not followed as of yet, because i have just installed his package.

My question is, is there a simpler way to user neo4j and nestjs or would it be a better decision to use a javascript api and neo4j (as i could just simply use the neo4j driver package in that case)?


  [1]: https://www.npmjs.com/package/nest-neo4j
  [2]: https://i.stack.imgur.com/vlVIZ.png
  [3]: https://www.youtube.com/watch?v=9sNgCiPnhZE&amp;list=LL",1622275719,https://stackoverflow.com/q/67749165,qlabfgerkaSmurf,"['neo4j', 'typescript', 'nestjs', 'api']"
67743090,Related to neo4j and csv files,"[enter image description here][1]I&#39;m new to neo4j and cypher. I want to create node for multiple sub nodes. I have patient file and I have one allergy file so first I want to create node allergies and then I want to add sub nodes to this node. Then I want to add that allergies node to patient. such as patient-[:has allergies]-allergies&lt;-latex allergy allergies another node for another allergy connected to allergies.
 how can I do that in neo4j?
allergy.csv file contains  

    START       Patent id                           DESCRIPTION 
    01/05/1982 1d604da9-9a81-4ba9-80c2-de3375d59b40 Latex allergy 
    10/25/1982 034e9e3b-2def-4559-bb2a-7850888ae060 Shellfish allergy 

patient.csv contains

    Id                                   BIRTHDATE   First Name      ADDRESS 
    1d604da9-9a81-4ba9-80c2-de3375d59b40 5/25/1989    Josef       427 Balistreri 
    034e9e3b-2def-4559-bb2a-7850888ae060 11/14/1983   milo217    422 Farrell      

    CITY         STATE        COUNTY 
    Chicopee Massachusetts Hampden County 
    Chicopee Massachusetts Hampden County 

    LOAD CSV WITH HEADERS FROM &quot;file:///patients.csv&quot; as row
    MERGE (p:patient {name:row.FIRST, id:row.Id, birhdate:row.BIRTHDATE})
    MERGE (ad: address {address : row. ADDRESS, state:row.STATE, country:row.COUNTY})
    CREATE (p)-[:belongs to]-&gt;(ad);
    
    LOAD CSV WITH HEADERS FROM &quot;file:///allergies.csv&quot; as row
    CREATE (a: allergy{name: row. DESCRIPTION, id:row.PATIENT});
    MATCH (p:patient), (a: allergy)
    WHERE p.id = a.id
    MERGE (p)-[:has_allergy] -&gt; (a);


  [1]: https://i.stack.imgur.com/F751s.png
",1622222150,https://stackoverflow.com/q/67743090,Kunika Kulkarni,"['neo4j', 'csv', 'file']"
67740357,Neo4j apoc will not export,"I know there are hundreds of questions out there (and I have been looking prior to asking this!!) because whatever I try, Neo4j will not run the APOC export function.

`CALL apoc.export.graphml.all(&#39;/tmp/complete-graph.graphml&#39;, {useTypes:true, storeNodeIds:false})`

`Failed to invoke procedure `apoc.export.graphml.all`: Caused by: java.lang.RuntimeException: Export to files not enabled, please set apoc.export.file.enabled=true in your neo4j.conf`

Here is the bottom of my neo4j.conf file:

	dbms.security.procedures.unrestricted=apoc.*
	dbms.directories.plugins=/var/lib/neo4j/plugins`
	apoc.export.file.enabled=true
	apoc.import.file.enabled=true

Here is the contents of `/var/lib/neo4j/plugins`:

`-rwxr-xr-x 1 neo4j adm 15949360 Apr 16  2020 apoc-3.5.0.11-all.jar`

I am running v 3.5 on Ubuntu 18.",1622210652,https://stackoverflow.com/q/67740357,Antony,"['neo4j', 'neo4j-apoc']"
67740298,"Cypher Query Trying to get all nodes with 3rd degree connection, while all nodes follow the same constraints","I&#39;m struggling with writing this query

I want to find all of the workers,
who have friends of 1st degree, 2nd degree AND 3rd degree, 
who follows 2 conditions.

but if one of the above connections does not apply to the conditions,
I do not want it to be in the output

for example:
the relationship is friend.
conditions are:
   City: &quot;New Delhi&quot;
   age &gt;= 29
friend , friend of friend , friend of friend of friend - Direction irrelevant 
if the node has a friend that not apply to the conditions even though it has another path that does apply I do not want it 

[Graph DB][1]

    MATCH (u1)-[:friend]-(u2)-[:friend]-(u3)-[:friend]-(u4)
    WHERE(u1.address = &quot;New Delhi&quot; AND u1.age &gt;= 29)
    AND (u2.address = &quot;New Delhi&quot; AND u2.age &gt;= 29)
    AND (u3.address = &quot;New Delhi&quot; AND u3.age &gt;= 29)
    AND (u4.address = &quot;New Delhi&quot; AND u4.age &gt;= 29)
    RETURN DISTINCT u3.name

This query gives me all the nodes that I wanted and more..
it does not filter the ones that have a relationship with someone that not apply the conditions
I will be more clear:

 a-b-c-d path that apply the conditions MARK it P
 a-q-w-v q OR w OR v do not apply the conditions MARK it N
because of P a will be in the output but because of N it should not be

[Who stand the requirements and Output][2]

I added this picture for graphic explanation
the mark with black circle is the output-&gt; every one in chain apply the conditions
Green is apply the conditions
Red is not.

Hillel, Tor and Dror. They apply the conditions but the have friends or friend of friends or friend of friends of friends that does not. So they will not be in the output.

The out put for my Query is the black circles and the 3 names above how to I do it with out those 3.

sorry for all the extra details I tried in neo4j manual to find an answer but with no luck 


  [1]: https://i.stack.imgur.com/DAY1y.png
  [2]: https://i.stack.imgur.com/k3ILC.jpg",1622210415,https://stackoverflow.com/q/67740298,Eyal Hadad,"['neo4j', 'graph', 'where-clause', 'nodes', 'filter']"
67739239,"Find most suitable nodes from a starting node, start and end nodes are indirectly connected and edges are weighted","in the image below is a subgraph of my whole graph shown. I have three different kind of nodes, green, blue and violet ones.

The green and violet ones are indirectly connected via the blue nodes.

Blue nodes are connected among each other with directed edges which are weighted. The blue edges are weighted but not the green or violet ones.

The problem I want to solve is the following: **I would like to find the most suitable violet nodes to the green one.**, e.g. I want be able to say that for green node *GA* the three most suitable violet nodes are *V1*, *V4*, *V42*.

*What makes a node suitable?*

A perfect match would be when the green node connects to all blue nodes the violet one connects to. However, the green node could connect to more blue nodes. This would still be the best score for a violet node.

If green and violet do not connect to the same blue node but to blue nodes that are connected to each other the algorithm needs to take the weights of the edges between the blue nodes into account. This could not result in a perfect match but still a good match.

*What makes it more or less suitable?*

The more hops between blue nodes are needed to connect blue nodes the green and violet nodes are connected the smaller the score of the violet node is. Also if the weight between the blue nodes is the lesser the score of the violet node is, here the direction from green to violet is the one to consider.

If the green is not connected to some blue nodes, it would be a penalty and the score for the violet node would be smaller.
 

**What graph algorithms can you think of to solve this problem?**

I am planning to use the neo4j database.

[![my subgraph][1]][1]


  [1]: https://i.stack.imgur.com/6SsMh.png",1622206483,https://stackoverflow.com/q/67739239,Greeneco,"['algorithm', 'neo4j', 'graph-algorithm']"
67738292,Neo4J python driver doesn&#39;t raise errors when ruuning into a docker container,"I have a problem that is probably quite simple, but I can&#39;t find solutions by myself...

I run two docker containers with docker-compose, one is a python server with fastapi, and another one the neo4j official image, with auth disabled (for dev environment)
Here the piece of code that connect the db:


```
    def __new__(cls, settings: Neo4jSettings, *args, **kwargs):
        try:
            cls.driver = GraphDatabase.driver(settings.neo4j_url())
            log.info(f&#39;Connected as &quot;{settings.neo4j_user}&quot; on {settings.neo4j_url()}&#39;)

        except exceptions.ServiceUnavailable as err:
            log.error(f&#39;Service Unavailable: {err}&#39;)
        # other error handling
```
ON MY LOCAL MACHINE: everything work as expected: when the database is running, i see the `connected ...` message, and all is working fine. when i shutdown the database, the neo4j diver raise a `Service Unavailable`, and i display the error.

ON DOCKER: All works as expected when the two containers are running, with the proper database url.
BUT if i change the url to a random one, or even if i shutdown the database container, the `connected ...` message is displayed.
Look like the neo4j driver **don&#39;t raise any exception** ... but and can&#39;t find a reason for that.

Here my Dockerfile:

```dockerfile
FROM python:3.7-slim # tried with 3.9 too  

WORKDIR /app


ENV VIRTUAL_ENV=/opt/venv
RUN python3 -m venv $VIRTUAL_ENV
ENV PATH=&quot;$VIRTUAL_ENV/bin:$PATH&quot;

COPY requirements.txt .

RUN pip install --upgrade pip
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD [&quot;uvicorn&quot;, &quot;main:api&quot;, &quot;--reload&quot; ,&quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8000&quot;]
```

Thanks you, and forgive me for my english ... ",1622202634,https://stackoverflow.com/q/67738292,rcepre,"['neo4j', 'python', 'neo4j-python-driver', 'docker']"
67738035,Neo4j Browser Crash grey screen,"```
MATCH (a:Doss)
MATCH (b:Doss)
WHERE a.Num=b.Num
return a,b
```
it takes long time and then no results, just the browser being crashed with grey screen.
NB:in this database i got 6M nodes.",1622201551,https://stackoverflow.com/q/67738035,Oussama Selmani,['neo4j']
67728622,GraphQL sorting of queries broken on Neo4j Aura,"It appears that GraphQL-queries with sort are broken on Neo4j Aura.

A GraphQL call that was working for months now suddenly fails.

The main error message that comes back is: `Neo4jError: Unknown function &#39;apoc.coll.sortMulti&#39;`

Queries that fail have this shape:
```graphql
{
  Unit {
    SHOWS_rel(orderBy: order_asc) {
      Image {
        id
        url
      }
      order
    }
  }
}

```

Removing `(orderBy: order_asc)` resolves successfully.

The queries do not fail on local instances of Neo4j (e.g. Neo4j 4.1.1 launched via docker).
A update to these npm packages did also not provide a change:

```
apollo-server: ^2.25.0
apollo-server-core: ^2.25.0
graphql-tag: ^2.12.4
neo4j-driver: ^4.3.0
```",1622143132,https://stackoverflow.com/q/67728622,manonthemat,"['graphql', 'neo4j', 'neo4j-aura']"
67727117,Importing custom datetime format from CSV using Neo4j Admin,"What is the correct way to specify a custom format for a datetime when importing data from a CSV using neo4j-admin?

Getting the following error when running `neo4j-admin import`:

```
Text cannot be parsed to a DateTime &quot;2021-05-20 20:25:09 UTC&quot;
```
",1622136298,https://stackoverflow.com/q/67727117,andrew,['neo4j']
67718626,The is no procedure with the name &#39;gds.alpha.ml.nodeClassification.train&#39;,"&gt; **Neo.ClientError.Procedure.ProcedureNotFound** There is no procedure with
&gt; the name `gds.alpha.ml.nodeClassification.train` registered for this
&gt; database instance. Please ensure you&#39;ve spelled the procedure name
&gt; correctly and that the procedure is properly deployed.

I have installed Graph Data Science Library v1.4.1 , and my Neo4j Desktop is v1.4.5. The beta algorithms are working fine but for some reason the alpha algorithms are not. I&#39;m following the Node Classification oficial tutorial from Neo4j. The original code where is the error:

    CALL gds.alpha.ml.nodeClassification.train(&#39;marvel_model_data&#39;, {
       nodeLabels: [&#39;Character&#39;],
       modelName: &#39;xmen-model-properties&#39;,
       featureProperties: [&#39;energy&#39;,&#39;speed&#39;,&#39;strength&#39;,&#39;durability&#39;,&#39;intelligence&#39;],
       targetProperty: &#39;is_xman&#39;,
       metrics: [&#39;F1_WEIGHTED&#39;,&#39;ACCURACY&#39;],
       holdoutFraction: 0.2,
       validationFolds: 5,
       randomSeed: 2,
       params: [
           {penalty: 0.0625, maxIterations: 1000},
           {penalty: 0.125, maxIterations: 1000},
           {penalty: 0.25, maxIterations: 1000},
           {penalty: 0.5, maxIterations: 1000},
           {penalty: 1.0, maxIterations: 1000},
           {penalty: 2.0, maxIterations: 1000},
           {penalty: 4.0, maxIterations: 1000}
           ]
        }) YIELD modelInfo
      RETURN
      modelInfo.bestParameters AS winningModel,
      modelInfo.metrics.F1_WEIGHTED.outerTrain AS trainGraphScore,
      modelInfo.metrics.F1_WEIGHTED.test AS testGraphScore",1622104749,https://stackoverflow.com/q/67718626,efejdlek,"['neo4j', 'cypher']"
67705203,Cypher init script Neo4j 4.2 docker not working,"I am trying to refer to this link of documentation: https://neo4j.com/labs/apoc/4.2/operational/init-script/

This is my docker command:

    docker run --rm \
    --env NEO4J_AUTH=&quot;neo4j/test&quot; \
    --env NEO4JLABS_PLUGINS=&#39;[&quot;apoc&quot;]&#39; \
    --env NEO4J_apoc_export_file_enabled=&quot;true&quot; \
    --env NEO4J_apoc_import_file_enabled=&quot;true&quot; \
    --env NEO4J_apoc_import_file_use__neo4j__config=&quot;true&quot; \
    --env NEO4J_dbms_directories_import=&quot;/&quot; \
    --env NEO4J_apoc_initializer_neo4j_1=&#39;CALL apoc.cypher.runSchemaFile(&quot;file:////var/lib/neo4j/db_init_scripts/db_ddls.cypher&quot;);&#39; \
    --env NEO4J_apoc_initializer_neo4j_2=&#39;CALL apoc.cypher.runFile(&quot;file:////var/lib/neo4j/db_init_scripts/db_schema.cypher&quot;);&#39; \
    --name neo4j \
    neo4j:cus

where neo4j:cus is my custom image where I copied the required cypher files into **neo4j:4.2** image

My db_ddl.cypher has create indexes:

    CREATE CONSTRAINT idx_person_unq IF NOT EXISTS ON (p:Person) ASSERT p.name IS UNIQUE;

My db_schema.cypher has schema creation:

    MERGE (p:Person {name: &quot;Inital Person&quot;});

When I try to start the container, I get below message:

    Unrecognized setting. No declared setting with name: apoc.initializer.cypher.1
    Unrecognized setting. No declared setting with name: apoc.initializer.cypher.2

When I try to use, older version of environment variables:

    --env NEO4J_apoc_initializer_cypher_1=&#39;CALL apoc.cypher.runSchemaFile(&quot;file:////var/lib/neo4j/db_init_scripts/db_schema.cypher&quot;);&#39; \
    --env NEO4J_apoc_initializer_cypher_2=&#39;CALL apoc.cypher.runFile(&quot;file:////var/lib/neo4j/db_init_scripts/db_ddls.cypher&quot;);&#39; \

I get this:

    Unrecognized setting. No declared setting with name: apoc.initializer.cypher.1
    Unrecognized setting. No declared setting with name: apoc.initializer.cypher.2

But when I try to run only one cypher:

    --env NEO4J_apoc_initializer_cypher=&#39;CALL apoc.cypher.runSchemaFile(&quot;file:////var/lib/neo4j/db_init_scripts/db_ddls.cypher&quot;);&#39; \

**Then it works.** 

This is how my conf/neo4j.conf looks:

    root@4f8955759b52:/var/lib/neo4j# grep apoc conf/neo4j.conf
    #dbms.security.procedures.allowlist=apoc.coll.*,apoc.load.*,gds.*
    apoc.initializer.neo4j.1=CALL apoc.cypher.runFile(&quot;file:////var/lib/neo4j/db_init_scripts/db_schema.cypher&quot;);
    apoc.initializer.neo4j.0=CALL apoc.cypher.runSchemaFile(&quot;file:////var/lib/neo4j/db_init_scripts/db_ddls.cypher&quot;);
    apoc.import.file.use_neo4j_config=true
    apoc.import.file.enabled=true
    apoc.export.file.enabled=true
    dbms.security.procedures.unrestricted=apoc.*

Can anyone point what I am missing so that I can run both creation of indexes as well as initialize some schema as well?

Thanks",1622033200,https://stackoverflow.com/q/67705203,Paras Bansal,"['neo4j', 'docker', 'cypher']"
67702813,How to enable `apoc.nlp.gcp.entities.stream` in neo4j within a docker-compose file?,"I am a beginner with Neo4j and I do not want to install a lot of software on the computer. Hence, Docker images are a good option. I try to use the apoc nlp procedure of neo4j. To do so i am using the following docker-compose file:
```
version: &#39;3.7&#39;

services:
  neo4j:
    image: neo4j:latest
    container_name: &quot;nlp-knowledge-graph&quot;
    volumes:
      - ./plugins:/plugins
      - ./data:/data
      - ./import:/var/lib/neo4j/import
    ports:
      - &quot;7474:7474&quot;
      - &quot;7687:7687&quot;
    environment:
      - &quot;NEO4J_ACCEPT_LICENSE_AGREEMENT=yes&quot;
      - &quot;NEO4J_AUTH=neo4j/neo&quot;
      - &quot;NEO4J_dbms_security_procedures_unrestricted=apoc.*&quot;
      - NEO4JLABS_PLUGINS=[&quot;apoc&quot;,&quot;n10s&quot;]
```
Apoc is indeed installed but when i try to use an de a `CALL apoc.nlp.gcp.entities.stream ...` within a neo4j query, i get the following error.
```
Neo.ClientError.Procedure.ProcedureNotFound
There is no procedure with the name `apoc.nlp.gcp.entities.stream` registered for this database instance. Please ensure you&#39;ve spelled the procedure name correctly and that the procedure is properly deployed.
```

What should i do so as to properly deploy the `apoc.nlp.gcp.entities.stream` procedure via the docker-compose file?

Thank you so much for you time.",1622023728,https://stackoverflow.com/q/67702813,efotopoulou,"['neo4j-apoc', 'neo4j', 'nlp']"
67701558,Creating node and set ID for it without duplicating field,"I created a node with given id, 

    create (n:Entry) set n.id=1111

but database created two field id in node, one default and one by myself. 
[![enter image description here][1]][1]

Could you help me how to set id for node when creating without generating two similar field &quot;id&quot;?
Thanks in advance.


  [1]: https://i.stack.imgur.com/ZQrFH.png",1622018926,https://stackoverflow.com/q/67701558,Trần Tuấn Anh,['neo4j']
67700021,neo4j matching two different relationships and retrieving count while avoiding cartesian product,"So I have database in which I want to retrieve the result that has the relationship &quot;Reviewed&quot; and in this result I want to retrieve entities with relationship &quot;acted_in&quot; and return the movie with highest number of cast members.

This is the code I wrote: 

```
MATCH (a:Person)-[r2:REVIEWED]-&gt;(movie:Movie)&lt;-[r:ACTED_IN]-(actors:Person) 
RETURN movie.title as Movie_name, count(actors) as no_of_cast 
ORDER BY no_of_cast DESC
Limit 1
```
It returns the correct movie name but the number of cast members is a cartesian product of the persons who reviewed and the persons who acted in.

The result I get after the collect function on actors is 
```
&quot;The Replacements&quot;	[&quot;Brooke Langton&quot;, &quot;Keanu Reeves&quot;, &quot;Orlando Jones&quot;, &quot;Gene Hackman&quot;, &quot;Brooke Langton&quot;, &quot;Keanu Reeves&quot;, &quot;Orlando Jones&quot;, &quot;Gene Hackman&quot;, &quot;Brooke Langton&quot;, &quot;Keanu Reeves&quot;, &quot;Orlando Jones&quot;, &quot;Gene Hackman&quot;]
```
It repeats the actors the number of times relationship &quot;reviewed&quot; is present in that movie node.

How can I avoid this and get the correct number of cast members which is 4. Thank you.   ",1622012511,https://stackoverflow.com/q/67700021,AnxiousConcert,"['cartesian-product', 'neo4j']"
67698672,fail to restart neo4j docker after import data via neo4j-admin,"I met an error after import data into neo4j .

Here I have various data and I want to import them into neo4j docker. However I met some problems

Here is my import command , refer from [official document][1]

```shell
docker run --interactive --tty  \
    --publish=17474:7474 --publish=17687:7687 \
    --user=&quot;$(id -u):$(id -g)&quot; \
    --volume=$PWD/import:/import \
    --name neo4j_test_docker \
    neo4j \
neo4j-admin import --nodes=/import/nodes.csv --relationships=/import/rels.csv --relationships=/import/edges.csv --quote=&#39;&quot;&#39; --trim-strings=true --skip-duplicate-nodes=true --skip-bad-relationships=true
```

Here is the part of my data

```csv
:START_ID,:END_ID,:TYPE,var,flowLabel
3,6,FLOWS_TO,,
6,10,FLOWS_TO,,

:START_ID,:END_ID,:TYPE
2,3,ENTRY
2,4,EXIT
7,8,PARENT_OF


1744,AST,string,,250,trigger_change,0,603,,,,,,602
1745,AST,string,,250,type,1,603,,,,,,602
```

As you can see the there is no problem when import data 
```shell
.......... .......... .......... .......... .......... 100% ∆0ms


IMPORT DONE in 6s 692ms. 
Imported:
  975965 nodes
  1177348 relationships
  7596252 properties
Peak memory usage: 894.2MiB
```

However my neo4j has shutdown and cannot open 

```shell
$ docker ps -a
CONTAINER ID   IMAGE     COMMAND                  CREATED              STATUS                      PORTS     NAMES
de93b1971cd7   neo4j     &quot;/sbin/tini -g -- /d…&quot;   About a minute ago   Exited (1) 17 seconds ago             neo4j_test_docker
```


  [1]: https://neo4j.com/docs/operations-manual/current/docker/operations/#docker-neo4j-import",1622004437,https://stackoverflow.com/q/67698672,ShaoBaoEr,"['docker', 'neo4j', 'cypher']"
67691956,Toggle relationship in Neo4J,"I&#39;m trying to implement follow/unfollow in Neo4J. I would like to write a query would toggle the relationship between two nodes.

I currently have the following query:

```lang-js
neoSession.writeTransaction(tx =&gt; tx.run(&#39;MATCH (me:User), (other:User) WHERE ID(me) = $me AND ID(other) = $other OPTIONAL MATCH (me)-[af:FOLLOWS]-&gt;(other) CALL apoc.do.when(af IS NULL, CREATE (me)-[f:FOLLOWS]-&gt;(other), DELETE af)&#39;, { me: req.user_id, other: req.body.user, datetime: Date.now() }));
```

Prettified query-only:

```cypher
MATCH (me:User), (other:User) 
  WHERE ID(me) = $me AND ID(other) = $other 
OPTIONAL MATCH (me)-[af:FOLLOWS]-&gt;(other) 
CALL 
  apoc.do.when(
    af IS NULL, 
    CREATE (me)-[f:FOLLOWS]-&gt;(other), 
    DELETE af
  )
```

But this results in the error

```
Neo4jError: Invalid input &#39;&gt;&#39; (line 1, column 169 (offset: 168))

&quot;MATCH (me:User), (other:User) WHERE ID(me) = $me AND ID(other) = $other OPTIONAL MATCH (me)-[af:FOLLOWS]-&gt;(other) CALL apoc.do.when(af IS NULL, CREATE (me)-[f:FOLLOWS]-&gt;(other), DELETE af)&quot;
```
",1621959757,https://stackoverflow.com/q/67691956,Ajith Gopi,"['neo4j', 'cypher', 'neo4j-apoc']"
67690659,Neo4j Timetree query,"I am new in neo4j and is there any query to get the session nodes from 2021-05-20 to 2021-05-28?

Here are my nodes

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/j8znH.png",1621954935,https://stackoverflow.com/q/67690659,Ganbel,['neo4j']
67690520,Relationships always return as empty on Spring Data Neo4J,"Spring boot version: 2.4.6

I have a query like to find users by country:


    @Query(&quot;MATCH (u:User)-[r:LIVES_IN]-&gt;(c:Country) &quot; +
            &quot;WHERE c.countryCode = $country &quot; +
            &quot;WITH u &quot; +
            &quot;MATCH (u)-[p:HAS_FRIENDS]-&gt;(:User) &quot; +
            &quot;RETURN u, collect(p)&quot;)
    List&lt;User&gt; findByCountry(@Param(&quot;country&quot;) String country);

To add a new friend:


    @Query(&quot;CREATE (u:User {name: $friendName}) &quot; +
            &quot;WITH u &quot; +
            &quot;MATCH (n:User) WHERE ID(n) = $userId &quot; +
            &quot;WITH u,n &quot; +
            &quot;CREATE (n)-[:HAS_FRIENDS]-&gt;(u) &quot; +
            &quot;RETURN n&quot;)
    User addFriendRelation(@Param(&quot;userId&quot;) Long userId, @Param(&quot;friendName&quot;) String friendName);

I have a node like:

    @Data //Getter,Setter, ToString, Equals...
    @NoArgsConstructor // empty constructor
    @Node
    public class User
    {
        @Id
        @GeneratedValue
        private Long id;
    
        @Property
        private String name;
    
        @Relationship(type = &quot;HAS_FRIENDS&quot;) // it can be also converted to an entity.
        private List&lt;User&gt; friends;
    
        //User lives in these countries...
        @Relationship(type = LivesInRelation.TYPE)
        private LivesInRelation livesIn;
    
        public User(String name)
        {
            this.name = name;
        }
    }

And to test it:

    @Test
    public void testFindByCountry()
    {
        User user = new User(&quot;Bob&quot;);
        user.setLivesIn(new LivesInRelation(user, new Country(&quot;US&quot;), LocalDateTime.of(2000, 1, 1, 1, 1)));
        User usedDB = userRepository.saveUser(user);
        userService.userRepository(usedDB.getId(), &quot;Marry&quot;);
    
        List&lt;User&gt; userListByCountry = userRepository.findByCountry(&quot;US&quot;);
    
        assertThat(userListByCountry).hasSize(1);
        assertThat(userListByCountry.get(0).getFriends()).hasSize(1); //Doesn&#39;t work
        assertThat(userListByCountry.get(0).getName()).isEqualTo(&quot;Bob&quot;);
    }

I&#39;ve implemented like that. Queries work on neo4j-browser like a charm. But on spring-boot, they are not. 
So how can I return Node with relationships? Is there any suggestion?


Solution:

    @Query(&quot;MATCH (u:User)-[r:LIVES_IN]-&gt;(c:Country) &quot; +
                &quot;WHERE c.countryCode = $country &quot; +
                &quot;WITH u &quot; +
                &quot;MATCH (u)-[p:HAS_FRIENDS]-&gt;(x:User) &quot; +
                &quot;RETURN u, collect(p), collect(x)&quot;)
        List&lt;User&gt; findByCountry(@Param(&quot;country&quot;) String country);

More detail: https://github.com/spring-projects/spring-data-neo4j/issues/2260",1621954495,https://stackoverflow.com/q/67690520,Sha,"['spring-data-neo4j', 'neo4j']"
67687826,how to apply louvain algo on a weighted graph from csv in neo4j?,"I have created a weighted graph named &#39;MyNode&#39; from csv.
but when I call louvain algorithm on MyNode I got the following error.
Failed to invoke procedure &#39;gds.louvain.write&#39; : caused by: Java.util.NoSuchException: Graph with name MyNode does not exist on database neo4j",1621945350,https://stackoverflow.com/q/67687826,TR RAO,"['cluster-analysis', 'neo4j']"
67687772,Combine multiple lists into a single list and output it for each row,"This example from documentation returns the commonMovies given a list of actors in which they all acted in.

https://neo4j.com/developer/kb/performing-match-intersection/#_use_apoc_to_intersect_result_lists

Instead of returning just 1 row for the common movies, how can I return the actor name as well for example
```
Keanu Reeves, [Movie1,Movie2,Movie3]
Hugo Weaving, [Movie1,Movie2,Movie3]
Emil Eifrem, [Movie1,Movie2,Movie3]
```

The common movies list would be same for each row, it wouldn&#39;t make sense in this case, but I abstracted my problem down to this",1621945179,https://stackoverflow.com/q/67687772,Pavan Kumar Kattamuri,"['neo4j', 'cypher']"
67683470,"Could Not Get Node Id and Node Labels , Spring Data Neo4j","I method in-service class that calls a method in Repository class that have same behavior to get the Entity Result from Neo4jRepository. This is the method:

		PersonnelNode personnelNodeData = personnelNodeDao.getByPersonnelId(Long.valueOf(&quot;2&quot;));
				
		ProductNode productNodeData = productNodeDao.findByProductId(Long.valueOf(&quot;21&quot;));

PersonnelNodeRepository Class

    public interface PersonnelNodeRepository extends Neo4jRepository&lt;PersonnelNode, Long&gt; {
    
    	PersonnelNode findByPersonnelId(Long personnelId);
    }

ProductNodeRepository Class

    public interface ProductNodeRepository extends Neo4jRepository&lt;ProductNode, Long&gt;, ProductNodeRepositoryCustom {
    
    	ProductNode findByProductId(Long productId);
    }

This is my PersonnelNode Entity Class

    @NodeEntity(label=&quot;Personnel&quot;)
    public class PersonnelNode {
    
    	private Long id;
    	
    	private Set&lt;String&gt; labels;
    	
    	@GraphId
    	private Long personnelId;
    	
    	private String personnelKey;	
    	
    	private String personnelNameIN;
    	
    	private Boolean isTeamLeader;
    	
    	private Boolean isQA;
    	
    	private Boolean isSuperUser;
    	
    	private Short companyGroupId;
    
    	private Boolean isActive;
    
    	private Timestamp created;
    
    	private String createdBy;
    
    	private Timestamp lastModified;
    
    	private String lastModifiedBy; 
    //
    	@Relationship(type=&quot;PERSONNEL_TASK&quot;, direction=Relationship.OUTGOING)
    	private TaskNode personnelTasks;
        
    	private Long employeeDataId;
    
    	public PersonnelNode() {
    	}
    
    	public Long getId() {
    		return id;
    	}
    
    	public void setId(Long id) {
    		this.id = id;
    	}
    
    	public Set&lt;String&gt; getLabels() {
    		return labels;
    	}
    
    	public void setLabels(Set&lt;String&gt; labels) {
    		this.labels = labels;
    	}
    
    	public Long getPersonnelId() {
    		return personnelId;
    	}
    
    	public void setPersonnelId(Long personnelId) {
    		this.personnelId = personnelId;
    	}
    
    	public String getPersonnelKey() {
    		return personnelKey;
    	}
    
    	public void setPersonnelKey(String personnelKey) {
    		this.personnelKey = personnelKey;
    	}
    
    	public String getPersonnelNameIN() {
    		return personnelNameIN;
    	}
    
    	public void setPersonnelNameIN(String personnelNameIN) {
    		this.personnelNameIN = personnelNameIN;
    	}
    
    	public Boolean getIsTeamLeader() {
    		return isTeamLeader;
    	}
    
    	public void setIsTeamLeader(Boolean isTeamLeader) {
    		this.isTeamLeader = isTeamLeader;
    	}
    
    	public Boolean getIsQA() {
    		return isQA;
    	}
    
    	public void setIsQA(Boolean isQA) {
    		this.isQA = isQA;
    	}
    
    	public Boolean getIsSuperUser() {
    		return isSuperUser;
    	}
    
    	public void setIsSuperUser(Boolean isSuperUser) {
    		this.isSuperUser = isSuperUser;
    	}
    
    	public Short getCompanyGroupId() {
    		return companyGroupId;
    	}
    
    	public void setCompanyGroupId(Short companyGroupId) {
    		this.companyGroupId = companyGroupId;
    	}
    
    	public Boolean getIsActive() {
    		return isActive;
    	}
    
    	public void setIsActive(Boolean isActive) {
    		this.isActive = isActive;
    	}
    
    	public Timestamp getCreated() {
    		return created;
    	}
    
    	public void setCreated(Timestamp created) {
    		this.created = created;
    	}
    
    	public String getCreatedBy() {
    		return createdBy;
    	}
    
    	public void setCreatedBy(String createdBy) {
    		this.createdBy = createdBy;
    	}
    
    	public Timestamp getLastModified() {
    		return lastModified;
    	}
    
    	public void setLastModified(Timestamp lastModified) {
    		this.lastModified = lastModified;
    	}
    
    	public String getLastModifiedBy() {
    		return lastModifiedBy;
    	}
    
    	public void setLastModifiedBy(String lastModifiedBy) {
    		this.lastModifiedBy = lastModifiedBy;
    	}
    
    	public Long getEmployeeDataId() {
    		return employeeDataId;
    	}
    
    	public void setEmployeeDataId(Long employeeDataId) {
    		this.employeeDataId = employeeDataId;
    	}
    
    	public TaskNode getPersonnelTasks() {
    		return personnelTasks;
    	}
    
    	public void setPersonnelTasks(TaskNode personnelTasks) {
    		this.personnelTasks = personnelTasks;
    	}
    
    }

ProductNode Entity Class

    @NodeEntity(label=&quot;Product&quot;)
    public class ProductNode {
    	
    	private Long id;
    	
    	private Set&lt;String&gt; labels;
    	
    	@GraphId
    	private Long productId;
    	
    	private String productName;
    	
    	private String productDescription;
    	
    	private String productNotes;
    	
    	private Boolean isSolutions;
    	
    	private String roleDescription;
    	
    	private String databaseDescription;
    	
    	private String tableDescription;
    	
    	private Boolean isIntegrateBPMTask;
    	
    	private String integrateBPMTaskDescription;
    	
    	private Boolean isUseNotification;
    	
    	private String useNotificationDescription;
    	
    	private Boolean isUseBackgroundProcess;
    	
    	private String useBackgroundProcessDescription;
    		
    	private Short companyGroupId;
    	
    	private String productKey;
    	
    	private Boolean isActive;
    
    	private Timestamp created;
    
    	private String createdBy;
    
    	private Timestamp lastModified;
    
    	private String lastModifiedBy;
    
    	@Relationship(type=&quot;TASK_OF_PRODUCT&quot;, direction=Relationship.INCOMING)
    	private TaskNode taskNode;
    	
    	public ProductNode(){
    		
    	}
    	
    	public Long getId() {
    		return id;
    	}
    
    	public void setId(Long id) {
    		this.id = id;
    	}
    
    	public Set&lt;String&gt; getLabels() {
    		return labels;
    	}
    
    	public void setLabels(Set&lt;String&gt; labels) {
    		this.labels = labels;
    	}
    
    	public Long getProductId() {
    		return productId;
    	}
    
    	public void setProductId(Long productId) {
    		this.productId = productId;
    	}
    
    	public String getProductName() {
    		return productName;
    	}
    
    	public void setProductName(String productName) {
    		this.productName = productName;
    	}
    
    	public String getProductDescription() {
    		return productDescription;
    	}
    
    	public void setProductDescription(String productDescription) {
    		this.productDescription = productDescription;
    	}
    
    	public String getProductNotes() {
    		return productNotes;
    	}
    
    	public void setProductNotes(String productNotes) {
    		this.productNotes = productNotes;
    	}
    
    	public Boolean getIsSolutions() {
    		return isSolutions;
    	}
    
    	public void setIsSolutions(Boolean isSolutions) {
    		this.isSolutions = isSolutions;
    	}
    
    	public String getRoleDescription() {
    		return roleDescription;
    	}
    
    	public void setRoleDescription(String roleDescription) {
    		this.roleDescription = roleDescription;
    	}
    
    	public String getDatabaseDescription() {
    		return databaseDescription;
    	}
    
    	public void setDatabaseDescription(String databaseDescription) {
    		this.databaseDescription = databaseDescription;
    	}
    
    	public String getTableDescription() {
    		return tableDescription;
    	}
    
    	public void setTableDescription(String tableDescription) {
    		this.tableDescription = tableDescription;
    	}
    
    	public Boolean getIsIntegrateBPMTask() {
    		return isIntegrateBPMTask;
    	}
    
    	public void setIsIntegrateBPMTask(Boolean isIntegrateBPMTask) {
    		this.isIntegrateBPMTask = isIntegrateBPMTask;
    	}
    
    	public String getIntegrateBPMTaskDescription() {
    		return integrateBPMTaskDescription;
    	}
    
    	public void setIntegrateBPMTaskDescription(String integrateBPMTaskDescription) {
    		this.integrateBPMTaskDescription = integrateBPMTaskDescription;
    	}
    
    	public Boolean getIsUseNotification() {
    		return isUseNotification;
    	}
    
    	public void setIsUseNotification(Boolean isUseNotification) {
    		this.isUseNotification = isUseNotification;
    	}
    
    	public String getUseNotificationDescription() {
    		return useNotificationDescription;
    	}
    
    	public void setUseNotificationDescription(String useNotificationDescription) {
    		this.useNotificationDescription = useNotificationDescription;
    	}
    
    	public Boolean getIsUseBackgroundProcess() {
    		return isUseBackgroundProcess;
    	}
    
    	public void setIsUseBackgroundProcess(Boolean isUseBackgroundProcess) {
    		this.isUseBackgroundProcess = isUseBackgroundProcess;
    	}
    
    	public String getUseBackgroundProcessDescription() {
    		return useBackgroundProcessDescription;
    	}
    
    	public void setUseBackgroundProcessDescription(String useBackgroundProcessDescription) {
    		this.useBackgroundProcessDescription = useBackgroundProcessDescription;
    	}
    	
    	public Short getCompanyGroupId() {
    		return companyGroupId;
    	}
    
    	public void setCompanyGroupId(Short companyGroupId) {
    		this.companyGroupId = companyGroupId;
    	}
    
    	public String getProductKey() {
    		return productKey;
    	}
    
    	public void setProductKey(String productKey) {
    		this.productKey = productKey;
    	}
    
    	public Boolean getIsActive() {
    		return isActive;
    	}
    
    	public void setIsActive(Boolean isActive) {
    		this.isActive = isActive;
    	}
    
    	public Timestamp getCreated() {
    		return created;
    	}
    
    	public void setCreated(Timestamp created) {
    		this.created = created;
    	}
    
    	public String getCreatedBy() {
    		return createdBy;
    	}
    
    	public void setCreatedBy(String createdBy) {
    		this.createdBy = createdBy;
    	}
    
    	public Timestamp getLastModified() {
    		return lastModified;
    	}
    
    	public void setLastModified(Timestamp lastModified) {
    		this.lastModified = lastModified;
    	}
    
    	public String getLastModifiedBy() {
    		return lastModifiedBy;
    	}
    
    	public void setLastModifiedBy(String lastModifiedBy) {
    		this.lastModifiedBy = lastModifiedBy;
    	}
    
    	public TaskNode getTaskNode() {
    		return taskNode;
    	}
    
    	public void setTaskNode(TaskNode taskNode) {
    		this.taskNode = taskNode;
    	}
    	
    }


I could get node Id and node labels for the ProductNode Entity but it&#39;s returning the null value in the PersonnelNode Entity.
",1621927519,https://stackoverflow.com/q/67683470,Ferry Simangunsong,"['spring-data-neo4j', 'java', 'neo4j', 'cypher', 'neo4j-ogm']"
67683449,connect with service running on host from docker container,"I have done ssh port forwarding which listens to 2000 in my local. So the service is running on localhost:2000, it is Neo4J server. In my local, I am able to connect with Neo4J using Neo4J desktop by giving `bolt://localhost:2000` and can look at the datas.

but i am not able to connect with host bolt://localhost:2000 in docker container.

I looked at the answers here

https://stackoverflow.com/questions/24319662/from-inside-of-a-docker-container-how-do-i-connect-to-the-localhost-of-the-mach

I added extra hosts in docker-compose.yml

    flask_service:
        build:
          context: ./project
          dockerfile: my_dockerfile
        container_name: flask_container
        stdin_open: true
        tty: true
        ports:
          - 5000:5000
        extra_hosts:
          - &quot;myhost:175.1.344.136&quot;

**175.1.344.136 being my host IP**
 and I have used both `bolt://175.1.344.136:2000` and `bolt://myhost:2000` inside container but it is not connecting. Also i want to know which is the right way `bolt://175.1.344.136:2000` or `bolt://myhost:2000`

I get an error

    2021-05-25T10:53:55+0000.060 [INFO] neo4j_proxy.__init__:74 (8:Thread-11) - NEO4J endpoint: bolt://myhost:2000
    Traceback (most recent call last):
      File &quot;/usr/local/lib/python3.7/site-packages/neobolt/direct.py&quot;, line 831, in _connect
        s.connect(resolved_address)
    ConnectionRefusedError: [Errno 111] Connection refused

I am using MacOs, Please help me resolve this.

Thanks in advance!
",1621927437,https://stackoverflow.com/q/67683449,young_minds1,"['neo4j', 'docker-compose', 'python', 'docker']"
67682614,In Neo4j find path from root to a node in a tree,"I am using Neo4J neosemantics plugin to load ontology. 
I want to find the path (all intermediate nodes and edges with their properties) from root of the tree to a particular node. What would be the best (optimal) way to get this information in cypher? 
The nodes are connected through subclassof relationships.",1621923193,https://stackoverflow.com/q/67682614,user1313016,"['rdf', 'cypher', 'rdfs', 'neo4j', 'ontology']"
67682253,py2neo how to get another relationship information on other nodes,"I use neo4j desktop and run this query:

`match (n:Person)-[f:friend]-&gt;(m:Person {userid:1}) return n,m,f`

and the results:

[![enter image description here][1]][1]

  [1]: https://i.stack.imgur.com/A3Nkr.png

I tried the same query with py2neo

`res = graph.run(&quot;match (n:Person)-[f:friend]-&gt;(m:Person {userid:1}) return n,m,f&quot;)`

it return all node that have relationship with user1, however there is no additional information whether user5 and user6 or user4 and user6 are friend.

is there any way to get also information that user5 and user6 are friend without going to check each node have relationship with other node?

 ",1621920652,https://stackoverflow.com/q/67682253,david,"['neo4j', 'py2neo']"
67682059,Spring Data Neo4j 4.2 query for labels or node id always return null,"Currently, I&#39;m building a graph visualization app using Spring Boot &amp; Neo4j. But when I call a method from my entity Neo4jRepository to get NodeEntity labels, it always returns a null value. Is the problem in my node entity?

This is my node entity 

    @NodeEntity(label=&quot;Personnel&quot;)
    public class PersonnelNode {
    
    	private Long id;
    	
    	@Labels
    	private Set&lt;String&gt; labels;
    	
    	@GraphId
    	private Long personnelId;
    	
    	private String personnelKey;	
    	
    	private String personnelNameIN;
    	
    	private Boolean isTeamLeader;
    	
    	private Boolean isQA;
    	
    	private Boolean isSuperUser;
    	
    	private Short companyGroupId;
    
    	private Boolean isActive;
    
    	private Timestamp created;
    
    	private String createdBy;
    
    	private Timestamp lastModified;
    
    	private String lastModifiedBy; 
    
    	@Relationship(type=&quot;PERSONNEL_TASK&quot;, direction=Relationship.OUTGOING)
    	private TaskNode personnelTasks;
        
    	private Long employeeDataId;
    
    	public PersonnelNode() {
    	}
    
    	public Long getId() {
    		return id;
    	}
    
    	public void setId(Long id) {
    		this.id = id;
    	}
    
    	public Set&lt;String&gt; getLabels() {
    		return labels;
    	}
    
    	public void setLabels(Set&lt;String&gt; labels) {
    		this.labels = labels;
    	}
    
    	public Long getPersonnelId() {
    		return personnelId;
    	}
    
    	public void setPersonnelId(Long personnelId) {
    		this.personnelId = personnelId;
    	}
    
    	public String getPersonnelKey() {
    		return personnelKey;
    	}
    
    	public void setPersonnelKey(String personnelKey) {
    		this.personnelKey = personnelKey;
    	}
    
    	public String getPersonnelNameIN() {
    		return personnelNameIN;
    	}
    
    	public void setPersonnelNameIN(String personnelNameIN) {
    		this.personnelNameIN = personnelNameIN;
    	}
    
    	public Boolean getIsTeamLeader() {
    		return isTeamLeader;
    	}
    
    	public void setIsTeamLeader(Boolean isTeamLeader) {
    		this.isTeamLeader = isTeamLeader;
    	}
    
    	public Boolean getIsQA() {
    		return isQA;
    	}
    
    	public void setIsQA(Boolean isQA) {
    		this.isQA = isQA;
    	}
    
    	public Boolean getIsSuperUser() {
    		return isSuperUser;
    	}
    
    	public void setIsSuperUser(Boolean isSuperUser) {
    		this.isSuperUser = isSuperUser;
    	}
    
    	public Short getCompanyGroupId() {
    		return companyGroupId;
    	}
    
    	public void setCompanyGroupId(Short companyGroupId) {
    		this.companyGroupId = companyGroupId;
    	}
    
    	public Boolean getIsActive() {
    		return isActive;
    	}
    
    	public void setIsActive(Boolean isActive) {
    		this.isActive = isActive;
    	}
    
    	public Timestamp getCreated() {
    		return created;
    	}
    
    	public void setCreated(Timestamp created) {
    		this.created = created;
    	}
    
    	public String getCreatedBy() {
    		return createdBy;
    	}
    
    	public void setCreatedBy(String createdBy) {
    		this.createdBy = createdBy;
    	}
    
    	public Timestamp getLastModified() {
    		return lastModified;
    	}
    
    	public void setLastModified(Timestamp lastModified) {
    		this.lastModified = lastModified;
    	}
    
    	public String getLastModifiedBy() {
    		return lastModifiedBy;
    	}
    
    	public void setLastModifiedBy(String lastModifiedBy) {
    		this.lastModifiedBy = lastModifiedBy;
    	}
    
    	public Long getEmployeeDataId() {
    		return employeeDataId;
    	}
    
    	public void setEmployeeDataId(Long employeeDataId) {
    		this.employeeDataId = employeeDataId;
    	}
    
    	public TaskNode getPersonnelTasks() {
    		return personnelTasks;
    	}
    
    	public void setPersonnelTasks(TaskNode personnelTasks) {
    		this.personnelTasks = personnelTasks;
    	}
    
    }

My Dao Class 

    @Component
    public class PersonnelNodeDao implements IPersonnelNodeDao {
    
    	private PersonnelNodeRepository personnelRepository;
    	
    	@Autowired
    	public PersonnelNodeDao(PersonnelNodeRepository personnelRepository) {
    		this.personnelRepository = personnelRepository;
    	}
    
    	@Override
    	public PersonnelNode getByEmployeeDataId(Long employeeDataId) {
    		return personnelRepository.findByEmployeeDataId(employeeDataId);
    	}
    
    	@Override
    	public PersonnelNode getByPersonnelId(Long personnelId) {
    		return personnelRepository.findByPersonnelId(personnelId);
    	}
    
    	@Override
    	public Object getLabelsByPersonnelId(Long personnelId) {
    		return personnelRepository.getLabelsByPersonnelId(personnelId);
    	}
    
    }

And this is my Neo4jRepository Class

    public interface PersonnelNodeRepository extends Neo4jRepository&lt;PersonnelNode, Long&gt; {

	@Query(&quot;&quot;
			+&quot;MATCH (p:Personnel)-[r:PERSONNEL_EMPLOYEE]-&gt;(e:Employee) &quot;
			+ &quot;WHERE e.employeeDataId = {0} RETURN p&quot;)
	PersonnelNode findByEmployeeDataId(Long employeeDataId);

	@Query(&quot;MATCH (p:Personnel) WHERE p.personnelId = {0} RETURN p, ID(p), labels(p)&quot;)
	PersonnelNode findByPersonnelId(Long personnelId);
	
	@Query(&quot;&quot;
    		+ &quot;MATCH p=(n:Personnel)-[r:PERSONNEL_TASK]-&gt;(t:Task {isActive: true}) &quot;
    		+ &quot;&lt;-[pt:PROJECT_TASK]-(j:Project) &quot;
    		+ &quot;WHERE n.personnelId= {0} &quot;
    		+ &quot;RETURN nodes(p) as nodes, rels(p) as relationships&quot;)
    List&lt;Graph&lt;PersonnelNode&gt;&gt; getPersonnelLoadTaskGraphByEmployeeDataId(Long employeeDataId);

	@Query(&quot;MATCH (p:Personnel) WHERE p.personnelId = {0} RETURN labels(p)&quot;)
	Object getLabelsByPersonnelId(Long personnelId);
}

This is my service that calls the method 

    Object nodePersonnel = personnelNodeDao.getLabelsByPersonnelId(Long.valueOf(&quot;2&quot;));

The result is same when i set return variable with my node entity in my service also in my repository, its always return null value

    PersonnelNode nodePersonnel = personnelNodeDao.getByPersonnelId(Long.valueOf(&quot;2&quot;));

Actually my problem is, just for this entity. For antoher entity i could get the node id and the labels. This is the data return for personnel entity.
[Data Retrun From PersonnelRepository][1]


FYI I&#39;m using Spring Data Neo4j 4.2, spring boot 1.5.2 and ogm 2.1. Thank you before.


  [1]: https://i.stack.imgur.com/JRX1M.png",1621919193,https://stackoverflow.com/q/67682059,Ferry Simangunsong,"['java', 'neo4j', 'spring-data-neo4j', 'spring', 'neo4j-ogm']"
67675268,How to create and perform data manipulations with Neo4j database in PHP,"I am working with Neo4j database with PHP at https://github.com/neo4j-php/neo4j-php-client.

I have successfully installed the projects via Composer and have my neo4j database server running locally. I have also tested the sample applications.

**sample.php** 
```

&lt;?php

require (&#39;vendor/autoload.php&#39;);
$client = Laudis\Neo4j\ClientBuilder::create()
    -&gt;addHttpConnection(&#39;backup&#39;, &#39;http://neo4j:foodisgood56@localhost&#39;)
    -&gt;addBoltConnection(&#39;default&#39;, &#39;bolt://neo4j:foodisgood56@localhost&#39;)
    -&gt;setDefaultConnection(&#39;default&#39;)
    -&gt;build();


foreach ($client-&gt;run(&#39;UNWIND range(1, 9) as x RETURN x&#39;) as $item) {
    echo $item-&gt;get(&#39;x&#39;);
}


?&gt;

```

and it echos  **123456789** which suggests that my local neo4j database server is working fine.

**Here are my questions**

**1.) How create table Eg Table users_table via neo4js in PHP**

something like

`create table users_table(id int primary key auto_increment, fullname varchar(30), password varchar(30), email varchar(30));`

**2.) How to inserts, updates, select and delete example via php for neo4js**

How can I achieve equivalents of this php PDO in Neo4j database

**For insert** 

```

$statement = $db-&gt;prepare(&#39;INSERT INTO users_table
(password,fullname,email)
 values
(:password,:fullname,:email)&#39;);

$statement-&gt;execute(array( 
&#39;:password&#39; =&gt; &#39;my pass&#39;,
&#39;:fullname&#39; =&gt; &#39;Nkem C&#39;,
&#39;:email&#39; =&gt; &#39;testing@gmail.com&#39;));
```


**For Update**
```

$update = $db-&gt;prepare(&#39;UPDATE users_table set password=:password, fullname=:fullname where email=:email&#39;);

$update-&gt;execute(array( 
&#39;:password&#39; =&gt; &#39;my pass1&#39;,
&#39;:fullname&#39; =&gt; &#39;Nkem C1&#39;,
&#39;:email&#39; =&gt; &#39;testing@gmail.com&#39;));
```


**For Delete**

```

$del1 = $db-&gt;prepare(&#39;DELETE from users_table  where email=:email&#39;);

$del1-&gt;execute(array( 
&#39;:email&#39; =&gt; &#39;testing@gmail.com&#39;));



// delete all
$del2 = $db-&gt;prepare(&#39;DELETE from users_table&#39;);
$del2-&gt;execute(array());

```



**For Select**

```

$query1 = $db-&gt;prepare(&#39;SELECT * from users_table  where email=:email and password=:password&#39;);

$query1-&gt;execute(array( 
&#39;:email&#39; =&gt; &#39;testing@gmail.com&#39;,
&#39;:password&#39; =&gt; &#39;my pass&#39;
));



// select all
$query2 = $db-&gt;prepare(&#39;SELECT * from users_table&#39;);
$query2-&gt;execute(array());
```

",1621871964,https://stackoverflow.com/q/67675268,Nancy Moore,"['neo4j', 'php']"
67668163,Unable to Enable Neo4j spatial extention,"I am using neo4j 4.2.3. I installed properly. I enabled spatial extension by using below link.

    https://mattbanderson.com/setting-up-the-neo4j-spatial-extension/

I have added below mention jar in my plugin folder and restarted neo4j.

    neo4j-spatial-0.28.0-neo4j-4.2.3-server-plugin.jar

After that I am trying to execute below curl command but I am not getting any output.

    curl -u neo4j:password http://localhost:7474/db/data/
    curl -u neo4j:password -H &quot;Content-Type: application/json&quot; -X POST -d &#39;{&quot;query&quot;:&quot;CALL spatial.procedures&quot;}&#39; http://localhost:7474/db/data/cypher

I am not getting any error after running above commands.
",1621841297,https://stackoverflow.com/q/67668163,satish pujara,['neo4j']
67667742,Neo4j query WHERE IN a extremely long list,"I have a cypher query 

```match (n)-[r]-&gt;(m) where n.value in L return n.id, m.id``` 

and L is a list with size 10K. It took forever for the query to finish. How Neo4j process this query? Would it run the query in parallel? If I manually partition L to several lists and run several sub-queries with each sub-list, then merge the results from sub-queries, will that help?",1621838977,https://stackoverflow.com/q/67667742,Xiuwen Zheng,"['neo4j', 'cypher']"
67667645,Neo4j Docker: Please see the attached cause exception &quot;/var/lib/neo4j/certificates/neo4j.cert (No such file or directory)&quot;,"I&#39;m starting neo4j from Docker. What worked for months, no longer works. Coincidently I had storage issues with my Macbook pro, so I did some cleaning. Not too sure of the sequence of events what I did, however I am now getting this traceback:

    Starting Neo4j.
    2021-05-24 06:07:19.740+0000 INFO  ======== Neo4j 3.5.28 ========
    2021-05-24 06:07:19.763+0000 INFO  Starting...
    2021-05-24 06:07:39.645+0000 ERROR Failed to start Neo4j: Starting Neo4j failed: Component &#39;org.neo4j.server.database.LifecycleManagingDatabase@394e0104&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;/var/lib/neo4j/certificates/neo4j.cert (No such file or directory)&quot;. Starting Neo4j failed: Component &#39;org.neo4j.server.database.LifecycleManagingDatabase@394e0104&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;/var/lib/neo4j/certificates/neo4j.cert (No such file or directory)&quot;.
    org.neo4j.server.ServerStartupException: Starting Neo4j failed: Component &#39;org.neo4j.server.database.LifecycleManagingDatabase@394e0104&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;/var/lib/neo4j/certificates/neo4j.cert (No such file or directory)&quot;.
    	at org.neo4j.server.exception.ServerStartupErrors.translateToServerStartupError(ServerStartupErrors.java:45)
    	at org.neo4j.server.AbstractNeoServer.start(AbstractNeoServer.java:187)
    	at org.neo4j.server.ServerBootstrapper.start(ServerBootstrapper.java:124)
    	at org.neo4j.server.ServerBootstrapper.start(ServerBootstrapper.java:91)
    	at org.neo4j.server.CommunityEntryPoint.main(CommunityEntryPoint.java:32)
    Caused by: org.neo4j.kernel.lifecycle.LifecycleException: Component &#39;org.neo4j.server.database.LifecycleManagingDatabase@394e0104&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;/var/lib/neo4j/certificates/neo4j.cert (No such file or directory)&quot;.
    	at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:473)
    	at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:111)
    	at org.neo4j.server.AbstractNeoServer.start(AbstractNeoServer.java:180)
    	... 3 more
    Caused by: java.lang.RuntimeException: Error starting org.neo4j.graphdb.facade.GraphDatabaseFacadeFactory, /data/databases
    	at org.neo4j.graphdb.facade.GraphDatabaseFacadeFactory.initFacade(GraphDatabaseFacadeFactory.java:232)
    	at org.neo4j.graphdb.facade.GraphDatabaseFacadeFactory.newFacade(GraphDatabaseFacadeFactory.java:148)
    	at org.neo4j.server.database.CommunityGraphFactory.newGraphDatabase(CommunityGraphFactory.java:41)
    	at org.neo4j.server.database.LifecycleManagingDatabase.start(LifecycleManagingDatabase.java:90)
    	at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:452)
    	... 5 more
    Caused by: org.neo4j.kernel.lifecycle.LifecycleException: Component &#39;org.neo4j.bolt.BoltServer@7def08fc&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;/var/lib/neo4j/certificates/neo4j.cert (No such file or directory)&quot;.
    	at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:473)
    	at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:111)
    	at org.neo4j.graphdb.facade.GraphDatabaseFacadeFactory.initFacade(GraphDatabaseFacadeFactory.java:227)
    	... 9 more
    Caused by: java.lang.RuntimeException: Failed to initialize SSL encryption support, which is required to start this connector. Error was: Failed to generate private key and certificate
    	at org.neo4j.bolt.BoltServer.createSslContext(BoltServer.java:207)
    	at org.neo4j.bolt.BoltServer.createProtocolInitializer(BoltServer.java:170)
    	at org.neo4j.bolt.BoltServer.lambda$createConnectors$0(BoltServer.java:149)
    	at java.util.stream.Collectors.lambda$toMap$58(Collectors.java:1321)
    	at java.util.stream.ReduceOps$3ReducingSink.accept(ReduceOps.java:169)
    	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1384)
    	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)
    	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)
    	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
    	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
    	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:566)
    	at org.neo4j.bolt.BoltServer.createConnectors(BoltServer.java:149)
    	at org.neo4j.bolt.BoltServer.start(BoltServer.java:124)
    	at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:452)
    	... 11 more
    Caused by: java.lang.RuntimeException: Failed to generate private key and certificate
    	at org.neo4j.kernel.configuration.ssl.SslPolicyLoader.loadOrCreateLegacyPolicy(SslPolicyLoader.java:158)
    	at org.neo4j.kernel.configuration.ssl.SslPolicyLoader.getOrCreateLegacyPolicy(SslPolicyLoader.java:139)
    	at org.neo4j.kernel.configuration.ssl.SslPolicyLoader.getPolicy(SslPolicyLoader.java:120)
    	at org.neo4j.bolt.BoltServer.createSslContext(BoltServer.java:202)
    	... 24 more
    Caused by: java.io.FileNotFoundException: /var/lib/neo4j/certificates/neo4j.cert (No such file or directory)
    	at java.io.FileOutputStream.open0(Native Method)
    	at java.io.FileOutputStream.open(FileOutputStream.java:270)
    	at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:213)
    	at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:162)
    	at java.io.FileWriter.&lt;init&gt;(FileWriter.java:90)
    	at org.neo4j.ssl.PkiUtils.writePem(PkiUtils.java:233)
    	at org.neo4j.ssl.PkiUtils.createSelfSignedCertificate(PkiUtils.java:120)
    	at org.neo4j.kernel.configuration.ssl.SslPolicyLoader.loadOrCreateLegacyPolicy(SslPolicyLoader.java:154)
    	... 27 more
    2021-05-24 06:07:39.663+0000 INFO  Neo4j Server shutdown initiated by request

How can I fix this?",1621838386,https://stackoverflow.com/q/67667645,pymat,"['neo4j', 'docker']"
67663304,Why won&#39;t Neo4j Desktop open at all?,"I have uninstalled and reinstalled it 4 times. It worked on boot up the first time, then never again. When I open my task manager, it opens Neo4j as three background processes. If I try to open it again, one of the processes will jump to 14% of my CPU then back to 0%. 

More details:

I&#39;m on a Windows, system updates are all in. I&#39;ve tried to run it as an administrator and I&#39;ve tried restarting my laptop. Nothing is working and it refuses to open again. It&#39;s the newest Neo4j update. 

Edit: More details because I don&#39;t know what I&#39;m doing:

It&#39;s the Desktop, version 1.4.5",1621795791,https://stackoverflow.com/q/67663304,Savanah Marisa Barnes,"['neo4j-desktop', 'neo4j']"
67658260,Exporting Neo4j data with more than 4000000 rows in json file,"I am trying to export data from the Neo4j Query in a JSON file. The query produces a large size of data. I am using ```CALL apoc.export.json.query(&quot;query&quot;, &quot;file_name&quot;)``` to export data from Neo4j when I run the same query using Neo4j Browser it runs perfectly and produces the desired file in 20 minutes but when I run the same query using Neo4j python client libraries like py2neo, neo4j, etc The query is not able to finish even after 5-6 hours and was not able to finish for any run. But when I add a LIMIT and try to export fewer rows it works fine.

I am running the Neo4j on GCP VM and when I check the CPU utilization after 20-30 minutes It almost drops to zero but still the query gets on running and not able to finish.

But the same query runs fine on the Neo4j browser. and CPU utilization never goes beyond 20-30% whether running with browser or client library.

Total Number of rows to export= 4,103,983

Update:
When using stream: true and file name as null it is giving error as 
```
neo4j.exceptions.ClientError: {code: Neo.ClientError.Procedure.ProcedureCallFailed} 
{message: Failed to invoke procedure `apoc.export.json.query`: 
Caused by: java.lang.RuntimeException: Error polling, timeout of 100 seconds reached.}
```

So can we change the polling timeout in neo4j.conf",1621762582,https://stackoverflow.com/q/67658260,Ayush Raj,"['cypher', 'py2neo', 'neo4j', 'python']"
67649248,display all nodes except one type of node,"I have a project that I work on, that looking to display relations between symptoms and treatments.
I want to add the option to add a TAG to every node (symptom or treatments) for classification, 
But the issue is when I&#39;m looking for a path or to display all nodes I don&#39;t want the TAG relation to be used.

is there a way to ask a cypher to display all nodes except one type (the TAG node and the tag relation)?

Thank you all",1621685026,https://stackoverflow.com/q/67649248,yosineyo ,"['cypher', 'neo4j', 'graphdb']"
67645314,Can I have the command (dependency) for neo4j in build.sbt for spark 3 and scala 2.12 please?,"I am unable to add the given &quot;resolvers += &quot;Spark Packages Repo&quot; at &quot;http://dl.bintray.com/spark-packages/maven&quot;

    libraryDependencies += &quot;org.neo4j&quot; % &quot;neo4j-connector-apache-spark_${scala.version}&quot; % &quot;4.0.1_for_spark_${spark.version}&quot;

 dependency command in build.sbt file. This throw me errors Can I know the right command please?

Thanks.",1621646295,https://stackoverflow.com/q/67645314,ramya,"['sbt', 'apache-spark', 'build', 'neo4j']"
67635928,Tweak logging of standalone Neo4j server,"When running the Neo4j standalone community Docker, some logs are written to stdout and some to a file inside the container: *debug.log*.

I would like to be able to set log4j options, like log-level, appenders etc. The reasons are:
* I can&#39;t access the log files when running in e.g AWS ECS
* The debug logs are quite verbose
* log4j-properties are convenient to deploy and manage

**So the question is, how can I set a custom log4j properties for a Neo4j server that&#39;s running inside a container?**

It&#39;s not documented if it&#39;s even possible, but I have tried the usual things one starts to thing of. First adding a `log4j.xml` to the classpath but to no avail. Also I have tried setting `dbms.jvm.additional` to

 * `-Dlog4j.configuration=&lt;path_to_file&gt;`
 * `-Dlog4j.configurationFile=&lt;path_to_file&gt;`
 * `-Dlog4j2.configurationFile==&lt;path_to_file&gt;`

I&#39;ve verified that the Neo4j process has the correct jvm-arguments:
```
/usr/local/openjdk-11/bin/java -cp /var/lib/neo4j/plugins:/var/lib/neo4j/conf:/var/lib/neo4j/lib/*:/var/lib/neo4j/plugins/* 
-Xms2048m -Xmx2048m -XX:+UseG1GC -XX:-OmitStackTraceInFastThrow -XX:+AlwaysPreTouch 
-XX:+UnlockExperimentalVMOptions -XX:+TrustFinalNonStaticFields -XX:+DisableExplicitGC 
-XX:MaxInlineLevel=15 -XX:-UseBiasedLocking -Djdk.nio.maxCachedBufferSize=262144 
-Dio.netty.tryReflectionSetAccessible=true -Djdk.tls.ephemeralDHKeySize=2048 
-Djdk.tls.rejectClientInitiatedRenegotiation=true -XX:FlightRecorderOptions=stackdepth=256 
-XX:+UnlockDiagnosticVMOptions -XX:+DebugNonSafepoints -Dlog4j2.disable.jmx=true 
-Dlog4j.configuration=file:/var/lib/neo4j/conf/log4j.properties 
-Dlog4j.configurationFile=file:/var/lib/neo4j/conf/log4j.xml 
-Dlog4j2.configurationFile=file:/var/lib/neo4j/conf/log4j2.xml 
-Dfile.encoding=UTF-8 org.neo4j.server.CommunityEntryPoint 
--home-dir=/var/lib/neo4j --config-dir=/var/lib/neo4j/conf
```

I have verified that no lib-jars contains a log4j-properties that takes precedence.

And whatever I try, no changes are made to the way the server is logging. The same events are written to `/logs/debug.log`. No exceptions regarding bad log4j config or something like that.

I have created a small [project][1] for easier debugging.


  [1]: https://github.com/RickardCardell/debug-neo4j-logging",1621596368,https://stackoverflow.com/q/67635928,selle,"['log4j2', 'docker', 'neo4j']"
67632418,Neo4j docker performance problems,"I currently have a very strange behavior with performance when running neo4j community as Docker. First of all, I am currently importing JSON data into a neo4j database using the [https://github.com/BloodHoundAD/BloodHound](https://github.com/BloodHoundAD/BloodHound) program. Boodhound uses the [JS file](https://github.com/BloodHoundAD/BloodHound/blob/master/src/js/newingestion.js) for the import. The import itself works fine, however I have a very different behavior when I run the neo natively or as a docker container.

Now when I import the data on a native Neo4j database it takes about 1 min (even with multiple attempts). 


```bash
All files imported in 66.52 s.
```

The memory settings are set to the following values:
```
dbms.memory.heap.max_size=5G
dbms.memory.pagecache.size=5G
```


Since I need multiple instances of neo4j for my tests, I came up with the idea to docker this and thus create multiple containers for multiple instances of neo4j. When I start the Docker container (and set the same settings as in the native Neo4j database) the import takes very different times and significantly longer:
```
started with:
sudo docker run --name &quot;testneo4j&quot; --rm -p 7687:7687 -p 7474:7474 --env NEO4J_AUTH=neo4j/test --env NEO4J_dbms_memory_pagecache_size=5G --env NEO4J_dbms_memory_heap_max__size=5G neo4j:4.2.3


Results:
All files imported in 1052.01 s.
All files imported in 383.83 s.
All files imported in 415.76 s.
All files imported in 661.72 s.
All files imported in 710.43 s.
All files imported in 415.76 s
All files imported in 642.58 s
```
Since it requires additional effort with Docker, I expected a longer runtime. However, the fact that the times increase roughly by a factor of 10 seems strange to me. In addition, the import times are not stable, which I can not really explain.  

Now to my actual question, are there any settings on the Docker side or the neo4j Docker container that can cause such a slowdown (factor 10)? Also, can anyone explain why the times are not constant?

I have already tried several things with the parallelization of the import, as well as the order of the files to be imported, but the behavior itself has not changed.

Thanks in advance, I am open to any idea :)",1621581608,https://stackoverflow.com/q/67632418,Chef123,"['docker', 'performance', 'neo4j']"
67631544,How to write Cypher query in .net core API,"I have a Cypher query like that

```
MATCH (n: learningPaths) 
WHERE any(x IN n.modules WHERE x = &quot;any course&quot;)
RETURN n
```

How can I write this query in .net core API to get the results

Previously I have a query like that

```
MATCH (n:learningPaths)-[]-&gt;(m:modules) 
WHERE m.id = &quot;any course&quot; 
RETURN n;
```

and I write below in .net core API

```c#
var result = (
    await _graphClient.Cypher
          .Match(@&quot;(n:learningPaths)-[]-&gt;(m:modules)&quot;)
          .Where&lt;modules&gt;(m =&gt; m.id == &quot;any course&quot;)
          .Return((n)=&gt;  n.As&lt;learningPaths&gt;())
          .ResultsAsync)
          .ToList();",1621576915,https://stackoverflow.com/q/67631544,Prateek,"['asp.net-core', 'neo4j', 'neo4jclient', 'cypher']"
67630958,Neo4j is returning No Value for cypher query,"
I have a duration column in a csv file with the following format: &quot;0:00:00&quot;.
I created these nodes in Neo4j:

```
LOAD CSV WITH HEADERS FROM &quot;file:///file.csv&quot; AS line
CREATE (testnode: Event {
  tph: toInteger(substring(line.Dur,0,1)),
  tpm: toInteger(substring(line.Dur,2,2)),
  tps: toInteger(substring(line.Dur,5,2))
})
```

Then I typed the following query to create a duration: 

```
MATCH (n:Event)
UNWIND duration({hours: n.tph, minutes: n.tpm, seconds: n.tps}) AS duration
RETURN duration.minutes
```

Neo4j answer was: hours must be a number value, but was a NoValue.
Maybe this is a wrong way to create durations using a map, I need to know how to do it.",1621572658,https://stackoverflow.com/q/67630958,BeautifulBee,"['cypher', 'neo4j']"
67615799,Py2neo push( ) function not updating node in neo4j,"I am trying to update node values through push function of py2neo. It is not updating values in neo4j without generating any error.

    tx=graph.begin()
    nodes=list(matcher.match(&quot;title&quot;).where(&quot;_.AuthorName =&#39;%s&#39;&quot;%N))
    nodes[0][&quot;age&quot;]=age
    nodes[0][&quot;Salary&quot;]=salary
    tx.push(nodes[0])
    tx.commit()

above is the code. i am trying to update age and salary value. nodes is the object in which results fetched from neo4j.",1621495519,https://stackoverflow.com/q/67615799,aumm-e-hani Munir,"['push', 'py2neo', 'neo4j']"
67608713,PropertyDimension of fastRPExtended,"For the extended fastRP algorithm:

    CALL gds.beta.fastRPExtended.mutate(
      graphName: String,
      configuration: Map
    )
    YIELD
      nodeCount: Integer,
      nodePropertiesWritten: Integer,
      createMillis: Integer,
      computeMillis: Integer,
      mutateMillis: Integer,
      configuration: Map

And the &#39;propertyDimension&#39; parameter:

    The dimension of the projected node properties. Maximum value is embeddingDimension.

If the node property I want to use is an embedding vector produced from a bert model for this algorithm, whose dimension is larger than the embeddingDimension, is this ok? Or, this propertyDimension parameter has nothing to do with the property dimension. 

",1621448008,https://stackoverflow.com/q/67608713,marlon,['neo4j']
67599072,repartition(1) - Makes loading very slow,"When I load 20 Million records from spark - Databricks into neo4j when I mention repartition (1) While writing into neo4j - It takes a lot of time for loading all the records. If I didnt mention repartition(1) it is failing with database not upto the requested version error. How to overcome this?

DBR specifications: 6.4 (includes Apache Spark 2.4.5, Scala 2.11)

Connector - Libraries:

spark_cdm_connector_assembly_0_19_0.jar, neo4j-contrib:neo4j-connector-apache-spark_2.11:4.0.1

Neo4j - Single Neo4j Instance

Error:

org.neo4j.driver.exceptions.TransientException: Database &#39;xxx&#39; not up to the requested version: 1879. Latest database version is 1867",1621410853,https://stackoverflow.com/q/67599072,Karuna,"['neo4j', 'cypher', 'databricks', 'apache-spark', 'azure-databricks']"
67577103,Cypher join informations from different tables into a single one,"I&#39;m new in cypher and I&#39;m struggling with this problem:

I have these two queries

    MATCH (u:UserNode)-[:PROMOTER_OF*1..]-&gt;(c:UserNode)
    WHERE u.promoterActualRole IN [&quot;GOLD&quot;,&quot;RUBY&quot;,&quot;SAPPHIRE&quot;,&quot;BRONZE&quot;,&quot;EMERALD&quot;, &quot;DIAMOND&quot;]
        AND datetime(c.promoterStartActivity) &gt;= datetime(&quot;2021-02-01T00:00:00Z&quot;) 
        AND datetime(c.promoterStartActivity)&lt;= datetime(&quot;2021-05-31T23:59:59Z&quot;)
        AND c.promoterEnabled = true
        AND u.firstName=&quot;Gianvito&quot;
    WITH distinct u as user, count(c) as num_promoter
    WHERE num_promoter &gt;= 150
    RETURN user.firstName as name, user.email as email, num_promoter
which will return me a table like this

|name|email|num_promoter|
|---|---|---|
|Gianvito|gianvito@email.com|1475|

and 

    MATCH (u:UserNode)-[:PROMOTER_OF*1..]-&gt;(c:UserNode)
    WHERE u.promoterActualRole IN [&quot;GOLD&quot;,&quot;RUBY&quot;,&quot;SAPPHIRE&quot;,&quot;BRONZE&quot;,&quot;EMERALD&quot;, &quot;DIAMOND&quot;]
        AND datetime(c.subscriptionDate) &gt;= datetime(&quot;2021-02-01T00:00:00Z&quot;) 
        AND datetime(c.subscriptionDate)&lt;= datetime(&quot;2021-05-31T23:59:59Z&quot;)
        AND c.kycStatus = &quot;OK&quot;
        AND u.firstName=&quot;Gianvito&quot;
    WITH distinct u as user, count(c) as num_swaggy
    WHERE num_swaggy &gt;= 1
    RETURN user.firstName as name, user.email as email , num_swaggy


|name|email|num_swaggy|
|---|---|---|
|Gianvito|gianvito@email.com|1820|

I would like to merge these two results into a single table.
I was doing a Union but in this way I can only create a single table with two different rows with duplicate common information and &quot;null&quot; as non present value.
How can I do if I want to obtain a table like this one?

|name|email|num_promoter|num_swaggy|
|---|---|---|---|
|Gianvito|gianvito@email.com|1475|1820|",1621286094,https://stackoverflow.com/q/67577103,Fabienne Lablatte,"['cypher', 'neo4j']"
67569373,Append default prefix for all collections in neo4j,"I&#39;m using community edition neo4j 4.2.4 in spring boot for implementing region specific collections of all the nodes and relation (max 5 nodes)in the same DB.

Is there a way to append a prefix for all the collections in neo4j, so that I can keep the collection specific to each region?
I can achieve this in 
``` DynamoDBMapperConfig.TableNameOverride.withTableNamePrefix(prefix + &quot;_&quot;); ```
in dynamoDb

Is there any equivalent of this or does it require a data model change to implement this in the community edition of neo4j?

Thanks!
",1621253308,https://stackoverflow.com/q/67569373,chandra mohan,"['spring-boot', 'neo4j']"
67561450,Error when running Zeppelin to connect Neo4j &amp; Spark,"I&#39;m trying to run : https://github.com/conker84/zep-neo4j-gc2k18

The 1st paragraph **Add Neo4j-Spark-Connector dependency:**

    %spark.dep
    z.reset()
    z.load(&quot;neo4j-contrib:neo4j-spark-connector:2.2.1-M5&quot;)

but an error occurred as follow:

    java.lang.NullPointerException
	at org.sonatype.aether.impl.internal.DefaultRepositorySystem.resolveDependencies(DefaultRepositorySystem.java:352)
	at org.apache.zeppelin.spark.dep.SparkDependencyContext.fetchArtifactWithDep(SparkDependencyContext.java:171)
	at org.apache.zeppelin.spark.dep.SparkDependencyContext.fetch(SparkDependencyContext.java:121)
	at org.apache.zeppelin.spark.DepInterpreter.interpret(DepInterpreter.java:247)
	at org.apache.zeppelin.interpreter.LazyOpenInterpreter.interpret(LazyOpenInterpreter.java:103)
	at org.apache.zeppelin.interpreter.remote.RemoteInterpreterServer$InterpretJob.jobRun(RemoteInterpreterServer.java:633)
	at org.apache.zeppelin.scheduler.Job.run(Job.java:188)
	at org.apache.zeppelin.scheduler.FIFOScheduler$1.run(FIFOScheduler.java:140)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)

What should I do to correct the error?

",1621198089,https://stackoverflow.com/q/67561450,Sama,"['apache-spark', 'neo4j', 'apache-zeppelin']"
67559393,Creating a Relationship between 2 nodes,"I&#39;m new to Neo4j, and still getting my feet wet. I have a question regarding creating a specific kind of relationship.

I have 2 files:

File 1 has text data, and an ID field. File 2 has 3 fields - one keyword field, which is a text/keyword extracted from the text data from the previous file, a ID called text ID which refers to and is the same as the text ID from the previous file, and an ID for the keyword itself.

I have 2 nodes created, the Text node which has the properties Text ID and text, and a Keyword node, which just has the property &quot;keyword&quot;. Is there anyway for me to create a relationship between these 2 nodes, where I would base of the text ID&#39;s in both files, and create a relationship which is k.keyword - [:IS_IN] - t.text?

This is what I tried to run so far, but I&#39;m not sure what to do further:

    LOAD CSV WITH HEADERS FROM &quot;file:///text.csv&quot; AS row1
    LOAD CSV WITH HEADERS FROM &quot;file:///keyword.csv&quot; AS row2
    MATCH(t:Text {text_id:row1.text_id}), (k:Keyword {keyword:row2.Keyword})
    //The part which I don&#39;t know what to do
    MERGE (k)-[:IS_IN]-&gt;(t)",1621184417,https://stackoverflow.com/q/67559393,Yati Rainpara,"['cypher', 'neo4j']"
67558448,Spring Data Neo4j implement relationship entity with @RelationshipProperties and @TargetNode,"I have the following legacy relationship entity which I&#39;d like to upgrade to the latest SDN with `@RelationshipProperties` and `@TargetNode`:

    @RelationshipEntity(type = &quot;HAS_VALUE_ON&quot;)
    public class RelationshipValue {
    
    	@Id
    	@GeneratedValue
    	private Long graphId;
    
    	@StartNode
    	private Decision decision;
    
    	@EndNode
    	private Characteristic characteristic;

Could you please show how to implement it with `@RelationshipProperties` and `@TargetNode` annotations ?

",1621178847,https://stackoverflow.com/q/67558448,alexanoid,"['spring-data-neo4j', 'neo4j']"
67555768,Spring Data Neo4j @Properties annotation,"I&#39;m trying to port my legacy code to the latest version of Spring Data Neo4j and unable to find the following annotation:

    @Properties (org.neo4j.ogm.annotation.Properties)


What should be used instead of this?",1621162481,https://stackoverflow.com/q/67555768,alexanoid,"['spring-data-neo4j', 'neo4j', 'neo4j-ogm']"
67540834,Running allShortestPaths on a subset of a graph projection,"I am using ```gds.alpha.allShortestPaths.stream()``` on a graph projection.

I want to run the algorithm on a subset of nodes that have a certain value for a property, but
the docs say that the allShortestPaths algorithm only accepts a graph projection as input. I don&#39;t think running the algorithm on the entire graph projection would be possible because it consists of ~15 million nodes.

I would love something like this where I can by-pass the graph projection part completely:

```match (hgnc:Code {SAB:&quot;HGNC&quot;}) 
   CALL algo.shortestPath.stream(hgnc) 
   YIELD sourceNodeId, targetNodeId, distance WITH sourceNodeId, targetNodeId, distance 
   WHERE gds.util.isFinite(distance) = true 
   WITH source, target, distance 
   WHERE source &lt;&gt; target 
   RETURN source.name AS source, target.name AS target, distance```

But with the All Pairs Shortest Path algorithm obviously.",1621025745,https://stackoverflow.com/q/67540834,ben stear,"['graph-data-science', 'shortest-path', 'cypher', 'neo4j']"
67536261,neo4j client is unauthorized due to authentication failure,"Running Windows 10 Pro. I have been running neo4j 3.5.14 Community because it will run on JRE/JDK 8.  I would like to upgrade to neo4j 4.x, but it needs JDK 11 which does not have JRE.  I am clueless what those words mean, just parroting what I read.  I installed JDK11 anyway, downloaded neo4j 4.2.6 and tried to start it.  It gives this response:

C:\neo4j\neo4j-community-4.2.6\bin&gt;neo4j console
2021-05-14 14:12:23.440+0000 INFO  Starting...

2021-05-14 14:12:25.808+0000 INFO  ======== Neo4j 4.2.6 ========

2021-05-14 14:12:26.936+0000 INFO  Performing postInitialization step for component &#39;security-users&#39; with version 2 and status CURRENT

2021-05-14 14:12:26.936+0000 INFO  Updating the initial password in component &#39;security-users&#39;

2021-05-14 14:12:27.909+0000 INFO  Bolt enabled on localhost:7687.

2021-05-14 14:12:28.637+0000 INFO  Remote interface available at http://localhost:7474/

2021-05-14 14:12:28.638+0000 INFO  Started.

2021-05-14 14:12:32.067+0000 WARN  The client is unauthorized due to authentication failure.

I then open a browser

http://localhost:7474/browser/

And it shows a screen with &quot;Connect to Neo4j&quot; with

Connect URL: bolt://localhost:7687

Username neo4j

Password

I tried my existing password, which doesn&#39;t work.  I tried the default neo4j as password, and it brings up the &quot;New password&quot; screen.  I enter my password, and it gives this error:

Neo.ClientError.Security.CredentialsExpired: Permission denied. The credentials you provided were valid, but must be changed before you can use this instance. If this is the first time you are using Neo4j, this is to ensure you are not using the default credentials in production. If you are not using default credentials, you are getting this message because an administrator requires a password change. Changing your password is easy to do via the Neo4j Browser. If you are connecting via a shell or programmatically via a driver, just issue a `ALTER CURRENT USER SET PASSWORD FROM &#39;current password&#39; TO &#39;new password&#39;` 

I stopped the server, restarted as neo4j-community-3.5.14 and it runs.  Stopped that, started 4.2.6, same roadblock.  I cannot get past the &quot;New password&quot; screen.  I have no clue whether this is something to do with JRE, or some other way that I&#39;m completely clueless trying to navigate the cryptic docs.",1621003510,https://stackoverflow.com/q/67536261,e25548,"['java', 'upgrade', 'neo4j', 'authentication']"
67535012,Problem with StackOverflow2013 database to Neo4j database migration,"I&#39;m trying to migrate StackOverflow2013 database to Neo4j (4.2.3) database. I downloaded and attached medium size StackOverflow2013 database (50BG) from: https://www.brentozar.com/archive/2015/10/how-to-download-the-stack-overflow-database-via-bittorrent/ and attached this db to Sql Server 2019. Then I used export data tool from Sql Server Management Studio and got CSV files in UTF-8 encoding. Then I imported these CSV files using neo4j-admin import tool. 

But when I started querying the data I found that some nodes missing properties. Most of problems are with Post nodes. Then I get only one Post node and imported it to separate database to repeat the problem.

Here is a header CSV file:

&gt; Id:ID(Post-ID),AcceptedAnswerId:int,AnswerCount:int,Body:string,ClosedDate:datetime,CommentCount:int,CommunityOwnedDate:datetime,CreationDate:datetime,FavoriteCount:int,LastActivityDate:datetime,LastEditDate:datetime,LastEditorDisplayName,LastEditorUserId:int,OwnerUserId:int,ParentId:int,PostTypeId:int,Score:int,Tags,Title,ViewCount:int

Here is Post CSV file:

&gt; &quot;19153640&quot;,&quot;19153834&quot;,&quot;2&quot;,&quot;pI want to replace Vertical Bar (|) with
&gt; Devanagari Danda (?) as soon as it is typed in textarea using
&gt; javascript.ppFirst I tried the solution given on a href=
&gt; https:stackoverflow.comquestions218219how-to-change-characters-typed-in-firefox
&gt; How to change characters typed in Firefoxa. But it adds the character
&gt; to the end only.ppSo, I followed the solution given on a
&gt; &quot;,&quot;1900-01-01T00:00:00.000&quot;,&quot;2&quot;,&quot;1900-01-01T00:00:00.000&quot;,&quot;2013-10-03T07:48:10.540&quot;,&quot;0&quot;,&quot;2013-10-03T09:13:54.660&quot;,&quot;2013-10-03T09:13:54.660&quot;,&quot;&quot;,&quot;402253&quot;,&quot;402253&quot;,&quot;19152949&quot;,&quot;2&quot;,&quot;2&quot;,&quot;&quot;,&quot;&quot;,&quot;0&quot;

Here is import command:

&gt; neo4j-admin import --verbose --cache-on-heap=true --high-io=true
&gt; --database=test1 --delimiter=, --max-memory=15G --processors=12 --multiline-fields=true --skip-bad-entries-logging=false --skip-bad-relationships=true --id-type=INTEGER --input-encoding=UTF-8 --normalize-types=false --skip-duplicate-nodes=true --read-buffer-size=100m --ignore-empty-strings=true --nodes=Post=&quot;import/Posts_Header.csv,import/Posts2.csv&quot;

In result only AcceptedAnswerId and AnswerCount properties were imported:

[![enter image description here][1]][1]

Tried to remove text from Body field, then all properties are imported. Cannot explain why this text cannot be imported, it is valid CSV file. 

  [1]: https://i.stack.imgur.com/AILCq.jpg",1620998267,https://stackoverflow.com/q/67535012,nikolai.serdiuk,"['neo4j', 'database-migration', 'csv']"
67531870,Randomize relationships between nodes,"I have around 15k nodes with properties in CSV and loaded into Neo4j. I want to generate random relationships between them, and I found 2 libraries (Neo4j Graph Data Science Library and APOC). They generate random  nodes with random properties and relationships, but can they generate random relationships using my existing nodes?",1620983713,https://stackoverflow.com/q/67531870,Pongo96,['neo4j']
67531503,Neo4j Cypher query of the Datamodel,"I am searching for a cypher query that returns me the current data-model, meaning every node plus relationship, but only once.

I did find the query already in the past via stackoverflow.com or google, but I did not find it now again making a research.

Thank you",1620981945,https://stackoverflow.com/q/67531503,Peter,"['cypher', 'neo4j']"
67530710,How to set a property if not exists array in neo4j,"i want to add properties in array if a value not in the array. 

    // Create a node with an array prop
    CREATE (n:Test { my_array:[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]}) RETURN n;

Here i would like check my_array values and add &#39;new_value&#39; like &#39;d&#39; which is not in the list. 
Please help to add this attribute. ",1620978061,https://stackoverflow.com/q/67530710,Mani Muthu. K,['neo4j']
67529460,AND clause for matching 3 conditions in NEO4j,"my query is :

```
MATCH (n:TemplateForm)-[r:DEFINED_BY]-(m:ProjectForm)-[s:CONNECTED]-(b:ProjectPage)-[p:CONNECTED]-(d:ProjectField) 
WHERE Id(n) = 907318 
  AND b.name = &quot;REPORT PHOTOS - COVER AND APPENDICES&quot; 
  AND NOT (d.type IN ([&#39;imageArray&#39;,&#39;image&#39;,&#39;barSeparator&#39;,&#39;map&#39;])) 
  AND (d.name) IN([&quot;Photo 5 Description:&quot;]) 
  AND (d.value) IN ([&quot;penthouse roof&quot;]) 
RETURN d
```

i have 3 fields- Photo 6 Description:&quot;, &quot;Photo 7 Description:&quot; ,&quot;Photo 5 Description: in d.name
i give 3 values to them in d.value  - penthouse roof&quot; ,&quot;House&quot; ,&quot;farmhouse&quot; 
now i get result as - wherever the values get matched i get all rows. if in Photo 7 Description i have penthouse still i get it as result what i want is if only in Photo 6 Description i have penthouse ,in Photo 7 Description i have house and in Photo 5 Description i have farmhouse then only this should get satisfied",1620970161,https://stackoverflow.com/q/67529460,yet_to_develop,['neo4j']
67529190,Disconnect / replace subgraph edges with Cypher,"I have a graph data model in which all nodes are connected to one or more :policy nodes.

At times I need to modify a sub-graph so that it replaces all relationships to an existing P:policy with relationships to a new P&#39;:policy. The general approach I have in mind is to identify a subset of vertexes V and edges E associated with the existing P:policy; create a new P&#39;:policy, create new relationships E&#39; between V and P&#39;, and then delete existing relationships E.

I have a variable length query that identifies the relevant P, V and E; that query looks something like this:

```
MATCH p=(v {..})-[nodes*]-&gt;(policy:policy {..}) return policy as P, nodes(p) as V, relationships(p) as E
```

This works fine as a standalone query, but to complete the sub-graph update what I&#39;d like to do is something like this:

```
MATCH p=(v {..})-[nodes*]-&gt;(policy:policy {..}) // find the sub-graph of interest
MERGE (P&#39;:policy {..})-[]-(..)					// create new policy P&#39;
MERGE nodes(p)-[..]-(P&#39;)						// setup new relationships from nodes(p) to new policy P&#39;
DELETE relationships(p)							// delete existing relationships(p)
```

I am a relative Cypher noob and it appears that I can&#39;t use nodes(p) and relationships(p) in my queries; wondering if anyone can provide advice how to achieve this goal? ",1620967691,https://stackoverflow.com/q/67529190,Greg,"['neo4j', 'cypher']"
67527187,How to use MERGE in an apoc.cypher.mapParallel fragment in Neo4j?,"Target:
-------
Creating a relationship using `MERGE` within an `apoc.cypher.mapParallel` fragment.


Environment:
------------
- Neo 4.2.6, Enterprise Edition.
- Spring Boot v2.4.2



Initial situation:
------------------

    CALL apoc.cypher.mapParallel(&quot;
        MATCH [...]
        MERGE (nodeA)-[:RELATED]-&gt;(nodeB)
    &quot;, {parameter: $parameter}, nodeCollection) YIELD value AS result

Using `MERGE` within an `apoc.cypher.mapParallel` fragment produces the following exception:
`org.neo4j.driver.exceptions.ClientException: Create relationship with type &#39;RELATED&#39; is not allowed for user &#39;neo4j&#39; with roles [PUBLIC, admin] overridden by READ.`


Discussion:
-----------
Based on the error message, I suspect that the fragment is running in READ mode, which would conflict with my use of `MERGE`.
If I now execute the Cypher statement `CALL dbms.procedures() YIELD name, mode RETURN name, mode;` I get the following feedback:

    [...]
    &quot;apoc.cypher.dolt&quot;          &quot;WRITE&quot;
    &quot;apoc.cypher.mapParallel&quot;   &quot;DEFAULT&quot;
    &quot;apoc.cypher.mapParallel2&quot;  &quot;DEFAULT&quot;
    [...]

- What does &quot;Default&quot; mode mean in my context? 
- Does this allow write access?


To be solved problem:
---------------------
How can I change the mode for `apoc.cypher.mapParallel` to WRITE so that I can use `MERGE` in an `apoc.cypher.mapParallel` fragment?


Conditional Workaround:
-----------
Continue to use the complex `MATCH` statement in the `apoc.cypher.mapParallel` fragment and pass out the determined `nodeA` and `nodeB` and create the relationship in a `mapParallel` downstream `apoc.periodic.iterate` fragment.
Due to the `COLLECTs` that then become necessary, I create several additional `EagerAggregations`, which increases the runtime of the query to several hours due to several million relationships to be processed. A NoGo from business side.
",1620946853,https://stackoverflow.com/q/67527187,ThirstForKnowledge,"['cypher', 'neo4j', 'neo4j-apoc']"
67526375,How to make a simple Neo4J graph from a single CSV.file,"I am trying to learn Neo4J and have completed a couple of tutorials. It works okay when I want to merge data from different .csv files. However in my problem I only have a single .csv file:

    Employee, Leader
    E1, L1
    E2, L1
    E4, L2
    L1, L3

I want to get a graph like:
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/BoOTI.png



Where I get the whole structure of the whole employee-leader relationship
I know how to import a file:

    LOAD CSV WITH HEADERS FROM &#39;file:///org.csv&#39; AS row
    FIELDTERMINATOR &#39;;&#39;
    RETURN row

and I guess i need something like 

    MATCH row.Employee-&gt;row.Leader



",1620940704,https://stackoverflow.com/q/67526375,smallbirds,"['neo4j', 'cypher']"
67525954,Can duplicate relationship creation will avoided in KNN?,"For this tutorial:

https://neo4j.com/docs/graph-data-science/current/algorithms/knn/

It generates this output in the example:
[![enter image description here][1]][1]


Can the SIMILARITY relationship be created through some similarity threshold? . Also, if I increase K from 1 to 3, I got this graph:
[![enter image description here][2]][2]
  
Why are Eve and Bob duplicately linked one way, making a total of 4 links? 

  [1]: https://i.stack.imgur.com/1RcML.png
  [2]: https://i.stack.imgur.com/IcaCv.png",1620938393,https://stackoverflow.com/q/67525954,marlon,['neo4j']
67516267,A method to detect non-repetition relation when neo4j is inserted?,"My steps:



1. Read CSV to create node A



2. Make relational mapping with node B in Neo4j library



3. Read new CSV to add node A



4. Do relational mapping with node B in the library


So there&#39;s a new relationship repetition problem, how can we detect if it&#39;s repeated, and if it&#39;s repeated then we don&#39;t associate it

[enter image description here][1]



  [1]: https://i.stack.imgur.com/FQ0Mg.png

My version is neo4j 3",1620894915,https://stackoverflow.com/q/67516267,ao shi,['neo4j']
67512601,Importing a CSV file to neo4j with a column that has csv values,"I have a CSV file that contains a userid, an email, names and finally a contacted field.

The contacted field shows other users that the user has contacted, but in the case of multiple users it contains a list where each user that has been contacted is seperated by a &#39;,&#39;.

For instance, I have the entry : \
1,noaddress@fake.com,fakename,&quot;4,5,6,7&quot; \
which means user with userid 1 contacted users with id 4, 5, 6 and 7.

How can I import this to neo4j while creating a &#39;contacted&#39; relationship between 1 and 4,5,6,7 ?

I have very little experience with neo4j and cypher, and have thus been struggling with this quite a bit and am not finding the documentation particularly helpful.

Any help is appreciated.",1620866518,https://stackoverflow.com/q/67512601,everythingwastaken,"['csv', 'import', 'neo4j', 'cypher']"
67508612,Does the graph embedding algorithms works for other languages than English?,"In my graph, both the relationship names and property names are in Chinese. Does this affect the quality of the embedding models when using the models? I am wondering how those relationships and properties are transformed into features. The below is one example of node property:

    {
      &quot;_出生地&quot;: &quot;日本兵库县&quot;,
      &quot;_国籍&quot;: &quot;日本&quot;,
      &quot;_义项&quot;: &quot;1&quot;,
      &quot;_节点ID&quot;: &quot;55bac8328e7b30ec288ae7cd2c958070&quot;,
      &quot;_中文名&quot;: &quot;明神智和&quot;,
      &quot;_生日&quot;: &quot;1978-1-24&quot;,
      &quot;_入库日期&quot;: &quot;2020-04-17&quot;,
      &quot;_名称&quot;: &quot;MJ&quot;,
      &quot;_运动项目&quot;: &quot;足球&quot;,
      &quot;_重要事件&quot;: &quot;代表日本队参加2002世界杯&quot;,
      &quot;_体重&quot;: &quot;66公斤&quot;,
      &quot;_频道&quot;: &quot;体育&quot;,
      &quot;_运动队&quot;: &quot;长野伙伴足球俱乐部（17）&quot;,
      &quot;_外文名&quot;: &quot;Tomokazu Myojin&quot;,
      &quot;_身高&quot;: &quot;173厘米&quot;,
      &quot;_类型&quot;: &quot;运动员&quot;
    }",1620841407,https://stackoverflow.com/q/67508612,marlon,['neo4j']
67507893,Is it possible to see training log on console screen when using embedding algorithms?,"It would be helpful to see whether the loss is decreasing in training iterations, just as running the regular ML algorithms. Is this possible to output losses when using the graph embedding algorithms? I am using the neo4j-graph-data-science-1.5.1.jar.

    # Project the graph
    def project_graph():
        with driver.session() as session:
            session.run(&quot;&quot;&quot;CALL gds.graph.create(
                          &#39;sports&#39;, &#39;*&#39;, {relations:{type:&#39;*&#39;, orientation:&#39;UNDIRECTED&#39;}}
                          )&quot;&quot;&quot;)
    
    # Embedding the graph
    def embedding_fastrp():
        print(&#39;Start embedding ...&#39;)
        with driver.session() as session:
            result = session.run(&quot;&quot;&quot;
            CALL gds.fastRP.stream(
               &#39;sports&#39;,
               { embeddingDimension: 128 }
            )
            &quot;&quot;&quot;)
    
            embeddings_df = pd.DataFrame([dict(record) for record in result])
            print(&#39;Embedding size: {}&#39;.format(len(embeddings_df.index)))
            df_head = embeddings_df.head()
            print(&#39;Embedding head: {}&#39;.format(df_head))

For the code example, is there a flag that can turn on training logs? ",1620838253,https://stackoverflow.com/q/67507893,marlon,['neo4j']
67507411,Facing IndexEntryConflictException while merging,"we are facing the `IndexEntryConflictException` error while executing the merge statement, however, it happens intermittently. can anyone please help resolve this?

Neo4j version - 4.0

    { timestamp: &quot;2021-01-06T10:00:18.567Z&quot;,level: &quot;error&quot;, message: &quot;merge statement Neo4jError: Caused by: IndexEntryConflictException{propertyValues=( String(&quot;8781237720003455611&quot;) ), addedNodeId=-1, existingNodeId=59898}&quot; }",1620836398,https://stackoverflow.com/q/67507411,Chaitan,['neo4j']
67505561,Neo4j - Flight Analyzer - 2 issues,"I&#39;m working in neo4j with the Flight Analyzer database (https://neo4j.com/graphgist/flight-analyzer).

Nodes:

 - Airport (SEA:Airport { name:&#39;SEA&#39; })
 - Flight (f0:Flight { date:&#39;11/30/2015 04:24:12&#39;, duration:218, distance:1721, airline:&#39;19977&#39; })
 - Ticket (t1f0:Ticket { class:&#39;economy&#39;, price:1344.75 })

Relationships:

 - Destination (f0)-[:DESTINATION]-&gt;(ORD)
 - Origin (f0)-[:ORIGIN]-&gt;(SEA)
 - Assign (t1f0)-[:ASSIGN]-&gt;(f0)


I need to:

 1. Order the airlines according to the number of cities between which they offer connections (unique cities participating in the relationship: ORIGIN and: DESTINATION of Flight nodes served by a given airline)

 2. Find the cheapest business class connection from Los Angeles (LAX) to Dayton (DAY).
I managed to find the cheapest connection, adding business class is an issue:
  
```
    MATCH p1 = (origin:Airport { name:&quot;LAX&quot; })&lt;-[r:ORIGIN|DESTINATION*..6]-&gt;(destination:Airport  { name:&quot;DAY&quot; })
    RETURN p1,
    REDUCE(s = 0, n IN [x IN NODES(p1) WHERE &#39;Flight&#39; IN LABELS(x)] |
      s + [(n)&lt;-[:ASSIGN]-(ticket) | ticket.price][0]
      ) as total
    ORDER BY total
    LIMIT 1
```


Thank you for your help! :)",1620829424,https://stackoverflow.com/q/67505561,Olsha_3289,"['cypher', 'neo4j']"
67500323,Loading 22 Mil + records into neo4j database via databricks environment,"I am using neo4j spark connector and via databricks environment  - I have loaded 22 Mil records into neo4j  database and While establishing relationships for this 22mil records with the query

```
CALL apoc.periodic.iterate(&#39;Match (jh:JournalHeader) return jh&#39;, 
  &#39;with jh MATCH (jli:JournalLineItem) where jli.glheader_id = jh.glheader_id  MERGE (jh)-[:HAS_PARENT]-&gt;(jli)&#39;, 
  {batchSize:1000, parallel:false}) 
yield batch return null;&quot;)
```

Though the required relationships got established in neo4j database. The spark job is hanging and no updates are being written. 

Is there a way to make the query more efficient so once the relationships got established it will finish the job. Because in this case though the relationships got established still the query is searching for all the other records which is not necessary in this case",1620809672,https://stackoverflow.com/q/67500323,Karuna,"['neo4j-apoc', 'apache-spark', 'azure-databricks', 'neo4j', 'databricks']"
67497553,Is the neo4j documentation inconsistent regarding embedding parameter?,"In this tutorial, it has the following example:
https://neo4j.com/developer/graph-data-science/applied-graph-embeddings/
where &#39;embeddingSize&#39; is used for specify the vector length of the embedding. 

    CALL gds.alpha.node2vec.stream({
      nodeProjection: &quot;Place&quot;,
      relationshipProjection: {
        eroad: {
          type: &quot;EROAD&quot;,
          orientation: &quot;UNDIRECTED&quot;
        }
      },
      embeddingSize: 10,
      iterations: 10,
      walkLength: 10
    })
    YIELD nodeId, embedding
    RETURN gds.util.asNode(nodeId).name AS place, embedding
    LIMIT 5;

However, in the signature of the node2vec documentation, it use &#39;embeddingDimension&#39;, instead of &#39;embeddingSize&#39;. Are the same thing? Or Either the documentation of the tutorial is outdated? See below for &#39;embeddingDimension&#39;:
https://neo4j.com/docs/graph-data-science/current/algorithms/node2vec/#alpha-algorithms-embeddings-node2vec
",1620795464,https://stackoverflow.com/q/67497553,marlon,['neo4j']
67493235,"Neo4j streams, fabric integration not working. Log reports &quot;The `USE GRAPH` clause is not available in this implementation of Cypher&quot;","integrating my streams topics into fabric functionality is not working. 
Attempting to sink my first topic into a named graph produced the message below.      
I did follow the instructions provided by links to no avail.

Am I missing someting?

**The Neo4j log Error:**

ErrorData(originalTopic=twoPoly, timestamp=1620757269838, partition=0, offset=1481, exception=org.neo4j.graphdb.QueryExecutionException: The `USE GRAPH` clause is not available in this implementation of Cypher due to lack of support for USE graph selector. (line 1, column 29 (offset: 28))
&quot;UNWIND $events AS event use integerpolys MERGE (i:IndexedBy {N:event.NN,RowCounter:event.flatFileRowCounterr,MaxN:event.nMaxx,Dimension:&quot;2&quot;} ) MERGE (t:TwoSeqFactor {twoSeq:event.tSeqDB} ) MERGE (v:VertexNode {Vertex:event.vertexDBVertex,Scalar:event.vertexScalarDB,Degree:event.vertexDegreeDB} ) MERGE (e:Evaluate {Value:event.targetEvaluate}) MERGE  (i)-[ee:TwoFactor]-&gt;(t) MERGE (i) -[:IndexedByEvaluate]-&gt;(e) MERGE  (i)-[:VertexIndexedBy]-&gt;(v)&quot;
                             ^, key=null, value={&quot;NN&quot;:&quot;7&quot;,&quot;nMaxx&quot;:&quot;8&quot;,&quot;vertexDBVertex&quot;:&quot;1 -8 1 0 0&quot;,&quot;bTermDB&quot;:&quot;1&quot;,&quot;flatFileRowCounterr&quot;:&quot;6&quot;,&quot;targetEvaluate&quot;:&quot;128&quot;,&quot;vertexDB&quot;:&quot;1 -8 1 0 0&quot;,&quot;vertexScalarDB&quot;:&quot;-8&quot;,&quot;tSeqDB&quot;:&quot;32&quot;,&quot;vertexDegreeDB&quot;:&quot;1&quot;}, executingClass=class streams.kafka.KafkaAutoCommitEventConsumer)

**Neo4j version** 4.1.0

**Relevant neo4j.conf**:

    fabric.database.name=differences

    streams.source.enabled=false

    kafka.max.poll.records=1000

    kafka.zookeeper.connect=localhost:2181

    kafka.bootstrap.servers=localhost:9092

    streams.procedures.enabled=&lt;true/false, default=true&gt;

    streams.sink.enabled=true

    streams.sink.topic.cypher.twoPoly=use integerpolys \
    MERGE (i:IndexedBy {N:event.NN,RowCounter:event.RowCounterr,MaxN:event.nMaxx,Dimension:&quot;2&quot;} ) \
    MERGE (t:TwoSeqFactor {twoSeq:event.tSeqDB} ) \
    MERGE (v:VertexNode        {Vertex:event.vertexDBVertex,Scalar:event.vertexScalarDB,Degree:event.vertexDegreeDB} ) \
    MERGE (e:Evaluate {Value:event.targetEvaluate}) \
    MERGE  (i)-[ee:TwoFactor]-&gt;(t) \
    MERGE (i) -[:IndexedByEvaluate]-&gt;(e) \
    MERGE  (i)-[:VertexIndexedBy]-&gt;(v)


**Available databases**
Databases available for the current user.
Click on one to start using it:

:use createbymu

:use differencegraph

:use fabric

:use integerpolys

:use neo4j

:use skipmu

:use system





Reference solution:

[https://github.com/neo4j/neo4j/issues/12395][1]

[https://neo4j.com/docs/operations-manual/current/fabric/configuration/][2]


  [1]: https://github.com/neo4j/neo4j/issues/12395
  [2]: https://neo4j.com/docs/operations-manual/current/fabric/configuration/",1620761498,https://stackoverflow.com/q/67493235,Thomas Pries,['neo4j']
67491791,How do I stop/configure Neovis Physics,"I am using NeoVis from JavaScript to render my Neo4j graph, and I want to be able disable and/or configure the physics of the render. Ideally I would like to be able to keep the render from moving beyond how I drag the nodes/edges. How do I do this? 

thank you!",1620754743,https://stackoverflow.com/q/67491791,NSA,"['neo4j', 'javascript']"
67491531,Neo4J - wait on ToListAsync() still not giving enough time for result stream,"so keeping it short i&#39;m querying a neo4j db and then returning the Task ToListAsync of my results

    Task&lt;List&lt;IRecord&gt;&gt; userBlock = chainUtils.CreateUser(user);
    userBlock.Wait();
    if (userBlock.Result == null) Console.WriteLine(&quot;Something Went Wrong.&quot;);
    else DisplayRecord(userBlock.Result[0]);
However the wait almost never seems long enough for the stream, and i get an index out of bounds on my results. If i put a break point in or im just lucky then it returns the results fine. Any ideas on how to fix this or what the problem is would be great, thanks in advance.",1620753564,https://stackoverflow.com/q/67491531,samuel taylor,"['c#', 'neo4j']"
67484470,Neo4J - Neogma - TypeError: Cannot read property &#39;queryRunner&#39; of undefined,"Good morning, 

I am using neogma to simplify the use of Neo4J. When I separate, the DB connection initialization, the models and API controllers in separate files, it throws the following error:

    &quot;TypeError: Cannot read property &#39;queryRunner&#39; of undefined&quot;
    at Object.ModelFactory (/Users/name/Desktop/greenform-backend/node_modules/neogma/src/ModelOps/ModelOps.ts:382:32)
    at Object.&lt;anonymous&gt; (/Users/name/Desktop/greenform-backend/src/database/models/Movies.ts:17:23)
    at Module._compile (internal/modules/cjs/loader.js:1251:30)
    at Module.m._compile (/Users/name/Desktop/greenform-backend/node_modules/ts-node/src/index.ts:1056:23)
    at Module._extensions..js (internal/modules/cjs/loader.js:1272:10)
    at Object.require.extensions.&lt;computed&gt; [as .ts] (/Users/name/Desktop/greenform-backend/node_modules/ts-node/src/index.ts:1059:12)
    at Module.load (internal/modules/cjs/loader.js:1100:32)
    at Function.Module._load (internal/modules/cjs/loader.js:962:14)
    at Module.require (internal/modules/cjs/loader.js:1140:19)
    at require (internal/modules/cjs/helpers.js:75:18)


 The DB connection is set in the server.ts file: 

    export const neogma = new Neogma(
    {
        url: db.db_url,
        username: db.db_user,
        password: db.db_pw,
    },
    {
        logger: console.log,
        encrypted: false,
    },
);


The model schema is set in a separate file: 

    export const Movies = ModelFactory&lt;MoviesPropertiesI, MoviesRelatedNodesI&gt;(
    {
        label: &#39;Movie&#39;,
        primaryKeyField: &#39;name&#39;,
        schema: {
            name: {
                type: &#39;string&#39;,
                minLength: 1,
                required: true,
            },
            year: {
                type: &#39;number&#39;,
                minimum: 1900,
                required: true,
            },
        },
    },
    neogma,);
    

And the controller is in a separate file: 

    import express from &#39;express&#39;;
    import { Users, UsersPropertiesI } from &#39;../../database/models/Users&#39;;

    const router = express.Router();

    const populateData = async (): Promise&lt;void&gt; =&gt; {
    const user = await Users.build({
        name: &#39;Barry&#39;,
        age: 36,
    });

    console.log(user.name);

    await user.save({
        validate: true,
        session: null,
    });
    };

    router.post(&#39;/db&#39;, (req, res) =&gt; populateData()
    .then(() =&gt; {
        res.json({ message: &quot;success&quot; })
    })
    .catch(
        (err)=&gt; console.log(err))
    )

    export default router;


When put the controller and the DB init in one file it works perfectly fine. But in separate files an error is thrown. 

Do you know how to fix that issue? ",1620727098,https://stackoverflow.com/q/67484470,user10581981,"['neo4j', 'node.js']"
67480332,Which hashing algorithm is used by Neo4J?,"I would like to know which is the hashing algorithm used by Neo4j. In particular, Neo4j Enterprise 4.1.6.

When creating a new user, for example with the command `CREATE USER jack SET PASSWORD &#39;pass&#39;`, Neo4j will hash and store the password in the `system` database. But what hashing algorithm does it use?

I cannot find it in the official documentation so I looked it up on GitHub. [Here][1] is when the password is hashed and [this][2] is the class `SecureHasher` used for it. I also see SHA-256 in [this][3] class but there are two versions. Is it mentioned in the documentation or other documents?


  [1]: https://github.com/neo4j/neo4j/blob/e89ade8beeb5f491c218c67a0d2cfcb1c5a5c2b6/community/cypher/cypher/src/main/java/org/neo4j/cypher/internal/security/SystemGraphCredential.java#L90
  [2]: https://github.com/neo4j/neo4j/blob/e89ade8beeb5f491c218c67a0d2cfcb1c5a5c2b6/community/cypher/cypher/src/main/java/org/neo4j/cypher/internal/security/SecureHasher.java
  [3]: https://github.com/neo4j/neo4j/blob/e89ade8beeb5f491c218c67a0d2cfcb1c5a5c2b6/community/cypher/cypher/src/main/java/org/neo4j/cypher/internal/security/SecureHasherConfigurations.java#L31",1620705091,https://stackoverflow.com/q/67480332,Marc,"['cypher', 'neo4j', 'java']"
67477156,Neo4j data loading performance: driver vs custom procedure,"I&#39;m switching from Neo4j Java custom procedures to an approach based on the Neo4j Java driver. I want to end up with some sort of microservice running my graph algorithm, instead of calling the custom procedure through Cypher. I implemented the traversal using a bunch of standard HashMaps: Once the data is loaded from Neo4j to these HashMaps, the graph traversal is much faster than in my original custom procedure, so that&#39;s very promising. 

Now to my question: Within the custom procedure I was able to load the graph (40 mio edges, 10 mio nodes) to the Hashmaps like so:
``` java
@Context
public GraphDatabaseService db;
...

HashMap&lt;Long, Long&gt; mapNodeIdProperty = new HashMap&lt;&gt;();
db.beginTx().getAllNodes().stream().forEach((org.neo4j.graphdb.Node n) 
              -&gt; mapNodeIdProperty.put(n.getId(),
                     (Long) n.getProperty(&quot;combProp&quot;)));

```
This takes about a minute, which I consider acceptable as the service&#39;s start-up time.

Now, the best solution I could find using the driver goes something like this:

``` java
driver = GraphDatabase.driver( uri, AuthTokens.basic( user, password ) );

...

try ( Session session = driver.session() )
{
    String status = session.writeTransaction( new TransactionWork&lt;String&gt;()
    {
        @Override
        public String execute( Transaction tx )
        {
            Stream&lt;Record&gt; resultStream = (Stream&lt;Record&gt;) tx.run(
                           &quot;MATCH (n) RETURN n&quot;).stream();
            resultStream.forEach((Record n) -&gt; listNodes.add(((Record) n).get(&quot;n&quot;).asNode()));
            return &quot;ok; length=&quot; + listNodes.size();
        }
    });
    System.out.println( status);
}
```

This takes too much time, even if I limit the number of returned nodes to just a few thousand using the cypher query. I never waited for the full graph to load.

What would be my best bet for getting the same speed using the driver (or alternative approaches ) as compared the stored procedure? Are there fundamental limitations which would inhibit this?


",1620677851,https://stackoverflow.com/q/67477156,mcsoini,"['performance', 'neo4j', 'java']"
67475628,How can I add another MATCH condition if CASE is such and such in Cypher,"I have a query and I want to add another MATCH condition to it if an attribute is certain value.

Something like this: **CASE WHEN type.character = &#39;Odborn&#253;&#39; THEN MATCH (teachingSubject)&lt;-[]-(achievedField) ELSE TRUE**

Full query is here:
```MATCH (teachingLevel:SchoolLevel {name: &quot;SŠ&quot;})&lt;-[:QUALIFIES_FOR]-(qualification:Qualification)
MATCH (teachingSubject:Subject {code: &quot;M&quot;})-[:IS_PART_OF]-&gt;(teachingSubjectGroup:SubjectGroup)&lt;-[:QUALIFIES_FOR]-(qualification)
MATCH (achievedTitle:EducationTitle {name: &quot;Mgr.&quot;})&lt;-[:DEFINED_BY]-(type:EducationType)
MATCH (achievedField:CollegeArea {name: &quot;Stavebnictv&#237;&quot;})&lt;-[:DEFINED_BY]-(type)
CASE WHEN type.character = &#39;Odborn&#253;&#39; THEN MATCH (teachingSubject)&lt;-[]-(achievedField) ELSE TRUE
MATCH (toStudy:EducationType)&lt;-[:COMBINES]-(qualification)-[:COMBINES]-&gt;(type) WHERE toStudy &lt;&gt; type
RETURN toStudy```

How can I do this legally?",1620670443,https://stackoverflow.com/q/67475628,Jakub Bares,"['cypher', 'conditional-statements', 'neo4j', 'case']"
67472663,Variable relationship properties in Neo4j,"I am constructing a graph in Neo4j like this. First, I create the nodes with an array property. Then I check if any two nodes have common elements between the arrays (using ```apoc``` intersection call) and if so I create a relationship between the nodes.

For example, lets say, nodes ```N``` and ```M``` has arrays ```S = [A, B, C]``` and ```T = [A, B, D]``` as properties, respectively, then ```N``` and ```M``` will have a relationship ```r``` between them, since they share the common elements ```A, B```.

Now, each of the array elements also has properties associated with them and I want to populate the edge with common elements together with their properties. That is, we have ```A.name, A.age, B.name, B.age``` associated with them. Note that ```A``` and ```B``` are variables themselves. That is, ```A``` could be ```Doctor X``` and ```B``` could be ```Doctor Y```. 

How do I annotate the edges with the variable name and their properties so that I can query the database using the variable name? I somehow need to preserve the association between elements and their properties within the edges as edge properties. 

How do I do this? Thank you very much.",1620658252,https://stackoverflow.com/q/67472663,user2167741,"['neo4j', 'json']"
67469310,Replace a Relationship-Node-&gt;Relationship construct with one Realtionship containing the label of the replaced node,"I have a graph where if have the following constructs:

    (a)-[b:Input]-&gt;(c:Data)-[e:Output]-&gt;(f)

i want to replace b,c,e with a relationship with the label from c:

    (a)-[n:Data]-&gt;(f)

The label should be generated automatically. I have multiple labels for c like: Data, AMC, Door, New_HS etc.. 
So the label of the new created relationship should be created like this: 

    [n:title = c.Label]

",1620644647,https://stackoverflow.com/q/67469310,Felix D,"['cypher', 'neo4j', 'graph-databases']"
67468253,java.lang.NoClassDefFoundError: org/apache/spark/sql/sources/v2/ReadSupport - error while reading data from datalake to spark,"I have created a new databricks cluster with the following libraries installed.
Cluster version - 7.6 (includes Apache Spark 3.0.1, Scala 2.12)

spark_cdm_connector_0_19_1.jar , 
neo4j_connector_apache_spark_2_12_4_0_1_for_spark_3.jar , 
com.microsoft.azure:spark-cdm-connector:0.19.1 - maven file , 
neo4j-contrib:neo4j-connector-apache-spark_2.12:4.0.1_for_spark_3 - maven file , 

But while loaing CDM data from datalake to databricks I&#39;m facing the subjected error
java.lang.NoClassDefFoundError: org/apache/spark/sql/sources/v2/ReadSupport

Should I need to change the configuration of databricks cluster or update the configuration file?
Thanks",1620640073,https://stackoverflow.com/q/67468253,Karuna,"['azure', 'neo4j', 'apache-spark', 'databricks']"
67466393,Neo4j: Multiple Possible Nodes from One CSV Column,"I&#39;ve a CSV file of businesses and business owners that looks something like this:

|S/n|Business|Business_ID|Owned_By|Gender|
|:---:|:---:|:---:|:---:|:---:|
1|Aries Pte Ltd|12345|James Bond|Male
2|Taurus Pte Ltd|23456|Daenerys|Female
3|Gemini Pte Ltd|34567|Taurus Pte Ltd|NA

I would like to create a graph with the businesses as a node, the owner as a node, and a relationship between the business and the owner. For s/n 1 and 2, this is very straight forward:

```
LOAD CSV WITH HEADERS FROM &quot;....csv&quot; AS file
MERGE (b:Business {ID: file.Business_ID) 
WITH file, b
MERGE (p:Person {Name: file.Owned_by, Gender: file.Gender}) 
WITH file, b, p
MERGE (b)-[:owned_by] -&gt;(p) 
```

But note that a business could also be owned by another business (s/n 3), and that businesses and persons contains different properties (Business_ID and gender). Using the above syntax, I would get two distinct relationships for s/n 2 and 3:

(Taurus Pte Ltd)-[:owned_by]-&gt;(Daenerys)

(Gemini Pte Ltd)-[:owned_by]-&gt;(Taurus Pte Ltd)

But what I would like is a single relationship showing the entire chain of ownership:

(Taurus Pte Ltd)-[:owned_by]-&gt;(Gemini Pte Ltd)-[:owned_by] -&gt;(Daenerys)

How should I go about doing this? ",1620631597,https://stackoverflow.com/q/67466393,user13399233,"['cypher', 'neo4j']"
67464896,Opposed of apoc.text.HexValue in neo4j,"are Neo4j apoc library have opposed of `apoc.text.hexValue`

that can get hexString and return value in hex number or decimal number ?

Thanks.",1620622158,https://stackoverflow.com/q/67464896,Farjam Ramezan pour,"['neo4j', 'neo4j-apoc']"
67459833,Neo4j poor order by query performance,"I have a complex cypher, When I don&#39;t use &quot;order by&quot; I get a pretty fast response but when I use &quot;order by&quot; it is incredibly slow. I have an b tree index on my order attribute(score of the movie which is PageRank algorithm score). I added the cypher.

``` 
MATCH (m:Movie)
WHERE m.release &gt; &#39;0&#39; AND m.imdbVoteAverage &gt; 0 AND
CASE WHEN NOT [] = [] THEN any(title in [] WHERE toLower(m.title) CONTAINS title OR toLower(m.originalTitle) CONTAINS title) ELSE TRUE END
WITH m AS m
MATCH (m)-[:HAS_GENRE]-&gt;(genre: Genre)
WHERE CASE WHEN NOT [&#39;komedi&#39;] = [] THEN any(genreName in [&#39;komedi&#39;] WHERE toLower(genre.name) CONTAINS genreName) ELSE TRUE END
MATCH (m)&lt;-[acted:ACTED_IN]-(actor: Person)
WHERE CASE WHEN NOT [] = [] THEN any(actorName in [] WHERE toLower(actor.name) CONTAINS actorName) ELSE TRUE END AND
CASE WHEN NOT [] = [] THEN any(characterName in [] WHERE any(cname in acted.characterNames WHERE toLower(cname) CONTAINS characterName)) ELSE TRUE END
MATCH (m) -[:HAS_KEYWORDS]-&gt;(keyword: Keyword)
WHERE CASE WHEN NOT [] = [] THEN any(keywordName in [] WHERE toLower(keyword.name) CONTAINS keywordName) ELSE TRUE END
MATCH (m)&lt;-[:PRODUCED]-(producer: Person)
WHERE CASE WHEN NOT [] = [] THEN any(producerName in [] WHERE toLower(producer.name) CONTAINS producerName) ELSE TRUE END
MATCH (m)&lt;-[:DIRECTED]-(director: Person)
WHERE CASE WHEN NOT [] = [] THEN any(directorName in [] WHERE toLower(director.name) CONTAINS directorName) ELSE TRUE END
MATCH (m)&lt;-[:WRITTEN]-(writer: Person)
WHERE CASE WHEN NOT [] = [] THEN any(writerName in [] WHERE toLower(writer.name) CONTAINS writerName) ELSE TRUE END
MATCH (m)&lt;-[:PRODUCED_COMPANY]-(productionCompany: ProductionCompany)
WHERE CASE WHEN NOT [] = [] THEN any(producedCompanyName in [] WHERE toLower(productionCompany.name) CONTAINS producedCompanyName) ELSE TRUE END
RETURN DISTINCT m ORDER BY m.score DESC LIMIT 10 
```
Also If I add more field such as genre, title, directorName the query works much faster. ",1620576755,https://stackoverflow.com/q/67459833,Mehmet Sezer,"['neo4j', 'spring-data-neo4j', 'neo4j-apoc']"
67450116,How to load nested JSON in neo4j,"I have a JSON that has nested properties which follow a pattern.
Here is a simple sample, where shows how &quot;envolves_to&quot; gets nested and nested

```
{
    species: { 
        name: &#39;sample name&#39;,
        types: [
            {name, id, and another static data}
        ]
    },
    evolves_to: [
        {
            species: [...],
            evolves_to: [...another childs]
        },
        {
            species: [...],
            evolves_to: []           // this is empty, so this branch ends here
        },
        ...anthoer siblings
    ]
}
```

This is the code I&#39;ve tried to work with but ends up with repetitive code:

```
// get parent and childs
unwind value.evo_chain as evo_chain
with evo_chain.species as parent, evo_chain.evolves_to as childs


// create parent and types
create (p:Pokemon {name: parent.name})

with parent, p, childs
unwind parent.types as types
create (p)&lt;-[:TYPE_OF]-(:Pokemon {
    id: types.id,
    name: types.name,
    height: types.height,
    weight: types.weight
})


// childs new parents
with childs as contents, p as superParent
with distinct contents, superParent

// repeat pattern
unwind contents as evo_chain
with evo_chain.species as parent, evo_chain.evolves_to as childs, superParent

create (superParent)&lt;-[:CHILD_OF]-(p:Pokemon {name: parent.name})

with parent, p
unwind parent.types as types
create (p)&lt;-[:TYPE_OF]-(:Pokemon {
    id: types.id,
    name: types.name,
    height: types.height,
    weight: types.weight
})
```

How can I repeat recursively the search and start to create the relations and nodes?",1620493322,https://stackoverflow.com/q/67450116,Onyx,"['json', 'neo4j']"
67447752,How to fix timeless execution in cypher query - Neo4j Graph Database?,"I&#39;m dealing with the import of **Common Weakness Enumeration Catalog** (.json file) to the Neo4j Graph Database, using cypher language query and the apoc library. Although **i import properly the fields: Weaknesses, Views, External_References**, i have an execution problem (without any error) with the import of the field: **Categories** which is executing without ending. Below i present the structure of .json file and my cypher code.

    &quot;Weakness_Catalog&quot;: {
       &quot;Weaknesses&quot;: {&quot;Weakness&quot;:[...]}
       &quot;Categories&quot;: {&quot;Category&quot;:[...]}
       &quot;Views&quot;: {&quot;View&quot;:[...]}
       &quot;External_References&quot;: {&quot;External_Reference&quot;:[...]}
    } 

*Cypher Query*

After several tests i think that the logic error is between the last 2 parts [*with value....(catRef)*], without them, the query executes pretty good, at normal time. I&#39;ve also changed a setting param. at the db configuration file due to an error (**cypher.lenient_create_relationship = true**). And i tested the different import sequence with the same bad results (weakness, categories, views, ext. references etc.)

    call apoc.load.json(files) yield value
                                    unwind value.Weakness_Catalog.Weaknesses.Weakness as weakness
                                    merge (i:GeneralInfo_CWE {Name:value.Weakness_Catalog.Name, Version:value.Weakness_Catalog.Version,
                                                            Date:value.Weakness_Catalog.Date, Schema:&#39;https://cwe.mitre.org/data/xsd/cwe_schema_v6.4.xsd&#39;})
                                    
                                    merge(w:CWE {Name:&#39;CWE-&#39; + weakness.ID})
                                    set w.Extended_Name=weakness.Name, w.Abstraction=weakness.Abstraction,
                                    w.Structure=weakness.Structure, w.Status=weakness.Status, w.Description=weakness.Description,
                                    w.Extended_Description= apoc.convert.toString(weakness.Extended_Description),
                                    w.Likelihood_Of_Exploit=weakness.Likelihood_Of_Exploit,
                                    w.Background_Details=apoc.convert.toString(weakness.Background_Details.Background_Detail),
                                    w.Modes_Of_Introduction=[value in weakness.Modes_Of_Introduction.Introduction | value.Phase],
                                    w.Submission_Date=weakness.Content_History.Submission.Submission_Date,
                                    w.Submission_Name=weakness.Content_History.Submission.Submission_Name,
                                    w.Submission_Organization=weakness.Content_History.Submission.Submission_Organization,
                                    w.Modifications=[value in weakness.Content_History.Modification | apoc.convert.toString(value)],
                                    w.Alternate_Terms=apoc.convert.toString(weakness.Alternate_Terms),
                                    w.Notes=[value in weakness.Notes.Note | apoc.convert.toString(value)],
                                    w.Affected_Resources=[value in weakness.Affected_Resources.Affected_Resource | value],
                                    w.Functional_Areas=[value in weakness.Functional_Areas.Functional_Area | value]
                                    
                                    merge (w)-[:belongsTo]-&gt;(i)
                                    
                                    with w, weakness, value
                                    unwind weakness.Related_Weaknesses.Related_Weakness as Rel_Weakness
                                    match (cwe:CWE) where cwe.Name=&#39;CWE-&#39; + Rel_Weakness.CWE_ID
                                    merge (w)-[:Related_Weakness{Nature:Rel_Weakness.Nature}]-&gt;(cwe)
                                    
                                    with w, weakness, value
                                    unwind weakness.Applicable_Platforms as appPl
                                        foreach (lg in appPl.Language |
                                            merge(ap:Applicable_Platform{Type:&#39;Language&#39;, Prevalence:lg.Prevalence,
                                                    Name:coalesce(lg.Name, &#39;NOT SET&#39;), Class:coalesce(lg.Class, &#39;NOT SET&#39;)})
                                            merge(w)-[:Applicable_Platform]-&gt;(ap))
                                    
                                        with w, weakness, value, appPl
                                        foreach (tch in appPl.Technology |
                                            merge(ap:Applicable_Platform{Type:&#39;Technology&#39;, Prevalence:tch.Prevalence,
                                                    Name:coalesce(tch.Name, &#39;NOT SET&#39;), Class:coalesce(tch.Class, &#39;NOT SET&#39;)})
                                            merge(w)-[:Applicable_Platform]-&gt;(ap))
                                       
                                        with w, weakness, value, appPl
                                        foreach (arc in appPl.Architecture |
                                            merge(ap:Applicable_Platform{Type:&#39;Architecture&#39;, Prevalence:arc.Prevalence,
                                                    Name:coalesce(arc.Name, &#39;NOT SET&#39;), Class:coalesce(arc.Class, &#39;NOT SET&#39;)})
                                            merge(w)-[:Applicable_Platform]-&gt;(ap))
                                        
                                        with w, weakness, value, appPl
                                        foreach (os in appPl.Operating_System |
                                            merge(ap:Applicable_Platform{Type:&#39;Operating System&#39;, Prevalence:os.Prevalence,
                                                    Name:coalesce(os.Name, &#39;NOT SET&#39;), Class:coalesce(os.Class, &#39;NOT SET&#39;)})
                                            merge(w)-[:Applicable_Platform]-&gt;(ap))             
                               
                               
                                    with w, weakness, value
                                    foreach (example in weakness.Demonstrative_Examples.Demonstrative_Example |
                                        merge(ex:Demonstrative_Example {Intro_Text:apoc.convert.toString(example.Intro_Text)})
                                        set ex.Body_Text=[value in example.Body_Text | apoc.convert.toString(value)],
                                        ex.Example_Code=[value in example.Example_Code | apoc.convert.toString(value)]                                
                                        merge (w)-[:hasExample]-&gt;(ex))
                                                                    
                                                         
                                    with w, weakness, value
                                    foreach (consequence in weakness.Common_Consequences.Consequence |
                                        merge (con:Consequence{CWE:w.Name, Scope:[value in consequence.Scope | value]})
                                        set con.Impact=[value in consequence.Impact | value],
                                        con.Note=consequence.Note, con.Likelihood=consequence.Likelihood
                                        merge(w)-[:hasConsequence]-&gt;(con))
                                    
                                    with w, weakness, value
                                    foreach (dec in weakness.Detection_Methods.Detection_Method |
                                        merge(d:Detection_Method {Method:dec.Method})
                                        merge(w)-[wd:canBeDetected{Description:apoc.convert.toString(dec.Description)}]-&gt;(d)
                                        set wd.Effectiveness=dec.Effectiveness, wd.Effectiveness_Notes=dec.Effectiveness_Notes,
                                        wd.Detection_Method_ID=dec.Detection_Method_ID)                                
                                    
                                    with w, weakness, value
                                    foreach (mit in weakness.Potential_Mitigations.Mitigation |
                                        merge(m:Mitigation {Description:apoc.convert.toString(mit.Description)})
                                        set m.Phase=[value in mit.Phase | value], m.Strategy=mit.Strategy,
                                        m.Effectiveness=mit.Effectiveness, m.Effectiveness_Notes=mit.Effectiveness_Notes,
                                        m.Mitigation_ID=mit.Mitigation_ID
                                        merge(w)-[:hasMitigation]-&gt;(m))
                                        
                                    with w, weakness, value
                                    foreach (rap in weakness.Related_Attack_Patterns.Related_Attack_Pattern |
                                        merge(cp:CAPEC {Name:rap.CAPEC_ID})
                                        merge(w)-[:RelatedAttackPattern]-&gt;(cp))
                                    
                                    with w, weakness, value
                                    foreach (reference in value.Weakness_Catalog.External_References.External_Reference |
                                        merge(r:External_Reference{Reference_ID:reference.Reference_ID})
                                        set r.Author=[value in reference.Author | value], r.Title=reference.Title,
                                            r.Edition=reference.Edition, r.URL=reference.URL,
                                            r.Publication_Year=reference.Publication_Year, r.Publisher=reference.Publisher)
                                    
                                    with w, weakness, value
                                    unwind weakness.References.Reference as exReference
                                    match (ref:External_Reference) where ref.Reference_ID=exReference.External_Reference_ID
                                    merge(w)-[:hasExternal_Reference]-&gt;(ref)
                                                     
                                                                    
                                    with value
                                    unwind value.Weakness_Catalog.Views.View as view
                                    merge (v:CWE_VIEW{ViewID:view.ID})
                                    set v.Name=view.Name, v.Type=view.Type, v.Status=view.Status,
                                    v.Objective=apoc.convert.toString(view.Objective), v.Filter=view.Filter,
                                    v.Notes=apoc.convert.toString(view.Notes),
                                    v.Submission_Name=view.Content_History.Submission.Submission_Name,
                                    v.Submission_Date=view.Content_History.Submission.Submission_Date,
                                    v.Submission_Organization=view.Content_History.Submission.Submission_Organization,
                                    v.Modification=[value in view.Content_History.Modification | apoc.convert.toString(value)]
                                    
                                    foreach (value in view.Audience.Stakeholder |
                                        merge (st:Stakeholder{Type:value.Type})
                                        merge (v)-[rel:usefulFor]-&gt;(st)
                                        set rel.Description=value.Description)
                                    
                                    with v, view, value
                                    unwind (case view.Members.Has_Member when [] then [null] else view.Members.Has_Member end) as members
                                    optional match (MemberWeak:CWE{Name:&#39;CWE-&#39; + members.CWE_ID})
                                    merge (v)-[:hasMember{ViewID:members.View_ID}]-&gt;(MemberWeak)                                
                                    
                                                                                                                                    
                                    with v, view, value
                                    unwind (case view.References.Reference when [] then [null] else view.References.Reference end) as viewExReference
                                    optional match (viewRef:External_Reference{Reference_ID:viewExReference.External_Reference_ID})
                                    merge (v)-[:hasExternal_Reference{ViewID:v.ViewID}]-&gt;(viewRef)
                                    
                                    with value
                                    unwind value.Weakness_Catalog.Categories.Category as category
                                    merge (c:CWE_Category{CategoryID:category.ID})
                                    set c.Name=category.Name, c.Status=category.Status, c.Summary=apoc.convert.toString(category.Summary),
                                    c.Notes=apoc.convert.toString(category.Notes), c.Submission_Name=category.Content_History.Submission.Submission_Name,
                                    c.Submission_Date=category.Content_History.Submission.Submission_Date,
                                    c.Submission_Organization=category.Content_History.Submission.Submission_Organization,
                                    c.Modification=[value in category.Content_History.Modification | apoc.convert.toString(value)]
                                    
                                    with c, category
                                    unwind (case category.References.Reference when [] then [null] else category.References.Reference end) as categoryExReference
                                    optional match (catRef:External_Reference{Reference_ID:categoryExReference.External_Reference_ID})
                                    merge (c)-[:hasExternal_Reference{CategoryID:c.CategoryID}]-&gt;(catRef)",1620478184,https://stackoverflow.com/q/67447752,Adamantios Marios Berzovitis,"['neo4j', 'cypher', 'json', 'graph', 'database']"
67442023,Graph database nodes and edges change over time,"I would like to map the German Bundesliga as a structure in a graph database. This is no problem at all for the current &quot;static&quot; status:

 - Players are linked to clubs.
 - Clubs are linked to each other via matches.
 - Clubs are assigned to leagues.

However, I would like to bring in the dimension of time:
 - The 3rd League, for example, has only existed since 2008. Before that, the leagues were structured quite differently.
 - Players change clubs

How could I map this in a graph database?
Unfortunately, I haven&#39;t found anything in multi-model databases like OrientDB. ",1620423941,https://stackoverflow.com/q/67442023,Tobias Oberrauch,"['database', 'orientdb', 'neo4j', 'graph-databases', 'database-design']"
67439586,Dynamic Neo4j Cypher Query,"Is there a way to write the below neo4j cypher script to handle n case whens depending on the size of the array being read? I have varying array sizes on which to calculate co2 consumption so to use a one size fits all case when would be highly inefficient.

    MATCH paths = allShortestPaths((a: Flights {label: &#39;Paris&#39;})-[: FLIGHT*]-&gt;(b:Flights {label: &#39;Sydney&#39;}))
    WITH paths, relationships(paths) AS rels
    UNWIND rels AS rel
    WITH paths, 
	 collect(rel.co2) AS co2, 
	 collect(rel.engine_consumption) as ec
    RETURN 
      reduce(acc1=0.0,
		  x IN range(0, size(fc)-1) |
				case when x=0 then acc1 + co2[x]
					  when x=1 then acc1 + co2[x] * ec[x-1]
					  when x=2 then acc1 + co2[x] * ec[x-1] * ec[x-2]
					  when x=3 then acc1 + co2[x] * ec[x-1] * ec[x-2] * ec[x-3] 
                      ...
                      when x=size(ec)-1 then acc1 + co2[x] * ec[x-1] * ... * ec[0] 
					  end
		  )  AS normalised_co2
    ;",1620409678,https://stackoverflow.com/q/67439586,Michael Weatherby,"['cypher', 'sql', 'neo4j-apoc', 'neo4j']"
67434584,How to connect a remote MS SQL Server in neo4j tool?,"I&#39;m unable to add or connect MS SQL server remote Database in Neo4j?
I&#39;ve tried several times by adding the remote server URL in the Neo4j tool

Also, how do we make this tool available to everyone or end users without installing on their devices?

Can anyone please guide me?

Please treat this as a request.


https://community.neo4j.com/t/how-to-connect-a-remote-sql-server-in-neo4j-tool/37962?u=kdplghna ",1620388755,https://stackoverflow.com/q/67434584,Sudhir_Dontha,"['sql-server', 'database', 'neo4j']"
67424479,PreSave/PrePersist/BeforeSave Spring Data Neo4j,"I&#39;m having a bad time trying to find documentation about how to listen to this events using neo4j and spring data. I found some examples/similar question here in stack overflow but they all refer to SDN4 or before.

By any chance, any of you, have found some examples/documentation about it?",1620327910,https://stackoverflow.com/q/67424479,Mariano Zunino,"['spring-boot', 'spring-data', 'neo4j']"
67421668,Efficiently Find Unique Intermediate Nodes Connecting Two Sets of Nodes in Neo4j/Cypher,"I have data on movies that can be either comedies or dramas.  I have actors in those movies, who can have multiple roles per movie.  I want to find all distinct sets of movies and actors where:

(drama1:Movie {Genre:&#39;Drama&#39;})-[role1]-(actor1:Actor)-[role2]-(comedy:Movie {Genre:&#39;Comedy&#39;})-[role3]-(actor2:Actor)-[role4]-(drama2:Movie {Genre:&#39;Drama&#39;})
 
That is, I want to find where two (different) dramas are connected by a comedy with which both dramas share at least one actor.  I&#39;m struggling to do this efficiently and to get neo4j to give me distinct groups of drama1,drama2,actor1,actor2,comedy.   My data is on the order of a few million nodes and tens of millions of relationships, so efficiency is important.  A toy setup, which can be plugged into the neo4j online console is:


create (a:Movie {Genre:&#39;Comedy&#39;}), (b:Movie {Genre:&#39;Comedy&#39;}), (c:Movie {Genre:&#39;Comedy&#39;}), (d:Movie {Genre:&#39;Comedy&#39;}), (f:Movie {Genre:&#39;Drama&#39;}), (h:Movie {Genre:&#39;Drama&#39;}),(i:Actor {Name:&#39;Sarah&#39;}),(j:Actor {Name: &#39;Maria&#39;}),(k:Actor {Name:&#39;Mike&#39;}),(l:Actor {Name:&#39;Jane&#39;}),(m:Actor {Name:&#39;Sam&#39;}),(q:Actor {Name:&#39;Matt&#39;}),(r:Actor {Name:&#39;Tom&#39;}), (i)-[:ActedIn]-&gt;(a),  (i)-[:ActedIn]-&gt;(a) , (i)-[:ActedIn]-&gt;(a), (i)-[:ActedIn]-&gt;(a) , (i)-[:ActedIn]-&gt;(f) , (j)-[:ActedIn]-&gt;(b) , (j)-[:ActedIn]-&gt;(h) , (j)-[:ActedIn]-&gt;(h) , (q)-[:ActedIn]-&gt;(c) , (q)-[:ActedIn]-&gt;(b) , (q)-[:ActedIn]-&gt;(a) , (r)-[:ActedIn]-&gt;(f) , (r)-[:ActedIn]-&gt;(f) , (r)-[:ActedIn]-&gt;(a) , (j)-[:ActedIn]-&gt;(b) , (j)-[:ActedIn]-&gt;(c) , (k)-[:ActedIn]-&gt;(d), (l)-[:ActedIn]-&gt;(c) , (i)-[:ActedIn]-&gt;(a) , (i)-[:ActedIn]-&gt;(h) , (m)-[:ActedIn]-&gt;(h)

I&#39;ve mostly tried variations of

match (drama1:Movie {Genre:&#39;Drama&#39;})-[role1]-(actor1:Actor)-[role2]-(comedy:Movie {Genre:&#39;Comedy&#39;})-[role3]-(actor2:Actor)-[role4]-(drama2:Movie {Genre:&#39;Drama&#39;}) return drama1,actor1,comedy,actor2,drama2

",1620316190,https://stackoverflow.com/q/67421668,Robmattles,"['cypher', 'neo4j']"
67421392,Updating neo4j relationship properties without duplicating the existing relationship,"I have the following to first create relationship between nodes (the nodes already created in a previous step)

    MATCH (a:node), (b:node) WHERE a.name = &#39;sw1&#39; AND b.name = &#39;sw2&#39;
    			 merge (a)-[c:connect {packets_transmitted:0,packets_recieved:0}]-&gt;(b)

I need to update the properties without duplicating the relationship which is already exist. Now whenever I run the cypher, the relationship between the nodes **connect** duplicates. What should I do? 

Here what I used for updating the relationship properties:

    MATCH (a:node),(b:node) where a.name=&#39;sw1&#39; and b.name =&#39;sw2&#39;
    	  merge (a)-[c:connect]-&gt;(b)
    	  set c.packets_transmitted = 250,c.packets_recieved = 300

**Update:** 
This is the entire code  which I wrote in python (I modified it to be as clear as possible and still the relationship duplicates)

**Note:** The code works fine when I execute it directly in neo4j
 
    cqlCreate_1=f&quot;merge(n:node{{name:&#39;openflow:2&#39;}})&quot;
    with graphDB_Driver.session() as graphDB_Session:
    		graphDB_Session.run(cqlCreate_1)
    
    cqlCreate_3=f&quot;merge(m:node{{name:&#39;2e:38:64:0e:e8:1f&#39;}})&quot;
    with graphDB_Driver.session() as graphDB_Session:
    		graphDB_Session.run(cqlCreate_3)
    
    cqlCreate_2=f&quot;MATCH (a:node),(b:node) WHERE a.name =&#39;openflow:2&#39;\
    and b.name=&#39;2e:38:64:0e:e8:1f&#39;\
    merge (a)-[c:connect{{p:0}}]-(b)&quot;
    with graphDB_Driver.session() as graphDB_Session:
    		graphDB_Session.run(cqlCreate_2)
    
    cqlUpdate=f&quot;MATCH (a:node)-[c:connect]-(b:node) where a.name=&#39;openflow:2&#39;\
    and b.name=&#39;2e:38:64:0e:e8:1f&#39;\
    set c.p=200&quot;
    with graphDB_Driver.session() as graphDB_Session:
    	graphDB_Session.run(cqlUpdate)",1620315216,https://stackoverflow.com/q/67421392,Sama,"['relationship', 'neo4j']"
67416527,How can I create GraphQL API&#39;s with Django and Neo4j Database?,"I am working on a project where I need to make GraphQL API&#39;s with Django Server (Graphene-Django) and Neo4J database. I have looked quite a lot over the internet, but I wasn&#39;t able to find any useful resources. If anyone can give a simple example of the flow or suggest some resources, please help.",1620297672,https://stackoverflow.com/q/67416527,Aanchal Agarwal,"['python', 'graphql', 'neo4j', 'django', 'graphene-django']"
67413836,"Attempting to deflate property &#39;date&#39; on &lt;unsaved node&gt; of class &#39;Schedule&#39;: datetime.date object expected, got string","I&#39;m trying to insert a new record with this mutation, however, I hit this error as below:

&gt;Attempting to deflate property &#39;start_date&#39; on &lt;unsaved node&gt; of class &#39;Schedule&#39;: datetime.date object expected, got &#39;2020-04-01&#39;

My start_date is defined as DateProperty()

Graphql mutation query
```
mutation {
  CreateSchedule(
    name:&quot;schedule2&quot;, 
    options:&quot;{}&quot;,
    start_date:&quot;2020-04-01&quot;,
    days:[0,1,2], 
    interval:60,
    email:&quot;&quot;, ) {
    uid
  }
}
```

My schedule class
```
class Schedule(StructuredNode):
    uid = UniqueIdProperty()
    name = StringProperty(unique_index=True)
    start_date = DateProperty(format=&#39;YYYY-MM-DD&#39;)
    end_date = DateProperty()
    start_time = StringProperty()
    end_time = StringProperty()
    days = ArrayProperty()
    interval = IntegerProperty()
    email = EmailProperty()
``` ",1620287062,https://stackoverflow.com/q/67413836,xion,"['python', 'neomodel', 'neo4j']"
67406615,neo4j find all friends who posted something I liked,"I want to find all the friends that posted something I liked. Why does this query return no rows but each clause by themselves returns something?

```
 match (start:Person)-[:LIKES]-&gt;(post:Post), (start)-[:FRIEND]-&gt;(person: Person), (person)-[:POSTED]-&gt;(post) return start, post, person
```
[![profile01][1]][1]
[![profile02][2]][2]


  [1]: https://i.stack.imgur.com/AQaZm.png
  [2]: https://i.stack.imgur.com/6zcAK.png",1620238223,https://stackoverflow.com/q/67406615,Samuel Squire,"['cypher', 'graph', 'neo4j']"
67388862,Coloring arks (relationships) in Neo4j,"Is this possible to color specific ark between two nodes based on the ark&#39;s `&lt;id&gt;` property? if so, how can this be done? 

Thanks!",1620146859,https://stackoverflow.com/q/67388862,Mirs405,"['neo4j', 'neo4j-apoc', 'graph-databases', 'cypher']"
67386445,Ontology Populating,"*Hello everyone*,

because of my lack of experience with ontologies and web semantics, I have a conceptual misunderstanding. When we refer to &#39;ontology population&#39;, do we make clones of the ontology with our concrete data or do we map our concrete data to the ontology? If so, how is it done? My intention is to build a knowledge graph using an ontology (FIBO ontology for the loans domain) and I have also an excel file with loans data. Not every entry in my excel file corresponds to the ontology classes predefined. However, that is not a major problem I suppose. So, to make myself more clear, ***I want to know how do I practically populate the ontology?***
Also, I would like to note that I am using neo4j as a graph database and python as my implementation language, so the process of the population of the ontology would have been done using its libraries. 

Thanks in advance for your time!",1620137279,https://stackoverflow.com/q/67386445,elio raca,"['neo4j', 'semantic-web', 'ontology', 'python-3.x']"
67385780,Neo4J (Cypher) Group the multiple relationships by node,"I&#39;m working on a small recommendation system to recommend players for the next game. The recommendation consists of first the followed players and then the players who the player has played before ordered by the number of games.

The result would be `Player, is_followed (true|false), GameIds`

I have `Player` and `Game` nodes where are related as `Game -[:HAS_PLAYER]-&gt; Player`
and 

the `Player` nodes are directly related as `Player -[:FOLLOWS]-&gt; Player`.

My test DB:

    CREATE (superman:Player {playerID: &#39;superman&#39;, name:&#39;Superman&#39;, sanitizedName: &#39;superman&#39;})
    CREATE (batman:Player {playerID: &#39;batman&#39;, name:&#39;Batman&#39;, sanitizedName: &#39;batman&#39;})
    CREATE (catwoman:Player {playerID: &#39;catwoman&#39;, name:&#39;Catwoman&#39;, sanitizedName: &#39;catwoman&#39;})
    CREATE (lois:Player {playerID: &#39;lois&#39;, name:&#39;Lois Lane&#39;, sanitizedName: &#39;lois lane&#39;})
    CREATE (wonderwoman:Player {playerID: &#39;wonderwoman&#39;, name:&#39;Wonder Woman&#39;, sanitizedName: &#39;wonder woman&#39;})
    CREATE (aquaman:Player {playerID: &#39;aquaman&#39;, name:&#39;Aquaman&#39;, sanitizedName: &#39;aquaman&#39;})
    CREATE (flash:Player {playerID: &#39;flash&#39;, name:&#39;Flash&#39;, sanitizedName: &#39;flash&#39;})
    CREATE (cyborg:Player {playerID: &#39;cyborg&#39;, name:&#39;Cyborg&#39;, sanitizedName: &#39;cyborg&#39;})
    CREATE (joker:Player {playerID: &#39;joker&#39;, name:&#39;Joker&#39;, sanitizedName: &#39;joker&#39;})
    CREATE (lex:Player {playerID: &#39;lex&#39;, name:&#39;Lex Luthor&#39;, sanitizedName: &#39;lex luthor&#39;})
    CREATE (green:Player {playerID: &#39;green&#39;, name:&#39;Green Lantern&#39;, sanitizedName: &#39;green lantern&#39;})
    
    CREATE (g1:Game {gameId:&quot;game-1&quot;})
    CREATE (g1)-[:HAS_PLAYERS {teamId:&quot;0&quot;}]-&gt;(superman)
    CREATE (g1)-[:HAS_PLAYERS {teamId:&quot;0&quot;}]-&gt;(aquaman)
    CREATE (g1)-[:HAS_PLAYERS {teamId:&quot;1&quot;}]-&gt;(batman)
    CREATE (g1)-[:HAS_PLAYERS {teamId:&quot;1&quot;}]-&gt;(flash)
    
    CREATE (g2:Game {gameId:&quot;game-2&quot;})
    CREATE (g2)-[:HAS_PLAYERS {teamId:&quot;0&quot;}]-&gt;(superman)
    CREATE (g2)-[:HAS_PLAYERS {teamId:&quot;0&quot;}]-&gt;(batman)
    CREATE (g2)-[:HAS_PLAYERS {teamId:&quot;1&quot;}]-&gt;(joker)
    CREATE (g2)-[:HAS_PLAYERS {teamId:&quot;1&quot;}]-&gt;(lex)
    
    CREATE (g3:Game {gameId:&quot;game-3&quot;})
    CREATE (g3)-[:HAS_PLAYERS {teamId:&quot;0&quot;}]-&gt;(flash)
    CREATE (g3)-[:HAS_PLAYERS {teamId:&quot;0&quot;}]-&gt;(lois)
    CREATE (g3)-[:HAS_PLAYERS {teamId:&quot;1&quot;}]-&gt;(wonderwoman)
    CREATE (g3)-[:HAS_PLAYERS {teamId:&quot;1&quot;}]-&gt;(aquaman)
    
    CREATE (g4:Game {gameId:&quot;game-4&quot;})
    CREATE (g4)-[:HAS_PLAYERS {teamId:&quot;0&quot;}]-&gt;(joker)
    CREATE (g4)-[:HAS_PLAYERS {teamId:&quot;0&quot;}]-&gt;(cyborg)
    CREATE (g4)-[:HAS_PLAYERS {teamId:&quot;1&quot;}]-&gt;(wonderwoman)
    CREATE (g4)-[:HAS_PLAYERS {teamId:&quot;1&quot;}]-&gt;(green)
    
    CREATE (g5:Game {gameId:&quot;game-5&quot;})
    CREATE (g5)-[:HAS_PLAYERS {teamId:&quot;0&quot;}]-&gt;(catwoman)
    CREATE (g5)-[:HAS_PLAYERS {teamId:&quot;1&quot;}]-&gt;(green)
    
    CREATE (batman)-[:FOLLOWS]-&gt;(superman)
    CREATE (batman)-[:FOLLOWS]-&gt;(catwoman)
    
    CREATE (lex)-[:FOLLOWS]-&gt;(joker)
    CREATE (joker)-[:FOLLOWS]-&gt;(lex)
    ;

[![Batman result][1]][1]

With this data, I want to recommend to Batman a player for his next game and the result has to be:

    superman true  [game-1, game-2]
    catwoman true  []
    aquaman  false [game-1]
    flash    false [game-1]
    joker    false [game-2]
    lex      false [game-2]


UPDATE: 
I have the next query but the followed players are missing:

    MATCH (u:Player{playerID:&quot;batman&quot;})
    OPTIONAL MATCH (u)&lt;-[:HAS_PLAYERS]-(g:Game)-[:HAS_PLAYERS]-&gt;(p:Player) 
    RETURN p, EXISTS((u)-[:FOLLOWS]-&gt;(p)) AS is_followed, COUNT(g) AS num_games, collect(g) AS games
    ORDER BY num_games DESC

Thank you!

UPDATE 2

This approach could be more &#39;readable&#39; but the performance is much worse than the accepted answer.

    MATCH (u:Player{playerID:&quot;batman&quot;})
    CALL {
    	WITH u
    	MATCH (u)&lt;-[:HAS_PLAYERS]-(g:Game)-[:HAS_PLAYERS]-&gt;(p:Player) 
    	RETURN p
    
    	UNION
    
    	WITH u
    	MATCH (u)-[:FOLLOWS]-&gt;(p:Player)
    	RETURN p
    }
    WITH p,
    	EXISTS((u)-[:FOLLOWS]-&gt;(p)) AS is_followed,
    	[(u)&lt;-[:HAS_PLAYERS]-(g:Game)-[:HAS_PLAYERS]-&gt;(p) | g.gameId] AS games
    RETURN p.name, is_followed, size(games) AS num_games, games
    ORDER BY num_games DESC



  [1]: https://i.stack.imgur.com/vKQkh.png",1620134999,https://stackoverflow.com/q/67385780,Miguel,"['cypher', 'neo4j']"
67383161,Nodejs Cannot Read Property When Running in Docker,"I&#39;m trying to run the example Neo4j Node project in Docker containers but I&#39;m having an issue with the Node part. The project runs fine locally but when I run it in a docker container I get this error:

    const neo4j = window.neo4j;
                  ^
    
    ReferenceError: window is not defined

I have pretty much no JavaScript / Node experience so just looking for any help to point me in the right direciton.

My dockerfile looks like this:

    FROM node:10
    WORKDIR /app
    COPY package.json /app
    COPY package-lock.json /app
    RUN npm config set strict-ssl false
    RUN npm cache clean --force &amp;&amp; npm install &amp;&amp; npm install -g serve
    #RUN npm install
    COPY . /app
    RUN npm run build
    COPY serve.json dist/serve.json
    
    CMD [&quot;node&quot;, &quot;src/app.js&quot;]
    EXPOSE 8080

The demo project is: [https://github.com/neo4j-examples/movies-javascript-bolt][1]


  [1]: https://github.com/neo4j-examples/movies-javascript-bolt

UPDATE
The comment from Amir seems to have solved the original issue. This was to change

    const neo4j = window.neo4j;

to

    const neo4j = require(&quot;neo4j-driver&quot;);

with neo4j-driver being the name of the module.

Now I&#39;m getting this similar issue if anyone has any ideas:

    $(function () {
    ^
    
    ReferenceError: $ is not defined

",1620124690,https://stackoverflow.com/q/67383161,user3193861,"['javascript', 'docker', 'node.js', 'neo4j']"
67378953,Create a path between two nodes through another node using cypher command in neo4j?,"For example, I have three nodes a, b, c. I want to create a **path** (not relationship) between nodes a and c via node b. I referred some official docs but I cannot find exact query.

What I referred
https://neo4j.com/docs/cypher-manual/current/clauses/create/#create-create-a-full-path",1620103723,https://stackoverflow.com/q/67378953,Rohith,"['graph-databases', 'neo4j', 'cypher', 'nosql']"
67363073,Graph database or relational database for tree structure data,"I have company holding data with hierarchical structure by year. For example company A holds 50% of B, B holds 50% of C and D holds 50% of C. Each firm has their properties such as industry.

There are few write operations and mostly read. Specifically, starting from a set of nodes (root), extract the family tree by tracing down with certain percentage share threshold. There are several metrics of interest in the family tree.

For each node: 
1. the depth from the root
2. the product of share layer by layer from the root, e.g. A holds 0.5*0.5 = 25% of C.

For each level:
1. the distribution of share from each root
2. the distribution of industry

Note that there could be multiple roots for each node and we are interested in all.

For now, the data is stored in a relational database and the task described above is done through joining. Would a graph database such as neo4j be more suitable for the data and this task? The crux of the problem is to have a proper index so that joining is not necessary for each time. Any suggestion and pointer would be greatly appreciated.",1620011316,https://stackoverflow.com/q/67363073,cccfran,"['graph-databases', 'database', 'neo4j']"
67359519,Parse neo4j JSON response,"I have the neo4j response Object (I&#39;m prividing you the whole response so I&#39;d get it right):

    result = {
        &quot;records&quot;: [
            {
                &quot;keys&quot;: [
                    &quot;criteria.name&quot;
                ],
                &quot;length&quot;: 1,
                &quot;_fields&quot;: [
                    &quot;Perspective&quot;
                ],
                &quot;_fieldLookup&quot;: {
                    &quot;criteria.name&quot;: 0
                }
            },
            {
                &quot;keys&quot;: [
                    &quot;criteria.name&quot;
                ],
                &quot;length&quot;: 1,
                &quot;_fields&quot;: [
                    &quot;3D&quot;
                ],
                &quot;_fieldLookup&quot;: {
                    &quot;criteria.name&quot;: 0
                }
            },
            {
                &quot;keys&quot;: [
                    &quot;criteria.name&quot;
                ],
                &quot;length&quot;: 1,
                &quot;_fields&quot;: [
                    &quot;2D&quot;
                ],
                &quot;_fieldLookup&quot;: {
                    &quot;criteria.name&quot;: 0
                }
            }
        ],
        &quot;summary&quot;: {
            &quot;query&quot;: {
                &quot;text&quot;: &quot;MATCH (criteria:TEST_01)\nRETURN criteria.name\nLIMIT 3&quot;,
                &quot;parameters&quot;: {}
            },
            &quot;queryType&quot;: &quot;r&quot;,
            &quot;counters&quot;: {
                &quot;_stats&quot;: {
                    &quot;nodesCreated&quot;: 0,
                    &quot;nodesDeleted&quot;: 0,
                    &quot;relationshipsCreated&quot;: 0,
                    &quot;relationshipsDeleted&quot;: 0,
                    &quot;propertiesSet&quot;: 0,
                    &quot;labelsAdded&quot;: 0,
                    &quot;labelsRemoved&quot;: 0,
                    &quot;indexesAdded&quot;: 0,
                    &quot;indexesRemoved&quot;: 0,
                    &quot;constraintsAdded&quot;: 0,
                    &quot;constraintsRemoved&quot;: 0
                },
                &quot;_systemUpdates&quot;: 0
            },
            &quot;updateStatistics&quot;: {
                &quot;_stats&quot;: {
                    &quot;nodesCreated&quot;: 0,
                    &quot;nodesDeleted&quot;: 0,
                    &quot;relationshipsCreated&quot;: 0,
                    &quot;relationshipsDeleted&quot;: 0,
                    &quot;propertiesSet&quot;: 0,
                    &quot;labelsAdded&quot;: 0,
                    &quot;labelsRemoved&quot;: 0,
                    &quot;indexesAdded&quot;: 0,
                    &quot;indexesRemoved&quot;: 0,
                    &quot;constraintsAdded&quot;: 0,
                    &quot;constraintsRemoved&quot;: 0
                },
                &quot;_systemUpdates&quot;: 0
            },
            &quot;plan&quot;: false,
            &quot;profile&quot;: false,
            &quot;notifications&quot;: [],
            &quot;server&quot;: {
                &quot;address&quot;: &quot;localhost:7687&quot;,
                &quot;version&quot;: &quot;Neo4j/4.1.0&quot;,
                &quot;protocolVersion&quot;: 4.1
            },
            &quot;resultConsumedAfter&quot;: {
                &quot;low&quot;: 2,
                &quot;high&quot;: 0
            },
            &quot;resultAvailableAfter&quot;: {
                &quot;low&quot;: 80,
                &quot;high&quot;: 0
            },
            &quot;database&quot;: {
                &quot;name&quot;: &quot;neo4j&quot;
            }
        }
    }
I need to get only individual &quot;_fields&quot; from it as following:

    {&quot;Perspective&quot;, &quot;3D&quot;, &quot;2D&quot;}
How do I do this?

I ended up suceeded getting the value from any exact record with this code:

    a = Object.values(result.records)
    b = Object.values(a[0]._fields)
    console.log(b);
but I can&#39;t understand how can I go fore each of &quot;a&quot; elemets in array and extract &quot;_fields&quot;.",1619978060,https://stackoverflow.com/q/67359519,Roman Korobko,"['neo4j', 'json', 'parsing', 'javascript']"
67353492,Carrierwave-neo4j not working in Development,"I&#39;m getting &quot;`no implicit conversion from nil`&quot; error when I try to save my model. can someone help? I had to add the `ActiveGraph::Node.include CarrierWave::Neo4j` in my Model because there seemed to be some issue with orm and I kept getting NoMethod error for `mount_uploader`. During  it&#39;s investigation I found out that the the gem-file  was extending the Module methods to Neo4j::Node, and `activegraph` has changed the namespaces in the upgradation from neo4j to activegraph. It looks like most of the gems for neo4j.rb will have to be rewritten.
Is there any alternative to using this gem for file uploads in a neo4j.rb project?  `carrierwave-neo4j (3.0.0)`, `carrierwave (2.2.1)` and `activegraph (10.0.2)`
I&#39;m posting some relevant lines from my code.

My Model

    class CrimeNewsSheet
      ActiveGraph::Node.include CarrierWave::Neo4j
    
        include ActiveGraph::Node
    
      mount_uploader :cns, CnsUploader
      mount_uploader :csv, CsvUploader
      require &#39;nokogiri&#39;
      require &#39;open-uri&#39;
      property :cns_date, type: Date
      property :cns, type: String
      property :csv, type: String
    end

My Uploader

    class CnsUploader &lt; CarrierWave::Uploader::Base
      storage (Rails.env.production? ? :fog : :file)
      
    end
My initializer is foolproof

My params 

    Parameters: {&quot;authenticity_token&quot;=&gt;&quot;[FILTERED]&quot;, &quot;crime_news_sheet&quot;=&gt;{&quot;cns_date&quot;=&gt;&quot;&quot;, &quot;cns&quot;=&gt;#&lt;ActionDispatch::Http::UploadedFile:0x00007feffade87e8 @tempfile=#&lt;Tempfile:/var/folders/3q/vc732_pn0v7bj2dhq1_sts8r0000gn/T/RackMultipart20210502-43414-8dsx8s.xml&gt;, @original_filename=&quot;cns_trial_1.xml&quot;, @content_type=&quot;text/xml&quot;, @headers=&quot;Content-Disposition: form-data; name=\&quot;crime_news_sheet[cns]\&quot;; filename=\&quot;cns_trial_1.xml\&quot;\r\nContent-Type: text/xml\r\n&quot;&gt;}, &quot;commit&quot;=&gt;&quot;Add&quot;}

Cypher code

    CYPHER CREATE (n:`CrimeNewsSheet`) SET n = $props RETURN n | {:props=&gt;{:uuid=&gt;&quot;b512ebab-5091-4270-a96a-f7268bf47c63&quot;, :created_at=&gt;1619934268, :updated_at=&gt;1619934268, :cns=&gt;#&lt;CnsUploader:0x00007feff8e61410 @model=#&lt;CrimeNewsSheet uuid: nil, casesuploaded: nil, cns: #&lt;CnsUploader:0x00007feff8e61410 ...&gt;, cns_date: nil, created_at: Sun, 02 May 2021 11:14:28 +0530, csv: #&lt;CsvUploader:0x00007feff8e60ba0 @model=#&lt;CrimeNewsSheet uuid: nil, casesuploaded: nil, cns: #&lt;CnsUploader:0x00007feff8e61410 ...&gt;, cns_date: nil, created_at: Sun, 02 May 2021 11:14:28 +0530, csv: #&lt;CsvUploader:0x00007feff8e60ba0 ...&gt;, existing: nil, processed: nil, ps_list: nil, rejected: nil, updated_at: Sun, 02 May 2021 11:14:28 +0530&gt;, @mounted_as=:csv, @staged=false, @file=nil, @filename=nil, @cache_id=nil, @identifier=nil, @versions=nil, @versions_to_cache=nil, @versions_to_store=nil, @storage=#&lt;CarrierWave::Storage::Fog:0x00007feffe1a69e0 @uploader=#&lt;CsvUploader:0x00007feff8e60ba0 ...&gt;&gt;&gt;, existing: nil, processed: nil, ps_list: nil, rejected: nil, updated_at: Sun, 02 May 2021 11:14:28 +0530&gt;, @mounted_as=:cns, @staged=false, @file=nil, @filename=nil, @cache_id=nil, @identifier=nil, @versions=nil, @versions_to_cache=nil, @versions_to_store=nil, @storage=#&lt;CarrierWave::Storage::File:0x00007feffe1a6dc8 @uploader=#&lt;CnsUploader:0x00007feff8e61410 ...&gt;, @cache_called=nil&gt;&gt;, :csv=&gt;#&lt;CsvUploader:0x00007feff8e60ba0 @model=#&lt;CrimeNewsSheet uuid: nil, casesuploaded: nil, cns: #&lt;CnsUploader:0x00007feff8e61410 @model=#&lt;CrimeNewsSheet uuid: nil, casesuploaded: nil, cns: #&lt;CnsUploader:0x00007feff8e61410 ...&gt;, cns_date: nil, created_at: Sun, 02 May 2021 11:14:28 +0530, csv: #&lt;CsvUploader:0x00007feff8e60ba0 ...&gt;, existing: nil, processed: nil, ps_list: nil, rejected: nil, updated_at: Sun, 02 May 2021 11:14:28 +0530&gt;, @mounted_as=:cns, @staged=false, @file=nil, @filename=nil, @cache_id=nil, @identifier=nil, @versions=nil, @versions_to_cache=nil, @versions_to_store=nil, @storage=#&lt;CarrierWave::Storage::File:0x00007feffe1a6dc8 @uploader=#&lt;CnsUploader:0x00007feff8e61410 ...&gt;, @cache_called=nil&gt;&gt;, cns_date: nil, created_at: Sun, 02 May 2021 11:14:28 +0530, csv: #&lt;CsvUploader:0x00007feff8e60ba0 ...&gt;, existing: nil, processed: nil, ps_list: nil, rejected: nil, updated_at: Sun, 02 May 2021 11:14:28 +0530&gt;, @mounted_as=:csv, @staged=false, @file=nil, @filename=nil, @cache_id=nil, @identifier=nil, @versions=nil, @versions_to_cache=nil, @versions_to_store=nil, @storage=#&lt;CarrierWave::Storage::Fog:0x00007feffe1a69e0 @uploader=#&lt;CsvUploader:0x00007feff8e60ba0 ...&gt;&gt;&gt;}}



",1619936025,https://stackoverflow.com/q/67353492,Sanjay Singh,"['carrierwave', 'neo4j']"
67352721,I keep getting the error &quot;Unknown Directive&quot; in Netlify Production using GRANDstack,"has anyone encountered the following
`errorMessage: &quot;Unknown directive &quot;isAuthenticated&quot;.↵↵Unknown directive &quot;isAuthenticated&quot;.&quot;`

I&#39;m building my first app using GRANDstack and I&#39;m trying to use `@hasScope` and `@isAuthenticated` in my api.

Everything works fine in development. It happens in production when serving through netlify functions.


```
const schema = makeAugmentedSchema({
  typeDefs,
  resolvers,
  config: {
    query: true,
    mutation: true,
    auth: {
      isAuthenticated: true,
      hasScope: true,
    },
  },
})
```

This is the code from my index.js file.

UPDATE:
Here is the code from my functions/graphql/graphql.js file 

```
`// This module can be used to serve the GraphQL endpoint
// as a lambda function

const { ApolloServer } = require(&#39;apollo-server-lambda&#39;)
const { makeAugmentedSchema } = require(&#39;neo4j-graphql-js&#39;)
const neo4j = require(&#39;neo4j-driver&#39;)

// This module is copied during the build step
// Be sure to run `npm run build`
const { typeDefs } = require(&#39;./graphql-schema&#39;)

const driver = neo4j.driver(
  process.env.NEO4J_URI || &#39;bolt://localhost:7687&#39;,
  neo4j.auth.basic(
    process.env.NEO4J_USER || &#39;neo4j&#39;,
    process.env.NEO4J_PASSWORD || &#39;neo4j&#39;
  ),
  {
    encrypted: process.env.NEO4J_ENCRYPTED ? &#39;ENCRYPTION_ON&#39; : &#39;ENCRYPTION_OFF&#39;,
  }
)

const server = new ApolloServer({
  schema: makeAugmentedSchema({
    typeDefs,
    config: {
      query: true,
      mutation: true,
      auth: {
        isAuthenticated: true,
        hasScope: true,
      },
    },
  }),
  context: ({ req }) =&gt; {
    return { req, driver, neo4jDatabase: process.env.NEO4J_DATABASE }
  },
})

exports.handler = server.createHandler()
`
```

After including the config object in makeAugmentedSchema, the error has now changed to say `no authorisation token`

I&#39;m not sure if there&#39;s anything else I should be doing. Everything works fine in development.",1619925867,https://stackoverflow.com/q/67352721,jd_addy,"['auth0', 'grandstack', 'neo4j', 'netlify']"
67337219,How to create nodes constrains in Neo4j automatically for 100 differents nodes?,"I&#39;m trying to create the node constrains for 100 differents nodes.

I have a list of the nodes names and a list for the nodes variables, for example:

    nodes = [skill1, skill2, skill3, ...]       variables = [s1, s2, s3, ...]

I would like to create all nodes contrains with a loop. I wrote this:

    for node, var in zip(nodes, variables):
        try:
            with driver.session() as session:
                session.run(&#39;CREATE CONSTRAINT &quot;+node+&quot; ON (&quot;+var+&quot;:&quot;+node+&quot;) ASSERT &quot;+var+&quot;.id IS UNIQUE;&#39;)
        except:
            print(&quot;Constrains already exists&quot;)

  But It passes directly to the except statement and no contrains are created in Neo4j.

Someone has a solution to create different constrains in just one loop? Thank you!",1619799331,https://stackoverflow.com/q/67337219,pat_triccia,"['neo4j', 'cypher']"
67334555,Cannot duplicate node due to constraint violation on an _id,"We are trying to clone nodes on a label that has a duplicate constraint on the property _id

```
MATCH (s:part{_id:&#39;aaaaa&#39;})
CREATE (newNode:part)
SET newNode = s, newNode._id = &#39;bbbbb&#39;
RETURN  newNode
```

and we get 

    Node(52) already exists with label `part` and property `_id` = &#39;aaaaa&#39;

How can you clone a node just changing the constrained property?",1619788332,https://stackoverflow.com/q/67334555,Yoann Maingon,['neo4j']
67331701,Unable to Send Data from MongoDB to neo4j via Kafka Connect,"I&#180;m trying to send data from MongoDB to neo4j using Confluent Community Platform and the MongoDB and neo4j connectors. I&#39;m using neo4j Community Edition 4.2.3. 

I configured Mongo as source and neo4j as sink. These are my connector configurations:
```
curl -X PUT http://localhost:8083/connectors/source-mongodb-test/config -H &quot;Content-Type: application/json&quot; -d &#39;{
      &quot;tasks.max&quot;:1,
      &quot;connector.class&quot;:&quot;com.mongodb.kafka.connect.MongoSourceConnector&quot;,
      &quot;key.converter&quot;:&quot;org.apache.kafka.connect.storage.StringConverter&quot;,
      &quot;value.converter&quot;:&quot;org.apache.kafka.connect.storage.StringConverter&quot;,
      &quot;connection.uri&quot;:&quot;&lt;my-connection.uri&gt;&quot;,
      &quot;database&quot;:&quot;data&quot;,
      &quot;collection&quot;:&quot;test&quot;,
      &quot;pipeline&quot;:&quot;&quot;, 
      &quot;topic.namespace.map&quot;:&quot;{\&quot;data\&quot;: \&quot;default-topic\&quot;, \&quot;data.test\&quot;: \&quot;my-mongotesttopic\&quot;}&quot;
}&#39;
```
```
curl -X PUT http://localhost:8083/connectors/sink-neo4j-test/config -H &quot;Content-Type: application/json&quot; -d &#39;{
    &quot;topics&quot;: &quot;my-mongotesttopic&quot;,
    &quot;connector.class&quot;: &quot;streams.kafka.connect.sink.Neo4jSinkConnector&quot;,
    &quot;kafka.key.deserializer&quot;:&quot;org.apache.kafka.common.serialization.ByteArrayDeserializer&quot;,
    &quot;kafka.value.deserializer&quot;:&quot;org.apache.kafka.common.serialization.ByteArrayDeserializer&quot;,
    &quot;key.converter&quot;: &quot;org.apache.kafka.connect.storage.StringConverter&quot;,
    &quot;value.converter&quot;: &quot;org.apache.kafka.connect.json.JsonConverter&quot;,
    &quot;value.converter.schemas.enable&quot;:&quot;false&quot;,
    &quot;errors.retry.timeout&quot;: &quot;-1&quot;,
    &quot;errors.retry.delay.max.ms&quot;: &quot;1000&quot;,
    &quot;errors.tolerance&quot;: &quot;all&quot;,
    &quot;errors.log.enable&quot;: true,
    &quot;errors.log.include.messages&quot;: true,
    &quot;neo4j.server.uri&quot;: &quot;bolt://&lt;myIP&gt;:7687&quot;,
    &quot;neo4j.authentication.basic.username&quot;: &quot;neo4j&quot;,
    &quot;neo4j.authentication.basic.password&quot;: &quot;&lt;password&gt;&quot;,
    &quot;neo4j.topic.cypher.my-mongotesttopic&quot;:
         &quot;CREATE (t:Object {name: event.title})&quot;
}&#39;
```
For testing purposes it is actually just fine for me to create a node which inherits title-data from MongoDB for a neo4j name-property.

This is the message as displayed in kafkacat:

```
{
    &quot;_id&quot;: {&quot;_data&quot;: &quot;82608B06B9000000012B022C0100296E5A1004B52723604929469DA4FBB4F1CD6C528B46645F69640064608B06B9941B272EACC036740004&quot;},
    &quot;operationType&quot;: &quot;insert&quot;,
    &quot;clusterTime&quot;: {
        &quot;$timestamp&quot;: {
            &quot;t&quot;: 1619723961,
            &quot;i&quot;: 1
        }
    },
    &quot;fullDocument&quot;: {
        &quot;_id&quot;: {&quot;$oid&quot;: &quot;608b06b9941b272eacc03674&quot;},
        &quot;title&quot;: &quot;Titel 9&quot;
    },
    &quot;ns&quot;: {
        &quot;db&quot;: &quot;data&quot;,
        &quot;coll&quot;: &quot;test&quot;
    },
    &quot;documentKey&quot;: {
        &quot;_id&quot;: {&quot;$oid&quot;: &quot;608b06b9941b272eacc03674&quot;}
    }
}
```
However I can&#39;t get the title into neo4j. I tried also to set the cypher query in the sinkconfig to CREATE (t:Object) and it created an simple node with an Object-Label when I inserted data into mongoDB. So the connection kafka --&gt; neo4j seems to work. I also tried different ways to define the content for the name-property like event.title, event.fulldocument.title etc. etc. but nothing worked. Is there something I forgot in the sink configuration or some problem with the cypher query?

Thanks in advance:-)",1619775927,https://stackoverflow.com/q/67331701,Stefan,"['apache-kafka', 'mongodb', 'apache-kafka-connect', 'confluent-platform', 'neo4j']"
67330043,Data isolation by limiting access to subtrees in neo4j,"I have `Project1` and `Project2` as &#39;root nodes&#39; with subtrees that could reach depth less than 10 (no node has a shortest path to the root node greater than length 10), but each could include millions of nodes. `Project1` subtree and `Project2` subtree have no connections between them. If I have two neo4j users, `project1-user` and `project2-user`, is there a simple and efficient way to limit the privileges of `project1-user` to the `Project1` subtree (and likewise for `project2-user`)? Privileges would include ALL (write, read, etc).",1619768332,https://stackoverflow.com/q/67330043,Matt Murphy,['neo4j']
67324044,Neo4j label wont work if the label is &quot;Tag&quot;,"I am creating a set of nodes and would like to incorporate the concept of a Tag in Neo4j.  When I create a node and use the specific word &quot;Tag&quot; for the label, it never shows up with &quot;Tag&quot; as the label.  I can create the node exactly the same, but use a different word other than &quot;Tag&quot; and it will work.  This only happens with the word &quot;Tag&quot;, &quot;tag&quot;, &quot;TAG&quot;

```
create (a:Product{name:&#39;VirusScan Enterprise&#39;})
create (b:Product{name:&#39;Norton&#39;})
create (c:Vendor{name:&#39;Clam&#39;})
create (d:Vendor{name:&#39;McAfee&#39;})
create (e:Vendor{name:&#39;Symantec&#39;})
create (n:Tag{name:&#39;Antivirus&#39;})
```
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/fpUCd.png",1619725168,https://stackoverflow.com/q/67324044,user1496433,"['neo4j', 'tags', 'label']"
67315876,Adapt query to return correct results,"I have the bellow query. Here i  collect all rows and skills, Unwind rows as row and check that candidates skills are in all skills i want, i check that every skill related to this candidate is on the list of ALL skills i want.
I need to change somehow the query because i want the query return me Candidates only if &quot;Knows&quot; all required skills AND for every skill has the same or more years of experience.
In a nutshell, if a Candidate Knows all skills and for every skill has same or more years of experience, i want this node, otherwise no.
Any ideas?

```
WITH  [
        {entity_id: 7, years_of_experience: 5},
        {entity_id: 23776, years_of_experience: 1 },
        {entity_id: 17477, years_of_experience: 1 }
      ]  AS rows
UNWIND rows AS row
MATCH  (s:SkillNode)
  WHERE s.entity_id = row.entity_id
WITH  collect(row) as rows, collect(s) as allSkills, s
UNWIND rows as row
MATCH (c:CandidateNode)-[r:KNOWS]-&gt;(s)
  WHERE  (r.years_of_experience&gt;=row.years_of_experience AND s in allSkills)
WITH c, collect(distinct r) as rels, collect(distinct s) as skills, allSkills
  WHERE ALL(sk in allSkills where sk in skills)
RETURN skills, rels, c;
```
",1619693372,https://stackoverflow.com/q/67315876,Manos Nathanail,"['neo4j', 'cypher']"
67312281,Merge makes my computation very slow as compared to create in neo4j,"I ran two query in my desktop application, on same dataset(containing 20000 rows).

first:- 

    LOAD CSV with headers FROM &#39;file:///sample.csv&#39; AS row
    CREATE (n:MyNode{name:row.source})

second:-

    LOAD CSV with headers FROM &#39;file:///sample.csv&#39; AS row
    MERGE (n:MyNode{name:row.source})

Here CREATE is taking just 140 milli sec. while MERGE is taking about 90 second 
which is about 600 time slower. 

I have about 60 million rows and I need to create distinct node. Is there any suggestion, that I can use to decrease the execution time.",1619678843,https://stackoverflow.com/q/67312281,Vikrant chaudhary,"['cypher', 'graph-databases', 'neo4j']"
67311429,Neo4j Java Driver issue,"I am using the Neo4j Java driver 1.7.5 version and I unable to find how to pass the charset from java driver docs/blog. 

Please can you share how to pass the charset with the java driver?

Actually, I am having one issue with the Neo4j Java driver.

My spark job will create a couple of CSV&#39;s and persist them into HDFS. With Akka HTTP, I stream those files and run the load CSV Cypher queries. After some time I am getting the below error and unable to find the reason.

Here CSV&#39;s are partitioned into multiple files and these files contain a total of 53 million records.

```
ava.lang.RuntimeException: Exception while executing te following
neo4j query
USING PERIODIC COMMIT
LOAD CSV WITH HEADERS FROM
&quot;http://cdp-dn27.stg.iad1.ccmteam.com:7111/ingestion-files/part-00000-121ed02d-6ebf-4958-9e8e-bd7b4337bda4-c000.csv&quot;
AS param FIELDTERMINATOR &quot;|&quot;
MATCH (person1:Person {person_guid: param.user1}), (person2:Person
{person_guid: param.user2})
MERGE (person1)-[r:KNOWS]-(person2)
      SET r.last_tran_time = CASE WHEN toInteger(param.last_tran_date) &gt;
coalesce(r.last_tran_time, 0) THEN toInteger(param.last_tran_date) ELSE
r.last_tran_time END
SET r.first_tran_time = CASE WHEN toInteger(param.first_tran_date) &lt;
coalesce(r.first_tran_time, 9999999999) THEN
toInteger(param.first_tran_date) ELSE r.first_tran_time END
SET r.num_transactions = CASE WHEN EXISTS(r.num_transactions) THEN
r.num_transactions + toInteger(param.num_trans) ELSE
toInteger(param.num_trans) END

        at com.test.graphbuilder.dao.Neo4JDao.runQuery(Neo4JDao.scala:46)
        at
com.test.graphbuilder.service.DataUpdateService$$anonfun$2.apply(DataUpdateService.scala:37)
        at
com.test.graphbuilder.service.DataUpdateService$$anonfun$2.apply(DataUpdateService.scala:30)
        at scala.collection.immutable.List.map(List.scala:284)
        at
com.test.graphbuilder.service.DataUpdateService.updateData(DataUpdateService.scala:30)
        at
com.test.graphbuilder.service.GraphRefreshService$$anonfun$8.apply(GraphRefreshService.scala:49)
        at
com.test.graphbuilder.service.GraphRefreshService$$anonfun$8.apply(GraphRefreshService.scala:49)
        at scala.collection.immutable.List.map(List.scala:288)
        at
com.test.graphbuilder.service.GraphRefreshService.refreshGraph(GraphRefreshService.scala:49)
        at com.test.graphbuilder.KafkaTrigger$.main(KafkaTrigger.scala:22)
        at com.test.graphbuilder.KafkaTrigger.main(KafkaTrigger.scala)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at
org.apache.spark.deploy.yarn.ApplicationMaster$$anon$2.run(ApplicationMaster.scala:673)
Caused by: org.neo4j.driver.v1.exceptions.DatabaseException: Error
occured in read-ahead thread
        at org.neo4j.driver.internal.util.Futures.blockingGet(Futures.java:123)
        at
org.neo4j.driver.internal.InternalStatementResult.blockingGet(InternalStatementResult.java:134)
        at
org.neo4j.driver.internal.InternalStatementResult.consume(InternalStatementResult.java:117)
        at
com.test.graphbuilder.dao.Neo4JDao$$anonfun$runQuery$1$$anonfun$apply$2.apply(Neo4JDao.scala:33)
        at
com.test.graphbuilder.dao.Neo4JDao$$anonfun$runQuery$1$$anonfun$apply$2.apply(Neo4JDao.scala:31)
        at
com.test.graphbuilder.util.AutoClosableUtil$.autoClose(AutoClosableUtil.scala:6)
        at
com.test.graphbuilder.dao.Neo4JDao$$anonfun$runQuery$1.apply(Neo4JDao.scala:31)
        at
com.test.graphbuilder.dao.Neo4JDao$$anonfun$runQuery$1.apply(Neo4JDao.scala:30)
        at
com.test.graphbuilder.util.AutoClosableUtil$.autoClose(AutoClosableUtil.scala:6)
        at com.test.graphbuilder.dao.Neo4JDao.runQuery(Neo4JDao.scala:30)
        ... 15 more
        Suppressed: org.neo4j.driver.internal.util.ErrorUtil$InternalExceptionCause
                at
org.neo4j.driver.internal.util.ErrorUtil.newNeo4jError(ErrorUtil.java:72)
                at
org.neo4j.driver.internal.async.inbound.InboundMessageDispatcher.handleFailureMessage(InboundMessageDispatcher.java:105)
                at
org.neo4j.driver.internal.messaging.v1.MessageReaderV1.unpackFailureMessage(MessageReaderV1.java:83)
                at
org.neo4j.driver.internal.messaging.v1.MessageReaderV1.read(MessageReaderV1.java:59)
                at
org.neo4j.driver.internal.async.inbound.InboundMessageHandler.channelRead0(InboundMessageHandler.java:83)
                at
org.neo4j.driver.internal.async.inbound.InboundMessageHandler.channelRead0(InboundMessageHandler.java:35)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:105)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:284)
                at
org.neo4j.driver.internal.async.inbound.MessageDecoder.channelRead(MessageDecoder.java:47)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:297)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:413)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1389)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1159)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1203)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428)
                at
org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1414)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:945)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:146)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:580)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:497)
                at
org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459)
                at
org.neo4j.driver.internal.shaded.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886)
                at
org.neo4j.driver.internal.shaded.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
                at java.lang.Thread.run(Thread.java:748)
```

Thanks in advance. Please help me with this",1619673751,https://stackoverflow.com/q/67311429,Ravi,"['java', 'neo4j']"
67306206,Query Optimization for Parallel Connection in Neo4j Community Version,"I am evaluating the Neo4j Community version with data that have millions of nodes and relationships. I wrote a thread application to write data in parallel. Four threads are working parallelly and the total write time got reduced by 4 times but the number of nodes written to DB also got reduced by 4.

Seems like parallel writing is not happening. There are no dependencies between data running in each thread and it does not also throw an error.

It is behaving like this

 1. I write 100k nodes in 1 hour without threading
 2. I try to write 100k nodes with 4 threads. It is done in 15 minutes but I see only 25k nodes are written.

I have used `thread.join()` to wait for thread completion. I used Python.

**Update:**
I am adding below my query for the reference 
```

create (session:Session {session_id: &#39;session_id1&#39;})
;

match (s:Session) where s.session_id=&#39;session_id1&#39; with s
create (e1:Event {insert_id: &quot;insert_id1&quot;}) set e1:SeenPage
create (s)-[:CONTAINS]-&gt;(e1)
create (s)-[:FIRST_EVENT]-&gt;(e1)
merge (pp1:Properties {value: &quot;sample-url-1&quot;}) set pp1:Page merge (e1)-[:RELATED_TO]-&gt;(pp1)
merge (pp2:Properties {value: &quot;sp&quot;}) set pp2:Type merge (e1)-[:RELATED_TO]-&gt;(pp2)
;


match (e1:SeenPage) where e1.insert_id=&#39;insert_id1&#39; with e1
create (e2:Event {insert_id: &quot;insert_id2&quot;}) set e2:Show merge (e1)-[:NEXT]-&gt;(e2) with e2
match (s:Session) where s.session_id=&#39;session_id1&#39; with s, e2
create (s)-[:CONTAINS]-&gt;(e2)
merge (pp1:Properties {value: &quot;occasions&quot;}) set pp1:Category merge (e2)-[:RELATED_TO]-&gt;(pp1)
merge (pp2:Properties {value: &quot;sample-url-2&quot;}) set pp2:Page merge (e2)-[:RELATED_TO]-&gt;(pp2)
merge (pp3:Properties {value: &quot;pl&quot;}) set pp3:Type merge (e2)-[:RELATED_TO]-&gt;(pp3)
merge (pp4:Properties {value: &quot;child category&quot;}) set pp4:Sub_Category merge (e2)-[:RELATED_TO]-&gt;(pp4)
;


match (e2:Show) where e2.insert_id=&#39;insert_id2&#39; with e2
create (e3:Event {insert_id: &quot;insert_id3&quot;}) set e3:SeenPage merge (e2)-[:NEXT]-&gt;(e3) with e3
match (s:Session) where s.session_id=&#39;session_id1&#39; with s, e3
create (s)-[:CONTAINS]-&gt;(e3)
merge (pp1:Properties {value: &quot;/p-page-0&quot;}) set pp1:Page merge (e3)-[:RELATED_TO]-&gt;(pp1)
merge (pp2:Properties {value: &quot;sp&quot;}) set pp2:Type merge (e3)-[:RELATED_TO]-&gt;(pp2)
;


match (e3:SeenPage) where e3.insert_id=&#39;insert_id3&#39; with e3
create (e4:Event {insert_id: &quot;insert_id4&quot;}) set e4:Show merge (e3)-[:NEXT]-&gt;(e4) with e4
match (s:Session) where s.session_id=&#39;session_id1&#39; with s, e4
create (s)-[:CONTAINS]-&gt;(e4)
merge (pp1:Properties {value: &quot;rect1&quot;}) set pp1:Category merge (e4)-[:RELATED_TO]-&gt;(pp1)
merge (pp2:Properties {value: &quot;/p-page-1&quot;}) set pp2:Page merge (e4)-[:RELATED_TO]-&gt;(pp2)
merge (pp3:Properties {value: &quot;pl&quot;}) set pp3:Type merge (e4)-[:RELATED_TO]-&gt;(pp3)
merge (pp4:Properties {value: &quot;him&quot;}) set pp4:Sub_Category merge (e4)-[:RELATED_TO]-&gt;(pp4)
;


match (e4:Show) where e4.insert_id=&#39;insert_id4&#39; with e4
create (e5:Event {insert_id: &quot;insert_id5&quot;}) set e5:SeenPage merge (e4)-[:NEXT]-&gt;(e5) with e5
match (s:Session) where s.session_id=&#39;session_id1&#39; with s, e5
create (s)-[:CONTAINS]-&gt;(e5)
merge (pp1:Properties {value: &quot;/p-page-2&quot;}) set pp1:Page merge (e5)-[:RELATED_TO]-&gt;(pp1)
merge (pp2:Properties {value: &quot;sp&quot;}) set pp2:Type merge (e5)-[:RELATED_TO]-&gt;(pp2)
;

```


This data represents the journey of a user on a website. The user starts a session and browses the pages. The action done by the user is recorded as the event. Each event has its unique id. Then the sequence of events is connected with the relationship `:NEXT` and `CONTAINS`. Events are not unique that&#39;s why I had to use `create` not `merge`. Properties of events are unique and these are created as nodes then added with a relationship `RELATED_TO`.

It&#39;s like this
```
#session contains events 
#events are connected with :next

Session-[:CONTAINS]-&gt;(Event1)-[:NEXT]-(Event2)&lt;-[:CONTAINS]-Session

```

A session can contain 100s of events. The current speed of writing is quite slow. It is writing 10k sessions data in 4 hours. Each session contains on average 10 events. I am writing data event by event using a python bolt connector.

Any help would be really appreciated.


",1619635722,https://stackoverflow.com/q/67306206,Rheatey Bash,"['neo4j-python-driver', 'neo4j-apoc', 'neo4j']"
67304191,"Neo4j, How can I compare dates that stored as strings?","I have a date in my Neo4j database that is `9-03-2021` and this date is stored as a string in Neo4j, how would I compare that this date for example is `&lt;= 9-05-2021` ?

I am basically trying to return all nodes in my database where the date field is &lt;= a certain date, or &gt;= a certain date, where these dates are stored as strings, 

thank you",1619627243,https://stackoverflow.com/q/67304191,benwasin97,"['neo4j', 'cypher']"
67299121,All simple (cyclic) paths query returns too much data -&gt; heap overflow,"I am quite new to Neo4j and using the Neo4j desktop version with the Javascript driver. My graph has about 30.000 nodes and 40.000 edges. The final approach would be to get all simple cycles in the graph but I am facing a heap overflow while trying to execute the following cypher query:

    let res = await session.run(&#39;MATCH p=(n)-[*2..4]-(n) RETURN nodes(p)&#39;)

This is of course because the query tries to return all the simple cycles found which is way to much for my heap and unhappily increasing the memory for node.js isn&#39;t an option. 

So is there any way I could bypass this problem and get all simple cycles from the graph? 

Here is the heap overflow error I got:

    /Users/paulus/.nvm/versions/node/v15.10.0/bin/node /Users/paulus/routeplanner/RouteFinder.js
    
    &lt;--- Last few GCs ---&gt;
    
    [39630:0x104e00000]   227813 ms: Scavenge (reduce) 2033.5 (2077.9) -&gt; 2032.1 (2072.1) MB, 113.5 / 0.0 ms  (average mu = 0.577, current mu = 0.321) allocation failure 
    [39630:0x104e00000]   228171 ms: Scavenge (reduce) 2036.5 (2072.6) -&gt; 2035.5 (2075.6) MB, 28.6 / 0.0 ms  (average mu = 0.577, current mu = 0.321) allocation failure 
    [39630:0x104e00000]   228558 ms: Scavenge (reduce) 2039.1 (2075.6) -&gt; 2038.5 (2080.4) MB, 28.2 / 0.0 ms  (average mu = 0.577, current mu = 0.321) allocation failure 
    
    
    &lt;--- JS stacktrace ---&gt;
    
    
    &lt;--- Last few GCs ---&gt;
    
    [39630:0x104e00000]   227813 ms: Scavenge (reduce) 2033.5 (2077.9) -&gt; 2032.1 (2072.1) MB, 113.5 / 0.0 ms  (average mu = 0.577, current mu = 0.321) allocation failure 
    [39630:0x104e00000]   228171 ms: Scavenge (reduce) 2036.5 (2072.6) -&gt; 2035.5 (2075.6) MB, 28.6 / 0.0 ms  (average mu = 0.577, current mu = 0.321) allocation failure 
    [39630:0x104e00000]   228558 ms: Scavenge (reduce) 2039.1 (2075.6) -&gt; 2038.5 (2080.4) MB, 28.2 / 0.0 ms  (average mu = 0.577, current mu = 0.321) allocation failure 
    
    
    &lt;--- JS stacktrace ---&gt;
    
    FATAL ERROR: MarkCompactCollector: young object promotion failed Allocation failed - JavaScript heap out of memory
    FATAL ERROR: MarkCompactCollector: young object promotion failed Allocation failed - JavaScript heap out of memory
    
    &lt;--- Last few GCs ---&gt;
    
    [39630:0x104e00000]   227813 ms: Scavenge (reduce) 2033.5 (2077.9) -&gt; 2032.1 (2072.1) MB, 113.5 / 0.0 ms  (average mu = 0.577, current mu = 0.321) allocation failure 
    [39630:0x104e00000]   228171 ms: Scavenge (reduce) 2036.5 (2072.6) -&gt; 2035.5 (2075.6) MB, 28.6 / 0.0 ms  (average mu = 0.577, current mu = 0.321) allocation failure 
    [39630:0x104e00000]   228558 ms: Scavenge (reduce) 2039.1 (2075.6) -&gt; 2038.5 (2080.4) MB, 28.2 / 0.0 ms  (average mu = 0.577, current mu = 0.321) allocation failure 
    
    
    &lt;--- JS stacktrace ---&gt;
    
    FATAL ERROR: MarkCompactCollector: young object promotion failed Allocation failed - JavaScript heap out of memory
    
    Process finished with exit code 139 (interrupted by signal 11: SIGSEGV)",1619608290,https://stackoverflow.com/q/67299121,Paulus,"['neo4j-desktop', 'cypher', 'neo4j', 'node.js', 'neo4j-driver']"
67294891,Add description or comment to Labels/Relationships,"Is there a way to add a description to the Node Labels and Relationships, like adding a comment to the Postgres table columns 

    comment on column session_log.userid is &#39;The user ID&#39;;
    comment on column session_log.phonenumber is &#39;The phone number including the area code&#39;;

This is to document some metadata about the graph. I have looked around and didn&#39;t find anything yet. 

Thanks in advance. ",1619591575,https://stackoverflow.com/q/67294891,Somasundaram Sekar,['neo4j']
67289546,python asking me for installed modules,"I&#39;m trying to use a python 3 script that requires the &quot;neo4j&quot; module. I already installed the module in python 3, but when try to run the script again, it keeps asking for the module.

When try to run the program that requires neo4j module:

    c:\Users\user1\Downloads\PlumHound-master&gt;python3 PlumHound.py -h
    Traceback (most recent call last):
      File &quot;PlumHound.py&quot;, line 12, in &lt;module&gt;
        import lib.phTasks
      File &quot;c:\Users\user1\Downloads\PlumHound-master\lib\phTasks.py&quot;, line 12, in &lt;module&gt;
        from neo4j import GraphDatabase
    ModuleNotFoundError: No module named &#39;neo4j&#39;

When I try to install the module:

    c:\Users\user1\Downloads\PlumHound-master&gt;python3 -m pip install neo4j
    Requirement already satisfied: neo4j in c:\users\user1\downloads\plumhound-master (4.2.1)
    Requirement already satisfied: pytz in c:\users\user1\appdata\local\programs\python\python38-32\lib\site-packages (from neo4j) (2021.1)


Does anyone know or have an idea about why this might be happening, and how I can fix it? PD: The device is offline and i installed the module manually with pip.",1619551983,https://stackoverflow.com/q/67289546,Richard,"['neo4j', 'python-3.x', 'pip', 'python', 'python-2.7']"
67288569,WHY DOES neo4j EXPLAIN show thousands of rows with a filter DISTINCT node that is unique?,"This does not happen all the time, but with the exact same dbase (and perhaps different node search), my EXPLAIN keeps showing thousands of rows where I would just expect one. Am I missing something?

eg:
```
EXPLAIN MATCH (node:Label) 
WHERE node.UniqueID=1 
WITH DISTINCT node  
RETURN node
```

[![Explain Flow][1]][1]

There are 11000 record with that label, and that shows a correct start.
But then the filter narrows down to 1,105 which makes no sense.
And the DISTINCT narrows down to 1,105 which also makes no sense.

When I run the query, I just get my one unique node. When I run the explain, it shows 1105 rows as result. Why the discrepency? I&#39;ve noticed when this happens that everything downstream stalls so I think Query is doing more work than it needs to but I&#39;m not sure why.  I&#39;d be most grateful for pointers to a resource that explains this better.

TIA!!


  [1]: https://i.stack.imgur.com/gn2oq.png",1619547451,https://stackoverflow.com/q/67288569,Stephanie,['neo4j']
67287695,Neo4J - Get filtered results based on some property that does not exist,"There are `product`s that can have multiple `ProductImage`s. I want to fetch a product (given its ID) and its associated images based on an image property `isUseful`. Only those images should be fetched which do not have the `isUseful` property available. I have this query:


    MATCH (product:Product)
          WHERE product.id = $productId    
          RETURN product{
            .*,
            images: [(product)&lt;-[:BELONGSTO]-(image:ProductImage {isUseful: null}) | image{.*}]
    }

This query does not return any results. But there are records in the database. Please note that I can only change what is written inside the `return` block. Nothing else can be changed.
",1619543539,https://stackoverflow.com/q/67287695,Bishwajit Purkaystha,"['cypher', 'neo4j']"
67281780,find maximum weight edge connected to any specific node in neo4j,"   
    MATCH (d:domain) 
    WITH COLLECT(d) AS domains
    UNWIND domains AS d1
    UNWIND domains AS d2
    WITH d1,d2
    WHERE id(d1) &lt; id(d2) and d1.name=&#39;google&#39;
    MATCH (d1)-[r:domain_join]-(d2)
    
           //where r.weight is max // I want something like this (I am stuck at this line)
    
    return d1.name,d2.name,r.weight;

The output I am getting is [![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/N0Pce.png


The output I want is the single row having the maximum weight",1619521308,https://stackoverflow.com/q/67281780,Vikrant chaudhary,"['neo4j', 'graph-databases', 'cypher']"
67277549,Neo4j &quot;Tried to execute Write query after executing Schema modification&quot; Error,"I&#39;m using the latest version of Neo4j and the Java driver and keep getting the following error with my code: 

&gt; Exception in thread &quot;main&quot; org.neo4j.driver.exceptions.ClientException: Tried to execute Write query after executing Schema modification

And here&#39;s my code: 

    import org.neo4j.driver.*;
    
    public class HelloWorldExample implements AutoCloseable
    {
        private final Driver driver;
    
        public HelloWorldExample( String uri, String user, String password )
        {
            driver = GraphDatabase.driver( uri, AuthTokens.basic( user, password ) );
        }
    
        @Override
        public void close() throws Exception
        {
            driver.close();
        }
    
        public void printGreeting( final String message )
        {
            try ( Session session = driver.session() )
            {
                String greeting = session.writeTransaction( new TransactionWork&lt;String&gt;()
                {
                    @Override
                    public String execute( Transaction tx )
                    {
                      //ISSUE HERE
                        String test = &quot;CREATE INDEX qwert IF NOT EXISTS FOR (m:Pode) ON (m.made)&quot;;
                        Result hello = tx.run(test);
                        String test2 = &quot;CREATE(n:Node)&quot;;
                        Result hello2 = tx.run(test2);
                     //ISSUE ABOVE
                        return &quot;&quot;;
                  //      return result.single().get( 0 ).asString();
                    }
                } );
                System.out.println( greeting );
            }
        }
    
        public static void main( String... args ) throws Exception
        {
            try ( HelloWorldExample greeter = new HelloWorldExample( &quot;bolt://localhost:7687&quot;, &quot;neo4j&quot;, &quot;Neo4J&quot; ) )
            {
                greeter.printGreeting( &quot;hello, world&quot; );
            }
        }
    }


I know the error is happening at the &quot;ISSUE HERE&quot; part, and if I remove either of the &quot;CREATE&quot; lines, it goes away, but I need both lines, and not sure how to proceed. Any help is appreciated!",1619502277,https://stackoverflow.com/q/67277549,mythik,"['driver', 'database', 'neo4j', 'java']"
67269437,Is it possible to &#39;repeat&#39; a pattern of more than one hop in Cypher?,"Imagine that there are two kinds of relations in a graph: `:A` and `:B`. There are patterns like `(n1)-[:A]-&gt;(n2)-&gt;[:B]-&gt;(n3)-&gt;[:A]-&gt;(n4)-&gt;[:B]-&gt;(n5)-&gt;...`. Here I only show 2 repetitions of this &#39;`:A`, then `:B`&#39; pattern, but it could be repeated to arbitrary depth. It could be interesting to query for something like &#39;start with node X, then follow this A+B pattern as far as you can, then take the resulting node Y&#39;.

In `Gremlin`, one can use `repeat` step to implement such a query.

In Cypher, there are variable length patterns https://neo4j.com/docs/cypher-manual/current/syntax/patterns/#cypher-pattern-varlength , so we could write something like `(x)-[:A*]-&gt;(y)` for a simple repetition pattern where we just repeat one hop.

But could we do the same for a more complex pattern (like the one I described, the A+B pattern)?

I found this https://stackoverflow.com/questions/56057616/repetitive-pattern-of-relationships-in-cypher where they recommend using a procedure, but it&#39;s not pure Cypher (and it&#39;s a non-standard extension by Neo4J not available in other systems implementing Cypher).",1619450719,https://stackoverflow.com/q/67269437,Roman Puchkovskiy,"['cypher', 'neo4j']"
67267921,cypher remove null s from result,"I&#39;ve created a query in neo4j :
```
MATCH (x:Node)-[r*1..2]-&gt;(y:Node) 
WITH x AS x, SIZE(COLLECT(DISTINCT y)) AS y
WITH CASE
	WHEN y=10 THEN x.target
END AS l
return l AS target
```
But returns something like :
```
target
____
null
null
&quot;test1&quot;
null
null
&quot;tes56&quot;
...
```
What I want is :
```
target
____
&quot;test1&quot;
&quot;tes56&quot;
...
```
no null in entries. How can I achieve this ?",1619444994,https://stackoverflow.com/q/67267921,Maifee Ul Asad,"['cypher', 'neo4j', 'cypher-3.1']"
67260074,How to replace values for a certain attribute in Neo4j with a csv file,"Hi right now I have a model in Neo4j DB like this:
Person{ID, Name, Age, Major, Department}

Now I&#39;d like to replace Major with Marjor_Text column in a csv file.

May I use Kettle or Neo4j to realize it?
If I&#39;m using Neo4j, I have this script:
LOAD CSV WITH HEADERS FROM &quot;file:///file.csv&quot; AS test
SET Person.Marjor = test.Marjor_text",1619403585,https://stackoverflow.com/q/67260074,Momoe,"['neo4j', 'kettle', 'neo4j-apoc']"
67256233,Make all to all relationship among the element present in list in neo4j,"https://community.neo4j.com/t/make-all-to-all-relationship-among-the-element-present-in-list/37390
here is the link of same question

I have csv file with two column as source and target.
I need to make all to all relationship between all the element in the target column of each respective source.

here is my query, I am not able to make all to all relationship.

    LOAD CSV with headers FROM &#39;file:///sample.csv&#39; AS row
    
    unwind (split(row.target,&#39;|&#39;))  as target
    
    merge (n:MyNode{name:row.source})
    merge (m:MyNode{name:target})
    merge (m) -[:TO{weight:row.weight}]-&gt;(n)
    
    merge (m) -[:r]-(m)  // not sure about this line

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/dBdZL.png",1619371282,https://stackoverflow.com/q/67256233,Vikrant chaudhary,"['neo4j', 'cypher']"
67247416,How to divide the dependency of a node related with two different nodes in neo4j?,"I have a model in Graph theory of Movies and Actors. The relation between the two is &quot;requires&quot;. The graph is shown below. A and B are Movies. 1,2,3,4,5,6 are actors. Movie A requires 1,2,3,4 actors. Movie B requires 4,5,6 actors. We can see that 4 is shared among both movies.

Current Query:
```
MATCH (m :Movie) -[r :require]-&gt; (a :actor)
RETURN m,r,a;
```

```
Current Output
```

[![Current Output][1]][1]

```
Expected Output
```
I want to display something as below. Here  actor 4 is shown once for each movie. Can someone help me fix this ?

[![Expected Output][2]][2]


  [1]: https://i.stack.imgur.com/ndHBg.png
  [2]: https://i.stack.imgur.com/HFUPy.png",1619298332,https://stackoverflow.com/q/67247416,Shreya B,"['neo4j-browser', 'neo4j', 'graph-theory']"
67231787,Multiple INDEX HINTS in optional match neo4j,"I have a label, &quot;Customer&quot; which has two indices, let&#39;s say they&#39;re &quot;FullName&quot; and &quot;CustomerId&quot;

Currently, I am working on a query like this:

```
 OPTIONAL MATCH(o:Orders)-[:ORDERED_BY]-&gt;(c:Customer { CustomerId: &#39;12345&#39; })
     USING INDEX c: Customer(CustomerId)
```

This is working well. But if I want to use both indices, I tried using this query:

```
 OPTIONAL MATCH(o:Orders)-[:ORDERED_BY]-&gt;(c:Customer)
     USING INDEX c: Customer(CustomerId)
     USING INDEX c: Customer(FullName)
          WHERE (c.CustomerId = &#39;12345&#39; OR c.FullName = &#39;John Doe&#39;)
```

Neo4j returns &quot;Multiple hints for same variable are not supported&quot;

Another variation that I tried is this:

```
// I just used one index, ergo the &quot;priority&quot; index
 OPTIONAL MATCH(o:Orders)-[:ORDERED_BY]-&gt;(c:Customer)
     USING INDEX c: Customer(CustomerId)
          WHERE (c.CustomerId = &#39;12345&#39; OR c.FullName = &#39;John Doe&#39;)
```


Neo4j returns &quot;Failed to fulfil the hints of the query&quot;. 


I am looking that the issue might be in the index hints. I have checked that multiple index hints issue is [fixed in neo4j 3.3][1] (the version I am currently using) but I can&#39;t find the exact syntax maybe to be able to use these two indices as hints

Neo4j version: 3.3


  [1]: https://github.com/neo4j/neo4j/pull/9462",1619188072,https://stackoverflow.com/q/67231787,Patrick,"['cypher', 'neo4j']"
67230413,How to sync postgres database with neo4j in realtime while using Django-admin?,So currently I am working on a Django project where I have two different databases. one is PostgreSQL and the second is Neo4j. what I want is real-time sync between both databases. I am using the Django-admin panel for crud operation in the Postgres database. now I want every crud operation update in the neo4j database also. but I don&#39;t know how to do it.,1619182790,https://stackoverflow.com/q/67230413,Meet,"['django-admin', 'neo4j', 'django', 'database', 'postgresql']"
67229158,Unable to import Match and Create from NeoAlchemy,"I am trying to use NeoAlchemy python package for interacting with Neo4j.
However, I find that some of the imports simply dont work, even though it should, as per the [official documentation][1] 

    from neoalchemy import Match

    ---------------------------------------------------------------------------
    ImportError                               Traceback (most recent call last)
    &lt;ipython-input-13-6a8988427f14&gt; in &lt;module&gt;
    ----&gt; 1 from neoalchemy import Match
    
    ImportError: cannot import name &#39;Match&#39;

The same happens when I try to import Create.

However, it is not that nothing works.
Below code works perfectly fine.

    from neoalchemy import Graph
    graph = Graph(password=&#39;&lt;password&gt;&#39;)

I think I am missing something, but can not figure out what exactly. Any pointers / help will be greatly appreciated.

  [1]: https://neoalchemy.readthedocs.io/en/latest/query-builder.html#create
  [2]: https://i.stack.imgur.com/XyWwf.png",1619177396,https://stackoverflow.com/q/67229158,Moni,"['neo4j', 'python']"
67210208,How to return the node ID in py2neo (Neo4J &amp; Python),"Currently working with Py2neo to access my Neo4J database. 

I have trouble with returning a node id. I already went through the documentation of Py2neo and read multiple StackOverflow posts but none of them contains a solid answer to my question. I think more people could use this solution.

I&#39;m able to locate the node using NodeMatcher

    from py2neo import Graph, NodeMatcher
    from py2neo import Node, Relationship
    
    graph = Graph(&quot;bolt://localhost:7687&quot;)
    matcher = NodeMatcher(graph)
    
    find_ingredient = matcher.match(&quot;Ingredient&quot;, name=&quot;Onion&quot;).first()
    print(find_ingredient)
    &gt;&gt;&gt; (_6:Ingredient {name: &#39;Onion&#39;})

How can I extract the Node ID (_6)?


The desired output would be

    print(find_ingredient)
    &gt;&gt;&gt; 6 

(_6 is also fine) 

___________________________________________________________

Second approach: I&#39;ve added a property called &#39;ing_id&#39;

    ingredient = graph.run(&quot;MATCH (n:Ingredient {name:&#39;Ui&#39;}) WHERE n.name=&#39;Ui&#39; RETURN n&quot;)
    data = ingredient.data()
    print(data)
    &gt;&gt;&gt;[{&#39;n&#39;: Node(&#39;Ingredient&#39;, ing_id=1, name=&#39;Ui&#39;)}]

The desired output would be

    print(ing_id)
    &gt;&gt;&gt; 1 

What code do I need to add to achieve this? 
Or is there an alternative (or better approach) to easily return the node id?

Help is much appreciated 

",1619082507,https://stackoverflow.com/q/67210208,T. de Jong,"['python', 'py2neo', 'neo4j']"
67207739,neo4j query an array field that has at least one item in the list,"I want to query a list with a list
```
 p = [&#39;Author-1&#39;, Author-2, Author-2]
 a = [&#39;Author-1&#39;, Author-2]
 b = [&#39;Author-1&#39;, Author-2, Author-3, Author-4]
 c = [&#39;Author-4&#39;, Author-5, Author-6, Author-7]
 d = [&#39;Author-5&#39;, Author-6, Author-7, Author-8]
```
using p, if one of the lists has at least author1 or author2 return it. 

```
WITH p, a, b, c
UNWIND p
WITH DISTINCT p
MATCH (p)
with b as book, collect(g) as genre
WHERE genre in b.genre
return book.isbn, genre
```


my real example returns nothing, the genre is like p in the example above and b.genre is like b,c,d,e
the `WHERE genre in b.genre` is not working properly
```
MATCH (c:Customer { name : &quot;Andrei Balanuta&quot; })-[:CLIENT]-(o:Order)-[ol:ORDERLINE]-(b:Book)
UNWIND b.genre as  g
WITH DISTINCT g
MATCH (b:Book)
with b as book, collect(g) as genre
WHERE genre in b.genre
return book.isbn, genre
```",1619072220,https://stackoverflow.com/q/67207739,Brat,"['nosql', 'cypher', 'database', 'neo4j']"
67203528,Error while reading from neo4j into spark,"I follow the steps in (https://neo4j.com/developer/spark/quickstart/) and use the following package:

    $SPARK_HOME/bin/spark-shell --packages neo4j-contrib:neo4j-connector-apache-spark_2.12:4.0.1_for_spark_3

Now, in spark shell, when I try to execute this (mentioned in the same site):

    import org.apache.spark.sql.{SaveMode, SparkSession}
    
    val spark = SparkSession.builder().getOrCreate()
    
    val df = spark.read.format(&quot;org.neo4j.spark.DataSource&quot;)
    .option(&quot;url&quot;, &quot;bolt://localhost:7687&quot;)
    .option(&quot;authentication.basic.username&quot;, &quot;neo4j&quot;)
    .option(&quot;authentication.basic.password&quot;, &quot;neo4j&quot;)
    .option(&quot;labels&quot;, &quot;Person&quot;)
    .load()

The following error occur:

**java.lang.NoClassDefFoundError: org/apache/spark/sql/sources/v2/ReadSupport**

What shall I do to fix the problem?
",1619039370,https://stackoverflow.com/q/67203528,Sama,"['connection', 'neo4j', 'apache-spark']"
67199988,How to find a node quick in Neo4J 3.3.9 - cypher query optimization,"I have the following Neo4J [DB model][1]:

[![enter image description here][2]][2]


I need to be able to find a node of the type `Concept` called &quot;idea&quot; made by the user `infranodus` and see which nodes of the type `Context` it is connected to.

I use the following query, but it&#39;s taking too long and doesn&#39;t even load...

```
MATCH (ctx:Context)-[:BY]-&gt;(u:User{name:&#39;infranodus&#39;}) 
WITH DISTINCT ctx 
MATCH (c:Concept{name:&#39;idea&#39;})-[:AT]-&gt;(ctx)&lt;-[:AT]-(cn:Concept) 
RETURN DISINCT c, ctx, count(cn);
```

How to fix it?


  [1]: https://github.com/noduslabs/graphdbmodel
  [2]: https://i.stack.imgur.com/aT8zg.png",1619023049,https://stackoverflow.com/q/67199988,Aerodynamika,"['cypher', 'neo4j']"
67199636,neo4j sum rows with identical fields,"    MATCH (b:Book)&lt;-[ol:ORDERLINE]-()
    UNWIND b.genre as genre
    RETURN genre, ol.amount

gives this result 

    │&quot;genre&quot;   │&quot;ol.amount&quot;│
    │&quot;Genre-1&quot; │1          
    │&quot;Genre-3&quot; │1
    │&quot;Genre-1&quot; │2  
    │&quot;Genre-10&quot;│2          
    │&quot;Genre-1&quot; │5          
    │&quot;Genre-10&quot;│5  

and I want this output 


    │&quot;genre&quot;   │&quot;ol.amount&quot;
    │&quot;Genre-1&quot; │8          
    │&quot;Genre-3&quot; │1
    │&quot;Genre-10&quot;│7   

       

",1619021759,https://stackoverflow.com/q/67199636,Brat,"['aggregate', 'neo4j', 'sum', 'nosql']"
67191594,Get the shortest path from certain node to ANY node of a given label in Neo4J,"I have a node, let&#39;s call it X. I wanna find the closest node to X, let&#39;s name it Y and Y has to have a certain label. If there are multiple such Y nodes at the same distance to X, I&#39;d like them all to be returned 

Suppose we have nodes A and B of a certain label. The minimum path length from X to A is 3 and from X to B is 5. I want it to return A and only A. If the minimum path length is equal, I&#39;d like it to return both of them (both A and B)

Here&#39;s what I have so far :

    MATCH p=shortestPath((selectedNode {name:&#39;X&#39;})-[*]-(y:GivenLabel))
    WITH y.name as y, length(p)=min(length(p)) AS l
    RETURN y

The problem of this query is that it returns both A and B in the above example, no matter what the minimum path to each one of them is. I thought about using LIMIT 1 and ordering them but then it&#39;ll only display one of them, even if the minimum path length to each one of them is equal

Thanks in advance!",1618991907,https://stackoverflow.com/q/67191594,Jerome Durham,['neo4j']
67174486,Problem in running rake neo4j:migrate with neo4j.rb,"When I run `rake neo4j:migrate` with the neo4j.rb project (comprising of `gem &#39;activegraph&#39;, &#39;~&gt; 10.0.1&#39;` and `gem &#39;neo4j-ruby-driver&#39;, &#39;~&gt; 1.7.0&#39;`), I am getting the following error:

    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/neo4j-9.6.2/lib/neo4j/tasks/migration.rake:51: warning: already initialized constant SCHEMA_YAML_PATH
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/activegraph-10.0.2/lib/active_graph/tasks/migration.rake:49: warning: previous definition of SCHEMA_YAML_PATH was here
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/neo4j-9.6.2/lib/neo4j/tasks/migration.rake:52: warning: already initialized constant SCHEMA_YAML_COMMENT
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/activegraph-10.0.2/lib/active_graph/tasks/migration.rake:50: warning: previous definition of SCHEMA_YAML_COMMENT was here
    ** Invoke neo4j:migrate (first_time)
    ** Execute neo4j:migrate
    ** Invoke neo4j:migrate:all (first_time)
    ** Invoke neo4j:allow_migrations (first_time)
    ** Execute neo4j:allow_migrations
    ** Invoke environment (first_time)
    ** Execute environment
    ** Execute neo4j:migrate:all
    ** Invoke neo4j:schema:dump (first_time)
    ** Invoke environment 
    ** Execute neo4j:schema:dump
    rake aborted!
    No session defined!
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/neo4j-9.6.2/lib/neo4j/active_base.rb:9:in `block in current_session&#39;
    &lt;internal:kernel&gt;:90:in `tap&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/neo4j-9.6.2/lib/neo4j/active_base.rb:8:in `current_session&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/neo4j-9.6.2/lib/neo4j/tasks/migration.rake:68:in `check_neo4j_version_3&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/activegraph-10.0.2/lib/active_graph/tasks/migration.rake:75:in `block (3 levels) in &lt;main&gt;&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:281:in `block in execute&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:281:in `each&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:281:in `execute&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:219:in `block in invoke_with_call_chain&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:199:in `synchronize&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:199:in `invoke_with_call_chain&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:188:in `invoke&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/activegraph-10.0.2/lib/active_graph/tasks/migration.rake:119:in `block (3 levels) in &lt;main&gt;&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:281:in `block in execute&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:281:in `each&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:281:in `execute&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:219:in `block in invoke_with_call_chain&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:199:in `synchronize&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:199:in `invoke_with_call_chain&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:188:in `invoke&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/activegraph-10.0.2/lib/active_graph/tasks/migration.rake:44:in `block (2 levels) in &lt;main&gt;&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:281:in `block in execute&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:281:in `each&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:281:in `execute&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:219:in `block in invoke_with_call_chain&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:199:in `synchronize&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:199:in `invoke_with_call_chain&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/task.rb:188:in `invoke&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/application.rb:160:in `invoke_task&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/application.rb:116:in `block (2 levels) in top_level&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/application.rb:116:in `each&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/application.rb:116:in `block in top_level&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/application.rb:125:in `run_with_threads&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/application.rb:110:in `top_level&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/application.rb:83:in `block in run&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/application.rb:186:in `standard_exception_handling&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/lib/rake/application.rb:80:in `run&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/lib/ruby/gems/3.0.0/gems/rake-13.0.3/exe/rake:27:in `&lt;top (required)&gt;&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/bin/rake:23:in `load&#39;
    /Users/sanjaysingh/.rbenv/versions/3.0.0/bin/rake:23:in `&lt;main&gt;&#39;
    Tasks: TOP =&gt; neo4j:schema:dump
Could it be because of a change I made to a migration file I had already run? I have rebooted the system, restarted neo4j server, but nothing works. Is there a way to regenerate the schema file from scratch by deleting some old migrations? Thanks in advance.",1618904354,https://stackoverflow.com/q/67174486,Sanjay Singh,"['rails-migrations', 'neo4j', 'neo4j.rb', 'ruby-on-rails']"
67172075,How to change color of edges by Neovis,"I am trying to change color of edges of gene_gene relationship by Neovis but nothing happened.
My config codes are belowing, I want to change the edges of gene_gene relationship in Neovis and I am trying to set &quot;color&quot;:&quot;#F4606C&quot; but failed. I wanna to ask how to change displayed color for edges in Neovis?

    var sid = $(&quot;#inferred_title_name&quot;).val();
    var config = {
        container_id: &quot;viz_gene&quot;,
        server_url: &quot;bolt://localhost:7687&quot;,
        server_user: &quot;neo4j&quot;,
        server_password: &quot;lucas&quot;,
        // arrows: true,
        initial_cypher: &quot;MATCH (g1:Gene)-[r1]-(s1:Symptom) where s1.SymptomId=\&quot;&quot;+sid+&quot;\&quot; optional match (g1)-[r2]-(g2:Gene)-[r3]-(s1) RETURN *&quot;,
        labels: {
            &quot;Symptom&quot;: {
                caption: &quot;SymptomId&quot;,
                size: 1,
                community: &quot;community&quot;,
                image: &#39;../static/images/sym.png&#39;,
                &quot;font&quot;: {
                    &quot;size&quot;:10,
                    &quot;color&quot;:&quot;#000000&quot;
                    }
                },
            &quot;Disease&quot;: {
                caption: &quot;DiseaseId&quot;,
                size: &quot;degree&quot;,
                community: &quot;community&quot;,
                image: &#39;../static/images/dis.png&#39;,
                &quot;font&quot;: {
                    &quot;size&quot;:10,
                    &quot;color&quot;:&quot;#000000&quot;
                    }
                },
            &quot;Gene&quot;: {
                caption: &quot;GeneId&quot;,
                size: &quot;degree&quot;,
                community: &quot;community&quot;,
                image: &#39;../static/images/gene.png&#39;,
                &quot;font&quot;: {
                    &quot;size&quot;:10,
                    &quot;color&quot;:&quot;#000000&quot;
                    }
                },
            &quot;Drug&quot;: {
                caption: &quot;DrugId&quot;,
                size: &quot;degree&quot;,
                community: &quot;community&quot;,
                image: &#39;../static/images/drug.png&#39;,
                &quot;font&quot;: {
                    &quot;size&quot;:10,
                    &quot;color&quot;:&quot;#000000&quot;
                    }
                }
            },
        relationships: {
            &quot;Symptom_Disease&quot;: {
                caption: &quot;false&quot;,
                thickness: &quot;count&quot;,
                &quot;font&quot;: {
                    &quot;size&quot;:10,
                    &quot;color&quot;:&quot;#000000&quot;
                }
            },
            &quot;Symptom_Drug&quot;: {
                caption: &quot;false&quot;,
                thickness: &quot;count&quot;,
                &quot;font&quot;: {
                    &quot;size&quot;:10,
                    &quot;color&quot;:&quot;#000000&quot;
                }
            },
            &quot;Disease_Drug&quot;: {
                caption: &quot;false&quot;,
                thickness: &quot;count&quot;,
                &quot;font&quot;: {
                    &quot;size&quot;:10,
                    &quot;color&quot;:&quot;#000000&quot;
                }
            },
            &quot;Symptom_Gene&quot;: {
                caption: &quot;false&quot;,
                thickness: &quot;count&quot;,
                &quot;font&quot;: {
                    &quot;size&quot;:10,
                    &quot;color&quot;:&quot;#000000&quot;
                },
                &quot;line&quot;:{
                    &quot;color&quot;:&quot;#FD978F&quot;
                }
            },
            &quot;Gene_Gene&quot;: {
                caption: &quot;false&quot;,
                thickness: &quot;count&quot;,
                &quot;font&quot;: {
                    &quot;size&quot;:10,
                    &quot;color&quot;:&quot;#000000&quot;
                },
                &quot;color&quot;:&quot;F4606C&quot;
            },
            &quot;Drug_Drug&quot;: {
                caption: &quot;false&quot;,
                thickness: &quot;count&quot;,
                &quot;font&quot;: {
                    &quot;size&quot;:10,
                    &quot;color&quot;:&quot;#FD978F&quot;
                }
            }
        },
        };
    viz_gene = new NeoVis.default(config);
    viz_gene.render();",1618889444,https://stackoverflow.com/q/67172075,lucas lucas,"['knowledge-graph', 'javascript', 'neo4j', 'python', 'graph']"
67169403,Understanding apoc.refactor.mergeNodes,"I am using apoc.refactor.mergeNodes to merge nodes.
I have 886 nodes with properties of patient_id and date of service. All the dates of service are in December of the same year.
I have the following code:

    CALL apoc.refactor.mergeNodes(nodes, {properties: {
    pat_id:&#39;combine&#39;,
    date:&#39;combine&#39;}, mergeRels:true})

The merged node has a list of 886 patient id&#39;s, but it only has 31 dates. It appears that any duplicate values for the dates are dropped. The documentation for this function says that &#39;combine&#39; will create an array, however it appears to function as a set by only keeping unique values.
I have searched through various apoc functions, but cannot find a way to do this. I also tried to create a property for all the 886 nodes that was a map (for example, date_map: {pat_id:date}), but it appears that you cannot have a map as a property value.

Is there any way to keep duplicate values in the combined node?
",1618866657,https://stackoverflow.com/q/67169403,doc,['neo4j']
67165244,Neosemantics: Linking ontology and label property graph,"I&#39;m trying to export an existing Label property graph in neo4j as RDF and trying to use neosemantics for that purpose and for the sake of PoC I tried to use the example database with Movie dataset that comes preinstalled with Neo4j desktop. 

Below are the steps I followed 

1. Create Ontology using cypher [Reference here][1]
2. Data already exists in the neo4j desktop
3. Init configuration `CALL n10s.graphconfig.init();`

Pretty much that&#39;s it. I&#39;m pretty sure I have missed some steps and reading the docs could give me some hint, but I thought to ask here as well to get a direction so as to speed up a bit. 

I can access the Ontology using :GET `http://localhost:7474/rdf/neo4j/onto`

    @prefix owl: &lt;http://www.w3.org/2002/07/owl#&gt; .
    @prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .
    
    &lt;neo4j://graph.schema#WROTE&gt; a owl:ObjectProperty;
      rdfs:range &lt;neo4j://graph.schema#Movie&gt;;
      rdfs:domain &lt;neo4j://graph.schema#Person&gt;;
      rdfs:label &quot;WROTE&quot; .
    
    &lt;neo4j://graph.schema#RANGE&gt; a owl:ObjectProperty;
      rdfs:range &lt;neo4j://graph.schema#Class&gt;;
      rdfs:domain &lt;neo4j://graph.schema#ObjectProperty&gt;;
      rdfs:label &quot;RANGE&quot; .
    
    &lt;neo4j://graph.schema#ACTED_IN&gt; a owl:ObjectProperty;
      rdfs:label &quot;ACTED_IN&quot;;
      rdfs:domain &lt;neo4j://graph.schema#Person&gt;;
      rdfs:range &lt;neo4j://graph.schema#Movie&gt; .
    
    ........

I can validate the Label property graph against the Ontology using Cypher like this

    // DatatypeProperty domain semantics meta-rule
    MATCH (n:Class)&lt;-[:DOMAIN]-(p:DatatypeProperty) 
    WITH DISTINCT n.uri as classUri, n.label as classLabel, p.uri as prop, p.label as propLabel
    MATCH (x) WHERE  x[propLabel] IS NOT NULL AND NOT classLabel IN labels(x)
    RETURN  id(x) AS nodeUID, 
            &#39;domain of &#39; + propLabel + &#39; [&#39; + prop + &#39;]&#39; AS `check failed`,  
    		&#39;Node labels: (&#39; + reduce(s = &#39;&#39;, l IN Labels(x) | s + &#39; &#39; + l) + &#39;) should include &#39; + classLabel AS extraInfo

But what I cannot do is access the data as RDF, like for example 

    :POST /rdf/neo4j/cypher
    { &quot;cypher&quot; :&quot;match (m: Movie)&lt;-[:ACTED_IN]-(actor: Person) match (m)&lt;-[:DIRECTED]-(director: Person) where m.title = &#39;The Matrix&#39; RETURN m, actor, director&quot;, &quot;format&quot;: &quot;RDF/XML&quot;}

returns Empty 

    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
    &lt;rdf:RDF
    	xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;&gt;
    
    &lt;/rdf:RDF&gt;

Any pointers will be highly appreciated. 

Thanks


  [1]: https://github.com/jbarrasa/explicitsemanticsneo4j/blob/master/movieontology.cypher",1618847387,https://stackoverflow.com/q/67165244,Somasundaram Sekar,"['rdf', 'neo4j']"
67163044,Which is a better method to import data from JSON Neo4J?,"I have a question regarding importing data from JSON. I have to import a very large data set, which involves recursive trees and complex creation of nodes and relationships.

Neo4j can parse a JSON and we can use with, unwind clauses to import a data set.
However, I have a question.

Can I do something like SQL to import data. Can I create a query by processing the JSON using Javascript, creating a string query and then executing it using a transaction? Is it more beneficial than using the neo4j provided functions? All-in-all, is this a viable option? Because the JSON is quite complicated to be parsed using Neo4J functions.

Thank you for your time and consideration.",1618839250,https://stackoverflow.com/q/67163044,aary trivedi,"['performance', 'query-optimization', 'neo4j', 'json', 'javascript']"
67157477,Neo4j - Unable to run multiple cypher files with Neo4J Docker 4.2.5,"I am using neo4j with docker version 4.2.5 and cypher file to initialize data.

I am setting following environment property to initialize data with docker-compose -

`NEO4J_apoc_initializer_cypher=CALL apoc.cypher.runFile (&quot;file:///sample.cypher&quot;)`

This works fine and load the data after server started.
However, you cannot create indexes in this file. You need runSchema call to create indexes.
As per [doc][1] for neo4j 4.2, you can run multiple cypher,

`NEO4J_apoc_initializer_cypher_0=CALL apoc.cypher.runSchemaFile (&quot;file:///schema.cypher&quot;)`

`NEO4J_apoc_initializer_cypher_1=CALL apoc.cypher.runFile (&quot;file:///sample.cypher&quot;)`

However, this throws error:

unknown settings: apoc.initilizer.cypher.0

unknown settings: apoc.initilizer.cypher.1



Can someone please help me with this?

  [1]: https://neo4j.com/labs/apoc/4.2/operational/init-script/",1618816503,https://stackoverflow.com/q/67157477,aks,"['neo4j-apoc', 'neo4j']"
67157186,How to write user defined functions and stored procedure query of cipher of neo4j in .net core?,"I have a query like that

    call apoc.load.json(&quot;url&quot;) yield value
         unwind value.learningPaths as val
                     merge (n:learningPaths {id:val.uid}) Set n.modified = val.last_modofied,
                     n.type     = val.type,
                     n.locale   = val.locale,
                     n.childrens= val.number_of_children,
                     n.summary  = val.summary,
                     n.minutes  = val.duration_in_minutes,
                     n.title    = val.title,
                     n.levels = val.levels,
                     n.roles = val.roles,
                     n.modules = val.modules,
                     n.products = val.products

How can I write that query in .net core API to add data in neo4j database?",1618814952,https://stackoverflow.com/q/67157186,Prateek,"['asp.net-core-3.1', 'neo4jclient', 'cypher', 'graph-databases', 'neo4j']"
67154719,Label Propagation Algorithm(LPA) : Seed Labels: GraphFrames Spark,"I created a graph using [GraphFrames][1]. I wanted to do detect communities using &quot;[Label Propagation Algorithm][2]&quot;. 

From GraphFrames documentation:
LPA is a standard community detection algorithm for graphs. It is very inexpensive computationally, although (1) convergence is not guaranteed and (2) one can end up with trivial solutions (all nodes are identified into a single community).

My situation/Problem/Question(s): I have some of my vertices with &#39;label&#39; already (1/7 Million). when I run LPA, I am getting multiple small communities &amp; singletons currently. I already tried having the &#39;label&#39; as an attribute of vertices but LPA did not detect/use this attribute.
[![enter image description here][3]][3]
[![enter image description here][4]][4]
Is it possible to propagate these known labels using LPA algorithm instead of random generated numbers as labels?

If this is not supported in GraphFrames, Is it implemented or available in other packages (like neo4j / Networkx / etc?

  


  [1]: https://graphframes.github.io/graphframes/docs/_site/index.html
  [2]: https://graphframes.github.io/graphframes/docs/_site/user-guide.html#label-propagation-algorithm-lpa
  [3]: https://i.stack.imgur.com/LcnDT.png
  [4]: https://i.stack.imgur.com/KftXk.png",1618793120,https://stackoverflow.com/q/67154719,Kannan c,"['algorithm', 'networkx', 'graphframes', 'neo4j', 'spark-graphx']"
67148243,"CREATE works in this statement, but MERGE does&#39;t. What&#39;s going on here?","I am trying this statement.

```sql
CREATE (n:TestEntity), (m1:RelatedEntity)
WITH n,m1
MERGE (m2:RelatedEntity {b:&quot;c&quot;})
WITH n,m1,m2
MERGE (n)-[:REL]-&gt;(m1), (n)-[:REL]-&gt;(m2)
SET n+={a:1}, m1+={b:&quot;d&quot;}, m2+={d:2}
return n, m1,m2;
```

This gives an error:
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/sgjkq.png

If I change the last `MERGE` with `CREATE`, this exact statement works.

If I remove the second relationship and only `MERGE` the first one, it works. What&#39;s going on? Is this a bug?",1618747071,https://stackoverflow.com/q/67148243,notANerdDev,"['cypher', 'neo4j']"
67138965,How to make a &#39;blueprint&#39; of all possible relationships and nodes in Neo4J with Cypher?,"What I want to create is a blueprint of my datamodel.
What I mean with blueprint is a newly created datamodel, where every node is created only once; every node with a unique label (with eiter none, one or multiple labels) from my real database must be copied and shown once. 

For every unique node in this blueprint, I also need a relationship blueprint. So for every *different* relationship (either by name, direction or connected nodes) I also need only one representation.

Example: Say i have have 4 nodes, of which 2 are Persons and 2 are Companies; then in the blueprint only 2 nodes are shown. These are the relationships:

    (c)-[:LIKES]-&gt;(p)
    (c)-[:LIKES]-&gt;(p)
    (c)-[:LIKES]-&gt;(c)
    (c)-[:LIKES]-&gt;(c)
    (p)&lt;-[DISLIKS]-(c)

These relationships show 3 unique relationships, based on name, direction and nodes connected. 
So for this blueprint, the outcome must be 2 unique nodes with 3 unique relationships.

I&#39;ve been struggling with the code to realize this for a while. 
Any suggestions much appreciated! 
",1618667901,https://stackoverflow.com/q/67138965,Rob Brand,"['cypher', 'neo4j']"
67137410,Neo4j get friend posts with comments and likes,"I&#39;m new to neo4j and tried making a query that gets the following:

- all stories of friends that haven&#39;t been seen by the user &amp; aren&#39;t private
- comments of friends on that story
- likes of friends on that story

My query looks like this:

    Match (P:User {id: 5})
    Match (a:Story)-[BEL_TO]-&gt;(P2: User)-[:FRI]-(P)
    Where not (P)-[:SEEN]-&gt;(a) AND NOT a.priv = &quot;bf&quot;
    optional Match (a)&lt;-[:LIKE]-(P3: User)-[:FRI]-(P)
    with a, COLLECT({id: P3.id, name: P3.name}) as flikes
    optional Match (a)&lt;-[:COM_ON]-(com:Com)-[:BEL_TO]-&gt;(P4: User)-[:FRI]-(P) 
    RETURN a.id as id, flikes, COLLECT({id: P4.id, name: P4.name, comment: com}) as fcomments
    LIMIT 35



When I run this query, I get the results I want, but I tested the query in the following scenario:

- 1000 &quot;new&quot; posts (no relation seen)
- 50 likes and comments on each post
- user has 1000 friends

The query takes around 1500 ms

Is there a way to make this query more efficient/faster?

Things I thought of:
- adding an index (but don&#39;t know where)
- using &quot;join on a&quot; (but gave errors in neo4j)

Thanks in advance.
",1618657342,https://stackoverflow.com/q/67137410,Karel Debedts,['neo4j']
67130345,Neo4j-graphql-js -- Is there a way to check if an optional parameter exists or is not null?,"This is a simplified example, but I am attempting to make a change to my schema that is backwards compatible with older versions of the app. I am adding an `externalUrls` parameter:
```
CreatePost(body: String!, userId: ID!, mentions: [String!], linkUrl: String, externalUrls: [String]): Post @isAuthenticated
    @cypher(
      statement: &quot;&quot;&quot;
        ...
        UNWIND $externalUrls as urlText
        CREATE (link:Link {
            id: apoc.create.uuid(),
            path: urlText,
            createdAt: datetime(),
            updatedAt: datetime()
        })
        CREATE (link)-[:LINKS_TO {createdAt: datetime()}]-&gt;(post)
        RETURN post
    &quot;&quot;&quot;)
```
There is some cypher before that, but the idea is that I want to only run this code:
```
UNWIND $externalUrls as urlText
CREATE (link:Link {
    id: apoc.create.uuid(), 
    path: urlText,
    createdAt: datetime(),
    updatedAt: datetime()        
})
CREATE (link)-[:LINKS_TO {createdAt: datetime()}]-&gt;(post)
```
if $externalUrls exists/is not null. If an older version of the app calls 
```
mutation CreatePost($body: String!, $userId: ID!, $mentions: [String!], $linkUrl: String) {
  CreatePost(body: $body, userId: $userId, mentions: $mentions, linkUrl: $linkUrl) {
    id
  }
}
```
Where the `$externalUrls: [String]` is not even able to be passed in, the UNWIND line breaks. I&#39;ve tried using `CALL apoc.do.when` and `FOREACH` to check if `EXISTS($externalUrls)` or `NOT $externalUrls IS NULL` and both fail when that is not even passed in as an argument. Is there another way to check if an argument has any value or exists? My sense is that I&#39;m going to always run into `Expected parameter(s): externalUrls`, but I would love to find a way to avoid that.",1618597300,https://stackoverflow.com/q/67130345,Matt Larson,"['neo4j-graphql-js', 'cypher', 'neo4j-apoc', 'graphql', 'neo4j']"
67127378,After upgrading py2neo version code is giving errors,"Currently production in use versions.

NEO4J==3.2.2

python3.8
py2neo==3.1.2

Now upgrading towards newer version

py2neo==4.2.0

I am facing errors.

with py2neo==3.1.2 this code was working fine
```
selector = NodeSelector(graph)
student_node = selector.select(&quot;school&quot;, studen_key=studen_key).first()
```

After upgrading the version I have updated the code like this 
```
selector = NodeMatcher(graph)
student_node = selector.match(&quot;school&quot;, studen_key=studen_key).first()
```

but it is throwing errors.
```
py2neo.database.ClientError: SyntaxError: Invalid input &#39;{&#39;: expected &quot;+&quot; or &quot;-&quot; (line 1, column 39 (offset: 38))
&quot;MATCH (_:student) WHERE _.student_key = {1} RETURN _&quot;
```
",1618584266,https://stackoverflow.com/q/67127378,Awais Qureshi,"['py2neo', 'python', 'neo4j']"
67126882,How can i get duplicate node CYPHER Neo4j,"I have a question How can i I get some nodes with same property (for example same name property). In SQL i would use GROUP BY, but in CYPHER i don&#39;t have idea what should i use to group them. Below I added my simple input and example output to visualizate my problem.

&lt;!-- begin snippet: js hide: false console: true babel: false --&gt;

&lt;!-- language: lang-json --&gt;

    [
      {
        id:1,
        name: &#39;name1&#39;
      },
      {
        id:2,
        name: &#39;name2&#39;
      },
      {
        id:3,
        name: &#39;name2&#39;
      },
      {
        id:4,
        name: &#39;name3&#39;
      },
      {
        id:5,
        name: &#39;name3&#39;
      },
      {
        id:6,
        name: &#39;name3&#39;
      },
      {
        id:7,
        name: &#39;name4&#39;
      },
      {
        id:8,
        name: &#39;name5&#39;
      },
      {
        id:9,
        name: &#39;name6&#39;
      },
      {
        id:10,
        name: &#39;name6&#39;
      }
     ]

&lt;!-- end snippet --&gt;

My solution should gave me this:

&lt;!-- begin snippet: js hide: false console: true babel: false --&gt;

&lt;!-- language: lang-json--&gt;

    [
      {
        count:2,
        name: &#39;name2&#39;
      },
      {
        count:3,
        name: &#39;name3&#39;
      },
      {
        count:2,
        name: &#39;name6&#39;
      }
    ]

&lt;!-- end snippet --&gt;

Thank you in advance for your help",1618582582,https://stackoverflow.com/q/67126882,KarolW,"['neo4j', 'cypher']"
67124961,Can the Neo4j DBMS limit the number of concurrent sessions to an organization-defined number per user for all accounts and/or account types?,I&#39;m trying to verify that Neo4j is meeting the cybersecurity requirements for a DBMS. I&#39;ve searched through the neo4j-operations-manual-4.2.pdf and can&#39;t find any reference to concurrent sessions. Is there somewhere else I should be looking?,1618574855,https://stackoverflow.com/q/67124961,Dave Babbitt,"['neo4j', 'database']"
67124621,How to remove neo4j COMPLETE?,"Installing neo4j at arch with ```yay -S neo4j-community``` and starting with ```systemctl start neo4j``` I open ```http://localhost:7474/browser/``` and execute the demo command ```create database movies``` but I get the error
```
Neo.ClientError.Statement.NotSystemDatabaseError
Unsupported administration command: CREATE DATABASE movies
```

because of desperation I tried to remove neo4j completely but he still &quot;remembers&quot; my initial password and also still has a reference to graph.db that I have removed manually in the menubar.

Where are the files neo4j stores and does someone have idea to fix the problem with the database creation?",1618573461,https://stackoverflow.com/q/67124621,Rudolf Schmidt,['neo4j']
67116398,Cypher query problem when trying to find max of a returned column under certain relation id,"I am facing a very strange problem I am calling the same function `get_objects()` `4` times and getting the `max` from the returned column, the item `10172` which should be returned as a maximum still present in the result list but instead of that it returns me another item `9998` which is not a maximum. While for other two calls to the same function with another parameter it gives me correct results. 

I have run and tested the statement into Neo4j browser, it gives me the same problem behaves like just that node doesn&#39;t exist, but when I individually search for that node `10172` which should be returned as a maximum it does exist in the database but why it is not returning me as maximum in final result? 

I also extracted the CSV file from the Neo4j to double check the relation and presence of that specific node. It exists. Where I am going wrong? 


I have a data stored in a graph database as `4` types of nodes and they are connected with different `4` relations and the relation `id` attribute as `(1,2,3,4)` In cypher query I am trying to get the maximum `paper id` against relation `1`. The problem seems to be exists with relation `1` and relation `4` calls. But I rechecked into database these nodes are present under these particular relations. 



Here is what i have tried so far. 

    def get_objects(x): 
        par = str(x)
        query = &#39;&#39;&#39; MATCH (p)-[r]-&gt;(a) WHERE r.id = $par RETURN a.id &#39;&#39;&#39;
        resultNodes = session.run(query, par = par)
        df = DataFrame(resultNodes)
    
    return df[0]

    def find_max_1():
        authors,terms,venues,papers=0,0,0,0
        authors=get_objects(1).max()
        terms=get_objects(2).max()
        venues=get_objects(3).max()
        papers=get_objects(4).max()
        return authors,terms,venues,papers
    
    def main():
        
        m = find_max_1()
    
        if __name__ == &quot;__main__&quot;:
            
            main()

The output is: 

    [9998, 14669, 10190, 9999]

Expected output: 

    [10172, 14669, 10190, 15648]

Any kind of help would be appreciated! 

Thanks in advance. 

 ",1618523011,https://stackoverflow.com/q/67116398,Sniper,"['cypher', 'python', 'graph-databases', 'neo4j']"
67113551,Neomodel 4.0 Bolt URI for multiple databases,"I recently upgraded my Neo4j database from 3.5 to 4.1 and also the neomodel package. I have created multiple databases on the server. Whenever I am running a query, it always runs on a specific database. What do I need to do to target a different database through bolt URI programmatically?",1618508924,https://stackoverflow.com/q/67113551,ak2492,"['neomodel', 'neo4j', 'python', 'bolt']"
67112687,How to SET dynamic property within a foreach?,"I have been setting dynamic properties successfully using apoc, but getting stuck not able to use apoc within a foreach..

Equivalent of what I&#39;d like to do:
```
   MATCH (n:Label {id: {id}})
   MERGE (n)-[rel:HAS_RELATIONSHIP]-&gt;(UniqueNode:UniqueLabel)
   WITH DISTINCT rel, [&quot;DynamicProp1&quot;, &quot;DynamicProp2&quot;, &quot;DynamicProp3&quot;, &quot;LongListWouldRatherNotDoOneAtATime&quot;] as list
   FOREACH (x in list | 
			FOREACH (o IN CASE WHEN NOT EXISTS(rel[x]) THEN [1] ELSE [] END |
				SET rel[x]=false))
```
Since can&#39;t use SET rel[x]=false would have to use
```
CALL apoc.create.setRelProperty(rel, x, false)
```
But wont&#39; let me use it in a foreach...
Is there a way to do this? TIA!",1618505450,https://stackoverflow.com/q/67112687,Stephanie,['neo4j']
67112463,Unable to resolve connection to Neo4j database from AWS Lambda,"Good evening everybody,

I am trying to access my neo4j database hosted on a EC2 machine through a lambda function. 
Everything runs smooth, but oddly enough all the code that is inside a driver session doesn&#39;t execute. I already tested this piece of code on my local machine connected to a local instance of neo4j, and everything works smoothly. 

This is the faulty piece of code, be ware that the code is incompleted but I hope it gives you an idea of how it should function. 
```
def lambda_handler(event, context):


    # **This code runs** 

    message = (event[&#39;Records&#39;][0][&#39;Sns&#39;][&#39;Message&#39;])
    data = unpack(message)
    print(&#39;----------MESSAGE \n\n&#39;)
    print(message)
    print(&#39;----------DATA \n\n&#39;)
    print(data)
    
    
    preprocessor = Preprocessor(data)
    events = preprocessor.preprocess_events()
    print(&#39;----------EVENTS \n\n&#39;)
    print(events)
    
    driver = GraphDatabase.driver(&quot;bolt://54.229.49.225:7687&quot;, auth=(&#39;neo4j&#39;, &#39;hello&#39;))
    
    with driver.session() as session:
        
        # **This code doesn&#39;t** 
        
        print(&#39;-----------------OPENING SESSION-----------------&#39;)
        session.write_transaction(tx1)
        session.write_transaction(tx2)
        session.write_transaction(tx3)

    driver.close()

    return {
        &#39;statusCode&#39;: 200,
        &#39;body&#39;: json.dumps(&#39;Loaded event &lt;EVENT NAME&gt;&#39;)
    }
```


---EDIT---

After increasing the timeout timer of my lambda function I now get a different error 

```
Function Logs
START RequestId: 09235331-d238-4150-a489-5da005858596 Version: $LATEST
ciao
[ERROR] ServiceUnavailable: Timed out trying to establish connection to IPv4Address((&#39;54.229.49.225&#39;, 7687))
Traceback (most recent call last):
&#160;&#160;File &quot;/var/task/lambda_function.py&quot;, line 18, in lambda_handler
&#160;&#160;&#160;&#160;driver = GraphDatabase.driver(&quot;bolt://54.229.49.225:7687&quot;, auth=(&#39;neo4j&#39;, &#39;hello&#39;))
&#160;&#160;File &quot;/var/task/neo4j/__init__.py&quot;, line 183, in driver
&#160;&#160;&#160;&#160;return cls.bolt_driver(parsed.netloc, auth=auth, **config)
&#160;&#160;File &quot;/var/task/neo4j/__init__.py&quot;, line 196, in bolt_driver
&#160;&#160;&#160;&#160;return BoltDriver.open(target, auth=auth, **config)
&#160;&#160;File &quot;/var/task/neo4j/__init__.py&quot;, line 359, in open
&#160;&#160;&#160;&#160;pool = BoltPool.open(address, auth=auth, pool_config=pool_config, workspace_config=default_workspace_config)
&#160;&#160;File &quot;/var/task/neo4j/io/__init__.py&quot;, line 535, in open
&#160;&#160;&#160;&#160;seeds = [pool.acquire() for _ in range(pool_config.init_size)]
&#160;&#160;File &quot;/var/task/neo4j/io/__init__.py&quot;, line 535, in &lt;listcomp&gt;
&#160;&#160;&#160;&#160;seeds = [pool.acquire() for _ in range(pool_config.init_size)]
&#160;&#160;File &quot;/var/task/neo4j/io/__init__.py&quot;, line 549, in acquire
&#160;&#160;&#160;&#160;return self._acquire(self.address, timeout)
&#160;&#160;File &quot;/var/task/neo4j/io/__init__.py&quot;, line 413, in _acquire
&#160;&#160;&#160;&#160;connection = self.opener(address, timeout)
&#160;&#160;File &quot;/var/task/neo4j/io/__init__.py&quot;, line 532, in opener
&#160;&#160;&#160;&#160;return Bolt.open(addr, auth=auth, timeout=timeout, routing_context=routing_context, **pool_config)
&#160;&#160;File &quot;/var/task/neo4j/io/__init__.py&quot;, line 193, in open
&#160;&#160;&#160;&#160;s, pool_config.protocol_version, handshake, data = connect(
&#160;&#160;File &quot;/var/task/neo4j/io/__init__.py&quot;, line 1052, in connect
&#160;&#160;&#160;&#160;raise last_error
&#160;&#160;File &quot;/var/task/neo4j/io/__init__.py&quot;, line 1042, in connect
&#160;&#160;&#160;&#160;s = _connect(resolved_address, timeout, keep_alive)
&#160;&#160;File &quot;/var/task/neo4j/io/__init__.py&quot;, line 940, in _connect
&#160;&#160;&#160;&#160;raise ServiceUnavailable(&quot;Timed out trying to establish connection to {!r}&quot;.format(resolved_address))END RequestId: 09235331-d238-4150-a489-5da005858596
REPORT RequestId: 09235331-d238-4150-a489-5da005858596	Duration: 30033.06 ms	Billed Duration: 30034 ms	Memory Size: 256 MB	Max Memory Used: 111 MB
```

Which suggests that there may be some connection issues although I am able to run the same script from my local machine successfully",1618504476,https://stackoverflow.com/q/67112463,francesco foschi,"['neo4j', 'amazon-web-services', 'python', 'python-3.x', 'aws-lambda']"
67110557,How to optimise neo4j cypher query for high size graph?,"I wrote this query to find possible paths between two nodes. However, when I try to use more than 3 steps, it can&#39;t finish the job. Graph that I used contains more than 4mil nodes with 49mil relations.
```
match (src:T047 {CUI:&quot;C0030920&quot;}), 
	  (trg:T059 {CUI:&quot;C1294944&quot;}),
      p = (src)-[*..3]-(trg)
where 
	  all(relI in relationships(p) 
      where type(relI) in [&quot;RO&quot;,&quot;CHD&quot;,&quot;PAR&quot;,&quot;RB&quot;,&quot;RL&quot;,&quot;RO&quot;,&quot;SIB&quot;,&quot;RU&quot;,&quot;SY&quot;])
and
	  all(nodeI in nodes(p)
      where labels(nodeI) in [&quot;T004&quot;, &quot;T005&quot;, &quot;T007&quot;, &quot;T016&quot;, &quot;T017&quot;, &quot;T018&quot;, &quot;T019&quot;, &quot;T020&quot;,
            &quot;T021&quot;, &quot;T022&quot;, &quot;T023&quot;, &quot;T024&quot;, &quot;T025&quot;, &quot;T026&quot;, &quot;T028&quot;, &quot;T029&quot;, &quot;T030&quot;, &quot;T031&quot;, &quot;T032&quot;, 
            &quot;T033&quot;, &quot;T034&quot;, &quot;T037&quot;, &quot;T038&quot;, &quot;T039&quot;, &quot;T040&quot;, &quot;T041&quot;, &quot;T042&quot;, &quot;T043&quot;, &quot;T045&quot;, &quot;T046&quot;,
            &quot;T047&quot;, &quot;T048&quot;, &quot;T049&quot;, &quot;T053&quot;, &quot;T054&quot;, &quot;T055&quot;, &quot;T056&quot;, &quot;T057&quot;, &quot;T059&quot;, &quot;T060&quot;, &quot;T061&quot;, 
            &quot;T074&quot;, &quot;T080&quot;, &quot;T081&quot;, &quot;T098&quot;, &quot;T099&quot;, &quot;T100&quot;, &quot;T101&quot;, &quot;T103&quot;, &quot;T109&quot;, &quot;T114&quot;, &quot;T116&quot;, 
            &quot;T121&quot;, &quot;T123&quot;, &quot;T125&quot;, &quot;T126&quot;, &quot;T127&quot;, &quot;T129&quot;, &quot;T131&quot;, &quot;T168&quot;, &quot;T184&quot;, &quot;T190&quot;, &quot;T191&quot;, 
            &quot;T195&quot;, &quot;T196&quot;, &quot;T197&quot;, &quot;T200&quot;, &quot;T201&quot;])
return p
```
Here is plan for this query:
https://imgur.com/PpWePOz

Is there any possible ways to optimise this query or at least find estimation time? ",1618497494,https://stackoverflow.com/q/67110557,RustySkull,"['neo4j', 'cypher', 'optimization']"
67108703,Neo4J Uniquely group people to other people considering previous groupings so they are not grouped with the same person twice where possible,"I&#39;m really new and just experimenting with Neo4J and I&#39;m looking at building a simple application.

This application has a list of people that need to be grouped into unique groups of 2 (or more, group size is configurable).

Currently I do this randomly, but this means people can be grouped with people they&#39;ve been grouped with before.

Using Neo4J I would like to generate these groups and group people prioritising people who have never been grouped before.

People can only be grouped into 2 groups when there is an odd number of people (for 9 people total, someone would have to be in 2 groups to ensure everyone gets grouped).

Currently I have the following structure:
```
(:Person)-[:HAS_BEEN_MATCHED_WITH]-(:Person)
```

Where the relationship has a property of `times` which indicates how many times a person has been matched with another (or the relation does not exist at all in the case of never matched).

For example, If I have the following data:
```
CREATE (p1:Person)
CREATE (p2:Person)
CREATE (p3:Person)
CREATE (p1)-[:HAS_BEEN_MATCHED_WITH {times: 2}]-&gt;(p2)
CREATE (p1)-[:HAS_BEEN_MATCHED_WITH {times: 1}]-&gt;(p3)
```

The resulting groups should be as follows:
```
p1 and p3 (p1 has been matched the least times with p3)
p2 and p3 (p2 has no matches with p3)
```

Above, `p3` is matched twice because of the odd number of participants, to ensure everyone is matched.",1618490566,https://stackoverflow.com/q/67108703,Joe,"['neo4j', 'cypher', 'graph']"
67102433,ModuleNotFoundError while updating py2neo 3.1.2 to py2neo 4.0.0,"In our application, we are connecting to Neo4j database through py2neo module version 3.1.2. Now we would like to update it to 4.0.0 version. We have gone through the below link and understood what are the query level changes required.

[https://neo4j.com/docs/cypher-manual/current/deprecations-additions-removals-compatibility/#cypher-deprecations-additions-removals-4.0][1]


  [1]: https://neo4j.com/docs/cypher-manual/current/deprecations-additions-removals-compatibility/#cypher-deprecations-additions-removals-4.0

However, there are few modules not available in py2neo 4.0.0 version. Please help us to understand if there is any equivalent module available.

```
from py2neo.database.status import ConstraintError
from py2neo.packages.neo4j.v1.exceptions import ProtocolError
from py2neo.packages.httpstream import http
```

Below are the error details for the reference.

```
ModuleNotFoundError: No module named &#39;py2neo.database.status&#39;; &#39;py2neo.database&#39; is not a package
```

```
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
ModuleNotFoundError: No module named &#39;py2neo.packages&#39;
```",1618462024,https://stackoverflow.com/q/67102433,Madhavan Salai,['neo4j']
67095100,Retreiveing Relationship in Neoj4Client gives Deserialization exception,"I&#39;m trying to retrieve a relationship with an attribute from my DB. I&#39;m using Neo4jClient and .NET .
This is what I&#39;ve tried so far :

    var client = new GraphClient(new Uri(&quot;http://localhost:11007&quot;), &quot;neo4j&quot;, &quot;jobsjobs&quot;);
    var JsonContractResolver = new CamelCasePropertyNamesContractResolver();
    client.ConnectAsync().Wait();
    var createQuery = client.Cypher
                            .Match(&quot;matched=(a:Technology{name:{to},title:{level}})&lt;-[rel:HOP]-(b:Technology{name:{from},title:{level}})&quot;)
                            .WithParam(&quot;to&quot;, &quot;ArangoDB&quot;)
                            .WithParam(&quot;level&quot;, &quot;Junior&quot;)
                            .WithParam(&quot;from&quot;, &quot;Big Table&quot;)
                            .Return(rel =&gt; rel.As&lt;RelationshipInstance&lt;Hop&gt;&gt;()).ResultsAsync;

    foreach (var item in createQuery.Result)
    {
        Console.WriteLine(item.Data.Cost);
    }
This is my &#39;Hop&#39; relationship class:

     public class Hop : Relationship,
        IRelationshipAllowingSourceNode&lt;Technology&gt;,
        IRelationshipAllowingTargetNode&lt;Technology&gt;
     {

        [JsonProperty(&quot;cost&quot;)]
        public long? Cost { get; set; }
        public Hop() : base(-1, null) { }
        public Hop(NodeReference targetNode) : base(targetNode)
        {
        }

        public const string TypeKey = &quot;HOP&quot;;

        public override string RelationshipTypeKey
        {
            get { return TypeKey; }
        }
This is the error that I&#39;ve been getting for the past 6 hours:

&gt; &quot;One or more errors occurred. (Neo4j returned a valid response, however Neo4jClient was unable to deserialize into the object structure you supplied.\r\n\r\nFirst, try and review the exception below to work out what broke.\r\n\r\nIf it&#39;s not obvious, you can ask for help at http://stackoverflow.com/questions/tagged/neo4jclient\r\n\r\nInclude the full text of this exception, including this message, the stack trace, and all of the inner exception details.\r\n\r\nInclude the full type definition of &lt;&gt;f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]].\r\n\r\nInclude this raw JSON, with any sensitive values replaced with non-sensitive equivalents:\r\n\r\n (Parameter &#39;content&#39;))
&quot;   at Neo4jClient.Serialization.CypherJsonDeserializer`1.Deserialize(String content, Boolean isHttp)\r\n   at Neo4jClient.GraphClient.Neo4jClient.IRawGraphClient.ExecuteGetCypherResultsAsync[TResult](CypherQuery query)&quot; &quot;

EDIT : Adding the JSON format of the HOP relationship :

{
  &quot;identity&quot;: 1515,
  &quot;start&quot;: 1495,
  &quot;end&quot;: 1491,
  &quot;type&quot;: &quot;HOP&quot;,
  &quot;properties&quot;: {
&quot;cost&quot;: 3
  }
}


This is the JSON format of the nodes:

{
  &quot;identity&quot;: 1491,
  &quot;labels&quot;: [
    &quot;Technology&quot;
  ],
  &quot;properties&quot;: {
&quot;name&quot;: &quot;ArangoDB&quot;,
&quot;title&quot;: &quot;Junior&quot;
  }
}

[![This is the results in graph format][1]][1]


  [1]: https://i.stack.imgur.com/4fspI.png",1618415728,https://stackoverflow.com/q/67095100,confusedstudent,"['neo4jclient', 'asp.net', 'neo4j']"
67089118,Best way to rank order and display posts based on connections/friends using NEO4J,"I am working on an app which uses NEO4J. There are mainly two types of Nodes 

1. User - User nodes can be connected among each other with relationship &#39;FRIENDS&#39; 
2. Post - Posts nodes consists of posts created by the users and has a relationship of &#39;OWNED_BY&#39; between user who created the post and the actual post node 

For example, 
1. Consider there are 3 users A,B,C and 4 posts B1,B2 (from user B) and C1,C2 (from user C)
2. A and B are connected with &#39;FRIENDS&#39; 
3. For user A the post display order should be B1,B2,C1,C2 on his/her dashboard ( i.e. we should display the posts which are created by the immediate network followed by posts which are not from his/her network) 

Need some guidance on how this can be achieved using CYPHER query ",1618392726,https://stackoverflow.com/q/67089118,Vader.219k,"['cypher', 'neo4j']"
67088732,Neo4J (spring boot) with sealed classes in kotlin,"I&#39;m trying to create a somewhat generic implementation using kotlin and neo4j. My idea right now is that I want to have a GeoNode that can point to any kind of GeoJson feature (e.g. &quot;Feature&quot; or &quot;FeatureCollection&quot;)

I tried to do this using kotlins sealed classes, e.g.

```

@JsonTypeInfo(
    use = JsonTypeInfo.Id.NAME,
    include = JsonTypeInfo.As.PROPERTY,
    property = &quot;type&quot;
)
@JsonSubTypes(
    JsonSubTypes.Type(value = GeoJsonFeature::class, name = &quot;GeoJsonFeature&quot;)
)
@Node
sealed class FeatureContract(
    @GeneratedValue @Id var id: Long? = null,
    @Version var version: Long? = null
) {
    companion object {
        @JsonCreator
        @JvmStatic
        private fun creator(name: String): FeatureContract? {
            return FeatureContract::class.sealedSubclasses.firstOrNull {
                it.simpleName == name
            }?.objectInstance
        }

    }
}

data class GeoJsonFeature(
    val geometry: GeometryContract,
) : FeatureContract()


data class GeoJsonFeatureCollection(
    val features: List&lt;GeoJsonFeature&gt;,
) : FeatureContract()


// and the &quot;GeoNode&quot; that holds this

@Node
data class GeoNode(
    @Id val id: String,
    @Version var version: Long? = null
    @Relationship(type = &quot;feature&quot;) var feature: FeatureContract?, // Should be either a featureCollection or a feature,

)

```

The idea is that I can have a point on a map that points to _any_ kind of GeoJson. 

It seems I am successful in serializing this and getting it into the Neo4J-db on write, however, on reading I get 

`Failed to instantiate [FeatureContract]: Is it an abstract class?; nested exception is java.lang.InstantiationException`

The Jackson annotations are there cause I hoped they would help me (that Neo4J-OGM was using it under the hood) but it doesn&#39;t seem to have done the trick. I&#39;ve read about Neo4JEntityConverters but I haven&#39;t understood how one can to this for a full object like this. Is there any good way to use sealed classes in kotlin with the neo4j-OGM for both serialization and deserialization?

Using spring boot 2.4.4 and spring-boot-starter-data-neo4j
",1618391192,https://stackoverflow.com/q/67088732,stevietheTV,"['kotlin', 'neo4j', 'spring', 'spring-boot']"
67088612,"How to resolve &quot;Neo4j returned a valid response, however Neo4jClient was unable to deserialize into the object structure you supplied.&quot; error?","I am using neo4jclient graph database with .net core API. I have to add the health checks. I have created my own health check using Ihealthcheck interface. below is my healthcheck class


 public class DatabaseHealthCheck : IHealthCheck

    {
        public DatabaseHealthCheck(IGraphClient graphClient)
        {
            _graphClient = graphClient;
        }

        private readonly IGraphClient _graphClient;
        public async Task&lt;HealthCheckResult&gt; CheckHealthAsync(
            HealthCheckContext context,
            CancellationToken cancellationToken = default(CancellationToken))

        {
            try
            {
                var result = await _graphClient.Cypher.Match(@&quot;show databases&quot;)
                .Return((n) =&gt; n.As&lt;DatabaseDetail&gt;()).ResultsAsync;

                foreach (var res in result)
                {
                    if (res.currentStatus == &quot;Online&quot;)
                    {
                        return await Task.FromResult(
                               HealthCheckResult.Healthy(&quot;Healthy&quot;));
                    }
                }
            }

            catch (Exception ex)
            {
                return new HealthCheckResult(status: context.Registration.FailureStatus, exception: ex);
            }

            return HealthCheckResult.Healthy();

            //    return await Task.FromResult(
            //        new HealthCheckResult(context.Registration.FailureStatus,
            //        &quot;Unhealthy&quot;));
        }
    }

With this health check I want to get the database details and then check the status of database weather it is online or not but I am getting the below error

Neo4j returned a valid response, however Neo4jClient was unable to deserialize into the object structure you supplied.

Can anyone help me ?",1618390733,https://stackoverflow.com/q/67088612,Prateek,"['c#', '.net-core', 'neo4jclient', 'graph-databases', 'neo4j']"
67084660,Neo4J Cypher: Match ()-[]-() Return count(*) return double of the number of the relationships when node labels are not assigned,"In my database, there is a kind of relationships between `A` and `B` named `awithb`. 
For the Cypher
```
MATCH ()-[:awithb]-() return count(*)
```
it returns 140.

However if we give the labels of the node, 
```
MATCH (:A)-[:awithb]-(:B) return count(*)
```
it returns 70.

Why these two cypher queries return different results?",1618366833,https://stackoverflow.com/q/67084660,Jie W,"['cypher', 'neo4j']"
67082883,Is there a way to store a value in neo4j?,"I want to use this case scenario in neo4j. Create a list of vsm values and compare this list to a knowed list, in order to compute a similarity.

This is the query i have:
```
MATCH (e:Event{value:&#39;clickout item&#39;,step:&#39;2&#39;})
  &lt;-[r2:CONTAIN]-(n:Session{id:&quot;555&quot;})-[r:HAS_ITEMS]-&gt;(im:Impression)
WITH collect(im.value) as listA, [1,19] as item  
RETURN [i in listA | CASE WHEN i IN item THEN 1 ELSE 0 END] as output
```
this has an output : [0 0 1 0 1 0 ]. Is there any way to compute in a single cypher query another vsm of different session and then compare it to the output using the Jaccard similarity?

All I have done by far, is creating kind of Cache node, but Jaccard similarity fails, as it is stored as a Node.
",1618350864,https://stackoverflow.com/q/67082883,user12678036,"['cypher', 'similarity', 'store', 'neo4j']"
67078202,Use optional cypher query results in subsequent query and combine results,"I have a working cypher query to get optional results and then use the resulting nodes in a subsequent query and combine the result. 

    MATCH (n:KnowledgeEntry {id: &#39;d0634a24-91d0-4fd7-8868-2caa3ab0dc7a&#39; })
    OPTIONAL MATCH (n)-[r:IS_PART]-&gt;(p:KnowledgeEntry)
    OPTIONAL MATCH (n)&lt;-[ch:IS_PART*1..2]-(d:HierarchicalKnowledgeEntry)
    UNWIND d AS descendant
    UNWIND p AS parent
    UNWIND r AS parentRelation
    UNWIND ch AS childRelation
    WITH (collect(DISTINCT n) + collect(DISTINCT parent) + collect(DISTINCT descendant)) as  nodes, parentRelation, childRelation
    UNWIND nodes AS n
    OPTIONAL MATCH (n)-[r:CONTEXTUAL_KNOWLEDGE]-(c:ContextualKnowledgeEntry)
    UNWIND nodes AS node
    UNWIND c AS contextualNode
    UNWIND r AS contextualRelation
    WITH collect(DISTINCT node) + collect(DISTINCT contextualNode) as knowledgeEntries,
    collect(distinct parentRelation) + collect(distinct childRelation) + collect(distinct contextualRelation) as edges
    return knowledgeEntries, edges

It&#39;s a bit ugly and I&#39;m asking myself if there is a better way to build this query.

Any ideas?",1618328741,https://stackoverflow.com/q/67078202,ms007,"['cypher', 'neo4j']"
67074120,Neo4j high db hits,"I&#39;m new to Neo4j and trying to test my queries based on performance.

If I do a simple query like:

    PROFILE
    MATCH (P:User) 
    WHERE P.id = 1 
    SET P.name = &quot;test&quot; 
    Return P, P.name

There are 50k user nodes, but for this query, there are 100 009 db hits in 75ms.

For example: this query:

    MATCH (P1:User {id: &quot;xxx&quot;}) 
    MATCH (P2:User {id: &quot;xxx&quot;}) 
    MERGE (P1)-[fo:FOL]-&gt;(P2) 
    on match set P1.fol2 = P1.fol2 -1
    on match set P2.fol = P2.fol -1
    MERGE (P1)&lt;-[fo1:FOL]-(P2) 
    on match set P1.fol = P1.fol -1
    on match set P2.fol2 = P2.fol2 -1
    MERGE (P1)-[:FRI]-(P2) 
    On create set P1.fri= P1.fri +1
    on create set P2.fri = P2.fri +1
    DELETE fo, fo1

This query takes 201015 db hits and 751ms.


Is there a way to make less database hits, because I guess these numbers are way too high?

Thanks in advance!
",1618313816,https://stackoverflow.com/q/67074120,Karel Debedts,['neo4j']
67072568,Saving data back to neo4j using python,"I save the PageRank data back to Neo4j, but an error occured.

My code is as follow:

    import org.neo4j.spark._ 
    import org.apache.spark.graphx._
    import org.apache.spark.graphx.lib._
    val neo = Neo4j(sc)
    val g = Neo4jGraph.loadGraph(sc, label1=&quot;node&quot;, relTypes=Seq(&quot;connect&quot;),  label2=&quot;node&quot;)
    val g2 = PageRank.run(g, numIter = 9)
    val v = g2.vertices.take(9)
    Neo4jGraph.saveGraph(sc, g2,&quot;rank&quot;)

**The error**: org.neo4j.driver.exceptions.ClientException: Writing in read access mode not allowed. Attempted write to internal graph 0 (neo4j)

**Note:** everything is run well until the last line of code. 

This is the result of `val v = g2.vertices.take(9)`

    v: Array[(org.apache.spark.graphx.VertexId, Double)] = Array((40,0.5279655760274328), (41,0.5279655760274328), (33,0.5279655760274328), (34,0.5279655760274328), (35,1.0028162618334502), (36,4.134772368123669), (37,0.6946179138782844), (38,0.5279655760274328), (39,0.5279655760274328)) 

",1618307530,https://stackoverflow.com/q/67072568,Sama,"['neo4j', 'python', 'apache-spark']"
67070372,Spring boot command line application doesn&#39;t terminate with neo4j driver,"I&#39;ve added Neo4j connectivity to a simple Spring Boot command line application &amp;mdash; it implements `CommandLineRunner`.

I&#39;ve almost followed the examples in [Neo4j driver manual](https://neo4j.com/docs/driver-manual/current/client-applications/), but my application doesn&#39;t terminate after `main()` finishes.  
The only deviation from those sources is that the `driver.close()` method is not invoked at `main()` end, but in a `@PreDestroy` annotated method:

    @Service
    public class DatabaseGraphService {
    	
    	private volatile Driver driver;
    	
    	private final Logger LOG;
    	
    	public DatabaseGraphService() {
    		LOG = LogManager.getLogger(getClass());
    	}
    
    	@PostConstruct
    	private void initialize() throws Exception {
    		driver = GraphDatabase.driver(&quot;bolt://localhost:7687&quot;, AuthTokens.basic(&quot;neo4j&quot;, &quot;neo4j&quot;));
    	}
    	
    	@PreDestroy
    	public void close() throws Exception {
    		LOG.info(&quot;Shutting down Neo4j driver...&quot;);
    		driver.close();
    	}
    	
    	// ...
    	
    }

Main class:
	
    @SpringBootApplication(scanBasePackages={ &quot;it&quot; })
    public class SpringBootConsoleApplication implements CommandLineRunner {
    
    	@Autowired
    	private DatabaseGraphService graphService;
    	
    	private static Logger LOG = LoggerFactory
          .getLogger(SpringBootConsoleApplication.class);
    
        public static void main(String[] args) {
            LOG.info(&quot;STARTING THE APPLICATION&quot;);
            
            SpringApplication.run(SpringBootConsoleApplication.class, args);
            LOG.info(&quot;APPLICATION FINISHED&quot;);
        }
     
        @Override
        public void run(String... args) {
            LOG.info(&quot;EXECUTING : command line runner&quot;);
        }
        
    }

I run it from within Sprint Tools Suite (Eclipse-based IDE), this is what it logs:

    i.c.c.e.SpringBootConsoleApplication     : APPLICATION FINISHED

but nothing else and the process stays active; when I hit the stop button, then:

    inMXBeanRegistrar$SpringApplicationAdmin : Application shutdown requested.
    i.c.c.services.DatabaseGraphService      : Shutting down Neo4j driver...
    com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
    [...]

If I run the program without executing any query, the process exists regularly. As long as I do a query - no matter if I consume all the results or do nothing with the `Result` object - it stays active.

Am I doing something wrong? Or maybe this is the expected behaviour, because when `main()` finishes it&#39;s just its thread that terminates?

Though, in the same application I&#39;m connecting to a PostgreSQL instance, doing queries there too, but the application terminated correctly before adding the Neo4j connection.
",1618298473,https://stackoverflow.com/q/67070372,watery,"['neo4j-driver', 'java', 'neo4j', 'spring-boot']"
67069802,APOC UUID support in Kubernetes,"I&#39;m running a Neo4j instance (version 4.2.2) in a pod within a Kubernetes cluster, in standalone mode. The server starts, I can create, find and update nodes and relationships, however, when trying to install a UUID using `apoc.uuid.install`, the procedure hangs and never seems to finish. 

I&#39;d also like to mention that `apoc.uuid.enabled=true` is set in neo4j.conf, I&#39;ve set a constraint on the designated UUID field before running install and I can&#39;t find any errors in the logs. I&#39;ve also tried this functionality in non-K8s environments and I have no problem using it there.

The helm charts used for this deployment are taken from https://github.com/neo4j-contrib/neo4j-helm.

Did anyone experience this behavior? If yes, how did you manage to solve it? ",1618295607,https://stackoverflow.com/q/67069802,ams,"['neo4j-apoc', 'kubernetes', 'neo4j']"
67055300,Neo4j cypher query doesn&#39;t return the results as expected into pandas DataFrame,"I am trying to pass on the parameter to the cypher query in a function but it is not returning the results as expected. First error was `ClientError: {code: Neo.ClientError.Statement.ParameterMissing} {message: Expected parameter(s): x}` I checked it on another forum where I also had to pass the parameter along with query run session I did so and error disappeared but still it didn&#39;t get the results as expected and returned the empty nodes. 

In the graph db the nodes are connected with 4 types of relationships with an ids. 

This is what I have tried so far: 

    def get_objects(x):
        query = &#39;&#39;&#39; MATCH (p)-[r]-&gt;(a) where r.id = $x RETURN p.id; &#39;&#39;&#39; 
        resultNodes = session.run(query, x = x)
        df = DataFrame(resultNodes)
        print(df)
        return df
    
    def find_max_1():
        authors,terms,venues,papers=0,0,0,0
        authors=get_objects(1).max()
        terms=get_objects(2).max()
        venues=get_objects(3).max()
        papers=get_objects(4).max()
        return authors,terms,venues,papers
    
    def main():
        
        m = m=find_max_1()
        
    
    if __name__ == &quot;__main__&quot;:
        
        main()
and the output is: 

    Empty DataFrame
    Columns: []
    Index: []
    Empty DataFrame
    Columns: []
    Index: []
    Empty DataFrame
    Columns: []
    Index: []
    Empty DataFrame
    Columns: []
    Index: []

I am unable to identify what&#39;s wrong with this.

Any kind of help in right direction would be appreciated. 

Thanks in advance. ",1618217123,https://stackoverflow.com/q/67055300,Sniper,"['pandas', 'cypher', 'python', 'neo4j', 'graph-databases']"
67053290,Which neo4j-ogm-bolt-driver version should be used with neo4j 4.2.4 community edition in spring-boot application,"[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/d5uej.png
I am developing a spring-boot application using neo4j graph database. For trail I have cloned the github repo which has similar kind of application. But when I try to run the project I get following error. I assume that the problem is with version mismatch between the neo4j-bolt-driver and server. I wasn&#39;t able to download neo4j server of lower version from the website of neo4j either.The github repo used another version of neo4j server i.e. neo4j-community-3.0.11 
neo4j-community-4.2.4 is the version used. and the neo4j-ogm-bolt-driver used in pom.xml is 
       ```&lt;dependency&gt;
			 &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
			 &lt;artifactId&gt;neo4j-ogm-bolt-driver&lt;/artifactId&gt;
			 &lt;version&gt;2.1.1
              &lt;/version&gt;
		      &lt;/dependency&gt;```
I am getting the following SSL Exception. the log id as follows
```
org.neo4j.driver.v1.exceptions.ClientException: SSL Connection terminated while receiving data. This can happen due to network instabilities, or due to restarts of the database.
	at org.neo4j.driver.internal.security.TLSSocketChannel.unwrap(TLSSocketChannel.java:166) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.security.TLSSocketChannel.runHandshake(TLSSocketChannel.java:114) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.security.TLSSocketChannel.&lt;init&gt;(TLSSocketChannel.java:81) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.security.TLSSocketChannel.create(TLSSocketChannel.java:69) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.net.SocketClient$ChannelFactory.create(SocketClient.java:297) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.net.SocketClient.start(SocketClient.java:124) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.net.SocketConnection.&lt;init&gt;(SocketConnection.java:66) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.net.pooling.SocketConnectionPool.connect(SocketConnectionPool.java:83) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.net.pooling.SocketConnectionPool.access$000(SocketConnectionPool.java:55) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.net.pooling.SocketConnectionPool$1.get(SocketConnectionPool.java:119) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.net.pooling.SocketConnectionPool$1.get(SocketConnectionPool.java:111) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.net.pooling.BlockingPooledConnectionQueue.acquire(BlockingPooledConnectionQueue.java:87) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.net.pooling.SocketConnectionPool.acquire(SocketConnectionPool.java:122) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.DirectDriver.newSessionWithMode(DirectDriver.java:49) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.driver.internal.BaseDriver.session(BaseDriver.java:62) ~[neo4j-java-driver-1.1.0.jar:1.1.0-cec0652af796424e52867c859006da79b62d2ded]
	at org.neo4j.ogm.drivers.bolt.driver.BoltDriver.newSession(BoltDriver.java:97) ~[neo4j-ogm-bolt-driver-2.1.1.jar:na]
	at org.neo4j.ogm.drivers.bolt.driver.BoltDriver.newTransaction(BoltDriver.java:73) ~[neo4j-ogm-bolt-driver-2.1.1.jar:na]
	at org.neo4j.ogm.session.transaction.DefaultTransactionManager.openTransaction(DefaultTransactionManager.java:71) ~[neo4j-ogm-core-2.1.6.jar:na]
	at org.neo4j.ogm.session.transaction.DefaultTransactionManager.openTransaction(DefaultTransactionManager.java:57) ~[neo4j-ogm-core-2.1.6.jar:na]
	at org.neo4j.ogm.drivers.bolt.request.BoltRequest.executeRequest(BoltRequest.java:153) ~[neo4j-ogm-bolt-driver-2.1.1.jar:na]
	at org.neo4j.ogm.drivers.bolt.request.BoltRequest.execute(BoltRequest.java:72) ~[neo4j-ogm-bolt-driver-2.1.1.jar:na]
	at org.neo4j.ogm.session.delegates.ExecuteQueriesDelegate.executeAndMap(ExecuteQueriesDelegate.java:117) ~[neo4j-ogm-core-2.1.6.jar:na]
	at org.neo4j.ogm.session.delegates.ExecuteQueriesDelegate.query(ExecuteQueriesDelegate.java:90) ~[neo4j-ogm-core-2.1.6.jar:na]
	at org.neo4j.ogm.session.Neo4jSession.query(Neo4jSession.java:387) ~[neo4j-ogm-core-2.1.6.jar:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:564) ~[na:na]
	at org.springframework.data.neo4j.transaction.SharedSessionCreator$SharedSessionInvocationHandler.invoke(SharedSessionCreator.java:131) ~[spring-data-neo4j-4.2.13.RELEASE.jar:na]
	at com.sun.proxy.$Proxy60.query(Unknown Source) ~[na:na]
	at org.springframework.data.neo4j.repository.query.GraphRepositoryQuery.mappedCollection(GraphRepositoryQuery.java:206) ~[spring-data-neo4j-4.2.13.RELEASE.jar:na]
	at org.springframework.data.neo4j.repository.query.GraphRepositoryQuery.execute(GraphRepositoryQuery.java:90) ~[spring-data-neo4j-4.2.13.RELEASE.jar:na]
	at org.springframework.data.neo4j.repository.query.GraphRepositoryQuery.execute(GraphRepositoryQuery.java:65) ~[spring-data-neo4j-4.2.13.RELEASE.jar:na]
	at org.springframework.data.repository.core.support.RepositoryFactorySupport$QueryExecutorMethodInterceptor.doInvoke(RepositoryFactorySupport.java:494) ~[spring-data-commons-1.13.13.RELEASE.jar:na]
	at org.springframework.data.repository.core.support.RepositoryFactorySupport$QueryExecutorMethodInterceptor.invoke(RepositoryFactorySupport.java:477) ~[spring-data-commons-1.13.13.RELEASE.jar:na]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:56) ~[spring-data-commons-1.13.13.RELEASE.jar:na]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:99) ~[spring-tx-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:282) ~[spring-tx-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:96) ~[spring-tx-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:136) ~[spring-tx-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:92) ~[spring-aop-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.data.repository.core.support.SurroundingTransactionDetectorMethodInterceptor.invoke(SurroundingTransactionDetectorMethodInterceptor.java:57) ~[spring-data-commons-1.13.13.RELEASE.jar:na]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:213) ~[spring-aop-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at com.sun.proxy.$Proxy69.getAllUsers(Unknown Source) ~[na:na]
	at com.techprimers.springbootneo4jexample1.service.UserService.getAll(UserService.java:17) ~[classes/:na]
	at com.techprimers.springbootneo4jexample1.resource.UserResource.getAll(UserResource.java:22) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:564) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:205) ~[spring-web-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:133) ~[spring-web-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:97) ~[spring-webmvc-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:827) ~[spring-webmvc-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:738) ~[spring-webmvc-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:85) ~[spring-webmvc-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:967) ~[spring-webmvc-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:901) ~[spring-webmvc-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:970) ~[spring-webmvc-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:861) ~[spring-webmvc-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:635) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:846) ~[spring-webmvc-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:742) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52) ~[tomcat-embed-websocket-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99) ~[spring-web-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) ~[spring-web-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.springframework.web.filter.HttpPutFormContentFilter.doFilterInternal(HttpPutFormContentFilter.java:109) ~[spring-web-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) ~[spring-web-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93) ~[spring-web-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) ~[spring-web-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:197) ~[spring-web-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) ~[spring-web-4.3.18.RELEASE.jar:4.3.18.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:496) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:81) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:803) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:790) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1468) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630) ~[na:na]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-8.5.31.jar:8.5.31]
	at java.base/java.lang.Thread.run(Thread.java:832) ~[na:na]

```
will you please help me to find the solution",1618206875,https://stackoverflow.com/q/67053290,Ruchaa Nandgirikar,"['spring-boot', 'neo4j-bolt', 'neo4j']"
67051613,Database creation takes to long in neo4j,"**Updated question:**

I&#39;m new in neo4j and im trying to create a movie rating database. I have a file with 100.000 registers (2,3 MB) that represents when a user rated a movie; the file look like this (this dataset is from MovieLens):

[dataset file][1]

I&#39;m using py2neo and I create de datebase with this code:

``` 
data = pd.read_csv(&#39;ratings_small.csv&#39;)
def create_bipartite_graph(data):
#Indexes creation to perform the queries
    graph.run(&#39;&#39;&#39;
        CREATE INDEX user_index IF NOT EXISTS FOR (u:User) ON (u.UserId)
    &#39;&#39;&#39;)
    graph.run(&#39;&#39;&#39;
        CREATE INDEX movie_index IF NOT EXISTS FOR (m:Movie) ON (m.MovieId)
    &#39;&#39;&#39;)
    actual_user_node = None
    for index, row in data.iterrows():
        userID = int(row[&#39;userId&#39;])
        movieID = int(row[&#39;movieId&#39;])
        rating = row[&#39;rating&#39;]
        date = datetime.fromtimestamp(row[&#39;timestamp&#39;]).strftime(&quot;%m/%d/%Y, %H:%M:%S&quot;)

        #Creation nodes and relationships
        graph.run(&#39;&#39;&#39;
            MERGE(u:User{UserId: $uID})
            MERGE(m:Movie{MovieId: $mID})
            CREATE (u)-[:RATED_MOVIE{rating: $r, date: $d}]-&gt;(m)
        &#39;&#39;&#39;, parameters = {&#39;uID&#39;: userID, &#39;mID&#39;: movieID, &#39;r&#39;: rating, &#39;d&#39;: date})
```

The problem is with that small dataset, takes more than 2 hours in create the graph. Any advice for the time of the databse creation decrease considerably?

**Using ```LOAD CSV```:**

This is the query that I execute in neo4j browser
```
EXPLAIN LOAD CSV With HEADERS FROM &#39;file:///ratings_small.csv&#39; AS line FIELDTERMINATOR &#39;,&#39; 
MERGE(m:Movie{MovieId: toInteger(line.movieId)})
MERGE(u:User{UserId: toInteger(line.userId)})
CREATE (u)-[:RATED_MOVIE{rating:toFloat(line.rating)}]-&gt;(m)
```
And this is the profile plan:
[profile plan][2]


  [1]: https://i.stack.imgur.com/ORTRO.png
  [2]: https://i.stack.imgur.com/GDIzX.png",1618190546,https://stackoverflow.com/q/67051613,suribe06,"['neo4j', 'cypher', 'database', 'python', 'py2neo']"
67049827,Cypher Query (Neo4J): How to access a collection in PHP?,"this question might be stupid or I cannot find the right search phrase for google:

How would I access the elements of a collect with PHP?

Query:

      match (t:Transaction)-[:HAS_ORDERITEM]-&gt;(i:Item) return collect(distinct t.uuid) as tUUID;

I tried to access with foreach and the alias tUUID like 

        foreach($result AS $transactionDetail)
        {
            echo $transactionDetail[&#39;tUUID&#39;];
        }

Result:

    Uncaught Error: Object of class Everyman\Neo4j\Query\Row could not be converted to string

So the result is an array (Row Object), when I throw in a print_r I get a full result set with lots of information but I have no clue how to access the relevant information inside this array which is stored under &quot;[raw:protected]&quot;. Maybe I have worked too much and didn&#39;t see the obvious - so any hint is very appreciated.",1618172417,https://stackoverflow.com/q/67049827,Balael,"['php', 'cypher', 'neo4j']"
67045109,How to Create a Chain of Nodes Depending on a Property in Cypher,"I&#39;m having the following dataset in neo4j, representing metadata from the messaging app slack:

```
MERGE(abc:channel{name:&#39;abc&#39;})
MERGE(fgh:channel{name:&#39;fgh&#39;})
MERGE(a:message {text:&#39;a&#39;, ts:&#39;123.4&#39;, channel:&#39;abc&#39;})&lt;-[:contains]-(abc)
MERGE(b:message {text:&#39;b&#39;, ts:&#39;123.8&#39;, channel:&#39;abc&#39;})&lt;-[:contains]-(abc)
MERGE(c:message {text:&#39;c&#39;, ts:&#39;125.4&#39;, channel:&#39;abc&#39;})&lt;-[:contains]-(abc)
MERGE(d:message {text:&#39;d&#39;, ts:&#39;130.4&#39;, channel:&#39;abc&#39;})&lt;-[:contains]-(abc)
MERGE(e:message {text:&#39;e&#39;, ts:&#39;150.4&#39;, channel:&#39;abc&#39;})&lt;-[:contains]-(abc)

MERGE(f:message {text:&#39;f&#39;, ts:&#39;100.0&#39;, channel:&#39;fgh&#39;})&lt;-[:contains]-(fgh)
MERGE(g:message {text:&#39;g&#39;, ts:&#39;123.4&#39;, channel:&#39;fgh&#39;})&lt;-[:contains]-(fgh)
MERGE(h:message {text:&#39;h&#39;, ts:&#39;150.0&#39;, channel:&#39;fgh&#39;})&lt;-[:contains]-(fgh)
MERGE(i:message {text:&#39;i&#39;, ts:&#39;180.0&#39;, channel:&#39;fgh&#39;})&lt;-[:contains]-(fgh)
MERGE(j:message {text:&#39;j&#39;, ts:&#39;180.2&#39;, channel:&#39;fgh&#39;})&lt;-[:contains]-(fgh)
```

I want to create chains of messages in the following format:
`(a)&lt;-[:follows]-(b)&lt;-[:follows]-(c)&lt;-[:follows]-(d)&lt;-[:follows]-(e)`
`(f)&lt;-[:follows]-(g)&lt;-[:follows]-(h)&lt;-[:follows]-(i)&lt;-[:follows]-(j)`, based on the time they were written `ts`

I got the following code:
```
MATCH(msg:message)&lt;-[:contains]-(cs:channel)
UNWIND cs AS Channel
    WITH collect(msg.ts) AS  messagestimeline, COUNT(msg) AS nomsg, Channel
    ORDER BY messagestimeline 
    FOREACH (i IN RANGE (1, nomsg-1)|
        MERGE (previousmessage {ts:  messagestimeline[i-1], channel:  Channel.name })
        MERGE (nextmessage {ts: messagestimeline[i], channel: Channel.name })
        MERGE (nextmessage)-[rel:follows]-&gt;(previousmessage)
        SET rel.delta_t = toFloat(messagestimeline[i])-toFloat(messagestimeline[i-1])
    )
```
and get the result:
`(a)-[:follows]-&gt;(b)-[:follows]-&gt;(c)-[:follows]-&gt;(d)-[:follows]-&gt;(e)`
`(i)-[:follows]-&gt;(j)-[:follows]-&gt;(f)-[:follows]-&gt;(g)-[:follows]-&gt;(h)`

Interestingly, the result does not change when I add a `DESC` to the `ORDER BY` clause

Any help on what I am doing wrong would be greatly appreciated, I&#39;m sitting in front of this since 2 days and can&#39;t figure it out.",1618144885,https://stackoverflow.com/q/67045109,Florian Schummer,"['cypher', 'neo4j']"
67038551,Neo4j: Create a list of items when contain another item,"I want to create a new list (c2) out of intersection of Buy1 with an Item346
Buy1 : [Item 12, Item 23, Item 7, Item 562, Item 346, Item 85]

List I want to return (vsm representation)
c2 : [0, 0, 0, 0, 1, 0]

",1618083755,https://stackoverflow.com/q/67038551,user12678036,"['neo4j', 'vsm', 'cypher']"
67034759,Neo4j shortestPath does not work in reverse,"I follow the sample documentation of neo4j on how to calculate the shortestPath given my own network. In my network, for example, from point &quot;P1&quot; to point &quot;P13&quot;, I got the result path.  But when I set the source as &quot;P13&quot; and target as &quot;P1&quot;, I got no result.

I tried using the exact example from neo4j website as follows:
When the sourceNode is &quot;A&quot; and targetNode is &quot;F&quot;, it returns the shortest path result.
But when the sourceNode is &quot;F&quot; and targetNode is &quot;A&quot;, the shortest path return empty array.

[![enter image description here][1]][1]

[![enter image description here][2]][2]

  [1]: https://i.stack.imgur.com/o5r4J.png
  [2]: https://i.stack.imgur.com/AyCdH.png",1618060492,https://stackoverflow.com/q/67034759,iPhoneJavaDev,"['graph-algorithm', 'neo4j']"
67033716,Neo4j max function,"I am trying to search **the latest Ubuntu version** in [the “Network and IT Management” database from Neo4j sandbox][1]. 

So I wrote this piece of code:

    MATCH (os:OS) WHERE os.name = &quot;Ubuntu&quot; RETURN max(os.versions)

But the result is:

    [&quot;14.04&quot;, &quot;16.04&quot;, &quot;16.10&quot;, &quot;17.04&quot;]

I suppose I have got all the version. How can I solve it?

Thank you for your attention!

  [1]: https://neo4j.com/sandbox-v2/",1618053192,https://stackoverflow.com/q/67033716,alyferryhalo,['neo4j']
67030601,Difficulty using UNWIND in Neo4j,"I am very new to Neo4j, so this is probably a simple question.
I have several hundred nodes with a property &quot;seq&quot; (for sequence). This number basically represents the day of the month. So all of these several hundred nodes have a seq property between 1 and 31. I want to combine all the nodes with the same seq into a single node - so that all the nodes with seq = 1 are combined into a &quot;January 1&quot; node. All nodes with seq =2 are combined into a &quot;January 2&quot; node, etc. I have a property of &quot;pat_id&quot; that will be combined into an array from all the merged noes for a day.

Here is my code:

    WITH range(1,31) as counts
    UNWIND counts AS cnt
    MATCH (n:OUTPT {seq:cnt})
    WITH collect(n) AS nodes
    CALL apoc.refactor.mergeNodes(nodes, {properties: {
    pat_id:&#39;combine&#39;,
    seq:&#39;discard&#39;}, mergeRels:true})
    YIELD node
    RETURN node

I initially tried to do this with a FOREACH loop, but I can&#39;t do a MATCH inside a FOREACH.
I have been doing an UNWIND, but it is only merging the nodes with the first value (seq = 1). I assume this is because the RETURN statement ends the loop. But when I remove the RETURN statement, I get this error:

Query cannot conclude with CALL (must be RETURN or an update clause) (line 5, column 1 (offset: 99))
&quot;CALL apoc.refactor.mergeNodes(nodes, {properties: {&quot;

Any help would be appreciated.",1618026292,https://stackoverflow.com/q/67030601,doc,['neo4j']
67030472,Multi-level full-text search in Neo4j,"When I call db.index.fulltext.queryNodes() on an index, can I run another full-text query on the result? I need to search my database on 7-8 different properties across different Labels with different search parameters for each property. How do I go about it? If I use the reduce() function or  apoc.coll.intersection  and try to get an intersection, like...

    CALL db.index.fulltext.queryNodes(&quot;first_name&quot;, &quot;manas~&quot;) 
    YIELD node as first_names
    WITH collect(first_names) as first_name_list
    CALL db.index.fulltext.queryNodes(&quot;aliases&quot;, &quot;boncha~&quot;) 
    YIELD node as aliases
    WITH collect(aliases) as alias_list,first_name_list
    RETURN apoc.coll.intersection(first_name_list, alias_list) AS output
    LIMIT 5

wouldn’t that cause memory bloat?",1618024525,https://stackoverflow.com/q/67030472,Sanjay Singh,"['neo4j', 'fulltext-index']"
67023272,Neo4j importing: local database vs aura database,"I created a script with python to insert 20.000 nodes and 30.000 relationships.

Using the same script, if I import these data in a locally neo4j database created with Neo4j Desktop, I take 1 minutes; on the other side, if I use a neo4j database with Aura, I take 15 minutes.

Why this difference? I have tried with a server with 8GB of memory and 2 CPU.",1617979578,https://stackoverflow.com/q/67023272,dav04,"['neo4j', 'performance', 'neo4j-aura']"
67022604,Spring does not find the symbol @QueryResult,"I am working on linking a Neo4J database to a spring-data application. I would like to add an annotation @QueryResult to a class but it says java: cannot find symbol. And, I cannot import org.springframework.data.neo4j.annotation

In my pom.xml I have :

    &lt;dependency&gt;
         &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
         &lt;artifactId&gt;spring-boot-starter-data-neo4j&lt;/artifactId&gt;
    &lt;/dependency&gt;


Thank you for your help and answers.",1617977202,https://stackoverflow.com/q/67022604,Iza,"['spring-data', 'java', 'neo4j', 'spring-data-neo4j']"
67021622,Py2neo updateing existing node,"I&#39;ve been trying to update an existing node using py2neo.
Some things worth metionioning:
```
OS: Arch Linux x86_64
python version: 3.8
py2neo version: 2021.0.1
ne4j version: 4.2.1
flask version: 1.1.2
Application is running inside a docker container, the actual flask website is on port 5000, neo4j interface is on port 7474 and flask connects to port 7687 (neo4j)
```


Here are a few methods I&#39;ve tried:

1)
```
def update_node(self, node_name: str, node_group: str, property_update: dict):
    return self.name_search_person(node_name=node_name, node_group=node_group).update(**property_update)
```

2)
```
def update_node(self, node_name: str, node_group: str, property_update: dict):
        node_to_update = self.name_search_person(node_name=node_name, node_group=node_group)
        if node_to_update:
            node_to_update.update(**property_update)
            self.g.push(node_to_update)
        del node_to_update
        return &#39;successfully updated node&#39;
```
At the 2nd method I&#39;ve tried with the following function calls:
```
graph_db.update_node(node_name=&#39;Andrei&#39;, node_group=&#39;Person&#39;, property_update={&#39;name&#39;: t[&#39;Updated&#39;]})
```
(this just returns NameErrror: name &#39;t&#39; is not defined (I&#39;ve seen this [Here][1])

and
```
graph_db.update_node(node_name=&#39;Andrei&#39;, node_group=&#39;Person&#39;, property_update={&#39;name&#39;:&#39;Updated&#39;})
```

Am I doing something wrong with the function calls or is the actual updating function not working by some reason?


  [1]: https://stackoverflow.com/a/64159154/10538034",1617973192,https://stackoverflow.com/q/67021622,Andrei Cristian TUDOR,"['neo4j', 'flask', 'py2neo', 'python', 'docker']"
67021124,Match on relationship py2neo ogm,"I have the following query which uses a mixture of cypher and py2neo ogm.
Is it possible to move the where clause into purely py2neo ogm syntax.

    FeedItem.match(graph).where(&quot;(_)-[:SOURCE]-&gt;(:Feed {url:\&quot;%s\&quot;})&quot;%feed.url)
In the documentation for match there do seem to be other options inside the match query. The example uses labels but there is also predicates which lead me to try something like the following:

    FeedItem.match(graph,predicates=[RelatedTo(feed, &quot;SOURCE&quot;)])
From https://py2neo.org/2021.0/ogm/index.html:

&gt; class py2neo.ogm.ModelMatch(graph, labels=frozenset({}),
&gt; predicates=(), order_by=(), skip=None, limit=None)",1617971091,https://stackoverflow.com/q/67021124,jhylands,"['neo4j', 'py2neo']"
67018692,Get a list of nodes and relationships using spring @Query,"I am trying to make my own visualisation of schemes stored in **Neo4j DB** using **Java Spring** and **React**. To visualise the scheme chosen by it&#39;s Id I need to get a list of nodes and relationships. How can I do it using **Java Spring** and **Cypher** query?

I tried to do smth like this:

**Scheme Entity:**
```java
@Node
public class Scheme {
    @Getter @Setter
    @Id
    private Long scheme_id;

    @Getter @Setter
    private String name;

    @Getter @Setter
    private String description;

    @Relationship(type = &quot;CONSISTS_OF&quot;, direction = Relationship.Direction.OUTGOING)
    private List&lt;Object&gt; objectList = new ArrayList&lt;&gt;();
}
```

**Scheme Controller:**
```java
@RestController
@RequestMapping(&quot;/api/scheme&quot;)
@CrossOrigin(&quot;*&quot;)
public class SchemeController {
    
    @Autowired
    private SchemeService schemeService;

    @GetMapping(&quot;/{id}/nodes&quot;)
    Mono&lt;List&lt;Node&gt;&gt; getNodesById(@PathVariable Long id) {
        return schemeService.findNodesById(id);
    }
}
```

**Node Class for Mapping:**
```java
@Getter @Setter
@AllArgsConstructor
@NoArgsConstructor
public class Node {
    
    @Getter @Setter
    private Long identity;

    @Getter @Setter
    private List&lt;String&gt; labels;

    @Getter @Setter
    private Map&lt;String, java.lang.Object&gt; properties;
}
```

**Scheme Service:**
```java
@Service
public class SchemeService {
    @Autowired
    SchemeRepository schemeRepository;

    public Mono&lt;List&lt;Node&gt;&gt; findNodesById(Long id) {
        return schemeRepository.findNodesById(id);
    }
}
```

**Scheme Repository:**
```java
public interface SchemeRepository extends ReactiveNeo4jRepository&lt;Scheme, Long&gt; {
    @Query(&quot;MATCH (s:Scheme)-[con:CONSISTS_OF]-&gt;(nod1:Object)-[rel:CONNECTED_TO*]-(nod2:Object) WHERE (s.scheme_id=$id) RETURN DISTINCT nod1;&quot;)
    Mono&lt;List&lt;Node&gt;&gt; findNodesById(Long id);
}
```

But I got this:

```json
{
    &quot;identity&quot;:null,
    &quot;labels&quot;:null,
    &quot;properties&quot;:null
}
```

To summarize, I want to get a lists like these (that I&#39;m getting just using Sypher query) when I make a get request for nodes and relationships:


```json
{
   &quot;identity&quot;:4,
   &quot;labels&quot;:[
      &quot;Object&quot;
   ],
   &quot;properties&quot;:{
      &quot;name&quot;:&quot;PC3&quot;,
      &quot;obj_id&quot;:4,
      &quot;type&quot;:1
   }
},
{
   &quot;identity&quot;:3,
   &quot;labels&quot;:[
      &quot;Object&quot;
   ],
   &quot;properties&quot;:{
      &quot;name&quot;:&quot;PC2&quot;,
      &quot;obj_id&quot;:3,
      &quot;type&quot;:1
   }
},
{
   &quot;identity&quot;:2,
   &quot;labels&quot;:[
      &quot;Object&quot;
   ],
   &quot;properties&quot;:{
      &quot;name&quot;:&quot;PC1&quot;,
      &quot;obj_id&quot;:2,
      &quot;type&quot;:1
   }
}
```  ",1617961147,https://stackoverflow.com/q/67018692,Kuchibecka,"['spring', 'neo4j', 'java']"
67017469,Querying virtual graphs in Neo4j,"I&#39;m extending Neo4j with some [user-defined procedures][1].
My procedures return [virtual graphs][2] and I&#39;m getting the visualisation that I want, but I&#39;m not able to query from it. The output has a *GraphResult* type created by [apoc][3].
Is there a way to query patterns from the virtual graph output?

What I what to do looks like the following: 

    CALL procedureThatReturnsVirtualGraph(param1, param2) YIELDS nodes, relationships
    MATCH *nodes and relationships pattern*
    WITH *some processing*
    RETURN *some results*

Thank you


  [1]: https://neo4j.com/docs/java-reference/4.1/extending-neo4j/procedures-and-functions/procedures/
  [2]: https://neo4j.com/labs/apoc/4.1/virtual/
  [3]: https://github.com/neo4j-contrib/neo4j-apoc-procedures/blob/4.2/core/src/main/java/apoc/result/GraphResult.java",1617956134,https://stackoverflow.com/q/67017469,HNO,"['cypher', 'neo4j-apoc', 'neo4j', 'property-graph', 'graph-databases']"
67015275,access remote neo4j with java,"I am trying to connect to a remote neo4j using java code. see this code:
```
		Driver driver = GraphDatabase.driver(url, AuthTokens.basic(username, password));
		Session session = driver.session();
		StatementResult result = session.run(query);

		ArrayList&lt;Map&lt;String, Object&gt;&gt; list = new ArrayList&lt;&gt;();
		while (result.hasNext()) {
			Record record = result.next();
			list.add(record.asMap());
		}
		session.close();
		driver.close();
```
I keep getting this with SSLException:
```
Apr 09, 2021 10:04:26 AM org.neo4j.driver.internal.logging.JULogger info
INFO: Direct driver instance 35238198 created for server address 89e9795b-eu-de.lb.appdomain.cloud:7687
Apr 09, 2021 10:04:33 AM org.neo4j.driver.internal.logging.JULogger info
INFO: Closing connection pool towards 89e9795b-eu-de.lb.appdomain.cloud:7687
Exception in thread &quot;main&quot; org.neo4j.driver.v1.exceptions.ServiceUnavailableException: Failed to establish connection with the server
	at org.neo4j.driver.internal.util.Futures.blockingGet(Futures.java:123)
	at org.neo4j.driver.internal.DriverFactory.verifyConnectivity(DriverFactory.java:349)
	at org.neo4j.driver.internal.DriverFactory.newInstance(DriverFactory.java:95)
	at org.neo4j.driver.v1.GraphDatabase.driver(GraphDatabase.java:141)
	at org.neo4j.driver.v1.GraphDatabase.driver(GraphDatabase.java:124)
	at com.ibm.research.appmod.mf.Neo4JClient.executeQuery(Neo4JClient.java:46)
	at com.ibm.research.appmod.mf.Neo4JClient.executeQuery(Neo4JClient.java:80)
	at com.ibm.research.appmod.mf.Neo4JClient.executeQuery(Neo4JClient.java:76)
	at com.ibm.research.appmod.mf.Neo4JClient.main(Neo4JClient.java:109)
	Suppressed: org.neo4j.driver.internal.util.ErrorUtil$InternalExceptionCause
		at org.neo4j.driver.internal.async.HandshakeHandler.transformError(HandshakeHandler.java:199)
		at org.neo4j.driver.internal.async.HandshakeHandler.exceptionCaught(HandshakeHandler.java:96)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeExceptionCaught(AbstractChannelHandlerContext.java:285)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeExceptionCaught(AbstractChannelHandlerContext.java:264)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireExceptionCaught(AbstractChannelHandlerContext.java:256)
		at org.neo4j.driver.internal.shaded.io.netty.handler.ssl.SslHandler.exceptionCaught(SslHandler.java:1030)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeExceptionCaught(AbstractChannelHandlerContext.java:285)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.notifyHandlerException(AbstractChannelHandlerContext.java:850)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:364)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)
		at org.neo4j.driver.internal.shaded.io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:286)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)
		at org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1414)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)
		at org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:945)
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:146)
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645)
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:580)
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:497)
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459)
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886)
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
		at java.lang.Thread.run(Thread.java:811)
Caused by: javax.net.ssl.SSLException: Received fatal alert: protocol_version
	at com.ibm.jsse2.k.a(k.java:19)
	at com.ibm.jsse2.aq.a(aq.java:604)
	at com.ibm.jsse2.aq.a(aq.java:192)
	at com.ibm.jsse2.aq.j(aq.java:161)
	at com.ibm.jsse2.aq.b(aq.java:303)
	at com.ibm.jsse2.aq.a(aq.java:316)
	at com.ibm.jsse2.aq.unwrap(aq.java:370)
	at javax.net.ssl.SSLEngine.unwrap(SSLEngine.java:11)
	at org.neo4j.driver.internal.shaded.io.netty.handler.ssl.SslHandler$SslEngineType$3.unwrap(SslHandler.java:292)
	at org.neo4j.driver.internal.shaded.io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1257)
	at org.neo4j.driver.internal.shaded.io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1159)
	at org.neo4j.driver.internal.shaded.io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1203)
	at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489)
	at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428)
	at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265)
	at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
	at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)
	at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)
	at org.neo4j.driver.internal.shaded.io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:286)
	at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
	at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)
	at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)
	at org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1414)
	at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)
	at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)
	at org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:945)
	at org.neo4j.driver.internal.shaded.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:146)
	at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645)
	at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:580)
	at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:497)
	at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459)
	at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886)
	at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:811)
```
I also tried this:
```
Config config = Config.builder()
                .withEncryption()
                .withTrustStrategy( Config.TrustStrategy.trustAllCertificates() )
                .build();
		Driver driver = GraphDatabase.driver(url, AuthTokens.basic(username, password),config);
		Session session = driver.session();
		StatementResult result = session.run(query);

		ArrayList&lt;Map&lt;String, Object&gt;&gt; list = new ArrayList&lt;&gt;();
		while (result.hasNext()) {
			Record record = result.next();
			list.add(record.asMap());
		}
		session.close();
		driver.close();
```
I have another app that is able to connect to the same neo4j. that is a springboot app, so that does not use direct queries like the avove code does .What do I need to do to make this work?

",1617944224,https://stackoverflow.com/q/67015275,rajmeet singh,"['java', 'neo4j']"
67014954,Neo4j randomly high CPU,"Neo4j 3.5.12 Community Edition&lt;br/&gt;
Ubuntu Server 20.04.2&lt;br/&gt;
RAM: 32 Gb&lt;br/&gt;
EC2 instance with 4 or 8 CPUs (I change it to accommodate for processing at the moment)&lt;br/&gt;
Database files: 6.5Gb&lt;br/&gt;
Python, WSGI, Flask

dbms.memory.heap.initial_size=17g&lt;br/&gt;
dbms.memory.heap.max_size=17g&lt;br/&gt;
dbms.memory.pagecache.size=11g

I&#39;m seeing high CPU use on the server in what appears to be a random pattern.  I&#39;ve profiled all the queries for the pages that I know that people are visiting at those times and they are all optimised with executions under 50ms in all cases.  The CPU use doesn&#39;t seem linked with user numbers which are very low at most times anyway (max 40 concurrent users). I&#39;ve checked all queries in cron jobs too.

I reduced the database notes significantly and that made no difference to performance.

I warm the database by preloading all nodes into ram with `MATCH (n) OPTIONAL MATCH (n)-[r]-&gt;() RETURN count(n.prop) + count(r.prop);`

The pattern is that there will be a few minutes of very low CPU use (as I would expect from this setup with these user numbers) and then processing on most CPU cores goes up to the high 90%s and the machine becomes unresponsive to new requests.  Changing to an 8CPU instance sorts it, but shouldn&#39;t be needed for this level of traffic.

[![enter image description here][1]][1]

I would like to profile the queries with query logging, but the community edition doesn&#39;t support that.

Thanks.


  [1]: https://i.stack.imgur.com/CpuKr.png",1617941372,https://stackoverflow.com/q/67014954,Doug,['neo4j']
67010354,Key error when adding data to a graph database using Neo4j. What does this error mean?,"I&#39;m following this guide: https://towardsdatascience.com/create-a-graph-database-in-neo4j-using-python-4172d40f89c4

and am getting an error message when running the add_authors(authors) and add_papers(df) functions:

        KeyError                                  Traceback (most recent call last)
    ~\anaconda3\lib\site-packages\pandas\core\indexes\base.py in get_loc(self, key, method, tolerance)
       2645             try:
    -&gt; 2646                 return self._engine.get_loc(key)
       2647             except KeyError:
    
    pandas\_libs\index.pyx in pandas._libs.index.IndexEngine.get_loc()
    
    pandas\_libs\index.pyx in pandas._libs.index.IndexEngine.get_loc()
    
    pandas\_libs\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()
    
    pandas\_libs\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()
    
    KeyError: 10000
    
    During handling of the above exception, another exception occurred:
    
    KeyError                                  Traceback (most recent call last)
    &lt;ipython-input-8-0d592471d0d9&gt; in &lt;module&gt;
         10 
         11 add_categories(categories)
    ---&gt; 12 add_authors(authors)
         13 add_papers(df)
    
    &lt;ipython-input-6-9e1a84525030&gt; in add_authors(rows, batch_size)
         16             RETURN count(*) as total
         17             &#39;&#39;&#39;
    ---&gt; 18     return insert_data(query, rows, batch_size)
         19 
         20 
    
    &lt;ipython-input-6-9e1a84525030&gt; in insert_data(query, rows, batch_size)
         28 
         29     while batch * batch_size &lt; len(rows):
    ---&gt; 30         res = conn.query(query, parameters= {&#39;rows&#39;:rows[(batch*batch_size+1)*batch_size].to_dict(&#39;records&#39;)})
         31         total += res[0][&#39;total&#39;]
         32         batch += 1
    
    ~\anaconda3\lib\site-packages\pandas\core\frame.py in __getitem__(self, key)
       2798             if self.columns.nlevels &gt; 1:
       2799                 return self._getitem_multilevel(key)
    -&gt; 2800             indexer = self.columns.get_loc(key)
       2801             if is_integer(indexer):
       2802                 indexer = [indexer]
    
    ~\anaconda3\lib\site-packages\pandas\core\indexes\base.py in get_loc(self, key, method, tolerance)
       2646                 return self._engine.get_loc(key)
       2647             except KeyError:
    -&gt; 2648                 return self._engine.get_loc(self._maybe_cast_indexer(key))
       2649         indexer = self.get_indexer([key], method=method, tolerance=tolerance)
       2650         if indexer.ndim &gt; 1 or indexer.size &gt; 1:
    
    pandas\_libs\index.pyx in pandas._libs.index.IndexEngine.get_loc()
    
    pandas\_libs\index.pyx in pandas._libs.index.IndexEngine.get_loc()
    
    pandas\_libs\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()
    
    pandas\_libs\hashtable_class_helper.pxi in pandas._libs.hashtable.PyObjectHashTable.get_item()
    
    KeyError: 10000




What does this error mean and how can I fix this?",1617908715,https://stackoverflow.com/q/67010354,Sebastien Fauque,"['neo4j', 'graph-databases', 'python', 'pandas']"
67008448,neo4j : Unable to get a routing table for database &#39;fabric.xxx&#39; because this database does not exist,"hope you are doing well,
Here is my problem :-

when i setup neo4j in centos everything was working as excepted but when i started to setup fabric shard it was working fine but when i run this query on fabric master it 

:use newfabric.db_name;

it show me error like :-

     **&quot;Unable to get a routing table for database &#39;newfabric.db_name&#39; because this database does not exist&quot;**

but this database exists on that machine.

Please tell me what to do now...i am stuck here
Here is details from fabric machine enter code here`:- 

OS : centos 7
Neo version: Neo4j 4.2

i have made these changes on fabric machine

    dbms.security.auth_enabled=true
    dbms.backup.listen_address=0.0.0.0:6362
    dbms.default_listen_address=0.0.0.0
    dbms.default_advertised_address=server_public_ip

    dbms.connector.bolt.enabled=true
    #dbms.connector.bolt.tls_level=DISABLED
    dbms.connector.bolt.listen_address=:7687
    dbms.connector.bolt.advertised_address=server_public_ip:7687

    # HTTP Connector. There can be zero or one HTTP connectors.
    dbms.connector.http.enabled=true
    dbms.connector.http.listen_address=:7474
    #dbms.connector.http.advertised_address=server_public_ip:7474

    dbms.mode=SINGLE
    fabric.database.name=newfabric
    fabric.routing.servers=server_public_ip:7687

    # January&#39;s shard
    fabric.graph.0.name=january2020
    fabric.graph.0.uri=neo4j://server_public_ip:port
    fabric.graph.0.database=db_name

    # february&#39;s shard
    fabric.graph.1.name=february2020
    fabric.graph.1.uri=neo4j://server_public_ip:port
    fabric.graph.1.database=db_name

on shard machines i have only opened this line 
    dbms.connector.bolt.advertised_address=server_public_ip:7687
 

Please help me on same ...!!!
Thanks a ton in advance 
",1617900444,https://stackoverflow.com/q/67008448,Pankaz Kumar,['neo4j']
67007556,Extract the nodes in a graph path ordered by a relation,"I&#39;m tasked to find a path and process the nodes in it, respecting their order in that same path (so the order is relation-induced).

Given a graph with the following nodes:

    CREATE (a:temporary {name: &#39;m2&#39;});
    CREATE (a:temporary {name: &#39;f1&#39;});
    CREATE (a:temporary {name: &#39;b3&#39;});
    CREATE (a:temporary {name: &#39;d4&#39;});
    
    CREATE (a:temporary {name: &#39;p5&#39;});
    CREATE (a:temporary {name: &#39;p6&#39;});
    CREATE (a:temporary {name: &#39;p7&#39;});
    
    CREATE (a:temporary {name: &#39;k1&#39;});
    CREATE (a:temporary {name: &#39;k2&#39;});
    
and the following relations:

    MATCH (a) WHERE a.name = &#39;b3&#39; MATCH (b) where b.name = &#39;m2&#39; CREATE (a)-[:KNOWS {type: &#39;sibling&#39;}]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;m2&#39; MATCH (b) where b.name = &#39;f1&#39; CREATE (a)-[:KNOWS {type: &#39;friend&#39;}]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;d4&#39; MATCH (b) where b.name = &#39;b3&#39; CREATE (a)-[:KNOWS {type: &#39;coworker&#39;}]-&gt;(b);

    MATCH (a) WHERE a.name = &#39;p7&#39; MATCH (b) where b.name = &#39;p6&#39; CREATE (a)-[:KNOWS {type: &#39;friend&#39;}]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;p6&#39; MATCH (b) where b.name = &#39;p5&#39; CREATE (a)-[:KNOWS {type: &#39;coworker&#39;}]-&gt;(b);

    MATCH (a) WHERE a.name = &#39;k1&#39; MATCH (b) where b.name = &#39;b3&#39; CREATE (a)-[:HAS]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;k1&#39; MATCH (b) where b.name = &#39;d4&#39; CREATE (a)-[:HAS]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;k1&#39; MATCH (b) where b.name = &#39;m2&#39; CREATE (a)-[:HAS]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;k1&#39; MATCH (b) where b.name = &#39;f1&#39; CREATE (a)-[:HAS]-&gt;(b);

    MATCH (a) WHERE a.name = &#39;k2&#39; MATCH (b) where b.name = &#39;p5&#39; CREATE (a)-[:HAS]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;k2&#39; MATCH (b) where b.name = &#39;p7&#39; CREATE (a)-[:HAS]-&gt;(b);
    MATCH (a) WHERE a.name = &#39;k2&#39; MATCH (b) where b.name = &#39;p6&#39; CREATE (a)-[:HAS]-&gt;(b);

Order of creations matters because I saw that Neo4j sorts results by id when no other ordering is in place, and that can give an hint: when the issued query is wrong nodes are returned in the wrong order.

You should come up with the following graphical representation:

![Resulting graph](https://i.postimg.cc/hj0FJhBP/neo4j-graph.png)

I need to extract the nodes owned by `k1` (and only those), in the order given by `knows`, so:

    f1 &lt;- m2 &lt;- b3 &lt;- d4

My aim is to obtain a result that can be processed by a program, so my first idea is an array like: `[f1, m2, b3, d4]`, but of course this may not be the best or be supported at all.

Please note that I need the head of the path too, `f1`, the node that has no outgoing `knows` relations.

The next step will be a query that returns pairs (node, relation props), because in the real graph the above is derived from, relations have properties that I need to process too.

So the complete result I want to obtain from the graph should be something like: `[[f1, {}], [m2, {type: friend}], [b3, {type: sibling}], [d4, {type: coworker}]]`

However, any result format that can be processed like in the below pseudocode will be fine:

    for x in [result] do:
        if(x.type.isEmpty) {
            // process the head
        } else if (x.type == &quot;friend&quot;) {
            // do something knowing this node is a friend of the preceding one
        } else ...

----

# UPDATE

After some attempts I came up with the following two queries.

(1) 

    match p=(a:temporary)-[:KNOWS*0..]-&gt;(b) 
    where not ()-[:KNOWS]-&gt;(a) and not (b)-[:KNOWS]-&gt;() 
    and exists { match (k)-[:HAS]-&gt;(a) where k.name=&#39;k1&#39; } 
    return p

The result of this one is a real path &amp;mdash; although intermediate nodes are repeated, i.e. `... {&quot;type&quot;:&quot;coworker&quot;},{&quot;name&quot;:&quot;b3&quot;},{&quot;name&quot;:&quot;b3&quot;},{&quot;type&quot;:&quot;sibling&quot;} ...`, and I can&#39;t tell if it&#39;s by design or I made a mistake &amp;mdash;, the returned result is only one and its elements are in the right order (although it starts from the tail, but I guess that can easily handled in a program), feels more &quot;natural&quot; as a result from a graph, and more safe (no risk that an error could appear later, after the graph had grown with usage):

    ╒══════════════════════════════════════════════════════════════════════╕
    │&quot;p&quot;                                                                   │
    ╞══════════════════════════════════════════════════════════════════════╡
    │[{&quot;name&quot;:&quot;d4&quot;},{&quot;type&quot;:&quot;coworker&quot;},{&quot;name&quot;:&quot;b3&quot;},{&quot;name&quot;:&quot;b3&quot;},{&quot;type&quot;│
    │:&quot;sibling&quot;},{&quot;name&quot;:&quot;m2&quot;},{&quot;name&quot;:&quot;m2&quot;},{&quot;type&quot;:&quot;friend&quot;},{&quot;name&quot;:&quot;f1&quot;│
    │}]                                                                    │
    └──────────────────────────────────────────────────────────────────────┘

(2) 

    match p=(a)-[:KNOWS*0..]-&gt;(b)
    where 
    not (b)-[:KNOWS]-&gt;()
    and exists { match (k)-[:HAS]-&gt;(a) where k.name=&#39;k1&#39; }
    with  a, head(relationships(p)) as h, size(relationships(p)) as s
    return a, h, s
    order by s

This instead gives the results in the shape I want (pairs of (node, relationship) &amp;mdash; disregard the `s` column, it&#39;s there just to check its value), though in fact finds several paths (all those from each node in the group _known_ by `k1` that go to the head `f1`) and I need to manipulate each of them to pair a node with its closest relationship and order the results from the closest to the head to the farthest):

    ╒═════════════╤═══════════════════╤═══╕
    │&quot;a&quot;          │&quot;h&quot;                │&quot;s&quot;│
    ╞═════════════╪═══════════════════╪═══╡
    │{&quot;name&quot;:&quot;f1&quot;}│null               │0  │
    ├─────────────┼───────────────────┼───┤
    │{&quot;name&quot;:&quot;m2&quot;}│{&quot;type&quot;:&quot;friend&quot;}  │1  │
    ├─────────────┼───────────────────┼───┤
    │{&quot;name&quot;:&quot;b3&quot;}│{&quot;type&quot;:&quot;sibling&quot;} │2  │
    ├─────────────┼───────────────────┼───┤
    │{&quot;name&quot;:&quot;d4&quot;}│{&quot;type&quot;:&quot;coworker&quot;}│3  │
    └─────────────┴───────────────────┴───┘

AS of now I can&#39;t tell with one it the correct one to use.",1617897046,https://stackoverflow.com/q/67007556,watery,"['cypher', 'graph-traversal', 'neo4j']"
67004204,Stop cypher traversal when link is found,"For the sake of example: I am trying to find out which people know a celebrity within `n` connections.
My graph has 2 types of nodes: `NormalPerson`, `Celebrity`, both have the attribute `name`. There is only one kind of connection: `KNOWS`.

This is the code that I wrote with `n` = 3 and it gives the desired result:
```Cypher
MATCH (np:NormalPerson)-[:KNOWS*..3]-(c:Celebrity)
RETURN DISTINCT(np.name)
```

The problem with this is that as `n` gets larger the query starts running really slow. Now the important part is that we do not care what celebrity someone knows, we just want to know whether they do or not. That means that we can stop looking for more celebrities once we know that a person knows one. I was hoping this that this reasoning would save time, but I am unsure how to implement this. I tried the following, but it took longer than the previous method:
```Cypher
MATCH (np:NormalPerson), (c:Celebrity)
WHERE EXISTS((np)-[:KNOWS*..3]-(c))
RETURN DISTINCT(np.name)
```

What would be the fastest way to get these results?
",1617885634,https://stackoverflow.com/q/67004204,Loic RW,"['neo4j', 'cypher']"
67003920,CREATE RELATIONSHIP in cypher based on a conditions,"I have two dates D1, D2 and a list of dates - DATESLIST. I want to create a relationship only when two conditions are satisfied.
1) All dates between D1 and D2 are not in DATESLIST
2) All dates between D1 and D2 are not weekends

the psuedocode of the same would look something like:

    flag = 0
    for d in range(D1, D2):
        if d not in DATESLIST and not d.isweekend():
           flag = 1
           break
    if flag == 0:
       CREATE RELATIONSHIP
    

D1, D2 and DATESLIST are all obtained from as a result of a MATCH query.

I have thought of using apoc.do.when() along with a CALL construct, but I am unable to think of the syntax that would help me implement the flag and break logic.

Thanks in advance.
Please let me know if you have any questions.",1617884607,https://stackoverflow.com/q/67003920,Kshitij ,"['neo4j', 'cypher']"
67001373,Neo4j - Problem with update a list with a other list,"i have two lists and with the second list i want to update the first list.

in List1&lt;Map&gt; a item has something like:

    out_type: &quot;organizational_unit&quot;,
    edge_type: &quot;has_account&quot;,
    in_type: &quot;account&quot;,
    out_min: 1,
    out_max: 1,
    in_min: 1,
    in_max: 17

in List2&lt;Map&gt; a item has something like:

    out_type: &quot;organizational_unit&quot;,
    edge_type: &quot;has_account&quot;,
    in_type: &quot;account&quot;,
    out_min: 0

As i said, i want to update all matching items of list1 (list1.out_min) with all existing items of list2 (list2.out_min). So when in list1 my out_min = 17, it should be 0 after.

This Query i tried:

    with list1, list2
    unwind list1 as l1
    with list1 as origin, list2, l1
    unwind list2 as l2
    with distinct CASE
    WHEN l1.out_type = l2.out_type and l1.edge_type = l2.edge_type and l1.in_type = l2.in_type
    THEN {out_min: l2.out_min, out_max: l1.out_max, out_type: l1.out_type, edge_type: l1.edge_type, 
    in_type: mm.in_type, in_min: mm.in_min, in_max: mm.in_max}
    ELSE l1
    END as list1, list2, origin
    return origin as origin_list1, list2, collect(list1) as new_list1

Unfortunately all updated entries shows up twice now. One time with my correct update, and second time with a non updated entry. 

[![Result][1]][1]

It makes sense to me that it is so, because during the unwind i will have a a guaranteed match and all the other &quot;non-matches&quot; will going directly in the ELSE Part of my CASE... My Problem now is, that i have absolutly no idea, how to solve this. is it possible at all to merge the lists this way? How i can avoid the &quot;old&quot; List entry?

Thanks for your help :).


  [1]: https://i.stack.imgur.com/q2Jzj.png",1617874944,https://stackoverflow.com/q/67001373,ottonormal,"['cypher', 'neo4j']"
67001199,Create nodes conditionally when loading nodes from csv in Neo4j,"I have a data set in csv format. One of the fields is &quot;elem_type&quot;. Based on this type I need to create different types nodes and give to the &quot;columns&quot; of my csv a different name based on the &quot;elem_type&quot; when loading the data using csv load, any way to do that?

My csv has no header and the data look like this:

    0, 123, Marco, Ciao
    1, 345, Merceds, Car, Yellow
    2, 987, Boat, 150cm

Based on the first colmuns that is my &quot;elem_type&quot; i want to load the data and define 3 types of nodes (Person, Car, Boat) and also based on the elem_type define different header",1617874320,https://stackoverflow.com/q/67001199,zummino,"['csv', 'neo4j']"
67000513,How can i fail Neo4j transaction if validation query fails,"I have a Neo4j transaction that is composed from several cypher queries.

for idempotency sake, i&#39;d like to include a validation query that will fail the transaction if needed.

any idea how can i do that?

i was looking how to return an error or throw exception but it doesn&#39;t seem so popular as i cant find anything about it

whats the best practice that is recommended here?",1617871969,https://stackoverflow.com/q/67000513,danfromisrael,"['database', 'transactions', 'cypher', 'neo4j']"
66997615,Efficiently update neo4j with large csv file in java,"I am new to neo4j. I have a CSV file of size 300 MB in AWS s3 bucket, with the CSV file I want to update my neo4j database by creating relationships and updating few properties. I am using 
```
USING PERIODIC COMMIT 500 
LOAD CSV WITH HEADERS FROM + url +
as row
```

This neo4j will be for production so there should be a minimum load on this. I want to know whether all these 300 MB will be loaded into the server ram when loading the CSV, or it will load only 500 rows in ram and will keep other things in secondary memory. And whether 500 size should be appropriate for best performance or it should be more.

And also what if I break down the CSV file into multiple CSV files of size 50k rows each and update neo4j from all these csvs, which approach is better?",1617858126,https://stackoverflow.com/q/66997615,Asim,"['neo4j', 'java', 'cypher']"
66995814,"cypher query: return recipes rated by certain users, containing specific ingredients, ordered by number of recipes repeated in the result","I am writing the below cypher query to return a few recipes with following conditions: 

 1. There is user 2203 and I can find similar users based on the sim_score.
 2. Once the similar users are defined, I need to get a list of recipes that they rated.
 3. The recipes from 2. should include all the following ingredients [&#39;turmeric&#39;, &#39;salt&#39;].
 4. Recipes, then, should be ordered by the number of times that it showed up in the 1. (e.g. userB rated recipe 1,2,3 and userC rated recipe 2,4,5 =&gt; recipe 2 should be ordered first).

How can I do this? 

```
query = &quot;&quot;&quot;
    MATCH(u:USER {user:&quot;2203&quot;})-[s:SIMILARITY]-&gt;(u2:USER)-[:RATED]-&gt;(r:RECIPE)
    WITH count(r) as n_recipe
    WITH [&quot;turmeric&quot;, &quot;salt&quot;] as ingredients
    WHERE exists((r.recipe)-[:CONTAINS]-&gt;(:INGREDIENT {name:ingredients}))
    return r.recipe
    ORDER BY n_recipe
    LIMIT 10
    &quot;&quot;&quot;
graph.run(query)
```",1617841695,https://stackoverflow.com/q/66995814,dngheelee,"['neo4j', 'cypher']"
66995366,neo4j -- how to define a intermediate relation type?,"
```cypher
create(h1:Node{id:&quot;host1&quot;}),(h2:Node{id:&quot;host2&quot;}),(h3:Node{id:&quot;host3&quot;}),(c1:Conn),(c2:Conn),(c1)-[:from]-&gt;(h1),(c1)-[:to]-&gt;(h2),(c2)-[:from]-&gt;(h2),(c2)-[:to]-&gt;(h3)

match(h1:Node{id:&quot;host1&quot;}),(h3:Node{id:&quot;host3&quot;})
create (a1:APP{id:&quot;app1&quot;}),(a2:APP{id:&quot;app2&quot;}),(a1)-[:Deploy_on]-&gt;(h1),(a2)-[:Deploy_on]-&gt;(h3)

```
the data like 
[ethe data like][1]
[enter image description here][https://i.stack.imgur.com/XrFOn.png]

I want to define a intermediate relation type, but it&#39;s unwork.
```cypher
match conn_to=(src:Node)&lt;-[:from]-(c1:Conn)-[:to]-&gt;(des:Node)
with conn_to
match(a1:App)-[:Deploy_on]-&gt;()-[:conn_to*2]-&gt;()&lt;-[:Deploy_on]-(a2:App)
return a1,a2
```



I want t get the result is app1 and app2.


  [1]: https://i.stack.imgur.com/IVdV3.png
  [2]: https://i.stack.imgur.com/XrFOn.png",1617837621,https://stackoverflow.com/q/66995366,thirsd,"['relation', 'neo4j']"
66989328,Unwinding two lists and matching row indices together?,"How can I unwind two lists and match the results using their indices? I have the code below:

    UNWIND [SPAT, TNAVPS, UPBT] AS metapart1
    UNWIND [cell2.content] AS metapart2

metapart1 represents a list of 3 strings that were defined earlier on in the query (which I can&#39;t show due to confidential reasons), while metapart2 comprises of only three possible values given the conditions stated earlier in the query. For clarity, the values are 273.3, 192.1, and 2.97. I want to map elements from the two lists together specifically such that metapart1 + metapart2 results in a desired output; e.g. &#39;value of SPAT is 273.3&#39;, &#39;value of TNAVPS is 192.1&#39;, but not return &#39;value of TNAVPS is 273.3&#39; if that makes sense.

I&#39;m cognisant of the fact that UNWINDing two lists results in the output being every permutation of elements from each list (e.g. unwinding [1,2,3] and [4,5,6] results in 1 and 4, 1 and 5, 1 and 6, 2 and 4, etc.) but I don&#39;t know how to work around this in any way.

For additional clarity, cell2.content is specified in the main bulk of the query so I can&#39;t define it with a WITH clause at the start of the query, so not really sure what to do

Can someone please help?",1617809511,https://stackoverflow.com/q/66989328,Tous Shahedian-Farid,"['cypher', 'neo4j']"
66983553,How to return the number of occurrences of a word for each row in Neo4J?,"I&#39;m currently trying to return 1) all nodes that contain the word &#39;strategy&#39; or a synonym of &#39;strategy&#39; and 2) for each row returned, have a count of the number of times the target word(s) appears in that particular node. I&#39;ve tried the following (with confidential information blurred out) and the counts are strangely high like 180:

    MATCH (l:Label)&lt;-[:CONTAINS]-(pdf:Pdf)&lt;-[*1..9]-(title:Title)&lt;-[*1..9]-(text), 
     (s)-[:SYNONYM_OF]-&gt;(s1:Seed_Term {name: &quot;Strategy&quot;}) 
     WHERE l.name=x AND (text.content CONTAINS s.name) 
     OR (text.content CONTAINS s1.name) 
     OR (text.content CONTAINS toLower(s.name)) 
     OR (text.content CONTAINS toLower(s1.name)) 
     RETURN COALESCE(&quot;text: &quot;, &quot;&quot;) + text.content as text, 
     COUNT(s.name) + COUNT(s1.name) as count 
     order by count desc LIMIT 1

I also tried using apoc.coll.occurrences(s.name, text.content) but I got a weird &#39;pipeline locked&#39; error. If anyone could help on providing a workaround that would be great.

Thanks.
",1617788850,https://stackoverflow.com/q/66983553,Tous Shahedian-Farid,"['neo4j', 'neo4j-apoc', 'cypher']"
66979866,Can&#39;t use the added function in Repository,"I&#39;m using Spring Data Neo4j 2.4.4 for my project. This is some in project: 

**User**:

[![enter image description here][1]][1]


**UserRepository**:

[![enter image description here][2]][2]


I can still use the built-in functions in Repository such as save(), findAll(),... but when I add and use some functions, for example &quot;existsByUsername&quot;, it has error: 

    11:53:26.562 [http-nio-8081-exec-1] WARN  o.s.d.n.c.Neo4jPersistenceExceptionTranslator - Don&#39;t know how to translate exception of type class org.neo4j.driver.exceptions.NoSuchRecordException
Then, I try to add query for function, it is still
[![enter image description here][3]][3]

Could you help me to determine this error and give me a solution? Thank you!\

*Updated:* 
I call API in Postman, I received this result while my DB has only 1 user:

    {
        &quot;error&quot;: &quot;Records with more than one value cannot be converted without a mapper.; nested exception is java.lang.IllegalArgumentException: Records with more than one value cannot be converted without a mapper.&quot;
    }

  [1]: https://i.stack.imgur.com/I4d87.png
  [2]: https://i.stack.imgur.com/WLquP.png
  [3]: https://i.stack.imgur.com/9zzu3.png
",1617772103,https://stackoverflow.com/q/66979866,Trần Tuấn Anh,"['spring-data-neo4j', 'spring', 'neo4j', 'spring-boot']"
66975236,GraphQL Mutation: How to add current time in a Neo4j node property?,"I have a type in my GraphQL schema like this:
 

    type SAVEDNODE {
        id: ID!
        date: LocalDateTime
        createdAt: DateTime
    }

I would like to add a property to a node that will be created in Neo4j thanks to a mutation with GraphQL.

I tried this to have the current time created in nodes when a mutation is called:

    type mutation {
        MergeSAVEDQUERY(id:ID!, date:_Neo4jDateTimeInput, createdAt:DateTime): SAVEDNODE @cypher(statement: 
        &quot;&quot;&quot;Merge (q:SAVEDQUERY {id:$id})
           ON MATCH SET q.date=$date, q.createdAt = datetime()
           WITH EXISTS($k) AS key
           ON CREATE SET q.date=$date, q.createdAt = datetime()
           RETURN q
        &quot;&quot;&quot;)
    }

In a node created I have the property date created with the current date but have this:

    &quot;date&quot;: &quot;2021-04-06T00:00:00Z&quot; 

I don&#39;t understand why I only have zeros after 06.

How can I do to have the current exact time when I do the mutation request ?",1617737051,https://stackoverflow.com/q/66975236,jos97,"['grandstack', 'neo4j', 'graphql']"
66969487,How can I solve following query in Neo4j? List the Names of the projects belonging to department managed by employee “…….”,"
List the Names of the projects belonging to department managed by employee 

    relations:
    Works_in : employee works in a department
    Has_acquired: employee has acquired a skill
    Assigned_to : employee assigned to a project
    Controlled_by: A project is controlled by a department
    Project_manager : Employee is a project_manager of a Project",1617715264,https://stackoverflow.com/q/66969487,Dipali Meher,['neo4j']
66951346,How to load yelp dump file in neo4j desktop?,"I&#39;m using Neo4j Desktop Version 1.4.3. I&#39;ve created a new project named &quot;Yelp Project&quot;, then uploaded the yelp dump file in it, but I&#39;m not getting the option &quot;Create new DBMS from dump&quot;. So I selected Add --&gt; Local DBMS and created a database. But when I open Neo4j Browser, there are no nodes and relationships. I&#39;m not able to figure out how to get this done, can someone help [refer image][1] 


  [1]: https://i.stack.imgur.com/bWBkf.jpg",1617617384,https://stackoverflow.com/q/66951346,Kevin,"['neo4j-apoc', 'dump', 'neo4j', 'neo4j-desktop', 'neo4j-browser']"
66950314,Errors during configuration of the neo4j django-neomodel,"I&#39;m trying to do a simple project in Django using the Neo4j database. I&#39;ve installed a `django-neomodel` library, set the settings as follows:
```
import os
from neomodel import config

db_username = os.environ.get(&#39;NEO4J_USERNAME&#39;)
db_password = os.environ.get(&#39;NEO4J_PASSWORD&#39;)

config.DATABASE_URL = f&#39;bolt://{db_username}:{db_password}@localhost:7687&#39;
```

created a model:
```python
class Task(StructuredNode):
    id = UniqueIdProperty()
    title = StringProperty()
```
added `&#39;django_neomodel&#39;` to `INSTALLED_APPS`, removed the default database configuration and when I try to enter the website it raises the error: `ImproperlyConfigured at /
settings.DATABASES is improperly configured. Please supply the ENGINE value. Check settings documentation for more details.`.

It&#39;s the only error because after running the `python manage.py install_labels` command it raises: `ServiceUnavailable(&quot;Failed to establish connection to {!r} (reason {})&quot;.format(resolved_address, error))
neo4j.exceptions.ServiceUnavailable: Failed to establish connection to IPv6Address((&#39;::1&#39;, 7687, 0, 0)) (reason [Errno 99] Cannot assign requested address)`.

I&#39;m pretty sure that the database works correctly because as you see I can access this. [screenshot][1]

docker-compose:
```yaml
version: &quot;3.9&quot;

services:
  api:
    container_name: mm_backend
    build:
      context: ./
      dockerfile: Dockerfile.dev
    command: pipenv run python manage.py runserver 0.0.0.0:8000
    volumes:
      - ./:/usr/src/mm_backend
    ports:
      - 8000:8000
    env_file: .env
    depends_on: 
      - db

  db:
    container_name: mm_db
    image: neo4j:4.1
    restart: unless-stopped
    ports:
      - &quot;7474:7474&quot;
      - &quot;7687:7687&quot;
    volumes:
      - ./db/data:/data
      - ./db/logs:/logs
```


  [1]: https://i.stack.imgur.com/VtBgG.png",1617612103,https://stackoverflow.com/q/66950314,Sevy,"['neomodel', 'django', 'neo4j', 'python', 'docker']"
66948355,graph regression detection in neo4j,"I&#39;ve had a graph with such dimensions

    75 millions of nodes
    238 millions of relationships

for several years. 

I regenerate it periodically from external data (by importing csv).

Then I do batches of **allshortestpaths** searches, single search take several milliseconds. But whole batch of 100k searches usually took 5-10 minutes.

Some time ago batch searches became several times slower - always 30++ minutes.

Are there any tools to investigate the problem? I use cypher and java driver, there were no neo4j updates at that time (now 4.0.11)

I tried beefier server with Oracle linux instead of Debian, and neo4j 4.2.4 instead of 4.0.11, but that didn&#39;t help. So, the problem is probably inside the graph.

I&#39;ve set logging for slow searches, but there are no searches slower than dozens of milliseconds. Unfortunatelly, I cannot revert to old (faster) graph to measure mean time.


UPDATE:

Old search

    MATCH (one:Obj{oid:&#39;id1&#39;}) with one MATCH (two:Obj{oid:&#39;anyOf100kId&#39;}), path=allshortestPaths((one) -[*0..4]-(two)) WHERE ALL (x IN RELATIONSHIPS(path) WHERE x.val&lt;130) return path limit 100;
    +----------------------------------------------------------------------------------------------------------+
    | Plan      | Statement   | Version      | Planner | Runtime       | Time | DbHits | Rows | Memory (Bytes) |
    +----------------------------------------------------------------------------------------------------------+
    | &quot;PROFILE&quot; | &quot;READ_ONLY&quot; | &quot;CYPHER 4.2&quot; | &quot;COST&quot;  | &quot;INTERPRETED&quot; | 44   | 82495  | 7    | 7707104        |
    +----------------------------------------------------------------------------------------------------------+
    
    
    +----------------------------+-------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
    | Operator                   | Details                                                                                         | Estimated Rows | Rows | DB Hits | Memory (Bytes) | Page Cache Hits/Misses |
    +----------------------------+-------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
    | +ProduceResults@graph.db   | path                                                                                            |              1 |    7 |     224 |                |                    0/0 |
    | |                          +-------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
    | +Limit@graph.db            | 100                                                                                             |              1 |    7 |       0 |                |                    0/0 |
    | |                          +-------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
    | +ShortestPath@graph.db     | path = (one)-[anon_112*0..4]-(two) WHERE all(x IN RELATIONSHIPS(path) WHERE x.val &lt; $autoint_2) |              1 |    7 |   82267 |        7707104 |                    0/0 |
    | |                          +-------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
    | +CartesianProduct@graph.db |                                                                                                 |              1 |    1 |       0 |                |                    0/0 |
    | |\                         +-------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
    | | +NodeIndexSeek@graph.db  | two:Obj(oid) WHERE oid = $autostring_1                                                          |              1 |    1 |       2 |                |                    0/0 |
    | |                          +-------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
    | +NodeIndexSeek@graph.db    | one:Obj(oid) WHERE oid = $autostring_0                                                          |              1 |    1 |       2 |                |                    0/0 |
    +----------------------------+-------------------------------------------------------------------------------------------------+----------------+------+---------+----------------+------------------------+
    
    7 rows available after 0 ms, consumed after another 44 ms

Now I&#39;ve switched to parameters + UNWIND, but see no difference.

In java List&lt;String&gt; I put 100k ids, then 

    final String qu = &quot;MATCH (one:Obj {oid: &#39;id1&#39; }) WITH one UNWIND $batch AS row MATCH (two:Obj {oid:row}), path=allshortestPaths((one) -[*0..4]-(two)) WHERE ALL (x IN RELATIONSHIPS(path) WHERE x.val&lt;130) return path limit 10000&quot;;
    
    Result r = session.run(qu, parameters(&quot;batch&quot;, orgs));

Search didn&#39;t stop even after 30 minutes. Also separate searches are better, because I can break the loop and at least process partial results.

So, any ideas? 1 month ago it worked much faster.",1617598082,https://stackoverflow.com/q/66948355,Oleg Gritsak,"['java', 'neo4j']"
66945280,Set property with value based on maxium value of this property in all nodes in Neo4j,"I would like to set &#39;id&#39; property for each &#39;Sc&#39; node which doesn&#39;t contain that property. Value for each property should be greater by 1 than actual maximal value of this property in all &#39;Sc&#39; nodes. How to achieve that? I came up with this query, but using MAX isn&#39;t allowed with SET. 

    MATCH p=(s:Sc)
    WHERE NOT exists(s.id)
    FOREACH(skl in nodes(p) | SET skl.id = MAX(toInteger(s.id))+1)


",1617565730,https://stackoverflow.com/q/66945280,nervoustimewaster,"['nodes', 'cypher', 'neo4j', 'max']"
66943237,Failed to invoke procedure `netscan.find_communities`: Caused by: java.lang.NoSuchMethodError: &#39;org.neo4j.graphdb.Result org.neo4j.graphdb.GraphDataba,"i found syntax for community detection from https://github.com/vitorhorta/netscan-neo4j
and I found this syntax 
**CALL netscan.find_communities(&#39;Person&#39;,&#39;LIKES&#39;, &#39;id&#39;,&#39;weight&#39;, &#39;INCOMING&#39;, true, 0.5, 5, 1);**

When i tried to run this algorithm there&#39;s is a problem like this: 

**Neo.ClientError.Procedure.ProcedureCallFailed**

**Failed to invoke procedure netscan.find_communities: Caused by: java.lang.NoSuchMethodError: &#39;org.neo4j.graphdb.Result org.neo4j.graphdb.GraphDatabaseService.execute(java.lang.String)&#39;**

I have installed plugin netscan-1.0.0 and put it on plugins folder on neo4j and that problem always appearing.
Any hint?",1617552255,https://stackoverflow.com/q/66943237,1872058 Aldrich Sancho Sapata ,['neo4j']
66942700,.Net Client Neo4J Connection error IOException: ... encryption setting has changed in Neo4j 4.0,"I trying to connect to a Neo4J version 3.5 database hosted by Graphene using .Net client 4.1.6 which uses driver  4.2 in .NET. I am getting this error: 
```
Connection with the server breaks due to IOException: Unexpected end of stream when performing handshake, read returned 0 Please ensure that your database is listening on the correct host and port and that you have compatible encryption settings both on Neo4j server and driver. Note that the default encryption setting has changed in Neo4j 4.0.
```

A number of things to note:
1) I am able to connect to the database using an old version of my app (driver 1.7), so I know the database is accessible
2) I am able to connect to a local copy of my 3.5 database so I know its not a driver compatibility issue
3) I am able to connect my Neo4J browser remotely to my Graphene hosted database which is another indication that the database is accessible

I am not able to downgrade the version of the driver in my new app. I tried to set Encryption level to `EncryptionLevel.Encrypted`. Any help as to why this error is occuring would be helpful.",1617549068,https://stackoverflow.com/q/66942700,afriedman111,['neo4j']
66942415,Unable to connect to neo4j bolt server using container IP,"Team, 

I am trying to spin up neo4j container and neovis(node) container in a cloud server. The issue is when I provide the internal IP of the neo4j container for ``` const driver = neo4j.driver(&#39;bolt://neo4jcontainerIP&#39;, neo4j.auth.basic(&#39;neo4j&#39;, &#39;password&#39;)); ``` it cannot connect or fetch the data.

But when I provide a public IP of the host where neo4j is running ``` const driver = neo4j.driver(&#39;bolt://publicIP&#39;, neo4j.auth.basic(&#39;neo4j&#39;, &#39;password&#39;)); ``` it works without any issues


Can you please assist me how to pull the data into the neovis frontend using neo4j container IP? 

```
const neo4j = require(&#39;neo4j-driver&#39;);

const driver = neo4j.driver(&#39;bolt://localhost&#39;, neo4j.auth.basic(&#39;neo4j&#39;, &#39;password&#39;));

module.exports = driver;
```

Your help is greatly appreciated!! ",1617547472,https://stackoverflow.com/q/66942415,vasant kumar chinnipilli,"['neo4j', 'neo4j-apoc', 'devops']"
66926848,"In cypher, return only the nodes with most recent relationship","Related to [this][1] other question, but approaching from the other side of the relationship.

Here is the scenario. I am modeling a person that lives or has lived at one or more different locations. Included in the relationship is the start date (represented as ms since epoch) when they moved in.

        (:Person{name:&#39;bill&#39;}) -[:livesAt {since:1111000}]-&gt;(:Place{name:&#39;apartmentA&#39;})    
        (:Person{name:&#39;bill&#39;}) -[:livesAt {since:2222000}]-&gt;(:Place{name:&#39;apartmentB&#39;})
        (:Person{name:&#39;john&#39;}) -[:livesAt {since:3333000}]-&gt;(:Place{name:&#39;apartmentA&#39;})
        (:Person{name:&#39;chris&#39;}) -[:livesAt {since:1100000}]-&gt;(:Place{name:&#39;apartmentC&#39;})
        (:Person{name:&#39;chris&#39;}) -[:livesAt {since:1122000}]-&gt;(:Place{name:&#39;apartmentA&#39;})

I want to write a query that returns the person nodes that are still living at a given location. They are still living at a location if the livesAt relationship has the largest &quot;since&quot; of all relationships from that person.

I was trying something like this:

    MATCH (:Place {name: &#39;apartmentA&#39;})&lt;-[r]-(p:Person)
    WITH max(r.since) as most_recent, p.name as pname
    MATCH (t:Person {name:pname}) -[e]-&gt;(l:Place)
    WITH t,l
    ORDER BY e.since DESC
    return t,l

If my query worked with the example above, given place &#39;apartmentA&#39; I would expect to get john and chris.


  [1]: https://stackoverflow.com/q/66846062/140473",1617411697,https://stackoverflow.com/q/66926848,JasonG,"['cypher', 'neo4j']"
66921163,"Problem for Neo4j loading .dump file correctly, but failed to show the database","My Neo4j version is community-4.2.4 in the Mac OS.
I used &#39;bin/neo4j-admin load --from=xxx/g.db.dump --database=xxx.db --force&#39;. And succeed in finding db file in /data/databases as photo showed below.
[enter image description here][1]


  [1]: https://i.stack.imgur.com/0kj5u.png

But the result returned in Browser adding &#39;show databases&#39; and cannot find the database what I want.
Thanks u guys all for helping me.
OR sending email for communicating more at **masichengyo@gamil.com**.


----------
",1617375228,https://stackoverflow.com/q/66921163,SichengYo,['neo4j']
66914688,Label Propagation Algorithm Implementation in Neo4j,"[![enter image description here][1]][1]I have a set of nodes IP addresses which are connected to each other by :connected_to and I want to implement the label propagation algorithm on them. But after running below command there is no result 

    CALL algo.labelPropagation(&#39;Node&#39;,&#39;connected_to&#39;,&#39;OUTGOING&#39;(write:true,partitionProperty:&#39;community&#39;,weightProperty:&#39;count&#39;))

can anyone help me please?[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/z1i1v.png
  [2]: https://i.stack.imgur.com/D0XZz.png",1617339840,https://stackoverflow.com/q/66914688,Ilnaz Nikseresht,['neo4j']
66911251,Cypher query for graph,"how can I determine the In degree and the out degree and the total degree of each node of the graph. Also, the longest path of the graph so the diameter of the graph and the density of the graph. And the two last questions, are the number of relations per type, and the number of nodes per label so for each label.

My datasets looks like this: [![enter image description here][1]][1]

I used this query to load the dataset: 

```
LOAD CSV WITH HEADERS FROM &#39;file:///vgsales.csv&#39; AS line 
CREATE (v:Vgsales {
  rank: toInteger(line.Rank),
  name: line.Name,
  platform: line.Platform,
  year: toInteger(line.Year)
}) 
MERGE (g:GENRE {genre: line.Genre}) 
MERGE (p:PUBLISHER {
  publisher: line.Publisher,
  NA_sales: toInteger(line.NA_Sales), 
  EU_sales: toInteger(line.EU_Sales),
  JP_sales: toInteger(line.JP_Sales),
  Other_sales: toInteger(line.Other_Sales),
  Global_sales: toInteger(line.Global_Sales)
}) 
MERGE (v)-[:IN_GENRE]-&gt;(g) 
MERGE (p)-[:PUBLISHED]-&gt;(v)
```

  [1]: https://i.stack.imgur.com/IkUGd.png",1617309407,https://stackoverflow.com/q/66911251,computer,"['cypher', 'neo4j']"
66907513,Kafka Neo4j Connect - using bolt+routing protocol,"I&#39;m trying to change the protocol from bolt to bolt+routing in the Kafka Neo4j Connector configuration. However I&#39;m facing the error

```
&quot;trace&quot;:&quot;java.lang.IllegalArgumentException: Invalid address format bolt+routing\n\tat org.neo4j.driver.internal.Scheme.validateScheme(Scheme.java:46)\n\tat org.neo4j.driver.internal.SecuritySettings.createSecurityPlan(SecuritySettings.java:64)\n\tat org.neo4j.driver.GraphDatabase.driver(GraphDatabase.java:138)\n\tat streams.kafka.connect.sink.Neo4jService.&lt;init&gt;(Neo4jService.kt:83)\n\tat streams.kafka.connect.sink.Neo4jSinkTask.start(Neo4jSinkTask.kt:29)\n\tat org.apache.kafka.connect.runtime.WorkerSinkTask.initializeAndStart(WorkerSinkTask.java:308)\n\tat org.apache.kafka.connect.runtime.WorkerSinkTask.execute(WorkerSinkTask.java:199)\n\tat org.apache.kafka.connect.runtime.WorkerTask.doRun(WorkerTask.java:185)\n\tat org.apache.kafka.connect.runtime.WorkerTask.run(WorkerTask.java:235)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.-bash-4.3$ ps aux | grep java^C                                             hread.run(Thread.java:748)\n&quot;}
```

After reviewing somethings and I get confused on Neo4j Drivers. Currently there are 2 neo4j driver: Neo4j JDBC Driver and Neo4j Java Driver. I only see Neo4j JDBC Driver supports bolt+routing, but the Neo4j Java Driver doesn&#39;t. I see Sink Connector is using Neo4j Java Driver, wondering how we can use bolt+routing in Sink Connector.

TIA",1617291293,https://stackoverflow.com/q/66907513,Tin Nguyen,"['apache-kafka-connect', 'neo4j-driver', 'neo4j']"
66903819,Spring boot 2.4 Neo4j 6.0 Null value map to boolean primitive changed,"Prior to SB2.4neo4j6, if i had a **boolean node property, and it had no value saved** in the db, it was automatically set as false at mapping into the @Node marked pojo and **caused no problem**.

In this new **Spring boot 2.4 neo4j 6** however it throws an exception that **null cannot be mapped to boolean value**.

Should i now set up some Null to boolean conversion or what should i do?
Tried with **&quot;GenericConverter&quot;** and also with  **Neo4jPersistentPropertyConverter&lt;Boolean&gt; with @ConvertWith** on the property in manymany ways with Boolean and NullValue and Object and so on.

**What would be a way to solve this?**(cant do database update to give all non existent booleans a value)",1617277108,https://stackoverflow.com/q/66903819,Daniel Jeney,"['spring-boot', 'neo4j', 'spring-data-neo4j']"
66902154,Neo4j/Cypher Import a CSV file,"I have a CSV file, which have 11 columns : Rank, Year, Name... 
It contains the best video games sales. I&#39;m new to neo4j and cypher.

I am trying to import it to neo4j with this cypher query : 
`LOAD CSV WITH HEADERS FROM &#39;file:///vgsales.csv&#39; AS line
CREATE (:Vgsales {rank: toInteger(line.Rank), name: line.Name, platform: line.Platform, year: toInteger(line.Year), genre: line.Genre, publisher: line.Publisher, NA_sales: toInteger(line.NA_Sales), EU_sales: toInteger(line.EU_Sales)], JP_sales: toInteger(line.JP_Sales), Other_sales: toInteger(line.Other_Sales), Global_sales: toInteger(line.Global_Sales)})`

When i do this, I have the nodes, but there is no reationships between them, and I need to give the graph model with this query : call db.schema.visualization but there is only one empty node when I do this. 

I don&#39;t understand why there isn&#39;t any relationships .",1617270132,https://stackoverflow.com/q/66902154,computer,"['neo4j', 'cypher']"
66901973,How can I check if a Neo4j fulltext index exists?,"I have two indices on the same label and property; one fulltext index and one btree index. How can I check if the fulltext index exists or not?

According to https://neo4j.com/developer/cypher/filtering-show/ I should be able to filter the output of `SHOW` using `YIELD` and `WHERE` but that doesn&#39;t seem to work with indices: 

```
Invalid input &#39;Y&#39;: expected whitespace, comment, type of show output, &#39;;&#39; or end of input (line 1, column 14 (offset: 13))
&quot;SHOW INDEXES YIELD name, type&quot;
```

The following query works but issues a deprecation warning about `db.indexes`:
```
CALL db.indexes() YIELD name, type
WHERE name = &quot;usernames&quot; AND type = &quot;FULLTEXT&quot;
RETURN count(name) &gt; 0
```",1617269518,https://stackoverflow.com/q/66901973,tjarvstrand,['neo4j']
66900031,How can I create a Neo4j fulltext index idempotently?,"I have some integration test suites that run a Cypher init script in which I would like all the operations to be idempotent.

Running `CALL db.index.fulltext.createNodeIndex(&quot;usernames&quot;, [&quot;User&quot;], [&quot;username&quot;])` works fine the first time, but fails on subsequent attempts.

I have tried: 

```
CALL apoc.do.when(
  apoc.schema.node.indexExists(&quot;User&quot;, [&quot;username&quot;]), 
  &#39;RETURN NULL&#39;, 
  &#39;CALL db.index.fulltext.createNodeIndex(&quot;usernames&quot;, [&quot;User&quot;], [&quot;username&quot;])&#39;
)
```

This results in:

```
Failed to invoke procedure `apoc.do.when`: Caused by: org.neo4j.graphdb.security.AuthorizationViolationException: Schema operations are not allowed for user &#39;neo4j&#39; with roles [PUBLIC, admin] overridden by TOKEN_WRITE overridden by TOKEN_WRITE.
```

How can I achieve this with a fulltext index?

This is in Neo4j 4.2.1",1617261562,https://stackoverflow.com/q/66900031,tjarvstrand,"['neo4j', 'neo4j-apoc']"
66899802,neo4j spark connector doesn&#39;t work correctly,"I want to integrate Spark GraphX with Neo4j using [1]


I tried to follow the steps in [2] but it doesn&#39;t work. 

What should I do exactly with the neo4j-connector-apache-spark_2.12-4.0.0.jar file ? I put it in the jar files in the Spark folder. 

in bash I write:

C:\&gt;Spark\spark-3.1.1-bin-hadoop2.7\bin\spark-shell --jars neo4j-connector-apache-spark_2.12-4.0.0.jar


Any suggestions please?


**Update no. 1**

I tried this C:\Spark\spark-3.1.1-bin-hadoop2.7\bin\spark-shell --packages neo4j-contrib:neo4j-connector-apache-spark_2.12:4.0.0

I think it work. but when I want to write the DataFrame to nodes of type Person in spark-shell:

    import org.apache.spark.sql.{SaveMode, SparkSession}

    val spark = SparkSession.builder().getOrCreate()
    import spark.implicits._

    val df = Seq(
    (&quot;John Doe&quot;),
    (&quot;Jane Doe&quot;)
    ).toDF(&quot;name&quot;)

    df.write.format(&quot;org.neo4j.spark.DataSource&quot;)
    .mode(SaveMode.ErrorIfExists)
    .option(&quot;url&quot;, &quot;bolt://localhost:7687&quot;)
    .option(&quot;authentication.basic.username&quot;, &quot;neo4j&quot;)
    .option(&quot;authentication.basic.password&quot;, &quot;neo4j&quot;)
    .option(&quot;labels&quot;, &quot;:Person&quot;)
    .save()

It raises errors. what should I do?

**Update no. 2**

I follow the steps in the [3] and it gives error when entering this:

    val neo = Neo4j(sc) 

as follow: 

error: not found: value Neo4j


  [1]: https://neo4j.com/product/connectors/apache-spark-connector/
  [2]: https://neo4j.com/developer/spark/quickstart/
  [3]: https://medium.com/data-science-school/practical-apache-spark-in-10-minutes-part-7-graphx-and-neo4j-b6b01cffa4fd",1617260498,https://stackoverflow.com/q/66899802,Sama,"['apache-spark', 'neo4j']"
66898749,How can I Download to CSV in Neo4j,"I&#39;ve been trying to download a certain data on my graph and it returns this error :
```Neo.ClientError.Statement.SyntaxError: Type mismatch: expected List&lt;Node&gt; but was Node (line 2, column 27 (offset: 77))&quot;CALL apoc.export.csv.data(c,[], &quot;contrib.csv&quot;,{})&quot; ```

This is the query I did : 

`MATCH (c:Contrib) WHERE c.nationality CONTAINS &quot;|&quot; 
CALL apoc.export.csv.data(c,[], &quot;contrib.csv&quot;,{})
YIELD file, source, format, nodes, relationships, properties, time, rows, batchSize, batches, done, data
RETURN file, source, format, nodes, relationships, properties, time, rows, batchSize, batches, done, data`

What went wrong ? :(

Thanks",1617253930,https://stackoverflow.com/q/66898749,Aur&#233;lie Nuttall,"['neo4j', 'csv']"
66898665,Does Label Propagation Algorithm help in finding the anomalies in a network?,I am trying to find some patterns from the incoming/outgoing connections of a network in terms of security attacks and I am wondering if the LPA can be helpful in any sense or not. Would be grateful to have the experts comments,1617253209,https://stackoverflow.com/q/66898665,Ilnaz Nikseresht,"['graph', 'neo4j']"
66891853,Using docker container inside npm package,"I&#39;m implementing TypeScript compiler API addon as standalone `npm` package which is supposed to traverse TypeScript code and offload dependencies graph into `neo4j` database for further graph analysis with `Apoc` API.

Is it even possible to use third-party software packed as `Docker` container from within `npm` package? What&#39;s the best practice in such case?",1617208813,https://stackoverflow.com/q/66891853,Slaus,"['docker', 'neo4j', 'npm']"
66890820,subprocess.check_output failing within Docker,"Similiar questions have been asked before, but the solutions for these questions don&#39;t resolve my own issue. I have a repo that relies on a base repo, whereby a connection is made to a neo4j database. My tests for the base repo work. The repo I have (transforms files) has already proven to work locally. When I run the repo in Docker I get a `FileNotFoundError` which is being thrown out from the base repo:

**Base repo module**

    def get_docker_host_ip(self):
        z = subprocess.check_output([&#39;ip&#39;, &#39;-4&#39;, &#39;route&#39;, &#39;list&#39;, &#39;match&#39;, &#39;0/0&#39;])
        z = z.decode()[len(&#39;default via &#39;):]
        return z[: z.find(&#39; &#39;)]

The traceback:

    Traceback (most recent call last):
      File &quot;/opt/app/src/myscript.py&quot;, line 252, in &lt;module&gt;
        myModule = My_Module(args)
      File &quot;/opt/app/src/myscript.py&quot;, line 45, in __init__
        self.neo4jadapter = Neo4jAdapter()
      File &quot;/opt/app/base/base/neo4j_adapter.py&quot;, line 19, in __init__
        neo4j_host = self.get_docker_host_ip()
      File &quot;/opt/app/base/base/neo4j_adapter.py&quot;, line 51, in get_docker_host_ip
        z = subprocess.check_output([&#39;ip&#39;, &#39;-4&#39;, &#39;route&#39;, &#39;list&#39;, &#39;match&#39;, &#39;0/0&#39;])
      File &quot;/usr/lib/python3.7/subprocess.py&quot;, line 395, in check_output
        **kwargs).stdout
      File &quot;/usr/lib/python3.7/subprocess.py&quot;, line 472, in run
        with Popen(*popenargs, **kwargs) as process:
      File &quot;/usr/lib/python3.7/subprocess.py&quot;, line 775, in __init__
        restore_signals, start_new_session)
      File &quot;/usr/lib/python3.7/subprocess.py&quot;, line 1522, in _execute_child
        raise child_exception_type(errno_num, err_msg, err_filename)
    FileNotFoundError: [Errno 2] No such file or directory: &#39;ip&#39;: &#39;ip&#39;

For `subprocess.check_output`, I have also added `shell=True` as recommended on other posts, but it doesn&#39;t make a different:

    z = subprocess.check_output([&#39;ip&#39;, &#39;-4&#39;, &#39;route&#39;, &#39;list&#39;, &#39;match&#39;, &#39;0/0&#39;], shell=True)

This Traceback only occurs when I run the script in Docker. Where am I going wrong?



",1617204713,https://stackoverflow.com/q/66890820,pymat,"['neo4j', 'python-3.x', 'docker', 'subprocess']"
66890721,Unremovable custom cypher functions,"I am using a 4.1.1 Community and I face the bug 
where multiple custom functions with the same name are registered.

It is now solved (see this issue   https://github.com/neo4j-contrib/neo4j-apoc-procedures/issues/1558 ) since next day of 4.1.1release :)

The functions become unremovable through    CALL apoc.custom.removeFunction(&#39;functionName&#39;)

Is there a way to remove all functions ? 
    Some tweaking in system db ? 
    A file to remove indata folder ?

My concern is that it could make an upgrade fail

Are the custom functions bundled in a dump ?",1617204336,https://stackoverflow.com/q/66890721,Jerome_B,"['neo4j-apoc', 'neo4j']"
66890158,Is it possible to create bi-directional relationships between nodes with the same label?,"Person node:
* firstName
* lastName
* address
* email
* phoneNumber

Company node:
* Name
* address
* email
* phoneNumber

Relationships: 
* Person -[SPOUSE]-&gt; Person
* Person -[SIBLING]-&gt; Person
* Person -[FAMILY]-&gt; Person
* Company -[EMPLOYEE]-&gt; Person

Person entity: 
```
public class Person {
    @Id
    @GeneratedValue
    Long personId;

    @Builder
    public Test(Long personId, String firstName, String lastName, String address, String email, String phoneNumber) {
        this.personId = id;
        this.firstName = firstName;
        this.lastName = lastName;
        this.addresss = address;
        this.email = email;
        this.phoneNumber = phoneNumber
    }

    @NotEmpty(message = &quot;Please provide a first name&quot;)
    String firstName;

    @NotEmpty(message = &quot;Please provide a last name&quot;)
    String lastName;

    String address;

    String email;

    String phoneNumber;

    @Relationship(type = &quot;SPOUSE&quot;,direction=Relationship.OUTGOING)
    public Set&lt;Person&gt; spouse;

    @Relationship(type = &quot;SIBLING&quot;,direction=Relationship.OUTGOING)
    public Set&lt;Person&gt; sibling;

    @Relationship(type = &quot;FAMILY&quot;,direction=Relationship.OUTGOING)
    public Set&lt;Person&gt; family;
}
```

When I create a Person for Jane I also add a sibling relationship with John.   

Running `person.fetchById(&quot;29d31f6c-edfe-48a2-9ab2-3baed5d5ae69&quot;)` retrieves the node Jane with the corresponding sibling node John.
```
{
   &quot;address&quot;:&quot;&quot;,
   &quot;email&quot;:&quot;&quot;,
   &quot;phoneNumber&quot;:&quot;&quot;,
   &quot;personId&quot;:&quot;29d31f6c-edfe-48a2-9ab2-3baed5d5ae69&quot;,
   &quot;firstName&quot;:&quot;Jane&quot;,
   &quot;lastName&quot;:&quot;Smith&quot;,
   &quot;spouse&quot;:null,
   &quot;sibling&quot;:[
      {
         &quot;address&quot;:&quot;&quot;,
         &quot;email&quot;:&quot;&quot;,
         &quot;phoneNumber&quot;:&quot;&quot;,
         &quot;personId&quot;:&quot;f825cedd-7328-4f9d-b0fd-a33726814f25&quot;,
         &quot;firstName&quot;:&quot;John&quot;,
         &quot;lastName&quot;:&quot;smith&quot;,
         &quot;spouse&quot;:null,
         &quot;sibling&quot;:[],
         &quot;family&quot;:null
      }
   ],
   &quot;family&quot;:null
}
```

However, the sibling relationship should be bi-directional. Running `person.fetchById(&quot;f825cedd-7328-4f9d-b0fd-a33726814f25&quot;)` only retrieves the node John.
```
{
   &quot;address&quot;:&quot;&quot;,
   &quot;email&quot;:&quot;&quot;,
   &quot;phoneNumber&quot;:&quot;&quot;,
   &quot;personId&quot;:&quot;f825cedd-7328-4f9d-b0fd-a33726814f25&quot;,
   &quot;firstName&quot;:&quot;John&quot;,
   &quot;lastName&quot;:&quot;Smith&quot;,
   &quot;spouse&quot;:null,
   &quot;sibling&quot;:null,
   &quot;family&quot;:null,
   &quot;closeFriend&quot;:null,
   &quot;friend&quot;:null
}
```

Here is where the problem lies. I could add another sibling relationship between John and Jane. But, this effectively creates a infinite loop between the two. And the output from `person.fetchById` ends up being garbage. 

1. Is there any way to limit the depth of nodes returned when fetching nodes? 
2. I&#39;m new to neo4j, so I suspect my design is wrong. What is the best way to model this kind of relationship? 






",1617202229,https://stackoverflow.com/q/66890158,Freid001,"['neo4j', 'spring-data-neo4j', 'spring-boot', 'java']"
66885632,Neo4j embedded DROP INDEX throws odd error,"# Setup

```cypher 
CREATE INDEX index_2384723 IF NOT EXISTS FOR (n:Movie) ON (n.title) 
```

# Run

```cypher
call db.indexes() yield name, labelsOrTypes
where labelsOrTypes = [&quot;Movie&quot;]
DROP INDEX name IF EXISTS
RETURN name
```

# Expectation

Index with name index_2384723 to be dropped
and a return value:

`index_2384723`

# Reality

```
Invalid input &#39;R&#39;: expected &#39;e/E&#39; (line 3, column 2 (offset: 77))
&quot;DROP INDEX name IF EXISTS&quot;
  ^
``` 

But why? Is this a neo4j cypher parsing bug or is the error on my side?
I dont get it...

The standalone queries work

```cypher
call db.indexes() yield name, labelsOrTypes
where labelsOrTypes = [&quot;Movie&quot;]
RETURN name
```

this works.
and 
```cypher
DROP INDEX index_2384723 IF EXISTS
```

this works too...
",1617185142,https://stackoverflow.com/q/66885632,Tim B,"['cypher', 'neo4j']"
66881346,How to import the json file in neo4j to link the html code to a web page?,"I have tried to link the neo4j to the web page but the code does not run successfully. Has anyone done that before?is it because of the part where I try to import the json file into the neo4j database or is it due to other part of the code?

    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;Data Visualization&lt;/title&gt;
        &lt;style type=&quot;text/css&quot;&gt;
          #viz {
            width: 900px;
            height: 700px;
          }
        &lt;/style&gt;
        &lt;script src=&quot;https://cdn.neo4jlabs.com/neovis.js/v1.5.0/neovis.js&quot;&gt;&lt;/script&gt;
      &lt;/head&gt;
      &lt;script&gt;
        function draw() {
          var config = {
            container_id: &quot;viz&quot;,
            server_url: &quot;bolt://localhost:7687&quot;,
            server_user: &quot;neo4j&quot;,
            server_password: &quot;secret&quot;,
            labels: {
              Troll: {
                caption: &quot;user_key&quot;,
                size: &quot;pagerank&quot;,
                community: &quot;community&quot;,
              },
            },
            relationships: {},
            initial_cypher:&quot;call apoc.load.json(&quot;file:/graph-phase1-labelled1.json&quot;)
            yield value 
            unwind value.nodes as nodes 
            unwind nodes.properties as prop 
            with prop where prop.sourceIP is not null 
            with prop where prop.destIP is not null merge(n1:Node{src:prop.sourceIP})          
            merge(n2:Node{dest:prop.destIP}) 
            with prop,n1,n2 
            merge (n1)-[ :connected_to]-&gt;(n2) return n1,n2,prop&quot;,};
            var viz = new NeoVis.default(config);
            viz.render();
        }
      &lt;/script&gt;
      &lt;body onload=&quot;draw()&quot;&gt;
        &lt;div id=&quot;viz&quot;&gt;&lt;/div&gt;
      &lt;/body&gt;
    &lt;/html&gt;",1617162212,https://stackoverflow.com/q/66881346,Ilnaz Nikseresht,"['json', 'neo4j', 'html']"
66880653,"Required identifier property not found for class Person, when using Neo4j ogm?","I&#39;m new to neo4j. From what I&#39;ve read so far I understand that it&#39;s generally bad practise to use the default `&lt;id&gt;` parameter externally of my app. I&#39;d therefore like to be able to specify my own `personId` parameter separate of `&lt;id&gt;`. To do this, I&#39;d like to use `neo4j-ogm`, however I&#39;m getting this exception:

```
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#39;personController&#39; defined in file [/Users/freid/www/project/address-book/build/classes/java/main/com/addressbook/controller/PersonController.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;personRepository&#39; defined in com.addressbook.repositories.PersonRepository defined in @EnableNeo4jRepositories declared on SetupBeans: Invocation of init method failed; nested exception is java.lang.IllegalStateException: Required identifier property not found for class com.addressbook.model.Person!
        at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:800) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:229) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1354) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1204) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:564) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:944) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:918) ~[spring-context-5.3.5.jar:5.3.5]
        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:583) ~[spring-context-5.3.5.jar:5.3.5]
        at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:144) ~[spring-boot-2.4.4.jar:2.4.4]
        at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:769) ~[spring-boot-2.4.4.jar:2.4.4]
        at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:761) ~[spring-boot-2.4.4.jar:2.4.4]
        at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:426) ~[spring-boot-2.4.4.jar:2.4.4]
        at org.springframework.boot.SpringApplication.run(SpringApplication.java:326) ~[spring-boot-2.4.4.jar:2.4.4]
        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1313) ~[spring-boot-2.4.4.jar:2.4.4]
        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1302) ~[spring-boot-2.4.4.jar:2.4.4]
        at com.addressbook.Application.main(Application.java:17) ~[main/:na]
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;personRepository&#39; defined in com.addressbook.repositories.PersonRepository defined in @EnableNeo4jRepositories declared on SetupBeans: Invocation of init method failed; nested exception is java.lang.IllegalStateException: Required identifier property not found for class com.addressbook.model.Person!
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:602) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:524) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1380) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1300) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:887) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791) ~[spring-beans-5.3.5.jar:5.3.5]
        ... 20 common frames omitted
Caused by: java.lang.IllegalStateException: Required identifier property not found for class com.addressbook.model.Person!
        at org.springframework.data.mapping.PersistentEntity.getRequiredIdProperty(PersistentEntity.java:105) ~[spring-data-commons-2.4.6.jar:2.4.6]
        at org.springframework.data.repository.core.support.PersistentEntityInformation.getIdType(PersistentEntityInformation.java:74) ~[spring-data-commons-2.4.6.jar:2.4.6]
        at org.springframework.data.neo4j.repository.support.Neo4jRepositoryFactory.getTargetRepository(Neo4jRepositoryFactory.java:67) ~[spring-data-neo4j-6.0.6.jar:6.0.6]
        at org.springframework.data.repository.core.support.RepositoryFactorySupport.getRepository(RepositoryFactorySupport.java:281) ~[spring-data-commons-2.4.6.jar:2.4.6]
        at org.springframework.data.repository.core.support.RepositoryFactoryBeanSupport.lambda$afterPropertiesSet$5(RepositoryFactoryBeanSupport.java:323) ~[spring-data-commons-2.4.6.jar:2.4.6]
        at org.springframework.data.util.Lazy.getNullable(Lazy.java:230) ~[spring-data-commons-2.4.6.jar:2.4.6]
        at org.springframework.data.util.Lazy.get(Lazy.java:114) ~[spring-data-commons-2.4.6.jar:2.4.6]
        at org.springframework.data.repository.core.support.RepositoryFactoryBeanSupport.afterPropertiesSet(RepositoryFactoryBeanSupport.java:329) ~[spring-data-commons-2.4.6.jar:2.4.6]
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1845) ~[spring-beans-5.3.5.jar:5.3.5]
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782) ~[spring-beans-5.3.5.jar:5.3.5]
        ... 31 common frames omitted`
```

Here is my `Person` node: 
```
package com.addressbook.model;

import javax.validation.constraints.Max;
import javax.validation.constraints.Min;
import javax.validation.constraints.NotEmpty;

import lombok.Builder;
import lombok.Getter;
import lombok.Setter;
import org.neo4j.ogm.annotation.*;

import java.util.Set;

@NodeEntity
@Getter
@Setter
public class Person {
    @Id
    @GeneratedValue
    Long personId;

    @Builder
    public Person(Long personId, String firstName, String lastName, Integer age) {
        this.personId = id;
        this.firstName = firstName;
        this.lastName = lastName;
        this.age = age;
    }

    @NotEmpty(message = &quot;Please provide a first name&quot;)
    String firstName;

    @NotEmpty(message = &quot;Please provide a last name&quot;)
    String lastName;

    @Min(value = 18, message = &quot;Age should not be less than 18&quot;)
    @Max(value = 150, message = &quot;Age should not be greater than 150&quot;)
    Integer age;

    @Relationship(type = &quot;SPOUSE&quot;,direction=Relationship.OUTGOING)
    public Set&lt;Person&gt; spouse;

    @Relationship(type = &quot;SIBLING&quot;,direction=Relationship.OUTGOING)
    public Set&lt;Person&gt; sibling;

    @Relationship(type = &quot;FAMILY&quot;,direction=Relationship.OUTGOING)
    public Set&lt;Person&gt; family;
}
```

Here is my `Person` repository:
```
package com.addressbook.repositories;

import com.addressbook.model.Person;
import org.springframework.data.neo4j.repository.Neo4jRepository;

public interface PersonRepository extends Neo4jRepository&lt;Person, Long&gt; {}
```

And, here is my `Person` controller:
```
package com.addressbook.controller;

import com.addressbook.exception.NotFoundException;
import com.addressbook.model.Person;
import com.addressbook.repositories.PersonRepository;
import com.addressbook.model.View;
import com.fasterxml.jackson.annotation.JsonView;
import io.swagger.annotations.Api;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import lombok.extern.log4j.Log4j2;
import javax.validation.*;

@Log4j2
@RestController
@RequestMapping(&quot;/api/v1&quot;)
@Api(tags = { &quot;Person&quot; })
public class PersonController {

	private final PersonRepository personRepository;

	@Autowired
	public PersonController(PersonRepository personRepository) {
		this.personRepository = personRepository;
	}

	@GetMapping(&quot;person/{personId}&quot;)
	@ResponseStatus(HttpStatus.OK)
	public ResponseEntity&lt;Person&gt; getPerson(@PathVariable(&quot;personId&quot;) Long id) throws NotFoundException {
		Person person = this.personRepository.findById(id).orElseThrow(() -&gt; new NotFoundException(&quot;Person not found!&quot;));

		return new ResponseEntity(person, HttpStatus.OK);
	}

}
```

This exception only seems to occurs when I use `org.neo4j.ogm.annotation.Id` annotation. If I use the `org.springframework.data.neo4j.core.schema.Id` annotation then I can create and retrieve entities. But, it only seems to create the entity with the default `&lt;id&gt;`, which is not what I want.  

My understanding, which maybe wrong, is that `org.neo4j.ogm.annotation.Id` should allow you to add your own id separate of `&lt;id&gt;`, and even allow you to combine it with `org.neo4j.ogm.id.UuidStrategy` to use a `uuid` for entities. Is this correct? 

I&#39;m not sure why the exception says `Required identifier property not found for class com.addressbook.model.Person!` as I thought the `org.neo4j.ogm.annotation.Id` annotation would satisfy this. 

Any help would be appreciated. 











",1617156100,https://stackoverflow.com/q/66880653,Freid001,"['spring-boot', 'java', 'neo4j-ogm', 'neo4j']"
66877950,Neo4j query takes an eternity to execute,"My code takes an eternity to compute jaccard similarity. It is an .csv file with 100000 in it. I have already created indexes on 2 basic Nodes (id+ value) 
I have already use the Jaccard algorithm in Playground but it also takes an eternity to run.

```
MATCH (i:Item)-[:HAS]-&gt;(p2:Properties)&lt;-[:HAS]-(i1:Item)
WITH {item:id(i), categories: collect(id(i1))} as userData
WITH collect(userData) as data
CALL algo.similarity.jaccard.stream(data, {similarityCutoff: 0.5})
YIELD item1, item2, count1, count2, intersection, similarity
RETURN algo.asNode(item1).id AS from, algo.asNode(item2).id AS to, intersection, similarity
```

Can anyone help?
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/6E6rE.png",1617135667,https://stackoverflow.com/q/66877950,user12678036,"['neo4j', 'cypher']"
66872423,Unable to match and create nodes using MATCH and MERGE,"I am trying to create a hierarchy of nodes by, first, finding any existing nodes (using MATCH) and then creating the relationship by either reusing the existing nodes or creating new ones if any of the nodes don&#39;t exist (using MERGE).

Can someone please explain why this snippet of code doesn&#39;t do anything:

    CALL apoc.load.jdbc(...) YIELD row
    MATCH (t:Taxonomy {key:row.TermKey})
    MATCH (tp:Taxonomy {key:row.ParentKey})
    MERGE (t)-[:CHILD_OF]-&gt;(tp)

But this one does the job:

    CALL apoc.load.jdbc(...) YIELD row
    MERGE (t:Taxonomy {key:row.TermKey})
    MERGE (tp:Taxonomy {key:row.ParentKey})
    MERGE (t)-[:CHILD_OF]-&gt;(tp)

I am looking at the Neo4j manual and their example does exactly, but doesn&#39;t work for me for some reason.
[Neo4j manual screenshot][1]


  [1]: https://i.stack.imgur.com/MTBrx.png",1617112841,https://stackoverflow.com/q/66872423,Roman,"['cypher', 'neo4j']"
66872103,How to store C# DateTime as Neo4j DATE_TIME instead of STRING using Neo4jClient?,"I&#39;m trying to store C# DateTime properties as native Neo4j `DATE_TIME` but they&#39;re always stored as `STRING` instead.

Simplified example code:

    // properties
    IDictionary&lt;string, dynamic&gt; parameterMapCreate = new Dictionary&lt;string, dynamic&gt;();
    parameterMapCreate.Add(&quot;createdAt&quot;, Datetime.UtcNow);

    // labels
    var labelsToAdd = &quot;Label01:Label02&quot;;
    
    // query
    var cypherQuery = _graphClient.Cypher
        .WithParams(new
        {
            tok = Guid.NewGuid(),
            propertiesCreate = parameterMapCreate
        })
        .Merge($&quot;(n:{&quot;TestNodeLabel&quot;} {{ {&quot;token&quot;}: $tok }})&quot;)
        .OnCreate().Set(&quot;n = $propertiesCreate&quot;)
        .Set(&quot;n:&quot; + labelsToAdd)
        .With(&quot;n, properties(n) as prop&quot;)
        .ReturnDistinct((n, prop) =&gt; new GenericNode
        {
            Id = n.Id(),
            Labels = n.Labels(),
            Properties = prop.As&lt;Dictionary&lt;string, string&gt;&gt;(),
        });
        
    // generic node (doesn&#39;t affect storage type, only what we get back)
    public class GenericNode
    {
        public long Id { get; set; }
        public IEnumerable&lt;string&gt; Labels { get; set; }
        public Dictionary&lt;string, string&gt; Properties { get; set; }
    }

Numeric and boolean types are stored correctly, however dates are stored as `STRING`, as the following query shows:

    MATCH (n)
    WITH (apoc.meta.cypher.types(n)) as types
    return types

gives:

    types
    {
      &quot;createdAt&quot;: &quot;STRING&quot;,
      &quot;token&quot;: &quot;STRING&quot;
    }

I see that using custom POCO we can decorate properties with the `[Neo4jDateTime]` attribute, but what if we don&#39;t have fixed classes / properties and just want to pass a bunch of properties in via a dictionary as illustrated?

Thanks,
Richard
",1617111770,https://stackoverflow.com/q/66872103,Richard Urwin,"['c#', 'neo4j', 'neo4jclient']"
66867433,SQL - Query Year by Year,"I have a table of employees&#39; info, including their employment start and end date. I want to extract a list of employees who have been with the company for the full year, year by year, for the past ten years.

So for example, if I want to get a list of employees who&#39;ve been with the company throughout 2010, I&#39;ll do a query like this:

```
SELECT employee_name FROM employees
WHERE employment_start_date &lt; DATE &#39;2010-01-01&#39;
AND employment_end_date &gt; DATE &#39;2010-12-31&#39;
```

Now, I could repeat this process manually 10 times for each year from 2010 to 2020 (and manually append the relevant year as an additional column), but surely there&#39;s an easier way to do this with a single SQL query?


More background info:
I&#39;m actually trying to translate my Cypher query directly into an SQL query (because different companies uses different database system). Using Cypher, I&#39;ll be doing this:

```
WITH [2010,2011,2012,...,2019,2020] AS years
UNWIND years as y
MATCH (e:employees)
WHERE e.employment_start_date.year &lt; y
AND e.employment_end_date.year &gt; y
RETURN y, e.employee_name
```

So I&#39;m trying to find an SQL equivalent for this 

-----

Sample table data:

    |employee_name|employment_start_date|employment_end_date|
    |:---:|:---:|:---:|
    |John|2009-06-01|2015-03-02|
    |Mary|2010-04-02|2014-03-07|
    |Joseph|2011-03-02|2011-07-03|
    |Stephen|2003-06-14|2011-03-07|
    |Dew|2010-06-02|2012-02-06|

Desired Results:

    |Year|employee_name|
    |:---:|:---:|
    |2010|John|
    |2010|Stephen|
    |2011|John|
    |2011|Mary|
    |2011|Dew|

",1617093495,https://stackoverflow.com/q/66867433,user13399233,"['sql', 'oracle', 'cypher', 'neo4j']"
66864029,How to limit overall union in cypher,"I have these nodes:

 1. `user{user_id}: users`
 2. `thread{thread_id, post_date} : posts`
 3. `tag_id{tag_id}: the tag of the post`

And these relationships:
1. `(user) - [: FOLLOWED] -&gt; (tag)` // the user follows the tag
2. `(thread) - [: BELONG_TO] -&gt; (tag)` // the post belongs to tag
3. `(user) - [: READ{read_date}] -&gt; (thread)` // user reads the post
4. `(user) - [: BEING_REPLIED{post_date}] -&gt; (thread)` // the user is given a reply by another user to his / her comment in a post
5. `(user) - [: BEING_MENTIONED{post_date}] -&gt; (thread)` // the user is given a mention by another user comment in a post


I want to get 10 posts that the user is replied or mentioned by another user, then to the posts that belong to tag the user follows but the user has not read to display in each user&#39;s feed, I use multiple unions in the query but cannot limit to the total, the resulting form is limited to the last union
I wrote cypher as follows:

```
MATCH (u:User {user_id:3})-[rp:BEING_REPLIED]-&gt;(th:Thread)&lt;-[r:READ]-(u:User {user_id:3})
WHERE rp.post_date&gt; r.read_date
return u.user_id as user_id,th.thread_id as thread_id,
duration.inDays(datetime(),datetime(rp.post_date)).days*10 + 1000000 AS point
UNION ALL

MATCH (u:User {user_id:3})-[m:BEING_MENTIONED]-&gt;(th:Thread)&lt;-[r:READ]-(u:User {user_id:3})
WHERE m.post_date&gt; r.read_date
return u.user_id as user_id,th.thread_id as thread_id,
duration.inDays(datetime(),datetime(m.post_date)).days*10 + 1000000 AS point
UNION ALL

MATCH (u:User {user_id:3})-[m:BEING_MENTIONED]-&gt;(th:Thread)
WHERE NOT EXISTS ((u)-[:READ]-&gt;(th))
return u.user_id as user_id,th.thread_id as thread_id,
duration.inDays(datetime(),datetime(m.post_date)).days*10 + 1000000 AS point

MATCH (u:User)-[:FOLLOWED]-&gt;(t:Tag)&lt;-[:BELONG_TO]-&gt;(th)
WHERE u.user_id = 3 AND NOT EXISTS((u)-[]-&gt;(th))
WITH u.user_id AS user_id, th.thread_id AS thread_id,
(0.5*th.like_count + 0.3*th.comment_count + 0.005*th.view_count
+ duration.inDays(datetime(),datetime(th.published_date)).days*100) AS point
ORDER BY point desc
RETURN DISTINCT user_id, thread_id, point
UNION
MATCH (u:User)-[:FOLLOWED]-&gt;(t:Tag)&lt;-[:BELONG_TO]-&gt;(th)
WHERE u.user_id = 3 AND NOT EXISTS((u)-[]-&gt;(th))
AND NOT th.rating_total  IS NULL
WITH u.user_id AS user_id, th.thread_id AS thread_id,
(duration.inDays(datetime(),datetime(th.published_date)).days*150 + 30*th.rating_total) AS point
ORDER BY point desc, th.published_date desc
RETURN DISTINCT user_id, thread_id, point
LIMIT 10
```
How can i set this query limit overall?

Thanks for your help!",1617071512,https://stackoverflow.com/q/66864029,Anh,"['union', 'cypher', 'neo4j']"
66861883,Neo4J dump database,"I&#39;m looking to export my local database in Neo4J desktop on Windows. Does version 1.4.3 have the ability to dump a database through the UI? It used to be available by clicking the &#39;...&#39; next to a db instance.

I have also tried running command line dump according to [this](https://stackoverflow.com/questions/51025132/how-to-take-dump-of-neo4j-graph-databases). I open a terminal for a database and try to run the command 

```
.\bin\neo4j-admin.bat dump --database=graph.db --to=c:\dump\myDb.dump
```

And it says that database `graph.db` doesn&#39;t exist. I explored the folders and found the directory `data/databases/` which as a number of `.db` files, but none are named `graph.db`. If I use the `neo4j-admin` command to dump the database, which file should I target?",1617053223,https://stackoverflow.com/q/66861883,afriedman111,['neo4j']
66861448,Neo4j wont start on Kali Linux. Failing on startup. Used the tutorial from the bloodhound website,"```none
┌──(㉿kali)-[/usr/bin]
└─$ ./neo4j console           
Directories in use:
 home:         /var/lib/neo4j
 config:       /etc/neo4j
 logs:         /var/lib/neo4j/logs
plugins:       /var/lib/neo4j/plugins
 import:       /var/lib/neo4j/import
 data:         /var/lib/neo4j/data
certificates:  /var/lib/neo4j/certificates
 run:          /var/lib/neo4j/run
Starting Neo4j.
WARNING: Max 1024 open files allowed, minimum of 40000 recommended. See the 
Neo4j manual.
Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
Error: Could not find or load main class org.neo4j.server.CommunityEntryPoint
Caused by: java.lang.ClassNotFoundException: org.neo4j.server.CommunityEntryPoint
```
",1617050946,https://stackoverflow.com/q/66861448,The_KidCoder,"['bloodhound', 'java', 'neo4j']"
66858153,Cypher query to add WHERE clause for nodes that were created within the last 24 hours,"I have a query to get all of a specific type of users:
```
MATCH (users:User {role: &quot;USER&quot;, hasCompletedRegistration: true})
RETURN users
```
And there is a createdAt datetime property. What is the cleanest way to only return users WHERE the createdAt is within the last 24 hours of when the query is executed? The goal is for a nightly CRON job to check for all newly registered users to send a welcome message, and thus the specific timeframe. ",1617036076,https://stackoverflow.com/q/66858153,Matt Larson,"['neo4j-apoc', 'datetime', 'graph-databases', 'neo4j', 'cypher']"
66851899,get all graph data including nodes and relationships from neo4j using java into a hashmap,"I am trying to get all graph data including nodes and relationships from neo4j using java into a Hashmap to be able to read all nodes and their data for further manipulation with the data. I have tried using this query but it returns an error. 
```
try (Session session = driver.session()) { 
	return session.run(&quot;MATCH (m) RETURN m&quot;);
}
```
I am trying to figure out how can I get the data in the right format.",1617010780,https://stackoverflow.com/q/66851899,Mokshed Kaushik,"['neo4j', 'cypher', 'hashmap', 'java', 'session']"
66847181,How to &quot;overlay&quot; relationships using Neo4j?,"I have a series of Sold Menu Item (SMI) nodes (i.e. items that are for sale at a store).  There are Base Menu Items (BMI) that are listed underneath the SMIs that represent the components that make up the SMI.  For example, for fast food, the SMI might be a combo meal and the BMIs would be the Coke, fries and sandwich.  SMI nodes are blue and the BMI nodes are green.  The red nodes represent geographic locations and have their own hierarchy (store -[inherits_from]-&gt; region -[inherits_from]-&gt; market).

SMI/BMI Layers Graph:

[![enter image description here][1]][1]

What I&#39;m looking to do is specify the SMIs sold at a market level and have regions and stores inherit 
 and/or modify those relationships.  In the graph above, I am able to have Store 1234 inherit the SMIs and relationships from it&#39;s parent US Market.  I&#39;ve also attempted to model an example where the US Market sells 4 items and yet a particular Region (NY) only sells 3 items, i.e. the NY Region has a relationship of offers yet the offer is deactivated (property).  

Here is the Cypher CREATE statement:  

    CREATE (:Component {value: &quot;Ketchup&quot;})&lt;-[:made_of]-(n1:BMI {value: &quot;Hamburger&quot;, 
    version: &quot;default&quot;})-[:made_of]-&gt;(oz_Beef_Patty:Component {value: &quot;4oz Beef Patty&quot;}) 
    &lt;-[:made_of]-(n13:BMI {value: &quot;Hamburger&quot;, version: &quot;New York&quot;})-[:can_add]-&gt; 
    (n5:Component {value: &quot;Folded Egg&quot;})&lt;-[:made_of]-(:BMI {value: &quot;Folded Egg&quot;})&lt;- 
    [:contains {geoId: &quot;USM&quot;}]-(n15:SMI {value: &quot;Folded Egg&quot;}), (n17:SMI {value: 
    &quot;Hamburger&quot;})-[:contains {geoId: 1234}]-&gt;(n23:BMI {value: &quot;Hamburger&quot;, version: 
    &quot;Store 1234&quot;})&lt;-[:contains {geoId: 1234}]-(Hamburger_Extra_Value_Meal:SMI {value: 
    &quot;Hamburger Extra Value Meal&quot;})-[:contains {geoId: &quot;NYR&quot;}]-&gt;(n13)-[:can_add]-&gt; 
    (American_Cheese:Component {value: &quot;American Cheese&quot;})&lt;-[:can_add]-(n1)-[:can_add]-&gt; 
    (n5)&lt;-[:can_add]-(n23)-[:made_of]-&gt;(Onions:Component {value: &quot;Onions&quot;}), 
    (Salt:Component {value: &quot;Salt&quot;})&lt;-[:made_of]-(n1)-[:made_of]-&gt;(Onions)&lt;-[:made_of]- 
    (n13)-[:made_of]-&gt;(Salt)&lt;-[:made_of]-(n23)-[:made_of]-&gt;(Mustard:Component {value: 
    &quot;Mustard&quot;}), (Pickle:Component {value: &quot;Pickle&quot;})&lt;-[:made_of]-(n1)-[:made_of]-&gt; 
    (Mustard)&lt;-[:made_of]-(n13)-[:made_of]-&gt;(Pickle), (Roma_Tomato:Component {value: 
    &quot;Roma Tomato - 2 Slices&quot;})&lt;-[:can_add]-(n1)-[:made_of]-&gt;(Regular_Bun:Component 
    {value: &quot;Regular Bun&quot;})&lt;-[:made_of]-(n13)-[:can_add]-&gt;(Roma_Tomato)&lt;-[:can_add]- 
    (n23)-[:can_add]-&gt;(American_Cheese), (New_York_Region:Geo {value: &quot;New York Region&quot;, 
    level: &quot;Region&quot;, id: &quot;NYR&quot;})-[:offers {status: &quot;inactivated&quot;}]-&gt;(n15)&lt;-[:offers 
    {status: &quot;activated&quot;}]-(US_Market:Geo {value: &quot;US Market&quot;, level: &quot;Market&quot;, id: 
    &quot;USM&quot;})&lt;-[:inherits_from]-(New_York_Region)&lt;-[:inherits_from]-(:Geo {value: &quot;Store 
    3456&quot;, level: &quot;Store&quot;, id: 3456}), (n2:BMI {value: &quot;M French Fry&quot;})&lt;-[:contains 
    {geoId: &quot;USM&quot;}]-(Hamburger_Extra_Value_Meal)&lt;-[:offers {status: &quot;activated&quot;}]- 
    (US_Market)-[:offers {status: &quot;activated&quot;}]-&gt;(n17)-[:contains {geoId: &quot;USM&quot;}]-&gt;(n1), 
    (:Geo {value: &quot;Store 1234&quot;, level: &quot;Store&quot;, id: 1234})-[:inherits_from]-&gt;(:Geo 
    {value: &quot;Chicago Region&quot;, level: &quot;Region&quot;, id: &quot;CHR&quot;})-[:inherits_from]-&gt; 
    (US_Market)-[:offers {status: &quot;activated&quot;}]-&gt;(:SMI {value: &quot;M French Fry&quot;})- 
    [:contains {geoId: &quot;USM&quot;}]-&gt;(n2), (Hamburger_Extra_Value_Meal)-[:contains {geoId: 
    &quot;USM&quot;}]-&gt;(n1), (n17)-[:contains {geoId: &quot;NYR&quot;}]-&gt;(n13), (Regular_Bun)&lt;-[:made_of]- 
    (n23)-[:made_of]-&gt;(oz_Beef_Patty)

When I execute the following query...

    MATCH (geo:Geo)-[:inherits_from*0..]-&gt;(geos:Geo)
    WHERE geo.value = &quot;Store 1234&quot;
    WITH geos
    OPTIONAL MATCH (geos)-[o:offers]-&gt;(smis)-[c:contains]-&gt;(bmis)
    WHERE c.geoId in [(g1:Geo)-[:inherits_from*0..]-&gt;(gs:Geo) WHERE g1.value = &quot;Store 1234&quot; | gs.id]
    return geos,smis,bmis

I get back what I expect, the products that were specified at the US Market level.  If, instead, I specify Store 3456, the node Folded Egg appears with relationships from both geographies.  Ideally, I would like the relationship at the Region to &quot;cancel&quot; the US Market relationship to Folded Egg in the results output.

Results:

[![enter image description here][2]][2]

Does anyone know how I achieve this behavior whereby relationships are &quot;layered on&quot; or &quot;overlay&quot; each other?  Or perhaps another way of modeling my objects to better achieve the above functionality?  I don&#39;t want to have to repeat relationships at the Region level that are already present at the US Market level.  Thanks in advance!


In my comment above, I&#39;m not trying to create relationships in the model, just remove relationships for nodes that already exist in the query results.  For example, I tried the following query...

    MATCH (geo:Geo) 
    WHERE geo.value = &quot;Store 3456&quot;
    CALL {
        WITH geo
        OPTIONAL MATCH (geo:Geo)-[o1:offers]-&gt;(smis)
        RETURN collect(smis) as totalSMIs, collect(geo) as totalGeos
    }
    CALL {
        WITH geo, totalSMIs, totalGeos
        OPTIONAL MATCH (geo)-[:inherits_from]-&gt;(geos1)-[:offers]-&gt;(regionSMIs)
        RETURN apoc.coll.union(apoc.coll.removeAll(collect(regionSMIs), totalSMIs), totalSMIs)  AS totalSMIs2, 
            apoc.coll.union(totalGeos, collect(geos1)) as totalGeos2
    }
    CALL {
        WITH geo, totalSMIs2, totalGeos2
        OPTIONAL MATCH (geo)-[:inherits_from]-&gt;(geos1)-[:inherits_from]-&gt;(geos2)-[:offers]-&gt;(marketSMIs)
        RETURN apoc.coll.union(apoc.coll.removeAll(collect(marketSMIs), totalSMIs2), totalSMIs2) as totalSMIs3, 
            apoc.coll.union(totalGeos2, collect(geos2)) as totalGeos3
    }
    WITH totalSMIs3, totalGeos3
    UNWIND totalGeos3 AS x
    UNWIND totalSMIs3 AS y
    MATCH (x)-[:inherits_from*0..]-&gt;(geos)-[o:offers]-&gt;(y)
    WHERE o.status &lt;&gt; &quot;inactivated&quot;
    RETURN DISTINCT totalSMIs3, totalGeos3

to remove nodes that are linked at different hierarchy levels and I&#39;m still getting all of the wrong nodes.  What I&#39;m trying to do with the above is to remove the relationship that is being overridden.  For example, in the data, the US Market sells Folded Egg ([:OFFERS {status: activated}]) yet the New York Region overrides that selection with it&#39;s own relationship ([:OFFERS {status: inactivated}]).  When I execute the code above, I still see the two relationships between the two geos and Folded Egg.  I only want the node and relationship from the New York Region and not from the US Market b/c the New York Region has it&#39;s own relationship.


  [1]: https://i.stack.imgur.com/RObQc.png
  [2]: https://i.stack.imgur.com/DIbQi.png",1616974720,https://stackoverflow.com/q/66847181,Michael de Groot,"['graph', 'neo4j', 'cypher']"
66846062,"In cypher, return node with latest date in relationship property","Here is the scenario. I am modeling a person that lives at one or more different locations. Included in the relationship is the start date (represented as ms since epoch) when they moved in.

    (:person{name:&#39;bill&#39;}) -[:livesAt {since:1111000}]-&gt;(:place{name:&#39;apartmentA&#39;})
    
    (:person{name:&#39;bill&#39;}) -[:livesAt {since:2222000}]-&gt;(:place{name:&#39;apartmentB&#39;})

I want to write a query that returns the single place node corresponding to the most recent place of residence for a given person. The most recent place is corresponding to the largest value in the &#39;since&#39; property of the relationship. Note that multiple people may live at a given place.

I was trying something like this:

    MATCH (n:person {name: &#39;bill&#39;})-[r:livesAt]-&gt;(m:place)
    WITH r
    ORDER BY r.since DESC
    LIMIT 1
    MATCH (n:person)-[r]-&gt;(o:place)
    RETURN o.name

If my query worked with the example above, I would expect to get &#39;apartmentB&#39; back as the result.
",1616964479,https://stackoverflow.com/q/66846062,JasonG,"['neo4j', 'cypher']"
66844572,Can&#39;t get APOC to work on Neo4j Community Edition google cloud instance,"I created a Neo4j Community Edition instance on google cloud from the marketplace and when I tested it from my local application I got the following error: `Error: Unknown function &#39;apoc.cypher.runFirstColumn&#39; (...)`

I did some digging and found out that APOC was not installed on the cloud instance. I tried to install it via an ssh connection but I can&#39;t seem to get it to work.

I am pretty sure that APOC should come preinstalled. Am I missing something? Any help would be appreciated.",1616954799,https://stackoverflow.com/q/66844572, kappaisagreekletter,"['google-cloud-platform', 'neo4j-apoc', 'neo4j']"
66843104,Why does the query to find intermediate nodes take so long?,"The database has a graph with the following 3 nodes:

    ...-&gt;(1) ------&gt;(3)--&gt;...
       \             ^
        \            |
         ----&gt;(2)---/


Now, I want to get all distinct nodes that are reachable from node 1 to node 3, including themselves where I know exactly unique properties of node 1 and node 3 (the nodes are actually commits from a github repository). So, I came up with the following query:

    MATCH (origin:App)
    WHERE origin.commit=&#39;10cb31b0a72525923c01dc34f8690f311a361d42&#39;
    MATCH (destination:App)
    WHERE destination.commit=&#39;51fde433973463f057ffcbcbab0bc8944ab3ec9c&#39;
    MATCH (origin)-[:CHANGED_TO*0..]-&gt;(intermediate_commit:App)-[:CHANGED_TO*0..]-&gt;(destination)
    RETURN distinct intermediate_commit

However, the query never finishes or at least takes too long to complete. I know that I could have used `MATCH p=(origin:App)-[:CHANGED_TO*0..]-&gt;(destination:App)` and then UNWIND and return distinct nodes. The problem is, I believe, it queries different paths implying I am interested in relationships between them too. While in fact I am not interested in paths. What I need is only distinct nodes that match the pattern. My understanding is that querying paths is slower than it could be if I could query only the nodes.

Could you please help to understand what I am missing? Thanks!",1616945481,https://stackoverflow.com/q/66843104,Turkhan Badalov,"['neo4j', 'querying', 'cypher']"
66836160,Collect sub tree nodes as separate lists with Neo4j,"I&#39;m trying to create a cypher which collects  subtrees nodes (these subtree nodes are of type Story) and returns them as a separate list. Each tree starts with a family a node, is connected to  user(s) node(s), which is then connected in turn to story node(s). 

To clarify, there are multiple trees, I&#39;m trying to collect all the Story nodes, in a structure as follows:

    {
    FamilyOne: Stories:[...],
    FamilyTwo: Stories:[...]
    }


[Here is what the database structure looks like][1]


  [1]: https://i.stack.imgur.com/YSeRl.png",1616879671,https://stackoverflow.com/q/66836160,David George,"['neo4j', 'graph', 'database']"
66824261,passing parameters in neo4j using python,"I want to pass parameter in CREATE using Python
e.g: 
&#39;&#39;&#39;

    n = &quot;abc&quot;
    a = 1234
    
    cqlCreate = &quot;CREATE (cornell:university { name: $n,yob:$a})&quot;

&#39;&#39;&#39;&#39;

but it dosen&#39;t work.. any suggestions please
",1616792539,https://stackoverflow.com/q/66824261,Sama,"['python', 'neo4j']"
66819465,"In the neo4j sandbox, how to display nodes with the same label close to each other?","For example, the label of some nodes is &#39;A&#39;, and the label of other nodes is &#39;B&#39;. In the sandbox, the colors of the two group of nodes are different, but they are mixed together when displayed. I want nodes with the same label to be close to each other. How do I do this?",1616771145,https://stackoverflow.com/q/66819465,D Duo,['neo4j']
66812254,where to find apoc.conf in neo4j sandbox,"using neo4j for first time
running neo4j on broweser as my neo4j desktop version is not working 

TRYING TO LOAD JSON INTO IT BUT IT SAYS 
```Failed to invoke procedure `apoc.load.json`: Caused by: java.lang.RuntimeException: Import from files not enabled, please set apoc.import.file.enabled=true in your apoc.conf```

MY COMMAND
```
call apoc.load.json(&quot;///apoc.json&quot;) yield value
```

im unable any such file in browser all videos or answer are about neo4j desktop version where this file is present in settings

:=NEO4J is soooo confusing (for me )",1616741689,https://stackoverflow.com/q/66812254,Robin Singh,"['neo4j', 'python', 'json']"
66810830,"Neo4j export whole database to JSON_LINES, ARRAY_JSON, JSON or JSON_ID_AS_KEYS","I tried to use an APOC procedure from [here][1] to export the DB using the following:

    CALL apoc.export.json.all(&quot;all.json&quot;,{useTypes:true})

I can successfuly export to JSONL. However, I am not able to change the JSON format to other available formats such as JSON_LINES, ARRAY_JSON, JSON or JSON_ID_AS_KEYS. According to the documentation the following should work but it does not:


    CALL apoc.export.json.all(&quot;all.json&quot;,{config:{jsonFormat:&#39;ARRAY_JSON&#39;}})

The result of above procedure is in JSONL but not ARRAY_JSON.

I have also tried the solution [here][2] but did not succeed.

Cheers,

A


  [1]: https://neo4j.com/labs/apoc/4.1/overview/apoc.export/apoc.export.json.all/
  [2]: https://community.neo4j.com/t/apoc-export-json-query-jsonformat-setting-doesnt-work/35508",1616730909,https://stackoverflow.com/q/66810830,Amir,"['arrays', 'json', 'export', 'neo4j']"
66807066,Neo4j: Difference between rand() and rand() in with clause when matching random nodes,"I found [here][1] that i can select random nodes from neo4j using next queries:

 1. `MATCH (a:Person) RETURN a ORDER BY rand() limit 10`
 2. `MATCH (a:Person) with a, rand() as rnd RETURN a ORDER BY rnd limit 10`

Both queries seems to do the same thing but when I try to match random nodes that are in relationship with a given node then I have different results:

The next query will return always the same nodes (nodes are not randomly selected)

    MATCH (p:Person{user_id: &#39;1&#39;})-[r:REVIEW]-&gt;(m:Movie)
    return m order by rand() limit 10

...but when I use rand() in a with clause I get indeed random nodes:

  

    MATCH (p:Person{user_id: &#39;1&#39;})-[r:REVIEW]-&gt;(m:Movie)
    with m, rand() as rnd
    return m order by rnd limit 10


Any idea why rand() behave different in a with clause in the second query but in the first not?
 
 

  [1]: https://stackoverflow.com/questions/12510696/neo4j-is-there-a-way-how-to-select-random-nodes",1616703892,https://stackoverflow.com/q/66807066,S. Florin,"['random', 'neo4j', 'cypher']"
66806041,TypeError: Cannot read property &#39;identity&#39; of null Javascript Neo4J data,"maybe you can help me with this issue. I&#180;m trying to code in my js app a get request to a Neo4J database and send this data to a ejs page. The problem is that when my request gets nothing (null) it blocks me all the code with an error: &quot;TypeError: Cannot read property &#39;identity&#39; of null&quot;. The only what I&#180;m looking for, is when no data are retrieved nothing should happen without throwing any errors... only continuing with the rest of the code, but I don&#180;t know how to handle this &quot;null&quot;.

&lt;!-- begin snippet: js hide: false console: true babel: false --&gt;

&lt;!-- language: lang-js --&gt;

    app.get(&#39;/page/:id&#39;, function(req, res) {
      var id = req.params.id;
      
          session
          .run(&quot;OPTIONAL MATCH(a:Person)-[r]-(b) WHERE id(a)=toInteger($idParam) RETURN b&quot;, {
          idParam:id
          })
          .then(function(result2){
              var RelationArr = [];
              result2.records.forEach(function(record){

                RelationArr.push({

                  id: record._fields[0].identity.low,
                  name: record._fields[0].properties.name,
                  title: record._fields[0].properties.title,
          });
          });

          res.render(&#39;person&#39;, {
              relation: RelationArr,
          });
          })

          .catch(function(err){
            console.log(err);
          });
          })

&lt;!-- end snippet --&gt;

",1616699015,https://stackoverflow.com/q/66806041,Artur,"['javascript', 'ejs', 'neo4j', 'node.js']"
66803386,Increase Transaction timeout in Neo4j Sandbox (Neo4j Browser version: 4.2.1),"I&#39;m trying to Load a CSV file with 50,000 rows into Neo4j Browser (sandbox) and the transaction keeps timing out. I understand that I need to increase the timeout time, but don&#39;t know how to do it. 

Here is the error I receive;


----------


**Neo.ClientError.Transaction.TransactionTimedOut**

The transaction has been terminated. Retry your operation in a new transaction, and you should see a successful result. The transaction has not completed within the specified timeout (dbms.transaction.timeout). You may want to retry with a longer timeout. 


----------

Just to reiterate, I&#39;m not using the Neo4j Desktop or Community so I don&#39;t have access to any config files. 
Please advice!",1616688435,https://stackoverflow.com/q/66803386,Dhruv Chawla,['neo4j']
66800073,why wrong to store a dictionary/map in neo4j as a property,"I have a data structure in the form of a tree. So it has vertices within vertices. Neo4j would be a perfect match but alas someone has made a decision that a property can not be a dictionary/map.

I find this strange. Neo4j is all about vertices. So why not accept tree shaped data?
It would seem so intuitive. 

I guess it must be for a good reason. Can it be difficult to manage updates? Or handling memory?

Does anyone know?
And does anyone know an alternative to Neo4j that can store a tree-structure? Or maybe an addon or something that handles that?",1616677341,https://stackoverflow.com/q/66800073,eric,['neo4j']
66796567,Cypher return multiple hops through pattern of relationships and nodes,"I&#39;m making a proof of concept access control system with neo4j at work, and I need some help with Cypher.

The data model is as follows:

    (:User|Business)-[:can]-&gt;(:Permission)&lt;-[:allows]-(:Business)

Now I want to get a path from a User or a Business to all the Business-nodes that you can reach trough the

     -[:can]-&gt;(:Permission)&lt;-[:allows]- 

pattern. I have managed to write a MATCH that gets me halfway there:

    MATCH
      path = 
      	(:User {userId: &#39;e96cca53-475c-4534-9fe1-06671909fa93&#39;})-[:can|allows*]-(b:Business)

but this doesn&#39;t have any directions, and I can&#39;t figure out how to include the directions without reducing the returned matches to only the direct matches (i.e it doesn&#39;t continue after the first hit on a `:Business`  node)

So what I&#39;m wondering is:

 1. Is there a way to match multiple of these hops in one query? 
 2. Should I model this entirely different? 
 3. Am I on the wrong path completely and the query should be completely
    rewritten",1616664730,https://stackoverflow.com/q/66796567,megatrond,"['cypher', 'neo4j']"
66796163,neo4j cannot start on Mac m1: Exception in thread &quot;main&quot; java.lang.UnsatisfiedLinkError,"I&#39;ve tried neo4j with version 4.2.3 and 4.2.4 with openjdk11 and openjdk16, none of them works.

Here is the full log of this error:

INFO Starting...

Exception in thread &quot;main&quot; java.lang.UnsatisfiedLinkError: /Users/tenetwang/Library/Caches/JNA/temp/jna7021027558011019290.tmp: dlopen(/Users/tenetwang/Library/Caches/JNA/temp/jna7021027558011019290.tmp, 1): no suitable image found.  Did find:
	/Users/tenetwang/Library/Caches/JNA/temp/jna7021027558011019290.tmp: no matching architecture in universal wrapper
	/Users/tenetwang/Library/Caches/JNA/temp/jna7021027558011019290.tmp: no matching architecture in universal wrapper
	at java.base/java.lang.ClassLoader$NativeLibrary.load0(Native Method)
	at java.base/java.lang.ClassLoader$NativeLibrary.load(ClassLoader.java:2442)
	at java.base/java.lang.ClassLoader$NativeLibrary.loadLibrary(ClassLoader.java:2498)
	at java.base/java.lang.ClassLoader.loadLibrary0(ClassLoader.java:2694)
	at java.base/java.lang.ClassLoader.loadLibrary(ClassLoader.java:2627)
	at java.base/java.lang.Runtime.load0(Runtime.java:768)
	at java.base/java.lang.System.load(System.java:1837)
	at com.sun.jna.Native.loadNativeDispatchLibraryFromClasspath(Native.java:1018)
	at com.sun.jna.Native.loadNativeDispatchLibrary(Native.java:988)
	at com.sun.jna.Native.&lt;clinit&gt;(Native.java:195)
	at org.neo4j.internal.unsafe.UnsafeUtil.allocateMemory(UnsafeUtil.java:441)
	at org.neo4j.io.pagecache.impl.muninn.VictimPageReference.getVictimPage(VictimPageReference.java:42)
	at org.neo4j.io.pagecache.impl.muninn.MuninnPageCache.&lt;init&gt;(MuninnPageCache.java:284)
	at org.neo4j.io.pagecache.impl.muninn.MuninnPageCache.&lt;init&gt;(MuninnPageCache.java:256)
	at org.neo4j.kernel.impl.pagecache.ConfiguringPageCacheFactory.createPageCache(ConfiguringPageCacheFactory.java:99)
	at org.neo4j.kernel.impl.pagecache.ConfiguringPageCacheFactory.getOrCreatePageCache(ConfiguringPageCacheFactory.java:87)
	at org.neo4j.graphdb.factory.module.GlobalModule.createPageCache(GlobalModule.java:373)
	at org.neo4j.graphdb.factory.module.GlobalModule.lambda$new$1(GlobalModule.java:219)
	at org.neo4j.graphdb.factory.module.GlobalModule.tryResolveOrCreate(GlobalModule.java:261)
	at org.neo4j.graphdb.factory.module.GlobalModule.&lt;init&gt;(GlobalModule.java:218)
	at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.createGlobalModule(DatabaseManagementServiceFactory.java:252)
	at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.build(DatabaseManagementServiceFactory.java:126)
	at org.neo4j.server.CommunityBootstrapper.createNeo(CommunityBootstrapper.java:36)
	at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:134)
	at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:90)
	at org.neo4j.server.CommunityEntryPoint.main(CommunityEntryPoint.java:35)
",1616663102,https://stackoverflow.com/q/66796163,tenetwang,"['neo4j', 'java', 'apple-m1', 'macos']"
66782662,Error when launching GraphQL Architect against remote neo4j,"I&#39;m trying Neo4j GraphQL Architect graph app for the first time (v0.0.26)

I successfully installed it to Neo4j Desktop 1.4.3 (on Mac 10.15)

When I open it against my operational remote db, I get a dialog that says:

&gt; Error 0! Boolean cannot represent a non boolean value: &quot;true&quot;
&gt;
&gt; Error 1! Boolean cannot represent a non boolean value: &quot;true&quot;

Any advice?",1616594371,https://stackoverflow.com/q/66782662,randulfir,"['graphql', 'neo4j']"
66781448,Cypher query to get node by property not working,"I&#39;m building a Neo4j prototype in NodeJS.

I&#39;m running a Cypher query on my local browser to test.

When I run this query, I get this:
```
MATCH (n) RETURN n;
```
[![screenshot of graph][1]][1]


But when I try to get a `User` by the `id` property, I get nothing.

This returns nothing
```
MATCH (u:User {id: 1}) RETURN u;
```

What am I doing wrong? 

Eventually, I want to get the followers of a user using this:

```
MATCH (:User {id: 2})&lt;-[:FOLLOWING]-(followers) RETURN followers.id;
```

  [1]: https://i.stack.imgur.com/I9x89.png",1616590322,https://stackoverflow.com/q/66781448,Davina Leong,['neo4j']
66779398,Should I remove labels for which no node is in the database?,"In a neo4j database If I list all the labels with the `CALL db.labels()` it returns 216 records. Mainly because there has been lots of evolutions in this db. But if I list all the nodes and count them by label, I only have 35 records.

 1. Is there a performance impact related to the amount of labels even if some labels have no node?
 2. If so how can we remove them?",1616582771,https://stackoverflow.com/q/66779398,Yoann Maingon,['neo4j']
66773216,The old parameter syntax `{param}` is no longer supported,"I have tried to write data to the neo4j by below code:
```
  var express = require(&#39;express&#39;);
  var path = require(&#39;path&#39;); 
  var logger= require(&#39;morgan&#39;);
  var bodyParser= require(&#39;body-parser&#39;);
  var neo4j= require(&#39;neo4j-driver&#39;);

  var app=express(); 

  //view Engine:
  app.set(&#39;views&#39;,path.join(__dirname,&#39;views&#39;));
  app.set(&#39;view engine&#39;, &#39;ejs&#39;);
  app.use(logger(&#39;dev&#39;));
  app.use(bodyParser.json());
  app.use(bodyParser.urlencoded({extended:false}));
  app.use(express.static(path.join(__dirname,&#39;public&#39;)));
  var driver = neo4j.driver(&#39;bolt://localhost&#39;,neo4j.auth.basic(&#39;neo4j&#39;,&#39;5141&#39;));
  var session = driver.session();

  app.get(&#39;/&#39;,function(req, res){
    session
        .run(&#39;MATCH(n:Movie) RETURN n LIMIT 25&#39;)
        .then(function(result){
            var movieArr = [];
                result.records.forEach(function(record){
                movieArr.push({
                    id: record._fields[0].identity.low,
                    title: record._fields[0].properties.title, 
                    year: record._fields[0].properties.year
                    
                });
            });
            session
                .run(&#39;MATCH(n:Actor) RETURN n LIMIT 25&#39;)
                .then(function(result2)
                {
                    var actorArr = [];
                    result2.records.forEach(function(record){
                        actorArr.push({
                            id: record._fields[0].identity.low,
                            name: record._fields[0].properties.name, 
                        })

                    });
                    res.render(&#39;index&#39;,{
                        movies: movieArr,
                        actors: actorArr

                    });
                })
                .catch(function(err){
                    console.log(err);
                });
           
        })
        .catch(function(err){
            console.log(err);
        });
  });
  app.post(&#39;/movie/add&#39;,function(req,res){
    var title=req.body.title;
    var year=req.body.year;

    session
        .run(&#39;CREATE(n:Movie{title:{titleParam},year:{yearParam}}) RETURN n.title&#39;   
            {titleParam:title,yearParam:year})
        .then(function(result){
            res.redirect(&#39;/&#39;);
            session.close();
        })
        .catch(function(err){
            console.log(err);
                });

    res.redirect(&#39;/&#39;);
  });
  app.listen(3000);
  console.log(&#39;Server started on port 3000 &#39;);

  module.exports= app;
```
But I keep getting the below error in the terminal

   Neo4jError: The old parameter syntax `{param}` is no longer supported. Please use `$param`   
              instead (line 1, column 22 (offset: 21))
              &quot;CREATE(n:Movie{title:{titleParam},year:{yearParam}}) RETURN n.title&quot;
      

Does anyone have any idea how to solve the issue?
",1616546572,https://stackoverflow.com/q/66773216,Ilnaz Nikseresht,"['javascript', 'write', 'neo4j']"
66764218,SpringData Neo4j @Query does not populate @Relationship Nodes,"The Spring Data for neo4j @Query annotation does not populate any child/parent Nodes marked by the @Relationship annotation.

When using the standard @CrudRepository or @PagingAndSortingRepository queries in a SpringData Repository class, the Child/Parent Nodes classes are returned fulled populated.

**Repository Interface**
```
@Repository(&quot;trackerRepository&quot;)
public interface TrackerRepository extends PagingAndSortingRepository&lt;Tracker, String&gt; {

    Tracker findByTrackerId(@NotNull String trackerId);
}
```

**Node Class**
```
public final class Tracker extends Node {

    @NotNull
    @JsonProperty(&quot;trackerId&quot;)
    private String trackerId;

    @NotNull
    @Relationship(type = &quot;ASSIGNED_TO&quot;)
    @JsonProperty(&quot;asset&quot;)
    private Asset asset;

    @NotNull
    @Relationship(type = &quot;ISSUED_BY&quot;)
    @JsonProperty(&quot;organization&quot;)
    private Organization organization;
}
```

When using the findByTrackerId method, the query generated by Spring using the method name/signature works perfectly and returns the fully populated Asset and Organization nodes.

However, when using the @Query annotation and not the Spring queries generated from the method signature, the @Relationship nodes are not returned with the query response.

**Repository Interface**
```
@Repository(&quot;trackerRepository&quot;)
public interface TrackerRepository extends PagingAndSortingRepository&lt;Tracker, String&gt; {

    @Query(&quot;MATCH (tracker:Tracker) WHERE (tracker.trackerId = $trackerId) RETURN tracker&quot;)
    Tracker findByTrackerId(@NotNull @Param(&quot;trackerId&quot;) String trackerId);
}
```

Is it possible to configure repository methods marked with @Query to join parent/child Nodes defined by the @Relationship annotation?
",1616506332,https://stackoverflow.com/q/66764218,Dayel Ostraco,"['spring-data-neo4j', 'spring', 'neo4j', 'java']"
66759334,apoc.load.jsonParams as POST request with Body input parameters,"In the documentation of Neo4j for **apoc.load.jsonParams** there is an example how to make a POST request:

    CALL apoc.load.jsonParams(
      &quot;https://neo4j.com/docs/search/&quot;,
      {method: &quot;POST&quot;},
      apoc.convert.toJson({query: &quot;subquery&quot;, version: &quot;4.0&quot;})
    );

but unfortunately this is not sufficient for me because I also need a body with parameters for the POST request:

    [HttpPost(&quot;getJson&quot;)]
    [Produces(&quot;application/json&quot;)]
    public async Task&lt;JsonResult&gt; GetJson(int id, [FromBody] List&lt;string&gt; params)

My try:

    CALL apoc.load.jsonParams(&quot;http://192.168.1.128:4040/api/getJson?id=17&quot;,{method: &quot;POST&quot;}, &quot;$.BusinessData[*]&quot;) YIELD value WITH [&quot;DATA1&quot;, &quot;DATA2&quot;] as body return *

Error message:

    Failed to invoke procedure `apoc.load.jsonParams`: Caused by: java.lang.RuntimeException: Can&#39;t read url or key http://192.168.1.128:4040/api/getJson?id=17 as json: Server returned HTTP response code: 500 for URL

So how must the apoc call look like to fullfill the POST request?",1616486931,https://stackoverflow.com/q/66759334,leon22,"['rest', 'neo4j', 'c#', 'neo4j-apoc', 'post']"
66755491,Preventing cycles in a neo4j graph where relationships are dated,"**Note:** I apologize for not being able to include the images directly in the post, I don&#39;t have enough reputation in stackoverflow yet.

I&#39;m brand new to graph databases, but I&#39;m trying to understand if a graph database is suited for my problem. Here we go!

I have a set of users who can relate to each other via a &quot;Parent&quot; relationship (i.e., they can be built into a tree / hierarchy). The &quot;Parent&quot; relationship from one user to another is said to &quot;begin&quot; as of a certain date, and the relationship only &quot;ends&quot; if/when another &quot;Parent&quot; relationships exists between the same users and with a later date.

Every user can have &lt;= 1 parent as of any particular date, and can have &gt;=0 children. I.e., at most one parent at a time, and no limit to the number of children.

I&#39;ve read blog posts dealing with dated relationships, but they don&#39;t seem to address this level of complexity:

 - https://maxdemarzi.com/2015/08/26/modeling-airline-flights-in-neo4j/
 - https://maxdemarzi.com/2017/05/24/flight-search-with-neo4j/

**My challenge:**

For a given set of users with existing &quot;Parent&quot; relationships, determine whether a new &quot;Parent&quot; relationship can be added &quot;as of&quot; a certain date WITHOUT creating a cycle *anywhere in the timeline*.

To help visualize an example, imagine we have four users Alice, Bob, Carlos, and David.

```
-----------------------------------------
| User		| Date			| Parent	|
|-----------|---------------|-----------|
| Alice		| 09/13/2012	| Bob		|
| Alice		| 04/01/2021	| David		|
| Bob		| 01/31/2020	| Carlos	|
| Carlos	| 02/14/2008	| David		|
-----------------------------------------
```
Here is a (highly abstract) picture representing the current state of the data (time flows to the right):

[Initial state of the data as timeline]
https://i.stack.imgur.com/qdcbL.png

So in this example Alice has Bob as a parent from 9/13/2012 until 4/1/2021, at which point she begins to have David as a parent. Bob has no parent until 1/31/2020, at which point he gets Carlos as a parent. Etc.

I need to be able to determine whether an update/insert will create a cycle in the &quot;parent&quot; hierarchy *at any point in time*. So, for example, I&#39;d like to be able to determine that it would be **INVALID** to set Carlos&#39;s parent to be Alice as of 10/22/2020 because then there would be a cycle in the hierarchy for the period between 10/22/2020 and 4/1/2021 (i.e., Alice--&gt;Bob--&gt;Carlos--&gt;Alice). To help visualize it:

[Invalid addition creates a cycle in the timeline]
https://i.stack.imgur.com/xA2vv.png

But I also need to be able to determine that it would be **VALID** to set Carlos&#39;s parent to Alice as of 10/22/2021, as drawn here:

[Valid addition with no cycles in timeline]
https://i.stack.imgur.com/9u0P4.png

In terms of modeling the data, I started by thinking of two different models.

**First:**

I tried having my only nodes be &quot;Users,&quot; and having my &quot;Parent&quot; relationships include a date in the relationship type. Since the range of dates is huge and the dates themselves are not known in advance, I&#39;m not sure this is a good idea but decided to give it a shot anyway.

Diagram:
[graph diagram with dated relationships]
https://i.stack.imgur.com/ZuPDR.png

Cypher:
 

    CREATE (n0:User {name: &quot;Alice&quot;})-[:P_2012_09_13]-&gt;(:User {name: &quot;Bob&quot;})-[:P_2020_01_31]-&gt;(:User {name: &quot;Carlos&quot;})-[:P_2008_02_14]-&gt;(:User {name: &quot;David&quot;})&lt;-[:P_2021_04_01]-(n0)

 

**Second:**

I tried creating &quot;UserDay&quot; nodes to capture the date element, thereby reducing the range of relationship types to only two (i.e., a 1:many &quot;HAS&quot; relationship from User to UserDay, then a 1:1 &quot;P&quot; relationship from UserDay to User).

Diagram:
[graph diagram with user-days]
https://i.stack.imgur.com/W60bp.png

Cypher:
 

    CREATE (n8:UserDay {date: &quot;2021-04-01&quot;})&lt;-[:HAS]-(:User {name: &quot;Alice&quot;})-[:HAS]-&gt;(:UserDay {date: &quot;2012-09-13&quot;})-[:P]-&gt;(:User {name: &quot;Bob&quot;})-[:HAS]-&gt;(:UserDay {date: &quot;2020-01-31&quot;})-[:P]-&gt;(:User {name: &quot;Carlos&quot;})-[:HAS]-&gt;(:UserDay {date: &quot;2008-02-14&quot;})-[:P]-&gt;(:User {name: &quot;David&quot;})&lt;-[:P]-(n8)

 

Given a source User, destination User, and start date, I need to be able to determine if a cycle would be created in the hierarchy for any time in the timeline.

Carlos, Alice, 10/22/2020 ----&gt; should be **invalid**

Carlos, Alice, 10/22/2021 ----&gt; should be **valid**

I&#39;ve been spinning my wheels reading through neo4j docs and googling, and finally decided to ask my very first question on stackoverflow! Please let me know if you have any questions or if anything I&#39;ve said is unclear.

Thanks in advance!",1616458066,https://stackoverflow.com/q/66755491,basefrequency,"['hierarchy', 'neo4j', 'cycle', 'timeline', 'graph']"
66745451,Delete the previous node and relationship and point it to the current node with same relationship,"I&#39;m trying to form a relationship b/w parent and child.

    MERGE (c:Child{name:&#39;CA&#39;})
    MERGE (p:Parent{name:&#39;Parent&#39;})
For creating a relationship, 

    MERGE (p)-[:parent_of]-&gt;(c)
This queries are written in a separate java function named `createParentChildRelationship`.
Whenever I try to call this function with a same Parent name with a different child name passing a parameter to the function, it forms a new relationship . But I need only the current child node to point the parent node, by deleting the previous child nodes and it&#39;s relationship with the parent.
So I tried this way of approaching it, 

    MERGE (c:Child{name:&#39;CA&#39;})
    MERGE (p:Parent{name:&#39;Parent&#39;})
    MATCH (c)-[r:parent_of]-(p) DELETE r, c, p
    CREATE (p)-[:parent_of]-&gt;(c) 

But it shows me `1 property is set` but relationship isn&#39;t created
 ",1616413730,https://stackoverflow.com/q/66745451,Madhan Kumar,"['neo4j', 'cypher']"
66744194,Passing parameters to gds.create.graph in Neo4j,"How do I pass parameters to gds.create.graph in Neo4j? For instance, what is wrong with this query? (I use py2neo)

    query = &quot;&quot;&quot;
    CALL gds.graph.create.cypher(
        &#39;betweenness&#39;,
        &#39;MATCH (n) WHERE n:Criminal AND id(n) in $nodes_in_component 
        RETURN id(n) AS id, labels(n) AS labels&#39;,
        &#39;MATCH (m:Crime)&lt;-[r:INVOLVED_IN]-(n:Criminal) 
        WHERE  id(m) in $nodes_in_component
        RETURN id(m) AS source, id(n) AS target, type(r) AS type&#39;,
        parameters:{nodes_in_component: nodes_in_component}
        )
        YIELD graphName, nodeCount, relationshipCount, createMillis
        &quot;&quot;&quot;
    graph.run(query, parameters= {&quot;nodes_in_component&quot;:nodes_in_component}).data()

",1616408644,https://stackoverflow.com/q/66744194,Sanjay Singh,"['neo4j', 'graph-data-science']"
66744132,How to avoid duplicate while creating node using apoc.periodic.iterate for csv load neo4j?,"I have to create node from CSV file. As the file is too large I am using apoc.periodic.iterate function to read file. 
CSV is having duplicate entries, and due to parallel processing duplicate nodes are created. How can I make sure that the duplicate nodes are not created even with parallel processing. 

``` 
CALL apoc.periodic.iterate(&#39;LOAD CSV WITH HEADERS FROM &quot;file:///DATA.csv&quot; AS payload return payload&#39;,
&#39;MERGE (l:PERSON {name :payload.name})
 ON CREATE SET 
			  l.pid = payload.id,			  
		      l.createdDate= timestamp(),
			  l.lastModifiedDate= timestamp()			  
 ON MATCH SET 
			  l.lastModifiedDate= timestamp()&#39;,
    {batchSize:500, parallel:true, concurrency: 4});
```
",1616408395,https://stackoverflow.com/q/66744132,Piyush Srivastava,"['neo4j', 'cypher', 'csv', 'neo4j-apoc']"
66741207,Bipartite graph projection via Cypher query Neo4j,"I&#39;m new in neo4j and Im trying to make a projection of a bipartite graph of users and movies that they rated. Here is the information that I have:

[enter image description here][1]

I create the graph in Neo4j and this is what I got:

[enter image description here][2]

I&#39;m trying to do a projection  to connect users who rated movies with the SAME rating, but I have not been successful. This is the code that I have for the projection:
```
MATCH (u:User)-[r:RATED_MOVIE]-&gt;(m:Movie) 
WITH m, collect(u) as users, collect(r) as raitings, count(r) as weights
UNWIND users as u1
UNWIND users as u2
UNWIND raitings as r1
UNWIND raitings as r2
WITH  u1, u2, r1, r2
WHERE u1.UserId &lt; u2.UserId and r1.rating = r2.rating
CREATE (u1)-[:CONNECTED{common_movies_rated:weights}]-&gt;(u2)
RETURN u1, u2
```
The expected output is a graph like this:

[enter image description here][3]


  [1]: https://i.stack.imgur.com/1QN4m.png
  [2]: https://i.stack.imgur.com/Csqiz.png
  [3]: https://i.stack.imgur.com/xrhoU.png",1616394323,https://stackoverflow.com/q/66741207,suribe06,"['database', 'cypher', 'graph', 'neo4j', 'bipartite']"
66741099,py2neo: using cypher inline gives 404 error,"I was following simple py2neo tutorial here: http://nicolewhite.github.io/neo4j-jupyter/hello-world.html

Everything worked fine, all the entries appear in the neo4j in-browser version, however when I try to run inline Cypher queries, I get a 404 error.

```
%%cypher
http://neo4j:password@localhost:7474/db/data/
MATCH (person:Person)-[:LIKES]-&gt;(drink:Drink)
RETURN person.name, drink.name, drink.calories
```
Here&#39;s the traceback: 
```
Format: (http|https)://username:password@hostname:port/db/name
---------------------------------------------------------------------------
NotFoundError                             Traceback (most recent call last)
&lt;ipython-input-12-de2d5705ff61&gt; in &lt;module&gt;
----&gt; 1 get_ipython().run_cell_magic(&#39;cypher&#39;, &#39;&#39;, &#39;http://neo4j:password@localhost:7474/db/data/\nMATCH (person:Person)-[:LIKES]-&gt;(drink:Drink)\nRETURN person.name, drink.name, drink.calories\n&#39;)

~/.local/lib/python3.6/site-packages/IPython/core/interactiveshell.py in run_cell_magic(self, magic_name, line, cell)
   2369             with self.builtin_trap:
   2370                 args = (magic_arg_s, cell)
-&gt; 2371                 result = fn(*args, **kwargs)
   2372             return result
   2373 

&lt;decorator-gen-127&gt; in execute(self, line, cell, local_ns)

~/.local/lib/python3.6/site-packages/IPython/core/magic.py in &lt;lambda&gt;(f, *a, **k)
    185     # but it&#39;s overkill for just that one bit of state.
    186     def magic_deco(arg):
--&gt; 187         call = lambda f, *a, **k: f(*a, **k)
    188 
    189         if callable(arg):

&lt;decorator-gen-126&gt; in execute(self, line, cell, local_ns)

~/.local/lib/python3.6/site-packages/IPython/core/magic.py in &lt;lambda&gt;(f, *a, **k)
    185     # but it&#39;s overkill for just that one bit of state.
    186     def magic_deco(arg):
--&gt; 187         call = lambda f, *a, **k: f(*a, **k)
    188 
    189         if callable(arg):

~/.local/lib/python3.6/site-packages/cypher/magic.py in execute(self, line, cell, local_ns)
    106         user_ns.update(local_ns)
    107         parsed = parse(&quot;&quot;&quot;{0}\n{1}&quot;&quot;&quot;.format(line, cell), self)
--&gt; 108         conn = Connection.get(parsed[&#39;as&#39;] or parsed[&#39;uri&#39;], parsed[&#39;as&#39;])
    109         first_word = parsed[&#39;cypher&#39;].split(None, 1)[:1]
    110         if first_word and first_word[0].lower() == &#39;persist&#39;:

~/.local/lib/python3.6/site-packages/cypher/connection.py in get(cls, descriptor, alias)
     45                 cls.current = conn
     46             else:
---&gt; 47                 cls.current = Connection(descriptor, alias)
     48         if cls.current:
     49             return cls.current

~/.local/lib/python3.6/site-packages/cypher/connection.py in __init__(self, connect_str, alias)
     24                 gdb = GraphDatabase(self.connections[connect_str])
     25             else:
---&gt; 26                 gdb = GraphDatabase(connect_str)
     27                 alias = alias or connect_str
     28         except:

~/.local/lib/python3.6/site-packages/neo4jrestclient/client.py in __init__(self, url, username, password, cert_file, key_file)
     81             response_json = response.json()
     82         else:
---&gt; 83             raise NotFoundError(response.status_code, &quot;Unable get root&quot;)
     84         if &quot;data&quot; in response_json and &quot;management&quot; in response_json:
     85             response = Request(**self._auth).get(response_json[&quot;data&quot;])

NotFoundError: Code [404]: Not Found. Nothing matches the given URI.
Unable get root

```

I tried checking if the URI works according to this answer [here](https://stackoverflow.com/questions/33260980/neo4j-rest-api-is-returning-404), and I get 404 error there too:

```
~$ curl -i --user neo4j:password http://localhost:7474/db/data/
HTTP/1.1 404 Not Found
Access-Control-Allow-Origin: *
Cache-Control: must-revalidate,no-cache,no-store
Content-Type: text/html;charset=iso-8859-1
Content-Length: 0
```

I tried setting the `Graph` option to include the link, but it didn&#39;t help:

```
graph = Graph(&quot;http://neo4j:password@localhost:7474/db/data/&quot;)
```

Could you please tell me where have I made a mistake?",1616393628,https://stackoverflow.com/q/66741099,doumane,"['python', 'neo4j', 'py2neo']"
66738800,code: &#39;Neo.ClientError.Security.Unauthorized&#39;,"I am trying to connect neo4j with a javascript driver by below code 

    var express = require(&#39;express&#39;);
    var path = require(&#39;path&#39;); 
    var logger= require(&#39;morgan&#39;);
    var bodyParser= require(&#39;body-parser&#39;);
    var neo4j= require(&#39;neo4j-driver&#39;);

    var app=express(); 

    //view Engine:
    app.set(&#39;views&#39;,path.join(__dirname,&#39;views&#39;));
    app.set(&#39;view engine&#39;, &#39;ejs&#39;);
    app.use(logger(&#39;dev&#39;));
    app.use(bodyParser.json());
    app.use(bodyParser.urlencoded({extended:false}));
    app.use(express.static(path.join(__dirname,&#39;public&#39;)));
    var driver = neo4j.driver(&#39;bolt://localhost&#39;,neo4j.auth.basic(&#39;neo4j&#39;,&#39;5141&#39;));
    var session = driver.session();

    app.get(&#39;/&#39;,function(req, res){
         session
              .run(&#39;MATCH(n:Movie) RETURN n LIMIT 25&#39;)
              .then(function(result){
                   result.records.forEach(function(record){
               console.log(record._fields[0].properties);
            });
        })
        .catch(function(err){
            console.log(err);
        });
    res.send(&#39;It works&#39;);
});

    app.listen(3000);
    console.log(&#39;Server started on port 3000 &#39;);
    module.exports= app;

but I keep getting the &#39;Neo.ClientError.Security.Unauthorized&#39; message in terminal. Does anyone have any idea how to solve this issue?",1616370843,https://stackoverflow.com/q/66738800,Ilnaz Nikseresht,"['javascript', 'driver', 'neo4j']"
66738003,neo4j server side javascript,"I have a neo4j desktop (1.4.3) database on my Windows PC. in an html code, I am connectecting to the DB using  

`const driver = neo4j.driver(&quot;bolt://IP_ADDRESS:7687&quot;, neo4j.auth.basic(&quot;neo4j&quot;, &quot;PASSWORD&quot;));`

After that I query the DB and display the results on the web page (I use leafletjs maps, but this is not the issue)

     var session = driver.session();
       session
      .run(`MATCH....etc.... return ....
        `)
      .subscribe({
         ...... etc

Everything is fine so far. I run the page on my PC or from another PC in my home network, everything is fine. The setting of neo4j is (dbms.default_listen_address=0.0.0.0) no issues there.

The question is how do I expose this page to the colleagues outside my network?
Using noip.com, I got a temporary domain mapped to my external IP.
I also configured the router to forward port 80.  
But when the page Javascript gets loaded on an external client, it tries to connect to neo4j on that client. When I put the external IP addtess in &quot;const driver ...&quot; the connection does not work. 

How do I make the connection to the DB from my server, but the queries to the DB come from the client who loaded the Javascript?

Edit: Forgot to mention that I am also using Apache Web Server (Xampp) to serve the page to remote users.

",1616363931,https://stackoverflow.com/q/66738003,FEldin,"['neo4j', 'bolt', 'javascript', 'node.js']"
66734478,How to optimise recursive query - Neo4j?,"I am developing a contact tracing framework using Neo4j. There are 2 types of nodes, namely Person and Location. There exists a relationship VISITED between a Person and a Location, which has properties startTS and endTS. Example:

[![enter image description here][1]][1]

Now suppose person 1 is infected. I need to find  all the persons who have been in contact with this person. For each person identified, I need to find all other persons who have been in contact with that person. This process is repeated until an identified person has not met anyone. Here is a working code:



    
```
MATCH path = (infected:Person {id:&#39;1&#39;})-[*]-(otherPerson:Person)
WITH relationships(path) as rels, otherPerson
WHERE all(i in range(1, size(rels)-1)
  WHERE i % 2 = 0
  OR (rels[i].endTS &gt;= rels[i-1].startTS AND rels[i].startTS &lt;= rels[i-1].endTS)
)
RETURN otherPerson

```

The problem is that the process is taking way too much time to complete with large datasets. Can the above query be optimised? Thank you for your help.

  [1]: https://i.stack.imgur.com/hEoRO.png",1616342312,https://stackoverflow.com/q/66734478,TechXpert,"['neo4j', 'graph-databases', 'cypher']"
66730289,neo4j delete nodey with children and without,"I have simple graph and i want to find category and delete it. If category has children, than delete category and all children. I&#39;ve made deletion category with children with this command:
```cypher
MATCH path = (c:Category)-[*]-&gt;(cc:Category)
WHERE c.id = &quot;95bec604-5da2-4297-b792-5a866e292df4&quot;
DETACH DELETE path
```

But this comamnd does not work for single node, without children. How i can achieve it?
[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/14p4r.png",1616315890,https://stackoverflow.com/q/66730289,dikkini,"['neo4j', 'graph']"
66707413,How to unify results of multiple NEO4J queries,"I am a newbie in `Neo4J`. I have a question about combining results of several simple queries in `neo4j`. For example: 

    MATCH (p:people)-[:live_in]-&gt;(c:countries)
             RETURN p.name AS name, c.name AS countries
    
   and  

    MATCH (p:people)-[:has_friend]-&gt;(n:people)
         RETURN p.name AS name, n.name AS friends

and      etc.

I expect a result in a table as follows:

    |name|countries|friends|

Thank you very much for help.
",1616153747,https://stackoverflow.com/q/66707413,Steve Hendra,['neo4j']
66703705,Cypher Query - Collect two separate types of nodes connected to a third type of node,"First, here is what I desire and I then will explain what I have tried.  

In this simplified example I have a graph with nodes `A`, `B`, `C`, and `D`. I have relationships like `A-&gt;B`, `B-&gt;C` and `B-&gt;D` only. I would like to aggregate each of the connections to a node A into a list and subsequently each of the connections to node B into two separate lists: one for `B-&gt;C` connections and one for `B-&gt;D` connections. Something like the below.

```
{
 &#39;A&#39;: &#39;A&#39;,
 &#39;Bs&#39;: [{
   &#39;B&#39;: &#39;B&#39;,
   &#39;Cs&#39;: [
     ...
   ]
   &#39;Ds&#39;: [
     ...
   ]
 }, ...]
}
```
Now for my specific use case. I have trip nodes that are connected to waypoints. Waypoints are connected to airports and what I call a POI. I would like to return a trip with a list of its waypoints where each waypoint has two lists: a list of airports and a list of POI. I have not been able to accomplish this successfully and have not found any examples with this exact use case. In addition to the query below, I have tried many other variations with foreach loops and other constructs. I think this is the closest I have come. In the below query, `B-&gt;C` would equate to the `HAS_AIRPORTS` relationship and `B-&gt;D` to the `HAS_POI` relationship. I think my problem comes down to there being multiple aggregations that need to be made on the same level. I am getting some strange output where things seem to be repeating themselves because of the 2 aggregations. Sorry if this is not clear, I am new to the terminology of the cypher query language. Thank you, I am appreciative of any help.
```
            MATCH (t:Trip {uid: $tripId})
            WITH t
            OPTIONAL MATCH (t)-[:HAS_WAYPOINTS]-(w {active: true})
            WITH t, w
            OPTIONAL MATCH (w)-[wa:HAS_AIRPORT]-(a:NeoAirport)
            WITH t, w, collect(a{.*, active:wa.active}) as airports
            WITH t, w {.*, airports:airports } as waypoints
            OPTIONAL MATCH (w)-[wp:HAS_POI {active: true}]-(p:PointOfInterest)
            WITH t, waypoints, w, collect({source:wp.source, uid:p.uid, placeId:p.placeId}) as pois
            WITH t, apoc.map.setKey( waypoints, &#39;pointsOfInterest&#39;, pois )
            WITH t, t {.*, waypoints: collect(waypoints) } as trips
            OPTIONAL MATCH (t)-[tsa:HAS_START_AIRPORTS]-(sa)
            WITH t, collect(sa) as sa, trips
            WITH t, apoc.map.setKey( trips, &#39;startAirports&#39;, sa ) as trips
            OPTIONAL MATCH (t)-[tea:HAS_START_AIRPORTS]-(ea)
            WITH t, collect(ea) as ea, trips
            WITH t, apoc.map.setKey( trips, &#39;endAirports&#39;, ea ) as trips
            RETURN trips
```",1616136741,https://stackoverflow.com/q/66703705,Zach,"['neo4j', 'cypher']"
66702971,Is it possible to get Lucene scoring as a number between 0 and 1?,"It seems that the number can be well above or below 1, not in the range of 0-1. Neo4j is using Lucene fulltext search and the scores are not in the range of 0-1. Is this expected in Lucene?",1616131948,https://stackoverflow.com/q/66702971,marlon,"['neo4j', 'lucene']"
66699185,Connection Unavailable : Trying to connect locally hosted Neo4j from docker app,"I have a neo4j database `https://localhost:7474` (https://localhost:7474) which I connect via py2neo&#39;s Graph Object (&quot;`bolt://127.0.0.1:7687`&quot;). All works if not in Docker Environment. Now What i wanted to do is connect to my app (built with fastpi:`https://fastapi.tiangolo.com/deployment/docker/`).

**My question is how do I connect to locally hosted (in my mac) neo4j db via docker image (fastapi) image hosted in docker.**   

However I get following error:

     docker run e7bf302e02ec


    Traceback (most recent call last):
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/client/__init__.py&quot;, line 742, in acquire
        cx = self._free_list.popleft()
    IndexError: pop from an empty deque
    
    During handling of the above exception, another exception occurred:
    
    Traceback (most recent call last):
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/wiring.py&quot;, line 162, in open
        s.connect(address)
    ConnectionRefusedError: [Errno 111] Connection refused
    
    The above exception was the direct cause of the following exception:
    
    Traceback (most recent call last):
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/client/bolt.py&quot;, line 212, in open
        wire = cls._connect(profile, on_broken=on_broken)
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/client/bolt.py&quot;, line 228, in _connect
        wire = Wire.open(profile.address, keep_alive=True, on_broken=on_broken)
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/wiring.py&quot;, line 164, in open
        raise_from(WireError(&quot;Cannot connect to %r&quot; % (address,)), error)
      File &quot;&lt;string&gt;&quot;, line 3, in raise_from
    py2neo.wiring.WireError: Cannot connect to IPv4Address((&#39;127.0.0.1&#39;, 7687))
    
    The above exception was the direct cause of the following exception:
    
    Traceback (most recent call last):
      File &quot;/usr/local/bin/uvicorn&quot;, line 8, in &lt;module&gt;
        sys.exit(main())
      File &quot;/usr/local/lib/python3.8/site-packages/click/core.py&quot;, line 829, in __call__
        return self.main(*args, **kwargs)
      File &quot;/usr/local/lib/python3.8/site-packages/click/core.py&quot;, line 782, in main
        rv = self.invoke(ctx)
      File &quot;/usr/local/lib/python3.8/site-packages/click/core.py&quot;, line 1066, in invoke
        return ctx.invoke(self.callback, **ctx.params)
      File &quot;/usr/local/lib/python3.8/site-packages/click/core.py&quot;, line 610, in invoke
        return callback(*args, **kwargs)
      File &quot;/usr/local/lib/python3.8/site-packages/uvicorn/main.py&quot;, line 362, in main
        run(**kwargs)
      File &quot;/usr/local/lib/python3.8/site-packages/uvicorn/main.py&quot;, line 386, in run
        server.run()
      File &quot;/usr/local/lib/python3.8/site-packages/uvicorn/server.py&quot;, line 49, in run
        loop.run_until_complete(self.serve(sockets=sockets))
      File &quot;/usr/local/lib/python3.8/asyncio/base_events.py&quot;, line 616, in run_until_complete
        return future.result()
      File &quot;/usr/local/lib/python3.8/site-packages/uvicorn/server.py&quot;, line 56, in serve
        config.load()
      File &quot;/usr/local/lib/python3.8/site-packages/uvicorn/config.py&quot;, line 308, in load
        self.loaded_app = import_from_string(self.app)
      File &quot;/usr/local/lib/python3.8/site-packages/uvicorn/importer.py&quot;, line 20, in import_from_string
        module = importlib.import_module(module_str)
      File &quot;/usr/local/lib/python3.8/importlib/__init__.py&quot;, line 127, in import_module
        return _bootstrap._gcd_import(name[level:], package, level)
      File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1014, in _gcd_import
      File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 991, in _find_and_load
      File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 975, in _find_and_load_unlocked
      File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 671, in _load_unlocked
      File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 783, in exec_module
      File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 219, in _call_with_frames_removed
      File &quot;./app/main.py&quot;, line 8, in &lt;module&gt;
        from .database import Base
      File &quot;./app/database.py&quot;, line 28, in &lt;module&gt;
        Base = Graph(DATABASE_URL, auth=(DATABASE_USERNAME, DATABASE_PASSWORD))
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/database/__init__.py&quot;, line 358, in __init__
        self.service = GraphService(profile, **settings)
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/database/__init__.py&quot;, line 189, in __init__
        self._connector = Connector(profile, **connector_settings)
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/client/__init__.py&quot;, line 893, in __init__
        self.add_pools(self._profile)
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/client/__init__.py&quot;, line 913, in add_pools
        pool = ConnectionPool.open(
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/client/__init__.py&quot;, line 570, in open
        seeds = [pool.acquire() for _ in range(init_size or cls.default_init_size)]
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/client/__init__.py&quot;, line 570, in &lt;listcomp&gt;
        seeds = [pool.acquire() for _ in range(init_size or cls.default_init_size)]
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/client/__init__.py&quot;, line 749, in acquire
        cx = self.connect()
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/client/__init__.py&quot;, line 706, in connect
        cx = Connection.open(self.profile, user_agent=self.user_agent,
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/client/__init__.py&quot;, line 141, in open
        return Bolt.open(profile, user_agent=user_agent,
      File &quot;/usr/local/lib/python3.8/site-packages/py2neo/client/bolt.py&quot;, line 223, in open
        raise_from(ConnectionUnavailable(&quot;Cannot open connection to %r&quot; % profile), error)
      File &quot;&lt;string&gt;&quot;, line 3, in raise_from
    py2neo.client.ConnectionUnavailable: Cannot open connection to ConnectionProfile(&#39;bolt://neo4j@127.0.0.1:7687&#39;)",1616101849,https://stackoverflow.com/q/66699185,lpt,"['docker', 'fastapi', 'py2neo', 'neo4j']"
66695863,How can I map one class to another in spring boot w/ neo4j?,"I am new to Java and spring framework. I am working on a neo4j project where I have neo4j image with docker. My main goal is to create a company node and link other nodes to it using neo4j and spring boot.

So far, I didn&#39;t make much progress. I can only create a project resource at the endpoint api/company/line/projects.

like this:

[![enter image description here][1]][1]


Here&#39;s the catch. I want to go to endpoint api/company/line/projects/employees and send a GET request here and get Employees that are in this project. But at this moment it is very confusing to me and I don&#39;t know how to do this.

Any help is appreciated

Here are my classes:

[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/c8rsk.png
  [2]: https://i.stack.imgur.com/hOihV.png

Employee class:
```
package com.thebman.neo4jstudy.node;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.neo4j.ogm.annotation.GraphId;
import org.neo4j.ogm.annotation.NodeEntity;
import org.springframework.data.neo4j.core.schema.GeneratedValue;
import org.springframework.data.neo4j.core.schema.Id;
import org.springframework.data.neo4j.core.schema.Node;
import org.springframework.data.neo4j.core.schema.Relationship;

@Data
@AllArgsConstructor
@NoArgsConstructor
@NodeEntity
public class Employee {
    @Id
    @GeneratedValue
    private Long Id;
    private String name;
    private int age;

}
```
Project class:
```
package com.thebman.neo4jstudy.node;

import com.sun.istack.internal.NotNull;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.neo4j.ogm.annotation.NodeEntity;
import org.springframework.data.neo4j.core.schema.GeneratedValue;
import org.springframework.data.neo4j.core.schema.Id;
import org.springframework.data.neo4j.core.schema.Relationship;

import java.util.Set;

@Data
@AllArgsConstructor
@NoArgsConstructor
@NodeEntity
public class Project {
    @Id
    @GeneratedValue
    private Long entityId;
    private String name;
    private String location;

    @Relationship(type = &quot;works_for&quot;, direction = Relationship.Direction.INCOMING)
    private Set&lt;Employee&gt; employee;

}
```

and controller class:
```
package com.thebman.neo4jstudy.controller;

import com.thebman.neo4jstudy.node.Line;
import com.thebman.neo4jstudy.node.Project;
import com.thebman.neo4jstudy.node.Employee;
import com.thebman.neo4jstudy.service.LineService;
import com.thebman.neo4jstudy.service.ProjectService;
import com.thebman.neo4jstudy.service.PersonService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping(value = &quot;/api/company&quot;)
public class CompanyController {
    @Autowired
    private ProjectService projectService;

    @Autowired
    private PersonService personService;

    @Autowired
    private LineService lineService;


    @PostMapping(&quot;/line/projects&quot;)
    ResponseEntity saveProject(@RequestBody Project project) {
        return new ResponseEntity(projectService.saveProject(project), HttpStatus.CREATED);
    }

    @GetMapping(&quot;/line/projects&quot;)
    ResponseEntity getProjects() {
        return new ResponseEntity(projectService.getProjects(), HttpStatus.OK);
    }

    @DeleteMapping(&quot;/line/projects/{project_name}&quot;)
    ResponseEntity deleteProject(@PathVariable String project_name) {
        projectService.deleteProject(project_name);
        return new ResponseEntity(HttpStatus.OK);
    }

    @GetMapping(&quot;/line/projects/{project_name}/employee&quot;)
    ResponseEntity getEmployee(@PathVariable String project_name) {

        return new ResponseEntity(projectService.getEmployee(project_name), HttpStatus.CREATED);
    }

    @PostMapping(&quot;/line/projects/{project_name}/employee&quot;)
    ResponseEntity saveEmployee(@RequestBody Employee employee) {

        return new ResponseEntity(personService.savePerson(employee), HttpStatus.CREATED);
    }

    @PostMapping(&quot;/line&quot;)
    ResponseEntity saveLine(@RequestBody Line line) {
        return new ResponseEntity( lineService.saveLine(line), HttpStatus.CREATED);
    }
}
```
",1616087506,https://stackoverflow.com/q/66695863,Burakhan Aksoy,"['neo4j', 'java', 'spring', 'spring-boot']"
66695380,Using Vertx with spring-data-neo4j outside Spring container,"We have DAO layer which uses Spring data to communicate with Neo4j. Inside DAO layer, it uses the spring annotations ```@Autowired```, ```@Repository``` etc. We have API Layer which is written in Vertx. DAO layer is used as a library inside the Vertx application. I am able to use ```@Inject``` to inject Models with help of Guice. However, the code block like ```personDo.findByName(&#39;test&#39;)``` fails because it is not able to connect to neo4j outside of spring env. Any suggestions or pointer on how to use spring data without spring application?

DAO layer
```
// PersonDao.java
@Repository
public interface PersonDao extends CustomerDaoCustom, BaseDao&lt;CustomerDo&gt; {
    Optional&lt;PersonDo&gt; findByName(String name);
}
```

Vertx Application:
```
import com.example.dao.PersonDao;
import com.example.models.PersonDo;
...

@Inject
private PersonDao personDao;
...

public void findPerson(ServiceRequest request, Handler&lt;AsyncResult&lt;ServiceResponse&gt;&gt; resultHandler) {
    String personName = &quot;Sam&quot;;
    logger.info(&quot;Example: finding person with name={}&quot;, personName);
    Optional&lt;PersonDO&gt; personOpt = personDao.findByName(personName);
    personOpt.ifPresentOrElse(person -&gt; {
      logger.info(&quot;\t Person found: {}&quot;, person);
      logger.info(&quot;\t Person UUID: {}&quot;, person.getUuid());
      logger.info(&quot;\t Details: {}&quot;, person.dump());
    }, () -&gt; logger.info(&quot;\t Person with name={} not found&quot;, personName));
```

```personDao``` is null instead of ```org.springframework.data.neo4j.repository.query.SimpleQueryByExampleExecutor@379ce046```

This can be achieved easily in API if I use the spring boot application to start my vertx service but I am trying not to use Spring boot in my API layer.
",1616085789,https://stackoverflow.com/q/66695380,Viral,"['spring-data', 'vert.x', 'spring-boot', 'neo4j']"
66691930,How can I inject a node object into a service class in spring mvc?,"I am relatively new to development and to spring framework.

What I want to do is to create a small project where I have a company that has lines, which has projects, which has employees. Also, I am using a Neo4J docker image to save all these objects.

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/aKLJk.png

This is my project structure.

These are my nodes, Employee, Line, Project, respectively.

```
package com.thebman.neo4jstudy.node;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.neo4j.ogm.annotation.GraphId;
import org.neo4j.ogm.annotation.NodeEntity;
import org.springframework.data.neo4j.core.schema.GeneratedValue;
import org.springframework.data.neo4j.core.schema.Id;
import org.springframework.data.neo4j.core.schema.Relationship;

@Data
@AllArgsConstructor
@NoArgsConstructor
@NodeEntity
public class Employee {
    @Id
    @GeneratedValue
    private Long Id;
    private String name;
    private int age;
}
```
```
package com.thebman.neo4jstudy.node;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.neo4j.ogm.annotation.NodeEntity;
import org.springframework.data.neo4j.core.schema.GeneratedValue;
import org.springframework.data.neo4j.core.schema.Id;
import org.springframework.data.neo4j.core.schema.Relationship;

import java.util.Set;

@Data
@AllArgsConstructor
@NoArgsConstructor
@NodeEntity
public class Line {

    private String name;

    @Id
    @GeneratedValue
    private long id;

    @Relationship(type = &quot;belongs_to&quot;, direction = Relationship.Direction.INCOMING)
    private Set&lt;Project&gt; projectSet;
}
```
```
package com.thebman.neo4jstudy.node;

import com.sun.istack.internal.NotNull;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.neo4j.ogm.annotation.NodeEntity;
import org.springframework.data.neo4j.core.schema.GeneratedValue;
import org.springframework.data.neo4j.core.schema.Id;
import org.springframework.data.neo4j.core.schema.Relationship;

import java.util.Set;

@Data
@AllArgsConstructor
@NoArgsConstructor
@NodeEntity
public class Project {
    @Id
    @GeneratedValue
    private Long entityId;
    private String name;
    private String location;

    @Relationship(type = &quot;works_for&quot;, direction = Relationship.Direction.INCOMING)
    private Set&lt;Employee&gt; employee;

}
```
This is my controller class:
```
package com.thebman.neo4jstudy.controller;

import com.thebman.neo4jstudy.node.Line;
import com.thebman.neo4jstudy.node.Project;
import com.thebman.neo4jstudy.node.Employee;
import com.thebman.neo4jstudy.service.LineService;
import com.thebman.neo4jstudy.service.ProjectService;
import com.thebman.neo4jstudy.service.PersonService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping(value = &quot;/api/company&quot;)
public class CompanyController {
    @Autowired
    private ProjectService projectService;

    @Autowired
    private PersonService personService;

    @Autowired
    private LineService lineService;


    @PostMapping(&quot;/line/projects&quot;)
    ResponseEntity saveProject(@RequestBody Project project) {
        return new ResponseEntity(projectService.saveProject(project), HttpStatus.CREATED);
    }

    @GetMapping(&quot;/line/projects&quot;)
    ResponseEntity getProjects() {
        return new ResponseEntity(projectService.getProjects(), HttpStatus.OK);
    }

    @DeleteMapping(&quot;/line/projects/{project_name}&quot;)
    ResponseEntity deleteProject(@PathVariable String project_name) {
        projectService.deleteProject(project_name);
        return new ResponseEntity(HttpStatus.OK);
    }

    @PostMapping(&quot;/line/projects/employee&quot;)
    ResponseEntity saveEmployee(@RequestBody Employee employee) {

        return new ResponseEntity(personService.savePerson(employee), HttpStatus.CREATED);
    }

    @PostMapping(&quot;/line&quot;)
    ResponseEntity saveLine(@RequestBody Line line) {
        return new ResponseEntity( lineService.saveLine(line), HttpStatus.CREATED);
    }
}
```

What I want to do is to add employee to {project} with POST request where the endpoint is &quot;/line/projects/{project_name}/employee&quot;. However, I really don&#39;t know how to do this. One idea of mine is to call a ProjectService instance and add the employee to that project with add method of a Set, but I cannot use 

```
@Autowired
    private Project project;

```
inside ProjectService class. When I do that I get error.

How can I achieve what I want to do?

Any help is appreciated.

best,",1616073547,https://stackoverflow.com/q/66691930,Burakhan Aksoy,"['spring', 'spring-boot', 'java', 'neo4j']"
66691412,Unexpected result with apoc.text.sorensenDiceSimilarity?,"A bit confused in regards to string similarity using Sorensen-Dice.
Apparently it makes a difference in what order parameters are being passed.

    WITH
    apoc.text.sorensenDiceSimilarity(&quot;+46xxxxx2260&quot;, &quot;+46xxxxx2226&quot;) as score1,
    apoc.text.sorensenDiceSimilarity(&quot;+46xxxxx2226&quot;, &quot;+46xxxxx2260&quot;) as score2
    RETURN
    score1, score2

One of these scores (i.e. similarity coefficients) will say 1.0, the other 0.909090...

Does not make sense to me, but perhaps there&#39;s something with the algorithm I&#39;m not aware of?
Any insight is appreciated.

P.S. &quot;Neo4j Kernel&quot;, &quot;3.5.9&quot;, &quot;community&quot;",1616071713,https://stackoverflow.com/q/66691412,niablo,"['neo4j', 'cypher']"
66691009,How to find Node with the most similarities Neo4j,"I have a list of garages and the cars that they provide:

   
        Store1: [Mazda, Ford, Porsche, VW, Nissan, Opel, Toyota, Seat, Volvo]
        Store2: [Porsche, Honda, Toyota, Audi]
        Store3: [Opel, Toyota, Volvo, Porsche, Kia, Mazda, Seat]
        Store4: [VW, Honda, Bentley, Alfa, Chevrolet, Subaru, Tesla]
        Store5: [Suzuki, VW, Nissan, Ferrari, Maserati, Jag]
        Store6: [Jag, Kia, Seat, Bentley, Alfa, Chevrolet, Ferrari, Mini]

I have to find the store which has the most similar options compared to Store 1. How would you structure a cypher to find similarities between nodes? 

",1616070128,https://stackoverflow.com/q/66691009,Yurty123,"['cypher', 'database', 'encryption', 'neo4j']"
66688693,Dockerized Neo4J fails with &quot;Unsupported uri scheme: http&quot;,"I am having a little bad time while dockerizing a Neo4J database.

------
**Synopsis**

I wrote a docker-compose to launch a [shiny app](http://ic-prod1.patnat.mnhn.fr:8083/gitlab/cartosib/shiny4cartosib/-/tree/dev) that uses {neo4r} and {visNetwork}. In local, I set up manually the Neo4J database with the dedicated GUI. I then can access it easily with my app which pings and connects to Neo4J through http, port 7474. Everything is fine at this point.

Things got harder when I tried to dockerize the whole installation. My goal is to be able to deploy my app on a server, where the Neo4J GUI won&#39;t be accessible.

I went into writing a docker-compose.yml file (attached) to 1/ set up the Neo4J DB and 2/ launch the shiny app. I get a valid access to the shiny app, but as soon as I ping the Neo4J DB (from the app or from my browser), the neo4j_sib container goes down, its state turning to &quot;Restarting&quot;. Logs are really non-informative, with a single error: &quot;Unsupported URI scheme: http&quot;.

The {neo4r} package is still maturing, but since it works in local, I do expect it to work in dockerized environment. Also, the R shiny part is running cool, so I am 99,99% sure the issue comes from a mistake on Neo4J container definition.

Do not hesitate to tell me if you need more details (or if I did an obvious mistake).

------
**Notes &amp; Edits**

- I must use http since {neo4r} requires it (and I did not have troubles doing so in local).

-------
**Attachments**

```
**(base) me@my-pc:~/path/to/shiny4cartosib$** docker-compose ps
             Name                            Command               State                 Ports               
-------------------------------------------------------------------------------------------------------------
neo4j_sib                         /sbin/tini -g -- /docker-e ...   Up      0.0.0.0:7473-&gt;7473/tcp,           
                                                                           0.0.0.0:7474-&gt;7474/tcp,           
                                                                           0.0.0.0:7687-&gt;7687/tcp            
shiny4cartosib_shiny4cartosib_1   /bin/sh -c R -e &quot;options(&#39; ...   Up      0.0.0.0:3838-&gt;3838/tcp   

/* Here I ping the Neo4J DB */

**(base) me@my-pc:~/path/to/shiny4cartosib$** docker-compose ps
             Name                            Command                 State              Ports         
------------------------------------------------------------------------------------------------------
neo4j_sib                         /sbin/tini -g -- /docker-e ...   Restarting                         
shiny4cartosib_shiny4cartosib_1   /bin/sh -c R -e &quot;options(&#39; ...   Up           0.0.0.0:3838-&gt;3838/tcp
**(base) me@my-pc:~/path/to/shiny4cartosib$** docker-compose logs
&lt;truncated&gt;
neo4j_sib         | Unsupported URI scheme: http
```

`docker-compose.yml` :
```
services:
  neo4j:
    image: neo4j:3.5.26
    restart: unless-stopped
    hostname: neo4j
    container_name: neo4j_sib
    ports:
      - 7474:7474 # HTTP -- only required by {neo4r}
      - 7473:7473 # HTTPS
      - 7687:7687 # bolt
    volumes:
      # import data
      - ./data-raw/import:/var/lib/neo4j/import
      # - ./logs:/logs
    environment: 
      # Install APOC library
      # - NEO4JLABS_PLUGINS=&#39;[\&quot;apoc\&quot;]&#39;
      - NEO4J_apoc_import_file_enabled=true
      - NEO4J_apoc_export_file_enabled=true
      - NEO4J_apoc_uuid_enabled=true
      - NEO4J_dbms_security_procedure_unrestricted=apoc.*,algo.*
      - NEO4J_dbms_default__listen__address=0.0.0.0
      # Raise memory limits
      - NEO4J_dbms_memory_pagecache_size=1G
      - NEO4J_dbms.memory.heap.initial_size=1G
      - NEO4J_dbms_memory_heap_max__size=1G
      # Authentication setup
      - NEO4J_AUTH=neo4j/test
      # Debug method
      - NEO4J_dbms_logs_debug_level=DEBUG
    command: bash -c &quot;
        cypher-shell -u neo4j -p test -a http://localhost:7474 &quot;CREATE DATABASE SIF IF NOT EXISTS&quot;
        cypher-shell -u neo4j -p test -a http://localhost:7474 &quot;START DATABASE SIF&quot;
        cypher-shell -u neo4j -p test -a http://localhost:7474 -f ./cypher/export-node-application-csv.cypher
        cypher-shell -u neo4j -p test -a http://localhost:7474 -f ./cypher/export-node-sif-csv.cypher   
        cypher-shell -u neo4j -p test -a http://localhost:7474 -f ./cypher/referentiel-cd.cypher
        cypher-shell -u neo4j -p test -a http://localhost:7474 -f ./cypher/export-node-donnees-csv.cypher
        cypher-shell -u neo4j -p test -a http://localhost:7474 -f ./cypher/export-node-s-im-csv.cypher
        cypher-shell -u neo4j -p test -a http://localhost:7474 -f ./cypher/export-node-organisme-csv.cypher
        cypher-shell -u neo4j -p test -a http://localhost:7474 -f ./cypher/export-relations-csv.cypher
      &quot;
  shiny4cartosib:
    build: .
    image: shiny4cartosib:local
    ports:
      - &quot;3838:3838&quot;
    depends_on:
      - &quot;neo4j&quot;

# volumes:
#   import:
```
",1616061429,https://stackoverflow.com/q/66688693,Elie Ker Arno,"['r', 'docker', 'docker-compose', 'neo4j']"
66688653,How to specify maximum cost when running BFS Neo4j?,"The [docs][1] of Neo4j data science library state: 

&gt; There are multiple termination conditions supported for the traversal,
&gt; based on either reaching one of several target nodes, reaching a
&gt; maximum depth, **exhausting a given budget of traversed relationship
&gt; cost**, or just traversing the whole graph.

But in the [algorithm specific parameters][2] I could not find any parameter for constraining the maximum cost of the traversal (or simply number of relationships if cost is 1). The Only parameters listed are `startNodeId, targetNodes and maxDepth`. 

Any Idea if this actually can be done or if the docs are incorrect? 


  [1]: https://neo4j.com/docs/graph-data-science/current/introduction/
  [2]: https://neo4j.com/docs/graph-data-science/current/algorithms/bfs/",1616061285,https://stackoverflow.com/q/66688653,adnanmuttaleb,"['data-science', 'breadth-first-search', 'neo4j']"
66684383,Database failed to create: Error: Could not change password - Neo4j Desktop 1.4.3,"I installed and used Neo4j 1.4.2 before, but when upgrading to 1.4.3, I can&#39;t create database. So, I uninstalled and installed again, it has same error. Error as below image.

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/yj7dF.png

This is my log file: https://drive.google.com/file/d/1UmzSgEuKWieDL8InLLwYFy8tGDOgHIBK/view?usp=sharing",1616038635,https://stackoverflow.com/q/66684383,Trần Tuấn Anh,"['neo4j-desktop', 'neo4j']"
66678086,neo4j connection keeps dropping,"I am newbie in neo4j. I am unable to figure out the issue.

So, I have a flask app that connects to neo4j db (using py2neo) like following

`neo4j_instance = Graph(uri, auth=(secrets[&#39;neo4j_username&#39;], secrets[&#39;neo4j_password&#39;]))`

however some calls to neo4j ends up being pretty long.. So, that was rendering my flask app unstable. 
So, I decided to put all these calls as async calls and added a timeout.. 
Like.. 

    graph.run(query)
    to 
    async_result = pool.apply_async(graph.run, (query,))
    async_result.get(timeout=1)



But now, I am observing connection to neo4j in weird state.

    2021-03-17T05:34:57.187821830Z Connection to ConnectionProfile(&#39;bolt://neo4j@host:port&#39;) broken
    2021-03-17T05:34:57.187893730Z Wire broken after 946.9s idle (4095 bytes sent, 1470 bytes received)

I don&#39;t see any &quot;errors&quot; just these warnings.. but whenever i see this, no data is being returned.. 
I have tried to &quot;refresh&quot; connection (by connecting to neo4j every 5 minutes but still doesn&#39;t resolves the issue)


Not sure if what I am seeing is the issue.. but why is neo4j not returning anything. How do I fix this?

",1616001472,https://stackoverflow.com/q/66678086,frazman,"['neo4j', 'py2neo']"
66678053,Unable to create a backup after enabling SSL for Neo4j Enterprise,"I&#39;m testing Neo4j Enterprise 4.2.3 on Windows 10. I want to configure [the ssl framework][1] for a single instance. Everything is ok but I&#39;m not able to do a backup.

My configuration for the ssl framework:

    # Bolt SSL configuration
    dbms.ssl.policy.bolt.enabled=true
    dbms.ssl.policy.bolt.base_directory=certificates/bolt
    dbms.ssl.policy.bolt.private_key=dev_certificate.key
    dbms.ssl.policy.bolt.public_certificate=dev_certificate.crt
    dbms.ssl.policy.bolt.client_auth=NONE
    
    # Https SSL configuration
    dbms.ssl.policy.https.enabled=true
    dbms.ssl.policy.https.base_directory=certificates/https
    dbms.ssl.policy.https.private_key=dev_certificate.key
    dbms.ssl.policy.https.public_certificate=dev_certificate.crt
    dbms.ssl.policy.https.client_auth=NONE
    
    # Backup SSL configuration
    dbms.ssl.policy.backup.enabled=true
    dbms.ssl.policy.backup.base_directory=certificates/backup
    dbms.ssl.policy.backup.private_key=dev_certificate.key
    dbms.ssl.policy.backup.public_certificate=dev_certificate.crt
    dbms.ssl.policy.backup.client_auth=NONE

For testing purpose I&#39;m using the same self-signed certificate everywhere. Bolt and https are working fine. When I&#39;m trying to do a backup from the same machine with the following command:

    neo4j-admin.bat backup --backup-dir=D:\temp\backups\test

it fails with this message:

&gt; Execution of backup failed. Base directory
&gt; &#39;D:\temp\backups\test\certificates\backup&#39; for SSL policy with name
&gt; &#39;backup&#39; does not exist.

For some reason neo4j is looking for the certificate in a directory created from the base path for my backup location (D:\temp\backups\test) and configured base directory (certificates/backup).

Is it a bug or I misconfigured something? Without ssl backup it is working fine.


  [1]: https://neo4j.com/docs/operations-manual/current/security/ssl-framework/",1616001390,https://stackoverflow.com/q/66678053,Damian,"['neo4j', 'backup', 'ssl']"
66677157,NEO4J - Optional query very slow,"I&#39;m new with Neo4J and i have the following query, how i can make it faster? It really takes a long time

```
MATCH (vintage:Vintage)-[:MADE_FROM]-&gt;(wine:Wine)
OPTIONAL MATCH (vintage)-[:DESIGNATED_BY]-&gt;(app:Appellation)
OPTIONAL MATCH (vintage)-[:RANKED]-&gt;(ranking:Ranking)
OPTIONAL MATCH (vintage)-[:HAS_NOTE]-&gt;(note:Note)&lt;-[:REVIEWS]-(reviewer:Reviewer)
WITH reviewer, note, app, wine, vintage ORDER BY vintage.code ASC, vintage.year DESC
RETURN { vintages: collect({ uid: vintage.uid, year: vintage.year,  
      cv: vintage.referencePrice})[10 * (1 - 1)..10 * 1], total: size(collect(vintage)) } as vintage

```

[Explain model][1]


  [1]: https://i.stack.imgur.com/CMaC2.png",1615998163,https://stackoverflow.com/q/66677157,Marcos Ojeda,"['optional', 'performance', 'match', 'graphql', 'neo4j']"
66675968,How to llst nodes by relating multiple other nodes,"I&#39;m new to Neo4J and apologise if the question was titled poorly, but I want to  a node(phone) to another node(colours) which is the colours available for the phone. I need to list the phones which are available in both blue and purple and not individually. The following is what is what I have tried but it shows no changes are made. Can you not use AND with WHERE to declare two nodes?

    MATCH (p:Phone)-[r:AVAILABLE]-&gt;(c:Colour)
    WHERE c.name=&quot;blue&quot; AND c.name=&quot;purple&quot;
    return p

",1615994135,https://stackoverflow.com/q/66675968,Yurty123,"['sql', 'cypher', 'neo4j']"
66675749,How does cypher ignore the space in CSV format?,"I need to make a graph of the CSV file information with the SourceIP, DestinationIP, Timestamp. But the issue is that there is a space before each of the SourceIP, DestinationIP and Timestamp(first line only). I wrote below query which works fine where there is no space. Can anyone help me with ignoring the space?

    LOAD CSV WITH HEADERS FROM &#39;file:/netflow1.csv&#39; AS row 
    WITH row WHERE row.SourceIP IS NOT NULL 
    MERGE(source:m {Name:row.SourceIP})
    MERGE(dest:n {Name:row.DestinationIP})
    MERGE(source)-[r:To{Timestamp:row.Timestamp}]-&gt;(Dest)
    WITH source,dest,row
    MATCH(n) RETURN n",1615993373,https://stackoverflow.com/q/66675749,Ilnaz Nikseresht,"['space', 'neo4j', 'cypher', 'csv']"
66674860,org.neo4j.driver.exceptions.ClientException: The server does not support any of the protocol versions supported by this driver,"I am having this error when I want to persist data on a neo4j server. What do you think might be the problem?

I am using docker to serve neo4j image at localhost:7474.[![enter image description here][1]][1]


[![enter image description here][2]][2]

my pom.xml is as follows
```
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
	xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;parent&gt;
		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
		&lt;version&gt;2.4.3&lt;/version&gt;
		&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
	&lt;/parent&gt;
	&lt;groupId&gt;com.thebman&lt;/groupId&gt;
	&lt;artifactId&gt;neo4jstudy&lt;/artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
	&lt;name&gt;neo4jstudy&lt;/name&gt;
	&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
	&lt;properties&gt;
		&lt;java.version&gt;1.8&lt;/java.version&gt;
	&lt;/properties&gt;
	&lt;dependencies&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-data-neo4j&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
		&lt;/dependency&gt;
		&lt;!-- https://mvnrepository.com/artifact/org.neo4j/neo4j-ogm-bolt-driver --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.neo4j&lt;/groupId&gt;
			&lt;artifactId&gt;neo4j-ogm-bolt-driver&lt;/artifactId&gt;
			&lt;version&gt;3.2.14&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
			&lt;scope&gt;test&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
			&lt;artifactId&gt;lombok&lt;/artifactId&gt;
			&lt;version&gt;1.18.16&lt;/version&gt;
			&lt;scope&gt;provided&lt;/scope&gt;
		&lt;/dependency&gt;

	&lt;/dependencies&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;

&lt;/project&gt;
```
my controller class as follows:

```
package com.thebman.neo4jstudy.controller;

import com.thebman.neo4jstudy.node.Company;
import com.thebman.neo4jstudy.service.CompanyService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping(value = &quot;/api/company&quot;)
public class CompanyController {
    @Autowired
    private CompanyService service;

    @PostMapping
    public Company saveCompany(@RequestBody Company company){
        return service.saveCompany(company);
    }

}
```
my Company node as follows
```
package com.thebman.neo4jstudy.node;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.data.neo4j.core.schema.GeneratedValue;
import org.springframework.data.neo4j.core.schema.Id;
import org.springframework.data.neo4j.core.schema.Relationship;

import java.util.Set;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class Company {
    @Id
    @GeneratedValue
    private Long entityId;
    private String name;
    private String location;

    @Relationship(type = &quot;works_for&quot;, direction = Relationship.Direction.INCOMING)
    private Set&lt;Person&gt; personSet;

}
```

my Person node as follows

```
package com.thebman.neo4jstudy.node;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.data.neo4j.core.schema.GeneratedValue;
import org.springframework.data.neo4j.core.schema.Id;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class Person {
    @Id
    @GeneratedValue
    private Long entityId;
    private String name;

}
```
I can successfully start spring boot app and the tomcat servlet serves at port 8080.

But when I do this on Postman, I receive the error on the title:
org.neo4j.driver.exceptions.ClientException: The server does not support any of the protocol versions supported by this driver

[![enter image description here][3]][3]

This is what I get after POST request in postman

```
org.neo4j.driver.exceptions.ClientException: The server does not support any of the protocol versions supported by this driver. Ensure that you are using driver and server versions that are compatible with one another.
	at org.neo4j.driver.internal.util.Futures.blockingGet(Futures.java:143) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
	at org.neo4j.driver.internal.InternalSession.beginTransaction(InternalSession.java:98) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
	at org.springframework.data.neo4j.core.transaction.Neo4jTransactionManager.doBegin(Neo4jTransactionManager.java:164) ~[spring-data-neo4j-6.0.5.jar:6.0.5]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:400) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:373) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:595) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:382) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.4.jar:5.3.4]
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.4.jar:5.3.4]
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97) ~[spring-aop-5.3.4.jar:5.3.4]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.4.jar:5.3.4]
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:215) ~[spring-aop-5.3.4.jar:5.3.4]
	at com.sun.proxy.$Proxy63.save(Unknown Source) ~[na:na]
	at com.thebman.neo4jstudy.service.CompanyService.saveCompany(CompanyService.java:16) ~[classes/:na]
	at com.thebman.neo4jstudy.controller.CompanyController.saveCompany(CompanyController.java:18) ~[classes/:na]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_275]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_275]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_275]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_275]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:197) ~[spring-web-5.3.4.jar:5.3.4]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:141) ~[spring-web-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:106) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:894) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:808) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1060) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:962) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:909) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:652) ~[tomcat-embed-core-9.0.43.jar:4.0.FR]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:733) ~[tomcat-embed-core-9.0.43.jar:4.0.FR]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:227) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53) ~[tomcat-embed-websocket-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-5.3.4.jar:5.3.4]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.3.4.jar:5.3.4]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-5.3.4.jar:5.3.4]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.3.4.jar:5.3.4]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-5.3.4.jar:5.3.4]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.3.4.jar:5.3.4]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:97) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:542) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:143) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:78) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:346) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:374) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:887) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1684) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [na:1.8.0_275]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [na:1.8.0_275]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at java.lang.Thread.run(Thread.java:748) [na:1.8.0_275]
	Suppressed: org.neo4j.driver.internal.util.ErrorUtil$InternalExceptionCause: null
		at org.neo4j.driver.internal.async.connection.HandshakeHandler.protocolNoSupportedByServerError(HandshakeHandler.java:164) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.async.connection.HandshakeHandler.handleUnknownSuggestedProtocolVersion(HandshakeHandler.java:145) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.async.connection.HandshakeHandler.decode(HandshakeHandler.java:118) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:501) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ReplayingDecoder.callDecode(ReplayingDecoder.java:366) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:286) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
		... 1 common frames omitted

2021-03-17 17:14:36.292 ERROR 4353 --- [nio-8080-exec-4] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.springframework.transaction.TransactionSystemException: Could not open a new Neo4j session: The server does not support any of the protocol versions supported by this driver. Ensure that you are using driver and server versions that are compatible with one another.; nested exception is org.neo4j.driver.exceptions.ClientException: The server does not support any of the protocol versions supported by this driver. Ensure that you are using driver and server versions that are compatible with one another.] with root cause

org.neo4j.driver.exceptions.ClientException: The server does not support any of the protocol versions supported by this driver. Ensure that you are using driver and server versions that are compatible with one another.
	at org.neo4j.driver.internal.util.Futures.blockingGet(Futures.java:143) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
	at org.neo4j.driver.internal.InternalSession.beginTransaction(InternalSession.java:98) ~[neo4j-java-driver-4.1.1.jar:4.1.1-eac256ab0fe1a26e16b8c683fb90af7d3e0c471c]
	at org.springframework.data.neo4j.core.transaction.Neo4jTransactionManager.doBegin(Neo4jTransactionManager.java:164) ~[spring-data-neo4j-6.0.5.jar:6.0.5]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:400) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:373) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:595) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:382) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.4.jar:5.3.4]
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137) ~[spring-tx-5.3.4.jar:5.3.4]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.4.jar:5.3.4]
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97) ~[spring-aop-5.3.4.jar:5.3.4]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) ~[spring-aop-5.3.4.jar:5.3.4]
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:215) ~[spring-aop-5.3.4.jar:5.3.4]
	at com.sun.proxy.$Proxy63.save(Unknown Source) ~[na:na]
	at com.thebman.neo4jstudy.service.CompanyService.saveCompany(CompanyService.java:16) ~[classes/:na]
	at com.thebman.neo4jstudy.controller.CompanyController.saveCompany(CompanyController.java:18) ~[classes/:na]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_275]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_275]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_275]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_275]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:197) ~[spring-web-5.3.4.jar:5.3.4]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:141) ~[spring-web-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:106) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:894) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:808) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1060) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:962) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:909) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:652) ~[tomcat-embed-core-9.0.43.jar:4.0.FR]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883) ~[spring-webmvc-5.3.4.jar:5.3.4]
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:733) ~[tomcat-embed-core-9.0.43.jar:4.0.FR]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:227) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53) ~[tomcat-embed-websocket-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-5.3.4.jar:5.3.4]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.3.4.jar:5.3.4]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-5.3.4.jar:5.3.4]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.3.4.jar:5.3.4]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-5.3.4.jar:5.3.4]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.3.4.jar:5.3.4]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202) ~[tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:97) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:542) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:143) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:78) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:346) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:374) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:887) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1684) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) [tomcat-embed-core-9.0.43.jar:9.0.43]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [na:1.8.0_275]
	at 


```
Any help is appreciated.. this problem is bugging me big time. 

Best


  [1]: https://i.stack.imgur.com/5zP3q.png
  [2]: https://i.stack.imgur.com/cSQuw.png
  [3]: https://i.stack.imgur.com/84nWw.png",1615990361,https://stackoverflow.com/q/66674860,Burakhan Aksoy,"['maven', 'spring-boot', 'spring', 'neo4j', 'java']"
66671985,Modeling a large multigraph database in neo4j,"I am trying to model a large multigraph with neo4j.

The graph has around 6M nodes and approx. 500M relations. The graph is relatively sparse, except for a few chunks, where it is very dense with a LOT of multiple edges (from 100 to even 1000 repeated edges). 

That many relations make it hard to query and visualize it effectively since the supernodes bunch up in a web of relations. I am thinking of refactoring the relations to nodes, but am not really sure how to do it.

**Option 1**: Extract aggregated values to nodes and operate on the (aggregated) relationship `(a)-[r:REL]-&gt;(b)` to `(a)-[:REL_AGG_PART1]-&gt;(:REL_AGG_NODE{f1:r.f1, ...})-[:REL_AGG_PART2]-&gt;(b)`
- Pros: Node properties can be indexed, which greatly speeds up the queries
- Cons: Visualization of aggregated relations incurs unnecessary connecting nodes, but this can easily be mitigated with apoc

**Option 2:** Extract all relations to intermediate nodes + Option 1 for aggregates
- Pros: Indices on individual relations (each relation has a timestamp and this enables efficient time-slicing which is a BIG plus) 
- Cons: 
  - This creates a lot of new nodes and makes visualization of such relations very difficult (but this can be augmented with some visualization library - I am planning to do this anyway)
  - I am not sure about the performance of queries since each relationship query will now need two hops `MATCH (n) -[:REL_PART1]-&gt;(:REL_NODE)-[:REL_PART2]-&gt;(m)` 

**Option 3:** Extract multiple relations to aggregation relation
- Pros: Simple to work and visualize
- Cons: No indexing and really fat relations

Is it also worth refactoring aggregated data from nodes to auxiliary nodes, such that nodes carry data that is frequently used in queries, but more complex data is saved in `:FULL_DATA_NODE`? 

E.g. refactor 
`(a)-[r:REL]-&gt;(b)` to `(a)-[:REL_AGG_PART1]-&gt;(n:REL_AGG_NODE{minimal_fieldset})-[:REL_AGG_PART2]-&gt;(b)` and `(n)-[:FULL_DATA]-&gt;(m:FULL_DATA_NODE{full aggregated data})`



",1615979785,https://stackoverflow.com/q/66671985,jOOsko,"['cypher', 'neo4j', 'graph-theory']"
66664999,Cannot merge the following node because of null property value for &#39;src&#39;: (:Node {src: null}),"I am fairly new to neo4j and I want to write a query which reads .json format and create a graph of the nodes. Below is my query which is successful in a file where there is no null property and unsuccessful when I have null property in my json file.

```
CALL apoc.load.json(&quot;file:/graph-phase1-labelled.json&quot;) YIELD value  

UNWIND value.nodes as nodes

UNWIND nodes.properties as prop

MERGE(n1:Node{src:prop.sourceIP})
 
MERGE(n2:Node{dst:prop.destIP})  

WITH n1,n2,prop

MERGE (n1)-[:CONNECTED_TO]-&gt;(n2)

RETURN n1,n2,prop
```

Anyone has any idea of what might solve the issue?",1615937825,https://stackoverflow.com/q/66664999,Ilnaz Nikseresht,"['null', 'json', 'neo4j']"
66656408,Cypher creating n number of nodes,"I&#39;m wanting to create an n number of nodes, say 100, the name should start at 1 and end at 100.
Essentially looping as in below.

    CREATE (n:GridCell{name: 1})
    CREATE (n:GridCell{name: 2})
    CREATE (n:GridCell{name: 3})
    CREATE (n:GridCell{name: ...})

How do I do this in cypher?",1615902144,https://stackoverflow.com/q/66656408,Spatial Digger,"['neo4j', 'cypher']"
66654096,What is the syntax of parameters in cypher query in prepared statement with neo4j jdbc driver and neo4j 4?,"I understand that neo4j 4.x now does not support parameters with such syntax - {1} and now supports $param. Has the syntax to execute preparedStatement also changed. What I mean by this is - when I try to execute query such as with new jdbc driver 4.0.1 and neo4j 4.2.3:

      String query = &quot;MATCH (u:User)-[:FRIEND]-(f:User) WHERE u.name = {1} RETURN f.name, f.age&quot;;
        try (PreparedStatement stmt = con.prepareStatement(query)) {
            stmt.setString(1,&quot;John&quot;);
    
            try (ResultSet rs = stmt.executeQuery()) {
                while (rs.next()) {
                    System.out.println(&quot;Friend: &quot;+rs.getString(&quot;f.name&quot;)+&quot; is &quot;+rs.getInt(&quot;f.age&quot;));
                }
            }
        }

I get this error - **ParameterIndex does not correspond to a parameter marker in the SQL statement**

Hence is the syntax of {1} in prepared statement query with newer version of neo4j 4.2.3 and jdbc driver 4.0.1 still valid or are there any changes needed? If otherwise then could you also suggest what could be the error here.
Thanks in advance !",1615893250,https://stackoverflow.com/q/66654096,Pratik M,"['neo4j', 'jdbc', 'cypher']"
66651400,Neo4J on AWS t2.micro,"I&#39;m learning neo4j and I&#39;m planning to install it on an Amazon t2.micro.

However, in the aws marketplace, instances only start from t2.medium.
https://aws.amazon.com/marketplace/pp/Neo4j-Neo4j-Graph-Database-Community-Edition/B071P26C9D

How can I run neo4J on a t2.micro or are there other alternatives that also have a free tier?

Thanks in advance.",1615882924,https://stackoverflow.com/q/66651400,Karel Debedts,"['amazon-web-services', 'amazon-ec2', 'neo4j']"
66647996,Export CSV from Neo4j to AWS S3 failed,"I&#39;m trying to Export data from cypher query to S3 with APOC Export

```
CALL apoc.export.csv.query(&quot;MATCH (a:Person) RETURN  a.name as name&quot;,
&quot;s3://s3.sa-east-1.amazonaws.com/testeneo4j/exports/neo4j_test.csv?accessKey=&lt;accessKey&gt;&amp;secretKey=&lt;secretKey&gt;&quot;, {})
```
 I did the plugins downloads: 

 - aws-java-sdk-core-1.11.250.jar (https://mvnrepository.com/artifact/com.amazonaws/aws-java-sdk-core/1.11.250)
 - aws-java-sdk-s3-1.11.250.jar (https://mvnrepository.com/artifact/com.amazonaws/aws-java-sdk-s3/1.11.250)
 - httpclient-4.4.8.jar (https://mvnrepository.com/artifact/org.apache.httpcomponents/httpclient/4.5.4)
 - httpcore-4.5.4.jar (https://mvnrepository.com/artifact/org.apache.httpcomponents/httpcore/4.4.8)
 - joda-time-2.9.9.jar (https://mvnrepository.com/artifact/joda-time/joda-time/2.9.9)

And I set the apoc.export.file.enabled=true.

After that I&#39;ve got the next error:

```
Failed to invoke procedure apoc.export.csv.query: Caused by: java.lang.ClassNotFoundException: com.google.common.util.concurrent.ThreadFactoryBuilder
```
[Error Print][1]


  [1]: https://i.stack.imgur.com/IW62U.png

I couldn&#39;t find any details on this error, please help.

Thanks.",1615859104,https://stackoverflow.com/q/66647996,jharoldo,"['neo4j', 'csv', 'neo4j-apoc', 'amazon-s3', 'cypher']"
66647249,Refactor cypher query for batchquery using apoc,"I am in the process of refactoring this cypher query
```
    MERGE(n:Entity:{type_} {{ent_id: &quot;ABC123&quot;}})
    ON CREATE SET n.literal_forms = [&quot;new label&quot;]
    ON MATCH SET n.literal_forms = apoc.coll.toSet(n.literal_forms + &quot;new label&quot;)
```

to take a list of MAP structures (to be used with UNWIND) to be more performant for batch querying.

My idea to address first struggle was to call `apoc.coll.toSet` (since I need to reference the matched node, if any) within my query and for this I am trying to use `apoc.do.case` to handle the logic implemented in `ON MATCH` above. 

So far I have something like 
```
    UNWIND $attribs as row
    CALL apoc.merge.node.eager([&quot;Entity&quot;, row.type_], {ent_id: row.ent_match_crit}, {literal_forms: [row.literal_form]}, {}) yield node as n1
    with n1, row
    CALL apoc.do.case([
        size(n1.literal_forms) &gt;= 1,
        &quot;MATCH (n1) SET n1.literal_forms = apoc.coll.toSet(n1.literal_forms + row.literal_form)&quot;
    ]) yield value
    RETURN value.node as node
```

where `$attribs` would be something like: 
```
[{&quot;type_&quot;: &quot;Gene&quot;, &quot;ent_match_crit&quot;: &quot;CHEMBL2108755&quot;, &quot;literal_form&quot;: &quot;penicillinase&quot;}, {&quot;type_&quot;: &quot;Gene&quot;, &quot;ent_match_crit&quot;: &quot;GO0008800&quot;, &quot;literal_form&quot;: &quot;beta-lactamase&quot;}]
```

but this query does not write to my database (on `merge.node` nor within the `case.do`. When I plug in sample values this query appears to work in neo4j browser but not when I execute within my code using a list of map structures. Can someone please help me? 

Also, does anyone see a better way to do what it is that I am trying to do?

BTW the reason I need to use `apoc.merge.node` is because I need to dynamically create/match nodes label types.

Thanks in advance.

",1615852083,https://stackoverflow.com/q/66647249,Mason Edmison,"['neo4j', 'cypher', 'neo4j-apoc']"
66647222,Cypher query for the .json format with Null proper,"I am fairly new to neo4j and I want to write a query which reads .json format and create a graph of the nodes. Below is my query which is successful in a file where there is no null property and unsuccessful when I have null property in my json file. 

Code:

    CALL apoc.load.json(&quot;file:/graph-phase1-labelled.json&quot;) YIELD value  
    
    UNWIND value.nodes as nodes
    
    UNWIND nodes.properties as prop
    
    MERGE(n1:Node{src:prop.sourceIP})
     
    MERGE(n2:Node{dst:prop.destIP})  
    
    WITH n1,n2,prop
    
    MERGE (n1)-[:CONNECTED_TO]-&gt;(n2)
    
    RETURN n1,n2,prop


Error:

    Cannot merge the following node because of null property value for &#39;src&#39;: (:Node {src: null})

Anyone has any idea of what might solve the issue?
",1615851952,https://stackoverflow.com/q/66647222,Ilnaz Nikseresht,"['neo4j', 'cypher']"
66644211,neo4j CYPHER non-symmetric query response,"I am using neo4j cypher in order to pass some queries into my (pretty large) database of related entities.

In particular, I need to find all the nodes of type `annotation` or `physical_entity` that are connected by a single relationship to a node of type `annotation`. 

My understanding is that a query for undirected connection such as below, would return in `N` all the nodes of type `annotation` and `physical_entity` that are connected to another node of type `annotation`.

```
MATCH (N)-[r]-(M)
WHERE ((N.parse_type=&#39;physical_entity&#39; OR N.parse_type=&#39;annotation&#39;)
AND M.parse_type=&#39;annotation&#39;)
RETURN COUNT(DISTINCT(N))

&gt; 63311
```
Whereas if I ask for `M`, it will only return only nodes of type `annotation` that are linked to other nodes of type `annotation`, which would be a subset of nodes from the previous query (ie results of the previous query minus the nodes that are `physical_entity`).


```
MATCH (N)-[r]-(M)
WHERE ((N.parse_type=&#39;physical_entity&#39; OR N.parse_type=&#39;annotation&#39;)
AND M.parse_type=&#39;annotation&#39;)
RETURN COUNT(DISTINCT(M))

&gt; 47355
```

However, this is not the case. There are some nodes of type `annotation` in the second query that are not in the first query:

```
MATCH (N)-[r]-(M)
WHERE ((N.parse_type=&#39;physical_entity&#39; OR N.parse_type=&#39;annotation&#39;)
AND M.parse_type=&#39;annotation&#39;)
WITH [N, M] as tl
UNWIND tl as n
RETURN COUNT(DISTINCT(n))

&gt; 633554
```

Why?",1615835397,https://stackoverflow.com/q/66644211,chiffa,"['cypher', 'neo4j']"
66642374,How to check the existence of a virtual node in Neo4j,"In Neo4j I can use APOC procedure &quot;apoc.create.vNode&quot; to create virtual nodes. How can I check if a virtual node exists already?
I have a list which contains the information about the dependencies between nodes, for example [[node1, [node2, node3, node4]], [node2, [node 5, node6]] ...], which means node1 is dependent on node2, node3 and node4; node2 is dependent on node5 and node6.
From this list I want to create a virtual graph. The problems is when I UNWIND the list, it will create virtual nodes with same names multiple times. See my cypher codes below.
I did not find the way to check if a virtual node has been created or not.

```
.....
UNWIND outputList AS dependency

WITH head(dependency) AS Data_Node, head(tail(dependency)) AS Dependent_Data_Nodes

CALL apoc.do.when(apoc.create.vNode([&quot;DataNode&quot;],{name:Data_Node})={},

    &#39;CALL apoc.cr eate.vNode([&quot;DataNode&quot;],{name:Data_Node}) yield node AS a&#39;,

    &#39;RETURN apoc.create.vNode([&quot;DataNode&quot;],{name:Data_Node}) AS a&#39;,

    {Data_Node:Data_Node}

    )

yield value

WITH value.a AS targetNode,  Dependent_Data_Nodes

UNWIND Dependent_Data_Nodes AS Dependent_Data_Node

CALL apoc.do.when(apoc.create.vNode([&quot;DataNode&quot;],{name:Dependent_Data_Node})={},

    &#39;CALL apoc.create.vNode([&quot;DataNode&quot;],{name:Dependent_Data_Node}) yield node AS b&#39;,

    &#39;RETURN apoc.create.vNode([&quot;DataNode&quot;],{name:Dependent_Data_Node}) AS b&#39;,

    {Dependent_Data_Node:Dependent_Data_Node}

    )

yield value

WITH value.b AS startNode, targetNode

CALL apoc.create.vRelationship(startNode,&quot;TRANSFORM_TO&quot;,{},targetNode) yield rel

RETURN *```",1615827710,https://stackoverflow.com/q/66642374,Ryan,"['neo4j-apoc', 'neo4j']"
66641805,Neo4j Cypher: How to optimize a NOT EXISTS Query when cardinality is high,"The below query takes over 1 second &amp; consumer about 7 MB when cardinality b/w users to posts is about 8000 (one user views about 8000 posts). It is difficult to scale this due to high &amp; linearly growing latencies &amp; memory consumption. Is there a possibility to model this differently and/or optimise the query?

**Query**

`PROFILE MATCH (u:User)-[:CREATED]-&gt;(p:Post) WHERE NOT (:User{ID: 2})-[:VIEWED]-&gt;(p) RETURN p.ID`

**Plan**

```+-----------------------------------------------------------------------------------------------------------+
| Plan      | Statement   | Version      | Planner | Runtime       | Time | DbHits  | Rows | Memory (Bytes) |
+-----------------------------------------------------------------------------------------------------------+
| &quot;PROFILE&quot; | &quot;READ_ONLY&quot; | &quot;CYPHER 4.1&quot; | &quot;COST&quot;  | &quot;INTERPRETED&quot; | 1033 | 3721750 | 10   | 6696240        |
+-----------------------------------------------------------------------------------------------------------+


+------------------------------+-----------------------------------------------+----------------+------+---------+-----------+----------------+----------------+
| Operator                     | Details                                       | Estimated Rows | Rows | DB Hits | Cache H/M | Memory (Bytes) | Ordered by     |
+------------------------------+-----------------------------------------------+----------------+------+---------+-----------+----------------+----------------+
| +ProduceResults@neo4j        | `p.ID`                                        |           2158 |   10 |       0 |       0/0 |                |                |
| |                            +-----------------------------------------------+----------------+------+---------+-----------+----------------+----------------+
| +Projection@neo4j            | p.ID AS `p.ID`                                |           2158 |   10 |      10 |       0/0 |                |                |
| |                            +-----------------------------------------------+----------------+------+---------+-----------+----------------+----------------+
| +Filter@neo4j                | u:User                                        |           2158 |   10 |      10 |       0/0 |                |                |
| |                            +-----------------------------------------------+----------------+------+---------+-----------+----------------+----------------+
| +Expand(All)@neo4j           | (p)&lt;-[anon_15:CREATED]-(u)                    |           2158 |   10 |      20 |       0/0 |                |                |
| |                            +-----------------------------------------------+----------------+------+---------+-----------+----------------+----------------+
| +AntiSemiApply@neo4j         |                                               |           2158 |   10 |       0 |       0/0 |                |                |
| |\                           +-----------------------------------------------+----------------+------+---------+-----------+----------------+----------------+
| | +Expand(Into)@neo4j        | (anon_47)-[anon_61:VIEWED]-&gt;(p)               |            233 |    0 | 3695819 |       0/0 |        6696240 | anon_47.ID ASC |
| | |                          +-----------------------------------------------+----------------+------+---------+-----------+----------------+----------------+
| | +NodeUniqueIndexSeek@neo4j | UNIQUE anon_47:User(ID) WHERE ID = $autoint_0 |           8630 | 8630 |   17260 |       0/0 |                | anon_47.ID ASC |
| |                            +-----------------------------------------------+----------------+------+---------+-----------+----------------+----------------+
| +NodeByLabelScan@neo4j       | p:Post                                        |           8630 | 8630 |    8631 |       0/0 |                |                |
+------------------------------+-----------------------------------------------+----------------+------+---------+-----------+----------------+----------------+
",1615825413,https://stackoverflow.com/q/66641805,Vivek,"['cypher', 'neo4j']"
66638955,Neo4j: How to return a single path for each pair of nodes that have multiple relationships,"Assuming a graph like this:

*(Thanks to https://neo4j.com/blog/neo4j-2-0-ga-graphs-for-everyone/ )*

![](https://dist.neo4j.com/wp-content/uploads/2013/12/neo4jgraph.png)

*(Not shown but assume all countries, all artists, and all recording contracts are in the graph)*


What would the CYPHER be for:

- Starting with United Kingdom, return one path for each country where there is at least one recording contract
  - It doesn&#39;t matter *which* path is returned, just that it&#39;s a single path
  - *Should return `(United Kingdom)&lt;-[]-(Iron Maiden)-[]-&gt;(Epic)-[]-&gt;(United States)`, but not `(United Kingdom)&lt;-[]-(Hybrid Theory)-[]-&gt;(Mad Decent)-[]-&gt;(United States)` or `(United Kingdom)&lt;-[]-(Iron Maiden)-[]-&gt;(Columbia)-[]-&gt;(United States)`, for example*
- Return a single path for each of *any* two countries that are connected
  - Should return one path for `(United Kingdom)-[]-(United States)`, one for `(Japan)-[]-(Canada)`, etc. *Bonus points for `LIMIT 20` limiting it to either 20 paths or 20 country nodes*
  - Also does not matter *which* path is returned, just that it&#39;s a single path


Edit: I&#39;ve tried various combinations of `MATCH (c1:Country)-[]-(c2:Country)`, `MATCH p=((c1:Country)-[]-(c2:Country))`, `WITH`, and `UNWIND`. I&#39;ve also tried to use `FOREACH` to return only one path, but can&#39;t quite get the formula right.",1615814968,https://stackoverflow.com/q/66638955,joshfindit,"['shortest-path', 'cypher', 'graph', 'neo4j-apoc', 'neo4j']"
66636167,Unable to connect Neo4j Desktop in PowerBI Desktop with Neo4j connector,"I would like to connect Neo4j to PowerBI.

So I did the following steps following this link https://github.com/cskardon/Neo4jDataConnectorForPowerBi/releases/tag/1.0.0

1) Copy to your &lt;user&gt;/Documents/Power BI Desktop/Custom Connectors folder
(if you don&#39;t have that folder - create it!)
2) Allow Power BI to see the connector
3) Open Power BI
Go to File -&gt; Options and Settings -&gt; Options
Select &#39;Security&#39; from the left hand side bar
4) In the &#39;Data Extensions&#39; section, select:
(Not Recommended) Allow any extension to load without validation or warning
Say OK
5) Close and restart Power BI
Press Get Data and choose Neo4j

At the end I have this:

[![enter image description here][1]][1]

And I finish with the following error:

 

    Details: &quot;We found extra characters at the end of JSON input.&quot;

Neo4j is well running with the good database locally.


  [1]: https://i.stack.imgur.com/M3Kxa.jpg",1615803896,https://stackoverflow.com/q/66636167,jos97,"['powerbi', 'neo4j']"
66634564,How to connect to neo4j database from android app (with java code)?,"I am developing one android application in java and i am using neo4j as a database for this app. 

Lets, consider i will store the static cypher query in a string. Then after the user clicks on the button, i want to send this query(string) to neo4j server and then execute it on neo4j server and return the result. 

My question is that, Is it possible? If yes, how can i do this ? Is there any easy/proper way to do?

Any help will be highly appreciated.
",1615796735,https://stackoverflow.com/q/66634564,K R,"['connection', 'java', 'neo4j', 'database', 'android']"
66630739,Is there a way to store dynamic Cypher query into python variable?,"Is there a way to put my cypher query into a python variable? I am able to put the non-parameter of the cypher into a variable but getting the error [![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/mfRrp.png on trying to put the parameter part into a variable.

I am using pandas and py2neo to load a CSV into neo4j. df_data is my pandas dataframe with 2 columns and 3 rows.

    for index,row in df_data.iterrows():
            tx.evaluate(&#39;&#39;&#39;MERGE (x:PATIENT_ID {property:$PATIENT_ID})
                MERGE(y:GLB_ID {property:$GLB_ID})
                MERGE (x)-[r:R_TYPE]-&gt;(y) &#39;&#39;&#39;, parameters = {&#39;PATIENT_ID&#39;: int(row[&#39;PATIENT_ID&#39;]), &#39;GLB_ID&#39;: int(row[&#39;GLB_ID&#39;])})

My code runs without issues if I run the following code storing non-parameter part into cq:

    for index,row in df_data.iterrows():
            tx.evaluate(cq, parameters = {&#39;PATIENT_ID&#39;: int(row[&#39;PATIENT_ID&#39;]), &#39;GLB_ID&#39;: int(row[&#39;GLB_ID&#39;])})

I am looking for a way to store the parameter part into a python variable",1615765915,https://stackoverflow.com/q/66630739,RB17,"['pandas', 'neo4j', 'dataframe', 'py2neo', 'python-3.x']"
66626238,Can I load in nodes and relationships from a csv file using 1 cypher command?,"I have 2 csv files which I am trying to load into a Neo4j database using cypher: drivers.csv which holds every formula 1 driver and lap times.csv which stores every lap ever raced in F1. 

I have managed to load in all of the nodes, although the lap times file is very large so it took quite a long time! I then tried to add relationships after, but there is so many that needs to be added that I gave up on it waiting (it was taking multiple days and still had not loaded in fully). 

I’m pretty sure there is a way to load in the nodes and relationships at the same time, which would allow me to use periodic commit for the relationships which I cannot do right now. Essentially I just need to combine the 2 commands into one and after some attempts I can’t seem to work out how to do it?

~~~
// load in the lap_times.csv, changing the variable names - about half million nodes (takes 3-4 days)
PERIODIC COMMIT 25000
LOAD CSV WITH HEADERS from &#39;file:///lap_times.csv&#39;
AS row
MERGE (lt: lapTimes {raceId: row.raceId, driverId: row.driverId, lap: row.lap, position: row.position, time: row.time, milliseconds: row.milliseconds})
RETURN lt;
~~~

~~~
// add a relationship between laptimes, drivers and races - takes 3-4 days
MATCH (lt:lapTimes),(d:Driver),(r:race)
WHERE lt.raceId = r.raceId AND lt.driverId = d.driverId
MERGE (d)-[rel8:LAPPING_AT]-&gt;(lt)
MERGE (r)-[rel9:TIMED_LAP]-&gt;(lt)
RETURN type(rel8), type(rel9)
~~~


Thanks in advance for any help!",1615735498,https://stackoverflow.com/q/66626238,merryroversrule,"['cypher', 'neo4j', 'cypher-shell']"
66624633,How to display relation ship property on the arrow itself in Neo4J?,"I created my graph and its working as expected. My relationship table has property **Name**. When I merge my 2 tables (Entity 1 and Entity 2) and connect them Entity ID : 

    :auto USING PERIODIC COMMIT 500
    LOAD CSV WITH HEADERS FROM &#39;file:///Rel(12March2021).csv&#39; AS row
    WITH toFloat(row.Entity1_ID) AS Entity1Id, toFloat(row.Entity2_ID) AS Entity2Id, row.Name AS Name, row.Label AS Label
    MATCH (e1:Entity1 {Entity1Id: Entity1Id})
    MATCH (e2:Entity2 {Entity2Id: Entity2Id})
    MERGE (e2)-[rel:CONTAINS {Name: Name}]-&gt;(e1)
    RETURN count(rel);

Then to display the graph, I do the following

    MATCH (e2:Entity2)-[rel:CONTAINS]-&gt;(e1:Entity1)
    RETURN e1, rel, e2 LIMIT 200;

As seen in the image below all relations are labelled **&#39;Contains**&#39; with property **&#39;Name&#39;** I want the value of the propoerty &#39;Name&#39; to be displayed on the arrows instead of the word &#39;Contains&#39;. Any idea how can I do that ? , For example in the highlighted arrow below I want the word &#39;obtain&#39; to replace&#39;Contains&#39;, same goes for the other relationship arrows  (Note: I am using Neo4J Browser)

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/SA556.png",1615725570,https://stackoverflow.com/q/66624633,IS92,"['neo4j', 'graph', 'cypher']"
66624037,How to post data to search box in Neo4j graph platform,"I am using **Neo4j Rest API** to successfully create nodes &amp; relationships on the **Neo4j server**. But to execute a query, I need to manually type the query on the search box &amp; hit enter. Is there a way to **load this query**(saved on some file) **on the search box** using any tool, library, or trick? 
1. I tried **DOM manipulation** to make the query appear on the Search Box. It&#39;s appearing but not getting saved internally. And that&#39;s why when I hit enter nothing gets executed.
&lt;br&gt;
Eg - To enter a simple query on Neo4j platform:
```
match (n) return n
```
I tried inserting spans under the &quot;presentation&quot; span
```
&lt;span role=&quot;presentation&quot; style=&quot;padding-right: 0.1px;&quot;&gt;
  &lt;span class=&quot;cm-keyword&quot;&gt;match&lt;/span&gt; 
  &lt;span class=&quot;cm-operator&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;cm-variable&quot;&gt;n&lt;/span&gt;
  &lt;span class=&quot;cm-operator&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;cm-keyword&quot;&gt;return&lt;/span&gt;
  &lt;span class=&quot;cm-variable&quot;&gt;n&lt;/span&gt;
&lt;/span&gt;
```
2. I tried using **pyautoGUI** in python. It detects where&#39;s a text field is present on the page by training it with various similar photos. And then it can inserts the data into the text field. But this way, it takes a lot of time.

Is there any other way to post data on a search box?",1615721771,https://stackoverflow.com/q/66624037,LAKSHYA AGARWAL,"['neo4j', 'html', 'google-chrome-extension', 'python']"
66618584,I get inconsistent outcomes in Spring Data Neo4j when mapping both ends of a relationship and saving it,"I have a `User` node with `FRIEND_REQUEST` relationships mapped to a `sentFriendRequestList` list and to a `receivedFriendRequestList` list like below:

```kotlin
@Node
data class User(

    @Id
    @GeneratedValue(UUIDStringGenerator::class)
    var userId: String?,

    @Relationship(type = &quot;FRIEND_REQUEST&quot;, direction = Relationship.Direction.OUTGOING)
    var sentFriendRequestList: MutableList&lt;FriendRequest&gt; = mutableListOf(),

    @Relationship(type = &quot;FRIEND_REQUEST&quot;, direction = Relationship.Direction.INCOMING)
    var receivedFriendRequestList: MutableList&lt;FriendRequest&gt; = mutableListOf(),

    var email: String

)
```

The `FriendRequest` class:

```kotlin
@RelationshipProperties
data class FriendRequest(

    @Id
    @GeneratedValue
    var friendRequestId: Long?,

    /**
     * Represents the receiver in an OUTGOING relationship and the sender in an INCOMING relationship.
     */
    @TargetNode
    var friendRequestOtherNode: User

){
    constructor(friendRequestOtherNode: User) : this(null, friendRequestOtherNode)
}
```

When saving multiple friend requests, on some occasions all previously created relationships disappear from the given nodes and only the newly created relationship appears.

I save like this:

```kotlin
fun saveFriendRequest(sender: User, receiver: User) {
        val sentFriendRequest = FriendRequest(receiver)
        val receivedFriendRequest = FriendRequest(sender)
        sender.sentFriendRequestList.add(sentFriendRequest)
        receiver.receivedFriendRequestList.add(receivedFriendRequest)
        userRepository.save(sender)
        userRepository.save(receiver)
    }
```

I don&#39;t understand what the problem is, especially since sometimes it runs without failure.

I created a small test project which is available on my GitHub: [link][1]. It contains the data structure and a test class that can be run instantly. The tests show the same problem, after multiple runs it can either fail or be successful.


  [1]: https://github.com/S0m30n384/neo4j-friend-graph",1615669941,https://stackoverflow.com/q/66618584,S0m30n3,"['spring-data', 'spring-data-neo4j', 'neo4j', 'spring', 'kotlin']"
66616206,"Using the @CompositeProperty annotation for a Map&lt;String, Set &lt;String&gt;&gt; in a Spring Boot application using Kotlin and Neo4j","I have a question about using @CompositeProperty for a Map&lt;String, Set&lt; String &gt;&gt; in a Spring Boot application with Kotlin and Neo4j.
```
plugins {
    id(&quot;org.springframework.boot&quot;) version &quot;2.5.0-SNAPSHOT&quot;
    id(&quot;io.spring.dependency-management&quot;) version &quot;1.0.11.RELEASE&quot;
    kotlin(&quot;jvm&quot;) version &quot;1.4.30&quot;
    kotlin(&quot;plugin.spring&quot;) version &quot;1.4.30&quot;
}

dependencies {
    implementation(&quot;org.springframework.boot:spring-boot-starter-data-neo4j&quot;)
    implementation(&quot;org.springframework.boot:spring-boot-starter-webflux&quot;)
    implementation(&quot;com.fasterxml.jackson.module:jackson-module-kotlin&quot;)
    implementation(&quot;io.projectreactor.kotlin:reactor-kotlin-extensions&quot;)
    implementation(&quot;com.fasterxml.jackson.module:jackson-module-kotlin:2.12.+&quot;)
    developmentOnly(&quot;org.springframework.boot:spring-boot-devtools&quot;)
    testImplementation(&quot;org.springframework.boot:spring-boot-starter-test&quot;)
    testImplementation(&quot;io.projectreactor:reactor-test&quot;)
}
```
I want to have a Map in an entity, which contains a String as key and a Set of Strings as value (Map&lt;String, Set&lt; String &gt;&gt;). (It is the last attribute in the class)

```
@Node(&quot;Skill&quot;)
data class Skill(

  @Id
  @GeneratedValue
  @JsonIgnore
  val id: Long?,

  @Property(&quot;uuid&quot;)
  val uuid: UUID?,

  @CompositeProperty
  val description: Map&lt;String, Set&lt;String&gt;&gt;?,
```
router:
```
@SpringBootApplication
internal class SkillApplication {

    @Bean
    fun route(handler: SkillHandler) = router {
        GET(&quot;$SKILL_ROUTE/$ID_PATH_PATTERN&quot;, handler::findByUuid)
        GET(SKILL_ROUTE, handler::findAll)
        POST(SKILL_ROUTE, handler::create)
    }

    companion object {
        const val SKILL_ROUTE = &quot;/skill&quot;
        const val ID_PATH_VAR = &quot;id&quot;
        const val ID_PATH_PATTERN = &quot;{$ID_PATH_VAR:${ID_PATTERN}}&quot;
    }

}

fun main(args: Array&lt;String&gt;) {
    runApplication&lt;SkillApplication&gt;(*args)
}
```
handler:
```
@Component
internal class SkillHandler(val service: SkillService) {

  fun findAll(request: ServerRequest): Mono&lt;ServerResponse&gt; {
    return ok().body(service.findAll())
  }

fun create(request: ServerRequest): Mono&lt;ServerResponse&gt; {
    return request.bodyToMono&lt;Skill&gt;()
      .flatMap {
        service.create(it).flatMap { skill -&gt;
          ok().body(skill.toMono())
            .switchIfEmpty(badRequest().build())
        }
      }
  }
```
Service-Layer (Relationship &quot;Hierarchy&quot; is only a first test with relationships):
```
internal class SkillService(val repo: SkillRepository) {

  fun findAll() = repo.findAll()

fun create(skillRequest: Skill): Mono&lt;Skill&gt; {
    val skill2 = Skill(
      null,
      UUID.randomUUID(),
      mapOf(&quot;en&quot; to setOf(&quot;english description&quot;)),
      emptySet()
    )
    val hierarchy: Set&lt;Hierarchy&gt; = setOf(Hierarchy(null, UUID.randomUUID(), skill2))
    val saveSkill: Skill = skillRequest.copy(uuid = UUID.randomUUID(), hierarchy = hierarchy)
    return repo.save(saveSkill)
```
What I noticed when looking at the stored information on the database explorer is that the map is stored under properties, which should not be the case.
```
{
  &quot;identity&quot;: 12,
  &quot;labels&quot;: [
    &quot;Skill&quot;
  ],
  &quot;properties&quot;: {
&quot;description.en&quot;: [
      &quot;english description 2&quot;,
      &quot;english description 1&quot;
    ],
&quot;uuid&quot;: &quot;2e7924c1-6e53-4faa-be93-8081107279f5&quot;
  }
}
```
The record should actually look like this:
```
{
    &quot;uuid&quot;: &quot;eeaacee9-782a-42e9-b5a2-5bf2b837addc&quot;,
    &quot;description&quot;: {
        &quot;en&quot;: [
            &quot;english description 2&quot;,
            &quot;english description 1&quot;
        ]
```
However, when retrieving the data via the rest endpoint, I get the following error message.
```
&quot;status&quot;: 500,
    &quot;error&quot;: &quot;Internal Server Error&quot;,
    &quot;message&quot;: &quot;JSON encoding error: class org.neo4j.driver.internal.value.StringValue cannot be cast to class java.lang.String (org.neo4j.driver.internal.value.StringValue is in unnamed module of loader &#39;app&#39;; java.lang.String is in module java.base of loader &#39;bootstrap&#39;); nested exception is com.fasterxml.jackson.databind.JsonMappingException: class org.neo4j.driver.internal.value.StringValue cannot be cast to class java.lang.String (org.neo4j.driver.internal.value.StringValue is in unnamed module of loader &#39;app&#39;; java.lang.String is in module java.base of loader &#39;bootstrap&#39;) (through reference chain: java.util.ArrayList[0]-&gt;com.test.skill.entity.Skill[\&quot;description\&quot;]-&gt;java.util.HashMap[\&quot;en\&quot;]-&gt;java.util.LinkedHashSet[0])&quot;,
```
My guess is that I need the Neo4jPersistentPropertyToMapConverter interface for this. Am I right with this assumption, and how would an implementation look concretely?

Thank you very much.",1615654847,https://stackoverflow.com/q/66616206,Sebastian,"['neo4j', 'spring-boot', 'spring-data-neo4j', 'kotlin', 'spring']"
66614545,connect SuiteCRM to Neo4j?,"I want to connect the SuiteCRM to the  Neo4j, and when I search the developer documents, there is no introduction about how to configure the development? I would like to ask how to realize the connection between the Neo4j and SuiteCRM? many thanks~",1615645146,https://stackoverflow.com/q/66614545,Caroline,"['neo4j', 'suitecrm']"
66604442,Having errors writing a Cypher query that gets the destination of a bus,"I am trying to write a Cypher query that handles the following:

    MATCH (a:station{name:&quot;modakeke&quot;})&lt;-[:ORIGIN]-(b:bus)
    RETURN b

The above query lists all the buses that originated from the station called modakeke.

I am trying to write a Cypher query that provides a list of all the stations, all buses that originated from modakeke stopped(Destination)

The relationships I access to  include 

    [:ORIGIN]  (which means the bus originated from)
    [:DESTINATION]  (where the bus ended its journey

this is what I did so far:

    MATCH (a:station{name:&quot;modakeke&quot;})&lt;-[:ORIGIN]-(b:bus)-&gt;[:DESTINATION]-(a)
    RETURN a.name

I keep getting errors with the above query

`Bus A`

`Bus B`

`Station: Modakeke`

`Station : Ife`

`Station: Ibadan`

`[:Origin]`
`[:destination]`

`Bus A [:Origin] from Station: Modakeke`

`Bus A has [:Destination] I want to Know which Station Bus A is going`

",1615569825,https://stackoverflow.com/q/66604442,lee,"['cypher', 'neo4j']"
66597925,Im not create Neo4j with multiple port,"how to setup Neo4j on Ubuntu with different ports please any one explain me step by step .








Thanx In Advance 
",1615543810,https://stackoverflow.com/q/66597925,alok,['neo4j']
66597603,Neo4j how to get (DISTINCT) all nodes and relationships with at least one node in common?,"I have been experimenting with neo4j and cypher lately but I don&#39;t quite manage to get the following query correctly. I would like to return all employees that share at least one project with a given employee and the projects they worked on. It is perhaps simpler if described with an example:

[![employees and projects graph][1]][1]

The desired outcome for the graph above for the input being employee 1 is:

|      Employee     |     Project      |
|-------------------|------------------|
|          0        |         A        |
|          1        |         A        |
|          1        |         B        |
|          4        |         A        |

I tried the following query but it returns duplicated relationships:

    MATCH (a0:Employee {name:1})-[:WORKS]-&gt;(b0:Project) 
    MATCH (b0)&lt;-[:WORKS]-(a:Employee) 
    MATCH (a)-[:WORKS]-&gt;(b:Project) 
    RETURN a.name AS employee, b.name AS project 
    ORDER BY employee, project


|      Employee     |     Project      |
|-------------------|------------------|
|          0        |         A        |
|          1        |         A        |
|          1        |         A        |
|          1        |         B        |
|          1        |         B        |
|          4        |         A        |

Thank you in advance for your help.

Note: These queries can be used to create the graph above 

    CREATE (:Employee {name: 0}), 
           (:Employee {name: 1}), 
           (:Employee {name: 2}),  
           (:Employee {name: 3}), 
           (:Employee {name: 4}), 
           (:Project {name: &#39;A&#39;}), 
           (:Project {name: &#39;B&#39;}), 
           (:Project {name: &#39;C&#39;})
    MATCH (e:Employee), (p:Project) WHERE e.name=0 AND p.name=&#39;A&#39; CREATE (e)-[:WORKS]-&gt;(p)
    MATCH (e:Employee), (p:Project) WHERE e.name=1 AND p.name=&#39;A&#39; CREATE (e)-[:WORKS]-&gt;(p)
    MATCH (e:Employee), (p:Project) WHERE e.name=1 AND p.name=&#39;B&#39; CREATE (e)-[:WORKS]-&gt;(p)
    MATCH (e:Employee), (p:Project) WHERE e.name=4 AND p.name=&#39;A&#39; CREATE (e)-[:WORKS]-&gt;(p)
    MATCH (e:Employee), (p:Project) WHERE e.name=3 AND p.name=&#39;C&#39; CREATE (e)-[:WORKS]-&gt;(p)


  [1]: https://i.stack.imgur.com/v7W9W.png",1615542490,https://stackoverflow.com/q/66597603,b3rt0,"['neo4j', 'cypher']"
66594767,Neo4j Java Driver - Cannot access records on this result,"I&#39;m using the neo4j java driver and trying to execute a Cyphers.I got an exception.I am searching for a long time on net. But no use. Please help or try to give some ideas how to achieve this. 

1.This is the driver that I added:
```
        &lt;dependency&gt;
            &lt;groupId&gt;org.neo4j.driver&lt;/groupId&gt;
            &lt;artifactId&gt;neo4j-java-driver-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;4.1.1.1&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.neo4j/neo4j-ogm-core --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
            &lt;artifactId&gt;neo4j-ogm-core&lt;/artifactId&gt;
            &lt;version&gt;3.2.20&lt;/version&gt;
        &lt;/dependency&gt;
```

2.The function:
```
     public Result readCyphers(String cypher) {

        Result result = null;

        Driver driver = null;
        Session session = null;

        try {
            //driver
            driver = GraphDatabase.driver(uri, AuthTokens.basic(username, password));
            //session
            session = driver.session();

            //run
            result = session.run(cypher);

        } catch (Exception e) {
            throw e;
        } finally {
            session.close();
            driver.close();
        }

        return result;
    }
```
3.call function
```
  @Test
    void readCyphersTest() {

        String cypher = &quot;MATCH(N:WechatDepartment) \n&quot; +
                &quot;WHERE N.departmentId = 117 \n&quot; +
                &quot;RETURN ID(N) as id, N.departmentId as departmentId, N.name as name, N.order as order, N.enable as enable&quot;;
        Result result = readCyphers(cypher);

        //There is an exception here
        System.out.println(&quot;result.list().size():&quot; + result.list().size());
    }
```
4.exception：
```
org.neo4j.driver.exceptions.ResultConsumedException: Cannot access records on this result any more as the result has already been consumed or the query runner where the result is created has already been closed.
```

Thanks in advance",1615527676,https://stackoverflow.com/q/66594767,nieyuan1980,"['java', 'driver', 'neo4j']"
66590468,using Mongodb and Neo4j for single application aka Polyglot Persistence,"I&#39;m working on mobile app witch is simular to &#39;craigslist&#39; and we using node.js and mongoDb.

Now we decide to add social network features (likes, comments, followers etc) and since nosql db not good for that, I&#39;m start looking to graphql db such as Neo4j. 

Question is how to combine then together with mongodb. As far as I can see the best way to handle that scenario is to use  Neo4j Doc Manager and automatically sync documents from MongoDB into Neo4j. Downside of that approach is that will create extra data. 

Maybe it is any other option to use graphql as separate db and use it only for social network feature and the rest handle thru mongodb? 

I appreciate any idea and suggestion regarding how to properly architect those things together. ",1615496347,https://stackoverflow.com/q/66590468,dimonD,"['mongodb', 'neo4j', 'multi-database']"
66586738,How to send CSV data from Neo4j query results through Node.js/AdonisJs,"Currently, I have some code that query from `Neo4j` database then write to a CSV file on server:
```javascript
const session = driver.session();
const query = &#39;&lt;my query&gt;&#39;;
var file = fs.createWriteStream(&#39;export.csv&#39;);
file.write(&#39;&lt;some CSV header here&#39;);
await new Promise((resolve, reject) =&gt; {
  session.run(query).subscribe({
    onNext: i =&gt; {
      file.write(&#39;&lt;data of record i&gt;&#39;);
    },
    onCompleted: () =&gt; {
      session.close()
      file.end()
      resolve()
    },
    onError: error =&gt; {
      console.log(error)
      reject()
    }
  })
})
return response.download(&#39;export.csv&#39;);
```
Everything is fine until now I have more data in the database so the process to write a CSV file takes a long time, then the client receives a timeout error.

I have found a couple of solutions that use `pipe()` to send stream directly to the client but I tried it and failed because the result of `session.run()` is an observable not stream. Is there any other way?

Note: I&#39;m using AdonisJs for backend",1615480802,https://stackoverflow.com/q/66586738,Tom Roman,"['neo4j', 'javascript', 'csv', 'node.js', 'adonis.js']"
66584946,How to design a graph without cycles? neo4j,"I&#39;m trying to build a graphs of people that appears in a series of books.
So person a appears in Book 1,2,3 then person b appears in Book 1,3,6.
Then I have to put an action that person a does to person b, like :person a hits person b in book 1

I know that I can put an attribute to the relationship referring to the book in what person a hits person b, but I wonder if there is a better solution..
Thanks!",1615474326,https://stackoverflow.com/q/66584946,Javier Szmajser,"['neo4j', 'graph']"
66573558,NEO4J - creating an unsorted CSS list from a graph in PHP,"I have a graph in Neo4J which helds a hierarchical structure to organize bits of information under a category. Here is an example

    ROOT -- A
           -- A1
           -- A2
            -- A21
            -- A22
               -- A221
         -- B
           -- B1
           -- B2
         -- C
         -- D

My first idea was to build a foreach construct that reads each level of the graph and returns the nodes of that level. This fails as I do not know how many levels I will have as the structure can grow deeper. 

So I need somehow a function that traverses the graph and brings back the nodes of each level and the sub-leaves, so that I can build the css list for the sorting. In the best case the points under a main category (here e.g. A1, A2, A3 etc) are sorted in alphabetical order.

So I pondered if I can do this with a statement like 
    
    MATCH p=(a:Category{uuid:&quot;1&quot;})-[r:ROOT_CATEGORY_OF*]-&gt;(b:Category) WHERE NOT((b)-[:ROOT_CATEGORY_OF]-&gt;()) RETURN b,r

But then I couldn&#39;t find an approach to use the results for PHP to build a kind of list like

              &lt;ul&gt;
              &lt;li&gt;A
                &lt;ul&gt;
                  &lt;li&gt;A1&lt;/li&gt;
                  &lt;li&gt;A2&lt;/li&gt;
                    &lt;ul&gt;
                      &lt;li&gt;A21&lt;/li&gt;
                      &lt;li&gt;A22&lt;/li&gt;
                    &lt;/ul&gt;
                    ... etc

I appreciate a hint how to get from a query statement of the graph into a list structure in PHP, thank you.

/m

",1615413902,https://stackoverflow.com/q/66573558,Balael,"['neo4j', 'php']"
66572223,API endpoint with py2neo and flask in Swagger,"I have recently started using Swagger, py2neo and flask libraries to an end to end project that I am learnign on my own. 

I intended to use `py2neo` as it is easier to create queries for neo4j with this driver than `neo4j` driver itself. 

I am trying to reproduce https://github.com/neo4j-examples/neo4j-movies-template and specifically `app.py` so that I could see it in `swagger ui`. 


Everything works fine for the `GET` 

However when I do `POST`, I cannot have the database updated. ([![see screenshot of swagger UI][1]][1])

How do I resolve the client-server POST? 


    class RateMovie(Resource):
        @swagger.doc({
            &#39;tags&#39;: [&#39;movies&#39;],
            &#39;summary&#39;: &#39;Rate a movie from&#39;,
            &#39;description&#39;: &#39;Rate a movie from 0-5 inclusive&#39;,
            &#39;parameters&#39;: [
                
                {
                    &#39;name&#39;: &#39;id&#39;,
                    &#39;description&#39;: &#39;movie tmdbId&#39;,
                    &#39;in&#39;: &#39;path&#39;,
                    &#39;type&#39;: &#39;string&#39;,
                },
                {
                    &#39;name&#39;: &#39;rating&#39;,
                    &#39;in&#39;: &#39;body&#39;,
                    &#39;schema&#39;: {
                        &#39;type&#39;: &#39;object&#39;,
                        &#39;properties&#39;: {
                            &#39;rating&#39;: {
                                &#39;type&#39;: &#39;integer&#39;,
                            },
                        }
                    }
                },
            ],
            &#39;responses&#39;: {
                &#39;200&#39;: {
                    &#39;description&#39;: &#39;movie rating saved&#39;
                },
                &#39;401&#39;: {
                    &#39;description&#39;: &#39;invalid / missing authentication&#39;
                }
            }
        })
    
    
        def post(self):
    
            parser = reqparse.RequestParser()
            parser.add_argument(&#39;rating&#39;, choices=list(range(0, 6)), type=int, required=True, help=&#39;A rating from 0 - 5 inclusive (integers)&#39;)
            args = parser.parse_args()
            rating = args[&#39;rating&#39;]
    
            def rate_movie(movie_id, rating):
                db=get_db()
                query=&#39;&#39;&#39;
                MERGE (m:Movie)
                WITH m
    
                MATCH (m:Movie) 
                where m.title=&#39;{}&#39;
                SET m.rating = {}
                RETURN m
                &#39;&#39;&#39;.format(movie_id, rating)
    
                result = db.run(query)
                return [i for i in result]
    
            return {}
    
    
    
    api.add_resource(RateMovie, &#39;/api/v0/ratemovie&#39;)

Then I execute &quot;TRY IT OUT&quot; in Swagger UI. 

I get following response 

    127.0.0.1 - - [10/Mar/2021 15:08:57] &quot;POST /api/v0/ratemovie HTTP/1.1&quot; 200 -

But when I run query, the database is still not updated. 

However, if I independelty run 


    def rate_movie(movie_id, rating):
        db=get_db()
        query=&#39;&#39;&#39;
        MERGE (m:Movie)
        WITH m
    
        MATCH (m:Movie) 
        where m.title=&#39;{}&#39;
        SET m.rating = {}
        RETURN m
        &#39;&#39;&#39;.format(movie_id, rating)
    
        result = db.run(query)
        return [i for i in result]
    
    
    
    
    print(rate_movie(movie_id=&#39;The Matrix Reloaded&#39;, rating=10))

The database gets updated. 

How do I resolve the client-server POST?


  [1]: https://i.stack.imgur.com/kYEMJ.png
",1615407319,https://stackoverflow.com/q/66572223,lpt,"['swagger', 'py2neo', 'flask', 'neo4j']"
66569273,Can we save data to relationship in neo4j with Spring?,"when using Cypher command, I can easily save data to relationship, but in Spring D, I don&#39;t know how to save and get data from relationship between two node.
This is my example:

Class User

    @NodeEntity
    public class User {
        private String username;
        private String saltedPassword;
        private String lastIp;
        private boolean enabled;
        private Profile profile;
    
        @Relationship(type = &quot;FOLLOWS&quot;)
        private Set&lt;User&gt; followings;
        @Relationship(type = &quot;FOLLOWED_BY&quot;)
        private Set&lt;User&gt; followers;
        @Relationship(type = &quot;HAS_POST&quot;)
        private Set&lt;Post&gt; posts;
        @Relationship(type = &quot;HAS_COMMENT&quot;)
        private Set&lt;Comment&gt; comments;
        @Relationship(type = &quot;HAS_VERITFICATION_TOKEN&quot;)
        private Set&lt;VerificationToken&gt; verificationTokens;
    }

Class VertificationToken

    @NodeEntity
    public class VerificationToken {
        @Id
        @GeneratedValue(UUIDStringGenerator.class)
        private String id;
        private String token;
        private long expiryDate;
    
        @Relationship(type = &quot;BELONG_USER&quot;)
        private User user;
    }
This relationship between two node is HAS_VERIFICATION_TOKEN. As it is now. I can only save a Set&lt;VertificationToken&gt; in User, but if I need add data to this relationship, I can&#39;t.

Could somebody help me? Thank you in advance.
",1615394915,https://stackoverflow.com/q/66569273,Trần Tuấn Anh,"['spring-data-neo4j', 'spring', 'spring-data-jpa', 'neo4j', 'spring-boot']"
66565759,Cypher select vertices whose any neighbours do not contain a property,"[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/FgXvX.png

```
{
    &quot;identity&quot;: 7,
    &quot;labels&quot;: [
        &quot;Parent&quot;
    ],
    &quot;properties&quot;: {
        &quot;name&quot;: &quot;foo1&quot;
    }
}, 
{
    &quot;identity&quot;: 8,
    &quot;labels&quot;: [
        &quot;Child&quot;
    ],
    &quot;properties&quot;: {
        &quot;name&quot;: &quot;bar2&quot;
    }
}, 
{
    &quot;identity&quot;: 9,
    &quot;labels&quot;: [
        &quot;Child&quot;
    ],
    &quot;properties&quot;: {
        &quot;name&quot;: &quot;bar1&quot;
    }
}, 
{
    &quot;identity&quot;: 10,
    &quot;labels&quot;: [
        &quot;Parent&quot;
    ],
    &quot;properties&quot;: {
        &quot;name&quot;: &quot;foo2&quot;
    }
}
```



I want to select the **Parents** which do not have any **child** with `name=&#39;abc&#39;`

Expected Behaviour : I should get both Parents (`foo1` and `foo2`) as result

Query1 : 
```
Match (x1:Parent) with x1 
optional Match (x1)-[:CHILD]-(x2:Child) with x1 , collect(x2) as x3 
UNWIND x3 as x2 
WITH x1 , x2 , x3 
where none (x IN  x3 where x.name IN [&#39;abc&#39;]) 
return DISTINCT x1 
```

This query is returning me only 1 Parent(`foo1`) but it should return both parents and 2nd parent(`foo2`) is not connected to any child.

PS : Reason for using `UNWIND` is to use the variables for further `WHERE` clauses on variable `x2`.


",1615383028,https://stackoverflow.com/q/66565759,Arun Singhal,"['cypher', 'neo4j']"
66564591,Removing relationship between two nodes in Spring Boot 2.4.3 Neo4j,"I&#39;m in the middle of upgrading from Spring Boot 2.3 to 2.4 and are having some issues with Neo4j after upgrade.

I&#39;m creating two nodes, and adding a relationship between them

```
@Node
class Document(
    @Id
    val id: String,
) {
    @Relationship(type = &quot;CONCERNS&quot;)
    var concerns: Concerns? = null
}

@RelationshipProperties
class Concerns(
    @TargetNode val user: User
) {
    @Id
    @GeneratedValue
    private var id: Long? = null
}

@Node
class User(
    @Id
    val id: String
) {
    var givenName: String? = null
    var familyName: String? = null
}
```

Creating the Nodes and adding the relationship works fine

[![enter image description here][1]][1]

  [1]: https://i.stack.imgur.com/EaBXB.png

But when I try to remove the relationship from the user, nothing happens:

```
val document = documentRepository.findById(id)
document.concerns = null
documentRepository.save(document)
```
",1615378451,https://stackoverflow.com/q/66564591,Aslak,"['neo4j', 'spring', 'spring-data-neo4j', 'spring-data']"
66561131,How to set Neo4j bootstrap on Linux system?,"I expect the Neo4j graph database to start after Linux starts

    &gt; [Unit]
    Description=neo4j
    After=network.target remote-fs.target nss-lookup.target
    
    [Service]
    Type=forking
    ExecStart=/home/***/***/neo4j-community-4.2.3/bin/neo4j start
    ExecReload=/home/***/***/neo4j-community-4.2.3/bin/neo4j restart
    ExecStop=/home/***/***/neo4j-community-4.2.3/bin/neo4j stop
    PrivateTmp=true
    
    [Install]
    WantedBy=multi-user.target

",1615365613,https://stackoverflow.com/q/66561131,qjbx,"['linux', 'neo4j']"
66557957,Facing an error while running neo4j: failed to execute &#39;postmessage&#39; on &#39;dedicatedworkerglobalscope&#39; data cannot be cloned out of memory,"I am using neo4j to query patterns and I get an error saying 

&gt; failed to execute &#39;postmessage&#39; on &#39;dedicatedworkerglobalscope&#39; data cannot be cloned out of memory

I don&#39;t understand if this is due to heap size or page cache getting exhausted? 

My current memory configurations are 
 
```
dbms.memory.heap.initial_size=64g
dbms.memory.heap.max_size=64g
dbms.memory.pagecache.size=128g

dbms.memory.transaction.global_max_size=256g
dbms.tx_state.memory_allocation= ON_HEAP
```

Please let me know how to resolve this. Thank you in advance.",1615347159,https://stackoverflow.com/q/66557957,Baskar Reddy,"['out-of-memory', 'memory', 'java', 'cypher', 'neo4j']"
66557294,Adding up a property in the relationship NEO4j,"I am trying to add up properties in the relationship along a path. This is my first week with NEO4j and I am now stuck. If anyone can advise. Thank you

```
match (dbn:City {name: &#39;Durban&#39;})
match (unb:City {name: &#39;Pinetown&#39;})
match path = shortestpath((dbn)-[dist:DISTANCE_TO*]-&gt;(unb))
return path, sum(dist.distance)
```

This path has a total of 4 nodes each with a different distance total of 19kms.

it gives an error of Type Mismatch expected Map but got list&lt;relationship&gt;

Here is the code I did to generate the Graph

```
		merge  (c:Country {name: $Country})	
			merge  (r:Region {name: $Region}) 	
			merge  (c1:City {name: $cityfrom})
			merge  (c2:City {name: $cityto})
			merge  (r)-[:IS_IN] -&gt; (c)
			merge  (c1)-[:DISTANCE_TO {distance:toInteger($distance)}] -&gt; (c2
			merge  (c2)-[:DISTANCE_TO {distance:toInteger($distance)}] -&gt; (c1)
			merge  (c1)-[:IS_IN] -&gt; (r)
			merge  (c2)-[:IS_IN] -&gt; (r)
```",1615341097,https://stackoverflow.com/q/66557294,Peter Latham Lewis,"['cypher', 'neo4j']"
66556695,Set constraint on relationship property for variable-path search in GraphDB,"I have a neo4j graph that is similar in structure to the example below:

```
MATCH (n:Person)-[k:KNOWS]-&gt;(f)
WHERE k.since &lt; 2000
RETURN f.name, f.age, f.email
```

which comes straight off the neo4j examples.

What I am looking to do is this:
**Start with one node by name (&quot;Jennifer&quot; in this case) and find all the nodes, regardless of path depth, that stem from the initial node but where the relationship KNOWS has a property since &lt; 2000**
So Jennifer might know Gary since before 2000 who also knows Bill since before 2000.  And Jennifer knows Michelle since before 2000 (*et cetera*)

This is where I am stuck:
```
MATCH p=(n:Person {name:&#39;Jennifer&#39;})-[:KNOWS*]-(f)
RETURN [k IN p WHERE k.since &lt; 2000]
```

If I run any query with :KNOWS*, it just hangs up forever, even for a relatively small database of 21 nodes and 840 relationships.

I figured I need to use WITH REDUCE() somehow but it isn&#39;t clicking...

Can anyone point me in the right direction here?
Much apperciated!",1615336211,https://stackoverflow.com/q/66556695,chaugen1,['neo4j']
66556297,Cannot construct date time from: NO_VALUE (Failure when processing file,"I am loading the data from a sample CSV into Employee. The CSV has 2 columns - birthdate and hiredate. The code is like this -

    load csv with headers from &#39;file:///northwind/employees2.csv&#39; as row
    merge(c:Country {country : row.country})
    merge(e:Employee {
    employeeId:toInteger(row.employeeID)
      ,firstName : row.firstName
      ,birthDate : date(datetime({epochmillis:apoc.date.parse(row.birthdate, &#39;ms&#39;, &#39;yyyy-MM-dd&#39;)}))
      ,hireDate : date(datetime({epochmillis:apoc.date.parse(row.hiredate, &#39;ms&#39;, &#39;yyyy-MM-dd&#39;)}))
     })
       create (e) - [:HAS_COUNTRY {countryName:c.country}] -&gt; (c);

Getting following error -

**Cannot construct date time from: NO_VALUE (Failure when processing file &#39;/C:/neo4j423/import/northwind/employees.csv&#39; on line 2.)**

I tried with just 1 row in the csv. birthdate and hiredate both are available.
If I try with a hardcoded value like &#39;2001-01-01&#39;, the code works just fine.

Any ideas what could be wrong?

Thanks

Manoj Joshi",1615332936,https://stackoverflow.com/q/66556297,Manoj Joshi,['neo4j']
66552564,App initialization error in neo4j desktop,"I installed neo4j desktop on my windows laptop. It works fine for a few days but the app does not launch after that. I tried reinstalling it a lot of times and the same thing happens - Works fine for a few days and then does not launch.

I see this error message in the neo4j logs everytime this error happens- 

```
App initialization error: SyntaxError: Malformed JSON in file: C:\Users\Indra_K\.Neo4jDesktop\persist\projects.json
Unexpected token &lt; in JSON at position 0 {
  constructor: &#39;SyntaxError&#39;,
  stack: &#39;SyntaxError: Malformed JSON in file: C:\\Users\\Indra_K\\.Neo4jDesktop\\persist\\projects.json\n&#39; +
    &#39;Unexpected token &lt; in JSON at position 0\n&#39; +
    &#39;    at FileAsync.parse [as deserialize] (&lt;anonymous&gt;)\n&#39; +
    &#39;    at C:\\Program Files\\Neo4j Desktop\\resources\\app.asar\\node_modules\\lowdb\\adapters\\FileAsync.js:41:35\n&#39; +
    &#39;    at async C:\\Program Files\\Neo4j Desktop\\resources\\app.asar\\dist\\main.prod.js:1:177229\n&#39; +
    &#39;    at async C:\\Program Files\\Neo4j Desktop\\resources\\app.asar\\dist\\main.prod.js:1:223470&#39;
```


Any help would be really appreciated. Thanks.",1615313769,https://stackoverflow.com/q/66552564,Indra K,"['neo4j-desktop', 'neo4j', 'windows']"
66548952,apoc functions not available with Nepo4j even after the plugin in installed,"For some reason, I cannot access apoc functions for Neo4j. I tried with Neo4j installer (4.2.1), and then with Neo4j Desktop (4.2.3, 4.2.1). Restated multiple times. No luck whatsoever. 

Example : 

     RETURN apoc.date.parse(&quot;2020-11-04&quot;, &quot;ms&quot;, &quot;yyyy-MM-dd&quot;) AS outputInMs; 

     Error : Unknown function &#39;apoc.date.parse&#39;;

Any advice what could I be doing wrong? Have spent 3 hrs trying this but no luck. 

Thanks

Manoj Joshi",1615300632,https://stackoverflow.com/q/66548952,Manoj Joshi,['neo4j']
66546819,Display only properties in Neo4j Tabular format,"The Query To create a label in neo4j along with properties is 

     Unwind $props as properties 
    Merge (s:label) on create set s=properties return s. 

On successful creation we get 


    Identity :
    Label :
    Properties :{
    the actual properties passed
    }

The desired output should have only properties and not the other values of identity, label 
",1615292655,https://stackoverflow.com/q/66546819,Surbhi,['neo4j']
66542103,Match floating point number with regular expression,"I am trying to find the floating point numbers in a given range with regular expression in neo4j. For example, return all numbers which are in range 0-5. So the result could be: 1, 1.1, 5.21, 4.45. I am using the regular expression `[0-5]*[.][0-5]*` but it is also returning the result greater than 5, which is not correct. I want to handle the regular expression in a way like it is matching with a string because my database is designed in such a way that a node contains strings, integers and floating point number, all are in form or string. So I want to match floating point values with the regular expression.",1615272754,https://stackoverflow.com/q/66542103,badar,"['regex', 'neo4j']"
66541743,Run multiple neo4j instances on ubuntu-18.4 machine with different ports,"I need to create 3 instances of neo4j on single ubuntu-18.4 machine  , with 3 different ports . I tried changing default_database setting in neo4j.conf file but of no use . Can i do it without using docker ? . Thanks in advance  ",1615270578,https://stackoverflow.com/q/66541743,karthikreddy 1080,"['neo4j', 'docker']"
66528960,Why isn&#39;t it possible to define a custom converter to be used in a class annotated with @RelationshipProperties in Spring Data Neo4j?,"I&#39;m using a property with a custom converter both in a `@Node` and in a `@RelationshipProperties` class. I defined the converter by implementing `GenericConverter` and registering it in the `Neo4jConversions` bean. The converter works only for the parameter in the `@Node` but not in the `@RelationshipProperties` class. There are no errors, the property that should be converted in the relationship is simply not saved. I tried to debug it but the code doesn&#39;t run into the converter for the relationship class.

The [Spring Data Neo4j Reference Documentation][1] says: &quot;If you prefer to work with your own types *in the entities or as parameters for @Query annotated methods*, you can define and provide a custom converter implementation.&quot;

It doesn&#39;t mention using the converters in a class annotated with `@RelationshipProperties`, so my question is why is it this way? Shouldn&#39;t it be possible?

I also tried using the `@ConvertWith` annotation in the relationship class with no success.


  [1]: https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#custom.conversions.attribute.types",1615202792,https://stackoverflow.com/q/66528960,S0m30n3,"['neo4j', 'java', 'spring', 'spring-data-neo4j']"
66528761,Contact Tracing Using Neo4j - Some people are not identified,"I am developing a contact tracing framework using Neo4j. There are 2 types of nodes, namely **Person** and **Location**. There exists a relationship **VISITED** between a Person and a Location, which has properties **startTS** and **endTS**. Example:

[![enter image description here][1]][1]

If **Person 1** is infected, I need to retrieve all other **Person Nodes** who have been in direct or indirect contact with him using the graph database. I loop through all the relationships leading to a person node and apply a formula to determine if the ***current person*** (Person 2) was present at a particular location at the same time as the ***previous person*** (Person 1). This process is repeated for all person nodes identified. In the above picture, person 2 was in contact with person 1 based on their startTS and endTS. Here is my code: 

```
MATCH path =(infected:Person {id:&#39;1&#39;})-[*]-(otherPerson:Person)
WITH RELATIONSHIPS(path) as rels,otherPerson
WHERE all(i in range(1,size(rels)-1)  WHERE (rels[i].endTS &gt;= rels[i-1].startTS AND rels[i].startTS&lt;= rels[i-1].endTS))
RETURN otherPerson
```

In the scenario below, person 1 infected person 2, and person 2 infected person 3. However, the code does not identify person 3 as infected, even though person 3 was clearly in contact with person 2. Any help will be greatly appreciated. Thanks.

[![enter image description here][2]][2]
 


  [1]: https://i.stack.imgur.com/Jr154.png
  [2]: https://i.stack.imgur.com/7D3Nu.png",1615202000,https://stackoverflow.com/q/66528761,TechXpert,"['cypher', 'neo4j', 'graph-databases']"
66527273,How can I create relationships to all neighbors of a match?,"Trying to build a sparse time tree in my db:
```cypher
MATCH (m:Month)-[:HAS_YEAR]-&gt;(y:Year)
WITH m, y ORDER by y.year, m.month
RETURN collect(m)
```
I would like to add a `-[:FOLLOWS]-&gt;` relationship between Month nodes following each others. Is there a simple way to loop through the list of nodes and create these relationships?


Notes:
* by sparse, I mean that some month nodes are missing if no test got conducted that month. For example, we have `(y:Year(number: 2019})&lt;-[:HAS_YEAR]-(:Month{number: 4})&lt;-[:FOLLOWS]-(:Month{number: 6})-[:HAS_YEAR]-&gt;(y)`.
* For context, I have a list of `(:Test)` nodes with a date field, which I parsed to create the relationship `(:Test)-[:DONE_ON]-&gt;(:Month)`. And I&#39;m trying to find a good way to filter the list of tests done in the last recorded month (whether it is this month, the previous one or an older one). If using Month nodes, I could simply query `MATCH (t:Test)-[:DONE_ON]-&gt;(m:Month) WHERE NOT EXISTS (m)&lt;-[:FOLLOWS]-(:Month) RETURN t`",1615195769,https://stackoverflow.com/q/66527273,Adrien Lemaire,"['cypher', 'neo4j']"
66522758,The neo4j cypher shell and the browser connections are working but the golang client connection is not working,"I have disabled the authentication on my neo4j server, so I can connect using the cypher shell using no credentials as it follows and is working.


    $ ./bin/cypher-shell -a 192.168.0.89

This is how I&#39;m declaring my driver and the session, I also tried using neo4j://* instead of bolt://*:

    driver, err := neo4j.NewDriver(&quot;bolt://192.168.0.89:7687&quot;, neo4j.NoAuth())
	if err != nil {
		return &quot;&quot;, err
	}
	defer driver.Close()

	session, _ := driver.NewSession(neo4j.SessionConfig{AccessMode: neo4j.AccessModeWrite})
	defer session.Close()

But that doesn&#39;t work either. I&#39;m getting this error when running the hello world from the neo4j olang driver page https://neo4j.com/developer/go/

    TLS error: Remote end closed the connection, check that TLS is enabled on the server

There are the logs of the server when it starts:

    2021-03-07 23:17:23.227+0000 INFO  ======== Neo4j 4.2.3 ========
    2021-03-07 23:17:24.119+0000 INFO  Performing postInitialization step for component &#39;security-users&#39; with version 2 and status CURRENT
    2021-03-07 23:17:24.119+0000 INFO  Updating the initial password in component &#39;security-users&#39;  
    2021-03-07 23:17:24.243+0000 INFO  Bolt enabled on 192.168.0.89:7687.
    2021-03-07 23:17:25.139+0000 INFO  Remote interface available at http://192.168.0.89:7474/
    2021-03-07 23:17:25.140+0000 INFO  Started.

These are all my config settings:
                                                      

    dbms.connector.bolt.advertised_address=192.168.0.89:7687
    dbms.connector.bolt.enabled=true                                                                
    dbms.connector.bolt.listen_address=192.168.0.89:7687                                                                
    dbms.connector.bolt.tls_level=DISABLED                                                                
    dbms.connector.http.advertised_address=192.168.0.89:7474
    dbms.connector.http.enabled=true                                                 
    dbms.connector.http.listen_address=192.168.0.89:7474                                                               
    dbms.connector.https.enabled=false                                                             
    dbms.default_advertised_address=192.168.0.89
    dbms.default_database=neo4j                                                               
    dbms.default_listen_address=192.168.0.89                                                      
    dbms.directories.import=/home/eduardo/NEO4J/import                                                       
    dbms.directories.neo4j_home=/home/eduardo/NEO4J
    dbms.jvm.additional=-Dlog4j2.disable.jmx=true
    dbms.security.auth_enabled=false
    dbms.tx_log.rotation.retention_policy=1 days                                                          
    dbms.tx_state.memory_allocation=ON_HEAP
    dbms.windows_service_name=neo4j

Again, I can connect to the same host and the browser is also working fine:
[![enter image description here][1]][1]
Thanks in advance for any help :)


  [1]: https://i.stack.imgur.com/mh8rV.png",1615161508,https://stackoverflow.com/q/66522758,Eduardo A. Fern&#225;ndez D&#237;az,"['neo4j', 'cypher', 'centos7']"
66521491,Import strings from Neo4j json dump,"Say I populate a Neo4j graph as follows:

    CREATE (n:Person {name: &#39;Andy&#39;, title: &#39;Developer&#39;})
    CREATE (n:Person {name: &#39;Betty&#39;, title: &#39;Developer&#39;})

And I dump the contents Neo4j to a json file as follows:

    call apoc.export.json.all(&quot;dump.json&quot;,{useTypes:true})

I would like to import the contents of that json file into a second database instance. I am aware I can import with:

    call apoc.import.json(&quot;dump.json&quot;)

But in my situation I will have the contents of the file in memory (it is guaranteed to not be very large) and cannot load the file from the filesystem. How can I import those lines into the second instance? I don&#39;t see a way to do this with apoc.import. Perhaps the way to do this to somehow use `apoc.convert.fromJsonList`? Am I missing a straightforward way to import these lines?",1615151671,https://stackoverflow.com/q/66521491,Jason,"['cypher', 'neo4j', 'neo4j-apoc', 'json']"
66518497,neo4j assign the index of items in list to the mathcing items,"&lt;br&gt;
For a given US State, I have the follwoing nodes and relationships in my neo4j database:&lt;br&gt;
(Drug)-[Associated_with_payment]-(OpenPymRec)-[Paid_to]-(Doctor)-[Has_Business_In]-(County)&lt;br&gt;
Each OpenPymRec node is connected to one doctor and many Drugs.&lt;br&gt;
County to Doctor is 1 to many: Each County has many Doctors, each Doctor has business in one county. &lt;br&gt;
&lt;br&gt;
Each OpenPymRec node has a total_dollar value, I want to take the top 5 counties based on the sum of total_dollar, then add two properties: category=&#39;TOP&#39;, category_index=0 or 1...or 4. &lt;br&gt;
&lt;br&gt;
for example if I run this query:&lt;br&gt;



    MATCH (r:Drug {drug_type:&#39;OPIOID&#39;})-[]-(o:OpenPymRec)-[]-(d:Doctor)-[:Has_Business_In]-(c:County) 
    return c,sum(o.total_dollar) as totd order by totd desc limit 5



and Get:&lt;br&gt;
&lt;br&gt;

| ----------------------------------- | ---------------- |  
│{&quot;county&quot;:&quot;A&quot;,&quot;state&quot;:&quot;XY&quot;}                                           │  5076345.23      │  
│{&quot;county&quot;:&quot;B&quot;,&quot;state&quot;:&quot;XY&quot;}                                           │  4100298.12      │  
│{&quot;county&quot;:&quot;C&quot;,&quot;state&quot;:&quot;XY&quot;}                                           │  3954690.04      │  
│{&quot;county&quot;:&quot;D&quot;,&quot;state&quot;:&quot;XY&quot;}                                           │  3272225.75      │  
│{&quot;county&quot;:&quot;E&quot;,&quot;state&quot;:&quot;XY&quot;}                                           │  2567077.01      │  
  
&lt;br&gt;
I want to add the new properties in the same order and get the follwoing result:&lt;br&gt;
&lt;br&gt;
 
| ------------------------------------------------------------------------------------ | ---------------- |    
│{&quot;county&quot;:&quot;A&quot;,&quot;state&quot;:&quot;XY&quot;,&quot;category&quot;:&quot;TOP&quot;,&quot;category_index&quot;:0}   │  5076345.23      │  
│{&quot;county&quot;:&quot;B&quot;,&quot;state&quot;:&quot;XY&quot;,&quot;category&quot;:&quot;TOP&quot;,&quot;category_index&quot;:1}   │  4100298.12      │  
│{&quot;county&quot;:&quot;C&quot;,&quot;state&quot;:&quot;XY&quot;,&quot;category&quot;:&quot;TOP&quot;,&quot;category_index&quot;:2}   │  3954690.04      │  
│{&quot;county&quot;:&quot;D&quot;,&quot;state&quot;:&quot;XY&quot;,&quot;category&quot;:&quot;TOP&quot;,&quot;category_index&quot;:3}   │  3272225.75      │  
│{&quot;county&quot;:&quot;E&quot;,&quot;state&quot;:&quot;XY&quot;,&quot;category&quot;:&quot;TOP&quot;,&quot;category_index&quot;:4}   │  2567077.01      │  
  


I tried with COLLECT..UNWIND, but how do I get the index of an Item in a list, ten assign it as a value of a new property?",1615132915,https://stackoverflow.com/q/66518497,FEldin,"['neo4j', 'cypher']"
66515511,Neo4j doesn&#39;t support in Heroku?,"I&#39;m trying to deploy a Spring boot app with Neo4j database, but when I find addons in Heroku, I can&#39;t see it. How can I do to push my Neo4j database to Heroku?
Please help me! Thank you in advance!",1615113140,https://stackoverflow.com/q/66515511,Trần Tuấn Anh,"['neo4j', 'spring', 'heroku', 'spring-boot']"
66515504,Py2neo slow to request all relationships,"I would like to list all relations inside my graph of around 20000 edges, with the cypher query ```MATCH ()-[r]-() RETURN r```. For each relation I would like to get the relation type, its properties, the source node ID, the target node ID.

When I run this query on the neo4j client interface, the results appear pretty fast in a few seconds.

However, when I call this query with py2neo with ```Graph.run(&quot;MATCH ()-[r]-() RETURN r&quot;)``` it takes a super long time to just loop on the results, without any processing.

Do you know why is that ?",1615113105,https://stackoverflow.com/q/66515504,Alexis Pister,"['neo4j', 'py2neo', 'cypher']"
66508744,How to delete a million of relationships in Neo4J Cypher without stalling the database?,"I&#39;m making the following request:

```
CALL apoc.index.relationships(&#39;TO&#39;,&#39;context:(1a2fbd10-7a50-11ea-bb71-25dd29c6e321)&#39;) 
yield rel 
with distinct rel 
delete rel;
```

The problem is that when I do 

```
CALL apoc.index.relationships(&#39;TO&#39;,&#39;context:(1a2fbd10-7a50-11ea-bb71-25dd29c6e321)&#39;) 
yield rel 
with distinct rel 
return count(rel);
```

It shows that I have about 900 000 relationships. 

So the first query takes too long to execute. When it&#39;s part of a transaction it stalls the database and uses too much memory.

Is there a procedure in Neo4J 3.3.9 (or 3.5) that allows me to execute this sort of long requests in batches so I don&#39;t overload my DB?",1615052470,https://stackoverflow.com/q/66508744,Aerodynamika,"['neo4j', 'cypher']"
66506919,I want to range the nodes by degree - why is this Neo4J Cypher request so slow?,"I want to first get all the nodes of a certain type connected to a context and then simply range them by their degree, but only for the (:TO) type of connection to the other nodes that belong to the same context. I tried several ways including the ones below but they are too slow (10s of seconds). Is there any way to make it faster?

```
MATCH (ctx:Context{uid:&#39;60156a60-d3e1-11ea-9477-f71401ca7fdb&#39;})&lt;-[:AT]-(c1:Concept) 
WITH c1 MATCH (c1)-[r:TO]-(c2:Concept) 
WHERE r.context = &#39;60156a60-d3e1-11ea-9477-f71401ca7fdb&#39; 
RETURN c2, count(r) as degree ORDER BY degree DESC LIMIT 10;
```

```
MATCH (ctx:Context{uid:&#39;60156a60-d3e1-11ea-9477-f71401ca7fdb&#39;})&lt;-[:AT]-(c1:Concept)-[:TO]-(c2:Concept) 
RETURN c1, count(c2) as degree 
ORDER BY degree DESC LIMIT 10;
```",1615042052,https://stackoverflow.com/q/66506919,Aerodynamika,"['neo4j', 'cypher']"
66501715,How to select all the items above threshold or at least the first item?,"I have been stuck on this problem for a day and it seems there is no out of the box easy way to do this so here I am.

To replicate the database we can use these queries

```
CREATE (:Score {value: 0.2})
CREATE (:Score {value: 0.3})
CREATE (:Score {value: 0.4})
CREATE (:Score {value: 0.5})
CREATE (:Score {value: 0.38})
CREATE (:Score {value: 0.35})
```

What I want is basically to return all the nodes whose value is above a certain threshold and if no such nodes are available then just return the one that has the max value

For example if the threshold is `0.35` then I want the query to return the nodes
``` 
(Score {value: 0.4})
(Score {value: 0.5})
(Score {value: 0.38})
```
because all of the above nodes have values greater than thea threshold


But if the threshold is `0.6` then it should just return the node
```
(Score {value: 0.5})
```
because no nodes qualify this threshold but 0.5 is the max value
",1614996589,https://stackoverflow.com/q/66501715,Nilan Saha,"['neo4j', 'graph-databases', 'cypher']"
66501660,Aggregating by Month from epoch date - neo4j cypher,"### Goal ##
**I am attempting to query neo4j for an average score, aggregated by month.**

### Background ##
The date attribute in my DB is set as epoch timestamp.

### Work so far ###
I have the following code so far

    MATCH(d:data) RETURN avg(d.score), date(datetime({epochMillis:d.submitted})) AS date
### Problem ###
This will return an average score, per day (for every day that a record exists)

I would like to get average for each month, rather than days.


### Also Tried ###
I had a good google and cannot seem to find an answer which does not rely on install apoch addon (which I don&#39;t have).

I found the following, but just can&#39;t understand (like most neo4j documentation) what it is actually trying to say.
https://neo4j.com/docs/api/python-driver/current/temporal_types.html

**Additional**

Ideally I would like to report max 12 months back from &quot;today&quot; and include months even if there is no records for that month (return month name and 0), not sure if this is as simple though, so any thoughts are appreciated!",1614995944,https://stackoverflow.com/q/66501660,Simon,"['cypher', 'neo4j', 'average', 'aggregate-functions']"
66490753,How to return a node that&#39;s the same name as another node but of a specific label? Neo4J,"I&#39;m working with financial data, and I want to find a name match between a name that&#39;s a synonym of a line item, and another node that has the same name as that synonym but is in a separate node unrelated to the synonym graph and has a specified attribute type that needs to be defined.

Here is some data:

     CREATE (n:Test1 {name: &quot;x&quot;})-[r:syn_of]-&gt;(s:Test2 {name: &quot;y&quot;})
     CREATE (n:Test3 {value: &quot;x&quot;})

So Test3 has the same value stored in attribute format as Test1, but the attribute label is different. How can I return the &#39;x&#39; from the value attribute of Test3, by querying using Test1 and/or Test2? I know this is a strange problem and due to confidentiality reasons I can&#39;t specify why I&#39;m doing this but if anyone could be any help this would be paramount. Thanks in advance.",1614939684,https://stackoverflow.com/q/66490753,Tous Shahedian-Farid,"['graph', 'cypher', 'neo4j']"
66490526,Path that return a unique node and no relationship,"I have this cypher query:

   

    MATCH p=(no {name:&#39;nodeName&#39;})&lt;-[:enfant*0..]-(parent:application) 
    unwind nodes(p) as n unwind relationships(p) as r
    with collect( distinct {id: id(n), name: n.name, labels: labels(n)}) as nl,
    collect( distinct {source: id(startnode(r)), target: id(endnode(r))}) as rl 
    RETURN {nodes: nl, links: rl}

This request retrun the path between a node and all his parents and then transform into d3js format(nodes&amp;links).
i have these cases : 

 1. the start node is not an application --&gt; the path return all nodes and relations so the response is good
 2. the start node is already an application, so the path return this node and then i have this response:

    {&quot;nodes&quot;:[],&quot;links&quot;:[]}

and normally I will have :

    {&quot;nodes&quot;:[{id: 111, name: &#39;nodeName&#39;, labels:[&#39;application&#39;]}],&quot;links&quot;:[]}

When i test without relationships like this :

    MATCH p=(no {name:&#39;nodeName&#39;})&lt;-[:enfant*0..]-(parent:application) 
    WITH p
    unwind nodes(p) as n 
    with collect( distinct {id: id(n), name: n.name, labels: labels(n)}) as nl
    RETURN {nodes: nl}
i have the good reponse :

    {&quot;nodes&quot;:[{&quot;name&quot;:&quot;nodeName&quot;,&quot;id&quot;:111,&quot;labels&quot;:[&quot;application&quot;]}]}    
so the problem is in the collect() with relationships because its empty, i don&#39;t know how can i fix that ?
Thank you.
",1614938845,https://stackoverflow.com/q/66490526,madiskou,"['neo4j', 'cypher']"
66487066,Strange Neo4j Cypher Aggregator behaviour with WITH Clause,"Below query is working fine :
 

    Match (x1:A) with x1 
    optional Match (x1)-[:A_B]-(x2:B) 
    with x1 ,count(x2) as x3 
    where x1.foo= &#39;bar&#39; and (x3 = 1) 
    return DISTINCT x1 as A 
    SKIP 0 
    LIMIT 10

But this query is giving wrong output

    Match (x1:A) with x1 
    optional Match (x1)-[:A_B]-(x2:B) 
    with x1 ,x2, count(x2) as x3 
    where x1.foo= &#39;bar&#39; and (x3 = 1) 
    return DISTINCT x1 as A 
    SKIP 0 
    LIMIT 10

",1614920520,https://stackoverflow.com/q/66487066,Arun Singhal,"['cypher', 'neo4j']"
66484382,Reduce Cost of Cypher Query,"Hi does anyone know how to break this query up so I have less DB Hits or cardinality but have the exact behaviour ?

I am trying to find people `common_likers` who were liked by persons who also liked some specific movies and then make sure that these `common_likers` are people who also liked me. Here me is basically a `Person` node with my id
```
OPTIONAL MATCH (common_likers:Person)&lt;-[:LIKES]-(person:Person)-[:LIKES]-&gt;(movie)
WHERE me &lt;&gt; person AND me &lt;&gt; common_likers AND id(common_likers) in my_likers
```
I tried 
```
OPTIONAL MATCH (common_likers:Person) WHERE me &lt;&gt; common_likers AND id(common_likers) in my_likers
MATCH (common_likers)&lt;-[:LIKES]-(person:Person)-[:LIKES]-&gt;(movie)
WHERE me &lt;&gt; person
```
but what happens is it restricts the `movie` to only the matches and I cannot do any future processing on the same list of `movie`",1614899260,https://stackoverflow.com/q/66484382,Nilan Saha,"['neo4j', 'cypher']"
66483537,Neo4j specify fields and column names for CSV export,"I&#39;m exporting some nodes to a CSV and I want to specify which fields to export, the column (field) names in the header, as well as convert some timestamps to &quot;human-readable&quot; strings. I have previously used a subquery and passed that to the apoc.export.csv.query() function, but I don&#39;t see an easy way to do this when I have many different types of nodes. Ideally, I would also like to express the relationships by having the primary keys in a column which is labeled by the relationship type. As an example:


Suppose I have just two node types: Apples and Boxes. There are some Box nodes without a &quot;:HAS&quot; relationship to an Apple node and some with multiple ones. This query gets the values that I want, but doesn&#39;t format them in the way I need:
```
MATCH (a:Apple) MATCH (b:B)-[:HAS]-&gt;(ab:Apple) 
WITH [a.pk, a.type, a.name, &quot;&quot;, &quot;&quot;] AS list1, 
[b.pk, b.type, b.name, ab.pk, b.field1] AS list2 
UNWIND list1 + list2 AS item RETURN item;

```
| item |
| ---- |
| 1314757 |
| Red Delicious |
| Fuji |
| &quot;&quot; |
| 7462518 |
| Box1 |
| 9686463 |
| 1472641 |


How I&#39;d like for them to be arranged is like this:

| pk | type | name | HAS Apple (pk) | field1 |
| -- | ---- | ---- | --- | ------ |
| 1314757 | Apple | Braeburn | | |
| 7462518 | Apple | Gala | | |
| 3010653 | Apple | Fuji | | |
| 9686463 | Box | Box1 | 1472641 | fieldval |
| 9686463 | Box | Box2 | 7462518  | fieldval |
| 4726110 | Apple | Red Delicious | | |

Is there a way that I can get them in this format using just cypher/apoc? They don&#39;t need to be ordered alphabetically.",1614894468,https://stackoverflow.com/q/66483537,asdf,"['csv', 'neo4j', 'neo4j-apoc', 'cypher']"
66483453,Migrate from one Graph Database to another,"**How can you migrate your data from one graph database (Neo4j, Tiger Graph etc.) to another?**

Background:
I have to decide between the standards of the W3C (RDF (S), OWL) and
Databases for property graphs (Neo4j, TigerGraph etc.).
I know that all &quot;triple stores&quot; that support the W3C standard also make it possible to simply &quot;pull out&quot; the data
and import it into another triple store.
For relational databases there is also the standard SQL (and dialects),
so that with a little effort you can get the data from one relational database to another.
But I can&#39;t think of such a solution for graph databases.",1614894028,https://stackoverflow.com/q/66483453,Grey Black,"['rdfs', 'rdf', 'neo4j', 'database', 'graph']"
66479006,Can I filter on a SemiStructured node in Neo4 Model?,"I am using the Neomodel Python package with the Neo4j database and loving it.  I am currently using the filter() method, but every time I use the filter() method on a property not defined in the  SemiStructuredNode I get an error.

In the example below I have my Person SemiStructuredNode with only surname as a property, but some nodes in the database might have eye_colour as well and I want to filter by that.  Note that not all nodes will have eye colour.

```
class Person(SemiStructuredNode):
    surname = StringProperty()

Person.nodes.filter(surname__contains=&#39;atts&#39;,eye_colour=&#39;BLUE&#39;)
```

To me the code above should work but I get a ```ValueError: No such property eye_colour on Person``` error.  However, if I change my class definition to include eye_colour as a StringProperty everything is fine.  However, I do not want to do this because there are various other dynamic filters I want to use because of different data being imported into the system.

Does Neomodel support what I&#39;m trying to do or will I have to build a Cypher query or can someone see what I&#39;m getting wrong?",1614874851,https://stackoverflow.com/q/66479006,jelly5798,"['neo4j', 'python', 'neomodel']"
66477616,Strange bug in a Cypher Neo4J request,"Why when I make a request below:
```
PROFILE MATCH (c1:Concept)-[:AT]-&gt;(ctx:Context{uid:&#39;60156a60-d3e1-11ea-9477-f71401ca7fdb&#39;}) 
WITH DISTINCT c1 RETURN c1;
```

It takes less than a second, but when I add another condition to it like


```
PROFILE MATCH (c1:Concept)-[:AT]-&gt;(ctx:Context{uid:&#39;60156a60-d3e1-11ea-9477-f71401ca7fdb&#39;}) 
WITH DISTINCT c1 
MATCH (c2:Concept)-[:AT]-&gt;(ctx:Context{uid:&#39;60156a60-d3e1-11ea-9477-f71401ca7fdb&#39;}) 
RETURN c1;
```

Which is the same, it stalls my Neo4J database?

I use 3.3.9. ",1614869898,https://stackoverflow.com/q/66477616,Aerodynamika,"['cypher', 'neo4j']"
66476883,OngDB API endpoints for casual cluster HA,"I&#39;m looking for API endpoint details for HA on ongdb. Could you please share the documentation of endpoints to identify ha master(leader) and slaves(followers)?

I tried :

```
curl -v http://&lt;master-ip&gt;:7474/db/manage/server/ha/master
Receiving a 403 Forbidden.

```

The same for slaves(/db/manage/server/ha/slave) with or without auth(username:neo4j, password:defaultpassword)

Or is there some other way to perform HA checks from the LB?

Please advise. Thanks!",1614867571,https://stackoverflow.com/q/66476883,Richard Pinto,"['neo4j', 'ongdb', 'api']"
66473901,How to show all the relations between the nodes in Neo4J?,"Suppose I extract a list of nodes from my Neo4J 3.3.9 database using Cypher like this:

```
MATCH (c:Concept)-[:BY]-&gt;(u:User{uid:&#39;16c01100-aa92-11e3-a3f6-35e25c9775ff&#39;}) 
RETURN DISTINCT c;
```

How do I then show all the relations between these nodes in the most efficient way?

Currently, in my database structure, the nodes of the type `Concept` are linked with the `:TO` type of relations. 

When I make this sort of query in the Neo4J browser the connections between the extracted nodes are automatically shown, so how do I do the same in a request?

I tried something like this:

```
MATCH (c:Concept)-[:BY]-&gt;(u:User{uid:&#39;16c01100-aa92-11e3-a3f6-35e25c9775ff&#39;}) 
WITH DISTINCT c 
MATCH (u:User{uid:&#39;16c01100-aa92-11e3-a3f6-35e25c9775ff&#39;})&lt;-[:BY]-(con:Concept)-[rel:TO]-&gt;(c) 
RETURN DISTINCT rel limit 10;
```

But that is too slow and stalls my database (I&#39;ve got about 10000 of the `c` nodes so the number of relations in the 100s of thousands. 

What would be a more efficient request?",1614856511,https://stackoverflow.com/q/66473901,Aerodynamika,"['cypher', 'neo4j']"
66467313,Graph database vs. RDB with link/bridge tables,"I work in the fraud/AML (anti-money laundering) field, and we are exploring using a graph database to unearth hidden connections and links. I&#39;ve read a fair amount abut graph databases lately (mostly neo4j, but I think the concepts are similar across different products?), and from what I can tell, they seem to be well-suited to this domain. The issue is that I&#39;m having a hard time getting buy-in from tech management, as they seem to think that we can do the same things with our existing data reporting model, which is in Hadoop, and is essentially a data warehouse which has specific tables that provide many-to-many link tables between the core tables (I believe Kimball calls them &#39;bridge&#39; tables?). 

In a way, they seem to provide the same functionality as the relationship tables in a graph DB. Given that we have already constructed the link tablesin Hadoop, would a graph database provide any performance advantage for the kinds of things we may want to do (e.g. How is Customer A connected to Customer B), or have we largely negated any performance advantage of a graph DB by building all of the link tables?",1614821498,https://stackoverflow.com/q/66467313,deano,"['neo4j', 'database-design', 'data-warehouse', 'database', 'graph-databases']"
66467261,Product recommendation cypher,"I have the following simple graph - 

[![product graph][1]][1]


  [1]: https://i.stack.imgur.com/yD6Ka.png

I wish to build a simple recommendation system on the basis of the following example:

 1. Consider that we have invoice 1 with an Article &quot;Apple&quot;.
 2. We also have invoice 2 which has &quot;Apple&quot; and &quot;Oranges&quot;.
 3. Customer of invoice 1 should be recommended &quot;Oranges&quot;.

Basically, When a customer adds an item to an invoice, we need to recommend articles that were added to another invoice with at least one of its article in the current invoice. And the recommended article not in the current invoice.


Another way to say this -  

When an article A exists in Invoice 1 AND Invoice 2 also contains article A, then list all other articles in Invoice 2 provided they do not exist in Invoice 1. 

However, as a complete beginner I&#39;m unable to figure out how to write the cypher query. Any help on how to write such a query?
",1614821031,https://stackoverflow.com/q/66467261,krtkush,"['cypher', 'neo4j', 'graph-databases']"
66465724,How to pass a DateTime value as parameter in Java Driver for Neo4J?,"I am using the Neo4J Java driver

    &lt;dependency&gt;
        &lt;groupId&gt;org.neo4j.driver&lt;/groupId&gt;
        &lt;artifactId&gt;neo4j-java-driver&lt;/artifactId&gt;
        &lt;version&gt;4.2.0&lt;/version&gt;
    &lt;/dependency&gt;

And I am trying to use a DateTime value as value in a parameter map roughly like this:

    // we have a timezone, unixTimestamp as epoch seconds and a simple key: &quot;d&quot;
    final Instant instant = Instant.ofEpochSecond(unixTimestamp);
    final ZoneId zoneId = ZoneId.of(timezone);
    final ZonedDateTime zonedValueDate = ZonedDateTime.ofInstant(instant, zoneId);
    // creating a DateTimeValue from zonedValueDate does not work either
    return Map.of(key, zonedValueDate);

This map is used in an instance of `TransactionWork` like

    public Map&lt;String,Object&gt; execute(Transaction tx) {
        Result queryResult = tx.run(query, parameter);
        // consuming results ...
        // returning them as Map
    }

But I am getting an exception:

    org.neo4j.driver.exceptions.ClientException: Property values can only be of primitive types or arrays thereof

A `DateTime` or `ZonedDateTime` [should be allowed as parameter][1] ([here is another hint][2]), but how can it be used correctly?

Or do I **HAVE** to create a DateTime value like [this][3]:

    datetime({year:1984, month:10, day:11, hour:12, timezone: &#39;Europe/Stockholm&#39;})


  [1]: https://neo4j.com/docs/driver-manual/current/cypher-workflow/#driver-type-mapping
  [2]: https://community.neo4j.com/t/unable-to-convert-to-neo4j-value-java-bolt-driver/14325/2
  [3]: https://neo4j.com/docs/cypher-manual/current/functions/temporal/#functions-datetime-temporal",1614809632,https://stackoverflow.com/q/66465724,BairDev,"['neo4j-bolt', 'neo4j']"
66464429,Can&#39;t save to Neo4j database,"I am trying to create a Spring Boot project with Neo4j. I connected successfully with Neo4j. But when I save data to Neo4j, it has error. Below is my project:

User:

[![enter image description here][1]][1]


UserRepository:
[![enter image description here][2]][2]
User Controller:
[![enter image description here][3]][3]
UserService:
[![enter image description here][4]][4]

And when I call API signup to save user to Neo4j. It has error in UserService at line &quot;userRepository.save(user);&quot;. Here is it: 
[![enter image description here][5]][5]

Thank you so much in advance!

  [1]: https://i.stack.imgur.com/6z41z.png
  [2]: https://i.stack.imgur.com/LbYXb.png
  [3]: https://i.stack.imgur.com/CKc8Q.png
  [4]: https://i.stack.imgur.com/MLyT0.png
  [5]: https://i.stack.imgur.com/OwJYi.png",1614803214,https://stackoverflow.com/q/66464429,Trần Tuấn Anh,"['spring-boot', 'neo4j']"
66459654,"Cypher Question, Return results only if connected with all nodes","The graph bellow shows that two out of three persons have both java and php as skills.
I produced this graph with this query
 ```
{
  &quot;rows&quot;: [
    {
      &quot;name&quot;: &quot;PHP&quot;,
      &quot;id&quot;: 23776,
      &quot;entity_id&quot;: 23776,
      &quot;yearsOfExperience&quot;: 2
    },
    {
      &quot;name&quot;: &quot;Java&quot;,
      &quot;id&quot;: 17477,
      &quot;entity_id&quot;: 17477,
      &quot;yearsOfExperience&quot;: 2
    }
  ]
}
```
```UNWIND $rows AS row
 MATCH  (s:SkillNode) 
 WHERE s.entity_id = row.entity_id
 with s,  row
 match (c:CandidateNode)-[r:KNOWS]-&gt;(s)
where r.years_of_experience&lt;=row.yearsOfExperience
RETURN *;
```

What should i change in the query in order to receive Candidates (the greens) only if they have all the skills provided in rows?

For the example i posted, i dont want to have the Candidate &quot;Ena Dyo Tria&quot; but all the others.
&quot;Ena Dyo Tria&quot; user could be in the graph if the rows did not contain PHP .

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/TfcHi.jpg",1614783794,https://stackoverflow.com/q/66459654,Manos Nathanail,['neo4j']
66457559,"Can Cypher do phonetic text search with only a part of the text, without using elastic search?","Say I have a job as financial administrator (j:Job {name: &#39;financial administrator&#39;}).

Many people use different titles for a &#39;financial administrator&#39;. Therefore, I want abovementioned job as a hit, even if people type only &#39;financial&#39; or &#39;administrator&#39; **and** their input has typos (like: &#39;fynancial&#39;). 

CONTAINS only gives results when the match is 100% - so without typos. 

Thanks a lot!

",1614776193,https://stackoverflow.com/q/66457559,Rob Brand,"['neo4j', 'elasticsearch-phonetic', 'text-search', 'cypher']"
66456507,Querying lucene index with arbitrary long article text to check for all matches within article (through neo4j),"I&#39;m trying to query the lucene index I&#39;ve added to a neo4j field (it&#39;s a &quot;name&quot; field, that isn&#39;t very long, one to ten words at most).

What I do right now is take all the text in a given webpage, sanitize it with a javascript function to keep only words, spaces and alphanumeric characters, and use that to query my index.

    .replace(/[^\w\s]|or|and|not|return+/gi, &quot;&quot;) // &lt;- escaping the input

I&#39;m not sure if the length of the search text is limited somehow, but results do seem to disappear after about 1050 words (~6500 characters).

Ideally, I&#39;d like to be able to use a couple thousand words in one query, with the end goal of highlighting the matches found within the webpage itself.

Why is my query not returning any results past a certain number of characters ? Am I missing some keyword in my escaping regex ?

Is what I&#39;m trying to achieve feasible ? Is there a better approach I could use ?

Thanks for reading :)

(for anyone finding this, I found a somewhat related question here: https://stackoverflow.com/questions/17219657/handling-large-search-queries-on-relatively-small-index-documents-in-lucene)",1614772191,https://stackoverflow.com/q/66456507,doei,"['lucene', 'neo4j', 'full-text-indexing', 'full-text-search']"
66450859,Creating several millions of relationships in Neo4j takes a very long time,"I am using the latest Neo4j.Driver package (4.2.0) and the latest community edition of the Neo4j server (4.2.3).

I must be doing something wrong, because my query takes hours to complete.

I have 4 CSV files:

 1. XyzTypes.csv - defines 96,328 type nodes.
 1. XyzMethods.csv - defines 975,507 methods across all the types.
 1. XyzTypeTypeDependencies.csv - defines 121,834 type-type DEPENDS_ON relationships.
 1. XyzTypeMethods.csv - defines 973,972 type-method DECLARES relationships.

The following code should be very simple. It just needs to load all the CSV and create the respective Types, Methods and the relationships.

Here is my code:
```csharp
var driver = GraphDatabase.Driver(&quot;bolt://localhost:7687&quot;, AuthTokens.Basic(&quot;neo4j&quot;, &quot;1&quot;));
var session = driver.AsyncSession(o =&gt; o.WithDatabase(&quot;neo4j&quot;));
try
{
    Console.Write(&quot;[DI&quot;);
    await session.RunAsync(&quot;DROP INDEX type_id_index IF EXISTS&quot;);
    await session.RunAsync(&quot;DROP INDEX method_id_index IF EXISTS&quot;);

    Console.Write(&quot;][C&quot;);
    await session.WriteTransactionAsync(async tx =&gt;
    {
        await tx.RunAsync(&quot;match ()-[r]-&gt;() delete r&quot;);
        await tx.RunAsync(&quot;match (n) delete n&quot;);
        return default(object);
    });

    Console.Write(&quot;][T&quot;);
    await session.WriteTransactionAsync(async tx =&gt;
    {
        await tx.RunAsync(@&quot;
LOAD CSV WITH HEADERS FROM &#39;file:///C:/Temp/XyzTypes.csv&#39; AS line
CREATE (:Type {
    typeId: toInteger(line.id),
    name: line.name,
    fullName: line.fullName,
    isCompilerGenerated: toBoolean(line.isCompilerGenerated),
    asmName: line.asmName
})&quot;);
        return default(object);
    });

    Console.Write(&quot;][M&quot;);
    await session.WriteTransactionAsync(async tx =&gt;
    {
        await tx.RunAsync(@&quot;
LOAD CSV WITH HEADERS FROM &#39;file:///C:/Temp/XyzMethods.csv&#39; AS line
CREATE (:Method {
    methodId: toInteger(line.id),
    name: line.name,
    fullName: line.fullName,
    isCompilerGenerated: toBoolean(line.isCompilerGenerated)
})&quot;);
        return default(object);
    });

    Console.Write(&quot;][CI&quot;);
    await session.RunAsync(&quot;CREATE INDEX type_id_index FOR (t:Type) ON (t.typeId)&quot;);
    await session.RunAsync(&quot;CREATE INDEX method_id_index FOR (m:Method) ON (m.methodId)&quot;);
    
    Console.Write(&quot;][TT&quot;);
    await session.RunAsync(@&quot;
USING PERIODIC COMMIT LOAD CSV WITH HEADERS FROM &#39;file:///C:/Temp/XyzTypeTypeDependencies.csv&#39; AS line
MATCH (src:Type), (dst:Type)
WHERE src.typeId = toInteger(line.src) AND dst.typeId = toInteger(line.dst)
CREATE (src)-[:DEPENDS_ON]-&gt;(dst)
&quot;);

    Console.Write(&quot;][TM&quot;);
    await session.RunAsync(@&quot;
USING PERIODIC COMMIT LOAD CSV WITH HEADERS FROM &#39;file:///C:/Temp/XyzTypeMethods.csv&#39; AS line
MATCH (src:Type), (dst:Method)
WHERE src.typeId = toInteger(line.src) AND dst.methodId = toInteger(line.dst)
CREATE (src)-[:DECLARES]-&gt;(dst)
&quot;);

    Console.Write(&quot;] ... &quot;);
}
finally
{
    await session.CloseAsync();
    await driver.CloseAsync();
}
```

The `CREATE INDEX` queries return immediately. Could be legit, I do not know how fast Neo4j can index a number property in about 1M nodes. Running `:schema` in the browser confirms the two indices, but I have a feeling they are not working.

Running the above code takes almost 3 hours. What am I doing wrong?

**EDIT 1**

So I changed the last two queries to use the `MERGE` clause:
```csharp
    Console.Write(&quot;][TT&quot;);
    await session.RunAsync(@&quot;
USING PERIODIC COMMIT LOAD CSV WITH HEADERS FROM &#39;file:///C:/Temp/XyzTypeTypeDependencies.csv&#39; AS line
MERGE (src:Type {typeId: toInteger(line.src)})-[:DEPENDS_ON]-&gt;(dst:Type {typeId: toInteger(line.dst)})
&quot;);
    
    Console.Write(&quot;][TM&quot;);
    await session.RunAsync(@&quot;
USING PERIODIC COMMIT LOAD CSV WITH HEADERS FROM &#39;file:///C:/Temp/XyzTypeMethods.csv&#39; AS line
MERGE (src:Type {typeId: toInteger(line.src)})-[:DECLARES]-&gt;(dst:Method {methodId: toInteger(line.dst)})
&quot;);
```
It is supposed to be much better now, because I think what I did before caused cartesian multiplication between the nodes. Yet the last query is taking an unknown amount of time (no idea how long at the moment) - still bad.",1614746141,https://stackoverflow.com/q/66450859,mark,"['.net', 'neo4j', 'csv']"
66446894,Update a list property of a node by values of a CSV file," I would like to update the list property of one node in my DB by a CSV file. The node&#39;s name is ``Class`` and it has two properties ``name`` of type string and ``vector`` of type list of string. The CSV file has two columns ``nameCSV`` and ``vectorCSV`` and some rows have the same value for the ``nameCSV`` column but different values for the ``vectorCSV`` column. So I want to update the ``vector`` property by adding the values of the ``vectorCSV`` when their corresponding names are equal. I wrote this query in Cypher but it doesn&#39;t work:

    load  CSV WITH HEADERS FROM &quot;file:///test2.csv&quot; AS  vector
    MATCH (c:Class) 
    Merge( nv:CSVfile {nameCSV: vector.nameCSV,vectorCSV:vector.vectorCSV})
    where c.name = nv.nameCSV
    set c.vector = c.vector + nv.vectorCSV

How should I change this query to update the list property ``vector`` of the node ``Class``. 



",1614717958,https://stackoverflow.com/q/66446894,Jennifer L,"['neo4j', 'cypher']"
66446134,Using Neo4j to store json data,"I have a network topology which consists of a number of switches and hosts.  
Using Neo4j, I created a graph db that import the network topology information from a json file. and it works.  
Now I need to store the switch statistics like the no. of packet sent, packet received, packet loss for a specific period of time. The json file consists of a huge no. of lines (more than 2000 line) for only one switch.  
I face a problem storing this kind of data as node properties since it is huge data!
Any suggestions please. Does Neo4j can benefit me in storing this kind of data?  
Many thanks  
",1614714393,https://stackoverflow.com/q/66446134,Sama,"['neo4j', 'json']"
66440526,How to call Neo4j database api in R Studio,"Please I created a Neo4j database instance, and I am trying to call it in R Studio, using the neo4r and neo4jshell packages. After running the api call, I still get a `404`even though I correctly specified the url, username, and password. Please find my code below:


    library(neo4r)
    library(neo4jshell)
    
    myTwitter &lt;- neo4j_api$new(
      
      url = &quot;http://54.152.83.7:7474&quot;,
      user = &quot;neo4j&quot;, 
      password = &quot;mypassword&quot;
    )
    
    
    myTwitter$ping()

When I run the last line of code, I get the `404` instead of `200`, which obviously means my api call was not successful. Please I would appreciate your helpful suggestions. Thank you

",1614692338,https://stackoverflow.com/q/66440526,user5983006,"['neo4j', 'r']"
66436765,YML files in Dynamic module,"is it possible to add YML files in the dynamic module because I can just add from the .env file. The way that I am adding yml file is using custom config file: https://docs.nestjs.com/techniques/configuration#custom-configuration-files

```@Module({
  imports: [
    ConfigModule.forRoot({ 
      isGlobal: true,
      //ignoreEnvFile: true,
      load: [configuration]
    }),
    Neo4jModule.forRootAsync({
      imports: [ ConfigModule ],
      inject: [ ConfigService ],
      useFactory: (configService: ConfigService): Neo4jConfig =&gt; {
        console.log(configService.get(&#39;NEO4J_SCHEME&#39;))
        console.log(configService.get(&#39;db.neo4j.host&#39;)) // undefined
        return {
          scheme: configService.get(&#39;NEO4J_SCHEME&#39;),
          host: &#39;localhost&#39;,//configService.get(&#39;NEO4J_HOST&#39;),
          port: 7687,//configService.get(&#39;NEO4J_PORT&#39;),
          username: &#39;xxxx&#39;,//configService.get(&#39;NEO4J_USERNAME&#39;),
          password: &#39;xxxxx&#39;,//configService.get(&#39;NEO4J_PASSWORD&#39;),
          database: &#39;xxxxx&#39;//configService.get(&#39;NEO4J_DATABASE&#39;),
        }
      }
    }),
    UserModule
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}",1614677764,https://stackoverflow.com/q/66436765,Ganbel,"['nestjs', 'neo4j']"
66428411,How to import data into Neo4j from Azure Blob Storage?,Is there a way to import data into Neo4j from Azure Blob Storage?,1614626854,https://stackoverflow.com/q/66428411,RB17,"['neo4j', 'azure-blob-storage', 'azure']"
66423331,Cypher query to get path between distant nodes,"I am pretty new to neo4j/cypher and i need your help with a query. 

With this cypher statement: `Match p=(a:Value_Node {katalog_name:&quot;id&quot;})-[r:RELATED_TO_*]-&gt;(b:Value_Node {katalog_name:&quot;Gewicht&quot;}) return p` i get that picture below. 

But i want to query only the path for one `value` that is also given in the properties (`id_nr`) of the relation `RELATED_TO_`. So i am looking for the path of one id from Start-node `(a:Value_Node {katalog_name:&quot;id&quot;})` to End-Node `(b:Value_Node {katalog_name:&quot;Gewicht&quot;}`.
With this query: `Match p=(a:Value_Node {katalog_name:&quot;id&quot;})-[r:RELATED_TO_*]-&gt;(b:Value_Node {katalog_name:&quot;Gewicht&quot;}) WHERE (a.value = r.id_nr) return p` i get the Errormessage:

&gt;Neo.ClientError.Statement.SyntaxError
Type mismatch: expected Map, Node, Relationship, Point, Duration, Date, Time, LocalTime, LocalDateTime or DateTime but was List&lt;Relationship&gt; (line 1, column 117 (offset: 116))
&quot;Match p=(a:Value_Node {katalog_name:&quot;id&quot;})-[r:RELATED_TO_*]-&gt;(b:Value_Node {katalog_name:&quot;Gewicht&quot;}) WHERE (a.value=r.id_nr) return p&quot;
                              `

[![enter image description here][1]][1]

Any help is useful!
Thanks a lot!

  [1]: https://i.stack.imgur.com/Wju7H.png",1614606600,https://stackoverflow.com/q/66423331,KTTRLD,"['cypher', 'neo4j']"
66415473,"How to query multiple items in Neo4J, return just one in order of precedence?","I am building a multi-lingual app using Neo4J with the following structure:

```cypher
(Article)-[:HAS_TRANSLATION]-&gt;(Translation {lang: &#39;EN&#39;, default: true, text: &#39;Hello World&#39;})
```

I would like users to be able to pass in a list of language preferences such as `[&#39;EN&#39;, &#39;ES&#39;]`. The query should return the translation for the first language on the list found. If no preferred languages are found the query should return the default language. Just one translation should be returned.

It is easy to return a list of all applicable translations. But this will waste a lot of bandwidth over millions of queries. I also tried putting in a `LIMIT 1` but the results are not in the correct order.

```cypher
MATCH (a:Article {id: &#39;123&#39;})-[:HAS_TRANSLATION]-&gt;(t:Translation)
WHERE t.lang IN [&#39;ES&#39;, &#39;EN&#39;] OR t.default = true
RETURN a, t
```

The challenge is to return just the correct translation based on the order of precedence.

",1614560894,https://stackoverflow.com/q/66415473,Colin Skow,"['neo4j', 'cypher']"
66414852,Cypher change key name on map,"Using cypher in neo4j, **what&#39;s the best way to change all keys with a certain name on a map?** E.g., in the code below, I&#39;d want to replace *theOrigKey* with *theNewKey*.

```lang-cypher
WITH {dummyKey:1,
  theOrigKey:[
    {lvl2DummyKey:2,
      theOrigKey:[ {lvl3DummyKey:3.1},{lvl3DummyKey:3.2} ]
    },
    {lvl2DummyKey:2,
      theOrigKey:[ {lvl3DummyKey:3.1}, {lvl3DummyKey:3.2} ]
    }
  ]} AS myMap
RETURN myMap
```  
becomes  
```lang-cypher
WITH {dummyKey:1,
  theNewKey:[
    {lvl2DummyKey:2,
      theNewKey:[ {lvl3DummyKey:3.1},{lvl3DummyKey:3.2} ]
    },
    {lvl2DummyKey:2,
      theNewKey:[ {lvl3DummyKey:3.1}, {lvl3DummyKey:3.2} ]
    }
  ]} AS myMap
RETURN myMap
```  
I thought about converting the map to a string, replacing the text, and then converting it back again. But, that seems inefficient and wouldn&#39;t work if the key might show up elsewhere in the data (it also didn&#39;t work for me anyway).

```lang-cypher
WITH apoc.convert.toString(myMap) AS strMyMap
WITH replace(strMyMap, &quot;theOrigKey&quot;, &quot;theNewKey&quot;) AS strMyMap
WITH apoc.convert.toMap(strMyMap) AS MyNewMap
RETURN MyNewMap
```
If these were nodes I could just use `SET` and `REMOVE` statements, but these are just maps. It would be fine to convert them to JSON, if that helps... the next step of the process converts them to JSON anyway.

Any thoughts on a good way to do this while staying within cypher?",1614554410,https://stackoverflow.com/q/66414852,B D T,"['neo4j-apoc', 'neo4j', 'cypher']"
66413285,Neo4J Community 4.1.6 Stops after starting,"I try to run Neo4J Community Edition 4.1.6 and need a hint. I have downloaded the winzip-package and unzipped it on a Windows 10 PC. I created a folder for the Neo4j files and another for the current JDK 15 package. The path for JDK has been put into system path variables. The log-flags in the neo4j conf has been set to DEBUG for HTPP. JAVA version throws the correct &quot;15.0.2&quot;. No JAVA error message while starting.

I can start the service and the status gives back &quot;Neo4j Service started...&quot;. After roughly 10 seconds the status shows that Neo4j has stopped without any further notice.

I can&#39;t see any logs in the \logs folder - the folder is empty. 
I do not see a graphdb been created under neo4j-community-4.1.6\data\databases - the folder is empty
I cannot access the DB by localhost:7474

I do not see any error messages in the cmd windows.

I restarted the system several times but I still have the same outcome. Any hints?

Thank you
",1614542215,https://stackoverflow.com/q/66413285,Balael,['neo4j']
66410140,Neo4j database will not load in my desktop application on windows,"Please I am trying to access the Neo4j database via its browser. I have used both bolt//:localhost:7687 and http//:localhost:7474, and Username: &quot;neo4j&quot; and Password:&quot;neo4j&quot; but with no success. I can&#39;t even start a database instance.

I have uninstalled and reinstalled Neo4j on my computer; I have updated Powershell on my Windows 8.1 computer, yet I keep getting an error message whenever I try to run the Movie database in the desktop.

I have also looked into the log.log file, but can&#39;t seem to find anything other than that I should update Powershell, which I have done.

I have corresponded with a relations officer at Neo4j, over 30 emails, and still I can&#39;t access Neo4j database.

Could it have anything to do with my web browser? I use Mozilla Firefox.

Because I am unable to successfully connect to Neo4j database, I can&#39;t call the api in R Studio and run cypher queries.

Does Neo4j have a web version, which I could use, since the desktop version isn&#39;t working?

Please does anybody have any idea or advice on what I could do to resolve this problem? I am really exasperated right now.",1614522795,https://stackoverflow.com/q/66410140,user5983006,['neo4j']
66403580,Python: Popen subprocess stdin=PIPE sending newline automatically,"I&#39;m following a solution from this S.O. post: 

https://stackoverflow.com/questions/375427/a-non-blocking-read-on-a-subprocess-pipe-in-python

and my goal is to have not only non-blocking reading of the child process within the loop, but the ability to write to the child process in order to respond to prompts from the process. In this example, I&#39;m trying to automate the cypher-shell command from neo4j to set user credentials:

    import subprocess
    import os 
    import time
    import sys
    
    p = subprocess.Popen(&#39;cypher-shell&#39;, stdin=subprocess.PIPE, stderr=subprocess.STDOUT, stdout=subprocess.PIPE)
    os.set_blocking(p.stdout.fileno(), False)
    start = time.time()
    while True:
        # first iteration always produces empty byte string in non-blocking mode
        for i in range(2):    
            line = p.stdout.readline()
            print(i, line)
            time.sleep(0.5)    
        if time.time() &gt; start + 5:
            break
    p.terminate()

I expect the first non empty line to be &quot;username:&quot; but instead I get &quot;The client is unauthorized due to authentication failure&quot;, indicating that somehow the process received an input from stdin that it interpreted as user input. And if I remove `stdin=subprocess.PIPE`, I do indeed get &quot;username&quot;. So somehow `stdin=subprocess.PIPE` is screwing thing up. What am I misunderstanding?",1614460803,https://stackoverflow.com/q/66403580,CodeOwl,"['subprocess', 'neo4j', 'python', 'popen']"
66402744,neo4j browser reports completely unrealistic runtime,"I am using Neo4j community 4.2.1, playing with graph databases. I plan to operate on lots of data and want to get familiar with indexes and stuff.
However, I&#39;m stuck at a very basic level because in the browser Neo4j reports query runtimes which have nothing to do with reality.

I&#39;m executing the following query in the browser at http://localhost:7687/:

    match (m:Method),(o:Method) where m.name=o.name and m.name &lt;&gt; &#39;&lt;init&gt;&#39; and 
    m.signature=o.signature and toInteger(o.access)%8 in [1,4]
    return m,o

The DB has ~5000 Method labels.

The browser returns data after about 30sec. However, Neo4j reports

    Started streaming 93636 records after 1 ms and completed after 42 ms, displaying first 1000 rows.

Well, 42ms and 30sec is really far away from each other! What am I supposed to do with this message? Did the query take only milliseconds and the remaining 30secs were spent rendering the stuff in the browser? What is going on here? How can I improve my query if I cannot even tell how long it really ran?

I modified the query, returning `count(m) + count(n)` instead of `m,n` which changed things, now runtime is about 2secs and Neo4j reports about the same amount.

Can somebody tell me how I can get realistic runtime figures of my queries without using the stop watch of my cell?",1614454503,https://stackoverflow.com/q/66402744,kaidentity,['neo4j']
66401154,How do I return a Neo4j path with Neo4jClient in .NET?,"### Summary
I&#39;m trying to fetch a `path` from Neo4j using the Neo4jClient package in .NET.  I&#39;m wondering how to deserialize it while maintaining the robust values featured in the `table` response, but I can only seem to access the `text` response instead.

***Disclaimer*** - I *have* seen [this answer](https://stackoverflow.com/questions/15108301/how-do-i-retrieve-a-path-in-neo4jclient), but it&#39;s over 7 years old and hardly relevant anymore — not to mention that the end result looks incredibly convoluted.

### Technology Versions
- **Neo4j** - 4.2.3
- **APOC** - 4.2.0.1
- **Neo4jClient** - 4.1.5
- **.NET Framework** - 4.7.2

### Data Structure
I have a Neo4j database that houses three types of nodes.  For the sake of this question, I&#39;m going to water them down to a corporate example, so let&#39;s call the node labels `Employee`, `Department`, and `Project`.  Those nodes are interconnected in the following ways:
- Every `Employee` has an `EMPLOYED_BY` relationship with a `Department`.
- Every `Project` has an `OWNED_BY` relationship with a `Department`.
- An `Employee` could have a `WORKS_ON` relationship with a `Project`.

### Sample Data
For the sake of this question, this sample data provides a baseline demonstration of the data structure.
```javascript
(:Employee {name:&quot;Sarah Bradshaw&quot;})
-[:EMPLOYED_BY {startDate:&quot;2020-01-01&quot;}]-&gt;
(:Department {name:&quot;Finance&quot;})
&lt;-[:OWNED_BY {startDate:&quot;2020-01-01&quot;}]-
(:Project {name:&quot;Quarterly Earnings&quot;})
&lt;-[:WORKS_ON {startDate:&quot;2020-06-01&quot;}]-
(:Employee {name:&quot;Thomas Mitchell&quot;})
-[:EMPLOYED_BY {startDate:&quot;2019-01-01&quot;}]-&gt;
(:Department {name:&quot;Administration&quot;})
```
[![A visual representation of the above data.][1]][1]

### Cypher Query
This is the query I&#39;m attempting to duplicate in .NET with the Neo4jClient package.
```javascript
MATCH (from:Employee {name:&quot;Sarah Bradshaw&quot;})
MATCH (to:Employee {name:&quot;Thomas Mitchell&quot;})
CALL apoc.algo.dijkstra(from, to, &#39;&#39;, &#39;d&#39;)
YIELD path
RETURN path
```

### Responses
**Table Response**
```json
{
    &quot;start&quot;: {
        &quot;identity&quot;: 0,
        &quot;labels&quot;: [ &quot;Employee&quot; ],
        &quot;properties&quot;: {
            &quot;name&quot;: &quot;Sarah Bradshaw&quot;
        }
    },
    &quot;end&quot;: {
        &quot;identity&quot;: 3,
        &quot;labels&quot;: [ &quot;Employee&quot; ],
        &quot;properties&quot;: {
            &quot;name&quot;: &quot;Thomas Mitchell&quot;
        }
    },
    &quot;segments&quot;: [
        {
            &quot;start&quot;: {
                &quot;identity&quot;: 0,
                &quot;labels&quot;: [ &quot;Employee&quot; ],
                &quot;properties&quot;: {
                    &quot;name&quot;: &quot;Sarah Bradshaw&quot;
                }
            },
            &quot;relationship&quot;: {
                &quot;identity&quot;: 0,
                &quot;start&quot;: 0,
                &quot;end&quot;: 1,
                &quot;type&quot;: &quot;EMPLOYED_BY&quot;,
                &quot;properties&quot;: {
                    &quot;startDate&quot;: &quot;2020-01-01&quot;
                }
            },
            &quot;end&quot;: {
                &quot;identity&quot;: 1,
                &quot;labels&quot;: [ &quot;Department&quot; ],
                &quot;properties&quot;: {
                    &quot;name&quot;: &quot;Finance&quot;
                }
            }
        },
        {
            &quot;start&quot;: {
                &quot;identity&quot;: 1,
                &quot;labels&quot;: [ &quot;Department&quot; ],
                &quot;properties&quot;: {
                    &quot;name&quot;: &quot;Finance&quot;
                }
            },
            &quot;relationship&quot;: {
                &quot;identity&quot;: 1,
                &quot;start&quot;: 2,
                &quot;end&quot;: 1,
                &quot;type&quot;: &quot;OWNED_BY&quot;,
                &quot;properties&quot;: {
                    &quot;startDate&quot;: &quot;2020-01-01&quot;
                }
            },
            &quot;end&quot;: {
                &quot;identity&quot;: 2,
                &quot;labels&quot;: [ &quot;Project&quot; ],
                &quot;properties&quot;: {
                    &quot;name&quot;: &quot;Quarterly Earnings&quot;
                }
            }
        },
        {
            &quot;start&quot;: {
                &quot;identity&quot;: 2,
                &quot;labels&quot;: [ &quot;Project&quot; ],
                &quot;properties&quot;: {
                    &quot;name&quot;: &quot;Quarterly Earnings&quot;
                }
            },
            &quot;relationship&quot;: {
                &quot;identity&quot;: 2,
                &quot;start&quot;: 3,
                &quot;end&quot;: 2,
                &quot;type&quot;: &quot;WORKS_ON&quot;,
                &quot;properties&quot;: {
                    &quot;startDate&quot;: &quot;2020-06-01&quot;
                }
            },
            &quot;end&quot;: {
                &quot;identity&quot;: 3,
                &quot;labels&quot;: [ &quot;Employee&quot; ],
                &quot;properties&quot;: {
                    &quot;name&quot;: &quot;Thomas Mitchell&quot;
                }
            }
        }
    ],
    &quot;length&quot;: 3.0
}
```

**Text Response**
```json
[
    {&quot;name&quot;:&quot;Sarah Bradshaw&quot;},
    {&quot;startDate&quot;:&quot;2020-01-01&quot;},
    {&quot;name&quot;:&quot;Finance&quot;},
    {&quot;name&quot;:&quot;Finance&quot;},
    {&quot;startDate&quot;:&quot;2020-01-01&quot;},
    {&quot;name&quot;:&quot;Quarterly Earnings&quot;},
    {&quot;name&quot;:&quot;Quarterly Earnings&quot;},
    {&quot;startDate&quot;:&quot;2020-06-01&quot;},
    {&quot;name&quot;:&quot;Thomas Mitchell&quot;}
]
```
As you can see, the `text` response is basically useless.  Unfortunately, that seems to be the only response value I&#39;m able to retrieve through the Neo4jClient.

### Neo4jClient Query
This is the derived Neo4jClient syntax based on the above query.  Because I could only fetch the `text` response, I&#39;m deserializing it into a `List` of type `DataNode` — a simple model that reflects the structure of the nodes and their relationships.
```javascript
client.Cypher
.Match(&quot;(from:Employee {name:\&quot;Sarah Bradshaw\&quot;})&quot;)
.Match(&quot;(to:Employee {name:\&quot;Thomas Mitchell\&quot;})&quot;)
.Call(&quot;apoc.algo.dijkstra(from, to, &#39;&#39;, &#39;d&#39;)&quot;)
.Yield(&quot;path&quot;)
.Return&lt;List&lt;DataNode&gt;&gt;(&quot;path&quot;)
.ResultsAsync
.Result;
```

### The Bottom Line
While this does get me *something*, the problem is that none of the things that make the path relevant are returned in the `text` response.  I have a collection of nodes and relationships, but I have no idea how they&#39;re interconnected.  The `table` response lists start nodes and end nodes and *that&#39;s* the information I care about.  Is there any way for me to query the `table` response rather than the `text` response?


  [1]: https://i.stack.imgur.com/WPBrM.png",1614444677,https://stackoverflow.com/q/66401154,PorkchopDonut,"['neo4j', 'neo4jclient', 'c#', 'cypher', '.net']"
66399226,How to Successfully Access Neo4j Database,"Please I am trying to configure and access the Neo4j database via its browser. I have used both bolt//:localhost:7687 and http//:localhost:7474, and Username: &quot;neo4j&quot; and Password:&quot;neo4j&quot; but with no success. I can&#39;t even start a database instance.

I have uninstalled and reinstalled Neo4j on my computer; I have updated Powershell on my Windows 8.1 computer, yet I keep getting an error message whenever I try to run the Movie database in the desktop. 

I have also looked into the log.log file, but can&#39;t seem to find anything other than that I should update Powershell, which I have done.

I have corresponded with a relations officer at Neo4j, over 30 emails, and still I can&#39;t access Neo4j database.

Could it have anything to do with my web browser? I use Mozilla Firefox.

Because I am unable to successfully connect to Neo4j database, I can&#39;t call the api in R Studio and run cypher queries.

Does Neo4j have a web version, which I could use, since the desktop version isn&#39;t working?

Please does anybody have any idea or advice on what I could do to resolve this problem? I am really exasperated right now.
",1614432078,https://stackoverflow.com/q/66399226,user5983006,"['neo4j', 'r']"
66395144,Neo4j WHERE causes duplicates?,"I&#39;m running Neo4j Desktop v1.4.1 the db is 4.2.1 enterprise.

I have a simple graph of placements, campaigns and a placement to campaign &quot;contains&quot; relationship. This is a fresh dataset, every node is unique. Some placements &quot;contain&quot; thousands of campaigns, so I want to filter the returned campaigns by an inclusion list of campaign ids.

When I return all the matched nodes it works:

    neo4j@neo4j&gt; MATCH (:Placement {id: 5})-[:CONTAINS]-&gt;(c:Campaign)
                 WHERE c.id IN [400,263,150470,25810,37578]
                 RETURN *;
    +--------------------------+
    | c                        |
    +--------------------------+
    | (:Campaign {id: 37578})  |
    | (:Campaign {id: 263})    |
    | (:Campaign {id: 25810})  |
    | (:Campaign {id: 150470}) |
    +--------------------------+

When I request just the campaign:id, I get duplicates:

    neo4j@neo4j&gt; MATCH (:Placement {id: 5})-[:CONTAINS]-&gt;(c:Campaign)
                 WHERE c.id IN [400,263,150470,25810,37578]
                 RETURN c.id;
    +--------+
    | c.id   |
    +--------+
    | 150470 |
    | 150470 |
    | 150470 |
    | 150470 |
    +--------+

There is only one CONTAINS relationship between placement 5 and campaign 15070:

    neo4j@neo4j&gt; MATCH (:Placement {id: 5})-[rel:CONTAINS]-&gt;(:Campaign {id:150470}) 
                 RETURN count(rel);
    +------------+
    | count(rel) |
    +------------+
    | 1          |
    +------------+

EXPLAIN returns the following query plan, the `cache[c.id]` seems like it might be the culprit? 

    +---------------------------+------------------------------------------------------------------------------------------------------+----------------+---------------------+
    | Operator                  | Details                                                                                              | Estimated Rows | Other               |
    +---------------------------+------------------------------------------------------------------------------------------------------+----------------+---------------------+
    | +ProduceResults@neo4j     | `c.id`                                                                                               |              4 | Fused in Pipeline 1 |
    | |                         +------------------------------------------------------------------------------------------------------+----------------+---------------------+
    | +Projection@neo4j         | cache[c.id] AS `c.id`                                                                                |              4 | Fused in Pipeline 1 |
    | |                         +------------------------------------------------------------------------------------------------------+----------------+---------------------+
    | +Expand(Into)@neo4j       | (anon_7)-[anon_27:CONTAINS]-&gt;(c)                                                                     |              4 | Fused in Pipeline 1 |
    | |                         +------------------------------------------------------------------------------------------------------+----------------+---------------------+
    | +MultiNodeIndexSeek@neo4j | UNIQUE anon_7:Placement(id) WHERE id = $autoint_0, cache[c.id], UNIQUE c:Campaign(id) WHERE id IN $a |             25 | In Pipeline 0       |
    |                           | utolist_1, cache[c.id]                                                                               |                |                     |
    +---------------------------+------------------------------------------------------------------------------------------------------+----------------+---------------------+

Edit: if I prepend the query with `CYPHER runtime=SLOTTED` I get the expected output:

    +--------+
    | c.id   |
    +--------+
    | 37578  |
    | 263    |
    | 25810  |
    | 150470 |
    +--------+

If I omit the WHERE clause I get unique campaign ids (but too many). I feel like I&#39;m missing something obvious, but I&#39;ve read the neo4j docs and I&#39;m not getting it. Thanks!
",1614394285,https://stackoverflow.com/q/66395144,David Farrell,"['neo4j', 'cypher-shell']"
66393481,How can I save multipolygon coordinates as a series of Points in Neo4j,"I am new to Neo4j and I am saving Polygon coordinates in Neo4 for area boundaries.

I have a file with geographic boundaries called geo_json_districts.json which has two objects &#39;id&#39; and &#39;coordinates&#39; (some are Polygons and some are Multipolygons.)

I am using apoc.cypher.runFirstColumnSingle to save the polygons as follows:

```
CALL apoc.load.json(&quot;file:///geo_json_districts.json&quot;) YIELD value 
MATCH (d: District {district_id: value.id}) 
SET d.district_geo_boundary_polygon = apoc.cypher.runFirstColumnSingle(&#39;UNWIND $coords AS coord RETURN COLLECT(Point({latitude: coord[1], longitude: coord[0]}))&#39;, {coords: value.coordinates[0]}) 
RETURN d
```
However I encountered the following error when the coordinates are Multipolygon...:

&quot;Neo.ClientError.Procedure.ProcedureCallFailed

Failed to invoke function `apoc.cypher.runFirstColumnSingle: Caused by: org.neo4j.exceptions.InvalidArgumentException: Cannot assign List{Double(3.504279e+01), Double(-1.417683e+01)} to field latitude&quot;`

What is a better way of saving Multipolygons.",1614377994,https://stackoverflow.com/q/66393481,W Franklin Simbeye,"['cypher', 'neo4j']"
66393089,"Neo4j server activation error, java.lang.IllegalStateException: ManagerFactory, java.io.FileNotFoundException","I tried to download neo4j today, and when I am trying to activate the server it does not work and giving me an error.
I am using neo4j-community-4.2.3 and JDK-11.0.10.

neo4j install-service completed and I typed eno4j start (no error occurred).
I tried to connect to the server with a web browser and it does not work.

I typed ```neo4j console``` and got this error

```ERROR StatusLogger RollingFileManager (C:\Program Files\neo4j-community-4.2.3\logs\debug.log) java.io.FileNotFoundException: C:\Program Files\neo4j-community-4.2.3\logs\debug.log (Access is denied)
 java.io.FileNotFoundException: C:\Program Files\neo4j-community-4.2.3\logs\debug.log (Access is denied)
        at java.base/java.io.FileOutputStream.open0(Native Method)
        at java.base/java.io.FileOutputStream.open(FileOutputStream.java:298)
        at java.base/java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:237)
        at java.base/java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:158)
        at org.neo4j.logging.shaded.log4j.core.appender.rolling.RollingFileManager$RollingFileManagerFactory.createManager(RollingFileManager.java:678)
        at org.neo4j.logging.shaded.log4j.core.appender.rolling.RollingFileManager$RollingFileManagerFactory.createManager(RollingFileManager.java:648)
        at org.neo4j.logging.shaded.log4j.core.appender.AbstractManager.getManager(AbstractManager.java:113)
        at org.neo4j.logging.shaded.log4j.core.appender.OutputStreamManager.getManager(OutputStreamManager.java:100)
        at org.neo4j.logging.shaded.log4j.core.appender.rolling.RollingFileManager.getFileManager(RollingFileManager.java:205)
        at org.neo4j.logging.shaded.log4j.core.appender.RollingFileAppender$Builder.build(RollingFileAppender.java:146)
        at org.neo4j.logging.log4j.LogConfig.createRollingFileAppender(LogConfig.java:183)
        at org.neo4j.logging.log4j.LogConfig.getAppender(LogConfig.java:152)
        at org.neo4j.logging.log4j.LogConfig.configureLogging(LogConfig.java:105)
        at org.neo4j.logging.log4j.LogConfig$Builder.build(LogConfig.java:290)
        at org.neo4j.graphdb.factory.module.GlobalModule.createLogService(GlobalModule.java:337)
        at org.neo4j.graphdb.factory.module.GlobalModule.&lt;init&gt;(GlobalModule.java:174)
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.createGlobalModule(DatabaseManagementServiceFactory.java:252)
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.build(DatabaseManagementServiceFactory.java:126)
        at org.neo4j.server.CommunityBootstrapper.createNeo(CommunityBootstrapper.java:36)
        at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:134)
        at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:90)
        at org.neo4j.server.CommunityEntryPoint.main(CommunityEntryPoint.java:35)
2021-02-26 21:16:37.044+0000 ERROR Failed to start Neo4j on dbms.connector.http.listen_address, a socket address. If missing port or hostname it is acquired from dbms.default_listen_address.
java.lang.IllegalStateException: ManagerFactory [org.neo4j.logging.shaded.log4j.core.appender.rolling.RollingFileManager$RollingFileManagerFactory@375b5b7f] unable to create manager for [C:\Program Files\neo4j-community-4.2.3\logs\debug.log] with data [org.neo4j.logging.shaded.log4j.core.appender.rolling.RollingFileManager$FactoryData@1813f3e9[pattern=C:\Program Files\neo4j-community-4.2.3\logs\debug.log.%i, append=true, bufferedIO=true, bufferSize=8192, policy=SizeBasedTriggeringPolicy(size=20971520), strategy=DefaultRolloverStrategy(min=1, max=7, useMax=false), advertiseURI=null, layout=org.neo4j.logging.log4j.Neo4jLogLayout@28cb9120, filePermissions=null, fileOwner=null]]
        at org.neo4j.logging.shaded.log4j.core.appender.AbstractManager.getManager(AbstractManager.java:115) ~[neo4j-logging-4.2.3.jar:4.2.3]
        at org.neo4j.logging.shaded.log4j.core.appender.OutputStreamManager.getManager(OutputStreamManager.java:100) ~[neo4j-logging-4.2.3.jar:4.2.3]
        at org.neo4j.logging.shaded.log4j.core.appender.rolling.RollingFileManager.getFileManager(RollingFileManager.java:205) ~[neo4j-logging-4.2.3.jar:4.2.3]
        at org.neo4j.logging.shaded.log4j.core.appender.RollingFileAppender$Builder.build(RollingFileAppender.java:146) ~[neo4j-logging-4.2.3.jar:4.2.3]
        at org.neo4j.logging.log4j.LogConfig.createRollingFileAppender(LogConfig.java:183) ~[neo4j-logging-4.2.3.jar:4.2.3]
        at org.neo4j.logging.log4j.LogConfig.getAppender(LogConfig.java:152) ~[neo4j-logging-4.2.3.jar:4.2.3]
        at org.neo4j.logging.log4j.LogConfig.configureLogging(LogConfig.java:105) ~[neo4j-logging-4.2.3.jar:4.2.3]
        at org.neo4j.logging.log4j.LogConfig$Builder.build(LogConfig.java:290) ~[neo4j-logging-4.2.3.jar:4.2.3]
        at org.neo4j.graphdb.factory.module.GlobalModule.createLogService(GlobalModule.java:337) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.graphdb.factory.module.GlobalModule.&lt;init&gt;(GlobalModule.java:174) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.createGlobalModule(DatabaseManagementServiceFactory.java:252) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.build(DatabaseManagementServiceFactory.java:126) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.server.CommunityBootstrapper.createNeo(CommunityBootstrapper.java:36) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:134) [neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:90) [neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.server.CommunityEntryPoint.main(CommunityEntryPoint.java:35) [neo4j-4.2.3.jar:4.2.3]
2021-02-26 21:16:37.075+0000 INFO  Neo4j Server shutdown initiated by request
2021-02-26 21:16:37.075+0000 INFO  Stopped.",1614375359,https://stackoverflow.com/q/66393089,daniel zimlichman,"['filenotfoundexception', 'neo4j', 'port', 'illegalstateexception']"
66391942,Neo4j LOAD CSV record processed sequence,"I&#39;ve been using `LOAD CSV` for some time now with `neo4j` to `import` data but I think, not sure, I noticed that the `LOAD CSV` will start importing rows from the bottom of the `csv` file.

Or is it completely random?

I&#39;m trying to create an `(org)-[:has_suborg]-&gt;(subOrg)` relationship while I&#39;m processing each row but I want to make sure that the parent `orgs` are created first to avoid `exceptions/errors` when a sub is attempted to be related to a parent org and the parent org is not present yet.

If rows are processed from the top or the bottom I can then make sure that my `csv` records are already sorted the way I want them processed.

Thanks in advance",1614368739,https://stackoverflow.com/q/66391942,Rakos,"['csv', 'import', 'neo4j']"
66390737,Certain node connections are not persisting in Neo4j via SpringData,"Im very new to Java and Spring, so im trying to make a simple app that add vehicle measurements to a vehicle in a linked list style:

[![Desired Structure][1]][1]

Ive had a lot of trouble figuring out whether to use the neo4j.ogm annotations of the springframework.data.neo4j annotations. Currently im settled on the springframework annotations because the ogm ones cause an improper Id execption. In my code snippets i consolidated like members into the same snippet to reduce redundancy.

Here is my build.gradle:
```
plugins {
	id &#39;org.springframework.boot&#39; version &#39;2.4.3&#39;
	id &#39;io.spring.dependency-management&#39; version &#39;1.0.11.RELEASE&#39;
	id &#39;java&#39;
}

group = &#39;com.example&#39;
version = &#39;0.0.1-SNAPSHOT&#39;
sourceCompatibility = &#39;11&#39;

repositories {
	mavenCentral()
}

dependencies {
	implementation &#39;org.springframework.boot:spring-boot-starter-data-neo4j&#39;
	implementation &#39;org.springframework.boot:spring-boot-starter-web&#39;
	testImplementation &#39;org.springframework.boot:spring-boot-starter-test&#39;

	compileOnly &#39;org.projectlombok:lombok&#39;
	annotationProcessor &#39;org.projectlombok:lombok&#39;
}

test {
	useJUnitPlatform()
}
```

Here is my application root:
```
package com.example.neo4j;

import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.data.neo4j.repository.config.EnableNeo4jRepositories;

@SpringBootApplication
@EnableNeo4jRepositories
public class Test2Application {

	public static void main(String[] args) {
		SpringApplication.run(Test2Application.class, args);
	}

	@Bean
	CommandLineRunner demo(VehicleRepository vehicleRepository, VehicleMeasurementRepository vehicleMeasurementRepository, VehicleMeasurementService vehicleMeasurementService) {
		return args -&gt; {
			vehicleRepository.deleteAll();
			vehicleMeasurementRepository.deleteAll();

			Vehicle vehicle = new Vehicle(&quot;vin&quot;, &quot;Ford&quot;, &quot;Bronco&quot;);
			vehicleRepository.save(vehicle);

			VehicleMeasurement first = new VehicleMeasurement(5D, 198D, 100D);
			VehicleMeasurement second = new VehicleMeasurement(10D, 198D, 98D);
			VehicleMeasurement third = new VehicleMeasurement(15D, 198D, 97D);

			vehicleMeasurementService.addNewMeasurementByVin(&quot;vin&quot;, third);
			vehicleMeasurementService.addNewMeasurementByVin(&quot;vin&quot;, second);
			vehicleMeasurementService.addNewMeasurementByVin(&quot;vin&quot;, first);
		};
	}
}

```
Here are my Entities:
```
package com.example.neo4j;

import lombok.Data;
import lombok.NoArgsConstructor;
import com.fasterxml.jackson.annotation.JsonIgnoreProperties;

import org.springframework.data.neo4j.core.schema.GeneratedValue;
import org.springframework.data.neo4j.core.schema.Id;
import org.springframework.data.neo4j.core.schema.Node;
import org.springframework.data.neo4j.core.schema.Relationship;


@Data
@Node
@NoArgsConstructor
public class Vehicle {

    @Id @GeneratedValue
    private Long id;

    private String vin, make, model;

    public Vehicle(String vin, String make, String model) {
        this.vin = vin;
        this.make = make;
        this.model = model;
    }


    @Relationship(type = &quot;HAS_HEAD_MEASUREMENT&quot;, direction = Relationship.Direction.OUTGOING)
    @JsonIgnoreProperties({&quot;next&quot;, &quot;previous&quot;})
    private VehicleMeasurement head;


    @Relationship(type = &quot;HAS_TAIL_MEASUREMENT&quot;, direction = Relationship.Direction.OUTGOING)
    @JsonIgnoreProperties({&quot;next&quot;, &quot;previous&quot;})
    private VehicleMeasurement tail;
    public VehicleMeasurement getHead() {
        return head;
    }
}

@Node
@Data
@NoArgsConstructor
public class VehicleMeasurement {

    @Id @GeneratedValue
    private Long id;

    private Double mileage, engineTemperature, oilLife;

    public VehicleMeasurement(Double mileage, Double engineTemperature, Double oilLife) {
        this.mileage = mileage;
        this.engineTemperature = engineTemperature;
        this.oilLife = oilLife;
    }

    @Relationship(type = &quot;NEXT&quot;, direction = Relationship.Direction.OUTGOING)
    @JsonIgnoreProperties({&quot;head&quot;, &quot;tail&quot;, &quot;vehicleHeadReference&quot;, &quot;vehicleTailReference&quot;})
    private VehicleMeasurement next;
}
```
Here are my Repositories:
```
package com.example.neo4j;

import org.springframework.data.neo4j.repository.Neo4jRepository;
import org.springframework.data.neo4j.repository.query.Query;

import java.util.List;

public interface VehicleRepository extends Neo4jRepository&lt;Vehicle, Long&gt; {
    Vehicle findVehicleByVin(String vin);
}

public interface VehicleMeasurementRepository extends Neo4jRepository&lt;VehicleMeasurement, Long&gt; {

    @Query(&quot;MATCH (v:Vehicle {vin: $vin})-[*]-&gt;(vm:VehicleMeasurement)-[*]-(v)&quot; +
            &quot;RETURN DISTINCT vm ORDER BY vm.mileage ASCENDING&quot;)
    List&lt;VehicleMeasurement&gt; findVehicleMeasurementsByVehicleVin(String vin);
}
```
And here is my service:
```
package com.example.neo4j;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.Iterator;
import java.util.Optional;

@Service
public class VehicleMeasurementService {

    @Autowired
    VehicleMeasurementRepository vehicleMeasurementRepository;

    @Autowired
    VehicleRepository vehicleRepository;

    public void addNewMeasurementByVin(String vin, VehicleMeasurement measurement) {
        Vehicle targetVehicle = vehicleRepository.findVehicleByVin(vin);

        Iterator&lt;VehicleMeasurement&gt; vehicleMeasurements = vehicleMeasurementRepository.findVehicleMeasurementsByVehicleVin(vin).iterator();

        Optional&lt;VehicleMeasurement&gt; left = Optional.empty();
        Optional&lt;VehicleMeasurement&gt; right = Optional.empty();

        while (vehicleMeasurements.hasNext()) {
            var next = vehicleMeasurements.next();

            if (next.getMileage() &lt;= measurement.getMileage()) {
                left = Optional.of(next);
            }

            if (measurement.getMileage() &lt;= next.getMileage() &amp;&amp; right.isEmpty()) {
                right = Optional.of(next);
            }
        }

        if (left.isEmpty() &amp;&amp; right.isEmpty()){
            targetVehicle.setHead(measurement);
            targetVehicle.setTail(measurement);
        } else if (left.isEmpty()) {
            targetVehicle.setHead(measurement);
            measurement.setNext(right.get());
            vehicleMeasurementRepository.save(right.get());
        } else if (right.isEmpty()) {
            VehicleMeasurement leftValue = left.get();
            leftValue.setNext(measurement);
            vehicleMeasurementRepository.save(leftValue);
            targetVehicle.setTail(measurement);
        }

        vehicleMeasurementRepository.save(measurement);
        vehicleRepository.save(targetVehicle);
    }
}
```
I run the add method 3 times and debug between them to see these results:

[![result after first rendition][2]][2]&lt;br/&gt;
[![enter image description here][3]][3]&lt;br/&gt;
[![enter image description here][4]][4]&lt;br/&gt;

The last picture is the problem, when I drill into the nodes during debugging I see the references I expect but then it finishes running the connection between node 98 and node 97 does not persist. 

Any advice would be greatly appreciated, stylewise, useage, or method anything helps. I anticipate im using the spring data incorrectly. I tried a rendition with two way references and it would blow the stack, even with my ignore properties annotation. 

  [1]: https://i.stack.imgur.com/nyYK7.png
  [2]: https://i.stack.imgur.com/ydFJx.png
  [3]: https://i.stack.imgur.com/vBg9O.png
  [4]: https://i.stack.imgur.com/J3Wq5.png",1614362587,https://stackoverflow.com/q/66390737,Connor Campbell,"['spring', 'java', 'neo4j', 'spring-data', 'spring-boot']"
66387655,Neo4j Docker: http-post returns error EOF,"I wrote a service which purpose is to archive some sort of data every 10s.
My problem is that after aprox. 3-4 hours the service is no longer capable of writing to the neo4j-docker datatbase.
I&#39;m confident that I am closing the connection the right way. Strangely after restarting the neo4j-docker everything is back to normal, as it supposed to be.
I&#39;m wondering if that is some sort of limitation of the community-version of neo4j, if so it would be really nice to tell me.
Or do I need to modify a parameter of the linux image neo4j is running in, some sort of max. connections setting?

I am providing the followinng params as headers to the post:

   
     {
    	&quot;Content-Type&quot;: &quot;application/json&quot;	
        &quot;Connection&quot;:   &quot;close&quot;
     }

After committing the request, I&#39;m closing the connection.

Client Side Error Message:

    Post &quot;http://192.168.178.55:7474/db/neo4j/tx/commit&quot;: EOF

Neo4j Errror Log:

    Caused by: java.lang.OutOfMemoryError: Java heap space
    
    2021-02-25 00:44:47.908+0000 WARN /db/neo4j/tx/commit


",1614349861,https://stackoverflow.com/q/66387655,L. Busekrus,"['http-headers', 'docker', 'http-post', 'neo4j']"
66387073,Shortest path between a source and multiple destinations,"I have a Neo4j graph which looks like this

[![enter image description here][1]][1]


It has a hierarchy of relations using the CHILD_OF relationship.&lt;br/&gt;
All the green nodes (see) are entitlements on Books.&lt;br/&gt;
All the books which a parent can see are also visible to the child but not the other way round.&lt;br/&gt;
Also, there is a possibility for child to see the books directly without involving the parent.&lt;br/&gt;&lt;br/&gt;

The ask here is to find the shortest path from the Child to the books.&lt;br/&gt;
In this case C1 has 2 paths (via entitlements) to Book1 but only 1 to Book2. And none to Book3.&lt;br/&gt;

[![enter image description here][2]][2]

The Neo4j Cypher query should return only the shortest paths from C1 to all the books.&lt;br/&gt;

I tried using the Neo4j shortestPath function but it does not work.&lt;br/&gt;

    MATCH (c:Child {name:&#39;C1&#39;} ),
      (b:Book),
      p = shortestPath((c)-[*]-(b))
    RETURN p


Output of this query returns this:

[![enter image description here][3]][3]

Desired final graph should look like this:

[![enter image description here][4]][4]


  [1]: https://i.stack.imgur.com/2fCyK.png
  [2]: https://i.stack.imgur.com/Ryz5n.png
  [3]: https://i.stack.imgur.com/3q5ZR.png
  [4]: https://i.stack.imgur.com/xCwoh.png",1614347750,https://stackoverflow.com/q/66387073,Amit,"['graph', 'cypher', 'neo4j']"
66385714,Visualizing the cluster doesn&#39;t give me the expected result,"I got the cluster using WCC:

When I do `groupSize&gt;2` I ended up getting nodes without any link.

    MATCH (c:User)
    WITH c.clusterGroup AS fpGroupID, collect(id(c)) AS fGroup
    WITH *, size(fGroup) AS groupSize WHERE groupSize &gt; 2 
    WITH collect(fpGroupID) AS cRings
    MATCH p=(c:User)-[:REL]-&gt;()
    WHERE c.clusterGroup IN cRings
    
    RETURN p
----------------


[![enter image description here][1]][1]

But when I do `groupSize=2` or `groupSize&lt;=2` or `groupSize &lt;=6 and groupSize &gt;= 1`

I get:

[![enter image description here][2]][2]

Note I am getting edges also.



but why does it fails for `groupSize &gt; threshold` i.e `&gt;` or `&gt;=` sign

**Cluster Data:**

[![enter image description here][3]][3]


  [1]: https://i.stack.imgur.com/BV8mH.png
  [2]: https://i.stack.imgur.com/g3Nwt.png
  [3]: https://i.stack.imgur.com/45H1T.png

## Note: I have kept the `connect result nodes` as `off`.",1614341881,https://stackoverflow.com/q/66385714,Pygirl,['neo4j']
66384416,Cast massive properties Neo4j,"I have a Neo4j relationship with a set of properties: [&#39;PROPERTY1&#39;, &#39;PROPERTY2&#39;, PROPERTY3&#39;, ...]. I use the method below to cast a string to int.

I should cast all properties into the list from string to int. What is an efficient way to cast massive properties?
``` 
        CALL apoc.periodic.commit(
        &quot;MATCH ()-[r:RELATED_TO]-&gt;()
        WHERE r.PROPERTY1 = toString(r.PROPERTY1)
        WITH r LIMIT $limit	
        set r.PROPERTY1 = toInteger(r.PROPERTY1)				   
        RETURN count(*)&quot;, 
        {limit : 5000})
",1614336591,https://stackoverflow.com/q/66384416,Nicolapo,"['database', 'neo4j-apoc', 'cypher', 'neo4j', 'graph']"
66384332,Post request is blocking get request nodejs,"I&#180;m trying to add and authetication user model for my Neo4j-database, but I&#180;m having a problem while implementing it. 
I&#180;ve built an nodejs web-app for managing the data of this Neo4j-database and it works without error, but while implementing a .post request for authentication users the following web-app get request crashed not getting the data and my index.js showing that the variable is empty. I think, that this is due to the blockade of the get requested.

Can you help me and give me a hint.
Thank you.
This is the error shown in index.j:

```ReferenceError: C:\Users\ILC\Desktop\EuQu\views\index.ejs:78
    76|     &lt;/thead&gt;

    77|     &lt;tbody&gt;

 &gt;&gt; 78|      &lt;% variables.forEach(function(variable){ %&gt;

    79|       &lt;tr class=&quot;table-warning&quot;&gt;

    80|         &lt;th scope=&quot;row&quot;&gt;&lt;%= variable.id %&gt;&lt;/th&gt;

    81|         &lt;td&gt;


variables is not defined
    at eval (C:\Users\ILC\Desktop\EuQu\views\index.ejs:38:8)
    at index (C:\Users\ILC\Desktop\EuQu\node_modules\ejs\lib\ejs.js:682:17)
    at tryHandleCache (C:\Users\ILC\Desktop\EuQu\node_modules\ejs\lib\ejs.js:254:36)
    at View.exports.renderFile [as engine] (C:\Users\ILC\Desktop\EuQu\node_modules\ejs\lib\ejs.js:485:10)
    at View.render (C:\Users\ILC\Desktop\EuQu\node_modules\express\lib\view.js:135:8)
    at tryRender (C:\Users\ILC\Desktop\EuQu\node_modules\express\lib\application.js:640:10)
    at Function.render (C:\Users\ILC\Desktop\EuQu\node_modules\express\lib\application.js:592:3)
    at ServerResponse.render (C:\Users\ILC\Desktop\EuQu\node_modules\express\lib\response.js:1012:7)
    at C:\Users\ILC\Desktop\EuQu\app.js:52:13
    at processTicksAndRejections (internal/process/task_queues.js:93:5)
```",1614336295,https://stackoverflow.com/q/66384332,Artur,"['ejs', 'neo4j', 'node.js']"
66374703,Neo4j graph algorithm / Node similarity,"Suppose this graph down below.

I have a job which requires some skills,  and with this list of skills i am searching for candidates knows the skills (i mean the set of skills required by a specific job).
This is the easy part.

The relationships have an attribute years_of_experience. The correct results requires an where candidate.years_of_experience&gt;= skill.years_of_experience.
I would like to use a procedure like this
```gds.nodeSimilarity```
for having a list of candidates and similarity for each of them.
may i have some help with this query because i tryied but no luck till now

[Graph example][1]


  [1]: https://i.stack.imgur.com/kbN1c.jpg

Example:

    MATCH aa= (job:JobNode{job_id:&#39;feed85b9-041c-4bb5-b48a-963c9f927e1d&#39;})-[r:REQUIRES]-&gt;(s:SkillNode) 
    with job 
    MATCH bb= (job:JobNode{job_id:&#39;feed85b9-041c-4bb5-b48a-963c9f927e1d&#39;})-[r:REQUIRES]-&gt;(s:SkillNode)&lt;-[:KNOWS]-(c:CandidateNode) 
    WITH {item:id(job), categories: collect(id(c))} AS userData 
    WITH collect(userData) AS data 
    CALL gds.alpha.ml.ann.stream({ data: data, algorithm: &#39;jaccard&#39; }) 
    YIELD item1, item2, similarity 
    return data",1614279085,https://stackoverflow.com/q/66374703,Manos Nathanail,['neo4j']
66374102,Can&#39;t create unique constraint in Neo4J,"I am attempt to create a constraint like this:

    CREATE CONSTRAINT ON (a:forecast) ASSERT a.match IS UNIQUE

but I get this error:

&gt; Unable to create Constraint( name=&#39;constraint_9615361a&#39;,
&gt; type=&#39;UNIQUENESS&#39;, schema=(:forecast {match}) ):

I have the Neo4J community edition 4.2.3, but judging by the documentation I should be allowed to create this type of constraint. What gives?
",1614276485,https://stackoverflow.com/q/66374102,Mike Furlender,"['cypher', 'neo4j']"
66368424,Get the last created thing among siblings in neo4j,"How do you retrieve a list of the newest NODE in a path in neo4j? The DISTINCT operator doesn&#39;t seem to do what I want.

There is a structure something like this: 

    (n1) - [reln1 cratedAt:&quot;1&quot; something:&quot;not42&quot;] -&gt; ( target )
    
    (n1) - [reln2 cratedAt:&quot;2&quot; something:&quot;42&quot;] -&gt; ( target )
    
    (n2) - [reln3 cratedAt:&quot;1&quot; something:&quot;not42&quot;] -&gt; ( target )
    
    (n2) - [reln4 cratedAt:&quot;3&quot; something:&quot;42&quot;] -&gt; ( target )

    (n2) - [reln5 cratedAt:&quot;2&quot; something:&quot;not42&quot;] -&gt; ( target )

The issue is that there are an unknown number of parallel relations (or paths) between n1,n2 and target.

Trying to get the query to RETURN the structures with rel2 and rel4 as follows because createdAt is the latest from n1 and n2 respectively. Query should return:

    (n2) - [reln4 cratedAt:&quot;3&quot; something:&quot;42&quot;] -&gt; ( target )
    (n1) - [reln2 cratedAt:&quot;2&quot; something:&quot;42&quot;] -&gt; ( target )


I&#39;m looking for relationships or nodes that are carrying weights symbolized by something:42 in this example. What am I missing? Can&#39;t this be done in one query? Would it help if they were nodes instead of relationships?

    MATCH (node)-[rel]-&gt;(target)
    RETURN DISTINCT node
    ORDER BY rel.createdAt
    LIMIT 10

To make this work I&#39;d need to first order by createdAt, then pick the latest, then return one per node. How?

EDIT: It seems the answers are valid for this structure when created at on relationship - but I can&#39;t figure out how to generalize it to longer paths with the createdAt property on a node in the middle. Tricky problem.

There is hard to generalize structure that looks something like this: 

    (O1:Start)-[]-&gt; (mid1:n1 cratedAt:&quot;1&quot; something:&quot;not42&quot;) - [reln1 ] -&gt; ( target )
    
    (O1:Start)-[]-&gt; (mid2:n1 cratedAt:&quot;2&quot; something:&quot;42&quot;) - [reln2 ] -&gt; ( target )
    
    (O2:Start)-[]-&gt; (mid3:n2 cratedAt:&quot;1&quot; something:&quot;not42&quot;) - [reln3 ] -&gt; ( target )
    
    (O2:Start)-[]-&gt; (mid4:n2 cratedAt:&quot;3&quot; something:&quot;42&quot;) - [reln4 ] -&gt; ( target )

    (O2:Start)-[]-&gt; (mid5:n2 cratedAt:&quot;2&quot; something:&quot;not42&quot;) - [reln5 ] -&gt; ( target )

Query should RETURN

    (O1:Start)-[]-&gt; (mid2:n1 cratedAt:&quot;2&quot; something:&quot;42&quot;) - [reln2 ] -&gt; ( target )
    (O2:Start)-[]-&gt; (mid4:n2 cratedAt:&quot;3&quot; something:&quot;42&quot;) - [reln4 ] -&gt; ( target )

What I was going for was that labels n1 and n2 are siblings - not just the rel1 rel2 rel3 etc. Is there a better way to manage duplicates by different sources and then query to find the &#39;right&#39; one?",1614255839,https://stackoverflow.com/q/66368424,heorling,"['distinct', 'neo4j', 'unique']"
66367155,Recursively find all connected nodes and relationships between them starting with one given node in Neo4J PHP/JS,"I&#39;m writing this code in PHP/JS and using a Neo4J graph database.
I&#39;m aware the title isn&#39;t that clear so I&#39;ll elaborate:

Let&#39;s say I have node A in my database. Node A is connected to node B and node C.
I have a function as part of an API that returns the nodes connected to node A and the name/type of relationship between A and them.
So in the aforementioned case, my function will return:

        [
        {
            &quot;name&quot;: &quot;B&quot;,
            &quot;description&quot;: &quot;abc&quot;,
            &quot;relationship&quot;: &quot;r1&quot;
        },
        {
            &quot;name&quot;: &quot;C&quot;,
            &quot;description&quot;: &quot;bca&quot;,
            &quot;relationship&quot;: &quot;r2&quot;
        }
       ]

   Problem is that nodes B and C might be connected to some other nodes too. And each one of said other nodes might be connected to a multitude of other nodes as well. So basically I wanna get all this info knowing the &quot;start&quot; node, in this case A, till nothing is connected to anything anymore.

I&#39;m aware that there are simple one line queries to get all connected nodes to a master node in Neo4J but I need to represent this data hierarchically, as in something like that:

A:
 -has relationship w with B
 B :
   -has relationship y with X
   X:
     -has relationship e with Q
   -has relationship z with O
 -has relationship u with C

A would be connected directly to B and C, B to X and O, X to Q 

I tried an iterative approach but I had no luck at all, I think the only way to do this would be recursively but I&#39;ve got no idea how.

Thanks in advance!

",1614250612,https://stackoverflow.com/q/66367155,Jerome Durham,"['php', 'neo4j', 'graph-databases', 'cypher', 'nodes']"
66363678,Setting up Relationship types in GrandStack,"I am trying to setup a relationship type in Grandstack. I am having issues getting things to run correctly.  Even when I copy the guide into my project and try to run it ... things do not work. Here is what they have at https://grandstack.io/docs/guide-graphql-schema-design


```
type Actor {
    actorId: ID!
    name: String
    movies: [Movie] @relation(name: &quot;ACTED_IN&quot;, direction: OUT)
}

type Movie {
    movieId: ID!
    title: String
    description: String
    year: Int
    actors(limit: Int = 10): [Actor] @relation(name: &quot;ACTED_IN&quot;, direction: IN)
    similarMovies(limit: Int = 10): [Movie] @cypher(statement: &quot;&quot;&quot;
        MATCH (this)&lt;-[:ACTED_IN]-(:Actor)-[:ACTED_IN]-&gt;(rec:Movie)
        WITH rec, COUNT(*) AS score ORDER BY score DESC
        RETURN rec LIMIT $limit
    &quot;&quot;&quot;)
}

type User {
    userId: ID!
    name: String
    rated: [Rated]
}

type Rated @relation(name: &quot;RATED&quot;) {
    from: User
    to: Movie
    rating: Float
    review: String
}
```
The problem is when I run this I get the following error:

```
ApolloError: The &#39;from&#39; argument of the @relation directive on the _UserRated type is &quot;User&quot;, but a &quot;User&quot; field is not defined.
    at validateRelationTypeNodeField (/Users/kennyv/git/skoutal-server/node_modules/neo4j-graphql-js/dist/augment/types/relationship/relationship.js:221:13)
    at validateRelationTypeDirective (/Users/kennyv/git/skoutal-server/node_modules/neo4j-graphql-js/dist/augment/types/relationship/relationship.js:183:5)
```


Not sure why it thinks the User field is not defined.
Here is my server.js file
```
require(&quot;dotenv&quot;).config();
const { ApolloServer, PubSub } = require(&quot;apollo-server&quot;);
const jwt = require(&quot;jsonwebtoken&quot;);
const neo4j = require(&quot;neo4j-driver&quot;);
const { augmentSchema, makeAugmentedSchema } = require(&quot;neo4j-graphql-js&quot;);
const typeDefs = require(&quot;./graphql/typeDefs.js&quot;);
const resolvers = require(&quot;./graphql/resolvers&quot;);

require(&quot;console-stamp&quot;)(console, { pattern: &quot;mm/dd/yyyy HH:MM:ss.l&quot; });
// Create an instance of Express

const pubsub = new PubSub();
const PORT = process.env.PORT || 5000;
const schema = makeAugmentedSchema({
  typeDefs,
  resolvers,
  // config: {
  //   query: true,
  //   mutation: true,
  // },
});
const augmentedSchema = augmentSchema(schema);

const driver = neo4j.driver(
  process.env.NEO4J_URI || &quot;bolt://localhost:7687&quot;,
  neo4j.auth.basic(
    process.env.NEO4J_USER || &quot;neo4j&quot;,
    process.env.NEO4J_PASSWORD || &quot;neo4j&quot;
  )
);

const server = new ApolloServer({
  schema: schema,
  context: ({ req }) =&gt; {
    const token = req?.headers?.authorization?.slice(7);
    let userId;
    if (token) {
      const decoded = jwt.verify(token, process.env.APP_SECRET);
      userId = decoded.id;
    }
    return {
      cypherParams: { userId },
      driver,
      neo4jDatabase: process.env.NEO4J_DATABASE,
      req,
      pubsub,
    };
  },
});
```
```
&quot;apollo-server&quot;: &quot;^2.20.0&quot;,
&quot;graphql&quot;: &quot;^15.5.0&quot;,
&quot;neo4j-driver&quot;: &quot;^4.2.2&quot;,
&quot;neo4j-graphql-js&quot;: &quot;^2.19.2&quot;,
```",1614235877,https://stackoverflow.com/q/66363678,Kenny Votava,"['javascript', 'grandstack', 'neo4j', 'graphql']"
66362839,Neo4j Cypher - How to limit 50% of MATCH results,"I want to limit by 50% of results from `MATCH` but it looks like `LIMIT` doesn&#39;t accept dynamic value.

I tried:
```neo4j
MATCH (:Profile) 
WITH COUNT(*) AS c
MATCH (n:Profile)
WITH n ORDER BY rand() LIMIT toInt(c * 0.5) 
RETURN n
```
Then I got the error: 
```
It is not allowed to refer to variables in LIMIT
```
So is there any way to do that without using 2 separate queries?",1614230573,https://stackoverflow.com/q/66362839,Kien Nguyen,"['cypher', 'limit', 'neo4j']"
66362000,Trying to get relationships with unique endpoints from Neo4j Cypher query,"I have nodes present in the graph like this:

    (A)-[relationship1]-&gt;(object)-[relationship2]-&gt;(B)

Searching for this brings up 1000s of matches. 
What I&#39;m trying to get is return (A) when number of UNIQUE Bs is greater than 25.

",1614223955,https://stackoverflow.com/q/66362000,Ian,['neo4j']
66357364,java.lang.IllegalArgumentException: Unsupported type [TEXT] of value String,"I have a simple graph that looks like this (a couple of persons that gave reviews to movies)

    (p: Person)-[r: review {rating}]-&gt;(m: Movie)

I want to create a graph accordantly the exemple from [GDS Node Similarity][1] and I use this:

   

     CALL gds.graph.create(
        &#39;myGraph&#39;,
        [&#39;Person&#39;, &#39;Movie&#39;],
        {
            review: {
                type: &#39;review&#39;,
                properties: {
                    rating: {
                        property: &#39;rating&#39;,
                        defaultValue: 1.0
                    }
                }
            }
        }
    );

When I try this I get the next exception: 

    Failed to invoke procedure `gds.graph.create`: Caused by: java.lang.IllegalArgumentException: Unsupported type [TEXT] of value String(&quot;4&quot;). Please use a numeric property.


I can&#39;t find any useful information in the logs why I&#39;m getting this exception. Any ideas about what I&#39;m doing wrong?

  [1]: https://neo4j.com/docs/graph-data-science/current/algorithms/node-similarity/",1614193848,https://stackoverflow.com/q/66357364,S. Florin,"['cypher', 'neo4j']"
66349401,Combining multiple nodes into one and map all the relations to that node neo4j,"I have a sellers node and buyers node with the same business name.

When I try to match using the code:

    MATCH (p:Sellers)-[rel:sells]-&gt;(o:Buyers)
  
    RETURN p, rel, o; 

It returns the graph :
[![01AAAC is present twice(As a seller and a buyer) in this graph][1]][1]

and the data :

    p,rel,o
    
    {&quot;Seller&quot;:01AAAC}&quot;,&quot;{&quot;&quot;invoices&quot;:5}&quot;,&quot;{&quot;Buyer&quot;:03AAAG}
    
    {&quot;Seller&quot;:01AAXP}&quot;,&quot;{&quot;invoices&quot;:8}&quot;,&quot;{&quot;Buyer&quot;:01AAAC}
    
    {&quot;Seller&quot;:27AAFF}&quot;,&quot;{&quot;invoices&quot;:2}&quot;,&quot;{&quot;Buyer&quot;:01AAAC}

But I&#39;m trying to create rather a graph like this :

[![01AAAC is present only once in this graph][2]][2]

Can you kindly help me with an appropriate cypher query to create the above visualisation.
Thanks a lot in advance.

  [1]: https://i.stack.imgur.com/Ai9st.png
  [2]: https://i.stack.imgur.com/618U3.png",1614164014,https://stackoverflow.com/q/66349401,Sasi,"['neo4j', 'cypher']"
66344369,Can I run Flask and Neo4j in the same container?,"I am new to the Docker world. My folder looks like the following:

```
app/
   __init__.py
   api.py
   data_loader.py
```
First I run `data_loader.py` to load data to a Neo4j database.
Then I start the flask server as `python -m app.api`.

The flask API expects a local Neo4j db, so I want both flask and Neo4j in same Docker container.  How do I go about this?  I am confused by the differences between the Dockerfile and Docker Compose.",1614137915,https://stackoverflow.com/q/66344369,frazman,"['docker', 'python', 'flask', 'neo4j']"
66342196,Neo4j cypher query results into Pandas DataFrame,"I am trying to read the csv file which have nodes ids and their respective relation between them. First two columns represent nodes and third colum represents the relation between them. So far I am able to create the database in neo4j but I am not sure what would be the cypher query to fetch the desired data into pandas DataFrame! 

I will use the subset of large dataset here to illustrate my problem. Original dataset contains thousands of nodes and relations. 

**My csv file(Node1_id, Node2_id, relation_id) looks like this:** 

    0	1	1
    4	2	1
    44	3	1
    0	4	1
    0	5	1
    4	10173	3
    4	10191	2
    4	10192	2
    6	10193	2
    8	10194	2
    3	10195	2
    6	10196	2

Here is the nodes creation and defining the relation between the nodes by loading the ids from a csv file. (I suppose this graph is correct but let me know if you notice any problem )
I am assigning one property &quot;id&quot; for nodes and relation using their ids from the csv file. 

    LOAD CSV WITH HEADERS FROM  &#39;file:///edges.csv&#39; AS row FIELDTERMINATOR &quot;,&quot;
    WITH row
    WHERE row.relation_id = &#39;1&#39;
    MERGE (paper:Paper{id:(row.Node1_id)})
    MERGE (author:Author{id:(row.Node2_id)})
    CREATE (paper)-[au:AUTHORED{id: &#39;1&#39;}]-&gt;(author);


So far i have tried something like this: 

        query = &#39;&#39;&#39; MATCH (paper)-[au:AUTHORED{id: &#39;1&#39;}]-&gt;(author) RETURN paper,author LIMIT 3; &#39;&#39;&#39; 
        result = session.run(query)
        df = DataFrame(result)

        for dataF in df.itertuples(index=False):
        print(row)

**It returns this:** 

    0	1
    0	(id)	(id)
    1	(id)	(id)
    2	(id)	(id)

**Desired results:** 

I want results into pandas DataFrame in the format with nodes ids and relation ids such as defined in csv above by querying the data from graphDB and iterate the results row by row. 
 
    0	1	1
    4	2	1
    44	3	1
    0	4	1
    0	5	1
    4	10173	3
    4	10191	2
    4	10192	2
    6	10193	2
    8	10194	2
    3	10195	2
    6	10196	2

I am also interested into know what is the return type of an cypher query object in this case it is `pandas.core.frame.DataFrame` but how can I access the induvial properties of nodes and relation during the cypher query. This is the main problem. 

Please feel free to explain in detail, I would really appreciate the help. 


Using neo4j Version: 4.2.1",1614120426,https://stackoverflow.com/q/66342196,Sniper,"['neo4j', 'pandas', 'graph-databases', 'python', 'cypher']"
66340716,Is there a way in Neo4j to get a list of currently registered Transaction Event Handlers,Is this possible either through the neo browser or through Java?,1614112536,https://stackoverflow.com/q/66340716,Delphine Prinet,"['neo4j', 'cypher']"
66336619,Creating knowledge graphs in Neo4j,"1.Can Neo4j store RDF directly? we understand it can import RDF and export RDF but how is the data stored internally.
We also understand in Neo4j we can create property graphs and make it as a KG using APOC procedures and algorithms available,is that the case or are we missing anything?
2. We would like to understand, how an entity will be tagged against an ontology in Neo4j KG implementation.
",1614095963,https://stackoverflow.com/q/66336619,Ramya Rishikesh,['neo4j']
66329073,Neo4J Params on Javascript,"I&#180;m sure that one of you can help me with this issue.
I&#180;m trying to create a node property with &quot;params&quot;, but I must be missing something because nothing happens. I neither received a console.log error, nor the param is working properly.
I could console.log the requested variables, so that the request of the app is working, too.

Thank you for your help.

```javascript
app.post(&quot;/person/originalname/add&quot;, function (req, res) {
    var originalname = req.body.originalname;
    var id = req.body.id;

    session
        .run(&quot;MATCH (n) where id(n) = $idParam SET n.original_name = $originalParam RETURN n&quot;, {
            originalParam: originalname,
            idParam: id
        }
        )
        .then(function (result) {
            res.redirect(&#39;/&#39;);

        })
        .catch(function (error) {
            console.log(error);
        });

});
```",1614066685,https://stackoverflow.com/q/66329073,Artur,"['neo4j', 'javascript', 'parameters']"
66327507,creating nodes and building relationships dynamically by Importing data from json files,"I have 3 JSON files namely Network, DataStore and VM. I want to extract the data from JSON files and create nodes and relationships dynamically.I have used the below mentioned query

    CALL apoc.load.json(&quot;file:///DataStore.json&quot;) YIELD value AS data
    MERGE (d:DataStore{DataStore: data.DataStore})
    SET d.Name = data.Name,
    d.Type = data.Type,
    d.Capacity = data.Capacity,
    d.Free = data.Free
    WITH data as data
    CALL apoc.load.json(&quot;file:///Network.json&quot;)YIELD value AS net
    MERGE(n:Network{Network:net.Network})
    SET n.Name =net.Name
    WITH net AS nw
    CALL apoc.load.json(&quot;file:///VmDetails.json&quot;) YIELD value AS vm
    MERGE(n:Network{Name:vm.Network})
    MERGE(d:DataStore{Datastore:vm.DataStore})
    MERGE(v:UserV{vmName:vm.vmName})
    SET v.CPU= vm.CPU,
    v.ConnectionState = vm.ConnectionState,
    v.DataStore = vm.DataStore,
    v.Hostname = vm.Hostname,
    v.InstanceUuid = vm.InstanceUuid,
    v.IpAddress = vm.IpAddress,
    v.Network = vm.Network,
    v.NumEthernetCards = vm.NumEthernetCards,
    v.NumVirtualDisks = vm.NumVirtualDisks,
    v.OverallStatus = vm.OverallStatus,
    v.PowerState = vm.PowerState,
    v.RAM = vm.RAM,
    v.Uuid = vm.Uuid
    MERGE (n)-[:connected]-&gt;(v)
    MERGE (v)-[:related]-&gt;(d)


Here I can create nodes as desired but while creating relationships only network and VM are creating relationship correctly but when it comes to datastore it creates some unwanted new nodes and creates a relationship.[Realtionship created between VM and DataStore][1] &lt;-this is the image of the graph created


  [1]: https://i.stack.imgur.com/QdwpH.png",1614057909,https://stackoverflow.com/q/66327507,pooja narayan,"['graph-databases', 'neo4j', 'nosql', 'graph', 'json']"
66323136,Neo4j building initial graph is slow,"I am trying to build out a social graph between 100k users. Users can sync other social media platforms or upload their own contacts. Building each relationship takes about 200ms. Currently, I have everything uploaded on a queue so it can run in the background, but ideally, I can complete it within the HTTP request window. I&#39;ve tried a few things and received a few warnings.

1. Added an index to the field `pn`
2. Getting a warning `This query builds a cartesian product between disconnected patterns.` - I understand why I am getting this warning, but no relationship exists and that&#39;s what I am building in this initial call. 

`MATCH (p1:Person {userId: &quot;.....&quot;}), (p2:Person) WHERE p2.pn = &quot;.....&quot; MERGE (p1)-[:REL]-&gt;(p2) RETURN p1, p2`

Any advice on how to make it faster? Ideally, each relationship creation is around 1-2ms.",1614026525,https://stackoverflow.com/q/66323136,joethemow,"['performance', 'neo4j']"
66320484,Load database from offline back-up Neo4j,"I backed up a neo4j database using 
``` 
bin/neo4j-admin dump --database=neo4j --to=c:/
 ```
Then  I load a database from an archive created with the dump command as follow
``` 
bin/neo4j-admin load --from=/var/lib/neo4j/data/c: --database=db
 ```
From Neo4j Enterprise Browser I execute
``` 
SHOW DATABASES
 ```
but I don&#39;t see the **db** previously loaded. How could I show it ?

 ",1614014747,https://stackoverflow.com/q/66320484,Nicolapo,"['graph', 'database', 'neo4j', 'relationship', 'cypher']"
66318372,Get the all the nodes connected to a specific node with relationship,"I want to get the all the nodes with relationship(edges) that are connected to this `kim.horne` 

I tried to write a query:

    MATCH p=(c{name:&#39;kim.horne&#39;})-[r:REL]-(d)
    RETURN p

but this give me the result as shown below:
[![enter image description here][1]][1]

You can see I am getting the edge between `eclipse and doughlas`, `susan and nick` etc which I don&#39;t want. I am more interested to have edges that are either coming to or going from the node `kim.horne`

  [1]: https://i.stack.imgur.com/xBOi7.png
",1614006872,https://stackoverflow.com/q/66318372,Pygirl,['neo4j']
66317858,How to integrate Neo4j database and GraphQL in .NET?,"At the moment I have a microservice (ASP.NET Core Web API) that handles arbitrary integration events and writes data to the Neo4j database. As a next step, I need to offer API to users and I need to use GraphQL.

The problem is that I&#39;m not sure how to integrate Neo4j database, GraphQL and dotnet. As far as I see it is possible to integrate GraphQL, dotnet and EF Core using [graphql-dotnet][1], [graphql-net][2] or [hotchocolate][3], but I don&#39;t see any option for Neo4j database. Is this possible?


I&#39;ve seen that the hotchocolate has a plan for [Neo4j integration][4], but that is still a work in progress.

I&#39;ve seen that graphql-dotnet states on [this page][5] that it is possible to use any data source with it, but I am not sure how to approach this. Can you provide me some examples?

&gt; This library will work with **any data source** that you provide. Here are a few resources for specific data sources.

In addition, I would like to ask if it is possible to combine multiple databases (PostgreSQL with EF Core and Neo4j) into one composite GraphQL that will be exposed to clients?

  [1]: https://github.com/graphql-dotnet/graphql-dotnet
  [2]: https://github.com/chkimes/graphql-net
  [3]: https://github.com/ChilliCream/hotchocolate
  [4]: https://github.com/ChilliCream/hotchocolate/issues/2325
  [5]: https://graphql-dotnet.github.io/docs/getting-started/databases",1614005018,https://stackoverflow.com/q/66317858,gzsun,"['.net-core', 'neo4j', 'graphql', 'c#', '.net']"
66317753,neo4j: transaction Log location on dedicated device,"We have enterprise neo4j with a lot of transaction log files and need to put the log files on another device. how to use below item and address a directory on another device:
 dbms.directories.transaction.logs.root",1614004678,https://stackoverflow.com/q/66317753,sam1364tt,"['transactions', 'logging', 'neo4j']"
66316767,Get nodes sorted by proximity and at the same level sort by date,"I&#39;m pretty new in neo4j and I have troubles to get a well result for my query. I have the next model:
```
Player &lt;- HAS_PLAYERS - Game

Node Player: playerId, name,...etc
Node Game: gameId, gameDate
Rel. HAS_PLAYERS: result
```
Note that a Game could have 1-4 players.

I would like to make a query to suggest future opponents to a player ordered by:
Previous opponents ordered by `gameDate` (more recent) and then opponents of opponents ordered by `gameDate`.

For example:
```
PlayerA &lt;- 2021/02/01 -&gt; PlayerB*
PlayerA &lt;- 2021/02/01 -&gt; PlayerC*
PlayerA &lt;- 2021/02/11 -&gt; PlayerB

PlayerB &lt;- 2021/02/04 -&gt; PlayerC
PlayerB &lt;- 2021/02/20 -&gt; PlayerD

PlayerC &lt;- 2021/02/15 -&gt; PlayerD
PlayerC &lt;- 2021/12/01 -&gt; PlayerE

PlayerD &lt;- 2021/02/07 -&gt; PlayerE
PlayerD &lt;- 2021/02/23 -&gt; PlayerF

* = Same game

The result would be:

PlayerB
PlayerC
PlayerE
PlayerD
```
Explanation:
`PlayerB` and `PlayerC` have been opponents before but `PlayerB` is the first one because the last game was more recent than `PlayerC`.

`PlayerE` and `PlayerD` are opponents-of-opponents and `PlayerE` is before because the next game will be in December.

I have the next query but my problem is the query returns *duplicated nodes*:
```
# Getting direct opponents
MATCH (p:Player {userId: &quot;PlayerA&quot;})&lt;-[:HAS_PLAYERS]-(g:Game)-[:HAS_PLAYERS]-&gt;(o:Player)
WITH p, o, g ORDER BY g.gameDate DESC 
WITH p, COLLECT(o) AS opponents
# Getting opponents-of-opponents (ops)
MATCH (p)-[:HAS_PLAYERS*3]-(gops:Game)--(ops:Player)
WHERE p.userId &lt;&gt; ops.userId AND NOT ops IN opponents
# Trying to remove duplicated nodes
WITH DISTINCT ops, opponents, gops
WITH opponents, ops, gops ORDER BY gops.gameDate DESC
# Concat both lists: opponents and opponents-of-opponents
WITH REDUCE(s = opponents, o2 IN COLLECT(ops) | s + o2) as listAllOpponents
UNWIND listAllOpponents as opPlayer
RETURN opPlayer
```
It returns something like:
```
PlayerB
PlayerC
PlayerD
PlayerE
PlayerD
```
Any help would be appreciated.",1614001033,https://stackoverflow.com/q/66316767,Miguel,"['neo4j', 'cypher']"
66312124,How can i fix my Neo4j-spark connector error on python?,"I am trying to connect spark and neo4j, my aim is to pull the data from neo4j by using spark on python,i have already a connection between neo4j and python

    my spark version is 2.4.5
    python version 3.7.9

and my code is below

    from pyspark.sql import SparkSession

    spark = SparkSession.builder.master(&quot;local[1]&quot;) \
      .appName(&quot;SparkByExamples.com&quot;) \
      .getOrCreate()

    spark.read.format(&quot;org.neo4j.spark.Data Source&quot;) \
      .option(&quot;URL&quot;, &quot;neo4j:Ip:7687&quot;) \
      .option(&quot;authentication.basic.username&quot;,&quot;neo4j&quot;) \
      .option(&quot;authentication.basic.password&quot;,&quot;&quot;) \
      .option(&quot;labels&quot;, &quot;Person:Customer:Confirmed&quot;) \
      .load()



but when i want to use neo4j spark connector,although i installed the requirements like neo4j spark connector,jars,spark and i checked the versions ,i still get this error:


    py4j.protocol.Py4JJavaError: An error occurred while calling o34.load.
    : java.lang.ClassNotFoundException: Failed to find data source: org.neo4j.spark DataSource Please find packages a**strong text**t http://spark.apache.org/third-party-projects.html

Actually i couldn&#39;t find the enough documentation about my specific problem

i &#39;ll be glad to any help...",1613981745,https://stackoverflow.com/q/66312124,merve,"['neo4j', 'apache-spark', 'python']"
66311975,Full outer join in Neo4j,"Is a Full Outer Join supported by Neo4j? I read about Optional Match but I can&#39;t quite get it to work for my scenario.

Specifically, I have a Neo4j schema with 5 entity types where certain types can connect to one another with undirected connections. The allowed connections are (Type1, Type2), (Type2, Type3), (Type3, Type4) and (Type4, Type5). The connections are not directional. I want to perform the equivalent of full outer join between these types. e.g. if the only connections are `e11:Type1--e21:Type2`, `e22:Type2--e31:Type3`, `e32:Type3--e41:Type4` and `e42:Type4:e51:Type5` then the full outer join should result in:

| Type1 | Type2 | Type3 | Type4 | Type5 |
| ----- | ----- | ----- | ----- | ----- |
| e11   | e21   | null  | null  | null  |
| null  | e22   | e31   | null  | null  |
| null  | null  | e32   | e41   | null  |
| null  | null  | null  | e42   | e51   |

",1613980920,https://stackoverflow.com/q/66311975,hillel,"['cypher', 'neo4j']"
66304413,Developing graph database model for department/supplier/items,"I&#39;m currently ramping up on graph databases and to do that am working through a set of questions to learn Cypher. However, I&#39;m not 100% happy with the design I&#39;ve chosen since I have to match relationships to nodes to make some of the queries work.

I found https://stackoverflow.com/questions/41971456/neo4j-suggestions-for-ways-to-model-a-graph-with-shared-nodes-but-has-a-unique with some suggestions that are relevant, but they involve copying nodes (repeating them) when in fact they do represent the same thing. That seems like an update issue waiting to happen.

My design currently has

    (:Dept {name,floor})-[:SOLD {quantity}]-&gt;(:Item {name,type})&lt;-[:SUPPLIES {dept,volume)]-(:Company {name,address})

As you can see, to figure out which department a company supplied an item to, I have to check the `:SUPPLIES` `dept` property. This leads to somewhat awkward queries - it feels that way to me, anyway.

I&#39;ve tried other relationships, like having `(:Company)-[:SUPPLIES {item,vol}]-&gt;(:Dept)` but then the problem just shifts to matching `:SUPPLIES` relationship properties to `:Item` nodes.

The types of queries I am building are of the nature: Find departments that sell all of the items they are supplied.

Is there some other way to model this that I am overlooking? Or is this sort of relationship, where a supplier is related to two things, an item and a department, just something that doesn&#39;t fit the graph model very well?",1613924472,https://stackoverflow.com/q/66304413,argoc,"['neo4j', 'cypher']"
66303433,How to use ForEach in .Net Client,"How do I pass a list of objects into a ForEach query in the Neo4J .Net Client? The function signature only has one text parameter. Unwind takes in two parameters one for the list, and another for the unwound variable name:

ForEach:
```
client.ForEach(&quot;some text&quot;)
```
Unwind:
```
client.Unwind(activities, &quot;activity&quot;)
```",1613918404,https://stackoverflow.com/q/66303433,afriedman111,"['neo4jclient', 'neo4j']"
66296626,Execute recursive saves together or seperately?,"I have a complex graph of objects that I am saving to the database. These objects can each connect to other graphs of a similar type. I wish to save the graph of objects and all of the graphs they connect to recursively. 

Is it bad practice to aggregate all of the saves and execute them under one transaction? Should each graph be saved seperately?

Currently I save each subgraph separately. Below is example code (.NET)
```c#
public async Task&lt;GraphObj&gt; SaveAllGraphs(GraphObj graph)
{
	foreach (var node in graph.nodes)
	{
		if (node.subGraph != null)
		{
		    await SaveGraph(node.subGraph);
		}
	}
	return await SaveGraphInstance(graph);
}
```

```c#
async public Task SaveGraphInstance(GraphObj graph)
{
		var txClient = (ITransactionalGraphClient)_client;
		await txClient.ConnectAsync();

		using (var tx = txClient.BeginTransaction())
		{
			await _client.Cypher.Create(...).ExecuteWithoutResultsAsync();
			await _client.Cypher.Create(...).ExecuteWithoutResultsAsync();
			await tx.CommitAsync();
		}
	}	
}
```",1613855654,https://stackoverflow.com/q/66296626,afriedman111,"['graph-databases', 'neo4j', 'neo4jclient']"
66294460,neo4j - creating graph projection from flat data,"I&#39;m brand new to Neo4j, and I&#39;m having difficulty relating the guidance docs to my data to crate some graph projections...

I&#39;ve loaded data into a table:
LOAD CSV WITH HEADERS FROM &#39;https://***.csv&#39; AS row 
MERGE (Category{user1: row.User1, user2: row.User2, Count: row.Count})

An example of the data is:

[![enter image description here][1]][1]


I&#39;m trying to create a graph projection on the basis the &#39;Row: user1&#39; -&gt; has_followed -&gt; &#39;Row: user2&#39; (the no. of times specified in count) but haven&#39;t quite got the syntax right.

I intend to create a graph projection per category.

EDIT - here&#39;s an example of my expected output with all the sample data provided (which in practice I would do as 2 separate graphs based on the &quot;category&quot;):
[![enter image description here][2]][2]


  [1]: https://i.stack.imgur.com/tCcoe.png
  [2]: https://i.stack.imgur.com/Q26Mr.png

",1613841713,https://stackoverflow.com/q/66294460,PetyrBaelish,['neo4j']
66281134,Issues writing a query that would fetch the second degree friends of Abiodun considering the pattern and the relationships,"As a newbie, I am trying to write a cypher query that would fetch the second-degree friends of Abiodun(node) considering the pattern and the relationships.

*Initial codes*

    1) CREATE (abiodun:Person {name:&quot;Abiodun&quot;})
       RETURN abiodun

    2) MATCH (abiodun:Person {name:&quot;Abiodun&quot;})
       CREATE (abiodun)-[like:LIKE]-&gt;(neo:Database {name:&quot;Neo4j&quot; }) 
       RETURN abiodun,like,neo

    3)MATCH (abiodun:Person {name:&quot;Abiodun&quot;})
      FOREACH (name in [&quot;Rajesh&quot;,&quot;Anna&quot;,&quot;Julia&quot;,&quot;Andrew&quot;] |
      CREATE (abiodun)-[:FRIEND]-&gt;(:Person {name:name}))

    4)MATCH (neo:Database {name:&quot;Neo4j&quot;})
      MATCH (anna:Person {name:&quot;Anna&quot;})
      CREATE (anna)-[:FRIEND]-&gt;(:Person:Expert {name:&quot;Amanda&quot;})-[:WORKED_WITH]-&gt;(neo) here

*Actual issue(what i did so far*

    MATCH (abiodun) WHERE not ((abiodun)-[:FRIEND]-&gt;(myFriends)) 
    RETURN n

[![enter image description here][1]][1]

I am trying to write a query that will display only Amanda   


  [1]: https://i.stack.imgur.com/BC69g.png",1613751256,https://stackoverflow.com/q/66281134,lee,"['cypher', 'neo4j']"
66279018,Color nodes based on type/attribute,"I am building a network using the following code:

```
match (n) detach delete n;

LOAD CSV WITH HEADERS FROM &#39;file:///data-assets.csv&#39; AS data
Create (:Data {id: data.Id, dataName: data.Name, Type: data.Type});

LOAD CSV WITH HEADERS FROM &#39;file:///data-links.csv&#39; AS links
match (d1:Data {id:links.Source}), (d2:Data {id:links.Target})
CREate (d1)-[:Feed]-&gt;(d2);
```

Where:
* `data-assets.csv` has the columns: `Id`, `Name` and `Type`
* `data-links.csv` has the columns: `Source` ,`Target`

I want to have different colors of the nodes depending on their types. I found [this](https://community.neo4j.com/t/how-can-i-create-relationships-in-neo4j-cypher-from-a-csv-that-depend-on-the-type-of-nodes/20615?u=drorata) and [this](https://community.neo4j.com/t/coloring-nodes-in-neo4j-depending-on-property/12287?u=drorata) but probably I&#39;m too new to neo4j to know how to make it work.",1613743303,https://stackoverflow.com/q/66279018,Dror,"['neo4j', 'graph-visualization']"
66271919,What is exact time in Neo4j execution time?,"I am using Neo4j query log analyzer on Neo4j desktop to investigate my performance issue.
In the image, the total for 2nd query is 153281 ms (~ 2.5 mins); but the time for planning, cpu and waiting is very small, just 1433ms in total.

[Click here to view image][1]

So where is the rest? I think that &quot;total time = planning + cpu + waiting &quot; but it seems I am wrong.

Thank you in advance

Harvey Nguyen


  [1]: https://i.stack.imgur.com/cMN75.png",1613709960,https://stackoverflow.com/q/66271919,Harvey,"['query-optimization', 'cypher', 'graph-databases', 'neo4j']"
66271425,Neo4j create edges with multiple labels/properties,"I am new to neo4j but I am trying to create this simple graph where edges can have multiple labels (or is it properties??)

basically

              clicked
    User A ----------------------------------------------------------&gt;  item B
           {created at: timestamp, user key: some user specific key}


So far I am able to create

                         clicked
    User A ----------------------------------------------------------&gt;  item B
               {created at: timestamp}



                      clicked
    User A ----------------------------------------------------------&gt;  item B
           |    {created at: timestamp}                              ^
           L_________________________________________________________|

But instead of two edges, I want to have these two attributes in single edge?
Is that feasible?
Cypher query preferred.",1613705702,https://stackoverflow.com/q/66271425,frazman,"['cypher', 'neo4j']"
66270999,Neo4j 3.5 Query Performance Issue,"I have following query running in neo4j (community 3.5)
```sql
MATCH (a:master_node:PERF:Application)-[r1]-&gt;(n:master_node:PERF)-[r:AFFINITY]-&gt;(m:master_node:PERF)&lt;-[r2]-(a1:master_node:PERF:Application)
WHERE exists(n.latest_ingestion)
  AND exists(m.latest_ingestion)
  AND id(a) &lt;&gt; id(a1)
MERGE (a)&lt;-[:APP_AFFINITY]-(a1)
```
and my configurations for neo4j are as follows:
```
heap_size : 8GB
page_cache : 4GB
```
and I have Indexes for the label(Application) on property(name) and above query running over 100k nodes.But the Query is running for longer time and consuming so much of memory.

Please help me out to improve the performance.

",1613701949,https://stackoverflow.com/q/66270999,ck22,"['query-optimization', 'cypher', 'performance', 'neo4j']"
66257881,Designing and implementing SaaS Application with Muti-tenancy GraphDB (Neo4J / ArangoDB),"I am developing a SaaS Application with the following Technology:
- NestJS (Node)
- DB (NEO4J, ArangoDB)
- Nginx for proxy (Micro-services Approach)&lt;br&gt;

The SaaS Application will be hosting many distinct companies, as clients.
The data from 2 different companies must be fully isolated in the GraphDB.
2 different companies may have different data structures and models.

ENQUIRIES
Here are my enquiries:
- How to setup Multi-tenancy on a GraphDB (Neo4J / ArangoDB)?
- Is a totally separate required GraphDB instance required for each company?
- Is it possible to host 2 companies on the same GraphDB, yet maintain isolation?

Can anyone please suggest an optimal solution for this type of architecture?&lt;br&gt;
Thanks for your time

Best regards",1613643413,https://stackoverflow.com/q/66257881,zulqarnain,"['multi-tenant', 'arangodb', 'node.js', 'graph-databases', 'neo4j']"
66251364,Read json property names in json with CYPHER,"I have this kind of input JSON file for my Neo4J database : 

```json
    {&quot;list&quot;:[
    {
      &quot;extraction&quot;:{&quot;extractorId&quot;:&quot;45485&quot;,&quot;date&quot;:&quot;20211201&quot;,&quot;location&quot;:&quot;France&quot;},
      &quot;actors&quot;:{&quot;88187&quot;:&quot;Toto&quot;,&quot;74017&quot;:&quot;Titi&quot;,&quot;78901&quot;:&quot;Tata&quot;,&quot;45867&quot;:&quot;Tutu&quot;},
      &quot;data&quot;:{&quot;2877:-99033:-979&quot;:{&quot;4934&quot;:[45867],&quot;4935&quot;:[88187],&quot;4933&quot;:[74017],&quot;4932&quot;:[45867],&quot;4931&quot;:[78901,45867],&quot;4930&quot;:[78901]}}
    },

    {&quot;extraction&quot;:{&quot;extractorId&quot;:&quot;45485&quot;,&quot;date&quot;:&quot;20211201&quot;,&quot;location&quot;:&quot;England&quot;},
     &quot;actors&quot;:{&quot;42815&quot;:&quot;Lala&quot;,&quot;45867&quot;:&quot;Tutu&quot;},
     &quot;data&quot;:{&quot;2877:-99033:-979&quot;:{&quot;4939&quot;:[86970],&quot;4934&quot;:[74975,45867],&quot;4935&quot;:[42815,88187],&quot;4933&quot;:[74017],&quot;4932&quot;:[45867],&quot;4931&quot;:[78901,45867],&quot;4930&quot;:[78901]}}}
    ]}
```

As you can see, this is not a standard JSON format, because property names can be values too.

How can I read this with UNWIND, FOREACH and so on ? A one-liner CYPHER request is not mandatory. 

For example, if I want to create nodes with (a:Actor {id,name}), if I try this : 

```
WITH &quot;file:///data.json&quot; as json
CALL apoc.load.json(json) YIELD value
UNWIND value.list AS item
UNWIND item.actors AS actors
RETURN actors
```

I get 

```
row1 :
{
  &quot;45867&quot;: &quot;Tutu&quot;,
  &quot;74017&quot;: &quot;Titi&quot;,
  &quot;78901&quot;: &quot;Tata&quot;,
  &quot;88187&quot;: &quot;Toto&quot;
}
row 2 : 
{
  &quot;42815&quot;: &quot;Lala&quot;,
  &quot;45867&quot;: &quot;Tutu&quot;,
}
```

How can I get the id and the name to use them in the MERGE node cypher command ? ",1613603919,https://stackoverflow.com/q/66251364,Zofren,"['neo4j', 'json', 'neo4j-apoc', 'cypher']"
66251331,ReactiveNeo4jRepository together with ReactiveMongoRepository in spring 2.4 throws error on save (spel EvaluationContextExtension),"I have a service which autowires two repository, a reactive neo4j repository and a reactive mongo repository

```
@Service
class TestService(
        val neo4jRepository: MyNeo4jRepository,
        val mongoRepository: MyMongoRepository
        ) {

    suspend fun get(id: String) {
        val record = getFromNeo4j(id)
        val secondRecord = getFromMongo(id)
    }

    suspend fun getFromNeo4j(id: String, fetchRelated: Boolean = true): MyNeo4jEntity? {
        return neo4jRepository.findFirstById(id).awaitFirstOrNull()
    }

    suspend fun getFromMongo(id: String): List&lt;AreaMeasurement&gt; {
        return mongoRepository.findWithSpecificQuery(id).asFlow().toList()
    }
}

```

When I try to store this, I crash on the mongoRepository due to

``` 
Unsupported extension type: org.springframework.data.neo4j.repository.support.Neo4jEvaluationContextExtension@1b19905c
```

Which is a bit weird due to 
 1. Why is neo4j involved? 
 2. Why do I get a Neo4JEvaluationContextExtension and not a Reactive extension?

The code where the error is thrown inside spring boot data

```
org.springframework.data.spel;

public class ReactiveExtensionAwareEvaluationContextProvider { /*...*/
if (it instanceof ReactiveEvaluationContextExtension) {
                /* code */
				return Mono.empty();
}
			return Mono.error(new IllegalStateException(&quot;Unsupported extension type: &quot; + it));

}
```",1613603712,https://stackoverflow.com/q/66251331,stevietheTV,"['spring-boot', 'neo4j', 'kotlin', 'reactor', 'mongodb']"
66250765,how to automatically match events sent from kafka in Neo4j,"I have some events being sent from a Kafka topic to an existing Neo4j Database. The Database has already around 4000 labels and 11500 relationships. These events being sent from kafka should match their corresponding nodes automatically. Lets say:

There are 3 nodes that represent product a &amp; product b. 

the kafka topic publishes the status of the different products to neo4j:
product a: available, product b : blocked: product a: blocked, product a: shipped

the graph should be:

(product A)------&gt;(available)-----&gt;(blocked)----&gt;(shipped)

(product B)------&gt;(blocked)

I cannot figure out how to solve this. As far as I can do i get to ingest the events from kafka to neo4j, but after that i do not get to match them with their corresponding product. 

Thankyou very much.",1613600464,https://stackoverflow.com/q/66250765,Thomas Kaminski,"['neo4j', 'neo4j-apoc', 'apache-kafka']"
66248905,Trying to seed Neo4j cluster from backup,"Earlier running a single vm instance of neo4j. Now we have to move it to GKE. On GKE, I&#39;m not able to restore the neo4j db. Following the [official][1] documentation, I&#39;m not able to stop the neo4j or unbind the same. 
Running version 4.2.2

Can share few steps to restore from vm to GKE, that would be great help. 


  [1]: https://neo4j.com/docs/operations-manual/current/tools/unbind/",1613590916,https://stackoverflow.com/q/66248905,Chronic95,"['google-cloud-platform', 'neo4j', 'google-kubernetes-engine']"
66248467,ReactiveNeo4jClient query returning always an empty result,"I&#39;m trying to execute a custom cypher query in Spring boot reactive app but always getting an empty output. I have tried executing the query in neo4j browser and I&#39;m able to get an anticipated result. I have found similar kind of example [here][1] but it is with Neo4JClient not with Neo4jReactiveClient 

When I tried debugging the code in MyDbClient -&gt; getTeamWithPlayers the pointer is not entering into query.mappedBy function.

API 

    GetMapping(&quot;/teamAndPlayes/{teamId}&quot;)
	public Mono&lt;TeamWithPlayers&gt; updateEventStatus(@RequestHeader(&quot;uid&quot;) String uid, @PathVariable Long teamId) {
		return myDbClient.getTeamWithPlayers(teamId);
	}

Client Implementation

```
@Component
@RequiredArgsConstructor
public class MyDbClient {
	private final ReactiveNeo4jClient client;

	public Mono&lt;TeamWithPlayers&gt; getTeamWithPlayers(Long teamId) {
		String query = &quot;Match (team:Team) where id(team) =$teamId match (team)-[:REL{is:&#39;TEAM&#39;}]-&gt;(u:User) &quot;
				+ &quot;optional Match (u) -[role:ROLE]-&gt;(team) &quot;
				+ &quot;with team, COLLECT(u) as users, collect({uid: u.uid, role : role.is}) as roles &quot;
				+ &quot;return team {id:id(team), .name, .description, .location, .emailAddress, .profileImgURL, .createdOn, users: users, roles: roles}&quot;;
		return client.query(query).bind(teamId).to(&quot;teamId&quot;).fetchAs(TeamWithPlayers.class)
				.mappedBy((TypeSystem ts, Record r) -&gt; {
					Value team = r.get(&quot;team&quot;);
					List&lt;User&gt; users = team.get(&quot;users&quot;).asList(u -&gt; User.builder()
							.firstName(u.get(&quot;firstName&quot;).asString()).lastName(u.get(&quot;lastName&quot;).asString()).build());
					List&lt;PlayerRole&gt; roles = team.get(&quot;roles&quot;).asList(pr -&gt; PlayerRole.builder()
							.uid(pr.get(&quot;uid&quot;).asString()).role(pr.get(&quot;role&quot;).asString()).build());
					return TeamWithPlayers.builder().id(team.get(&quot;id&quot;).asLong()).name(team.get(&quot;name&quot;).asString())
							.description(team.get(&quot;description&quot;).asString()).location(team.get(&quot;location&quot;).asString())
							.emailAddress(team.get(&quot;emailAddress&quot;).asString())
							.createdOn(team.get(&quot;createdOn&quot;).asLocalDateTime()).users(users).roles(roles).build();
				}).one();
	}
}

```
Mapping classes

```
@Data
@Builder
@ToString
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class TeamWithPlayers {
	private Long id;
	private String name;
	private String description;
	private String location;
	private String emailAddress;
	private String profileImgURL;
	private LocalDateTime createdOn;
	List&lt;User&gt; users;
	List&lt;PlayerRole&gt; roles;
}


@Node
@Data
@ToString
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class User implements Entity {

	@Id
	@GeneratedValue
	private Long id;
	private String uid;
	private String firstName;
	private String lastName;
	private String emailAddress;
	private String profileImgURL;
	private LocalDateTime updatedAt;
	private LocalDateTime createdAt;
	private LocalDateTime lastLoggedInAt;
}

@Data
@ToString
@Builder
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class PlayerRole {
	String uid;
	String role;
}
```
POM dependencies **&lt;version&gt;2.4.2&lt;/version&gt;**
```

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-neo4j&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
        &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;

```

Not sure what wrong in my approach 


  [1]: https://github.com/neo4j-examples/movies-java-spring-data-neo4j/blob/main/src/main/java/movies/spring/data/neo4j/movies/MovieService.java",1613588875,https://stackoverflow.com/q/66248467,Hari Nadh,"['spring-data-neo4j', 'spring-data', 'neo4j', 'spring-webflux']"
66241383,Multi-tenancy Architecture in a graph DB,"I would like to share my thoughts with you and try to get some advice. I would like to define my application with the best architecture as possible. Any comment would be highly appreciated. Here we go...

**My technologies:** NestJs(Node), neo4j/arangodb(graph DB), Nginx for proxy(Micro-services Approach).

**My business case:** SaaS application. Many customers with many users, one database per customer and the same code (just one instance) of our codebase.&lt;br&gt;
we have a set of data models which will be same for all customer but a relation between them will differ. As per my research GraphDB is the best match for such operations. so I&#39;m planning to create separate Instance/Database for each customer otherwise too many relations will make harder to scale.

**Problem:** From my point of view the problem can be seen with two different approach.

 1. I need to allow multiple users to connect to different databases at the same time with the same code (just one installation). In Nestjs App how can I change the database configuration on each API request. Shall I save DB URI in a table, based on user/customer type it will fetch DB URI? then other concerns like does it affect on latency time, if any request failed then is there any possibility that request can fetch data from wrong DB?
 2. How can we create sub-graphs in neo4j/arangodb so we can fetch sub-graph based on the customer.

On the other hand, I found a couple of interesting links:&lt;br&gt;
https://neo4j.com/developer/multi-tenancy-worked-example/ &lt;br&gt;
https://www.arangodb.com/enterprise-server/oneshard/ &lt;br&gt;
https://dzone.com/articles/multitenant-graph-applications

Someone could provide me aditional info?

Thanks for your time

Best regards
 
",1613562577,https://stackoverflow.com/q/66241383,zulqarnain,"['node.js', 'neo4j', 'graph-databases', 'arangodb', 'multi-tenant']"
66241306,"How to transfer message from Rabbitmq to neo4j, with json file","I&#39;m kinda newbie with rabbitmq and neo4j.
I&#39;ve got json message got from ms-sql db in my rabbitmq queue.
Trying to send it into test neo4j db with this python script:

```#!/usr/bin/env python
import pika, sys, os, json
from py2neo import Graph
def main():
    connection = pika.BlockingConnection(pika.ConnectionParameters(host=&#39;localhost&#39;))
    channel = connection.channel()
    channel.queue_declare(queue=&#39;request_sql&#39;, durable=True)
    graph = Graph(&quot;bolt://10.133.100.105:7687&quot;, user=&quot;neo4j&quot;, password=&quot;123&quot;)
    query = &quot;&quot;&quot;
RETURN $json
    &quot;&quot;&quot;
    def callback(ch, method, properties, body):
       #print (&quot; [x] Received %r&quot; % json.loads(body))
       print(graph.run(query, json = body)) 
    channel.basic_consume(queue=&#39;request_sql&#39;, on_message_callback=callback, auto_ack=True)
    print(&#39; [*] Waiting for messages. To exit press CTRL+C&#39;)
    channel.start_consuming()

if __name__ == &#39;__main__&#39;:
    try:
        main()
    except KeyboardInterrupt:
        print(&#39;Interrupted&#39;)
        try:
            sys.exit(0)
        except SystemExit:
            os._exit(0)
```

and after i&#39;m running it i&#39;m getting next error:

```Traceback (most recent call last):
  File &quot;receive.py&quot;, line 25, in &lt;module&gt;
    main()
  File &quot;receive.py&quot;, line 21, in main
    channel.start_consuming()
  File &quot;/usr/local/lib/python3.6/site-packages/pika/adapters/blocking_connection.py&quot;, line 1866, in start_consuming
    self._process_data_events(time_limit=None)
  File &quot;/usr/local/lib/python3.6/site-packages/pika/adapters/blocking_connection.py&quot;, line 2027, in _process_data_events
    self.connection.process_data_events(time_limit=time_limit)
  File &quot;/usr/local/lib/python3.6/site-packages/pika/adapters/blocking_connection.py&quot;, line 834, in process_data_events
    self._dispatch_channel_events()
  File &quot;/usr/local/lib/python3.6/site-packages/pika/adapters/blocking_connection.py&quot;, line 566, in _dispatch_channel_events
    impl_channel._get_cookie()._dispatch_events()
  File &quot;/usr/local/lib/python3.6/site-packages/pika/adapters/blocking_connection.py&quot;, line 1494, in _dispatch_events
    evt.properties, evt.body)
  File &quot;receive.py&quot;, line 18, in callback
    print(graph.run(query, json = body))
  File &quot;/usr/local/lib/python3.6/site-packages/py2neo/database/__init__.py&quot;, line 709, in run
    return self.auto().run(cypher, parameters, **kwparameters)
  File &quot;/usr/local/lib/python3.6/site-packages/py2neo/database/work.py&quot;, line 128, in run
    readonly=self.readonly, hydrant=hydrant)
  File &quot;/usr/local/lib/python3.6/site-packages/py2neo/client/__init__.py&quot;, line 936, in auto_run
    result = cx.auto_run(graph_name, cypher, parameters, readonly=readonly)
  File &quot;/usr/local/lib/python3.6/site-packages/py2neo/client/bolt.py&quot;, line 673, in auto_run
    result.buffer()
  File &quot;/usr/local/lib/python3.6/site-packages/py2neo/client/bolt.py&quot;, line 949, in buffer
    self.__cx.sync(self)
  File &quot;/usr/local/lib/python3.6/site-packages/py2neo/client/bolt.py&quot;, line 516, in sync
    self._audit(result)
  File &quot;/usr/local/lib/python3.6/site-packages/py2neo/client/bolt.py&quot;, line 626, in _audit
    task.audit()
  File &quot;/usr/local/lib/python3.6/site-packages/py2neo/client/bolt.py&quot;, line 883, in audit
    item.audit()
  File &quot;/usr/local/lib/python3.6/site-packages/py2neo/client/bolt.py&quot;, line 1062, in audit
    raise self._failure
py2neo.database.work.ClientError: [Statement.SyntaxError] Type mismatch: expected Map, Node, Relationship, Point, Duration, Date, Time, LocalTime, LocalDateTime or DateTime but was String (line 3, column 16 (offset: 35))
&quot;    UNWIND data.FirmID as id&quot;
```
resualt i&#39;ve wanted - transfer data from json fire info neo4j data(graph and etc.)

what i&#39;m doing wrong? need some advices and help please:)
",1613562256,https://stackoverflow.com/q/66241306,Oleg K.,"['neo4j', 'json', 'database', 'transfer', 'rabbitmq']"
66235282,Periodic commit through bolt port in neo4j (java driver),"I am connecting my java application with neo4j DB using the neo4j-java-driver (bolt port). I want to run a load CSV query which should be run in a batch of 500, so I want to use periodic commit for the same. So first of all, I used :
```
USING PERIODIC COMMIT 500 ...
```
In this case, I got the error:
```
Caused by: org.neo4j.driver.exceptions.ClientException: Executing queries that use periodic commit in an open transaction is not possible.
```

I found some answers about it here saying that I should add ```:auto``` before the query, so I did that and got this error:
```
Caused by: org.neo4j.driver.exceptions.ClientException: Invalid input &#39;:&#39;: expected &lt;init&gt; (line 1, column 1 (offset: 0))
:auto USING PERIODIC COMMIT 500
 ^
```
",1613531957,https://stackoverflow.com/q/66235282,Asim,"['cypher', 'neo4j', 'bolt']"
66231415,Restore Neo4j DB from Backup with Neo4J Desktop,I have a db backup folder that I&#39;m trying to load into a new db in Neo4J Desktop. ,1613505909,https://stackoverflow.com/q/66231415,blakesters,"['neo4j', 'neo4j-desktop']"
66231130,Search in a List that starts with a string in Neo4j,"I have a list of string and I need to check whether the given string matches or starts with any of the string in the list. 
For example: 

Match(e: Employees)
With e.Code as empCode 
Where e.Code STARTS WITH [&#39;CLR&#39;, &#39;MVV&#39;, &#39;OPP&#39;] 
Return *

Here the e.Code can be CLR1, MVV2, OPP1, OPP, CLR, CLR2, MVV1, SVV1
So I want to return e that has code  CLR1, MVV2, OPP1, OPP, CLR, CLR2, MVV1, SVV1
But I will only have this list: [&#39;CLR&#39;, &#39;MVV&#39;, &#39;OPP&#39;]. 

I tried using foreach, but I cannot use WHERE inside foreach. Is there any other way? ",1613504617,https://stackoverflow.com/q/66231130,Aiswarya Rajagopalan,"['neo4j', 'cypher']"
66222742,How to exclude a label in neo4j for relationship,"I am new to Neo4j, I want to show all the relations excluding a label.

I am doing :
```
match ()-[p:PLAYED]-&gt;() where not p:Today return p
```
But is giving me the following error 
```
Type mismatch: expected Node but was Relationship (line 1, column 37 (offset: 36))
&quot;match ()-[p:PLAYED]-&gt;() where not p:Today return p&quot;
```
It&#39;s working for excluding node labels but not for the relationships, i am not able to get a solution to this problem.",1613471709,https://stackoverflow.com/q/66222742,Asim,"['neo4j', 'cypher', 'cql']"
66217512,Cypher: How to traverse across any relationship except for a specific label,"Given a node in a cypher defined graph with a variable and uncertain number and type of incoming and outgoing relationships, how can I define in a cypher query a variable number of traversals which follow all relationships except for those of a specific type.

For example, I&#39;d like to find and return all nodes 1 - 4 relationship traversals away from a starting point (plus the original), but I do not want to traverse any relationships labeled `:CREATED_BY`:

```
MATCH (t:Thing {name: &#39;Starting Point&#39;})-[x*1..4]-(o)
WHERE NOT x:CREATED_BY
RETURN t, o
```

This returned an error because x, in this case, is a list of relationships instead of a single relationship.

In an ideal world, I&#39;d love it if I could do something like:

```
MATCH (t:Thing {name: &#39;Starting Point&#39;})-[x(NOT :CREATED_BY)*1..4]-(o)
``` 

Or some other pithy expression within the Match clause. If that does not syntactically exist, then a simple where statement would be preferred.  If not, my last avenue of attack is to treat x as a list, decompose it and then apply some conditional that for any given element it should not equal the relationship to be excluded.  My Cypher isn&#39;t good enough to construct this piece yet, and I&#39;m really hoping that this isn&#39;t an edge case in the language and a *simple* way of handling this query exists.

Thanks!",1613438146,https://stackoverflow.com/q/66217512,tmptplayer,"['cypher', 'neo4j']"
66214664,Neo4j Cypher Query multiple relationship from same node,"I Have a node called `Member` it has **Relationships** to `Clubs` and `Shops`  I want to create a query so that I can return `Member` with `Clubs` and `Shops`
```
MATCH (m: Member { username: $memberUsername ,
                  password: $password})&lt;- [r: MEMBER_BELONGS_TO_CLUBS] - (c: Club)
RETURN m, c, r
```

in the example I get `Member` and `Clubs` but I want to get member `Clubs` and member `Shops`",1613419275,https://stackoverflow.com/q/66214664,Thokle,"['neo4j', 'cypher']"
66207272,Mocking a neo4j Record instance in a Unittest,"I have a method:

    def retrieve_datetime_and_device(self, response):
        node_dict = response[0][0]._properties
        dt = node_dict.get(&quot;datetime&quot;)
        device = node_dict.get(&quot;name&quot;)

        return dt, device

The response is a return from a neo4j query. I&#39;d like to write a unittest for this, however I am unsure how to test when the input for the method requires a Record instance

A typical Record looks like:

    response = [&lt;Record n=&lt;Node id=902350 labels=frozenset({&#39;DEvice1&#39;}) properties={&#39;name&#39;: &#39;myname&#39;, &#39;Src&#39;: &#39;Somewhere&#39;, &#39;Filename&#39;: &#39;test.xlsx&#39;, &#39;datetime&#39;: &#39;2021-02-04 15:14:37&#39;}&gt;&gt;]

How can I test this?
",1613388787,https://stackoverflow.com/q/66207272,pymat,"['python-3.x', 'unit-testing', 'instance', 'neo4j']"
66207259,Add relationships to existing data in Neo4j,"To start with Neo4j (4.2.3) I loaded a year&#39;s worth of flights data (7m rows) and wanted to try and model a flight as a relationship between origin and destination airport. However the following query just eats up memory and has not finished after two days, so something is clearly amiss:

    MATCH (f:Flight), (dest:Airport), (orig:Airport)
    WHERE f.Dest = dest.IATA_Code AND f.Origin = orig.IATA_Code
    CREATE (orig)-[r:FlightTo {DeptDateTime:f.DepDT, ArriveDateTime:f.ArrDT, Flight:f.Name}]-&gt;(dest)

I can do this instead:

    LOAD CSV WITH HEADERS FROM &#39;file:///flights.csv&#39; AS row
    MERGE (o:Org_Airport {Org_IATA:row.Origin})
    MERGE (d:Dest_Airport {Dest_IATA:row.Dest})
    CREATE (o)-[r:FlightTo {DeptDateTime:row.DepDT, ArriveDateTime:row.ArrDT, Flight:row.Name}]-&gt;(d)

While this has the advantage of working (even in a reasonable time) it feels ugly to essentially duplicate the airports and also to go through the CSV file again when all the required data is already in the database.
I&#39;m not quite there with my graph thinking probably so I&#39;d appreciate some guidance on what the best way is to add a relationship like this, keeping in mind that original load files might get lost.",1613388745,https://stackoverflow.com/q/66207259,Michael H,"['cypher', 'neo4j']"
66198488,Spring Neo4j JPA native dynamic order by query,"I need to sort native query dynamically, I passed the Pageable object, skip and limit properties work correctly when I assigned $skip and $limit parameters to the native query. But I couldn&#39;t use order by statements such as &quot;ORDER BY m.title DESC&quot;. My actual query is more complicated than this but I just wrote the basics version of the actual query.

**Repository**
```
@Query(value = &quot;MATCH (m:Movie) RETURN m SKIP $skip LIMIT $limit;&quot;, countQuery = &quot;MATCH (m:Movie) RETURN count(m);&quot;)
Page&lt;Movie&gt; getMoviesBy(Pageable pageable);
```

**Service**
```
return repository.getMoviesBy(pageable);
```

**Controller**
```
 @GetMapping(&quot;search&quot;)
    public ResponseEntity search(@RequestParam(defaultValue = &quot;0&quot;) Integer pageNo,
                                 @RequestParam(defaultValue = &quot;10&quot;) Integer pageSize,
                                 @RequestParam Sort.Direction sortDirection,
                                 @RequestParam String sortBy
    ) {
        return ResponseEntity.ok(movieService.search(PageRequest.of(pageNo, pageSize,Sort.by(sortDirection, sortBy))));
    }
```
",1613326043,https://stackoverflow.com/q/66198488,Mehmet Sezer,"['java', 'neo4j', 'spring', 'spring-boot']"
66189861,How to provide an auto-committing transaction for „USING PERIODIC COMMIT“ on Neo4jRepository in Neo4j?,"Target:
-------
Programmatic, daily recurring import of 20 million records from a CSV file into Neo4j.


Environment:
------------
- Neo 4.2.3, Enterprise Edition.
- Spring Boot v2.4.2


Initial situation:
------------------
- Using Spring Data Neo4j (SDN) and spring-boot-starter-data-neo4j.
- Data set import via custom query of a `Neo4jRepository` (DAO):
&lt;hr&gt;

    @Repository
    public interface ImportDataDAO extends Neo4jRepository&lt;Molecule, Long&gt; {
      @Transactional
      @Query(&quot;USING PERIODIC COMMIT 500\n&quot; +
          &quot;CALL apoc.load.csv( $url, {mapping: $mapping} ) yield map AS row\n&quot; +
          &quot;MERGE (molecule:Molecule {moleculeId: row.moleculeId})\n&quot; +
          &quot;  ON CREATE SET molecule = row\n&quot;)
      void importData(
          @Param(&quot;url&quot;) String url,
          @Param(&quot;mapping&quot;) Map&lt;String, Map&lt;String, Object&gt;&gt; mapping
      );
    }

- To avoid out of memory errors use `Using Periodic Commit 500`.
- Resulting error: `org.neo4j.driver.exceptions.ClientException: Executing queries that use periodic commit in an open transaction is not possible.`


Discussion:
-----------

`Periodic Commit` is one of the few functions that requires an auto-commiting transaction, however through Spring via `@Transactional` only a normal one is provided. In Neo4j Browser I can prepend `:auto` to `Using Periodic Commit`, the import will be executed successfully. At the `@Transactional` annotation I can specify `Propagation` and `Isolation` features among others, but I don&#39;t see a way to define an auto-commiting transaction for the custom query.


To be solved problem:
---------------------

How can I use `Periodic Commit` from above mentioned custom query for CSV import?


",1613249833,https://stackoverflow.com/q/66189861,ThirstForKnowledge,"['spring-data-neo4j', 'spring-data', 'neo4j', 'spring-transactions', 'spring-boot']"
66187320,Neo4j - Adding indexes correctly,"I have a kinda complex query for retrieving nodes of type ```Post```. Query looks like this.
```
MATCH (t:Tag) WHERE t.name=&#39;CAT&#39; with t
MATCH (t)-[:HAS_TAG]-(p:Post) WHERE p.approval &lt;&gt; 2 AND (p.blocked= false OR p.blocked IS NULL)
with p where p.property1 &gt;= 10 AND p.property1 &lt; 3000000000
with p where not exists(p.property2) or  (p.property2 &gt;= 100 and p.property2 &lt; 43000)
with p where not exists(p.property3) or  (p.property3 &gt;= 100 and p.property3 &lt; 43000)
with p where not exists(p.property4) or  (p.property4 &gt;= 100 and p.property4 &lt; 43000)
with p ORDER BY p.property5 DESC SKIP 0 LIMIT 10
RETURN p;
```

I have already added an index for the ```name``` property of ```Tag``` type. So when i run the profile query, it indicates that it uses that index on ```name``` property. 

Now I want to use indexes to optimize other parts of this query as well. I am not sure how to do that since i have used ```with``` keyword to separate the filtering parts. 

Should I create a composite index like this:```(property1, property2, property3, property4,approval,blocked)``` 

Or

should i create separate indexes for each property since they are separated by ```with``` phrases?.
",1613233371,https://stackoverflow.com/q/66187320,Lahiru Udana,"['cypher', 'indexing', 'neo4j']"
66177868,Why don&#39;t these Cypher queries do the same thing?,"I am matching a full path, deleting the last node and then walking back up the nodes to delete any that have no downward relationships.

This query does what I want:

    MATCH (t:type)-[:HAS]-&gt;(m:model)-[:HAS]-(r:region)-[:HAS]-(p:param)-[:HAS]-(i:init { value: 1613044800})-[init_has:HAS]-(u:{url: &#39;http://something2.png&#39;}) 
    DELETE init_has, u
    WITH i,p,r,m,t
    MATCH (i) WHERE NOT (i)-[:HAS]-&gt;()
    DETACH DELETE i
    WITH p,r,m,t
    MATCH (p) WHERE NOT (p)-[:HAS]-&gt;()
    DETACH DELETE p
    WITH r,m,t
    MATCH (r) WHERE NOT (r)-[:HAS]-&gt;()
    DETACH DELETE r
    WITH m,t
    MATCH (m) WHERE NOT (m)-[:HAS]-&gt;()
    DETACH DELETE m
    WITH t
    MATCH (t) WHERE NOT (t)-[:HAS]-&gt;()
    DETACH DELETE t

But this query only deletes the first node in the in the WITH statement, `i`:

    MATCH (t:type)-[:HAS]-&gt;(m:model)-[:HAS]-(r:region)-[:HAS]-(p:param)-[:HAS]-(i:init { value: 1613044800})-[init_has:HAS]-(u:{url: &#39;http://something2.png&#39;}) 
    DELETE init_has, u
    WITH [i,p,r,m,t] AS parents
    UNWIND parents AS parent
    WITH parent 
    MATCH (parent) WHERE NOT (parent)-[:HAS]-&gt;()
    DETACH DELETE parent

It leaves the node `p`, which does not have any downward relationships. Why are these queries different? Can I somehow modify the second query to correctly iterate through these nodes and delete them if they have no downward relationships?  

",1613157778,https://stackoverflow.com/q/66177868,Mike Furlender,"['neo4j', 'cypher']"
66176305,Neo4j - encountering FetchURLError whenever using any query with GET or POST,"I am using Neo4j Desktop application and trying a cypher query to export RDF. I am using the default available load-movie.cypher data in local DB as a trial but everytime I run the query it gives **FetchURLError** so I dont know what I am doing wrong.Also to add that all other match queries are working fine. Here is the query that I tried:-

```
:POST /rdf/neo4j/cypher 
{&quot;cypher&quot;: 
         &quot;MATCH g = (:Person {name: &#39;Keanu Reeves&#39;})--&gt;(:Movie { title: &#39;The Matrix&#39;}) 
          RETURN g&quot;, 
 &quot;format&quot; : &quot;RDF/XML&quot;}
```
Then I tried a simple GET query :-

```
:GET /rdf/neo4j/describe/11
```

But the response is always:
```
 FetchURLError - Could not fetch URL: &quot;Failed to fetch&quot;. 
```

This could be due to the remote server policy. See your web browsers error console for more information.

Need some help in resolving the issue.",1613150532,https://stackoverflow.com/q/66176305,Mokshed Kaushik,"['cypher', 'neo4j', 'property-graph', 'rdf']"
66172018,Neo4j combine arrays from a return,"   I have a simple node object. 

        @Id
        @GeneratedValue
        private Long id;
    
        private String text;
    
        @Relationship(type = &quot;CONTAINS&quot;)
        private Entry entry;
    
        @Relationship(type = &quot;ATTACHED_TO&quot;, direction = Relationship.INCOMING)
        private Set&lt;ContentAttachment&gt; attachments = new HashSet&lt;ContentAttachment&gt;();


What I need is my return to return 1 array of all ContentAttachment ids. So Match (t:TextEditorContent) return t.attachments.ids. This would return an array of arrays, I would like all the ids to be in 1 combined array. Is there a way to do this with the query itself?",1613133363,https://stackoverflow.com/q/66172018,user1817988,"['java', 'cypher', 'spring', 'neo4j']"
66167064,Writing complex query in neomodel,"How to write complex queries involving search in multiple Node types.
for example following query returns ids of products usually bought together.
```
match (n:Product)-[:CONTAIN]-(:Order)-[:CONTAIN]-(p2:Product)
where ID(n)={product_id}
return ID(p2), count(*) as bought_count
```
But I am not able to figure out how to do such queries using Neomodel Node objects.
any help?

**context**: I have two nodes name order and product. each order node is linked to all products it contains with relation named contain. Now I want to query all products which shares same order bucket. ",1613109817,https://stackoverflow.com/q/66167064,Learn Go,"['neo4j', 'python', 'cypher', 'neomodel']"
66164471,Javascript Neo4j Driver Json parse express api,"This may be a non-issue however I can&#39;t help but feel like there is a better way to do what I am trying to achieve. 

I am writing an API in Express with my data stored in a neo4j database. 
I am using the official neo4j-driver to interface with neo4j which is running locally. When I run a query eg :

    session
        .run(`MATCH (foo:FamilyMember)-[:HAS_SISTER]-&gt;(sister:FamilyMember)
        WHERE foo.firstName = &#39;bar&#39;
        RETURN sister.firstName AS Name, sister.lastName AS Surname
        `)
        .then(res =&gt; {
            console.log(res);
        })
    
Neo4j returns a response object with a lot of information about the request:

    {
      records: [
        Record {
          keys: [Array],
          length: 2,
          _fields: [Array],
          _fieldLookup: [Object]
        },
        Record {
          keys: [Array],
          length: 2,
          _fields: [Array],
          _fieldLookup: [Object]
        },
        Record {
          keys: [Array],
          length: 2,
          _fields: [Array],
          _fieldLookup: [Object]
        },
        Record {
          keys: [Array],
          length: 2,
          _fields: [Array],
          _fieldLookup: [Object]
        }
      ],
      summary: ResultSummary {
        query: {
          text: &#39;MATCH (foo:FamilyMember)-[:HAS_SISTER]-&gt;(sister:FamilyMember)\n&#39; +
            &quot;    WHERE foo.firstName = &#39;bar&#39;\n&quot; +
            &#39;    RETURN sister.firstName AS Name, sister.lastName AS Surname\n&#39; +
            &#39;    &#39;,
          parameters: {}
        },
        queryType: &#39;r&#39;,
        counters: QueryStatistics { _stats: [Object], _systemUpdates: 0 },
        updateStatistics: QueryStatistics { _stats: [Object], _systemUpdates: 0 },
        plan: false,
        profile: false,
        notifications: [],
        server: ServerInfo {
          address: &#39;localhost:7687&#39;,
          version: &#39;Neo4j/4.2.1&#39;,
          protocolVersion: 4.2
        },
        resultConsumedAfter: Integer { low: 0, high: 0 },
        resultAvailableAfter: Integer { low: 4, high: 0 },
        database: { name: &#39;neo4j&#39; }
      }
    }


This is a pain when really I what I want is either the actual response data as an array of objects or an error message if something fails. 

I wrote this parse method to generate an array of Javascript object&#39;s with the data returned from the query:

    function parseNeo4jResponseJSON(res) {
        return results = res.records.reduce( (array, currentRecord) =&gt; {
            const record = currentRecord.keys.reduce( (obj, key, index) =&gt; {
                obj[key] = currentRecord._fields[index]
                return obj
            }, {})
            array.push(record);
            return array;
        },[])
    };

This works and now when I console log the query response through my parser I get it in the format I want eg: 

    [
      { Name: &#39;foo&#39;, Surname: &#39;bar&#39; },
      { Name: &#39;foo2&#39;, Surname: &#39;bar2&#39; },
      ...
    ]

Is this approach going to cause me problems down the line? Is there a better way to get a javascript object from the response? I am pretty new to neo4j. Apologies if the answer is obvious.",1613086056,https://stackoverflow.com/q/66164471,Daniel Davies,"['node.js', 'neo4j', 'javascript']"
66163539,Delete DB and transaction logs on Neo4j 4.2.3 Community Server,"I am trying to automate some data import into neo4j (Community Server) as follows: on a daily basis, I need the data to be deleted and new data to be imported.
In previous versions of neo4j,(3.x) I was able to perform db data deletion by using the following command
```echo &quot;$(cat /etc/neo4j/neo4j.conf| sed -n &#39;s/.*dbms.directories.data=//p&#39;)&quot;/databases/&quot;$(cat /etc/neo4j/neo4j.conf | sed -n &#39;s/.*dbms.active_database=//p&#39;)&quot;/* | xargs rm -rf```

Now, when I am running the same command, it appears that the db is deleted, but the transaction logs are not, hence neo4j cannot start.

``` neo4j console
Directories in use:
  home:         /var/lib/neo4j
  config:       /etc/neo4j
  logs:         /var/log/neo4j
  plugins:      /var/lib/neo4j/plugins
  import:       /var/lib/neo4j/import
  data:         /var/lib/neo4j/data
  certificates: /var/lib/neo4j/certificates
  run:          /var/run/neo4j
Starting Neo4j.
WARNING: Max 1024 open files allowed, minimum of 40000 recommended. See the Neo4                                                                                                                                                             j manual.
2021-02-11 21:45:22.869+0000 INFO  Starting...
2021-02-11 21:45:24.342+0000 INFO  ======== Neo4j 4.2.3 ========
2021-02-11 21:45:32.737+0000 ERROR Failed to start Neo4j on dbms.connector.http.listen_address, a socket address. If missing port or hostname it is acquired from dbms.default_listen_address.
java.lang.RuntimeException: Error starting Neo4j database server at /var/lib/neo4j/data/databases
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:207) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.build(DatabaseManagementServiceFactory.java:163) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.server.CommunityBootstrapper.createNeo(CommunityBootstrapper.java:36) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:134) [neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:90) [neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.server.CommunityEntryPoint.main(CommunityEntryPoint.java:35) [neo4j-4.2.3.jar:4.2.3]
Caused by: org.neo4j.kernel.lifecycle.LifecycleException: Component &#39;org.neo4j.dbms.database.DefaultSystemGraphInitializer@5634a861&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;Fail to start &#39;DatabaseId{00000000[system]}&#39; since transaction logs were found, while database files are missing.&quot;.
        at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:463) ~[neo4j-common-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:110) ~[neo4j-common-4.2.3.jar:4.2.3]
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:198) ~[neo4j-4.2.3.jar:4.2.3]
        ... 5 more
Caused by: java.lang.IllegalStateException: Failed to initialize system graph component: This database is shutdown.
        at org.neo4j.dbms.database.SystemGraphComponents.initializeSystemGraph(SystemGraphComponents.java:102) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.DefaultSystemGraphInitializer.initializeSystemGraph(DefaultSystemGraphInitializer.java:41) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.SystemGraphInitializer.start(SystemGraphInitializer.java:29) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:442) ~[neo4j-common-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:110) ~[neo4j-common-4.2.3.jar:4.2.3]
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:198) ~[neo4j-4.2.3.jar:4.2.3]
        ... 5 more
Caused by: org.neo4j.graphdb.DatabaseShutdownException: This database is shutdown.
        at org.neo4j.kernel.availability.DatabaseAvailabilityGuard.assertDatabaseAvailable(DatabaseAvailabilityGuard.java:172) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginKernelTransaction(GraphDatabaseFacade.java:197) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransactionInternal(GraphDatabaseFacade.java:176) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransaction(GraphDatabaseFacade.java:122) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransaction(GraphDatabaseFacade.java:116) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransaction(GraphDatabaseFacade.java:104) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTx(GraphDatabaseFacade.java:99) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.AbstractSystemGraphComponent.detect(AbstractSystemGraphComponent.java:118) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.AbstractSystemGraphComponent.initializeSystemGraph(AbstractSystemGraphComponent.java:93) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.SystemGraphComponents.initializeSystemGraph(SystemGraphComponents.java:92) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.DefaultSystemGraphInitializer.initializeSystemGraph(DefaultSystemGraphInitializer.java:41) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.SystemGraphInitializer.start(SystemGraphInitializer.java:29) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:442) ~[neo4j-common-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:110) ~[neo4j-common-4.2.3.jar:4.2.3]
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:198) ~[neo4j-4.2.3.jar:4.2.3]
        ... 5 more
        Suppressed: org.neo4j.graphdb.DatabaseShutdownException: This database is shutdown.
                at org.neo4j.kernel.availability.DatabaseAvailabilityGuard.assertDatabaseAvailable(DatabaseAvailabilityGuard.java:172) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginKernelTransaction(GraphDatabaseFacade.java:197) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransactionInternal(GraphDatabaseFacade.java:176) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransaction(GraphDatabaseFacade.java:122) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransaction(GraphDatabaseFacade.java:116) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransaction(GraphDatabaseFacade.java:104) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTx(GraphDatabaseFacade.java:99) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractSystemGraphComponent.detect(AbstractSystemGraphComponent.java:118) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractSystemGraphComponent.initializeSystemGraph(AbstractSystemGraphComponent.java:93) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.SystemGraphComponents.initializeSystemGraph(SystemGraphComponents.java:92) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.DefaultSystemGraphInitializer.initializeSystemGraph(DefaultSystemGraphInitializer.java:41) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.SystemGraphInitializer.start(SystemGraphInitializer.java:29) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:442) ~[neo4j-common-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:110) ~[neo4j-common-4.2.3.jar:4.2.3]
                at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:198) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.build(DatabaseManagementServiceFactory.java:163) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.server.CommunityBootstrapper.createNeo(CommunityBootstrapper.java:36) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:134) [neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:90) [neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.server.CommunityEntryPoint.main(CommunityEntryPoint.java:35) [neo4j-4.2.3.jar:4.2.3]
        Caused by: java.lang.RuntimeException: Fail to start &#39;DatabaseId{00000000[system]}&#39; since transaction logs were found, while database files are missing.
                at org.neo4j.kernel.database.Database.validateLogsAndStoreAbsence(Database.java:546) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.database.Database.validateStoreAndTxLogs(Database.java:538) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.database.Database.start(Database.java:419) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractDatabaseManager.startDatabase(AbstractDatabaseManager.java:187) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.DefaultDatabaseManager.startDatabase(DefaultDatabaseManager.java:152) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.DefaultDatabaseManager.startDatabase(DefaultDatabaseManager.java:36) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractDatabaseManager.forEachDatabase(AbstractDatabaseManager.java:165) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractDatabaseManager.startAllDatabases(AbstractDatabaseManager.java:112) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractDatabaseManager.start(AbstractDatabaseManager.java:106) ~[neo4j-4.2.3.jar:4.2.3]
                ... 8 more
        Suppressed: org.neo4j.graphdb.DatabaseShutdownException: This database is shutdown.
                at org.neo4j.kernel.availability.DatabaseAvailabilityGuard.assertDatabaseAvailable(DatabaseAvailabilityGuard.java:172) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginKernelTransaction(GraphDatabaseFacade.java:197) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransactionInternal(GraphDatabaseFacade.java:176) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransaction(GraphDatabaseFacade.java:122) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransaction(GraphDatabaseFacade.java:116) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTransaction(GraphDatabaseFacade.java:104) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.impl.factory.GraphDatabaseFacade.beginTx(GraphDatabaseFacade.java:99) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractSystemGraphComponent.detect(AbstractSystemGraphComponent.java:118) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractSystemGraphComponent.initializeSystemGraph(AbstractSystemGraphComponent.java:93) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.SystemGraphComponents.initializeSystemGraph(SystemGraphComponents.java:92) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.DefaultSystemGraphInitializer.initializeSystemGraph(DefaultSystemGraphInitializer.java:41) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.SystemGraphInitializer.start(SystemGraphInitializer.java:29) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:442) ~[neo4j-common-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:110) ~[neo4j-common-4.2.3.jar:4.2.3]
                at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:198) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.build(DatabaseManagementServiceFactory.java:163) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.server.CommunityBootstrapper.createNeo(CommunityBootstrapper.java:36) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:134) [neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:90) [neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.server.CommunityEntryPoint.main(CommunityEntryPoint.java:35) [neo4j-4.2.3.jar:4.2.3]
        Caused by: java.lang.RuntimeException: Fail to start &#39;DatabaseId{00000000[system]}&#39; since transaction logs were found, while database files are missing.
                at org.neo4j.kernel.database.Database.validateLogsAndStoreAbsence(Database.java:546) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.database.Database.validateStoreAndTxLogs(Database.java:538) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.kernel.database.Database.start(Database.java:419) ~[neo4j-kernel-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractDatabaseManager.startDatabase(AbstractDatabaseManager.java:187) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.DefaultDatabaseManager.startDatabase(DefaultDatabaseManager.java:152) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.DefaultDatabaseManager.startDatabase(DefaultDatabaseManager.java:36) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractDatabaseManager.forEachDatabase(AbstractDatabaseManager.java:165) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractDatabaseManager.startAllDatabases(AbstractDatabaseManager.java:112) ~[neo4j-4.2.3.jar:4.2.3]
                at org.neo4j.dbms.database.AbstractDatabaseManager.start(AbstractDatabaseManager.java:106) ~[neo4j-4.2.3.jar:4.2.3]
                ... 8 more
Caused by: java.lang.RuntimeException: Fail to start &#39;DatabaseId{00000000[system]}&#39; since transaction logs were found, while database files are missing.
        at org.neo4j.kernel.database.Database.validateLogsAndStoreAbsence(Database.java:546) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.database.Database.validateStoreAndTxLogs(Database.java:538) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.database.Database.start(Database.java:419) ~[neo4j-kernel-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.AbstractDatabaseManager.startDatabase(AbstractDatabaseManager.java:187) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.DefaultDatabaseManager.startDatabase(DefaultDatabaseManager.java:152) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.DefaultDatabaseManager.startDatabase(DefaultDatabaseManager.java:36) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.AbstractDatabaseManager.forEachDatabase(AbstractDatabaseManager.java:165) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.AbstractDatabaseManager.startAllDatabases(AbstractDatabaseManager.java:112) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.dbms.database.AbstractDatabaseManager.start(AbstractDatabaseManager.java:106) ~[neo4j-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:442) ~[neo4j-common-4.2.3.jar:4.2.3]
        at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:110) ~[neo4j-common-4.2.3.jar:4.2.3]
        at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:198) ~[neo4j-4.2.3.jar:4.2.3]
        ... 5 more
2021-02-11 21:45:32.746+0000 INFO  Neo4j Server shutdown initiated by request
```

Any clues into what to do? Manually deleting the entire content of the data folder does not quite help, as the authentification to the db, in order to allow the import is no longer working.",1613080596,https://stackoverflow.com/q/66163539,1nkotb,"['cypher', 'neo4j']"
66161942,How to prevent neo4j MERGE from creating duplicate relationships?,"I am attempting to create nodes and relationships if they do not exist. I do not know ahead of time if anything in the DB exists.

This is my initial query:

    MERGE (t:type { name: &#39;aaa&#39;})
    MERGE (m:model { name: &#39;bbb&#39;})
    MERGE (r:region {name: &#39;ccc&#39;})
    MERGE (p:param {name: &#39;ddd&#39;})
    MERGE (i:init {value: 123})
    MERGE (u:forecast {url: &#39;http://something.png&#39;})
    MERGE (t)-[:HAS]-(m)-[:HAS]-(r)-[:HAS]-(p)-[:HAS]-(i)-[:HAS]-(u)

This correctly produces a graph like this:
[![first graph output][1]][1]


Then I run this query again, but this time I change the name of the &quot;model&quot; object to &quot;bbc&quot; (instead of &quot;bbb&quot;):

    MERGE (t:type { name: &#39;aaa&#39;})
    MERGE (m:model { name: &#39;bbc&#39;})
    MERGE (r:region {name: &#39;ccc&#39;})
    MERGE (p:param {name: &#39;ddd&#39;})
    MERGE (i:init {value: 123})
    MERGE (u:forecast {url: &#39;http://something.png&#39;})
    MERGE (t)-[:HAS]-(m)-[:HAS]-(r)-[:HAS]-(p)-[:HAS]-(i)-[:HAS]-(u)

Now, however, my graph looks like this:
[![second graph][2]][2]

Everything looks correct except for the three duplicated relationships. 
I realize that `MATCH` will create the whole path if it does not exist. There must be some way to avoid creating duplicate relationships, though. 

I would appreciate being pointed in the right direction!

  [1]: https://i.stack.imgur.com/Xwng0.png
  [2]: https://i.stack.imgur.com/owMEa.png

",1613073607,https://stackoverflow.com/q/66161942,Mike Furlender,"['neo4j', 'cypher']"
66151999,Can&#39;t query Neo4J database using Neo4J-PHP- Unsupported Media Type,"So I installed Neo4J alongside the Neo4J-PHP-Client found on GitHub here :
https://github.com/graphaware/neo4j-php-client

I can query my database through the Desktop App and everything I do takes effect.
I managed to connect to my database through PHP successfully, no errors at all.
The problem arises when I try to run a query through PHP, it doesn&#39;t work at all, despite the very same query working perfectly if I run it through the Neo4J Desktop App.

Here&#39;s my code snippet, also I used the query example given in the GitHub post of Neo4J-PHP-Client :

    &lt;?php
     require_once &#39;./vendor/autoload.php&#39;;

     use GraphAware\Neo4j\Client\ClientBuilder;

     $client = ClientBuilder::create()
       -&gt;addConnection(&#39;default&#39;, &#39;http://neo4j:parola@localhost:7474&#39;)
       -&gt;build();
     $client-&gt;run(&#39;CREATE (n:Person)&#39;); 

    ?&gt;

The error I get is :
```
Fatal error: Uncaught Http\Client\Common\Exception\ClientErrorException: Unsupported Media Type in C:\xampp\htdocs\licenta\vendor\php-http\client-common\src\Plugin\ErrorPlugin.php:72
Stack trace: #0 C:\xampp\htdocs\licenta\vendor\php-http\client-common\src\Plugin\ErrorPlugin.php(54):
Http\Client\Common\Plugin\ErrorPlugin-&gt;transformResponseToException(Object(GuzzleHttp\Psr7\Request), Object(GuzzleHttp\Psr7\Response)) #1
C:\xampp\htdocs\licenta\vendor\php-http\httplug\src\Promise\HttpFulfilledPromise.php(34):
Http\Client\Common\Plugin\ErrorPlugin-&gt;Http\Client\Common\Plugin\{closure}(Object(GuzzleHttp\Psr7\Response)) #2
C:\xampp\htdocs\licenta\vendor\php-http\client-common\src\Plugin\ErrorPlugin.php(55): Http\Client\Promise\HttpFulfilledPromise-&gt;then(Object(Closure)) #3
C:\xampp\htdocs\licenta\vendor\php-http\client-common\src\PluginClient.php(161): Http\Client\Common\Plugin\ErrorPlugin-&gt;handleRequest(Object(GuzzleHttp\Psr7\Request), Object(Closure), Object(Closure)) #4
C:\xampp\htdocs\licenta\vendor\php-http\client-common\s in C:\xampp\htdocs\licenta\vendor\php-http\client-common\src\Plugin\ErrorPlugin.php on line 72
```

I really can&#39;t wrap my head around it, any help is greatly appreciated.
Thanks in advance!

 ",1613035753,https://stackoverflow.com/q/66151999,Jerome Durham,"['php', 'neo4jphp', 'cypher', 'neo4j']"
66143512,How to store the returned record of the results of a Neo4J query in Python?,"I have connected to the Neo4J graph database using Python, and want to store the returned results of a query under an object name (e.g. &#39;df&#39;), but for some reason when I simply print the output, Python prints every match for the given query, but if I try and store it under an object and call that object name, it only returns a single match. For example, if I run the following (I have to anonymise certain strings and names due to confidentiality):

    query_object = &quot;x&quot;
    query = &quot;&quot;&quot;MATCH (n {name:&quot;&quot;&quot; + &quot;&#39;&quot; + query_object + &quot;&#39;&quot; &quot;&quot;&quot;}) RETURN n&quot;&quot;&quot;
    edge_query = &quot;MATCH (n {name:&quot;&quot;&quot; + &quot;&#39;&quot; + query_object + &quot;&#39;&quot; &quot;&quot;&quot;})&lt;-[r]-(y) RETURN y.name, n.value&quot;&quot;&quot;
    with graphDB_Driver.session() as graphDB_Session:
            graphDB_Session.run(query)
            nodes = graphDB_Session.run(edge_query)
            for node in nodes:
                print(node)

I get:

    &lt;Record y.name=&#39;a&#39; n.value=None&gt;
    &lt;Record y.name=&#39;b&#39; n.value=None&gt;
    &lt;Record y.name=&#39;c&#39; n.value=None&gt;
    &lt;Record y.name=&#39;d&#39; n.value=None&gt;

However if I run:

    with graphDB_Driver.session() as graphDB_Session:
            graphDB_Session.run(query)
            nodes = graphDB_Session.run(edge_query)
            for x in nodes:
                df = node
    df

Calling df in this case would just return:

    &lt;Record y.name=&#39;d&#39; n.value=None&gt;

Can someone please explain to be why this is the case and if so how do I store the entire returned set of results under an object as it is crucial to a task I am currently occupied on?


",1612984393,https://stackoverflow.com/q/66143512,Tous Shahedian-Farid,"['record', 'neo4j', 'graph', 'python', 'database']"
66136725,Combine MERGE in FOREACH with transaction in cypher script,"I am trying to make a cypher script file for usage in *cypher-shell*.

### Purpose
The result should be a bunch of nodes named &#39;Constant&#39;. For some I just use a map as property, for others I additionally try to *set* a `createdAt` property [dynamically][1]. All this should happen in a [FOREACH][2], wrapped in a [transaction][3].

### For now it looks like this

```
:begin
WITH [
        {type: &#39;singleHouse&#39;, debug: true},
        {type: &#39;apartmentHouse&#39;, debug: true }
    ] AS constantHouseholdTypes
    FOREACH (constantHouseholdType in constantHouseholdTypes | CREATE (n:Constant:HouseholdType) SET n=constantHouseholdType);
:commit

:begin
WITH [
        {name: &#39;unit:area:squareMeter&#39;, domain: &#39;area&#39;, scaling: false, debug: true}
    ] as units
    FOREACH (unit in units | CREATE (u:Constant:Unit) SET u=unit, u.createdAt = timestamp())
:commit
```

## Edit: No error anymore

I do not see the error anymore for any reason.

Versions:
Bolt: 4.2
Neo4J 4.2.3

### But I am getting the following error:

```
Invalid input &#39;:&#39;: expected 
  &lt;EOF&gt;
  &quot;RETURN&quot;
  &quot;CREATE&quot;
  &quot;DELETE&quot;
  &quot;SET&quot;
  &quot;REMOVE&quot;
  &quot;DETACH&quot;
  &quot;MATCH&quot;
  &quot;WITH&quot;
  &quot;UNWIND&quot;
  &quot;USE&quot;
  &quot;CALL&quot;
  &quot;LOAD&quot;
  &quot;FROM&quot;
  &quot;FOREACH&quot;
  &quot;MERGE&quot;
  &quot;OPTIONAL&quot;
  &quot;UNION&quot; (line 7, column 1 (offset: 207))
&quot;:commit&quot;
 ^
```

And no node has been added (which is exactly what is supposed to happen for an error in a transaction):

```
MATCH (c:Constant) RETURN c;
+---+
| c |
+---+
+---+

0 rows available after 5 ms, consumed after another 2 ms
```

Any idea, what exactly I am doing wrong?


  [1]: https://neo4j.com/docs/cypher-manual/current/clauses/merge/#merge-merge-with-on-create
  [2]: https://stackoverflow.com/a/22338998/2092322
  [3]: https://neo4j.com/docs/operations-manual/current/tools/cypher-shell/#cypher-shell-transactions",1612959383,https://stackoverflow.com/q/66136725,BairDev,"['cypher', 'cypher-shell', 'neo4j']"
66127604,Is there any way i can run cypher command starting from :Param using py2neo 2021.0.0,"Well, in neo4j i am trying to achieve this simple query to save the sparql keyword to use in later query and graph.run is not allowing me to do it. It is showing a syntax error

    graph.run(&quot;:PARAM sparql: &#39;PREFIX sch: &lt;http://schema.org/&gt; CONSTRUCT{?item a sch:item; sch:legalIdentity ?legalIdentity} WHERE { {?item p:P31/ps:P31 wd:Q783794 optional { ?item wdt:P1278 ?legalIdentity} } UNION {?item p:P31/ps:P31 wd:Q4830453 optional { ?item wdt:P1278 ?legalIdentity}} UNION {?item p:P31/ps:P31 wd:Q43229 optional { ?item wdt:P1278 ?legalIdentity}} UNION {?item p:P31/ps:P31 wd:Q6881511 optional { ?item wdt:P1278 ?legalIdentity}}}&#39;&quot;)

And following line is the cypher query which uses sparql keyword

    graph.run(&#39;CALL n10s.rdf.import.fetch(&quot;https://query.wikidata.org/sparql?query=&quot; + apoc.text.urlencode($sparql), &quot;RDF/XML&quot;, { headerParams: { Accept: &quot;application/rdf+xml&quot;} });&#39;)
",1612906920,https://stackoverflow.com/q/66127604,Cinya,"['python', 'neo4j', 'cypher', 'graph-databases', 'py2neo']"
66126733,Neo4j errorMessages&#39;: {&#39;Invalid input \&#39;a\&#39;: expected \&#39;u/U\&#39;},"I have the following cypher code
```
CALL apoc.periodic.iterate(
        &quot;LOAD CSV WITH HEADERS FROM $url AS row 
         WITH row {{.*}}
         RETURN row&quot;,
        &quot;CALL apoc.merge.node([&#39;House&#39;], 
                              {{id : row.ID}}, 
                              apoc.map.submap(row,[&#39;household&#39;]),
                              apoc.map.submap(row,[&#39;household&#39;]))
        YIELD node AS n1
        CALL apoc.create.addLabels(n1, [&#39;House&#39;])
        YIELD node as n2
        CREATE CONSTRAINT constraint_name IF NOT EXISTS ON (n:House) ASSERT n.household IS UNIQUE
        YIELD node as n3
        RETURN COUNT(n1)
        &quot;,
        {{batchSize: {batch_size}, iterateList: true, parallel:false, params: {{url: &#39;{url}&#39;}} }})
```
I get the errorMessages&#39;: {&#39;Invalid input \&#39;a\&#39;: expected \&#39;u/U\&#39; CREATE CONSTRAINT constraint_name IF NOT EXISTS ON (n:House) ASSERT n.household IS UNIQUE} 
**do you know how to solve this issue?** ",1612903047,https://stackoverflow.com/q/66126733,Nicolapo,"['cypher', 'neo4j-apoc', 'unique-constraint', 'neo4j']"
66123828,Query to check all source status in node is complete?,"This query deletes the node which has status complete but there are other status like incomplete or failed within the sources which gets deleted. How can I check whether all the sources in the node has status complete and delete the node?

```
MATCH (n:Sub)-[:HAS]-&gt;(s:Source{status:&#39;COMPLETE&#39;}) DETACH DELETE n
```


",1612891244,https://stackoverflow.com/q/66123828,Anu,"['neo4j', 'cypher']"
66123772,"Skiping relationship creation if already exist, not about MERGE","I am new to neo4j, my data is in csv files trying load them in db and create relationships.

departments.csv(9 rows)

    dept_name
    dept_no

dept_emp.csv(331603 rows)

    dept_no
    emp_no
    from_date
    to_date

I have create nodes with labels departments and dept_emp with all columns as properties. now trying to create relationship between them.

    CALL apoc.periodic.iterate(&quot;
    load csv with headers from &#39;file:///dept_emp.csv&#39; as row return row&quot;,
    &quot;match(de:dept_emp)
    match(d:departments)
    where de.dept_no=row.dept_no and d.dept_no= row.dept_no
    merge (de)-[:BELONGS_TO]-&gt;(d)&quot;,{batchSize:10000, parallel:false})

I do have indexes on :dept_emp and :departments

When I try to run this it is taking ages to complete(many days). When I change the batch size to 10 it created 331603 relations, but it kept on running until it completes all the batches which is taking too long. When it encounters 9 different dept_no at initial rows in dept_emp.csv it is creating all the relations but it has to complete all the batches. In each batch it has to scan all the 331603 relations which were create in first two batches or so. Please help me with optimizing this.

Here I have used apoc.periodic.iterate to deal with the huge data in future, here how the data is related and how I am trying to establish the relation is making the problem . Each department will be having many dept_emp nodes connected.

Currently using Neo4j 4.2.1 version

Max heap size is 1G due to my laptop limitations.

",1612890954,https://stackoverflow.com/q/66123772,fruta,"['neo4j', 'neo4j-apoc', 'cypher']"
66117152,Relationships between nodes are not created or updated,"I have 2 types of nodes in my database: BOOK and WRITTER.

The two nodes has the id property named &#39;id&#39;:
   

    {
      &quot;identity&quot;: 20220,
      &quot;labels&quot;: [
        &quot;WRITTER&quot;
      ],
      &quot;properties&quot;: {
    &quot;title&quot;: &quot;Eliott&quot;,
    &quot;id&quot;: &quot;Eliott&quot;
      }
    }
    
    {
      &quot;identity&quot;: 1,
      &quot;labels&quot;: [
        &quot;BOOK&quot;
      ],
      &quot;properties&quot;: {
    &quot;title_book&quot;: &quot;book_1&quot;,
    &quot;id&quot;: 2
      }
    }

I would like to have the relationships between them. I have a dataframe where each row represent the source_id(WRITTER nodes) and the target_id(BOOK nodes).

The dataframe df_relationships looks like this:

    bookid writterid
    1      &#39;James&#39;
    2      &#39;Eliott&#39;

I tried this but nothing is happening:

    request = &quot;&quot;&quot;
    UNWIND $data as row
    MATCH (b:BOOK), (w:WRITTER)
    WHERE b.id = row.bookid AND w.id= row.writterid
    MERGE (w)-[:HAS_WRITTEN]-&gt;(b)
    &quot;&quot;&quot;
    params = list()
    for i, row in df_relationships.iterrows():
        params.append({&#39;id&#39;:row.bookid, &#39;id&#39;:row.writterid})
        if i % 5000 == 0:
            session.run(request , {&#39;data&#39;:params})
            params = []
    session.run(request , {&#39;data&#39;:params})


I see no errors",1612866590,https://stackoverflow.com/q/66117152,jos97,"['cypher', 'neo4j']"
66112642,How to recover deleted nodes and relationships in neo4j,"I accidentally deleted all nodes and relationships in my graph db. Is there a way I can cancel the last run query? 

Thank you! ",1612842024,https://stackoverflow.com/q/66112642,B89,['neo4j']
66103976,Graphlytic Desktop error Neo4j Graph is not running.Please start Neo4j Graph and then restart Graphlytic,"I&#39;m using Graphlytic Desktop installed in Neo4j Desktop and I&#39;m seeing this error: &quot;Neo4j Graph is not running. Please start Neo4j Graph and then restart Graphlytic&quot;. 
I&#39;m new to this and don&#39;t know what to do. ",1612796206,https://stackoverflow.com/q/66103976,JabyCoby,"['graphlytic', 'neo4j']"
66102171,How to connect to neo4j on remote server using cytoscape neo4j plugin,"I installed cytoscape 3.8.2 and Cytoscape Neo4j Plugin (http://apps.cytoscape.org/apps/cytoscapeneo4jplugin). I&#39;ve generated a small neo4j graph, which is situated on a remote server.

When trying to connect to neo4j using the plugin I get following error: &quot;Cannot connect to neo4j&quot;

What am I doing wrong? Is it not possible to connect to neo4j when the instance is situated on a remote server?",1612789243,https://stackoverflow.com/q/66102171,Michele,"['cytoscape', 'neo4j']"
66094441,"Creating relationships across dispartate hierarchies, with Pandas/Neo4J","I have a dataset when parsed into a dataframe looks similar to 

    document_id  tax_0 tax_1  tax_2 tax_3 tax_4

where document_id(int) is distinct. document_id can have any amount of unique taxonomies(str) (tax_*).  tax_0, and tax_1 are never null and are unique per document_id. So tax_[0:4] is hierarchical.  I have the relationships between the hierarchical components, but now want to build a graph like output/dataset, that could show that relationships through document_id against different hierarchies.  So for example, Tumor and Gene are both tax_0&#39;s, and i want to find overlaps and relate them to their common document_id(s).

I have not asked a question of this sort (with no problem to solve), hopefully there is ample information.
I&#39;m new to panda&#39;s, have been writing python for years, and been waylaid along the way in Management positions.  I only state that b/c i don&#39;t have a &quot;What have you done so far&quot;.  I&#39;m not looking for solved problem as much as advice on direction.  Is this possible with just pandas, i&#39;m sure the answer is yes, would it be better to load the result into something like Neo4J?  Ultimately i will want to display this in graphs.  

",1612743081,https://stackoverflow.com/q/66094441,ekydfejj,"['neo4j', 'python', 'pandas']"
66085773,neo4j admin import csv with multiple labels fails to parse labels when array delimiter are enabled,"
The default import `bin/neo4j-admin import --database movies1 --nodes=import/movies.csv` works fine.
&gt; NOTICE: you must execute `CREATE DATABASE movies1` from the browser to see the created database
The result looks like:

[![enter image description here][1]][1]

However, when enabling array columns using `bin/neo4j-admin import --database movies2 --array-delimiter=&quot;|&quot; --nodes=import/movies.csv`, neo4j admin import csv tool no longer is parsing the multiple labels correctly:

[![enter image description here][2]][2]

The `movies.csv` from the examples:

    movieId:ID,title,year:int,:LABEL
    tt0133093,&quot;The Matrix&quot;,1999,Movie
    tt0234215,&quot;The Matrix Reloaded&quot;,2003,Movie;Sequel
    tt0242653,&quot;The Matrix Revolutions&quot;,2003,Movie;Sequel



How can I combine array columns with multi labels?


  [1]: https://i.stack.imgur.com/846ko.png
  [2]: https://i.stack.imgur.com/Kmmoy.png",1612685266,https://stackoverflow.com/q/66085773,Georg Heiler,"['neo4j', 'cypher', 'csv']"
66076600,neo4j query conversion to use in function,"I have such query, which normally accepts one argument in `{}` brackets.

    MATCH (pr:Person)-[:person_successor]-&gt;(next:Person)
      WHERE (:Queue {name: &#39;A&#39;}) -[:queue_person]-&gt; (pr)
      RETURN pr.name, next.name

I want to pass as `Queue name` several possible arguments instead of one, e.g. `{name: &#39;A&#39; or name: &#39;B&#39;}`. So I want to have people and their successors from many queues. Queues are also connected one to another.
But such query is not possible and throws exception:

    MATCH (pr:Person)-[:person_successor]-&gt;(next:Person)
      WHERE (:Queue {name: &#39;A&#39; or name: &#39;B&#39;}) -[:queue_person]-&gt; (pr)
      RETURN pr.name, next.name

Instead of above, works sth like this:

    MATCH (q:Queue)-[:queue_person]-&gt;(pr:Person)-[:person_successor]-&gt;(:next:Person)
      WHERE q.name in [&#39;A&#39;,&#39;B&#39;]
      RETURN pr.name, next.name

But I would like to use `(pr:Person)-[:person_successor]-&gt;(next:Person)` instead of `(q:Queue)-[:queue_person]-&gt;(pr:Person)-[:person_successor]-&gt;(:next:Person)` because somehow it spoil person order so as a result I do not have:

A B

B C

C D

D E ...

It is disturbed somehow because of `queue` in match clause.

Is it possible to pass arguments, in second line, in where clause and keep also there relation between queue and person `-[:queue_person]-&gt; (pr)` like in below not working snippet query?

    WHERE (:Queue {name in [&#39;A&#39;,&#39;B&#39;]) -[:queue_person]-&gt; (pr)",1612612492,https://stackoverflow.com/q/66076600,gorrch,"['neo4j', 'cypher']"
66069889,grandstack add mutation with relationship,"i&#39;m able to call a mutation in order to insert a node,
but what if i want to insert the relationship with another node as well?


I saw that the grandstack has generated some mutations of this type:  `AddGroupUsers`  &lt;Add-Type1-Type2&gt;


How can i call this mutation togeder with the node insert mutation? a sort of transaction? is it possible?
Does it exist a way to define the relationship with the node in the same mutation?

",1612555496,https://stackoverflow.com/q/66069889,alex,"['neo4j-graphql-js', 'grandstack', 'neo4j', 'graphql-mutation', 'graphql']"
66069308,How to Pass Input Value into Cypher Query?,"I&#39;m running nodejs and from an ejs page, I&#39;m trying to send an input value into a Cypher query that will result in a vis.js display of a graph.
**Note**: All javascript actions are taking place on the ejs page, there is no server contact in this case.

I can render the Neo4j graph no problem when running the query **without** any attempts of adding the input value.

**This Works** Clicking this button...
```
    &lt;input type=&quot;submit&quot; onclick=&quot;displayGraph()&quot; value=&#39;Display Graph&#39; class=&quot;button&quot;&gt;
```
...runs this function which includes the Cypher query (no input in this query) and renders the Neo4j graph as expected.
```
    function displayGraph() {
        // Create the authorization header for the ajax request.
        AUTHORIZATION = &quot;Basic &quot; + btoa(&quot;abc&quot;+&quot;:&quot;+&quot;123&quot;);

        // Post Cypher query to return node and relations and return results as graph.
        restPost({
            &quot;statements&quot;: [
                {
                    &quot;statement&quot;: `MATCH (bry:Brewery)-[r:BREWS]-&gt;(b:Beer {name: &#39;Pliny the Elder&#39;})-[r2:IS_A]-&gt;(bt:BeerType)
                                    Optional Match (b)-[r3:BREWED_WITH]-&gt;(h:Hop) 
                                    Return bry,r,b,r2,bt,r3,h`,
                    &quot;resultDataContents&quot;: [&quot;graph&quot;]
                }
            ]
        }).done(function (data) {
            
            // Parse results and convert it to vis.js compatible data.
            var graphData = parseGraphResultData(data);
            var nodes = convertNodes(graphData.nodes);
            var edges = convertEdges(graphData.edges);
            var visData = {
                nodes: nodes,
                edges: edges
            };
            displayVisJsData(visData);
        });
    }
```
**This Doesn&#39;t Work** If I use an input field to capture the name of a beer...
```
&lt;label&gt;
    Beer Name:&lt;input name=&quot;inputbeer&quot; id=&quot;inputbeer&quot; type=&quot;text&quot;&gt;
&lt;/label&gt;
```
...and then click the same button...
```
&lt;input type=&quot;submit&quot; onclick=&quot;displayGraph()&quot; value=&#39;Display Graph&#39; class=&quot;button&quot;&gt;

```
...I run the similar function, but have tried a number of variations on passing the input value into the Cypher query like this (everything is the same as the function seen above, just amending the Cypher query)...
```
MATCH (bry:Brewery)-[r:BREWS]-&gt;(b:Beer {name: &#39;$inputbeer&#39;})-[r2:IS_A]-&gt;(bt:BeerType)
                                    Optional Match (b)-[r3:BREWED_WITH]-&gt;(h:Hop) 
                                    Return bry,r,b,r2,bt,r3,h
```
...this and other variations don&#39;t work. I&#39;ve tried {name: {inputbeer}}... {name: {$inputbeer}}... {name: $inputbeer}... so many possibilities.
I&#39;m guessing it&#39;s a simple format issue, but I&#39;m at a loss. 

Thank you for any help!",1612552584,https://stackoverflow.com/q/66069308,Redink,"['cypher', 'forms', 'neo4j', 'ejs', 'javascript']"
66067906,Neo.DatabaseError.General.UnknownError when Neo4j 4.1.6 Enterpise edition is started using systemd,"I&#39;m getting this error when starting neo4j 4.1.6 Enteprise using systemd.


&gt; ERROR Client triggered an unexpected error
&gt; [Neo.DatabaseError.General.UnknownError]: null, reference
&gt; 6fc70117-9b0f-40c0-8dbe-9fe903136506.

But everything works fine when i manually start neo4j with the following command:

    neo4j start

Any help ?",1612546296,https://stackoverflow.com/q/66067906,Junior Ngangeli,['neo4j']
66066668,Add the first row of csv as the attributes of a node type - Neo4J,"I have csv with a lot of columns, which is why it&#39;s not a productive and automatic way to add all columns as attributes by hand when writing a query. The csv has the first row with the names of the columns, and the remaining rows represent the nodes with the values of the attributes.

I tried to add the attributes using ``SET += `` but doesn&#39;t work.
```
LOAD CSV FROM &#39;file:///stations.csv&#39; AS row
WITH row LIMIT 1
UNWIND row as att
WITH att
CREATE(n:Station)
SET n += att

```",1612541413,https://stackoverflow.com/q/66066668,bmalbusca,"['neo4j', 'neo4j-apoc', 'csv', 'import']"
66064172,"ClientError 404, cannot connect mongodb to neo4j","**Rather than going into painful process of bringing everything into neo4j, we I resorted to easier solution. As configuration is not my expertise https://medium.com/neo4j/transform-mongodb-collections-automagically-into-graphs-9ea085d6e3ef**

I followed instructions from [here][1] to configure (I want to import data in mongo to neo4j). I am in OSX Catalina. What endpoint should I be using? Following is my settings:


I have a virutal environment created with pipenv. 

    mongo-connector version: 3.1.1
    Python version: 3.9.1 
    pymongo version: 3.11.3
    MongoDB version: 4.4.3

`neo4j_doc_manager version: unknown` (well installed following instructions from the above). 

Now when I try to connect and run following 

    mongo-connector -m localhost:27017 -t http://localhost:11005/data/db -d neo4j_doc_manager

I used endpoint because I have following endpoints

    bolt: https://localhost:11004
    http: https://localhost:11005
    https: https://localhost:7473

my neo4j location 

    /Users/Library/Application Support/com.Neo4j.Relate/Data/dbmss/dbms-bbb9318b-9083-4ebf-a934-e17ef055ae22

I have disabled authentication:

    dbms.security.auth_enabled=false


I have no idea why I get HTTP 404:

    2021-02-05 08:11:15,577 [ALWAYS] mongo_connector.connector:50 - Starting mongo-connector version: 3.1.1
    2021-02-05 08:11:15,578 [ALWAYS] mongo_connector.connector:50 - Python version: 3.9.1 (default, Jan  8 2021, 17:17:17) 
    [Clang 12.0.0 (clang-1200.0.32.28)]
    2021-02-05 08:11:15,612 [ALWAYS] mongo_connector.connector:50 - Platform: macOS-10.15.7-x86_64-i386-64bit
    2021-02-05 08:11:15,612 [ALWAYS] mongo_connector.connector:50 - pymongo version: 3.11.3
    2021-02-05 08:11:15,619 [ALWAYS] mongo_connector.connector:50 - Source MongoDB version: 4.4.3
    2021-02-05 08:11:15,619 [ALWAYS] mongo_connector.connector:50 - Target DocManager: mongo_connector.doc_managers.neo4j_doc_manager version: unknown
    2021-02-05 08:11:15,633 [CRITICAL] mongo_connector.oplog_manager:713 - Exception during collection dump
    Traceback (most recent call last):
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/core.py&quot;, line 258, in get
        response = self.__base.get(headers=headers, redirect_limit=redirect_limit, **kwargs)
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/packages/httpstream/http.py&quot;, line 966, in get
        return self.__get_or_head(&quot;GET&quot;, if_modified_since, headers, redirect_limit, **kwargs)
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/packages/httpstream/http.py&quot;, line 943, in __get_or_head
        return rq.submit(redirect_limit=redirect_limit, **kwargs)
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/packages/httpstream/http.py&quot;, line 452, in submit
        return Response.wrap(http, uri, self, rs, **response_kwargs)
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/packages/httpstream/http.py&quot;, line 489, in wrap
        raise inst
    py2neo.packages.httpstream.http.ClientError: 404 Not Found
    
    The above exception was the direct cause of the following exception:
    
    Traceback (most recent call last):
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/mongo_connector/util.py&quot;, line 33, in wrapped
        return f(*args, **kwargs)
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/mongo_connector/doc_managers/neo4j_doc_manager.py&quot;, line 78, in bulk_upsert
        tx = self.graph.cypher.begin()
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/core.py&quot;, line 661, in cypher
        metadata = self.resource.metadata
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/core.py&quot;, line 213, in metadata
        self.get()
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/core.py&quot;, line 267, in get
        raise_from(self.error_class(message, **content), error)
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/util.py&quot;, line 235, in raise_from
        raise exception
    py2neo.error.GraphError: HTTP GET returned response 404
    
    During handling of the above exception, another exception occurred:
    
    Traceback (most recent call last):
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/mongo_connector/oplog_manager.py&quot;, line 668, in do_dump
        upsert_all(dm)
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/mongo_connector/oplog_manager.py&quot;, line 651, in upsert_all
        dm.bulk_upsert(docs_to_dump(from_coll), mapped_ns, long_ts)
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/mongo_connector/util.py&quot;, line 44, in wrapped
        raise new_type(str(exc_value)).with_traceback(exc_tb)
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/mongo_connector/util.py&quot;, line 33, in wrapped
        return f(*args, **kwargs)
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/mongo_connector/doc_managers/neo4j_doc_manager.py&quot;, line 78, in bulk_upsert
        tx = self.graph.cypher.begin()
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/core.py&quot;, line 661, in cypher
        metadata = self.resource.metadata
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/core.py&quot;, line 213, in metadata
        self.get()
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/core.py&quot;, line 267, in get
        raise_from(self.error_class(message, **content), error)
      File &quot;/Users/.local/share/virtualenvs/insiderTrading-L0T4T-gI/lib/python3.9/site-packages/py2neo/util.py&quot;, line 235, in raise_from
        raise exception
    mongo_connector.doc_managers.error_handler.Neo4jOperationFailed: HTTP GET returned response 404
    2021-02-05 08:11:15,634 [ERROR] mongo_connector.oplog_manager:723 - OplogThread: Failed during dump collection cannot recover! Collection(Database(MongoClient(host=[&#39;localhost:27017&#39;], document_class=dict, tz_aware=False, connect=True, replicaset=&#39;rs0&#39;), &#39;local&#39;), &#39;oplog.rs&#39;)
    2021-02-05 08:11:16,630 [ERROR] mongo_connector.connector:408 - MongoConnector: OplogThread &lt;OplogThread(Thread-2, started 123145708253184)&gt; unexpectedly stopped! Shutting down







  [1]: https://github.com/neo4j-contrib/neo4j_doc_manager/blob/master/docs/neo4j_doc_manager_doc.adoc",1612531914,https://stackoverflow.com/q/66064172,lpt,"['pymongo', 'neo4j', 'py2neo', 'mongo-connector']"
66062721,creating dynamic nodes and building relationships dynamically by Importing data from json files,"I have 3 JSON files namely VMDetails.json, Network.json, DataStore.json where the data for the graph DB is present. I had to import data from JSON files and create nodes and relationships

    CALL apoc.load.json(&quot;file:///DataStore.json&quot;) YIELD value AS data
    MERGE (d:DataStore{DataStore: data.DataStore})
    SET d.Name = data.Name,
    d.Type = data.Type,
    d.Capacity = data.Capacity,
    d.Free = data.Free
    WITH data as data
    CALL apoc.load.json(&quot;file:///Network.json&quot;)YIELD value AS net
    MERGE(n:Network{Network:net.Network})
    SET n.Name =net.Name
    WITH net AS nw
    CALL apoc.load.json(&quot;file:///VmDetails.json&quot;) YIELD value AS vm
    MERGE(n:Network{Name:vm.Network})
    MERGE(d:DataStore{Datastore:vm.DataStore})
    MERGE(v:UserV{vmName:vm.vmName})
    SET v.CPU= vm.CPU,
    v.ConnectionState = vm.ConnectionState,
    v.DataStore = vm.DataStore,
    v.Hostname = vm.Hostname,
    v.InstanceUuid = vm.InstanceUuid,
    v.IpAddress = vm.IpAddress,
    v.Network = vm.Network,
    v.NumEthernetCards = vm.NumEthernetCards,
    v.NumVirtualDisks = vm.NumVirtualDisks,
    v.OverallStatus = vm.OverallStatus,
    v.PowerState = vm.PowerState,
    v.RAM = vm.RAM,
    v.Uuid = vm.Uuid
    MERGE (n)-[:connected]-&gt;(v)
    MERGE (v)-[:related]-&gt;(d)

I used this query
I am able to create nodes correctly
While creating a relationship network node is creating the relationship with VM Node correctly but while creating the relationship with DataStore node and VM Node some new unwanted nodes are getting created and relationships are getting created with those unwanted nodes. Please tell me where I am going wrong in writing the query
 
",1612525688,https://stackoverflow.com/q/66062721,pooja narayan,"['neo4j', 'import', 'json']"
66062349,How to use d3.js on neo4j browser?,"I&#39;m trying to visualize a graph using d3.js that I created on neo4j. 
I can&#39;t understand how to do that. All the documents that I have found are too generic and I still don&#39;t know how to start d3.js script.",1612524056,https://stackoverflow.com/q/66062349,Nicola Alessandro Pugliese,"['neo4j-browser', 'neo4j', 'nosql', 'graph-databases', 'd3.js']"
66057205,In-Memory Caching of neo4j result for Pagination,"neo4j Version: 3.5 (can&#39;t upgrade to 4.0 as there are some incompatibilities with some apoc libraries)

I previously asked a question regarding pagination and so far it works. The only concern that I have, is the same concern of a previous post (https://stackoverflow.com/questions/28973111/cypher-pagination-total-result-count) wherein to implement paging, there needs to be 2 queries.

A similar question was asked 5 years ago (https://stackoverflow.com/questions/31646017/neo4j-query-result-cache) and I am wondering if the same constraint still holds true for version 3.5? The reason I am asking for this is that I find inconsistencies with my pagination approach.

The structure of my query is something like this (as the way neo4jclient can handle it)

```
   MATCH (required match queries)    // let&#39;s refer this as REQUIREDMATCH
    CALL apoc.cypher.run( REQUIREDMATCH ) YIELD VALUE
      WITH fields_from_required_match, VALUE.recordCount AS total ORDER BY sortvalue // establishing the sort
         SKIP X LIMIT Y
            OPTIONAL (optional match queries)
               WITH { a,b,c } AS MyObjects, total
                  RETURN collect(distinct MyObjects), total

```

So if you would notice, the REQUIREDMATCH queries are executed twice. I put the SKIP/LIMIT before the optional match so we can specify the range of records we are only getting for optional matches. The problem that I have experienced here is that if the results of my MATCH query is beyond the limit, it won&#39;t be picked up. 

Say I have one matching result and it is in the 12th index, if I do SKIP 0, LIMIT 10, results would be 0. If I do SKIP 0, LIMIT 50, the result would be 1. 

So my questions are:

1) Is there a way to cache the result of REQUIREDMATCH query and use that cache to get total and SKIP and LIMIT results?
2) As my code works, I suppose that there&#39;s no problem. But considering I have issues with returning SKIP and LIMIT result sets, could there be anything that I miss in structuring my query?",1612496056,https://stackoverflow.com/q/66057205,Patrick,"['neo4jclient', 'neo4j', 'c#']"
66048555,How to know if a Neo4j background job completed successfully?,"I&#39;m using Neo4j. For large data imports from external csvs, parquets, etc. there is a very handful command for &quot;fire and forget&quot;, the `apoc.periodic.submit`. There is also the `apoc.periodic.list` that list the background jobs.

During the execution of the background job it appears in the output of `apoc.periodic.list`. But after it finishes, either by an error or by a successful execution, it will disappear from this list without any feedback from the completion status.

Is there a general way to check if a background job finish status? Is there a more suitable API for my purposes?",1612452077,https://stackoverflow.com/q/66048555,Ot&#225;vio Vasques,"['neo4j', 'neo4j-apoc']"
66044895,How to include Sigma.js plugin in angular project?,I am using sigma.js for graph visualization from neo4j in my angular project. I am getting a graph from the neo4j database and able to successfully render on the UI as well but I want some style settings to be applied. For this I need some plugins but I am unable to correctly integrate the plugin in my project. On going through similar questions I tried adding the required plugin (eg - ```&lt;script src=&quot;sigma.renderers.edgeLabels.min.js&quot;&gt;&lt;/script&gt;```) in the scripts array inside the angular.json file but it doesn&#39;t seem to work. What am I doing wrong here?,1612438964,https://stackoverflow.com/q/66044895,akash,"['plugins', 'neo4j', 'angular', 'sigma.js', 'mean-stack']"
66037171,What determines how node names are displayed in Neo4j?,"I&#39;m trying to create a graph that is structured like so:

Region - hasDivision -&gt; Division - hasSalesRep -&gt; Sales Rep - hasCustomer -&gt; Customer

This works pretty well until the very end. The problem is that all the customer nodes have the same names as the sales reps they&#39;re associated with.

[![enter image description here][1]][1]

Each of these grey &#39;Christian ----&#39; nodes has an actual customer name attached to it as a property, and that&#39;s what should be displayed, but it isn&#39;t.

The mysterious thing to me is that I&#39;m using the same code, the same labeling scheme, and the same property scheme I&#39;ve used for region, division, and sales rep, all of which has worked fine.

I&#39;ve tried various experiments and things have only been weirder. If I only load in &#39;customer_name&#39; as a property, the nodes are grey blobs with no labels (but they do have customer_names attached). If I switch &#39;customer_name&#39; and &#39;rep_name&#39; when loading in the customer_dim.csv, all nodes have correct customer names attached to them. If I change rep_name to rep_nam (removing the &#39;e&#39;), everything goes back to grey blobs with no labels. 

What&#39;s going on? 

Here&#39;s loading the region

    LOAD CSV WITH HEADERS FROM &#39;file:///location_dim.csv&#39; AS region
    WITH 
    	region.REGION_NM AS REGION_NM
    MERGE (n:region {reg: REGION_NM})
    RETURN n

Here&#39;s loading the division.

    LOAD CSV WITH HEADERS FROM &#39;file:///location_dim.csv&#39; AS division
    WITH 
    	division.REGION_NM AS REGION_NM,
    	division.DIVISION_NM AS DIVISION_NM,
        division.STATE_PROVINCE_CD AS STATE_PROVINCE_CD
    MERGE (n:division {div: DIVISION_NM, reg: REGION_NM, state: STATE_PROVINCE_CD})
    RETURN n

Here&#39;s loading sales rep.

    LOAD CSV WITH HEADERS FROM &#39;file:///sales_rep_dim.csv&#39; AS row
    WITH 
    	row.SALES_REP_KEY AS SALES_REP_KEY,
    	row.SALES_REP_NM AS SALES_REP_NM,
        row.JOB_DESC AS JOB_DESC,
        row.WORK_STATE_PROVINCE_CD AS WORK_STATE_PROVINCE_CD
    MERGE (n:Sales_rep {sales_rep_key:SALES_REP_KEY, rep_name: SALES_REP_NM, job:JOB_DESC, state:WORK_STATE_PROVINCE_CD})
    RETURN n

Here&#39;s customers

    LOAD CSV WITH HEADERS FROM &#39;file:///customer_dim.csv&#39; AS customer
    WITH
    	customer.CUSTOMER_NM AS CUSTOMER_NM,
    	customer.SALES_REP_NM AS SALES_REP_NM
    MERGE (n:customer {customer_name:CUSTOMER_NM, rep_name:SALES_REP_NM})
    RETURN n

And here&#39;s me creating all the relationships

    MATCH (a:region), (b:division), (c:Sales_rep), (d:customer)
    WHERE a.reg = b.reg AND b.state = c.state AND c.rep_name = d.rep_name
    MERGE (a)-[:hasDiv]-&gt;(b)
    MERGE (b)-[:hasRep]-&gt;(c)
    MERGE (c)-[:hasCustomer]-&gt;(d)
    RETURN a,b,c,d

I&#39;ve tried removing and reordering the properties, but I keep running into the same issues.


  [1]: https://i.stack.imgur.com/m1cVN.png",1612394356,https://stackoverflow.com/q/66037171,Trent Fowler,"['neo4j', 'cypher']"
66024135,Is there a way to migrate a neo4j database with its relationships included?,"I was attempting to migrate the data of database in neo4j into a new database, set on a different machine.
In order to do so I ran the following command to create an export:

    CALL apoc.export.cypher.query(&#39;MATCH (a:Object)-[r]-(b:Object) WHERE NOT a:Type1 AND NOT a:Type2 RETURN *&#39;, &#39;/data/csv_destination/export.cypher&#39;,{format:&#39;cypher-shell&#39;});

After downloading the APOC library into the other database and placing the export file into the import folder, I tried to run this second command: 

    call apoc.cypher.runFile(&#39;export.cypher&#39;,{format:&#39;cypher-shell&#39;})

For some reason, it imports only the nodes, but not the relationships. I checked the export file and they are definitely specified. In case you wonder, the version of neo4j in the first database is 3.1.14, while on the second it is 4.2.0. Does anyone know how to solve this issue or provide any sort of help?",1612342417,https://stackoverflow.com/q/66024135,shell,"['neo4j', 'migration', 'import', 'export']"
66011409,Neo4J - How to merge nodes with the same attribute value (name) but different node labels,"I currently have duplicate name values across different node labels and I want to merge them. The issue is that every question I&#39;ve found online assumes that BOTH the attribute name and the labels are the same. The code I&#39;ve executed to query the instances I&#39;m referring to is:
```sql
MATCH (a)-[r:FEATURED_IN]-&gt;(b) WHERE a.name = b.name AND id(a) &lt;&gt; id(b)
```
So that means that &#39;a&#39; is featured in &#39;b&#39;, obviously &#39;a&#39; and &#39;b&#39; refer to the different node labels but the values are the same. How can I perform a merge to ensure that the &#39;b&#39; node is deleted and only the &#39;a&#39; node is returned? I know I could do this manually but there are so many instances of this that I would like to find a quick fix.

Thanks in advance.",1612275077,https://stackoverflow.com/q/66011409,Tous Shahedian-Farid,"['merge', 'neo4j', 'cypher']"
66009530,Neo4j Personalise PageRank performace,"I am using neo4j to generate recommendation using neo4j pagerank procedure . We have a neo4j instance with 137K nodes and 1.7 million relationships. I am using below procedure to get recommendation 

    MATCH (center:title {title: &quot;Relief Chef&quot;})
    CALL algo.pageRank.stream(&#39;title&#39;, &#39;HAS_LINK_TO&#39;, {iterations:5,weightProperty: &quot;weight&quot;, dampingFactor:0.85,sourceNodes: [center],concurrency:8})
    YIELD nodeId, score
    RETURN algo.asNode(nodeId).title AS page,score
    ORDER BY score DESC
    LIMIT 30;
On average its taking 4-5 seconds to get the result . how can i optimise it for the performance ?
",1612268022,https://stackoverflow.com/q/66009530,Nilesh Kathait,['neo4j']
66008846,How to get the intersection after union queries,"I am working on a project that uses a neo4j graph database. I am building a user interface that generates a cypher query to retrieve some results from the graph DB. Basically, I have patients that participate in procedures, and these procedures have numeric results. The idea is that the user can select different procedures, for instance &quot;Pa&quot;, &quot;Pb&quot;, and &quot;Pc&quot;, and also they can be restricted by their result; for example the result of &quot;Pa&quot; should be between 2 and 7. Then, the patients meeting the requirements should be extracted.

For this, I am generating a general query per procedure, and then, I use &quot;unions&quot; in order to put all together. For example (very simplified because my data model is more complex):

    MATCH (patient:Patient) 
    WITH patient 
    CALL { 
    WITH patient 
    MATCH (patient)-[:`isParticipantIn`]-&gt;(procedure:`Pa`)-[:`hasResult`]-&gt;(result:`ResultValue`)
    WHERE (result.hasValue &gt;= 2 AND result.hasValue &lt;= 7 ) 
    RETURN DISTINCT patient as patient_inner, procedure, result 
    
    UNION
      
    WITH patient 
    MATCH (patient)-[:`isParticipantIn`]-&gt;(procedure:`Pb`)-[:`hasResult`]-&gt;(result:`ResultValue`)
    RETURN DISTINCT patient as patient_inner, procedure, result 
    
    UNION
      
    WITH patient 
    MATCH (patient)-[:`isParticipantIn`]-&gt;(procedure:`Pc`)-[:`hasResult`]-&gt;(result:`ResultValue`)
    RETURN DISTINCT patient as patient_inner, procedure, result
    
    }
    
    RETURN DISTINCT patient.label, procedure.label, result.hasValue

This query could have the following results, which include all the patients that participates in &quot;Pb&quot;, or &quot;Pc&quot;, or &quot;Pa&quot; having a result between 2 and 7 since UNION implies an OR:
[Query results][1]

Nonetheless, I would like to allow an AND connection in order to retrieve all the patients that participate in &quot;Pb&quot; and &quot;Pc&quot; and &quot;Pa&quot; with a result between 2 and 7.

So, what I would like is to remove patient2 and patient3 because they did not meet the &quot;and&quot; condition.

The first problem I found is that everything is merged after the union and I can&#39;t know what row comes from what query. I can&#39;t use the procedure column because the user can select the same procedure several times in order to include different restrictions, which is translated in several unions with the same procedure. I can overcome this by including a constant in each union query as follows:

    MATCH (patient:Patient) 
    WITH patient 
    CALL { 
    WITH patient 
    MATCH (patient)-[:`isParticipantIn`]-&gt;(procedure:`Pa`)-[:`hasResult`]-&gt;(result:`ResultValue`)
    WHERE (result.hasValue &gt;= 2 AND result.hasValue &lt;= 7 ) 
    RETURN DISTINCT patient as patient_inner, procedure, result, &#39;id1&#39; as id
    
    UNION
      
    WITH patient 
    MATCH (patient)-[:`isParticipantIn`]-&gt;(procedure:`Pb`)-[:`hasResult`]-&gt;(result:`ResultValue`)
    RETURN DISTINCT patient as patient_inner, procedure, result &#39;id2&#39; as id
    
    UNION
      
    WITH patient 
    MATCH (patient)-[:`isParticipantIn`]-&gt;(procedure:`Pc`)-[:`hasResult`]-&gt;(result:`ResultValue`)
    RETURN DISTINCT patient as patient_inner, procedure, result, &#39;id3&#39; as id
    
    }
    
    RETURN DISTINCT patient.label, procedure.label, result.hasValue, id

Which results in:
[query results 2][2]

With this, I can collect the id per patient, and keep only those patients with &quot;id1&quot;, &quot;id2&quot; and &quot;id3&quot;:

    MATCH (patient:Patient) 
    WITH patient 
    CALL { 
    WITH patient 
    MATCH (patient)-[:`isParticipantIn`]-&gt;(procedure:`Pa`)-[:`hasResult`]-&gt;(result:`ResultValue`)
    WHERE (result.hasValue &gt;= 2 AND result.hasValue &lt;= 7 ) 
    RETURN DISTINCT patient as patient_inner, procedure, result, &#39;id1&#39; as id
    
    UNION
      
    WITH patient 
    MATCH (patient)-[:`isParticipantIn`]-&gt;(procedure:`Pb`)-[:`hasResult`]-&gt;(result:`ResultValue`)
    RETURN DISTINCT patient as patient_inner, procedure, result &#39;id2&#39; as id
    
    UNION
      
    WITH patient 
    MATCH (patient)-[:`isParticipantIn`]-&gt;(procedure:`Pc`)-[:`hasResult`]-&gt;(result:`ResultValue`)
    RETURN DISTINCT patient as patient_inner, procedure, result, &#39;id3&#39; as id
    
    }
    
    WITH patient, collect(id) as ids
    WHERE all(x in [&#39;p1&#39;, &#39;p2&#39;, &#39;p3&#39;] WHERE x IN ids)
    RETURN patient

The query returns the patient1, which is correct. However, here I have missed the procedures and the results of that patient. I can&#39;t include the procedure and the result variables in the WITH clause because it would modify the grouping of the id. I also have tried to collect and unwind these variables, but I think neo4j does not know how to relate them after the unwind operation, creating the cartesian product. Moreover, I think I can&#39;t use a graph pattern that matches the id, since id is artificially included and it is not a node, and possibly not related with patient nodes beyond the result table.

I have been investigating on custom procedures, but I found similar problems. For example, if the procedure receives a list of nodes, I have to collect them before calling it, which results in the problems I described before. Also, if the procedure receives a single node, it would be executed once per node in the results, and I do not have information about other nodes in order to do the grouping internally. I am not very sure if it would be possible to define a procedure with a resultset as input, together with the columns you want to use for grouping and for collecting, in order to do whatever you want.

Any clues on this? I could treat this by processing the results of the first query I showed, but I would prefer to have this behaviour in a single query without having to manipulate the results by hand.

Thanks beforehand.

  [1]: https://i.stack.imgur.com/dU9kT.png
  [2]: https://i.stack.imgur.com/l5iwR.png",1612265374,https://stackoverflow.com/q/66008846,fabad,"['neo4j', 'cypher']"
65995898,"Neo4j/Cypher attempting to UNWIND a list of user ids, create one Notification and relationship to all users that were matched","I have this cypher query: 
```
OPTIONAL MATCH (allMentionedUsers:User)
WHERE allMentionedUsers.id in $mentions
UNWIND allMentionedUsers as mentionedUser
CREATE (n:Notification {
    id: apoc.create.uuid(),
    notificationType: &#39;MENTION&#39;,
    notifierName: u.username,
    body: &#39;mentioned you&#39;,
    createdAt: datetime(),
    updatedAt: datetime()
})
CREATE (p)-[:HAS_NOTIFICATION]-&gt;(n)-[:NOTIFIES]-&gt;(mentionedUser)
```
that checks the variable `$mentions` (list of string ids) for possible User matches and then UNWINDs all matched users to create a Notification and subsequent relationships. `p` is another parent node and not too important for this question. `u` is also not important here and working as expected.

Essentially I want there to be one Notification with a `NOTIFIES` relationship to one or more User nodes. 

Currently the above statement creates a separate Notification per user. Anyone see how I can modify it to create one single Notification node that has as many `NOTIFIES` relationships to users that were matched?

It is creating multiple Notification nodes because the create is inside the UNWIND.",1612195105,https://stackoverflow.com/q/65995898,Matt Larson,"['graph-databases', 'cypher', 'neo4j', 'neo4j-apoc']"
65993141,Spring Data Neo4j 6 @ConvertWith implementation,"I am trying to implement a neo4j `@ConvertWith` on a list property.

    @ConvertWith(converter = &quot;SomeConverter.class&quot;) 
    List&lt;CustomObject&gt; customObject;

I see that the SomeConverter should impl -&gt;

    implements Neo4jPersistentPropertyConverter&lt;List&lt;CustomObject&gt;&gt;
but i cant get the conversion to work.. it always seems to ask for the required id property in the CustomObject

    java.lang.IllegalStateException: Required identifier property not found for class
It might not even go into my converter? 

Question: Whats the correct way to implement a converter for a list of objects?",1612184300,https://stackoverflow.com/q/65993141,Daniel Jeney,"['neo4j', 'spring-data-neo4j', 'spring-boot']"
65992672,Neo4J merge/union tables returned from same query but different nodes,"So I have a query along the lines of `MATCH (g:Gene)-[r]-() RETURN DISTINCT type(r), count(r)` which returns a breakdown table of the number of in/out-going edges from a gene node, per relationship type. 

I want to do this on a number of nodes and instead of doing it one table at a time, it would be awesome to just return a table with relationship types in one column and counts per gene on the subsequent ones. 

    MATCH (g:Gene {name: &quot;G1&quot;})-[r]-(n)
    RETURN DISTINCT type(r),  count(r) as g1
    UNION ALL MATCH (g:Gene {name: &quot;G2&quot;})-[r]-(n)
    RETURN DISTINCT type(r),  count(r) as g2

Doesn&#39;t work due to syntax error: `All sub queries in an UNION must have the same column names (line 3, column 1 (offset: 108))`. This is likely due to the fact that some genes don&#39;t have all the relationship types that others have. 

If I do the following:  

    MATCH (g:Gene {name: &quot;G1&quot;})-[r]-(n)
    RETURN DISTINCT type(r), null as g2, count(r) as g1
    UNION ALL MATCH (g:Gene {name: &quot;G2&quot;})-[r]-(n)
    RETURN DISTINCT type(r), null as g1, count(r) as g2

then I get duplicate rows for relationship types, where it&#39;s null for g1 in one and for g2 in the other. 

What am I misunderstanding here? ",1612182153,https://stackoverflow.com/q/65992672,posdef,"['cypher', 'neo4j']"
65985304,"Simplifying cypher, match all nodes and relationships between two node types","Is there anyway to further simplify this query?
I want to go from `kingdom` to all the `species`, there are nodes related towards the species nodes. The image shows the result of this query, but is there any way to match the `kingdom` node and all the nodes and relationships until the species node. If you like: all nodes/relationships between kingdom and species.
 
There will never be a node not attached to the kingdom or species objects (it&#39;s a taxonomic hierarchy).
The `RELTYPE` will probably change to something more meaningful.


    MATCH (k:Kingdom)-
    [:RELTYPE]-&gt;(p:Phylum)-
    [:RELTYPE]-(c:Class)-
    [:RELTYPE]-(o:Order)-
    [:RELTYPE]-(f:Family)-
    [:RELTYPE]-(g:Genus)-
    [:RELTYPE]-(s:Species)
    RETURN k, p, c, o, f, g, s

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/VQ9Fq.png",1612135393,https://stackoverflow.com/q/65985304,Spatial Digger,"['agens-graph', 'cypher', 'neo4j']"
65979542,Need to display single post of a user on each page Neo4j Cypher,"I want to display a single post of each user on each page in descending order by CreatedDateTime. &lt;br/&gt;For example:&lt;br/&gt;If John has created three posts 
&lt;br/&gt;Post A at 09:00 31-Jan
&lt;br/&gt;Post B at 10:00 31-Jan
&lt;br/&gt;Post C at 11:00 31 Jan

So the required output shoud be
&lt;br/&gt;Page 1 should display Post C
&lt;br/&gt;Page 2 should display Post B
&lt;br/&gt;Page 3 should display Post A

This means there will be 20 posts for 20 different users on a single page.

So far I wrote this query which displays all the posts on page one.

```
 MATCH (p:Posts)-[:CREATED_BY]-&gt;(u:User)
 WHERE p.CreatedDateTime &gt;= datetime(&#39;2021-01-31&#39;)
 RETURN p, u
 ORDER BY datetime(p.CreatedDateTime) DESC
 SKIP 0
 LIMIT 20
```

I know, need to use some subquery but don&#39;t have clue how to do that. 

TYIA",1612099008,https://stackoverflow.com/q/65979542,Zohaib,"['subquery', 'neo4j', 'cypher']"
65978616,Shortest Path between nodes of some specific type and destination node,"Say I want to find the shortest path between some node of a specific type (say &quot;central production unit&quot;) and a defined end node (say &quot;consumer&quot; with an id), how to I calculate this in Neo4j with Cypher?

With such queries i&#39;d like to answer questions like: &quot;Which production unit feeds this customer with the shortest distance&quot;.

I tried with queries like:

    match p=AllShortestPaths((source:Asset)-[:LINKS_TO*]-(destination:Asset))
    where source.type = &#39;central production unit&#39; and destination.id = &#39;1234&#39;
    return 	extract(n in nodes(p)| n.type) as type_path,
    		extract(n in nodes(p)| n.id) as id_path,
            length(p) as path_length;

queries like the one above will run into an out of memory error.

Using the same query but instead of a **type** of node, entering a specific **id** works perfectly fine. 

Sniffing around on Stackoverflow i&#39;ve found ceveral examples of 1 specific node to 1 other specific node, but not 1 yet to determine node of a certain type to 1 specific node.",1612092759,https://stackoverflow.com/q/65978616,DCB,"['path', 'cypher', 'shortest-path', 'neo4j', 'graph']"
65973902,Which elements from networkx graph might become labels at neo4j graph?,"I have a MultiDiGraph in networkx and I am thinking about exporting it to neo4j. I have already a property for the nodes called ntype and a property for the edges called dtype which fits with the label concept for nodes and edges for neo4j graphs.

Which elements from networkx might become labels at neo4j? How can it be managed?

I add an example of the graph at python and the graph I would like to get when exporting to neo4j.

Here is the code at python

    import networkx as nx

    G=nx.MultiDiGraph()
    
    G.add_nodes_from([
        (1,{&#39;ntype&#39;:&#39;NUMBER&#39;, &#39;color&#39;:&#39;blue&#39;}),
        (2,{&#39;ntype&#39;:&#39;NUMBER&#39;, &#39;color&#39;:&#39;yellow&#39;}),
        (&#39;A&#39;,{&#39;ntype&#39;:&#39;LETTER&#39;, &#39;state&#39;:&#39;done&#39;}),
        (&#39;B&#39;,{&#39;ntype&#39;:&#39;LETTER&#39;, &#39;state&#39;:&#39;pending&#39;})
        ])
    G.add_edges_from([
        (1,&#39;A&#39;,&#39;dir&#39;,{&#39;etype&#39;:&#39;IMPACTS&#39;, &#39;when&#39;:&#39;old&#39;}),
        (1,&#39;A&#39;,&#39;n_dir&#39;,{&#39;etype&#39;:&#39;IMPACTS&#39;, &#39;when&#39;:&#39;new&#39;}),
        (1,&#39;B&#39;,&#39;n_dir&#39;,{&#39;etype&#39;:&#39;ALTS&#39;, &#39;when&#39;:&#39;future&#39;}),
        (2,&#39;B&#39;,&#39;dir&#39;,{&#39;etype&#39;:&#39;IMPACTS&#39;, &#39;when&#39;:&#39;new&#39;}),
        (2,&#39;B&#39;,&#39;n_dir&#39;,{&#39;etype&#39;:&#39;IMPACTS&#39;, &#39;when&#39;:&#39;old&#39;}),
        (2,&#39;A&#39;,&#39;n_dir&#39;,{&#39;etype&#39;:&#39;ALTS&#39;, &#39;when&#39;:&#39;new&#39;}),
        ])
 
And here is the code at neo4j of the graph I would like to have when importing from networkx

    CREATE (one:NUMBER {name:1, color:&#39;blue&#39;})
    CREATE (two:NUMBER {name:2, color:&#39;yellow&#39;})
    CREATE (A:LETTER {name:&#39;A&#39;, state:&#39;done&#39;})
    CREATE (B:LETTER {name:&#39;B&#39;, state:&#39;pending&#39;})
    CREATE (one)-[:IMPACTS {k:&#39;dir&#39;, when:&#39;old&#39;}]-&gt;(A)
    CREATE (one)-[:IMPACTS {k:&#39;n_dir&#39;, when:&#39;new&#39;}]-&gt;(A)
    CREATE (one)-[:IMPACTS {k:&#39;n_dir&#39;, when:&#39;future&#39;}]-&gt;(B)
    CREATE (two)-[:ALTS {k:&#39;dir&#39;, when:&#39;new&#39;}]-&gt;(B)
    CREATE (two)-[:IMPACTS {k:&#39;n_dir&#39;, when:&#39;old&#39;}]-&gt;(B)
    CREATE (two)-[:ALTS {k:&#39;n_dir&#39;, when:&#39;new&#39;}]-&gt;(A)

[![This is a picture of the the graph][1]][1]


I have tried exporting in networkx to graphml and importing in neo4j as described here [enter link description here][2]. I also added the parameters *readLabels* and *storeNodeIds*. From the browser:

    CALL apoc.import.graphml(&quot;test.graphml&quot;, {readLabels: true, storeNodeIds:true})

Now I get the labels for the edges but I do not get the labels for the nodes. This is what I get:

[![enter image description here][3]][3]


  [1]: https://i.stack.imgur.com/NY0QC.png
  [2]: https://stackoverflow.com/questions/52210619/how-to-import-a-networkx-graph-to-neo4j
  [3]: https://i.stack.imgur.com/dhQwk.png",1612046852,https://stackoverflow.com/q/65973902,PabloG,"['neo4j', 'python', 'networkx']"
65971184,Neo4j ETL tool not able to import data of Online PostgreSQL database. Data imported with errors.NullPointerException,"I am importing my online postgreSQL database into my Neo4j database using the Neo-4j ETL Tool.
I am using PgAdmin 4.30 for postgreSQL 13 and Neo4j 1.4.1.
The ETL Tool says

&gt; Connection *myconn* saved. Connection successful. Catalog:
&gt; *mydatabase*, Schema: public

&gt; Mapping successful

&gt; Mapping saved successfully

&gt; Import successful

But the problem is that only the table name is imported and no relationships and no table data are imported.
The import mode &quot;Online direct Import from SQL&quot; or &quot;Bulk Import&quot; neither works.
The import log says

&gt; COMMAND: java -cp
&gt; &quot;C:\Users\*user*\.Neo4jDesktop\graphApps\_global\neo4j-etl-ui/dist/neo4j-etl.jar&quot;
&gt; org.neo4j.etl.NeoIntegrationCli export --mapping-file
&gt; &quot;C:\Users\*user*\AppData\Local\Temp/postgresql_db_mapping.json&quot;
&gt; --rdbms:password &quot;*mydatabase*&quot; --rdbms:user &quot;*user*&quot; --rdbms:url &quot;jdbc:postgresql://port/mydatabase?ssl=false&quot;
&gt; --options-file &quot;C:\Users\*user*\AppData\Local\Temp/import-tool-options.json&quot; --using
&gt; &quot;cypher:fromSQL&quot; --unwind-batch-size 1000 --tx-batch-size 10000
&gt; --neo4j:database-name *mydb* --neo4j:url &quot;bolt://localhost:7687&quot; --neo4j:user &quot;*user*&quot; --neo4j:password &quot;*password*&quot; LOG:
&gt; - Reading options from file C:\Users\*user*\AppData\Local\Temp\import-tool-options.json.
&gt; - Reading metadata mapping from file: C:\Users\*user*\AppData\Local\Temp/postgresql_mydb_mapping.json
&gt; - Direct driver instance 1971764991 created for server address localhost:7687
&gt; - Running ETL on Neo4j 4.1.0 - ENTERPRISE
&gt; - Direct driver instance 2063763486 created for server address localhost:7687
&gt; - Starting reading metadataMapping
&gt; - Creating constraints on nodes
&gt; - Creating constraint for label table1 and properties (table1)
&gt; - Creating constraint for label table2 and properties (table2)
&gt; - Creating constraint for label table3 and properties (table3)
&gt; - Creating constraint for label table4 and properties (table4)
&gt; - Creating constraint for label table5 and properties (table5)
&gt; - Creating constraint for label table6 and properties (table6)
&gt; - Creating constraint for label table7 and properties (table7)
&gt; - Creating nodes with label table1
&gt; - Creating nodes with label table2
&gt; - Creating nodes with label table3
&gt; - Creating nodes with label table4
&gt; - Creating nodes with label table5
&gt; - Creating nodes with label table6
&gt; - Creating nodes with label table7
&gt; - Creating relationships of type rel1
&gt; - Creating relationships of type rel2
&gt; - Creating relationships of type rel3
&gt; - Creating relationships of type rel4
&gt; - Creating relationships of type rel5
&gt; - Creating relationships of type rel6
&gt; - **Data imported with errors. Below the list of errors.**
&gt; - **For exception NullPointerException we got the following errors:**
&gt; - **Process failed null**
&gt; - **Closing driver instance 2063763486**
&gt; - **Closing connection pool towards localhost:7687**

Please help me or suggest me what to do. I don&#39;t know what to do here.
Any help will be appreciated.

Edit: I didn&#39;t had permission for a table in my postgres database. That is why the problem arised in the first place.",1612028412,https://stackoverflow.com/q/65971184,Priyankesh Raj,"['postgresql', 'etl', 'cypher', 'neo4j', 'relational-database']"
65967712,Configuration of embedded Neo4j to run APOC procedures,"I have cypher queries that make use of APOC functions. It works without problem if running the app directly but I would also like to test those queries. I tried to use [following](https://github.com/michael-simons/neo4j-examples-and-tips/blob/master/examples/testing-ogm-against-embedded-with-apoc/src/test/java/org/neo4j/tips/testing/testing_ogm_against_embedded_with_apoc/ApplicationTests.java#L53-L67) approach but getting an exception `Unknown function &#39;apoc.coll.toSet&#39;`

My sample test class:
```
public class ApocTest {
    private static Neo4j neo4j;
    private static Driver driver;

    @BeforeAll
    static void initializeNeo4j() {
        // Make sure that the plugins folder is listed in -cp
        Path pluginDirContainingApocJar = Paths.get(&quot;src/main/resources/neo4j-plugins/&quot;);

        if (!Files.exists(pluginDirContainingApocJar)) {
            throw new IllegalArgumentException(&quot;Invalid path to plugins directory&quot;);
        }

        neo4j = Neo4jBuilders
                .newInProcessBuilder()
                .withDisabledServer()
                .withFixture(&quot;CREATE (p1:Person)-[:knows]-&gt;(p2:Person)-[:knows]-&gt;(p3:Person)&quot;)
                .withConfig(GraphDatabaseSettings.plugin_dir, pluginDirContainingApocJar)
                .withConfig(GraphDatabaseSettings.procedure_unrestricted, List.of(&quot;apoc.*&quot;))
                .build();
        driver = GraphDatabase.driver(neo4j.boltURI(), AuthTokens.none());
    }

    @AfterAll
    static void stopNeo4j() {
        driver.close();
        neo4j.close();
    }

    @Test
    public void testApoc(){
        String query = &quot;MATCH path=()-[:knows*2]-&gt;()\n&quot; +
                       &quot;RETURN apoc.coll.toSet(nodes(path)) AS nodesSet&quot;;
        List&lt;Object&gt; nodesSet = driver.session()
                .beginTransaction()
                .run(query)
                .single()
                .get(&quot;nodesSet&quot;)
                .asList();
        assertEquals(3, nodesSet.size());
    }
}
```

Any idea how to fix that?

[This sample project on the github](https://github.com/Lukasmp3/neo4j-apoc-testing) 

Versions:
- neo4j-java-driver: 4.1.1
- neo4j-harness 4.1.6
- org.neo4j.procedure: 4.1.0.5

## Update:

So I tried to update:
```
Path pluginDirContainingApocJar = new File(
                ApocConfig.class.getProtectionDomain().getCodeSource().getLocation().toURI())
                .getParentFile().toPath();
```
That means that I don&#39;t need to manipulate with apoc jars, right?
But I&#39;m still getting error:
```
Caused by: org.neo4j.kernel.lifecycle.LifecycleException: Component &#39;org.neo4j.procedure.impl.GlobalProceduresRegistry@27dc627a&#39; was successfully initialized, but failed to start. Please see the attached cause exception &quot;Unable to set up injection for procedure `CypherProcedures`, the field `cypherProceduresHandler` has type `class apoc.custom.CypherProceduresHandler` which is not a known injectable component.&quot;.
	at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:463)
	at org.neo4j.kernel.lifecycle.LifeSupport.start(LifeSupport.java:110)
	at org.neo4j.graphdb.facade.DatabaseManagementServiceFactory.startDatabaseServer(DatabaseManagementServiceFactory.java:189)
	... 58 more
Caused by: org.neo4j.kernel.api.exceptions.ComponentInjectionException: Unable to set up injection for procedure `CypherProcedures`, the field `cypherProceduresHandler` has type `class apoc.custom.CypherProceduresHandler` which is not a known injectable component.
	at org.neo4j.procedure.impl.FieldInjections.createInjector(FieldInjections.java:98)
	at org.neo4j.procedure.impl.FieldInjections.setters(FieldInjections.java:81)
	at org.neo4j.procedure.impl.ProcedureCompiler.compileProcedure(ProcedureCompiler.java:264)
	at org.neo4j.procedure.impl.ProcedureCompiler.compileProcedure(ProcedureCompiler.java:226)
	at org.neo4j.procedure.impl.ProcedureJarLoader.loadProcedures(ProcedureJarLoader.java:114)
	at org.neo4j.procedure.impl.ProcedureJarLoader.loadProceduresFromDir(ProcedureJarLoader.java:85)
	at org.neo4j.procedure.impl.GlobalProceduresRegistry.start(GlobalProceduresRegistry.java:342)
	at org.neo4j.kernel.lifecycle.LifeSupport$LifecycleInstance.start(LifeSupport.java:442)
	... 60 more
```

## Update 2 - working on 4.0:
For some reason downgrade to Neo4j 4.0, same version as in [recommended](https://github.com/michael-simons/neo4j-examples-and-tips/blob/master/examples/testing-ogm-against-embedded-with-apoc/src/test/java/org/neo4j/tips/testing/testing_ogm_against_embedded_with_apoc/ApplicationTests.java#L53), was enough to make it working. Now I won&#39;t spend more time to try to run it on Neo4j 4.1/4.2.

[My code](https://github.com/Lukasmp3/neo4j-apoc-testing) ",1612008190,https://stackoverflow.com/q/65967712,Lukasmp3,"['neo4j-apoc', 'neo4j', 'cypher']"
65962466,Returning neo4j results to a C# object,"I have a query that returns a list of object with properties. Consider a C# object with like this structure:

```
public class Neo4jResult {
   public string Prop1 { get; set; }
   public string Prop2 { get; set; }
   public string Prop3 { get; set; }
}
```

The query returns a column called &quot;mycollection&quot; and I can store the results to something like this:

```
public async Task&lt;IEnumerable&lt;Neo4jResult&gt;&gt; MyNeo4jQuery() {
   var cypher = client.Cypher
      .Match(matchQuery)
      .WithParams(myParams);

   cypher =
      cypher.ReturnDistinct&lt;Neo4jResult&gt;(&quot;mycollection&quot;)
      .OrderBy(&quot;toLower(object.Prop1)&quot;);

   var query = (IOrderedCypherFluentQuery&lt;Neo4jResult&gt;)cypher;

   return await query.ResultsAsync;
}
```

This code works well. However, I had to get the count of this record as another property so my query now returns two columns - &quot;mycollection&quot;, and &quot;totalRecords&quot;. To facilitate this, I created a new object that reflects this:

```
public class Neo4jResultNew {
   public int TotalRecords { get; set; }
   public IEnumerable&lt;Neo4jResult&gt; Results { get; set; }
}
```

I have then changed my neo4j query to something like:

```
public async Task&lt;IEnumerable&lt;Neo4jResult&gt;&gt; MyComplexNeo4jQuery() {
   var cypher = client.Cypher
      .Match(matchQuery)
      .WithParams(myParams);

   cypher =
      cypher.Return&lt;Neo4jResultNew&gt;( (mycollection, totalRecords) =&gt; {
      {
         Results = mycollection.As&lt;IEnumerable&lt;Neo4jResult&gt;&gt;(),
         TotalRecords = totalRecords.As&lt;int&gt;()
      });

   var query = (IOrderedCypherFluentQuery&lt;Neo4jResultNew&gt;)cypher;

   return await query.ResultsAsync;
}
```

The error returned by neo4j is: &quot;Neo4j returned a valid response, however Neo4jClient was unable to deserialize into the object structure you supplied&quot;. I just followed the examples online but there&#39;s something missing in my projection maybe?
",1611958849,https://stackoverflow.com/q/65962466,Patrick,"['neo4jclient', 'c#', 'neo4j']"
65961061,Neo-4j ETL Tool won&#39;t connect to local postgres Server. org.postgresql.util.PSQLException: The authentication type 10 is not supported,"I am using Neo4j version 1.4.1 and PostgresSQL 13 with PgAdmin 4.30. I recently installed PostgreSQL 13, before that I had PostgreSQL 12 and PgAdmin 4.24 when this ETL import thing worked.

But now, after removing PostgreSQL 12, I was trying to import my local postgres database to Neo-4j using the neo4j ETL tool.

My input connection detail: 

&gt; Host= localhost  
&gt;Port= 5432  
&gt; Database= *mydatabasename*  
&gt; Connection URL= jdbc:postgresql://localhost:5432/*mydatabasename*
&gt; Username=*myUsername* password=&quot;mypassword&quot;

But when I click the Test and Save Connection button, it shows this error: 

&gt; Jan 30, 2021 1:10:43 AM org.postgresql.Driver connect SEVERE:
&gt; Connection error:  org.postgresql.util.PSQLException: The
&gt; authentication type 10 is not supported. Check that you have
&gt; configured the pg_hba.conf file to include the client&#39;s IP address or
&gt; subnet, and that it is using an authentication scheme supported by the
&gt; driver. 	at
&gt; org.postgresql.core.v3.ConnectionFactoryImpl.doAuthentication(ConnectionFactoryImpl.java:614)
&gt; 	at
&gt; org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:222)
&gt; 	at
&gt; org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:49)
&gt; 	at org.postgresql.jdbc.PgConnection.&lt;init&gt;(PgConnection.java:194) 	at
&gt; org.postgresql.Driver.makeConnection(Driver.java:431) 	at
&gt; org.postgresql.Driver.connect(Driver.java:247) 	at
&gt; java.sql.DriverManager.getConnection(DriverManager.java:664) 	at
&gt; java.sql.DriverManager.getConnection(DriverManager.java:247) 	at
&gt; org.neo4j.etl.rdbms.Support.testConnection(Support.java:32) 	at
&gt; org.neo4j.etl.rdbms.Support.main(Support.java:74)
&gt; 
&gt; Connection failed. SQL state: 08004, message: The authentication type
&gt; 10 is not supported. Check that you have configured the pg_hba.conf
&gt; file to include the client&#39;s IP address or subnet, and that it is
&gt; using an authentication scheme supported by the driver.

I took the help of this post [Unable to connect to Postgress DB due to the authentication type 10 is not supported][1]. I tried changing my *pg_hba.conf* settings and set the method to md5:

&gt; **local   all             all                                     md5**

I also configured my *postgresql.conf* like this: 

&gt; **listen_addresses = &#39;*&#39; port = 5432 max_connections = 100 password_encryption = md5**

But nothing worked. I even tried reinstalling PostgreSQL 13 and PgAdmin 4.30.

I downloaded the latest JDBC version and tried to connect using that postgresql-42.2.18.jre7, but the same error. When I&#39;m using a Java program to connect to this database, the connection is successful.

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class JavaPostgresIntegration {
    public static void main(String[] args) {
        Connection c = null;
        try {
            Class.forName(&quot;org.postgresql.Driver&quot;);
            c = DriverManager.getConnection(&quot;jdbc:postgresql://localhost:5432/mydatabase&quot;, &quot;postgres&quot;, &quot;mypassword&quot;);
        } catch (Exception e) {
            e.printStackTrace();
            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());
            System.exit(0);
        }
        System.out.println(&quot;Opened database successfully&quot;);
        try {
            c.close();
        } catch (SQLException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
    }
}
```

Output: *Opened database Successfuly*

(I am using the downloaded postgresql-42.2.18.jre7 for this program.)


  [1]: https://stackoverflow.com/questions/64210167/unable-to-connect-to-postgress-db-due-to-the-authentication-type-10-is-not-suppo

Edit: I installed PostgreSQL 12 and it solved the problem. While when I was connecting to PostgreSQL 13 using Neo4j the error was still there.",1611951012,https://stackoverflow.com/q/65961061,Priyankesh Raj,"['postgresql', 'jdbc', 'postgresql-13', 'neo4j']"
65960337,Neo4j Condition Based Output,"Question:
In Neo4j, I have relation `(p:Person)-[:HAS_DOCUMNET]-&gt;(id:Identification)-[:HAS_DESCRIPTION]-&gt;(d:Document)` and Required only 1 row data per person (personId,documentType and idNumber)
I required to develop query output on the basis of below priority condition 
1)If documentType=&quot;Passport&quot; is present then should come with personId and respected idNumber.(1st Priority)
2)If documentType=&quot;VoterCard&quot; is present then should come with personeId and respected idNumber.(If Passport is not present)
3)If documentType=&quot;PanCard&quot; is present then should come withe personId and respected idNumber.(If VoterId is not present)

Data Present like below:
```
(P1:Person)-[:HAS_Document]-&gt;(&#39;id1&#39;,&#39;id2&#39;,&#39;id3&#39;)-&gt;[:HAS_DESCRIPTION]-&gt;(&quot;Passpot&quot;,&quot;VoterCard&quot;,PanCard)`
(P2:Person)-[:HAS_Document]-&gt;(&#39;id4&#39;,&#39;id5&#39;)-&gt;[:HAS_DESCRIPTION]-&gt;(&quot;VoterCard&quot;,&quot;PanCard&quot;)`
(P3:Person)-[:HAS_Document]-&gt;(&#39;id6&#39;,&#39;id7&#39;,&#39;id8&#39;)-&gt;[:HAS_DESCRIPTION]-&gt;(&quot;PanCard&quot;,&quot;AadharCard&quot;,&quot;VoterCard&quot;)
(P4:Person)-[:HAS_Document]-&gt;(&#39;id9&#39;)-&gt;[:HAS_DESCRIPTION]-&gt;(&quot;PanCard&quot;)
```

Output should be like :
```
PName    Doc.Type     IDNumber
-------  -----------  ---------
  P1      &quot;Passport&quot;    id1
  P2      &quot;VoterCard&quot;   id4
  P3      &quot;VoterCard&quot;   id8
  P4      &quot;PanCard&quot;     id9
```
",1611947049,https://stackoverflow.com/q/65960337,R_Kalavadiya,"['database', 'database-partitioning', 'add', 'neo4j']"
65959752,Can you merge multiple dump files in Neo4j?,"I&#39;m in the midst of a data migration and there are constraints that are causing it to take a very long time. I&#39;d like to be able to split up the migration on different devices and then merge the dump files. 

Is this possible?",1611944230,https://stackoverflow.com/q/65959752,blakesters,"['database', 'neo4j']"
65959613,Cypher relating many nodes to one node,"Say I have all these objects in a graph:

    5ffcedc70cc70
    5ffd73259ad18
    5ffd7394311bf
    5ffd740fd836c
    5ffd74b7001fe
    5ffd746b3f457
    5ffd74fc7d21d
    5ffd75428691b
    5ffd75f0509e0
    5ffd7586a2916
    5ffd789434539
    5ffd78e65bae8
    5ffd794fcb91a

And I want to relate them to a single node:

    David

Singularly I&#39;d:

    MATCH (a:Object),(b:Person)
    WHERE a.name = &#39;5ffdbb309d9a6&#39; AND b.name = &#39;David&#39;
    CREATE (a)-[r:CREATEDBY]-&gt;(b);

Is there anyway to loop through a list of objects so I can say `(Object)-[CREATEDBY]-&gt;(David)`


",1611943538,https://stackoverflow.com/q/65959613,Spatial Digger,"['cypher', 'neo4j', 'agens-graph']"
65958466,Performance with pagination,"# Question

Given the following query:

    MATCH (t:Tenant)-[:lives_in]-&gt;(:Apartment)-[:is_in]-&gt;(:City {name: &#39;City1&#39;})
    RETURN t
    ORDER BY t.id
    LIMIT 10

So: &quot;Give me the first 10 tenants that live in City1&quot;

With the sample data below, the database will get hit for every single apartment in City1 and for every tenant that lives in each of these apartments.  
If I remove the `ORDER BY` this doesn&#39;t happen.  
I am trying to implement pagination so I need the `ORDER BY`. How to improve the performance on this?

# Sample data

    UNWIND range(1, 5) as CityIndex
    CREATE (c:City { id: CityIndex, name: &#39;City&#39; + CityIndex})
    WITH c, CityIndex
    UNWIND range(1, 5000) as ApartmentIndex
    CREATE (a:Apartment { id: CityIndex * 1000 + ApartmentIndex, name: &#39;Apartment&#39;+CityIndex+&#39;_&#39;+ApartmentIndex})
    CREATE (a)-[:is_in]-&gt;(c)
    WITH c, a, CityIndex, ApartmentIndex
    UNWIND range(1, 3) as TenantIndex
    CREATE (t:Tenant { id: (CityIndex * 1000 + ApartmentIndex) * 10 + TenantIndex, name: &#39;Tenant&#39;+CityIndex+&#39;_&#39;+ApartmentIndex+&#39;_&#39;+TenantIndex})
    CREATE (t)-[:lives_in]-&gt;(a)",1611938598,https://stackoverflow.com/q/65958466,Daniel Hilgarth,"['query-optimization', 'neo4j', 'cypher', 'performance']"
65957583,Query optimization that collects and orders nodes on very large graph,"I have a decently large graph (1.8 billion nodes and roughly the same number of relationships) where I am performing the follow query:

```
MATCH (n:Article)
WHERE n.id IN $pmids
MATCH (n)-[:HAS_MENTION]-&gt;(m:Mention)
WITH n, collect(m) as mentions
RETURN n.id as pmid, mentions
ORDER BY pmid
```
where $pmids are a list of strings, e.g. `[&quot;1234&quot;, &quot;4567&quot;]` where the length of this list varies from 100-500 length.

I am currently am holding the data within neo4j docker community instance with the following conf modifications: NEO4J_dbms_memory_pagecache_size=32G, NEO4J_dbms_memory_heap_max__size=32G. Index has been created for Article.id.

This query has been quite slow to run (roughly 5 seconds) and I would like to optimize to make for faster runtime. As part of work, I have access to neo4j enterprise so one approach would be to ingest this data as part of a neo4j enterprise account where I can tweak advanced configuration settings.

In general, does anyone have any tips in how I may improve performance, whether it be optimizing the cypher query itself, increase workers or other settings in neo4j.conf?

Thanks in advance.

For anyone interested - I posed this question in the [neo4j forums][1] as well and there have already been some interesting optimization suggestions (especially around the &quot;type hint&quot; to trigger backward-indexing, and using pattern comprehension instead of `collect()`


  [1]: https://community.neo4j.com/t/query-optimization-that-collects-and-orders-nodes-on-very-large-graph/32896/10",1611935256,https://stackoverflow.com/q/65957583,Mason Edmison,"['neo4j', 'cypher']"
65955854,Neo4J: How to correctly match key-value-pairs in Cypher query,"I have a question regarding my Cypther query. I want to attach certain values as properties to nodes with a certain id, which is also a proerty. 
So for the purposes of a small reproducible example let&#39;s say we have 3 ```nodes``` called ```car```. Each of these nodes has the property ```id```. Now for two ```nodes``` I have the value ```max_speed``` and these nodes I want to identify via the ```id```and attach the ```max_speed```. Therefore I have two lists ```id = [1, 2]``` and ```max_speed = [180, 200]```. And with this lists I want to update two of the three ```car``` nodes. So the node with the ```id = 1```should get the the ```max_speed = 180``` etc.

I guess my Cypher should look something like this, but unfortunately I don&#39;t know how to write the ```SET``` statement and would really appreciate your help.

```
MATCH (c:car)
WHERE ANY (id IN c.id WHERE id IN [1, 2])
SET ...
RETURN c 
```

Thank you very much in advance and have a nice weekend.

M.",1611928677,https://stackoverflow.com/q/65955854,Mischa,"['cypher', 'neo4j']"
65954426,How to use Neo4j for Android？,"I want to use neo4j-mobile-android ( here is the github [ https://github.com/neo4j-contrib/neo4j-mobile-android.git ]), but when using &quot;git clone https://github.com/UrsBoehm/Neo4A.git&quot;, there is an error [fatal: repository &#39;https://github.com/UrsBoehm/Neo4A.git/&#39; not found].

Is this the repository failure? And how do I get Neo4A or use neo4j for android? 

I would appreciate it if you could provide me with some useful information. Thank you very much!",1611923076,https://stackoverflow.com/q/65954426,Chen,"['neo4j', 'git', 'android']"
65952333,How can i fill a cypher query result to another neo4j database?,"i tried to use py2neo and run the code

```python
res = graph.run(&#39;MATCH p=()-[r:TargetGene]-&gt;() RETURN DISTINCT p LIMIT 3&#39;)
data = res.to_subgraph()
```

and it`s return a result like 

&gt;Subgraph({Node(&#39;Gene&#39;, Chromosome=&#39;8&#39;, Gene_name=&#39;MYC Proto-oncogene, BHLH Transcription Factor&#39;, Gene_symbol=&#39;MYC&#39;, Protein_name=&#39;Myc Proto-oncogene Protein&#39;, id=&#39;SMTT02203&#39;), Node(&#39;Mol&#39;, Alias=&#39;nan&#39;, Molecule_formula=&#39;nan&#39;, Molecule_name=&#39;Daturameteloside I&#39;, Molecule_structure=&#39;nan&#39;, Molecule_weight=&#39;636.86&#39;, OB_score=&#39;19.15225873&#39;, id=&#39;SMIT12398&#39;), Node(&#39;Mol&#39;, Alias=&#39;l-Evodiamine|CHEMBL486598|ZINC2031813|BDBM50366821&#39;, Molecule_formula=&#39;C19H17N3O&#39;, Molecule_name=&#39;Evodiamine&#39;, Molecule_structure=&#39;nan&#39;, Molecule_weight=&#39;303.363&#39;, OB_score=&#39;nan&#39;, id=&#39;SMIT01413&#39;), Node(&#39;Mol&#39;, Alias=&#39;nan&#39;, Molecule_formula=&#39;nan&#39;, Molecule_name=&#39;Threo-Austrobailignan-5&#39;, Molecule_structure=&#39;nan&#39;, Molecule_weight=&#39;326.42&#39;, OB_score=&#39;49.4868716&#39;, id=&#39;SMIT10425&#39;)}, {TargetGene(Node(&#39;Mol&#39;, Alias=&#39;nan&#39;, Molecule_formula=&#39;nan&#39;, Molecule_name=&#39;Daturameteloside I&#39;, Molecule_structure=&#39;nan&#39;, Molecule_weight=&#39;636.86&#39;, OB_score=&#39;19.15225873&#39;, id=&#39;SMIT12398&#39;), Node(&#39;Gene&#39;, Chromosome=&#39;8&#39;, Gene_name=&#39;MYC Proto-oncogene, BHLH Transcription Factor&#39;, Gene_symbol=&#39;MYC&#39;, Protein_name=&#39;Myc Proto-oncogene Protein&#39;, id=&#39;SMTT02203&#39;)), TargetGene(Node(&#39;Mol&#39;, Alias=&#39;nan&#39;, Molecule_formula=&#39;nan&#39;, Molecule_name=&#39;Threo-Austrobailignan-5&#39;, Molecule_structure=&#39;nan&#39;, Molecule_weight=&#39;326.42&#39;, OB_score=&#39;49.4868716&#39;, id=&#39;SMIT10425&#39;), Node(&#39;Gene&#39;, Chromosome=&#39;8&#39;, Gene_name=&#39;MYC Proto-oncogene, BHLH Transcription Factor&#39;, Gene_symbol=&#39;MYC&#39;, Protein_name=&#39;Myc Proto-oncogene Protein&#39;, id=&#39;SMTT02203&#39;)), TargetGene(Node(&#39;Mol&#39;, Alias=&#39;l-Evodiamine|CHEMBL486598|ZINC2031813|BDBM50366821&#39;, Molecule_formula=&#39;C19H17N3O&#39;, Molecule_name=&#39;Evodiamine&#39;, Molecule_structure=&#39;nan&#39;, Molecule_weight=&#39;303.363&#39;, OB_score=&#39;nan&#39;, id=&#39;SMIT01413&#39;), Node(&#39;Gene&#39;, Chromosome=&#39;8&#39;, Gene_name=&#39;MYC Proto-oncogene, BHLH Transcription Factor&#39;, Gene_symbol=&#39;MYC&#39;, Protein_name=&#39;Myc Proto-oncogene Protein&#39;, id=&#39;SMTT02203&#39;))})

_just a subgraph_

but when i tried to create graph to another neo4j database via the code followed:

```python
graph_anthor.create(data)
```

nothing happened, no output and the database is still empty.

i want to know why cause the problem, and find a way to achieve my goal. (__fill a cypher query result to another neo4j database__)

thanks&#128512;",1611914475,https://stackoverflow.com/q/65952333,Rintaro Zl,"['py2neo', 'neo4j']"
65952053,Store session details in database laravel-neo4j,"Hello everyone, 
               
I am new to `neo4j`. I have built a test app. It is a simple `laravel-neo4j` user login and register app. Everything works fine. But I want to store the session details in the database, not in the file. So I have tried [this](https://stackoverflow.com/questions/37439721/unable-to-store-session-in-database-in-laravel-5-2/39240363#39240363) method and got the `Undefined offset: 0` error. So please help me. I have given the link for docker and commands to run it. Please run this and help me to solve this problem. Right now the session is storing in the file. First, register an account then use that account for login. Thank you.

docker: https://drive.google.com/file/d/1q0Cd6QwaVnqyoWeUOHWnodWNCL24MBrj/view?usp=sharing

**Command to run docker file**
```
./docker_compose.sh build
./docker_compose.sh up
```

**URLs**

Front-end: http://0.0.0.0:8081/

Login: http://0.0.0.0:8081/login

Register: http://0.0.0.0:8081/register

Neo4j: http://0.0.0.0:8083/browser/

**Login credentials for neo4j:**
```
Username: neo4j
Password: root
```",1611913333,https://stackoverflow.com/q/65952053,Rich,"['neo4jphp', 'laravel', 'docker', 'neo4j', 'neoeloquent']"
65951297,Issue with Neo4j GDS 1.4.1 K-Spanning tree,"I&#39;m following Noe4j&#39;s online document at https://neo4j.com/docs/graph-data-science/current/alpha-algorithms/minimum-weight-spanning-tree/ , it seems that the Cypher to query K-Spanning tree doesn&#39;t work:
```
MATCH (n:Place)
WITH n.id AS Place, n.kminst AS Partition, count(*) AS count
WHERE count = 3
RETURN Place, Partition
```
Should it be modifyed to the following?
```
MATCH (n:Place)
WITH n.kminst AS Partition, count(*) AS count
WHERE count = 3
MATCH (n:Place)
WHERE n.kminst=Partition
RETURN n
```
I&#39;v downloaded the example transport data of the book &lt;[Graph Algorithms][1]&gt; from https://resources.oreilly.com/examples/0636920233145/tree/master/data, and loaded it into a graph database, all path algorithms of the package is O.K. except the K-Spanning tree, can&#39;t figure out how to make it work.
```
MATCH (source:Place {id: &quot;Amsterdam&quot;})
CALL gds.alpha.spanningTree.kmin.write({
     nodeProjection:&#39;Place&#39;,
     relationshipProjection:{
     EROAD:{
         type:&#39;EROAD&#39;,
         properties:&#39;distance&#39;,
         orientation:&#39;NATURAL&#39;
     }},
     startNodeId:id(source),
     relationshipWeightProperty:&#39;distance&#39;,
     writeProperty: &#39;kminst&#39;,
     k: 3
})
YIELD createMillis, computeMillis, writeMillis, effectiveNodeCount
RETURN createMillis, computeMillis, writeMillis, effectiveNodeCount

MATCH (n:Place)
WITH n.kminst AS partition, count(*) AS count
RETURN partition, count
```
There&#39;s no partition gets the value 3, so don&#39;t know how to extract the result with a Cypher like this:
```
MATCH (n:Place)
WITH n.kminst AS Partition, count(*) AS count
WHERE count = 3
MATCH (n:Place)
WHERE n.kminst=Partition
RETURN n
```
Any idea is appreciated.

  [1]: https://neo4j.com/graph-algorithms-book/",1611909991,https://stackoverflow.com/q/65951297,Jean,"['neo4j', 'algorithm']"
65950336,How to stop neo4j creating node if node already exists,"I&#39;ve been fiddeling around with neo4j for the last couple of days, but I keep running
into one issue.
Whenever I run my code it creates an entirely new node.

[![Issue][1]][1]


  [1]: https://i.stack.imgur.com/T7BNO.png

As seen obove there are two &quot;SELLER&quot; nodes and one &quot;BUYER,SELLER&quot; node.
The node name is &quot;Role&quot; and I&#39;d ideally want it to update if there is already a &quot;Role&quot; node
and only create a new node when there is no &quot;Role&quot; node yet.
Shown below is the query I&#39;ve written in C# so far, I can&#39;t get it to stop creating new nodes.
Hopefully the gods of stackoverflow can help a young lad out. haha

    query = query.Merge(&quot;(role:Role {roletype: $newRoleValue})&quot;)
                        .Set(&quot;role = $newRole&quot;)
                        .WithParam(&quot;newRole&quot;, new { Name = newTenderVersion.Organization.Role.ToString() })
                        .WithParam(&quot;newRoleValue&quot;, newTenderVersion.Organization.Role.ToString())
                        .Merge($&quot;(organization)-[:HAS_ROLE]-&gt;(role)&quot;);


=====
EDIT:

    query = query.Merge(&quot;(role:Role {roleType: $newRoleValue})&quot;)
                        .WithParam(&quot;newRoleValue&quot;, newTenderVersion.Organization.Role.ToString())
                        .Merge($&quot;(organization)-[:HAS_ROLE]-&gt;(role)&quot;);

So I&#39;ve figured out how to stop the node duplication, now the question remains.
How do I make sure that if an organization is only a SELLER, it will delete its BUYER nodes. 
",1611905247,https://stackoverflow.com/q/65950336,Stef van Stipdonk,"['neo4j', 'c#', 'cypher']"
65944903,How can I create a relationship at runtime in Neomodel?,"I am trying to create a relationship at runtime in Neomodel.  Let&#39;s say I have a Person model with no relationships:
```
class Person(StructuredNode):
    forename = StringProperty()
    surname = StringProperty()
```
At runtime there will be lots of relationships between people and these will be fed in dynamically.  I thought I could do something like the following to add a relationship dynamically at runtime.

```
for relationship in dynamic_relationships: #dynamic_relationships is a list
    r = RelationshipTo(&#39;Person&#39;, relationship) #error appears here
    person1.r.connect(person2)
```

However, the line marked gets a ```ValueError: call stack is not deep enough```

I&#39;m not sure what I&#39;m doing wrong.  Can I even declare a relationship at runtime in Neomodel?  Or will I have to use Cypher instead?


",1611866437,https://stackoverflow.com/q/65944903,jelly5798,"['python', 'neo4j', 'neomodel']"
65941539,Spring data neo4j SDN 6,"In SDN 6, @Deapth annotation is removed, and also in the latest 6.0.3, support for bi-directional relationship is added. Earlier it was giving StackOverflow while persisting a 2-way relation between the same node entities. For eg A-follows-&gt;B and B-follows-&gt;A.
Now, this type of relationship is possible but when you load the Node with find* methods, it gets overly slow because of the nested relation, and also Depth is removed so it loads the entire relationship. 
Do we have any workaround on this? ",1611852411,https://stackoverflow.com/q/65941539,Vimal23,"['neo4j', 'spring', 'spring-data-neo4j']"
65940549,Using a graph database for a mobile social network,"I am developing an Ionic application which works similar to a social network. Currently i am using Google Firestore to store the data. My plan is to also test the application with SQL and a graph database (i am thinking about Neo4j).
I am sure it would work well with SQL, as I have used that before, but I have a few questions about Neo4j/Graph databases, because i have not used those before.
1. I have seen that that Neo4j has support for Javascript, so it should work fine in Typescript, Ionic, correct?
2. Are graph databases (Neo4j) suitable for use in social networks (user login and such)
3. How hard is it to learn Cypher and Neo4j if im quite familiar with SQL and document databases (mongodb and firestore)",1611849001,https://stackoverflow.com/q/65940549,qlabfgerkaSmurf,"['neo4j', 'javascript', 'typescript', 'ionic-framework']"
65936669,Neo4j 3D graph node placement issue,"I am using JavaScript to bind Neo4J 3D-graph to HTML, my search query have multiple nodes, when displaying the nodes are scattering across the page, first will display at the center and later moving out.  Please help me to how to place all nodes at the center. 

Thanks,
Raja",1611835062,https://stackoverflow.com/q/65936669,Narasimha Raja,"['neo4j', 'javascript']"
65935470,Neo4J: using external storage,"I need to store sensible data in my project. To do so, Neo4J and its data need to be separated from each others, so the data itself can be stored in a secure environnement.

I was considering: using an external secured file system (NAS) to store these data, so that the VM running Neo4J won&#39;t contains any data itself (transitory or persisted).

**Questions**

1. Can Neo4J store all its data in an external File System?
2. Can Neo4J access the data from another VM ? If so, what would be the protocols that can be use ? 
3. What are the patterns (and best practices) to solve this use case ?

Thanks!",1611830565,https://stackoverflow.com/q/65935470,Hey StackExchange,"['neo4j', 'storage']"
65935376,Configuring force parameters in D3 so that all layers run in ellipsis (circles) with one central node,"Me and my developer are trying to get the force parameters right as to create this awesome visualisation, but we are having a hard time.

The visualisation should look like this:

[![Desired][1]][1]

But it currently looks like this:

[![Status quo][2]][2]


  [1]: https://i.stack.imgur.com/MLueG.png
  [2]: https://i.stack.imgur.com/OQIH7.png

Do you guys have some ideas on how we can solve this?

We are currently using these parameters, with the grey node being the central node:

    .force(&#39;collide&#39;, d3.forceCollide().strength(1).radius((d: any) =&gt; {
    if (d.labels[0] === &quot;Basis&quot;) {
    return 80;
    } else if (d.labels[0] === &quot;Thema&quot;) {
    return 70;
    } else if (d.labels[0] === &quot;Onderneming&quot;) {
    return 70;
    } else {
    return options.nodeRadius * 1.3;
    }
    }))
    var linkForce = d3.forceLink(relationships).id((d: any) =&gt; d.id).distance((d: any) =&gt; {
    if (d.type === &quot;WERKT_AAN&quot;) {
    return 120;
    } else if (d.type === &quot;DRAAGT_BIJ_AAN&quot;) {
    return 100;
    } else if (d.type === &quot;DRAAGT_BIJ_MET&quot;) {
    return 90;
    } else {
    return 90;
    }
    }
    ).iterations(2);
    simulation.force(&#39;link&#39;, linkForce);

and anchor central node to center of the screen",1611830187,https://stackoverflow.com/q/65935376,SHW,"['force-layout', 'd3.js', 'data-visualization', 'neo4j']"
65933069,Does Heroku has a way to support activegraph?(neo4j),"Activegraph which is an active model on top of neo4j-ruby-driver gem, however, the neo4j-ruby-driver gem requries libseabolt installed,https://github.com/neo4j-drivers/seabolt, but I did not figure out a way to install this extension on a running heroku instance since the running heroku instance is a read-only container, anyone have any idea about that",1611820711,https://stackoverflow.com/q/65933069,Leslie Binbin,"['neo4j', 'ruby-on-rails']"
65931528,nodejs javascript promise resolve,"I can&#39;t seem to figure out how to save the results of `SomeQuery` promise. Essentially I would like to take the value in `res` and pipe it into `parseQuery` function and return the final results. How do I make the parsed result accessible to an APIs response. 

``` javascript
const neo4j = require(&#39;neo4j-driver&#39;)
var parser = require(&#39;parse-neo4j&#39;)
const astria_queries = require(&#39;./astriaQueries&#39;)

const uri = &#39;bolt://astria_graph:7687&#39;
const user = &#39;xxx&#39;
const password = &#39;xxx&#39;

const someQuery = (query) =&gt; {
  //   run statement in a transaction
  const driver = neo4j.driver(uri, neo4j.auth.basic(user, password))
  const session = driver.session({ defaultAccessMode: neo4j.session.READ })
  const tx = session.beginTransaction()

  tx.run(query)
    .then((res) =&gt; {
      // Everything is OK, the transaction will be committed
      parseQuery(res)
    })
    .then(() =&gt; {
      // Everything is OK, the transaction will be committed
    })
    .catch((e) =&gt; {
      // The transaction will be rolled back, now handle the error.
      console.log(e)
    })
    .finally(() =&gt; {
      session.close()
      driver.close()
    })
}

const parseQuery = (result) =&gt; {
  try {
    const test = parser.parse(result)
    console.log(test)
  } catch (err) {
    console.log(err)
  }
}

module.exports = {
  someQuery,
}
```",1611812113,https://stackoverflow.com/q/65931528,rf guy,"['node.js', 'neo4j', 'es6-promise', 'async-await', 'javascript']"
65930337,Subqueries in neo4j 3.5 (for Pagination),"I am trying to implement a pagination using neo4j 3.5 and I realized that subqueries (such as Call {}) is not supported in this version. The common approach for pagination in this particular version is (https://stackoverflow.com/questions/28973111/cypher-pagination-total-result-count):

```
// -------------------------------------
// FIRST QUERY
// -------------------------------------
MATCH (x:Brand)
WITH count(*) as total

// -------------------------------------
// SECOND QUERY
// -------------------------------------
MATCH (o:Brand)
WITH total, o
ORDER BY o.name SKIP 5 LIMIT 5
WITH total, collect({uuid:o.uuid, name:o.name}) AS brands
RETURN {total:total, brands:brands}
```

This works if the block where we get the count is just a single type. I have a complex query that has nested matches like:

```
MATCH (px:Type1)-[:Relationship1]-&gt;(pvx:Type2 { prop:&#39;somevalue&#39;})-[:Relationship2]-&gt;(bx:Type3)						
     MATCH (px)-[:Rel3]-&gt;(ptx:Type4)
// and so on
```

To get the value of this complex query, I had to enclose the query inside &quot;apoc.cypher.run&quot;, which I was able to successfully get with this:

```
CALL apoc.cypher.run(&quot;MATCH (x:Type1) return count(*) as total&quot;, {})
YIELD value
return value.total
```

Is there a way to pass the result of this apoc.cypher.run to the second query, so I may be able to return the total number of records, as a variable in the second query?",1611802106,https://stackoverflow.com/q/65930337,Patrick,"['cypher', 'neo4j']"
65929497,Neo4j match using a list,"i have a node like this: (:a{name:&#39;&#39;,lname:&#39;&#39;,listNumb:[1,3,9]})
i want to select when 1 is in the array

this is what  itried to do 
`match (:a ) where a.listNumb=1 return a ;
or 
match (:a {listNumb=1})`
",1611794783,https://stackoverflow.com/q/65929497,Rita,"['neo4j', 'nosql']"
65928424,Creating a relationship between all nodes with a set property with Cypher,"First of all, I&#39;m a complete newbie with neo4j and cypher so I apologize if this is a dumb question. Right now I&#39;m not creating any actual database, I&#39;m just practicing in a sandbox with silly hypotethical databases I come up with to practice, then try to formulate queries.
My problem is the following: let&#39;s say I have a database with a number of animals, each having the property &quot;class&quot;

```
MERGE (a:Animal {name: &#39;cat&#39;})
ON CREATE SET a.class = &#39;mammal&#39;
```
```
MERGE (a:Animal {name: &#39;lizard&#39;})
ON CREATE SET a.class = &#39;reptile&#39;
```
```
MERGE (a:Animal {name: &#39;ant&#39;})
ON CREATE SET a.class = &#39;insect&#39;
```
Now let&#39;s say I want to know which of these animals has four limbs based on their class. Is there a way for me to tell the the graph I want to add the property 
```
a.limbs = 4
```
to every animal that already has the property &quot;mammal&quot; and &quot;reptile&quot; (let&#39;s pretend snakes don&#39;t exist), and not to a single node? And if I can do that, what would the query which could be interpreted as &quot;show me every animal who has four limbs&quot; be?

Many thanks
",1611786868,https://stackoverflow.com/q/65928424,Drum,"['cypher', 'neo4j']"
65926155,is it possible to use jqassistant output with graphlytic?,"I&#39;m currently struggling with circular dependencies and wanted to see all classes that are dependant on my desired class transitively.
  
I figured jqassistant is a tool to go to. I am already familiar with graphlytic, but can i somehow import the result of jqassistant into it? As far as i know jqassistant outputs some kind of html report.

Thanks in advance!",1611776136,https://stackoverflow.com/q/65926155,ibecar,"['neo4j', 'jqassistant', 'graphlytic']"
65924012,Unexpected relation and node COUNT in Neo4j,"Whenever I am using a query to get the count of a specific node, I always get the number greater than 1 even though there is only one distinct type of that node existing. 

Sample query:

` MATCH (p)-[rel]-&gt;(v:myDistinctNode)
RETURN COUNT(v)`

**Output**: 80

` MATCH (p)-[rel]-&gt;(v:myDistinctNode)
RETURN COUNT(DISTINCT v)`

**Output**: 1

I see different results while using DISTINCT, but I cannot use DISTINCT all the time. Why I am seeing this and how can I avoid it? Thanks!
Neo4j Kernel-Version: 3.5.14",1611767455,https://stackoverflow.com/q/65924012,ak2492,"['neo4j-apoc', 'neo4j', 'cypher']"
65922459,Neo4j/Cypher return the first element of the list of node labels as a property,"I&#39;m attempting to return a single node label as a property in a cypher query. I&#39;m using the GRANDstack, so I&#39;d like GraphQL to ask Neo4j for a list of nodes, each with the label as a property:
```
query GetPushNotificationsByUser($userId: ID!) {
    GetPushNotificationsByUser(userId: $userId) {
      id,
      label,
      title,
      message,
      status,
      externalUrl,
      createdAt {
        formatted
      }
    }
  }
```
I&#39;m attempting to use the `head()` and `labels()` functions for this, but so far unsuccessfully: 
```
MATCH (u:User {id: $userId})&lt;-[:NOTIFIES]-(pn:PushNotification {status: &#39;SENT&#39;})
WITH head(labels(pn)) as label, pn
RETURN pn
ORDER BY pn.createdAt DESC
```
AND
```
MATCH (u:User {id: $userId})&lt;-[:NOTIFIES]-(pn:PushNotification {status: &#39;SENT&#39;})
RETURN pn, head(labels(pn)) as label
ORDER BY pn.createdAt DESC
```
both return the &quot;PushNotifications&quot;, but sans the label property. Does anyone know how I can achieve this?",1611762036,https://stackoverflow.com/q/65922459,Matt Larson,"['graph-databases', 'grandstack', 'neo4j', 'graphql', 'cypher']"
65913592,Connection to the database terminated in Neo4j,"Getting below error from neo4j while connecting via Java driver. It comes only when I try to create more than 50000 relationships in transaction. It is successful even in 30,000 

```
Connection to the database terminated. Please ensure that your database is listening on the correct host and port and that you have compatible encryption settings both on Neo4j server and driver. Note that the default encryption setting has changed in Neo4j 4.0.
```

I couldn&#39;t understand why its failing for 50000 records and its working for 30000 records. If there is some transaction size then the error could mention the same. Pleas help me to get around it

I&#39;m using Neo4j Aura professional and java driver version is 4.1.1",1611726942,https://stackoverflow.com/q/65913592,Selvakumar Ponnusamy,"['java', 'neo4j']"
65912339,Neo4J - show current configuration setting,"Is there any way to show current configuration? Eg, like what we can do on mysql &quot;SHOW VARIABLES;&quot;
Because I try to use SSL on both BOLT and HTTPS. After I added the certificate, I am not sure am I using SSL on the connection or not. 

Thanks",1611716677,https://stackoverflow.com/q/65912339,Qwerty,['neo4j']
65910475,Neo4j not starting on Raspberry Pi (memory issues and java.lang.NoClassDefFoundError),"I am currently trying to install Neo4j on my Raspberry Pi. The [installation][1] for the latest version worked great so far.
When I tried ```neo4j start``` I received this error message but was able to resolve it by setting ```dbms.memory.heap.initial_size=12m``` and ```dbms.memory.heap.max_size=12m``` and ```dbms.memory.pagecache.size=1g``` (allthough that feels wrong to me since my Pi has 8GB of memory):
```
nohup: ignoring input
2021-01-26 21:54:18.409+0000 ERROR Invalid memory configuration - exceeds physical memory. Check the configured values for dbms.memory.pagecache.size and db&gt;
2021-01-26 21:54:18.436+0000 INFO  Neo4j Server shutdown initiated by request
2021-01-26 21:54:18.437+0000 INFO  Stopped.
```

**Now**, when I try to start neo4j I get this error in my logs:
```
nohup: ignoring input
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: Could not initialize class org.neo4j.configuration.GraphDatabaseSettings
        at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:105)
        at org.neo4j.server.NeoBootstrapper.start(NeoBootstrapper.java:90)
        at org.neo4j.server.CommunityEntryPoint.main(CommunityEntryPoint.java:35)
2021-01-26 22:20:55.271+0000 INFO  [o.n.s.CommunityBootstrapper] Neo4j Server shutdown initiated by request
2021-01-26 22:20:55.290+0000 INFO  [o.n.s.CommunityBootstrapper] Stopped.
```

I have now been trying to google the problem for a couple hours but I feel like I don&#39;t really know what to look for.

My setup:

- Raspberry Pi 4 (8 GB memory)
- Ubuntu Server (```uname -a``` returns ```Linux ubuntu 5.8.0-1011-raspi #14-Ubuntu SMP PREEMPT Tue Dec 15 08:53:29 UTC 2020 aarch64 aarch64 aarch64 GNU/Linux```)
- Java 11 (```java -version``` returns ```
openjdk version &quot;11.0.9.1&quot; 2020-11-04
OpenJDK Runtime Environment (build 11.0.9.1+1-Ubuntu-0ubuntu1.20.10)
OpenJDK 64-Bit Server VM (build 11.0.9.1+1-Ubuntu-0ubuntu1.20.10, mixed mode)```)
- Neo4j version 4.2.3


  [1]: https://debian.neo4j.com/",1611701830,https://stackoverflow.com/q/65910475,phill,"['neo4j', 'java', 'linux', 'ubuntu', 'raspberry-pi']"
65908235,Running Spark 2.4.4 with Neo4J connector getting TransientException for db version,"I am running a spark job (local mode) that writes to Neo4J 4.0.0 using neo4j-spark-connector

I use (because in this package release notes mentioned supporting spark 2.4.1+)
 https://github.com/neo4j-contrib/neo4j-spark-connector/releases/download/4.0.0-pre1/neo4j-spark-connector-2.11-4.0.0-pre1.jar

I tried all the latest releases but in all of them I get this exception after few minutes run when it starts writing the relationships and done with the node
It is writing relationships but always fails after a while
The error shows some database discrepancy but the neo4j is in the right version for this connector + it is writing some of the data, so I figured that it is kind of a lock. But, even running with 1 partition didn&#39;t solve.

org.neo4j.driver.exceptions.TransientException: Database &#39;neo4j&#39; not up to the requested version: 1297554. Latest database version is 1292675

**Code:**


    dsEdge.write
      .format(&quot;org.neo4j.spark.DataSource&quot;)
      .option(&quot;url&quot;, &quot;bolt:///:7687&quot;)
      .option(&quot;authentication.type&quot;, &quot;basic&quot;)
      .option(&quot;authentication.basic.username&quot;, &quot;0&quot;)
      .option(&quot;authentication.basic.password&quot;, &quot;0&quot;)
       .option(&quot;relationship&quot;, &quot;STATEMENT&quot;)
        .option(&quot;relationship.save.strategy&quot;, &quot;keys&quot;)
        .option(&quot;relationship.source.labels&quot;, &quot;:PageData&quot;)
        .option(&quot;relationship.source.save.mode&quot;, &quot;ErrorIfExists&quot;)
        .option(&quot;relationship.source.node.keys&quot;, &quot;id_src:id&quot;)
        .option(&quot;relationship.target.labels&quot;, &quot;:PageData&quot;)
        .option(&quot;relationship.target.node.keys&quot;, &quot;id_dst:id&quot;)
        .option(&quot;relationship.target.save.mode&quot;, &quot;ErrorIfExists&quot;)



**Full Stack Trace:**

    [Stage 5:&gt;                                                          (0 + 1) / 1]21/01/26 02:04:45 ERROR Utils: Aborting task
    org.neo4j.driver.exceptions.TransientException: Database &#39;neo4j&#39; not up to the requested version: 1297554. Latest database version is 1292675
    	at org.neo4j.driver.internal.util.Futures.blockingGet(Futures.java:143)
    	at org.neo4j.driver.internal.InternalSession.beginTransaction(InternalSession.java:98)
    	at org.neo4j.driver.internal.InternalSession.beginTransaction(InternalSession.java:92)
    	at org.neo4j.spark.writer.Neo4jDataWriter.writeBatch(Neo4jDataWriter.scala:52)
    	at org.neo4j.spark.writer.Neo4jDataWriter.write(Neo4jDataWriter.scala:43)
    	at org.neo4j.spark.writer.Neo4jDataWriter.write(Neo4jDataWriter.scala:20)
    	at org.apache.spark.sql.execution.datasources.v2.DataWritingSparkTask$$anonfun$run$3.apply(WriteToDataSourceV2Exec.scala:118)
    	at org.apache.spark.sql.execution.datasources.v2.DataWritingSparkTask$$anonfun$run$3.apply(WriteToDataSourceV2Exec.scala:116)
    	at org.apache.spark.util.Utils$.tryWithSafeFinallyAndFailureCallbacks(Utils.scala:1394)
    	at org.apache.spark.sql.execution.datasources.v2.DataWritingSparkTask$.run(WriteToDataSourceV2Exec.scala:146)
    	at org.apache.spark.sql.execution.datasources.v2.WriteToDataSourceV2Exec$$anonfun$doExecute$2.apply(WriteToDataSourceV2Exec.scala:67)
    	at org.apache.spark.sql.execution.datasources.v2.WriteToDataSourceV2Exec$$anonfun$doExecute$2.apply(WriteToDataSourceV2Exec.scala:66)
    	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
    	at org.apache.spark.scheduler.Task.run(Task.scala:123)
    	at org.apache.spark.executor.Executor$TaskRunner$$anonfun$10.apply(Executor.scala:408)
    	at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1360)
    	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:414)
    	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
    	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
    	at java.lang.Thread.run(Thread.java:748)
    	Suppressed: org.neo4j.driver.internal.util.ErrorUtil$InternalExceptionCause
    		at org.neo4j.driver.internal.util.ErrorUtil.newNeo4jError(ErrorUtil.java:83)
    		at org.neo4j.driver.internal.async.inbound.InboundMessageDispatcher.handleFailureMessage(InboundMessageDispatcher.java:105)
    		at org.neo4j.driver.internal.messaging.v1.MessageReaderV1.unpackFailureMessage(MessageReaderV1.java:83)
    		at org.neo4j.driver.internal.messaging.v1.MessageReaderV1.read(MessageReaderV1.java:59)
    		at org.neo4j.driver.internal.async.inbound.InboundMessageHandler.channelRead0(InboundMessageHandler.java:83)
    		at org.neo4j.driver.internal.async.inbound.InboundMessageHandler.channelRead0(InboundMessageHandler.java:35)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:99)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
    		at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324)
    		at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:296)
    		at org.neo4j.driver.internal.async.inbound.MessageDecoder.channelRead(MessageDecoder.java:47)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
    		at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324)
    		at org.neo4j.driver.internal.shaded.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:296)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)
    		at org.neo4j.driver.internal.shaded.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)
    		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)
    		at org.neo4j.driver.internal.shaded.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
    		at org.neo4j.driver.internal.shaded.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
    		... 1 more
    21/01/26 02:04:45 ERROR DataWritingSparkTask: Aborting commit for partition 0 (task 2179, attempt 0, stage 5.0)
    21/01/26 02:04:45 ERROR DataWritingSparkTask: Aborted commit for partition 0 (task 2179, attempt 0, stage 5.0)
    21/01/26 02:04:45 ERROR Executor: Exception in task 0.0 in stage 5.0 (TID 2179)

&lt;!-- end snippet --&gt;

I can&#39;t find a solution and could use some help
Thanks
",1611690473,https://stackoverflow.com/q/65908235,אור כהן אופיר,"['neo4j', 'apache-spark']"
65906762,Neo4j Cypher: Filtering a query results based on another query,"I am trying to find a list of names that unique to one query and exclude the ones that are common between the results of two queries. For example, I want the name of the classes that have been taken by students A, B, and C. And exclude from this list the classes that were taken by students D and E. With the help of the answer to this question (https://stackoverflow.com/questions/59397418/neo4j-cypher-exclude-certain-nodes-from-result/65904934#65904934), I tried this Cypher code and it works, but I get the results as nodes. I want it as a list of names, not nodes. 

    Match (m:class)-[r]-(n:student) where n.name in [&#39;aa&#39;,&#39;bb&#39;,&#39;cc&#39;]    
    WITH COLLECT(m) AS EXCLUDED
    MATCH  (m1:class)-[r1]-(n1:student) where n1.name in [&#39;dd&#39;,&#39;ee&#39;] 
    WITH EXCLUDED, COLLECT(m1) AS included
    RETURN FILTER(m1 IN included WHERE NOT m1 IN EXCLUDED)

Thank you!",1611684147,https://stackoverflow.com/q/65906762,Al Learner,"['cypher', 'neo4j']"
65906624,Neo4j Create node if no relationship exists,"From the MERGE documentation
    
    MATCH (person:Person)
    MERGE (city:City { name: person.bornIn })
    MERGE (person)-[r:BORN_IN]-&gt;(city)
    RETURN person.name, person.bornIn, city

The problem is, I want to create a Relationship and a Node, if the RELATIONSHIP does not exist, but in my graph all the nodes are identical so the second step would not create a new Node.

Since my graph is a tree I know that if the relationship i&#39;m looking for does not exist, the node also does not exist.

Giving the nodes  unique identifiers is not helpful as it would just be the path from the root node to the one i want to create. If I replace MERGE with CREATE it will create redundant nodes that are not connected to the tree. Since you cant use MERGE with WHERE, is there a way to do the equivalent of:

    MERGE (nextpos:Position) WHERE NOT (nextpos)--()

Which would create a node if there are no nodes without connections, allowing me in the next step to create the needed relationship. Or should I just remove all the redundant nodes afterwards? That would seem very hacky and I am hoping for an elegant solution.",1611683662,https://stackoverflow.com/q/65906624,Prog,"['tree', 'graph-databases', 'neo4j']"
65904123,"How to return a specific string instead of (no changes, no records) in Cypher query","my query below returns &quot;Success&quot; string if node n successfully matched.
In case it was not matched, the output is &quot;(no changes, no records)&quot; while I expect the query to return &quot;Failure&quot; string.
I guess this is to do with node n not existing and therefore 
&#39;with value.rslt&#39; is also not existing which returns nothing.
How can I get &quot;Failure&quot; return in case node n not matched?
Thank you

    match(n:device) where n.nid = &#39;non-existing&#39;
    CALL apoc.do.case(
    [
     n is not null, &quot;return &#39;Success&#39; as rslt&quot;
    ], 
    &quot;return &#39;Failure&#39; as rslt&quot;,
    {n:n}
    ) yield value
    with  value.rslt  as rslt 
    return rslt",1611674618,https://stackoverflow.com/q/65904123,Natalia Z,"['neo4j', 'cypher']"
65903344,Spring Boot neo4j performance,"we are evaluating in our company the possibilities with neo4j, we are using Java (&gt;1.8), Spring Boot (2.4.2) and SpringData-neo4j (2.4.2) to make simple queries and some performance tests, neo4j is running locally in a docker container using the official docker image. 

This is our setup:


the json structure

```
{
    &quot;id&quot;: null,
    &quot;addresses&quot;: [
      {
        &quot;id&quot;: null,
        &quot;city&quot;: &quot;South Thresa&quot;,
        &quot;country&quot;: &quot;Burundi&quot;,
        &quot;houseNumber&quot;: &quot;861&quot;,
        &quot;street&quot;: &quot;Auer Lake&quot;,
        &quot;zipCode&quot;: &quot;03412&quot;
      }
    ],
    &quot;bankAccounts&quot;: [
      {
        &quot;id&quot;: null,
        &quot;bankAccountNumber&quot;: null,
        &quot;bankName&quot;: null,
        &quot;bic&quot;: &quot;QVWPKO5H&quot;,
        &quot;blz&quot;: null,
        &quot;countryCode&quot;: null,
        &quot;divergentAccountHolder&quot;: null,
        &quot;iban&quot;: &quot;GB87DPZP84667918216002&quot;,
        &quot;sepaMandates&quot;: [
          {
            &quot;id&quot;: null,
            &quot;bankAccount&quot;: null,
            &quot;signatureCity&quot;: &quot;Lednerbury&quot;,
            &quot;signatureDate&quot;: &quot;06.10.1984&quot;
          }
        ]
      }
    ],
    &quot;contacts&quot;: [
      {
        &quot;id&quot;: null,
        &quot;email&quot;: &quot;tonisha.mitchell@gmail.com&quot;,
        &quot;faxNumber&quot;: &quot;087-835-0885 x859&quot;,
        &quot;mobilePhoneNumber&quot;: &quot;1-615-772-6922&quot;,
        &quot;phoneNumber&quot;: &quot;(082) 785-8108 x6736&quot;
      }
    ],
    &quot;birthDate&quot;: &quot;07.01.1966&quot;,
    &quot;firstName&quot;: &quot;Daniel&quot;,
    &quot;lastName&quot;: &quot;Hartmann&quot;,
    &quot;salutation&quot;: &quot;Mrs.&quot;,
    &quot;title&quot;: &quot;Lead Branding Orchestrator&quot;
  }
```

Entities:

```
@Node
public class Partner {
    @Id
    @GeneratedValue
    public Long id;
    @Relationship(type = &quot;ADDRESS&quot;, direction = Relationship.Direction.INCOMING)
    public List&lt;Address&gt; addresses;
    @Relationship(type = &quot;BANKACCOUNT&quot;, direction = Relationship.Direction.INCOMING)
    public List&lt;BankAccount&gt; bankAccounts;
    @Relationship(type = &quot;CONTACTS&quot;, direction = Relationship.Direction.INCOMING)
    public List&lt;Contact&gt; contacts;
    @Property
    public String birthDate;
    @Property
    public String firstName;
    @Property
    public String lastName;
    @Property
    public String salutation;
    @Property
    public String title;
}

@Node
public class Contact{
    @Id
    @GeneratedValue
    public Long id;
    @Property
    public String email;
    @Property
    public String faxNumber;
    @Property
    public String mobilePhoneNumber;
    @Property
    public String phoneNumber;

@Node
public class BankAccount{
    @Id
    @GeneratedValue
    public Long id;
    @Property
    public String bankAccountNumber;
    @Property
    public String bankName;
    @Property
    public String bic;
    @Property
    public String blz;
    @Property
    public String countryCode;
    @Property
    public String divergentAccountHolder;
    @Property
    public String iban;
    @Relationship(type = &quot;SEPA_MANDAT&quot;)
    public List&lt;SepaMandate&gt; sepaMandates;

@Node
public class Address{
    @Id
    @GeneratedValue
    public Long id;
    @Property
    public String city;
    @Property
    public String country;
    @Property
    public String houseNumber;
    @Property
    public String street;
    @Property
    public String zipCode;

@Node
public class SepaMandate{
    @Id
    @GeneratedValue
    public Long id;
    @Property
    public BankAccount bankAccount;
    @Property
    public String signatureCity;
    @Property
    public String signatureDate;
```

Repository:

```
public interface PartnerRepository extends Neo4jRepository&lt;Partner, Long&gt; {
  List&lt;Partner&gt; findByLastName(String name);
}
```


The controller has a endpoint to trigger a massinsert and stops the time
```
    @PutMapping(&quot;/partner/initialInsert&quot;)
    public void createPartner() {
        List&lt;Partner&gt; partners = mockData();
        StopWatch stopWatch = new StopWatch();
        stopWatch.start();
        partnerRepository.saveAll(partners);
        stopWatch.stop();
        System.err.println(&quot;Created: 100000 partnerEntries  ----&gt;&gt;&gt; Duration ------------&gt; &quot; + stopWatch.toString());
    }
```

And some simple query/update and insert endpoints 

```
    @GetMapping(&quot;/partner&quot;)
    public List&lt;Partner&gt; getPartnerByLastName(@RequestParam(value = &quot;lastname&quot;) String lastname) {
        StopWatch stopWatch = new StopWatch();
        stopWatch.start();
        List&lt;Partner&gt; partners = partnerRepository.findByLastName(lastname);
        stopWatch.stop();
        System.err.println(&quot;Selecting partners by lastname: &quot; +lastname + &quot; took: &quot; + stopWatch.toString() + &quot; and returns: &quot; + partners.size() + &quot; partners&quot;);
        return partners;
    }

    @PutMapping(&quot;/partner&quot;)
    public void createPartner(@RequestBody Partner partner) {
        StopWatch stopWatch = new StopWatch();
        stopWatch.start();
        partnerRepository.save(partner);
        stopWatch.stop();
        System.err.println(&quot;Updating/Inserting partner took: &quot; + stopWatch.toString());
    }

    @PostMapping(&quot;/partner/bulk&quot;)
    public void bulkUpdatePartner(@RequestBody List&lt;Partner&gt; partners) {
        StopWatch stopWatch = new StopWatch();
        stopWatch.start();
        partnerRepository.saveAll(partners);
        stopWatch.stop();
        System.err.println(&quot;Updating/Inserting partner took: &quot; + stopWatch.toString());
    }
```


***Here are our test results:***

**Inserting random data using which inserts via bulk saveAll().**

- Created: 1000   partnerEntries ----&gt;&gt;&gt; Duration ------&gt; 00:00:29.775
- Created: 10000  partnerEntries ----&gt;&gt;&gt; Duration ------&gt; 00:04:40.259
- Created: 100000 partnerEntries ----&gt;&gt;&gt; Duration ------&gt; 00:53:48.862


**Selecting data via lastname severals times**
- Selecting partners by lastname: Borer took: 00:00:00.404 and returns: 257 partners
- Selecting partners by lastname: Borer took: 00:00:00.219 and returns: 257 partners
- Selecting partners by lastname: Borer took: 00:00:00.173 and returns: 257 partners
- Selecting partners by lastname: Borer took: 00:00:00.239 and returns: 257 partners
- Selecting partners by lastname: Borer took: 00:00:00.194 and returns: 257 partners
- Selecting partners by lastname: Borer took: 00:00:00.266 and returns: 257 partners

**Updating/Inserting a single entry:**

- Updating partner took: 00:00:00.297
- Inserting partner took: 00:00:00.124

**Update bulk 256 partners using jpa:**

- Updating partner took: 00:00:08.931

**Update bulk 256 partner using Session-Object without jpa:**

- Updating partner took: 00:00:00.090


We are really curious about that the mass-insert with the jpa function saveAll() is taking &gt; 50min for inserting 100.000 objects and difference between updating 256 entries via jpa and the session-Object.
Now the question, are we doing something wrong, we tried to use a simple setup without any specialcases, is there a problem with the spring-data integration or do you guys have simular problems? I&#39;m looking forward to here your experiences with neo4j :-)

Greets Dan :)


P.S: this is how we update with the session object

```
try (Session session = driver.session()) {
            session.run(&quot;MATCH (a:Partner {lastName: &#39;Borer&#39;}) SET a.firstName = &#39;&quot; + firstname + &quot;&#39;&quot;);
}
```",1611671773,https://stackoverflow.com/q/65903344,dan,"['neo4j', 'spring-boot', 'spring-data-neo4j']"
65903194,Can Apache Tinkerpop&#39;s Neo4jGraph.open() open a database from the file system?,"I am using Apache Tinkerpop&#39;s Gremlin language to interact with a Neo4J database. I am able to use the `Neo4jGraph.open(&quot;/path/to/folder&quot;)` method (from `org.apache.tinkerpop.gremlin.neo4j.structure.Neo4jGraph`) to create a new local database. 

The Neo4J files populate the folder, so I know a database is being created. When I call `.open` again with the same path from within a unit test, it seems like the database files are being overwritten by a new database instance. Any vertices added previously are no longer in the database. Is it possible to reopen a previously created database with this method, or will a new instance always be generated?",1611671241,https://stackoverflow.com/q/65903194,Dustin Waguespack,"['java', 'neo4j', 'gremlin', 'tinkerpop']"
65900170,What are Base nodes?,"I am currently doing some manual analysis of the data in neo4j data base gathered with the [BloodHound][1] tool. 

When doing manual queries I can see a &#39;Base&#39; type node that is not introduced in the BloodHound documentation.

`MATCH (n) RETURN distinct labels(n)` returns:
```
[&quot;Base&quot;, &quot;User&quot;]
[&quot;Base&quot;, &quot;Group&quot;]
[&quot;Base&quot;]
[&quot;Base&quot;, &quot;Computer&quot;]
[&quot;Base&quot;, &quot;Domain&quot;]
[&quot;Base&quot;, &quot;GPO&quot;]
[&quot;Base&quot;, &quot;OU&quot;]
```

When checking properties of the Base nodes they seem to take properties of other node types.


My question is what exactly are those &#39;Base&#39; nodes?
I tried to find this info in BloodHound and Neo4j documentation but with no success.

  [1]: https://github.com/BloodHoundAD/BloodHound",1611659229,https://stackoverflow.com/q/65900170,m b,"['bloodhound', 'linkurious', 'neo4j']"
65895260,How to auto update node attributes in ne04j after a specific time period,"Is there a way to update an existing attribute in a node to a new value after a specific time period passes ?

For example:
Node &#39;Offer&#39; has the below attributes

1. Offer Name (String)
2. Offer ID (Numeric)
3. CREATED_ON (Timestamp)
4. IS_VALID (&#39;Yes&#39;/&#39;No&#39;)

Process:

1. When an initial &quot;Offer&quot; is created IS_VALID value is &quot;Yes&quot;
2. After 7 days of creation IS_VALID value should be set to &quot;No&quot; automatically for each of the offers

I know that there is TTL , but I don&#39;t want my node to be deleted after 7 days, rather the attribute to be updated to &quot;No&quot; from &quot;Yes&quot;

Is there any way I can achieve this in Neo4j?",1611629352,https://stackoverflow.com/q/65895260,Vader.219k,"['neo4j', 'cypher']"
65890363,"How to return a Neo4j schema with relationship names, from node names and to node names in one table?","I need to return a schema from a Neo4j database which contains all relationship labels, from-node labels and to-node labels. The table template shall be like this:

```
relationship labels, from-node labels, to-node labels
has_b,a,b
has_c,a,c
```

I noticed that the query `call db.schema.relTypeProperties` only returns limited fields, such as relType, propertyName, propertyTypes, mandatory. The fields missing are from-node labels and to-node labels.

BTW, [this][1] gives me a hint on solving my question. However, this method is proposed for returning nodes instead for relationships.


  [1]: https://neo4j.com/developer/kb/viewing-schema-data-with-apoc/",1611599261,https://stackoverflow.com/q/65890363,user12949097,"['relationship', 'schema', 'neo4j']"
65888048,neo4j - get attribute value from multiple related objects into one return row,"I have the following situation:
```
MATCH (n) WHERE n.Type IN [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;] WITH n OPTIONAL MATCH (f)-[:PART_OF]-&gt;(n) RETURN CASE WHEN n.Type = a THEN f.attribute WHEN n.Type = b then f.attribute1 ELSE &#39;&#39; END, n.type
```
I want one single row returned even if `n` has multiple objects related to it.

The below solution is not enough because I don&#39;t know the exact number of related objects. There could be `1..n` relations from `(f) - [:part_of] -&gt; (n)`:
```
MATCH (n) WHERE n.Type IN [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;] WITH n OPTIONAL MATCH (f)-[:PART_OF]-&gt;(n) WITH n, COLLECT({ftype: f.Type, fsubType:f.SubType}) AS ff RETURN CASE WHEN n.Type = a AND ff[0].ftype = x THEN &#39;z&#39; .....
```
Thanks!",1611589899,https://stackoverflow.com/q/65888048,Catalin,"['cypher', 'neo4j']"
65882897,Remove automorphisms of a cypher query output,"When doing a Cypher query to retrieve a specific subgraph with automorphisms, let&#39;s say

    MATCH (a)-[:X]-(b)-[:X]-(c),
    RETURN a, b, c

It seems that the default behaviour is to return every retrieved subgraph and all their automorphisms.
In that exemple, if (u)-[:X]-(v)-[:X]-(w) is a graph matching the pattern, the output will be u,v,w but also w,v,u, which consist in the same graph.

Is there a way to retrieve each subgraph only once ? 

EDIT: It would be great if Cypher have a feature to do that in the search, using some kind of symmetry breaking condition as it would reduce the computing time. If that is not the case, how would you post-process to find the desired output ?",1611570341,https://stackoverflow.com/q/65882897,Alexis Pister,"['neo4j', 'cypher', 'subgraph']"
65873569,neo4j - pagination return same results even when skip and order by are specified,"I&#39;m implementing infinite scroll and trying to get new items every time the user reach the bottom of the page.


problem is, neo4j return nodes that were already returned.

I read that `ORDER BY` is must for this case, but it didn&#39;t help.

I tried follow the solution here: https://stackoverflow.com/questions/16338670/how-to-paginate-query-results-with-cypher, and put the `pagination clauses (LIMIT, SKIP...)` before the `WITH` clause, but it didn&#39;t work. It also throw an error

the query: 

    MATCH(shops: Shop)
    WHERE shops.title = ~ &#39;(?i).*${search}.*&#39;
    WITH shops
    ORDER BY shops.title asc
    SKIP $skip
    LIMIT $limit
    MATCH(products: Product) &lt; -[relation: SELL] - (shops)
    RETURN shops, products, relation


how the query can guarantee new items on each request ?

*note - the `limit` is always 12, and `skip` is the items array length, the client app contain on the request.

**EDIT 1 - IMAGES FROM THE DB OF THE DUPLICATION**

it can be shown that a node with the same id, is returned from the two queries.

**1ST page - skip 0, limit 12**

[![1st page - skip 0, limit 12][1]][1]

**2ND page - skip 12, limit 12**

[![2ND page - skip 12, limit 12][2]][2]


  [1]: https://i.stack.imgur.com/cX6bn.png
  [2]: https://i.stack.imgur.com/RjD4N.png",1611508258,https://stackoverflow.com/q/65873569,Itay Tur,"['nosql', 'neo4j']"
65865919,how to insert a node in a middle of a linked list in cypher,"I am using linked list pattern in cypher to represent some data.

`(node1)-[:NEXT]-&gt;(node2)-[:NEXT]-&gt;(node3)`

the question is how can I insert `newNode` between the linked list nodes. so that I get

`(node1)-[:NEXT]-&gt;(newNode)-[:NEXT]-&gt;(node2)-[:NEXT]-&gt;(node3)` for example.

there are some corner cases where the `newNode` can be at the end of the list or the beginning and the solution needs to account for them.

is there an elegant end easy way to do it without multiple apoc.do.when calls?


",1611447232,https://stackoverflow.com/q/65865919,user1798940,"['linked-list', 'neo4j', 'cypher']"
65864232,How can I create in Cypher an index that involves 2 primary keys?,"I am creating a graph in Neo4j and I am starting by creating indexes. One index is linked to one csv file `Product` whose primary key is `productID`, another `Client` with `clientID` as PK and there&#39;s another file called `ShoppingCart` which contains `ProductId` and `ClientId` as PK. 

Then how can I create an index for `ShoppingCart`? Or is it not needed?

    CREATE INDEX ON :Product(productID);
    CREATE INDEX ON :Client(clientID);
    CREATE INDEX ON :ShoppingCart?????
    
Thanks!",1611435030,https://stackoverflow.com/q/65864232,Alejandro,"['cypher', 'neo4j', 'graph', 'database-design']"
65859220,How to process each of the allShortestPaths in Neo4j?,"I have a Neo4j graph with several relationships, each of them having property y (number). I want to find all shortest paths between node with name &#39;x&#39; and all other nodes and then, for each of these paths, calculate sum of the path edges properties and return the minimum of these sums. 

```
MATCH paths = allShortestPaths((m)-[r*]-(n)) 
WHERE m.name = &#39;x&#39; AND n.name &lt;&gt; &#39;x&#39;
RETURN n.name, //min(sum(edge.y for y in path) for path in paths) -- something like this
```

So, is there some way to process each of the found paths independently and apply some function to their edges?",1611405019,https://stackoverflow.com/q/65859220,limonchellka,"['graph-databases', 'neo4j', 'cypher']"
65858683,Neo4j hide relationship labels in Bloom,"Is it possible to hide the Neo4j relationship labels in Bloom?

We want to display the node labels without the relationship types.

Thanks",1611401397,https://stackoverflow.com/q/65858683,mbudge,['neo4j']
65850959,apoc.merge.node with special identifier fails,"I tried to merge a node with apoc.merge.node but my ident property keys have a special char(:) and get double escaped. Did i miss something or does a workaround exist?
If i replace the &quot;:&quot; with &quot;_&quot; everything works as expected.

Neo4j 4.2.1 community and APOC 4.2.0

`CALL apoc.merge.node([&quot;test&quot;], apoc.map.fromPairs([[&quot;i:d&quot;,&quot;123&quot;]])) YIELD node return node`

Error

```
Failed to invoke procedure `apoc.merge.node`: Caused by: org.neo4j.exceptions.SyntaxException: Invalid input &#39;i&#39;: expected &quot;}&quot; (line 1, column 17 (offset: 16))
&quot;MERGE (n:test{``i:d``:$identProps.``i:d``}) ON CREATE SET n += $onCreateProps ON MATCH SET n += $onMatchProps RETURN n&quot;
```",1611340892,https://stackoverflow.com/q/65850959,enstricht,"['neo4j-apoc', 'neo4j', 'cypher']"
65849630,Dynamic property keys used in Cypher Query to manipulate properties (regardless of the property values),"This is more of a database management question. I&#39;m not trying to extract content stored in properties, but I am trying to clean up a messy database.

For example, I have multiple obsolete properties that start with &quot;type&quot;, for example n.typePerson, n.type_Mangoes, n.typehouse, n.dvdTypes. 

```
match (n) 
with keys(n) as key, n 
unwind key as k 
with distinct k, n
WHERE tolower(k) contains &quot;type&quot;
with n, k
return k, n[k] 
```

--&gt; works fine

```
REMOVE n[k] return n{.*} 
```
--&gt; error message

```
WITH distinct n, collect(k) as list
FOREACH (o IN list | REMOVE n[o])
return n{.*}
```
 --&gt; error message

I&#39;m hitting a wall when it comes time to do anything with the property. I can return n[k] fine, but I cannot seem to set or remove n[k] without getting this error:

```
Neo.ClientError.Statement.SyntaxError: Invalid input &#39;[&#39;: expected an identifier character, whitespace, node labels, &#39;{&#39;, &#39;e/E&#39;, a property map, a relationship pattern, &#39;.&#39; or &#39;(&#39; (line 7, column 9 (offset: 136))
&quot;REMOVE n[o]&quot;
```
 Most grateful for pointers. Thanks!",1611335285,https://stackoverflow.com/q/65849630,Stephanie,"['cypher', 'neo4j']"
65839341,"Problem with WHERE in Neo4J, deserialization error","I&#39;m using **Neo4JClient** in .NET Core web application (I created it in VisualStudio version 2019 template) and I had code that works as expected for my example.

I have 3 types of node: `Category`(important property `name` - string), `Document`(important `CreatedBy` - represents name of `User` who created it, other properties are used after `WHERE`), `User`(important `Username` - string). Document can have `TAG` relationship with `Category` and `User` can have `INTERESTED_IN` relationship with `Category`.

First I created one query to return `Document` if it have `TAG` to `Category` and if `User` is `INTERESTED_IN` this `Category` (Note: I don&#39;t have multiple relationships between nodes). Also number of connections with `Category` is counted so if I have too many `Documents` method returns only 10 with most connections.

 

        public async Task&lt;IActionResult&gt; GetNewsFeed(string username)
    {
    	string match = $&quot;(a:User{{Username: &#39;{username}&#39;}})-[:INTERESTED_IN]-&gt;(res:Category)&lt;-[:TAG]-(b:Document)&quot;;
    	string where = $&quot;NOT(b.isArchived AND c.isArchived AND b.CreatedBy =~ &#39;{username}&#39;)&quot;;
    	string with = &quot;b.name AS name, b.CreatedBy AS creator, b.Pictures AS pictures, b.Paragraphs AS paragraphs, COUNT(res) AS interest1&quot;;
    	
    	var result = _context.Cypher.Match(match)
                                 //.Where(where)
                                   .With(with)
                                   .Return((name, creator, pictures, paragraphs, interest1)=&gt; new SimpleNewsFeedDTO { 
                                                                                                            Name = name.As&lt;string&gt;()
                                                                                                          , Creator = creator.As&lt;string&gt;()
                                                                                                          , Pictures = pictures.As&lt;string[]&gt;()
                                                                                                          , Paragraphs = paragraphs.As&lt;string[]&gt;()
                                                                                                          , Interest = interest1.As&lt;int&gt;() })  
                                   .OrderBy(&quot;interest1 DESC&quot;)
                                   .Limit(10)
                                   .ResultsAsync);
        return new JsonResult(await result);
    }

When I provide correct Username I can see results in right order, but I also want to filter Documents CreatedBy that User (I want to exclude documents created by user), but when I uncomment `Where` and send request I get following error:

    fail: Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware[1]
          An unhandled exception has occurred while executing the request.
    System.ArgumentException: Neo4j returned a valid response, however Neo4jClient was unable to deserialize into the object structure you supplied.
    
    First, try and review the exception below to work out what broke.
    
    If it&#39;s not obvious, you can ask for help at http://stackoverflow.com/questions/tagged/neo4jclient
    
    Include the full text of this exception, including this message, the stack trace, and all of the inner exception details.
    
    Include the full type definition of ExtraBlog.DTOs.SimpleNewsFeedDTO.
    
    Include this raw JSON, with any sensitive values replaced with non-sensitive equivalents:
    
     (Parameter &#39;content&#39;)
     ---&gt; System.ArgumentNullException: Value cannot be null. (Parameter &#39;input&#39;)
       at System.Text.RegularExpressions.Regex.Replace(String input, String replacement)
       at Neo4jClient.Serialization.CommonDeserializerMethods.ReplaceAllDateInstancesWithNeoDates(String content)
       at Neo4jClient.Serialization.CypherJsonDeserializer`1.Deserialize(String content, Boolean isHttp)
       --- End of inner exception stack trace ---
       at Neo4jClient.Serialization.CypherJsonDeserializer`1.Deserialize(String content, Boolean isHttp)
       at Neo4jClient.GraphClient.Neo4jClient.IRawGraphClient.ExecuteGetCypherResultsAsync[TResult](CypherQuery query)
       at ExtraBlog.Controllers.UserController.GetNewsFeed(String username) in E:\GithubRepo\NapredneBaze\Neo4JProject\extra-blog\ExtraBlog\Controllers\UsersController.cs:line 39
       at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
       at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.&lt;InvokeActionMethodAsync&gt;g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
       at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.&lt;InvokeNextActionFilterAsync&gt;g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
       at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
       at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted)
       at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.&lt;InvokeInnerFilterAsync&gt;g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
       at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeNextResourceFilter&gt;g__Awaited|24_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
       at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
       at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State&amp; next, Scope&amp; scope, Object&amp; state, Boolean&amp; isCompleted)
       at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeFilterPipelineAsync&gt;g__Awaited|19_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
       at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.&lt;InvokeAsync&gt;g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
       at Microsoft.AspNetCore.Routing.EndpointMiddleware.&lt;Invoke&gt;g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
       at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)


Also when I run something like this in Neo4J browser I get the same result with or without WHERE:

    MATCH (a:User{Username: &#39;NN&#39;})-[:INTERESTED_IN]-&gt;(res:Category)&lt;-[t:TAG]-(b:Document)
    WHERE (NOT(b.isArchived AND res.isArchived AND b.CreatedBy =~ &#39;NN&#39;))
    WITH b, COUNT(res) AS interest1
    RETURN b.name, interest1
    ORDER BY interest1 DESC
    LIMIT 10

So my question is: why I can&#39;t run my method in Visual Studio, and why this query doesn&#39;t return what I was expecting?",1611290029,https://stackoverflow.com/q/65839341,Lazar Đorđević,"['neo4jclient', 'neo4j', 'cypher']"
65835615,What certificate to use along with neo4j@code-signer,"I&#39;m currently developing a graph app for neo4j desktop. From what i figured out, app should be signed with [neo4j@code-signer][1] (which utilizes node-forge i presume).
It needs a certificate and private key (and password probably).

What i can&#39;t figure out is, what kind of certificate is actually needed?

 1. I signed my app with self-signed certificate which produced a big untrusted warning in neo4j desktop (touche, i should have known). 
 2. I used my ssl key which enabled my HTTPS, but this produced an error in neo4j desktop: 

&gt; Certificate keyUsage or basicConstraints conflict or indicate that
&gt; the certificate is not a CA. If the certificate is the only one in the
&gt; chain or isn&#39;t the first then the certificate must be a valid CA.

Both options **did** produce **signature.pem** file.

Do i need to buy a **Code Signing Certificate** for this? If so, standard or EV?

Any help would be greatly appreciated!


  [1]: https://www.npmjs.com/package/@neo4j/code-signer",1611262691,https://stackoverflow.com/q/65835615,ibecar,"['neo4j', 'ssl', 'neo4j-desktop', 'npx']"
65833831,neo4j-go-driver force to abort long running query,"I have several neo4j Cypher queries on my backend application. In rare circumstances, one of the queries takes too long to complete (due to an unoptimized query I guess), and not only that, it also cost the server resource usage spiking really high.

I am currently working with Go programming, I use the official neo4j-go-driver.

Is there any way to terminate a long-running query using the driver? from the driver&#39;s doc I found this API [WithTxTimeout](https://godoc.org/github.com/neo4j/neo4j-go-driver/neo4j#WithTxTimeout). However, I am not sure what the API does, whether it merely ignores the long-running query on the surface or actually terminates it.

Really need the help. Thanks in advance.",1611254528,https://stackoverflow.com/q/65833831,novalagung,"['go', 'neo4j']"
65821528,How does path indexing in B+tree looks like?,"Suppose, we want to search for (1)-[edgeA]-(2)-[edgeB]-(3) efficiently where (1), (2) and (3) are nodes and we have two edges connecting between them [edgeA], [edgeB].

It feels like we want to index 5 dimension data in B+tree where the sequences of the entities has to be also taken into consideration. How does the b+ tree work in such indexing? What is the key and value of each node in the b+ tree?",1611206031,https://stackoverflow.com/q/65821528,chim3yy,"['b-tree', 'indexing', 'neo4j']"
65819571,how to gather the unique related rows in a neo4j cypher query?,"I have 3 posts, 1 of which has two comments. I need to retrieve the 3 post plus the 2 comments and the authors. Problem is cypher returns all the associated links. How can I get only the rows I need? When run this query I get 72 rows....I am only expecting 4 rows:

    MATCH (p:Posts)
    WITH p
    MATCH(c:Comments)-[r:COMMENTED_ON]-()
    WITH p, c 
    MATCH (u)-[:MADE_A_POST]-&gt;()
    WITH p,c,u
    MATCH (n)-[:POSTED_COMMENT]-() 
    RETURN {post:p,comments:c,author:u,commentator:n}

I am trying to ensure that each row only contain the properties related to that row. In this case I should have 4 rows...since one of the post has 2 comments. I looked at UNION, COLLECT and DISTINCT and none seems to be a good fit. Any help would be appreciated.",1611188905,https://stackoverflow.com/q/65819571,MichaelE,"['neo4j', 'cypher', 'neo4j-apoc']"
65819049,How to do element wise addition on two list using Cypher on Neo4J,"I have two nodes and each of those nodes have a property called embedding which is basically a list of numbers. Now I want to do element wise addition of these two lists.

So basically [1,2,3] + [1,2,3] = [2,3,6]

Just directly adding does not work because addition of lists is not supported.

Here is the cypher query to replicate the two nodes -

```
CREATE (note:Note { name: &#39;note_1&#39;, embedding: [1,2,3]})
CREATE (note:Note { name: &#39;note_1&#39;, embedding: [4,5,6]})
```
I want the end result as `[5,7,9]`

Preferably without using any third party libraries that are not supported in both the community and professional edition of Neo4J",1611184438,https://stackoverflow.com/q/65819049,Nilan Saha,"['cypher', 'neo4j']"
65818488,"Cypher MATCH, WHERE, REMOVE and WITH in right order for two separate relationships","I want to match a user by *id*, remove *ttl* properties from its (optional) address and get the related role(s) of the user.

The structure is

            (user)
           /      \
    (address)  (role)

Do I need to use two queries for this? For now I have tried some options and I have read docs for `WHERE`, `REMOVE` and `WITH`.

Current status of query:

    MATCH (user:USER) -[:HAS_FIRST_ADDRESS]-&gt; (address:ADDRESS:TTL) WHERE ID(user) = 36
        WITH address REMOVE address.ttl REMOVE address:TTL,
        (user:USER) -[:HAS_ROLE]-&gt; (role:ROLE) WHERE ID(user) = 36
        RETURN {user: user, role: role, address: address}

I am getting errors like

    Invalid input &#39;W&#39;: expected whitespace, comment, a relationship pattern or &#39;.&#39; (line 1, column 177 (offset: 176))

Or for 

    MATCH (user:USER) -[:HAS_FIRST_ADDRESS]-&gt; (address:ADDRESS:TTL) WHERE ID(user) = 3
        WITH address REMOVE address.ttl REMOVE address:TTL
        MATCH (user:USER) -[:HAS_ROLE]-&gt; (role:ROLE) WHERE ID(user) = 36
        RETURN {user: user, role: role, address: address}

the error goes:

    WITH is required between REMOVE and MATCH (line 1, column 136 (offset: 135))

What am I missing here?

",1611180992,https://stackoverflow.com/q/65818488,BairDev,"['cypher', 'neo4j']"
65818071,How can I query including a specific range condition?,"I want to query a database that contains FB users activity. 
Example: I try to know the number of followers some important users have. I say &quot;some&quot; because there is a condition which is that I want to see only the users who have between 10k and 50k followers. I would use something like this...(not working btw):

**MATCH (u:Users)-[r:FOLLOWS]-&gt;(i:ImportantUsers)
WITH i, COUNT(u) as followers
WHERE u&gt;=10000 u&lt;=50000
RETURN i.Name, followers
ORDER BY followers DESC**

Any idea why this is not working? Every time I execute it appears an error message. Thanks for the help!",1611178774,https://stackoverflow.com/q/65818071,Alejandro,"['neo4j', 'cypher']"
65816224,Wait in Node.js app until neo4j is ready: Could not perform discovery. No routing servers available,"I&#39;m having a Kubernetes deployment containing my Node.js app and a neo4j service. The problem is that, neo4j takes some seconds to start (15M nodes - but same effect even when the graph is empty), but my app is already trying to run a query:

    var neo4j = require(&#39;neo4j-driver&#39;)
    
    async function start() {
        var driver = neo4j.driver(
            &#39;neo4j://localhost&#39;,
            neo4j.auth.basic(&#39;neo4j&#39;, &#39;password&#39;)
          )
          
        var session = driver.session()
    
        // Create admin upon start...
        await session.run(&#39;MERGE (n:user {name: &quot;Admin&quot;})&#39;)
    }
    
    start()

The query fails with &quot;Neo4jError: Could not perform discovery. No routing servers available.&quot; because neo4j is still starting. When I restart my app some seconds after neo4j has been started completely, everything works as expected. So the question is: How can I wait in my Node.js application (or instruct Kubernetes) to wait until neo4j is ready?

The yaml for my deployment is as follows:

    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: test
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: test
      template:
        metadata:
          labels:
            app: test
        spec:
          containers:
            - name: neo4j
              image: neo4j:4.2.2
              ports:
                - containerPort: 7474
              volumeMounts:
                - mountPath: /data
                  name: neo4j
    
            - name: node-app
              image: some-image-from-container-registry
    
          volumes:
            - name: neo4j
              persistentVolumeClaim:
                claimName: neo4j-pv",1611170455,https://stackoverflow.com/q/65816224,Nrgyzer,"['neo4j', 'kubernetes', 'node.js']"
65809879,Neo4j Collaborative Filtering (CF) recommendation query using Pearson,"Hi everyone at Stackoverflow,

I want to understand query that is using Pearson.

What can be ```nom``` and ```denom```?

What is ```r1: r1``` and ```r2: r2```?

And I don&#39;t understand what is ```r.r1.rating``` and ```r.r2.rating```.

This query should be recommending Movies that are rated by other Users.

    MATCH (u1:User {id: 3})-[r:RATED]-&gt;(m:Movie)
    WITH u1, avg(r.rating) AS u1_mean
    MATCH (u1)-[r1:RATED]-&gt;(m:Movie)&lt;-[r2:RATED]-(u2)
    WITH u1, u1_mean, u2, COLLECT({r1: r1, r2: r2}) AS ratings WHERE size(ratings) &gt; 10
    MATCH (u2)-[r:RATED]-&gt;(m:Movie)
    WITH u1, u1_mean, u2, avg(r.rating) AS u2_mean, ratings
    UNWIND ratings AS r
    WITH sum( (r.r1.rating-u1_mean) * (r.r2.rating-u2_mean) ) AS nom,
         sqrt( sum( (r.r1.rating - u1_mean)^2) * sum( (r.r2.rating - u2_mean) ^2)) AS denom,
         u1, u2 WHERE denom &lt;&gt; 0
    WITH u1, u2, nom/denom AS pearson
    ORDER BY pearson DESC LIMIT 10
    MATCH (u2)-[r:RATED]-&gt;(m:Movie) WHERE NOT EXISTS( (u1)-[:RATED]-&gt;(m) )
    RETURN m.name, SUM( pearson * r.rating) AS score
    ORDER BY score DESC LIMIT 25

The output is as follows:

&quot;m.name&quot;                     │&quot;score&quot;           │

│&quot;Sleepless in Seattle&quot;      │25.859451877376813│

│&quot;The Tunnel&quot;                │22.652532472101605│

│&quot;Beetlejuice&quot;               │22.21835919736008 │

│&quot;Shriek If You Know What ..&quot;│21.935357890253528│

│&quot;Dawn of the Dead&quot;          │21.421377433824798│

│&quot;The Prisoner of Zenda&quot;     │21.225502683325033│

│&quot;The Talented Mr. Ripley&quot;   │20.83938743140176 │


Any suggestions will be helpful.",1611146924,https://stackoverflow.com/q/65809879,Anna,"['pearson', 'collaborative-filtering', 'neo4j']"
65809295,NEO4J MATCH query returns incorrect output,"I have a simple query to search for a relationship based on a property uuid:

    MATCH ()-[r]-&gt;() where r.uuid = &#39;**ab7544ce-9d85-4033-867a-b9d80c6c7b07**&#39; return r
    
    [{&#39;r&#39;: (1917411)-[:Gets_Over_By {finish_date: &#39;2020-04-02&#39;, percent_alloc: 1.0, start_date: &#39;2020-03-16&#39;, uuid: &#39;**e6d16fef-b2c8-482c-ad4c-9e13306545de**&#39;}]-&gt;(1917385)}]

However, only sometimes (once in about 200 times) when I run this query, I get the incorrect output when I search through my **Python** program where I use **py2neo.Graph** package. However, if I query through the neo4j browser on windows, it returns the correct relationship.


I use the `graph.run(cypher_query)` method to execute the cypher queries. 
I use neo4j-community-3.4.11. 

I have no idea what could be wrong so any help is appreciated.
Thanks


                
",1611144670,https://stackoverflow.com/q/65809295,Kshitij ,"['python', 'neo4j', 'py2neo']"
65806301,Neo4j cypher query perfomance,"I have the following cypher queries and their execution plans respectively,

**Before optimization**,
```
match (o:Order {statusId:74}) &lt;- [:HAS_ORDERS] - (m:Member)
with m,o 
match (m:Member) - [:HAS_WALLET] -&gt; (w:Wallet) where w.currentBalance &lt; 250 
return m as Members,collect(o) as Orders,w as Wallets order by m.createdAt desc limit 10
```

[![enter image description here][1]][1]


----------


**After optimization (db hits reduced by 40-50%)**,
```
match (m:Member) - [:HAS_ORDERS]-&gt;(o:Order {statusId:74})
with m, collect(o) as Orders
match (m) - [:HAS_WALLET] - (w:Wallet) where w.currentBalance &lt; 250
return m as Members, Orders, w as Wallets 
order by m.createdAt desc limit 10
```
[![enter image description here][2]][2]

There are 3 types of nodes, Member, Order and Wallet. And the relation between them goes like this,

- *Member - [:HAS_ORDERS] -&gt; Order*,
- *Member - [:HAS_WALLET] -&gt; Wallet*

I have around 100k Member nodes (100k wallet) and almost 570k orders for those members.
I want to fetch all the members who have order status 74 and wallet balance less than 250, and the above query gives the desired result but it takes an average 1.5 sec to respond.

I suspect there is a still scope of optimization here but I&#39;m not be able to figure out. I&#39;ve added indexing on fields upon which I&#39;m filtering the data.

I&#39;ve just started exploring neo4j and not sure how can I optimize this. 


  [1]: https://i.stack.imgur.com/kpKyr.png
  [2]: https://i.stack.imgur.com/CPHCu.png",1611133602,https://stackoverflow.com/q/65806301,dhruv,"['cypher', 'optimization', 'neo4j']"
65799737,Neo4j algo.unionFind equivalent with new Graph Data Science Library,"I have a cypher projection that used algo.unionFind in Neo4j. However, that algorithim has been deprecated. My query was: 

```CALL algo.unionFind(&#39;MATCH (n) WHERE n.dtype=\&quot;VALUE\&quot; RETURN id(n) AS id&#39;,&#39;MATCH p=(n)-[]-(m) WHERE n.dtype=\&quot;VALUE\&quot; AND m.dtype=\&quot;VALUE\&quot; RETURN id(n) AS source, id(m) AS target&#39;,  {write:true, partitionProperty:\&quot;partition\&quot;, graph:&#39;cypher&#39;}) YIELD nodes, setCount, loadMillis, computeMillis, writeMillis```

I was hoping to find an equivalent approach with the Graph Data Science Library that runs the query and writes a new property ```partition``` in my nodes. 

Any help would be greatly appreciated!  ",1611091468,https://stackoverflow.com/q/65799737,Noel,"['py2neo', 'graph-data-science', 'python', 'cypher', 'neo4j']"
65793796,"neo4j-admin data import succeeds, but data is not visible in neo4j browser","I am using the following code to import the data into neo4j 3.5 (running in a docker system):


    cd /sparkwiki/helpers/
    target_db=&quot;neo4j&quot;
    delim=&quot;\t&quot;
    data_dir=/wikiout_german
    part_template=&quot;part-\d{5}-.*.csv.gz&quot;
    
    neo4j-admin import \
        --database=$target_db --delimiter=$delim \
        --report-file=/tmp/import-wiki.log \
        --id-type=INTEGER \
        --nodes:Page import/page_header.csv,&quot;$data_dir/page/normal_pages/$part_template&quot; \
        --nodes:Page:Category import/page_header.csv,&quot;$data_dir/page/category_pages/$part_template&quot; \
        --relationships:LINKS_TO import/pagelinks_header.csv,&quot;$data_dir/pagelinks/$part_template&quot; \
        --relationships:BELONGS_TO import/categorylinks_header.csv,&quot;$data_dir/categorylinks/$part_template&quot; \
        --ignore-missing-nodes

There is nothing wrong with the script, because it worked fine with neo4j 4.0 (with minor adjustment of syntax).

The process of importing the data goes without any error, and I get the following output:

```
IMPORT DONE in 7m 7s 93ms.
Imported:
  8075624 nodes
  598327030 relationships
  32302496 properties
Peak memory usage: 1.35 GB
There were bad entries which were skipped and logged into /tmp/import-wiki.log
```

However, when I try to check the nodes using neo4j browser, I don&#39;t see any nodes there. The docker-compose code snippet for neo4j is this:

```
neo4jwikidevde:
    build:
      context: ./docker
      dockerfile: neo4j/Dockerfile
    environment:
      - NEO4J_AUTH=neo4j/test
    volumes:
      - data_de:/var/lib/neo4j/data
      - logs_de:/logs
      - import_de:/var/lib/neo4j/import
      - ./wikiout_german:/wikiout_german
    networks:
      - internal_t2g
      - external-network
    ports:
      - 7475:7474
      - 7688:7687
```

Notes: 

1) There were some suggestions to restart the neo4j container and check, after the import is complete. I have already tried that, it didn&#39;t work. 

2) The data was getting imported in case of neo4j 4.0, but python code is not getting connected with neo4j in case of version 4.0. So, I am trying with 3.5 (which is working in my other codebases). 

I have tried quite a few things, nothing seems to work. Any suggestions will be highly appreciated.",1611067442,https://stackoverflow.com/q/65793796,Kshitij Mittal,['neo4j']
65792507,How can I return both a node and its relationship in a way neo4j-graphql-js accepts?,"Hi I have been stuck on this for a few days now. This tends to work in the Desktop Browser but not neo4j-graphql-js. So I&#39;m hoping you can help.

I have this MATCH:

    OPTIONAL MATCH (this)-[r:FOLLOWS]-&gt;(something)-[WROTE|TAGGED]-(post:Post)

And I would like to return all posts combined with r. I tried to use a map but it was rejected by neo4j as expecting a node. I tried to use a virtual node but that didn&#39;t seem to be supported. I can&#39;t figure out how to use this.

This is my full query currently:

    OPTIONAL MATCH (this)-[r:FOLLOWS]-&gt;(something)-[r2:WROTE|TAGGED]-(post:Post)
    WITH COLLECT(post) as rows
    OPTIONAL MATCH (this)-[:WROTE]-&gt;(post:Post)
    WITH rows + COLLECT(post) as allRows
    UNWIND allRows as post
    RETURN DISTINCT post
    ORDER BY post.date DESC

Thank you in advance!
",1611063052,https://stackoverflow.com/q/65792507,Dan Fein,"['cypher', 'graphql', 'neo4j-graphql-js', 'neo4j']"
65792196,Need a Cypher query that returns the nodes which are connected to nodes based on a different attribute value,"I have a dataset based on historical sources from the late seventeenth and eighteenth centuries. In my graph database I capture the relationships between people, events, and the churches in which these events took place. I also record the nature of the relationships. For example:

```
(p:person {ID: &#39;TRE_person_1197&#39;})-[:FATHER_AT]-(e:event:baptism {ID:E0001})-[:TOOK_PLACE_IN]- (c:church:ROMAN_CATHOLIC_CHURCH {ID: &#39;c0001&#39;})
(p:person {ID: &#39;TRE_person_1197&#39;})-[:FATHER_AT]-(e:event:baptism {ID:E0002})-[:TOOK_PLACE_IN]- (c:church:ROMAN_CATHOLIC_CHURCH {ID: &#39;c0002&#39;})
(p:person {ID: &#39;TRE_person_1197&#39;})-[:FATHER_AT]-(e:event:baptism {ID:E0003})-[:TOOK_PLACE_IN]- (c:church:CHURCH_OF_UTRECHT {ID: &#39;c0003&#39;})
```

Based on this data, it&#39;s fairly easy to write a query which returns the people who are connected to events which occurred in different Churches by making use of the labels &#39;ROMAN_CATHOLIC_CHURCH&#39; and &#39;CHURCH_OF_UTRECHT&#39;. However, how do I retrieve the people who are connected to events which occurred in
different churches (as in parishes) that were part of one Church, e.g. the Roman Catholic Church? I make a distinction between the churches/parishes by means of the ID (e.g. c0001), but I&#39;m not sure how to use the attribute value. What I need is a query which retrieves the people that were, through events, connected to different Roman Catholic churches (in this example person TRE_person_1197 who is connected to events in two different Roman Catholic churches, namely c0001 and c0002). 

",1611061967,https://stackoverflow.com/q/65792196,Jaap,"['neo4j', 'cypher']"
65790028,Best Practices for Executing multiple neo4j cypher queries in one transaction - using Async API,"I have written test code to connect to neo4j server from java app and execute two cypher queries in ONE Transaction.I did not find detailed example for executing two queries and retrieving result in [neo4j Documentation][1] 

Though the code works, my question is: 
- **Are these the best practices** to use neo4j(AsyncSession, Transaction) and java(CompletionStage/ CompletableFuture) interface?
- Are the queries executed **Asynchronously** if I use CompletableFuture.get() at the end?

Other details: 
- Neo4j version: v4.2.1
- Neo4j Driver version: 4.1.1
- Java jdk v8

```

    package com.abc.test;
    
    import com.abc.Logger;
    import com.abc.LoggerFactory;
    import org.neo4j.driver.AuthTokens;
    import org.neo4j.driver.Driver;
    import org.neo4j.driver.GraphDatabase;
    import org.neo4j.driver.SessionConfig;
    import org.neo4j.driver.async.AsyncSession;
    import org.neo4j.driver.async.ResultCursor;
    
    import java.util.ArrayList;
    import java.util.Collections;
    import java.util.List;
    import java.util.Map;
    import java.util.concurrent.CompletableFuture;
    import java.util.concurrent.CompletionStage;
    import java.util.concurrent.ExecutionException;
    import java.util.stream.Collectors;
    
    public class Neo4jConnectorTest {
        private Logger logger = LoggerFactory.getLogger(Neo4jConnectorTest.class);
    
        private Driver driver;
        private SessionConfig sessionConfig = SessionConfig.builder()
                //.withDefaultAccessMode(AccessMode.READ)
                .withDatabase(&quot;testdb&quot;).build();
    
        private Neo4jConnectorTest(String uri, String user, String password) {
            driver = GraphDatabase.driver(uri, AuthTokens.basic(user, password));
        }
    
        public static void main(String... args) throws ExecutionException, InterruptedException {
            Neo4jConnectorTest example = new Neo4jConnectorTest(&quot;neo4j://x.x.x.x:7687&quot;, &quot;neo4j&quot;, &quot;neo4j&quot;);
            List&lt;String&gt; listOfProductTitles = example.readProductTitles4();
        }
    
        private List&lt;String&gt; readProductTitles4() throws ExecutionException, InterruptedException {
            AsyncSession session = driver.asyncSession(sessionConfig);
    
            CompletionStage&lt;List&lt;CompletionStage&lt;List&lt;String&gt;&gt;&gt;&gt; listOfProductTitles = session
                    .beginTransactionAsync()
                    .thenComposeAsync(tx -&gt; {
                        logger.debug(&quot;Transaction created&quot;);
    
                        List&lt;CompletionStage&lt;ResultCursor&gt;&gt; list = new ArrayList&lt;&gt;(2);
                        String query = &quot;MERGE (p:Product {id: $id }) ON CREATE SET p.id = $id RETURN p.id&quot;;
                        Map&lt;String, Object&gt; parameters = Collections.singletonMap(&quot;id&quot;, &quot;P1&quot;);
                        CompletionStage&lt;ResultCursor&gt; r1 = tx.runAsync(query, parameters);
                        list.add(r1);
    
                        query = &quot;MERGE (p:Product {id: $id }) ON CREATE SET p.id = $id RETURN p.id&quot;;
                        parameters = Collections.singletonMap(&quot;id&quot;, &quot;P2&quot;);
                        CompletionStage&lt;ResultCursor&gt; r2 = tx.runAsync(query, parameters);
                        list.add(r2);
    
                        CompletableFuture&lt;Void&gt; allFutures = CompletableFuture.allOf(list.toArray(new CompletableFuture[list.size()]));
    
                        CompletableFuture&lt;List&lt;CompletionStage&lt;List&lt;String&gt;&gt;&gt;&gt; result = allFutures
                                .thenApplyAsync(v -&gt; {
                                    logger.debug(&quot;v: {}&quot;, v);
    
                                    List&lt;CompletionStage&lt;List&lt;String&gt;&gt;&gt; productList = list
                                            .stream()
                                            .map(stage -&gt; {
                                                return stage
                                                        .thenComposeAsync(resultCursor -&gt;
                                                        {
                                                            return resultCursor
                                                                    .listAsync(record -&gt;
                                                                            record.get(0).asString()
                                                                    );
                                                        });
                                            })
                                            .collect(Collectors.toList());
    
                                    return CompletableFuture.completedFuture(productList);
                                })
                                .thenComposeAsync(ignore -&gt; {
                                    logger.debug(&quot;ignore: {}&quot;, ignore);
                                    logger.debug(&quot;closing transaction now..&quot;);
                                    return tx
                                            .commitAsync()
                                            .thenComposeAsync((ignore2) -&gt; {
                                                logger.debug(&quot;transaction committed successfully: {}&quot;, ignore2);
                                                return ignore;
                                            });
    
                                    //return ignore;
                                });
                        return result;
                        //return CompletableFuture.completedFuture(false);
                    })
                    .exceptionally(e -&gt; {
                        logger.error(&quot; 2-- e: {}&quot;, e);
                        List&lt;CompletionStage&lt;List&lt;String&gt;&gt;&gt; nn = Collections.emptyList();
                        return nn; //CompletableFuture.completedFuture(Collections.emptyList());
                    })
                    .thenComposeAsync((obj) -&gt;
                            session.closeAsync()
                                    .thenApplyAsync((ignore) -&gt; {
                                        logger.debug(&quot;session closed. result: {}&quot;, obj);
                                        return obj;
                                    })
                    )
                    .thenComposeAsync((obj) -&gt;
                            driver.closeAsync()
                                    .thenApplyAsync((ignore) -&gt; {
                                        logger.debug(&quot;driver closed. result: {}&quot;, obj);
                                        return obj;
                                    })
                    )
                    .exceptionally(e -&gt; {
                        logger.error(&quot; ERROR -- e: {}&quot;, e.getMessage());
                        List&lt;CompletionStage&lt;List&lt;String&gt;&gt;&gt; nn = Collections.emptyList();
                        return nn; //CompletableFuture.completedFuture(Collections.emptyList());
                    });
    
            return getResult(listOfProductTitles);
        }
    
        private List&lt;String&gt; getResult(CompletionStage&lt;List&lt;CompletionStage&lt;List&lt;String&gt;&gt;&gt;&gt; listOfProductTitles) throws ExecutionException, InterruptedException {
            CompletionStage&lt;List&lt;String&gt;&gt; finalList = listOfProductTitles
                    .thenApplyAsync((x) -&gt; {
    
                        return x.stream()
                                .map(xx -&gt; {
                                    List&lt;String&gt; r;
                                    try {
                                        r = xx.toCompletableFuture().get();
                                    } catch (InterruptedException | ExecutionException e) {
                                        logger.error(&quot; error occurred: {}&quot;, e.getMessage());
                                        r = Collections.emptyList();
                                    }
                                    return r;
                                })
                                .flatMap(List::stream)
                                .collect(Collectors.toList());
    
                    });
    
            List&lt;String&gt; output = finalList.toCompletableFuture().get();
            logger.debug(&quot;final list: {}&quot;, output);
            return output;
        }
    
    }

```


  [1]: https://neo4j.com/docs/driver-manual/current/session-api/configuration/#driver-async-sessions",1611053486,https://stackoverflow.com/q/65790028,poemdaga,"['asynchronous', 'java', 'performance', 'cypher', 'neo4j']"
65789719,"Use CREATE, SET and add a relationship in Cypher","I have a syntax problem with the following query and I think it is impossible to do it like this:

**Adding line breaks for readability, they are not in the actual query.**

    CREATE (a:USER:TTL {mail: &#39;a@b.de&#39;, fullName: &#39;example&#39;, password: &#39;spgjwetpjsfj32523rmdcp23r&#39;})
    SET a += {
        createdAt : datetime.transaction(&#39;Europe/Berlin&#39;),
        ttl : timestamp() + 172800000,
        confirmHash: 697159094 }
    -[:HAS_FIRST_ADDRESS]-&gt;
    (address:ADDRESS:TTL {
        addressStreet: &#39;ab&#39;, addressAddition: &#39;zusatz&#39;, addressCityCode: 12334, addressCity: &#39;city&#39;})
    SET address.createdAt = datetime.transaction(&#39;Europe/Berlin&#39;), address.ttl = timestamp() + 172800000
    RETURN a

This gives me an error:

    Invalid input &#39;:&#39;: expected whitespace, a variable, RelationshipsPattern, an expression or &#39;]&#39;

I guess that I cannot use `CREATE (a) SET a+= {prop: &#39;a&#39;} -[:REL]-&gt; (b) SET b.name = &#39;ab&#39; RETURN a` in a row, because the query runs well when I **omit the first `SET` part** (the one for the user).

Do I need to set all properties in the parameters for the nodes like `(a {prop: &#39;a&#39;})`? Is there any way to combine `CREATE` with `SET` and adding a relationship?

I am using Neo4J 4.2.2.",1611052316,https://stackoverflow.com/q/65789719,BairDev,"['neo4j', 'cypher']"
65789424,JQAssistant with multiple projects and builds,"I have JQAssistant scanning my project(s) and can query each of the projects.  The documentation cites a Team Server ability where all projects/builds are stored in a central Neo4j db.

I cannot find any documentation though on how this would be handled, or what happens for multiple builds.  Nodes do not seem to be tagged with a build number, and neither with the project name, so it appears to be one big lump.

Is there an easy way to tag everything on the way in with projectName and BuildNumber, or am I missing something?  I assume I could tag everything one JQAssistant is run and tag everything missing these tags, but then I lose parallelism and seems too hacky.

This would also help pruning data based on old builds to avoid too much build-up.

Any help much appreciated,",1611051253,https://stackoverflow.com/q/65789424,Rollo Tomassi,"['neo4j', 'maven', 'jqassistant', 'java']"
65787282,Spark+Neo4j [Request processing failed; nested exception is java.lang.ClassNotFoundException:,"I try to build an spring boot application that uses neo4j entegrated with spark. But an error is occur when I run that. I can&#39;t understand what that is means.

```ERROR 1984 --- [nio-8081-exec-1] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.ClassNotFoundException: Failed to find data source: org.neo4j.spark.DataSource. Please find packages at http://spark.apache.org/third-party-projects.html] with root cause

java.lang.ClassNotFoundException: org.neo4j.spark.DataSource.DefaultSource
	at org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader.loadClass(TomcatEmbeddedWebappClassLoader.java:72) ~[spring-boot-2.4.0.jar:2.4.0]
	at org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1188) ~[tomcat-embed-core-9.0.39.jar:9.0.39]
	at org.apache.spark.sql.execution.datasources.DataSource$$anonfun$20$$anonfun$apply$12.apply(DataSource.scala:652) ~[spark-sql_2.11-2.4.7.jar:2.4.7]
	at org.apache.spark.sql.execution.datasources.DataSource$$anonfun$20$$anonfun$apply$12.apply(DataSource.scala:652) ~[spark-sql_2.11-2.4.7.jar:2.4.7]
	at scala.util.Try$.apply(Try.scala:192) ~[scala-library-2.11.12.jar:na]
	at org.apache.spark.sql.execution.datasources.DataSource$$anonfun$20.apply(DataSource.scala:652) ~[spark-sql_2.11-2.4.7.jar:2.4.7]
	at org.apache.spark.sql.execution.datasources.DataSource$$anonfun$20.apply(DataSource.scala:652) ~[spark-sql_2.11-2.4.7.jar:2.4.7]
	at scala.util.Try.orElse(Try.scala:84) ~[scala-library-2.11.12.jar:na]
	at org.apache.spark.sql.execution.datasources.DataSource$.lookupDataSource(DataSource.scala:652) ~[spark-sql_2.11-2.4.7.jar:2.4.7]
	at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:213) ~[spark-sql_2.11-2.4.7.jar:2.4.7]
	at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:186) ~[spark-sql_2.11-2.4.7.jar:2.4.7]
	at com.etuproject.friendfinddboperations.service.WordCountService.getCount(WordCountService.java:35) ~[classes/:na]
	at com.etuproject.friendfinddboperations.controller.WordCountController.count(WordCountController.java:29) ~[classes/:na]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_241]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_241]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_241]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_241]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:197) ~[spring-web-5.3.1.jar:5.3.1]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:141) ~[spring-web-5.3.1.jar:5.3.1]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:106) ~[spring-webmvc-5.3.1.jar:5.3.1]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:893) ~[spring-webmvc-5.3.1.jar:5.3.1]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:807) ~[spring-webmvc-5.3.1.jar:5.3.1]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-5.3.1.jar:5.3.1]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1061) ~[spring-webmvc-5.3.1.jar:5.3.1]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:961) ~[spring-webmvc-5.3.1.jar:5.3.1]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006) ~[spring-webmvc-5.3.1.jar:5.3.1]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:909) ~[spring-webmvc-5.3.1.jar:5.3.1]`
```

My controller class is like that. It gets just a string and call the service.

```
import com.etuproject.friendfinddboperations.service.WordCountService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.Arrays;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping(value = &quot;/api/sss&quot;)
public class WordCountController {

    @Autowired
    @Qualifier(&quot;WordCountService&quot;)
    WordCountService service;

    @RequestMapping(method = RequestMethod.POST, path = &quot;/wordcount&quot;)
    public Map&lt;String, Long&gt; count(@RequestParam(required = true) String words) {


        return service.getCount(wordList);
    }
}

```
My service class is like that 

```
import org.apache.spark.SparkConf;
import org.apache.spark.api.java.JavaRDD;
import org.apache.spark.api.java.JavaSparkContext;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Map;

import org.apache.spark.sql.Dataset;
import org.apache.spark.sql.Row;
import org.apache.spark.sql.SparkSession;

@Service(&quot;WordCountService&quot;)
public class WordCountService {

    @Autowired
    JavaSparkContext sc;


    public Map&lt;String, Long&gt; getCount(List&lt;String&gt; wordList) {
        SparkSession spark = SparkSession
                .builder()
                .appName(&quot;Spark SQL Example&quot;)
                .config(&quot;spark.master&quot;, &quot;local&quot;)
                .getOrCreate();
        Dataset&lt;Row&gt; ds = spark.read().format(&quot;org.neo4j.spark.DataSource&quot;)
                .option(&quot;url&quot;, &quot;bolt://localhost:7687&quot;)
                .option(&quot;authentication.basic.username&quot;, &quot;neo4j&quot;)
                .option(&quot;authentication.basic.password&quot;, &quot;password&quot;)
                .option(&quot;labels&quot;, &quot;Person&quot;)
                .load();

        ds.show();
        Map&lt;String, Long&gt; wordCounts=new HashMap&lt;&gt;();

        return wordCounts;
    }

}

```
My config file is 
spark.app.name=Spring Spark Word Count Application
spark.master=local[1]


```
import org.apache.spark.SparkConf;
import org.apache.spark.api.java.JavaSparkContext;
//import org.apache.spark.sql.SparkSession;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class SparkConfig {

    @Value(&quot;${spark.app.name}&quot;)
    private String appName;
    @Value(&quot;${spark.master}&quot;)
    private String masterUri;

    @Bean
    public SparkConf conf() {

        return new SparkConf()
                .setAppName(appName)
                .setMaster(masterUri)
                .set(&quot;spark.driver.allowMultipleContexts&quot;, &quot;true&quot;);
    }

    @Bean
    public JavaSparkContext sc() {
        return new JavaSparkContext(conf());
    }

}

```
And last my pom is 


```
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.4.0&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;FindFriends&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;FindFriends&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;

    &lt;properties&gt;
        &lt;java.version&gt;11&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
            &lt;version&gt;5.3.1&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;neo4j-contrib&lt;/groupId&gt;
            &lt;artifactId&gt;neo4j-connector-apache-spark_2.11&lt;/artifactId&gt;
            &lt;version&gt;4.0.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
            &lt;artifactId&gt;junit-jupiter&lt;/artifactId&gt;
            &lt;version&gt;RELEASE&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.jgrapht&lt;/groupId&gt;
            &lt;artifactId&gt;jgrapht-core&lt;/artifactId&gt;
            &lt;version&gt;LATEST&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;


        &lt;dependency&gt;
            &lt;groupId&gt;log4j&lt;/groupId&gt;
            &lt;artifactId&gt;log4j&lt;/artifactId&gt;
            &lt;version&gt;1.2.17&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.thoughtworks.paranamer&lt;/groupId&gt;
            &lt;artifactId&gt;paranamer&lt;/artifactId&gt;
            &lt;version&gt;2.8&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;
            &lt;artifactId&gt;spark-core_2.11&lt;/artifactId&gt;
            &lt;version&gt;2.4.7&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.apache.spark/spark-sql --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;
            &lt;artifactId&gt;spark-sql_2.11&lt;/artifactId&gt;
            &lt;version&gt;2.4.7&lt;/version&gt;
        &lt;/dependency&gt;


    &lt;/dependencies&gt;

    &lt;repositories&gt;
        &lt;!-- list of other repositories --&gt;
        &lt;repository&gt;
            &lt;id&gt;SparkPackagesRepo&lt;/id&gt;
            &lt;url&gt;http://dl.bintray.com/spark-packages/maven&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
```
",1611042459,https://stackoverflow.com/q/65787282,popier,"['apache-spark', 'maven', 'spring-boot', 'neo4j', 'java']"
65785704,How to combine two or more neo4j cypher result columns,"Can I combine multiple neo4j cypher result columns into one array? The use case is I  have a query that return an array of multiple columns:

    ......
    RETURN a AS post, b AS author, c AS comment

Cypher returns this as three distinct sets of arrays a,b and c. Though these are connected data I only have a column view of each. I can use 

    result.records[i].get(&#39;post&#39;) 
    result.records[i].get(&#39;author&#39;) 
    result.records[i].get(&#39;comment&#39;)

but I can&#39;t assume that &#39;author&#39; in [i] is the author of post[i]. So I need to have a RETURN where a, b and c is in row[i]..which means collapsing all three columns into one. So I want my resultArray to look like this: 

     resultArray: [{a,b,c},{a,b,c},....]

where result.records[0] = {a,b,c}.

I hope I was able to explain the use case, any help would be appreciated.

",1611032393,https://stackoverflow.com/q/65785704,MichaelE,"['neo4j', 'neo4j-apoc', 'cypher']"
65785056,Can I return the relationship as a field within a node?,"I currently have this query:

    OPTIONAL MATCH (t)&lt;-[r:CHILD_OF]-(t1:Thing)&lt;-[:TAGGED]-(post:Post)
and later on I have

    OPTIONAL MATCH (this)&lt;-[:TAGGED]-(post:Post)
and because they all return together (as a list of posts), I don&#39;t know which posts were children of a thing or which ones just tagged &quot;this&quot; directly.

Is it possible to return when &quot;r&quot; which is the name of the &quot;CHILD_OF&quot; relationship variable here is present?

Full post looks something like this:

    OPTIONAL MATCH (this)&lt;-[:CHILD_OF]-(t1:Thing)&lt;-[:TAGGED]-(post:Post)
    WITH COLLECT(post) as rows, this
    OPTIONAL MATCH (this)&lt;-[:TAGGED]-(p:Post)
    WITH rows + COLLECT(p) as allRows
    UNWIND allRows as post
    RETURN DISTINCT post
    ORDER BY post.date DESC
I don&#39;t want it as a map as neo4j-graphql-js doesn&#39;t support that, they exclusively support returning single nodes. So I also can&#39;t do return post, r



    type Thing {
        id: ID!,
        name: String,
        description: String,
        image: String,
        followers: [User] @relation(name: &quot;FOLLOWS&quot;, direction: &quot;IN&quot;),
        posts: [Post] @cypher(statement: &quot;&quot;&quot;
            OPTIONAL MATCH (this)&lt;-[:CHILD_OF]-(t1:Thing)&lt;-[:TAGGED]-(post:Post)
            WITH COLLECT(post) as rows, this
            OPTIONAL MATCH (this)&lt;-[:TAGGED]-(p:Post)
            WITH rows + COLLECT(p) as allRows
            UNWIND allRows as post
            RETURN DISTINCT post
            ORDER BY post.date DESC
        &quot;&quot;&quot;)
       
    }
    
    type User {
        id: ID!,
        uid: String,
        name: String,
        email: String,
        bio: String,
        followers: [User] @relation(name: &quot;FOLLOWS&quot;, direction: &quot;OUT&quot;),
        post_count: Int @cypher(statement: &quot;&quot;&quot;
            MATCH (this)-[:WROTE]-&gt;(p:Post)
            RETURN count(p)
        &quot;&quot;&quot;),
        homepage_posts: [Post] @cypher(statement: &quot;&quot;&quot;
            OPTIONAL MATCH (this)-[r:FOLLOWS]-&gt;(something)-[:WROTE|TAGGED]-(post:Post)        
            WITH COLLECT(post) as rows
            OPTIONAL MATCH (this)-[:WROTE]-&gt;(post:Post)
            WITH rows + COLLECT(post) as allRows
            UNWIND allRows as post
            RETURN DISTINCT post
            ORDER BY post.date DESC
        &quot;&quot;&quot;)
    }
    
    type Relationship {
        type: String
    }
    
    type Post {
        id: ID!,
        body: String,
        images: [String],
        date: DateTime,
        isRetweet: Boolean,
        rating: Float,
        relationship: Relationship,
        author: User @relation(name: &quot;WROTE&quot;, direction: &quot;IN&quot;),
        things: [Thing] @relation(name: &quot;TAGGED&quot;, direction: &quot;OUT&quot;),
        likes: [User] @cypher(statement: &quot;&quot;&quot;
            MATCH (u:User)-[r:LIKES]-&gt;(this)
            RETURN u
        &quot;&quot;&quot;),
    }

",1611026478,https://stackoverflow.com/q/65785056,Dan Fein,"['graph', 'cypher', 'neo4j']"
65781814,Any way to query apoc.mongodb.find by ObjectId,"The documents in m MongoDB have a _id of type ObjectId.
In Neo4j a node has a reference to the document by the ObjectId as a string representation. But i can&#180;t figure out how to query a document by the ObjectId as a string using apoc.mongodb.

Neo4j 4.2.1 community and APOC (+ mongodb driver) 4.2.0

This obviously does not work.
* `CALL apoc.mongodb.find(&quot;mongodb://host:port&quot;, &quot;testdb&quot;, &quot;testcoll&quot;, {_id: &quot;6005c050d36d9acd28b8679b&quot;}, null, null)`
* `CALL apoc.mongodb.find(&quot;mongodb://host:port&quot;, &quot;testdb&quot;, &quot;testcoll&quot;, {_id: ObjectId(&quot;6005c050d36d9acd28b8679b&quot;)}, NULL, NULL)&quot;`",1611002649,https://stackoverflow.com/q/65781814,enstricht,"['mongodb', 'neo4j', 'objectid']"
65779736,"Neo4j, Python; OSError: [Errno 57] Socket is not connected","I am trying to connect my *jupyter notebook* using *python* with the *Neo4j database*. I have previously done this successfully but I am unable to connect this time. I am using the following piece of code:

```Python
from neo4j import GraphDatabase
driver = GraphDatabase.driver(uri, auth=(&quot;user&quot;, &quot;password&quot;))
```

and I am getting the following error
`OSError: [Errno 57] Socket is not connected`

I checked out similar issues on here but none that helped me resolve my problem with this neo4j library on python.",1610992664,https://stackoverflow.com/q/65779736,Ambar Singh,"['python', 'sockets', 'oserror', 'neo4j']"
65779470,Neo4j v4.1.5 Community Edition CREATE INDEX doesn&#39;t recognise OPTIONS,"I&#39;m trying to create an index on Neo4j 4.1.5 Community Edition using CYPHER with OPTIONS however it doesn&#39;t work.

Command:

    CREATE INDEX index_content_name IF NOT EXISTS FOR (n:__Content) ON (n.name) OPTIONS { indexProvider: &#39;lucene+native-3.0&#39; }

Error:

    Invalid input &#39;O&#39;: expected whitespace, comment, &#39;;&#39; or end of input (line 1, column 77 (offset: 76))
    &quot;CREATE INDEX index_content_name IF NOT EXISTS FOR (n:__Content) ON (n.name) OPTIONS { indexProvider: &#39;lucene+native-3.0&#39;

Is this functionality disabled on the Community edition?

If not, what am I doing wrong?

",1610991616,https://stackoverflow.com/q/65779470,Richard Urwin,"['neo4j', 'options', 'cypher']"
65777965,How to handle result,"I&#39;m working on a Go project that use a neo4j database. I don&#39;t fully understand how to handle results from my queries.

Under, this is my code that I managed to work but I would like to ```return user``` instead of ```return user.email as email, user.pseudo as pseudo```. Here I have 2 return values, but what if I have more than 10 values to return... I&#39;m not sure, I&#39;m doing it properly.

```
data, err := session.ReadTransaction(func(tx neo4j.Transaction)(interface{}, error) {
		res, err := tx.Run(
			`match (user:User) where user.email = $email
			return user.email as email, user.pseudo as pseudo`,
			map[string]interface{}{&quot;email&quot;: email})

			if err != nil {
				return nil, err
			}

			if res.Next() {
				if pseudo, found := res.Record().Get(&quot;pseudo&quot;); found {
					userData.Pseudo = pseudo.(string)
				}
				if email, found := res.Record().Get(&quot;email&quot;); found {
					userData.Email = email.(string)
				}

				return userData, nil
			}

			return nil, nil
	})
```

Thing is, when I return ```user := res.Record().Values()[0]``` instead of ```res.Record().Get(&quot;something&quot;)```, I got an interface but I don&#39;t know how to extract the data specifying the id like ```user.email```.
A ```fmt.Printf(&quot;%t&quot;, user)``` gives ```&amp;{%!t(*types.Node=&amp;{0 [User] map[email:testman@mail.com pseudo:testman]})}```.

**UPDATE

```go
data, err := session.ReadTransaction(func(tx neo4j.Transaction)(interface{}, error) {
		res, err := tx.Run(`MATCH (user:User) WHERE user.email = $email RETURN user`, map[string]interface{}{&quot;email&quot;: email})

		if err != nil {
			return nil, err
		}

		if res.Next() {			
			record, err := res.Single()

			if err != nil {
				fmt.Printf(&quot;%s\n&quot;, err.Error())
				return nil, err
			}

			userRecord, found := record.Get(&quot;user&quot;)

			if !found {
				return nil, errors.New(&quot;User not found&quot;)
			}

			userAttributes := userRecord.(map[string]interface{})
			userData.Email = userAttributes[&quot;email&quot;].(string)

			return userData, nil
		}

		return nil, nil
	})
```
",1610985518,https://stackoverflow.com/q/65777965,Yok0,"['neo4j', 'go']"
65772448,Neo4j windows installation - digital signing issue,"My windows system is a restricted environment with no admin rights ,while starting neo4j on windows with bat file I get digital signing issue:
\neo4j.ps1 is not digitally signed.

I cannot set ExecutionPolicy to Unrestricted as these rights are restricted in my system for current user.

 What&#39;s best way to install neo4j on windows without admin rights and bypassing digital signing issue?",1610964596,https://stackoverflow.com/q/65772448,Stack_IQ,['neo4j']
65768914,neo4j cypher APOC.case returns null properties,"Can anyone explain why this apoc procedure returns null properties on the yielded value?? In this example the predicate is false.

    MATCH (p:Posts) 
     CALL apoc.when(
      p.region_audience IS NOT NULL AND NOT (2 IN p.region_audience),
      &quot;RETURN null&quot;,
      &quot;RETURN p AS post&quot;,
      {p:p})
    YIELD value
    RETURN value,p.title;

So while `value` which should be equal to `p` is returned completely if you try to `return value.title` you get null. If your return `p.title` you do get the title. I know it has something to do with how the `yield` is computed. 

Any help would be appreciated!",1610944823,https://stackoverflow.com/q/65768914,MichaelE,"['cypher', 'neo4j-apoc', 'neo4j']"
65757581,"How can I reuse &quot;this&quot; in reference to a current node, in neo4j-graphql?","I am using neo4j-graphql-js and in one of my cypher statement&#39;s I&#39;m referring to &quot;this&quot; which is the current node. It seems that the word &quot;this&quot; in my first MATCH is accurate, but then when I use MATCH the second time, &quot;this&quot; becomes just a general keyword and defaults to an unlabeled/non-specific node (and just returns everything).

Here&#39;s the code currently. it finds any posts that are either tagging &quot;Things&quot; that are children of the current Thing node, or where they&#39;re tagging the current Thing node specifically.

        MATCH (this)&lt;-[:CHILD_OF]-(t1:Thing)&lt;-[:TAGGED]-(post:Post)
        WITH COLLECT(post) as rows
        MATCH (this)&lt;-[:TAGGED]-(p:Post)
        WITH rows + COLLECT(p) as allRows
        UNWIND allRows as post
        RETURN count(DISTINCT post)
Any ideas how I can reuse &quot;this&quot; the second time? I tried sharing it after WITH COLLECT(post) as rows, like this:

    WITH COLLECT(post) as rows, this
Any ideas would be appreciated, thank you in advance!",1610860696,https://stackoverflow.com/q/65757581,Dan Fein,"['neo4j-graphql-js', 'graphql', 'neo4j', 'cypher']"
65751441,neo4j 4.2 how to copy users/passwords from one instance to other instance?,"Please, advice how to copy users/passwords from one neo4j version 4.2 instance to other neo4j instance version 4.2 ?

( In neo4j v.3.5 it was easy ,even without stopping the nodes you can just copy the dbms/auth &amp; dbms/roles files to the other node ) 

Thanks",1610811925,https://stackoverflow.com/q/65751441,R2D2,['neo4j']
65751429,"Can not use apoc.uuid.install(), error caused by: java.lang.NullPointerException","I am trying to create unique ids for nodes for which I am trying to use apoc library.
But I am having problems when using the apoc.uuid.install()",1610811848,https://stackoverflow.com/q/65751429,Kanuor,['neo4j']
65750506,Is there a way to use Cypher in python without setting up a Neo4j server?,"I would like to make queries on property graphs using the cypher language directly in python. For what I understand I first have to setup a Neo4j server and connect to it with Python.

But is there a way to directly make cypher requests in python graph objects, for example on Networkx objects? Or is there a python library that can set up the Neo4j server automatically?",1610805650,https://stackoverflow.com/q/65750506,Alexis Pister,"['neo4j', 'cypher', 'python']"
65750089,Spring bootRun fails during the installation of a plateform,"I want to install an online framework locally. I downloaded the code source and then followed the steps described on this [link][1]. However, when I give this command **&quot;./gradlew bootRun&quot;** to run the spring boot, I am receiving these errors: **org.postgresql.util.PSQLException: FATAL: password authentication failed for user &quot;postgres&quot;**

    &gt; Task :bootRun FAILED
    
    FAILURE: Build failed with an exception.
    
    * What went wrong:
    Execution failed for task &#39;:bootRun&#39;.
    &gt; Process &#39;command &#39;/usr/lib/jvm/java-14-openjdk-amd64/bin/java&#39;&#39; finished with non-zero exit value 1
    
    * Try:
    Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.
    
    * Get more help at https://help.gradle.org
    
    BUILD FAILED in 34s

I&#39;ve tried to install **Neo4J** and **postgresql** but it doesn&#39;t resolve the problem.
I am using **ubuntu 20.14** as OS.

After trying other suggestions posted here, I used these two commands:

    ./gradlew clean 
    ./gradlew build

But the build is failed and I am getting this error:

 

       Resource Controller &gt; excludeByClass() FAILED
            java.lang.AssertionError at ResourceControllerTest.kt:221
    
     Task :integrationTest FAILED
    
    FAILURE: Build failed with an exception.
    
    * What went wrong:
    Execution failed for task &#39;:integrationTest&#39;.
    &gt; There were failing tests. See the report at: file:///home/anouar/Downloads/orkg-backend-master/build/reports/tests/integrationTest/index.html
    
    * Try:
    Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.
    
    * Get more help at https://help.gradle.org
    
    Deprecated Gradle features were used in this build, making it incompatible with Gradle 7.0.
    Use &#39;--warning-mode all&#39; to show the individual deprecation warnings.
    See https://docs.gradle.org/6.6.1/userguide/command_line_interface.html#sec:command_line_warnings
    
    BUILD FAILED in 2m 59s
**UPDATE:**
After etablishing the connection to the PostgreSQL server, the execution is freezing in 80% as shown in this screenshot:
[![enter image description here][2]][2]
[![enter image description here][3]][3]


**UPDATE 2:**
[![enter image description here][4]][4]


  [1]: https://gitlab.com/TIBHannover/orkg/orkg-backend
  [2]: https://i.stack.imgur.com/8LMDZ.png
  [3]: https://i.stack.imgur.com/HadyT.png
  [4]: https://i.stack.imgur.com/zBC0M.png",1610803142,https://stackoverflow.com/q/65750089,Anouar,"['neo4j', 'spring-boot', 'postgresql']"
65749882,Mismatching store id,"I have two neo4j containers built using the same dockerfile (Let&#39;s call them A and B). The data is required to be imported using neo4j-admin from several folders containing csv files, and data folders for A and B are different and mutually disjoint. Every time I try to import the data, there are no errors on the first container, but the other container throws an error of &#39;mismatching store id&#39;.

I received the error on B when I started with A. When I purged the system and started with B, I received the same error on A.",1610801641,https://stackoverflow.com/q/65749882,Kushagra Mittal,"['docker', 'neo4j']"
65746467,find which customer increased spending from first purchase to last,"The schema of the database is as following    

     MATCH (customer{customerid})-[:made]-&gt;(purchased{Invoiceno, invoicedate})-[:includes{quantity, invoiceamount}]-&gt;(product{stockcode, unitprice})

is there a way to find which customer increased spending from first purchase to last",1610770766,https://stackoverflow.com/q/65746467,mailer345761,"['graph-databases', 'nosql-aggregation', 'nosql', 'database', 'neo4j']"
65746371,Unable to access neo4j db &quot;Fail to read transaction log &quot;,"I&#39;m getting this Error message when checking neo4j/debug.log
&quot;Fail to read transaction log version 47. java.lang.NegativeArraySizeException: null. At position LogPosition{logVersion=47, byteOffset=243359678} and entry version V3_0_10
&quot; 

Please help ,How can i recover my db!!!",1610769534,https://stackoverflow.com/q/65746371,Soumya Ranjan sahoo,"['database', 'neo4j']"
65746040,figuring out what customers bought together with the most popular product in graph database,"I am using Neo4j.
The schema for the database is:

    MATCH (customer{customerid})-[:made]-&gt;(purchased{invoiceno, invoicedate})-[:includes{quantity, invoiceamount}]-&gt;(product{stockcode, unitprice})

I already know how to get the most popular product.

    MATCH (a:customer)-[r1:made]-&gt;(b:purchase)-[r2:includes]-&gt;(c:product)
    RETURN p.stockcode, count(*) AS quantity
    ORDER BY quantity DESC
    LIMIT 1

Which gives me the the most popular product.

    ╒══════════════╤═══════════════════╕
    │&quot;p.stockcode&quot; │&quot;quantity&quot;         │
    ╞══════════════╪═══════════════════╡
    │&quot;85123A&quot;      │77                 │
    └──────────────┴───────────────────┘
how do I tell what customer bought together with this product.
",1610765653,https://stackoverflow.com/q/65746040,ananono,"['graph-databases', 'nosql', 'neo4j', 'nosql-aggregation', 'database']"
65744292,How to query a graph database using neo4j,"Im quite new to cypher query language, and im trying to figure out how to query my database about a few things 

My graph model is `(customer)-[:makes]-&gt; (order)-[:consists_of]-&gt;(products)`

1. `customer` includes customer id 
2. `order` includes orderid and order date 
3. `products` include productdescription and product code 
4. `consists of` (relationship) includes the quantity

I have a few queries I&#39;ve been stuck on and I&#39;m not sure if someone could help me figure them out 

1. Which month did the customers spend the most money?
2. What did the customers buy together with the most popular product?(most popular product = bag)
3. Which customers increased spending from the first purchase to the last? 

I would appreciate any help i can get even the small things would be greatly appreciated 
",1610749266,https://stackoverflow.com/q/65744292,Shan,['neo4j']
65740903,No write operations are allowed directly on this database. Writes must pass through the leader. The role of this server is: FOLLOWER,"Im using py2neo(2020.1.0) to connect and make queries in Neo4j, Getting below error

`No write operations are allowed directly on this database. Writes must pass through the leader. The role of this server is: FOLLOWER`

I use `neo4j+s:` scheme to connect, When I gone through the articles `neo4j+s:` will take care of routing. But It seems not working. Is it possible to get around with this ?",1610732174,https://stackoverflow.com/q/65740903,Selvakumar Ponnusamy,"['neo4j', 'py2neo']"
65735881,How to find the the most popular product in graph database?,"I have a graph database with the following schema made using Neo4j.

    MATCH (customer{customerid})-[:made]-&gt;(purchased{Invoiceno, invoicedate})-[:includes{quantity, invoiceamount}]-&gt;(product{stockcode, unitprice})

I want the most popular product which is the most customers purchased but I am only able to get the most purchased product by quantity.

    MATCH (a:customer)-[r1:MADE]-&gt;(b:purchase)-[r2:includes]-&gt;(c:product)
    WITH SUM(r2.quantity) AS totalquantity, c.stockcode AS productcode
    RETURN productcode, totalquantity  ORDER BY totalquantity DESC LIMIT 1


This was the result.

    ╒═════════════╤═══════════════╕
    │&quot;productcode&quot;│&quot;totalquantity&quot;│
    ╞═════════════╪═══════════════╡
    │&quot;84077&quot;      │3552           │
    └─────────────┴───────────────┘

So, how do I get the most popular product based on most customer buying it ?",1610712661,https://stackoverflow.com/q/65735881,ananono,"['neo4j', 'cypher']"
65726642,Neo4j - How to display a graph of Nodes connected to properties of related nodes,"I have Nodes Customer and Product - with a directed relationship TRANSACTION from Customer to Product.
Product has the property `category`.

Is it possible to display all the Customers connected to all the categories which they have bought? As though the categories were a node rather than a property.",1610657081,https://stackoverflow.com/q/65726642,D10001,"['neo4j-browser', 'neo4j']"
65725740,How do I get the number of fields returned in neo4j cypher?,"How do I access the number of fields return in the cypher result object? I tried result.length which says length is not a method...while result.records.length gives me the number records returned. this is an example:

    MATCH (a:Person) MATCH(b:Cars) Return a AS Persons, b AS Cars

this is what the returned result look like...

    {&quot;records&quot;:[{&quot;keys&quot;:[&quot;Persons&quot;,&quot;Cars&quot;],**&quot;length&quot;:2,**&quot;_fields&quot;:[{&quot;identity&quot;:{&quot;low&quot;:14,&quot;high&quot;:0},&quot;labels&quot;:[&quot;Voter&quot;],&quot;properties&quot;:{&quot;name_key&quot;......

this will return two fields/keys (Persons and Cars) and the length. Assuming all records will have the same amount of fields I can use 

    result.records[0].length

Is there a better way to access it?


",1610652743,https://stackoverflow.com/q/65725740,MichaelE,"['neo4j', 'cypher']"
65725533,Return group results in Cypher query (using apoc),"I am able to count nodes by property using apoc, with this query

    CALL apoc.nodes.group([&#39;Package&#39;],[&#39;Repository&#39;])
    yield nodes
    return nodes

I can see that the `Repository` field is returned with a `_count` property

Now I&#39;d like to return just those two properties in my query, but I don&#39;t see how ...

I&#39;ve tried

    CALL apoc.nodes.group([&#39;Package&#39;],[&#39;Repository&#39;])
    yield nodes
    return nodes.Repository, nodes._count;

but I get

    Type mismatch: expected Any, Map, Node or Relationship but was List&lt;Node&gt; (line 3, column 8 
    (offset: 77))
    &quot;return nodes.Repository, nodes._count;&quot;
                ^

",1610651808,https://stackoverflow.com/q/65725533,Sebastian Slutzky,"['neo4j', 'neo4j-apoc']"
65725353,Cypher: how to update a property value in a node that exists in the Neo4j database?,"I have a Cypher question.
I have articles nodes with several properties. There is only one property value that I want to update in existing nodes.

For example I insert the node `(a:ARTICLE {id:1, title:&#39;test&#39;, score=2}`.
The score value change during the day so I want to keep the node in the database but only update the score.

For example I would like to keep the node above in the DB with same id and title but only score value updated: `(a:ARTICLE {id:1, title:&#39;test&#39;, score=3}`.
So I tried this:
To insert the articles in the database I do this:

    &quot;MERGE (a:ARTICLE {id:$id, title:$title}) SET a += {score:$score}&quot;

But doesn&#39;t work the node is duplicated. How can I write well the request ? ",1610651001,https://stackoverflow.com/q/65725353,jos97,"['cypher', 'neo4j']"
65725203,Neo4j: Check if node exists and use the result as a condition,"Sorry, to ask this question for the 100th time, but none of the previous posts was similar to my problem: I just want to get back TRUE or FALSE if a node with a certain label and a certain property exists.

(u:User {user_id: 1} =&gt; TRUE / FALSE

All other posts where about MERGE and so on, but I don&#39;t want to create anything, I want to use it as a condition in an apoc.do.when-function.",1610650330,https://stackoverflow.com/q/65725203,JJJanezic,['neo4j']
65724553,neo4j Could not change password,"I installed neo4j for the first time in my laptop and I got this error while creating the database. Error: Could not change password
and when I try recreating it I get  DBMS with name &quot;Graph DBMS 01341b61&quot; already exists 
so I checked the dbms folder, the databases are created but for some reason I get this error and they are not displayed on the neo4j desktop.",1610647672,https://stackoverflow.com/q/65724553,Hira Muazzam,"['cypher', 'neo4j', 'graph-databases', 'database', 'neo4j-desktop']"
65719550,Ionic to signed apk with neo4j driver,"I&#39;m actually working on a Ionic projet and i&#39;m using neo4j driver to use my neo4j database.

And i wanted to know if the connection with my database won&#39;t stop working after creating my apk

Thanks :)",1610629597,https://stackoverflow.com/q/65719550,TheCheddarMonster,"['ionic-framework', 'neo4j', 'neo4j-driver', 'cordova', 'capacitor']"
65717194,Neo4j not performing for undirected relationship,"I&#39;ve been working with neo4j 4.1 for a while now and whilst I feel that the graph structure should be a good fit for my problem, I can&#39;t get it to perform in any reasonable time.

I&#39;ll detail the model and problem below, but I&#39;m wondering whether (a) graphs are just not a good fit or (b) I&#39;ve modelled the problem incorrectly.

In my domain, I have two labels: `Person` and `Skill`. Each as an `id` attribute and there is an index on this attribute.

Skills are related to one another in a parent-child relationship, implying that one or more child skills belong to the parent skill, as follows:

`(s:Skill)-[r:IS_IN_CAT]-&gt;(s2:Skill)`

A Person is related to a Skill as follows:

`(p:Person)-[r:HAS_SKILL]-&gt;(s:Skill)`

This is illustrated as below:

[![enter image description here][1]][1]

The question I want to ask is, given a Person who has a skill, find me all paths to all other people via that skill.

In the diagram above, if Person A was the person, I&#39;d expect 2 paths:

`(Person A) - [HAS_SKILL] - (Skill 1-1-1) - [IS_IN_CAT] - (Skill 1-1) - [IS_IN_CAT] - (Skill 1-1-2)  - [HAS_SKILL] - (Person B)`

And

`(Person A) - [HAS_SKILL] - (Skill 1-1-1) - [IS_IN_CAT] - (Skill 1-1) - [IS_IN_CAT] - (Skill 1)  - [IS_IN_CAT] - (Skill 1-2) - [HAS_SKILL] - (Person C)`

The way I&#39;m asking this query is as follows.

`MATCH (p:Person {id: 100}) - [h:HAS_SKILL] -&gt; (s:Skill) - [r:IS_IN_CAT*..] - (s2:Skill) &lt;- [h2:HAS_SKILL] - (p2:Person)`

For any moderately sized graph (10,000 skills, 1000 people, 5 skills per person) this doesn&#39;t ever return.

I&#39;m fairly sure it&#39;s the undirected nature of the `[r:IS_IN_CAT*..]` part of the query but I don&#39;t see how to re-model to make this perform any better.

Any help would be appreciated.


  [1]: https://i.stack.imgur.com/0Bpgb.png",1610619860,https://stackoverflow.com/q/65717194,user783836,['neo4j']
65716439,neo4j profiling - is estimated rows vs rows mismatch a problem?,"I&#39;ve been profiling a new4j query using the `profile` command. I&#39;m much more familiar with SQL profiling and execution plans.

In the profile, I see this:
    
    +VarLengthExpand(All)@neo4j | (s1)&lt;-[rc:IS_IN_CAT*]-(s2) WHERE rc_RELS.is_active_path = true            | 4183 |19 |  120005 

`4185` is the estimated rows and `19` is the actual rows.

If I saw this mismatch (4185 vs 19) in a relational db, I&#39;d think one of my indexes is out of date. However, I have manually updated all my indexes in neo4j.

Is the mismatch a problem? 

",1610616670,https://stackoverflow.com/q/65716439,user783836,['neo4j']
65715693,Relink all the edges of a vertex Neo4j/Neptune,"How can I refresh all the edges from a vertex?

Use case:

I have to link different entities provided by some logic and the linking needs to be refreshed periodically. One way is to delete the previous edges and then create a new ones inside a transaction, but this solution wouldn&#39;t work for a large graph since there would be large transaction running which will impact other things.

Can someone suggest other way around for graphdb like Neo4j and Neptune?",1610613151,https://stackoverflow.com/q/65715693,Vipul,"['graph-databases', 'amazon-neptune', 'neo4j']"
65704207,“Invalid use of aggregating function in this context” using COUNT query (Neo4j),"I am trying to display a graph with both nodes displayed to look at only the persons who submitted more than one claim. This only displays the persons nodes.

```
MATCH (p:Persons)-[r:submitted]-&gt;(q:Claims)
WITH p,
COUNT(r) AS cnt 
WHERE cnt &gt; 1
RETURN p;
```
",1610549144,https://stackoverflow.com/q/65704207,keek,['neo4j']
65699591,How to match relationships pattern using boolean constraints in Neo4j?,"My goal is to navigate from START to END and I also want to walk along the ENTER/EXIT combination paths.

In this simple case I have to write:
``` 
(START)-[:FLOWS_TO]-&gt;()-[:ENTER]-&gt;......-&gt;[:EXIT]-&gt;()-[:FLOWS_FROM]-&gt;()-[:FLOWS_TO]-&gt;(END)
```

Now imagine that I want to define a more general query like ```(START)-[r*1..n]-&gt;(END)``` with the ability to express something like this: 

```
FROM START MATCH (FLOWS_TO*1..n OR (ENTER -&gt; FLOWS_TO*1..n -&gt; EXIT -&gt; FLOWS_FROM))*1..n TO END
```

so basically evaluating a boolean string and allowing &quot;r&quot; to become one (or more) of these matching alternatives. How to do so?

[![enter image description here][1]][1]


  [1]: https://i.stack.imgur.com/CAUYy.png",1610532067,https://stackoverflow.com/q/65699591,Edoardo Vignati,"['neo4j-apoc', 'neo4j', 'cypher']"
